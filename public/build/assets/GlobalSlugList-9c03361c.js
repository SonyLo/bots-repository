import{G as v,q as i,t as a,v as t,H as u,J as c,F as f,C as p,x as b,D as h,y as m,K as y,A as g,L as w,Q as S,B as _,u as V,z as j,P as k,Y as O,O as C}from"./index.es-77235f88.js";import{V as $,T as U}from"./TelegramChannelHelper-c9c5b03c.js";import{P as F}from"./Pagination-df5e6be2.js";const P={class:"row"},M={class:"input-group mb-3"},B={key:0,class:"row"},I={class:"col-12 col-md-12 mb-3"},A={class:"list-group"},T=["onClick"],N={class:"ms-2 me-auto w-100"},G={class:"fw-bold"},J={class:"badge bg-info rounded-pill"},D={class:"w-100"},q={class:"d-flex justify-content-between"},E=["onClick"],L=["onClick"],z={style:{position:"absolute",right:"10px"},class:"badge bg-primary rounded-pill"},H={class:"col-12"},K={key:1,class:"row"},Q=t("div",{class:"col-12"},[t("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет медиа-файлов ")],-1),Y=[Q],R={props:["selected","needVideo","needVideoNote","needPhoto","needAudio","needDocument","needSticker"],data(){return{bot:null,loading:!0,media:[],search:null,media_paginate_object:null}},computed:{...v(["getMedia","getMediaPaginateObject","getCurrentBot"])},mounted(){this.loadCurrentBot().then(()=>{this.loadMedia()})},methods:{selectMedia(o){this.$emit("select",o)},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},nextMedia(o){this.loadMedia(o)},remove(o){this.$store.dispatch("removeMedia",{dataObject:{mediaId:o}}).then(e=>{this.loadMedia(),this.$notify({title:"Удаление медиа-контента",text:"Медиа контент удален"})}).catch(()=>{})},showPreview(o){this.$store.dispatch("showMediaPreview",{dataObject:{mediaId:o}}).then(e=>{this.$notify({title:"Превью медиа-контента",text:"Отправлено в бота"})}).catch(()=>{})},loadMedia(o=0){this.loading=!0,this.$store.dispatch("loadMedia",{dataObject:{botId:this.bot.id||null,search:this.search,needVideo:this.needVideo||!1,needVideoNote:this.needVideoNote||!1,needPhoto:this.needPhoto||!1,needAudio:this.needAudio||!1,needDocument:this.needDocument||!1,needSticker:this.needSticker||!1},page:o}).then(e=>{this.loading=!1,this.media=this.getMedia,this.media_paginate_object=this.getMediaPaginateObject}).catch(()=>{this.loading=!1})}}},W=Object.assign(R,{__name:"BotMediaList",setup(o){return(e,d)=>(i(),a(f,null,[t("div",P,[t("div",M,[u(t("input",{type:"search",class:"form-control",placeholder:"Поиск файла","aria-label":"Поиск файла","onUpdate:modelValue":d[0]||(d[0]=r=>e.search=r)},null,512),[[c,e.search]]),t("button",{class:"btn btn-outline-secondary",onClick:d[1]||(d[1]=r=>e.loadMedia(0)),type:"button",id:"button-addon2"},"Найти ")])]),e.media.length>0?(i(),a("div",B,[t("div",I,[t("ul",A,[(i(!0),a(f,null,p(e.media,(r,l)=>(i(),a("li",{onClick:s=>e.selectMedia(r),class:b([{"border-info":o.selected.indexOf(r.file_id)!=-1},"list-group-item d-flex justify-content-between align-items-start"])},[t("div",N,[t("div",G,[h(m(r.caption??"Без подписи")+" ",1),t("span",J,m(r.type),1)]),t("small",D,m(r.file_id),1),t("div",q,[t("a",{href:"javascript:void(0)",class:"btn btn-link p-0 my-2",onClick:s=>e.showPreview(r.id)},"Показать превью",8,E),t("a",{href:"javascript:void(0)",class:"btn btn-link p-0 my-2 text-danger",onClick:s=>e.remove(r.id)},"Удалить",8,L)])]),t("span",z,"#"+m(r.id),1)],10,T))),256))])]),t("div",H,[e.media_paginate_object?(i(),y(F,{key:0,onPagination_page:e.nextMedia,pagination:e.media_paginate_object},null,8,["onPagination_page","pagination"])):g("",!0)])])):(i(),a("div",K,Y))],64))}}),X={class:"form-floating mb-3"},Z=t("label",{for:"floatingInput"},"Команда",-1),x={class:"form-floating mb-3"},ee=t("label",{for:"floatingInput"},"Мнемоническое имя",-1),te={class:"form-floating mb-3"},oe=t("label",{for:"floatingInput"},"Описание скрипта",-1),se=t("h6",null," Параметры скрипта ",-1),le=t("div",{class:"alert alert-info",role:"alert"}," Данные параметры используются для настройки скриптов на стороне сервера ",-1),ie={class:"dropdown"},ne=t("button",{class:"btn btn-outline-info w-100 dropdown-toggle mb-2",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," Добавить ",-1),ae={class:"dropdown-menu w-100"},de=["onClick"],re={class:"row"},ue={class:"col-12"},ce=["onClick"],ge={key:0,class:"row"},me={class:"col-md-6 mb-1"},he={class:"card"},fe={class:"card-header d-flex justify-content-between align-items-center"},pe=["onClick"],be=t("i",{class:"fa-solid fa-trash-can"},null,-1),_e=[be],ve=["onClick"],ye=t("i",{class:"fa-solid fa-caret-left"},null,-1),Ce=[ye],ke=["onClick"],$e=t("i",{class:"fa-solid fa-caret-right"},null,-1),Fe=[$e],we={class:"dropdown"},Se={class:"btn btn-outline-info dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Ve={class:"dropdown-menu"},je=["onClick"],Oe={class:"card-body"},Ue={class:"form-floating mb-1"},Pe=["onUpdate:modelValue","id"],Me=["for"],Be={key:0,class:"form-floating mb-1"},Ie=["id","onUpdate:modelValue"],Ae=["for"],Te={key:1,class:"form-check mb-1 mt-2"},Ne=["onUpdate:modelValue","id"],Ge=["for"],Je={key:2,class:"form-floating mb-1 mt-2"},De=["onUpdate:modelValue","id"],qe=["for"],Ee={key:3,class:"form-floating mb-1 mt-2"},Le=["onUpdate:modelValue","id"],ze=["for"],He={key:4,class:"form-floating mb-1 mt-2"},Ke=t("label",{class:"form-label",id:"bot-domain"},"JSON-код",-1),Qe={key:5,class:"form-check mb-1 mt-2"},Ye=["onUpdate:modelValue","id"],Re=["for"],We={key:6,class:"form-floating mb-3"},Xe=["id","onUpdate:modelValue"],Ze=["for"],xe={key:7,class:"form-floating mb-3"},et=["id","onUpdate:modelValue"],tt=["for"],ot={key:1,class:"row"},st=t("div",{class:"col-12"},[t("p",null,"Параметры скрипта еще не добавлены")],-1),lt=[st],it={class:"btn btn-outline-primary w-100 mt-2 p-3"},nt={key:0},at={key:1},dt={props:["item"],components:{Vue3JsonEditor:$},data(){return{filters:[],simple:!0,configTypes:[{title:"Текстовый или числовой параметр",type:"text"},{title:"Большое текстовое поле",type:"large-text"},{title:"Канал обратной связи",type:"channel"},{title:"Логический оператор",type:"boolean"},{title:"Ссылка на изображение",type:"image"},{title:"Цвет",type:"color"},{title:"Geo",type:"geo"},{title:"Номер телефона",type:"phone"},{title:"JSON",type:"json"}],bot:null,photos:[],slugForm:{bot_id:null,id:null,command:null,comment:null,slug:null,config:[],is_global:!0}}},computed:{...v(["getCurrentBot"]),filteredConfigs(){return this.filters.length==0?this.slugForm.config:this.slugForm.config.filter(o=>this.filters.indexOf(o.type)>=0)}},mounted(){this.loadCurrentBot(),this.item&&(this.slugForm.id=this.item.id||null,this.slugForm.command=this.item.command,this.slugForm.comment=this.item.comment,this.slugForm.bot_id=this.item.bot_id,this.slugForm.slug=this.item.slug,this.slugForm.config=this.item.config||[],this.slugForm.is_global=this.item.is_global||!1)},methods:{toggleFilter(o){let e=this.filters.indexOf(o);e>=0?this.filters.splice(e,1):this.filters.push(o)},addTextTo(o,e={text:null}){this.slugForm.config[o].value=e.text},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},submit(){let o=new FormData;Object.keys(this.slugForm).forEach(e=>{const d=this.slugForm[e]||"";typeof d=="object"?o.append(e,JSON.stringify(d)):o.append(e,d)}),this.$store.dispatch(this.slugForm.id===null?"createSlug":"updateSlug",{slugForm:o}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно обновлена",type:"success"}),this.slugForm.id===null&&(this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0),this.$emit("callback")}).catch(e=>{})},onJsonChange(o,e){this.filteredConfigs[e].value=o},addConfig(o){this.slugForm.config.splice(0,0,{key:null,value:null,type:o||"text"})},move(o,e=0){let d=this.slugForm.config[o],r=this.slugForm.config.length||0,l=e===0?o-1>=0?o-1:r-1:o<r-1?o+1:0;this.slugForm.config[o]=this.slugForm.config[l],this.slugForm.config[l]=d},removeConfigItem(o){try{this.slugForm.config.splice(o,1)}catch{this.slugForm.config=[]}},selectPhoto(o,e){this.filteredConfigs[e].value=o.file_id}}},At=Object.assign(dt,{__name:"SlugForm",setup(o){return(e,d)=>{const r=w("mask");return i(),a("form",{onSubmit:d[3]||(d[3]=k((...l)=>e.submit&&e.submit(...l),["prevent"]))},[t("div",X,[u(t("input",{type:"text","onUpdate:modelValue":d[0]||(d[0]=l=>e.slugForm.command=l),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[c,e.slugForm.command]]),Z]),t("div",x,[u(t("input",{type:"text","onUpdate:modelValue":d[1]||(d[1]=l=>e.slugForm.slug=l),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[c,e.slugForm.slug]]),ee]),t("div",te,[u(t("input",{type:"text","onUpdate:modelValue":d[2]||(d[2]=l=>e.slugForm.comment=l),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[c,e.slugForm.comment]]),oe]),se,le,t("div",ie,[ne,t("ul",ae,[(i(!0),a(f,null,p(e.configTypes,(l,s)=>(i(),a("li",null,[t("a",{class:"dropdown-item",onClick:n=>e.addConfig(l.type)},m(l.title||"Не установлен"),9,de)]))),256))])]),t("div",re,[t("div",ue,[t("p",null,[h("Фильтры: "),(i(!0),a(f,null,p(e.configTypes,(l,s)=>(i(),a("span",{class:b(["badge mb-1 bg-gray-100 cursor-pointer mr-1",{"bg-info":e.filters.indexOf(l.type)>=0}]),onClick:n=>e.toggleFilter(l.type)},m(l.type),11,ce))),256))])])]),e.filteredConfigs.length>0?(i(),a("div",ge,[(i(!0),a(f,null,p(e.filteredConfigs,(l,s)=>(i(),a("div",me,[t("div",he,[t("div",fe,[t("div",null,[t("button",{onClick:n=>e.removeConfigItem(s),class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},_e,8,pe),t("button",{onClick:n=>e.move(s,0),style:{"margin-left":"5px"},class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Ce,8,ve),t("button",{onClick:n=>e.move(s,1),style:{"margin-left":"5px"},class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Fe,8,ke)]),e.bot&&e.filteredConfigs[s].type==="channel"?(i(),y(U,{key:0,token:e.bot.bot_token,onCallback:n=>e.addTextTo(s,n)},null,8,["token","onCallback"])):g("",!0),t("div",null,[t("div",we,[t("button",Se,m(e.filteredConfigs[s].type),1),t("ul",Ve,[(i(!0),a(f,null,p(e.configTypes,n=>(i(),a("li",null,[t("a",{class:"dropdown-item",onClick:Pt=>e.filteredConfigs[s].type=n.type},m(n.title||l.type),9,je)]))),256))])])])]),t("div",Oe,[t("div",Ue,[u(t("input",{type:"text",class:"form-control","onUpdate:modelValue":n=>e.filteredConfigs[s].key=n,id:"field-input-key-"+s,placeholder:"name@example.com"},null,8,Pe),[[c,e.filteredConfigs[s].key]]),t("label",{for:"field-input-key-"+s},"Ключ",8,Me)]),e.filteredConfigs[s].type==="text"||e.filteredConfigs[s].type==="channel"?(i(),a("div",Be,[u(t("input",{type:"text",class:"form-control",id:"field-input-"+s,"onUpdate:modelValue":n=>e.filteredConfigs[s].value=n,placeholder:"name@example.com"},null,8,Ie),[[c,e.filteredConfigs[s].value]]),t("label",{for:"field-input-"+s},"Значение",8,Ae)])):g("",!0),e.filteredConfigs[s].type==="boolean"?(i(),a("div",Te,[u(t("input",{class:"form-check-input","onUpdate:modelValue":n=>e.filteredConfigs[s].value=n,type:"checkbox",value:"false",id:"filtered-config-"+s+"-checkbox"},null,8,Ne),[[S,e.filteredConfigs[s].value]]),t("label",{class:"form-check-label",for:"filtered-config-"+s+"-checkbox"},m(e.filteredConfigs[s].value?"Истина":"Ложь"),9,Ge)])):g("",!0),e.filteredConfigs[s].type==="geo"?(i(),a("div",Je,[u(t("input",{class:"form-control",placeholder:"##.######,##.######","onUpdate:modelValue":n=>e.filteredConfigs[s].value=n,type:"text",id:"filtered-config-"+s+"-geo"},null,8,De),[[r,"##.######,##.######"],[c,e.filteredConfigs[s].value]]),t("label",{for:"filtered-config-"+s+"-geo"},"Значение",8,qe)])):g("",!0),e.filteredConfigs[s].type==="phone"?(i(),a("div",Ee,[u(t("input",{class:"form-control",placeholder:"+7(###)###-##-##","onUpdate:modelValue":n=>e.filteredConfigs[s].value=n,type:"text",id:"filtered-config-"+s+"-phone"},null,8,Le),[[r,"+7(###)###-##-##"],[c,e.filteredConfigs[s].value]]),t("label",{for:"filtered-config-"+s+"-phone"},"Значение",8,ze)])):g("",!0),e.filteredConfigs[s].type==="json"?(i(),a("div",He,[Ke,_(V($),{mode:"form",modelValue:e.filteredConfigs[s].value,"onUpdate:modelValue":n=>e.filteredConfigs[s].value=n,"show-btns":!1,expandedOnStart:!0,onJsonChange:n=>e.onJsonChange(n,s)},null,8,["modelValue","onUpdate:modelValue","onJsonChange"])])):g("",!0),e.filteredConfigs[s].type==="color"?(i(),a("div",Qe,[u(t("input",{class:"form-control","onUpdate:modelValue":n=>e.filteredConfigs[s].value=n,type:"color",id:"filtered-config-"+s+"-color"},null,8,Ye),[[c,e.filteredConfigs[s].value]]),t("label",{for:"filtered-config-"+s+"-color"},[t("p",{style:j({color:e.filteredConfigs[s].value})},"Цвет: "+m(e.filteredConfigs[s].value),5)],8,Re)])):g("",!0),e.filteredConfigs[s].type==="large-text"?(i(),a("div",We,[u(t("textarea",{class:"form-control",id:"field-input-"+s,"onUpdate:modelValue":n=>e.filteredConfigs[s].value=n,placeholder:"name@example.com"},`
                            `,8,Xe),[[c,e.filteredConfigs[s].value]]),t("label",{for:"field-input-"+s},"Значение",8,Ze)])):g("",!0),e.filteredConfigs[s].type==="image"?(i(),a("div",xe,[u(t("input",{class:"form-control mb-2",id:"field-input-"+s,type:"text",disabled:"true","onUpdate:modelValue":n=>e.filteredConfigs[s].value=n,placeholder:"name@example.com"},null,8,et),[[c,e.filteredConfigs[s].value]]),t("label",{for:"field-input-"+s},"FileId ссылка на изображение",8,tt),_(W,{"need-video":!1,"need-photo":!0,selected:[e.filteredConfigs[s].value],onSelect:n=>e.selectPhoto(n,s)},null,8,["selected","onSelect"])])):g("",!0)])])]))),256))])):(i(),a("div",ot,lt)),t("button",it,[e.slugForm.id==null?(i(),a("span",nt," Сохранить команду ")):(i(),a("span",at," Обновить команду "))])],32)}}}),rt={class:"row"},ut={class:"col-12"},ct={class:"form-floating mb-3"},gt=t("label",{for:"floatingInput"},"Быстрый поиск команды",-1),mt={key:0,class:"row"},ht={class:"col-12 mb-3"},ft={class:"list-group w-100"},pt=["onClick"],bt={key:0,class:"badge bg-info"},_t=["onClick"],vt=t("i",{class:"fa-solid fa-trash-can"},null,-1),yt=[vt],Ct={class:"col-12"},kt={key:2},$t={class:"card-body"},Ft={class:"mb-3"},wt={class:"form-label",id:"bot-domain"},St=t("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Vt=t("div",null,[h("Измените только текст команды,"),t("br"),h(" если хотите чтоб скрипт вызывался по кнопке из меню. "),t("br"),h(" Или оставьте как есть. "),t("br"),h(" Текст скрипта нужно также указать в качестве пункта меню. ")],-1),jt=t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Ot=["disabled"],Ut={props:["canAdd","bot"],data(){return{search:null,slugs:[],slugs_paginate_object:null,slugForm:{command:null,comment:null,slug:null,config:[],is_global:!0,bot_id:null}}},computed:{...v(["getGlobalSlugs","getGlobalSlugsPaginateObject"])},watch:{search:function(o,e){this.loadAllSlugs()}},mounted(){this.loadAllSlugs()},methods:{loadAllSlugs(o=0){this.$store.dispatch("loadGlobalSlugs",{dataObject:{needGlobal:!0,search:this.search},page:o}).then(e=>{this.slugs=this.getGlobalSlugs,this.slugs_paginate_object=this.getGlobalSlugsPaginateObject})},removeSlug(o){this.$store.dispatch("removeSlug",{dataObject:{slugId:o.id}}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно удалена",type:"success"}),this.loadAllSlugs()}).catch(e=>{this.loadAllSlugs()})},nextSlugs(o){this.loadAllSlugs(o)},selectSlug(o){this.slugForm.id=o.id||null,this.slugForm.slug=o.slug,this.slugForm.comment=o.comment,this.slugForm.command=this.command||o.command,this.slugForm.config=o.config||[],this.slugForm.is_global=o.is_global||!1,this.$emit("select",o)},addSlug(){let o=new FormData;Object.keys(this.slugForm).forEach(e=>{const d=this.slugForm[e]||"";typeof d=="object"?o.append(e,JSON.stringify(d)):o.append(e,d)}),this.bot&&o.append("bot_id",this.bot.id),this.$store.dispatch("createSlug",{slugForm:o}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно обновлена",type:"success"}),this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0,this.$emit("callback")}).catch(e=>{})}}},Tt=Object.assign(Ut,{__name:"GlobalSlugList",setup(o){return(e,d)=>{const r=O("Popper");return i(),a(f,null,[t("div",rt,[t("div",ut,[t("div",ct,[u(t("input",{type:"search","onUpdate:modelValue":d[0]||(d[0]=l=>e.search=l),class:"form-control",id:"floatingInput",placeholder:"Название команды"},null,512),[[c,e.search]]),gt])])]),e.slugs.length>0?(i(),a("div",mt,[t("div",ht,[t("ul",ft,[(i(!0),a(f,null,p(e.slugs,(l,s)=>(i(),a("li",{class:b(["list-group-item cursor-pointer btn mb-1 d-flex align-items-center justify-between",{"btn-outline-info":l.deleted_at==null,"btn-outline-danger border-danger":l.deleted_at!=null}])},[t("strong",{onClick:n=>e.selectSlug(l),style:{"word-wrap":"break-word"}},[t("i",{class:b([{"text-danger":l.deleted_at!=null},"fa-solid fa-scroll"])},null,2),h(" "+m(l.command)+" (",1),t("span",null,m(l.slug),1),h(") ")],8,pt),l.comment?(i(),a("span",bt,m(l.comment||"Пояснение не указано"),1)):g("",!0),t("button",{class:"btn btn-outline-danger",onClick:n=>e.removeSlug(l),type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},yt,8,_t)],2))),256))])]),t("div",Ct,[e.slugs_paginate_object?(i(),y(F,{key:0,onPagination_page:e.nextSlugs,pagination:e.slugs_paginate_object},null,8,["onPagination_page","pagination"])):g("",!0)])])):(i(),a("p",kt,"Глобальных скриптов не обнаружено")),o.canAdd&&e.slugs.length>0?(i(),a("form",{key:3,onSubmit:d[2]||(d[2]=k((...l)=>e.addSlug&&e.addSlug(...l),["prevent"])),class:"card mb-3"},[t("div",$t,[t("div",Ft,[t("label",wt,[_(r,null,{content:C(()=>[Vt]),default:C(()=>[St]),_:1}),h(" Команда "),jt]),u(t("input",{type:"text",class:"form-control",placeholder:"Команда","aria-label":"Команда","onUpdate:modelValue":d[1]||(d[1]=l=>e.slugForm.command=l),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[c,e.slugForm.command]])]),t("button",{disabled:e.slugForm.slug==null,class:"btn btn-outline-success mt-2 mb-2 w-100 p-3"},"Добавить скрипт в бота ",8,Ot)])],32)):g("",!0)],64)}}});export{At as _,Tt as a,W as b};
