import{G as y,L as $,q as i,t as a,v as o,H as r,J as u,F as h,C as p,y as m,D as f,x as v,K as C,A as c,R as S,B as b,u as w,z as V,P as F,Y as U,O as _}from"./index.es-71d37bd0.js";import{T as j}from"./TelegramChannelHelper-864fe219.js";import{_ as O}from"./BotMediaList-53d8d6dc.js";import{V as k}from"./vue3-json-editor.esm.prod-61e9e0df.js";import{P as I}from"./Pagination-c0ff4992.js";const A={class:"form-floating mb-3"},T=o("label",{for:"floatingInput"},"Команда",-1),B={class:"form-floating mb-3"},M=o("label",{for:"floatingInput"},"Мнемоническое имя",-1),P={class:"form-floating mb-3"},G=o("label",{for:"floatingInput"},"Описание скрипта",-1),J=o("h6",null," Параметры скрипта ",-1),N=o("div",{class:"alert alert-info",role:"alert"}," Данные параметры используются для настройки скриптов на стороне сервера ",-1),q={class:"dropdown"},D=o("button",{class:"btn btn-outline-info w-100 dropdown-toggle mb-2",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," Добавить ",-1),E={class:"dropdown-menu w-100"},L=["onClick"],z={class:"row"},H={class:"col-12"},K=["onClick"],R={key:0,class:"row"},Y={class:"col-md-6 mb-1"},Q={class:"card"},W={class:"card-header d-flex justify-content-between align-items-center"},X=["onClick"],Z=o("i",{class:"fa-solid fa-trash-can"},null,-1),x=[Z],ee=["onClick"],oe=o("i",{class:"fa-solid fa-caret-left"},null,-1),te=[oe],le=["onClick"],se=o("i",{class:"fa-solid fa-caret-right"},null,-1),ne=[se],ie={class:"dropdown"},ae={class:"btn btn-outline-info dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},de={class:"dropdown-menu"},re=["onClick"],ue={class:"card-body"},ce={class:"form-floating mb-1"},me=["onUpdate:modelValue","id"],ge=["for"],fe={key:0,class:"form-floating mb-1"},he=["id","onUpdate:modelValue"],pe=["for"],be={key:1,class:"form-check mb-1 mt-2"},_e=["onUpdate:modelValue","id"],ye=["for"],ve={key:2,class:"form-floating mb-1 mt-2"},Ce=["onUpdate:modelValue","id"],Fe=["for"],ke={key:3,class:"form-floating mb-1 mt-2"},$e=["onUpdate:modelValue","id"],Se=["for"],we={key:4,class:"form-floating mb-1 mt-2"},Ve=o("label",{class:"form-label",id:"bot-domain"},"JSON-код",-1),Ue={key:5,class:"form-check mb-1 mt-2"},je=["onUpdate:modelValue","id"],Oe=["for"],Ie={key:6,class:"form-floating mb-3"},Ae=["id","onUpdate:modelValue"],Te=["for"],Be={key:7,class:"form-floating mb-3"},Me=["id","onUpdate:modelValue"],Pe=["for"],Ge={key:1,class:"row"},Je=o("div",{class:"col-12"},[o("p",null,"Параметры скрипта еще не добавлены")],-1),Ne=[Je],qe={class:"btn btn-primary text-white w-100 mt-2 p-3"},De={key:0},Ee={key:1},Le={props:["item"],components:{Vue3JsonEditor:k},data(){return{filters:[],simple:!0,configTypes:[{title:"Текстовый или числовой параметр",type:"text"},{title:"Большое текстовое поле",type:"large-text"},{title:"Канал обратной связи",type:"channel"},{title:"Логический оператор",type:"boolean"},{title:"Ссылка на изображение",type:"image"},{title:"Цвет",type:"color"},{title:"Geo",type:"geo"},{title:"Номер телефона",type:"phone"},{title:"JSON",type:"json"}],bot:null,photos:[],slugForm:{bot_id:null,id:null,command:null,comment:null,slug:null,config:[],is_global:!0}}},computed:{...y(["getCurrentBot"]),filteredConfigs(){return this.filters.length==0?this.slugForm.config:this.slugForm.config.filter(l=>this.filters.indexOf(l.type)>=0)}},mounted(){this.loadCurrentBot(),this.item&&(this.slugForm.id=this.item.id||null,this.slugForm.command=this.item.command,this.slugForm.comment=this.item.comment,this.slugForm.bot_id=this.item.bot_id,this.slugForm.slug=this.item.slug,this.slugForm.config=this.item.config||[],this.slugForm.is_global=this.item.is_global||!1)},methods:{toggleFilter(l){let e=this.filters.indexOf(l);e>=0?this.filters.splice(e,1):this.filters.push(l)},addTextTo(l,e={text:null}){this.slugForm.config[l].value=e.text},loadCurrentBot(l=null){return this.$store.dispatch("updateCurrentBot",{bot:l}).then(()=>{this.bot=this.getCurrentBot})},submit(){let l=new FormData;Object.keys(this.slugForm).forEach(e=>{const d=this.slugForm[e]||"";typeof d=="object"?l.append(e,JSON.stringify(d)):l.append(e,d)}),this.$store.dispatch(this.slugForm.id===null?"createSlug":"updateSlug",{slugForm:l}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно обновлена",type:"success"}),this.slugForm.id===null&&(this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0),this.$emit("callback")}).catch(e=>{})},onJsonChange(l,e){this.filteredConfigs[e].value=l},addConfig(l){this.slugForm.config.splice(0,0,{key:null,value:null,type:l||"text"})},move(l,e=0){let d=this.slugForm.config[l],g=this.slugForm.config.length||0,s=e===0?l-1>=0?l-1:g-1:l<g-1?l+1:0;this.slugForm.config[l]=this.slugForm.config[s],this.slugForm.config[s]=d},removeConfigItem(l){try{this.slugForm.config.splice(l,1)}catch{this.slugForm.config=[]}},selectPhoto(l,e){this.filteredConfigs[e].value=l.file_id}}},ko=Object.assign(Le,{__name:"SlugForm",setup(l){return(e,d)=>{const g=$("mask");return i(),a("form",{onSubmit:d[3]||(d[3]=F((...s)=>e.submit&&e.submit(...s),["prevent"]))},[o("div",A,[r(o("input",{type:"text","onUpdate:modelValue":d[0]||(d[0]=s=>e.slugForm.command=s),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[u,e.slugForm.command]]),T]),o("div",B,[r(o("input",{type:"text","onUpdate:modelValue":d[1]||(d[1]=s=>e.slugForm.slug=s),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[u,e.slugForm.slug]]),M]),o("div",P,[r(o("input",{type:"text","onUpdate:modelValue":d[2]||(d[2]=s=>e.slugForm.comment=s),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[u,e.slugForm.comment]]),G]),J,N,o("div",q,[D,o("ul",E,[(i(!0),a(h,null,p(e.configTypes,(s,t)=>(i(),a("li",null,[o("a",{class:"dropdown-item",onClick:n=>e.addConfig(s.type)},m(s.title||"Не установлен"),9,L)]))),256))])]),o("div",z,[o("div",H,[o("p",null,[f("Фильтры: "),(i(!0),a(h,null,p(e.configTypes,(s,t)=>(i(),a("span",{class:v(["badge mb-1 bg-gray-100 cursor-pointer mr-1",{"bg-info":e.filters.indexOf(s.type)>=0}]),onClick:n=>e.toggleFilter(s.type)},m(s.type),11,K))),256))])])]),e.filteredConfigs.length>0?(i(),a("div",R,[(i(!0),a(h,null,p(e.filteredConfigs,(s,t)=>(i(),a("div",Y,[o("div",Q,[o("div",W,[o("div",null,[o("button",{onClick:n=>e.removeConfigItem(t),class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},x,8,X),o("button",{onClick:n=>e.move(t,0),style:{"margin-left":"5px"},class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},te,8,ee),o("button",{onClick:n=>e.move(t,1),style:{"margin-left":"5px"},class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},ne,8,le)]),e.bot&&e.filteredConfigs[t].type==="channel"?(i(),C(j,{key:0,token:e.bot.bot_token,onCallback:n=>e.addTextTo(t,n)},null,8,["token","onCallback"])):c("",!0),o("div",null,[o("div",ie,[o("button",ae,m(e.filteredConfigs[t].type),1),o("ul",de,[(i(!0),a(h,null,p(e.configTypes,n=>(i(),a("li",null,[o("a",{class:"dropdown-item",onClick:bo=>e.filteredConfigs[t].type=n.type},m(n.title||s.type),9,re)]))),256))])])])]),o("div",ue,[o("div",ce,[r(o("input",{type:"text",class:"form-control","onUpdate:modelValue":n=>e.filteredConfigs[t].key=n,id:"field-input-key-"+t,placeholder:"name@example.com"},null,8,me),[[u,e.filteredConfigs[t].key]]),o("label",{for:"field-input-key-"+t},"Ключ",8,ge)]),e.filteredConfigs[t].type==="text"||e.filteredConfigs[t].type==="channel"?(i(),a("div",fe,[r(o("input",{type:"text",class:"form-control",id:"field-input-"+t,"onUpdate:modelValue":n=>e.filteredConfigs[t].value=n,placeholder:"name@example.com"},null,8,he),[[u,e.filteredConfigs[t].value]]),o("label",{for:"field-input-"+t},"Значение",8,pe)])):c("",!0),e.filteredConfigs[t].type==="boolean"?(i(),a("div",be,[r(o("input",{class:"form-check-input","onUpdate:modelValue":n=>e.filteredConfigs[t].value=n,type:"checkbox",value:"false",id:"filtered-config-"+t+"-checkbox"},null,8,_e),[[S,e.filteredConfigs[t].value]]),o("label",{class:"form-check-label",for:"filtered-config-"+t+"-checkbox"},m(e.filteredConfigs[t].value?"Истина":"Ложь"),9,ye)])):c("",!0),e.filteredConfigs[t].type==="geo"?(i(),a("div",ve,[r(o("input",{class:"form-control",placeholder:"##.######,##.######","onUpdate:modelValue":n=>e.filteredConfigs[t].value=n,type:"text",id:"filtered-config-"+t+"-geo"},null,8,Ce),[[g,"##.######,##.######"],[u,e.filteredConfigs[t].value]]),o("label",{for:"filtered-config-"+t+"-geo"},"Значение",8,Fe)])):c("",!0),e.filteredConfigs[t].type==="phone"?(i(),a("div",ke,[r(o("input",{class:"form-control",placeholder:"+7(###)###-##-##","onUpdate:modelValue":n=>e.filteredConfigs[t].value=n,type:"text",id:"filtered-config-"+t+"-phone"},null,8,$e),[[g,"+7(###)###-##-##"],[u,e.filteredConfigs[t].value]]),o("label",{for:"filtered-config-"+t+"-phone"},"Значение",8,Se)])):c("",!0),e.filteredConfigs[t].type==="json"?(i(),a("div",we,[Ve,b(w(k),{mode:"form",modelValue:e.filteredConfigs[t].value,"onUpdate:modelValue":n=>e.filteredConfigs[t].value=n,"show-btns":!1,expandedOnStart:!0,onJsonChange:n=>e.onJsonChange(n,t)},null,8,["modelValue","onUpdate:modelValue","onJsonChange"])])):c("",!0),e.filteredConfigs[t].type==="color"?(i(),a("div",Ue,[r(o("input",{class:"form-control","onUpdate:modelValue":n=>e.filteredConfigs[t].value=n,type:"color",id:"filtered-config-"+t+"-color"},null,8,je),[[u,e.filteredConfigs[t].value]]),o("label",{for:"filtered-config-"+t+"-color"},[o("p",{style:V({color:e.filteredConfigs[t].value})},"Цвет: "+m(e.filteredConfigs[t].value),5)],8,Oe)])):c("",!0),e.filteredConfigs[t].type==="large-text"?(i(),a("div",Ie,[r(o("textarea",{class:"form-control",id:"field-input-"+t,"onUpdate:modelValue":n=>e.filteredConfigs[t].value=n,placeholder:"name@example.com"},`
                            `,8,Ae),[[u,e.filteredConfigs[t].value]]),o("label",{for:"field-input-"+t},"Значение",8,Te)])):c("",!0),e.filteredConfigs[t].type==="image"?(i(),a("div",Be,[r(o("input",{class:"form-control mb-2",id:"field-input-"+t,type:"text",disabled:"true","onUpdate:modelValue":n=>e.filteredConfigs[t].value=n,placeholder:"name@example.com"},null,8,Me),[[u,e.filteredConfigs[t].value]]),o("label",{for:"field-input-"+t},"FileId ссылка на изображение",8,Pe),b(O,{"need-video":!1,"need-photo":!0,selected:[e.filteredConfigs[t].value],onSelect:n=>e.selectPhoto(n,t)},null,8,["selected","onSelect"])])):c("",!0)])])]))),256))])):(i(),a("div",Ge,Ne)),o("button",qe,[e.slugForm.id==null?(i(),a("span",De," Сохранить команду ")):(i(),a("span",Ee," Обновить команду "))])],32)}}}),ze={class:"row"},He={class:"col-12"},Ke={class:"form-floating mb-3"},Re=o("label",{for:"floatingInput"},"Быстрый поиск команды",-1),Ye={key:0,class:"row"},Qe={class:"col-lg-3 col-md-6 col-12 mb-3"},We=["onClick"],Xe={class:"card-body"},Ze={style:{"word-wrap":"break-word"},class:"mb-0"},xe=o("i",{class:"fa-solid fa-scroll"},null,-1),eo={class:"mb-2"},oo={class:"col-12"},to={key:2},lo={key:3,class:"modal fade",id:"add-slug-to-bot",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},so={class:"modal-dialog"},no={class:"modal-content"},io={class:"modal-body"},ao={class:"mb-3"},ro={class:"form-label",id:"bot-domain"},uo=o("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),co=o("div",null,[f("Измените только текст команды,"),o("br"),f(" если хотите чтоб скрипт вызывался по кнопке из меню. "),o("br"),f(" Или оставьте как есть. "),o("br"),f(" Текст скрипта нужно также указать в качестве пункта меню. ")],-1),mo=o("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),go=o("div",{class:"alert alert-info",role:"alert"}," При добавлении вы можете указать любое имя, которое вам нравится. Не обязательно использовать стандартное. ",-1),fo=["disabled"],ho=o("div",{class:"modal-footer"},[o("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Не добавлять")],-1),po={props:["canAdd","bot","hideAddModal"],data(){return{search:null,slugs:[],slugs_paginate_object:null,addSlugModal:null,slugForm:{command:null,comment:null,slug:null,config:[],is_global:!0,bot_id:null}}},computed:{...y(["getGlobalSlugs","getGlobalSlugsPaginateObject"])},watch:{search:function(l,e){this.loadAllSlugs()}},mounted(){this.loadAllSlugs(),this.addSlugModal=new bootstrap.Modal(document.getElementById("add-slug-to-bot"),{})},methods:{loadAllSlugs(l=0){this.$store.dispatch("loadGlobalSlugs",{dataObject:{needGlobal:!0,search:this.search},page:l}).then(e=>{this.slugs=this.getGlobalSlugs,this.slugs_paginate_object=this.getGlobalSlugsPaginateObject})},removeSlug(l){this.$store.dispatch("removeSlug",{dataObject:{slugId:l.id}}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно удалена",type:"success"}),this.loadAllSlugs()}).catch(e=>{this.loadAllSlugs()})},nextSlugs(l){this.loadAllSlugs(l)},selectSlug(l){this.slugForm.id=l.id||null,this.slugForm.slug=l.slug,this.slugForm.comment=l.comment,this.slugForm.command=this.command||l.command,this.slugForm.config=l.config||[],this.slugForm.is_global=l.is_global||!1,this.$emit("select",l),this.hideAddModal||this.addSlugModal.show()},addSlug(){let l=new FormData;Object.keys(this.slugForm).forEach(e=>{const d=this.slugForm[e]||"";typeof d=="object"?l.append(e,JSON.stringify(d)):l.append(e,d)}),this.bot&&l.append("bot_id",this.bot.id),this.$store.dispatch("createSlug",{slugForm:l}).then(e=>{this.$notify({title:"Скрипты",text:"Скрипт успешно добавлен",type:"success"}),this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0,this.$emit("callback"),this.addSlugModal.hide()}).catch(e=>{})}}},$o=Object.assign(po,{__name:"GlobalSlugList",setup(l){return(e,d)=>{const g=U("Popper");return i(),a(h,null,[o("div",ze,[o("div",He,[o("div",Ke,[r(o("input",{type:"search","onUpdate:modelValue":d[0]||(d[0]=s=>e.search=s),class:"form-control",id:"floatingInput",placeholder:"Название команды"},null,512),[[u,e.search]]),Re])])]),e.slugs.length>0?(i(),a("div",Ye,[(i(!0),a(h,null,p(e.slugs,(s,t)=>(i(),a("div",Qe,[o("div",{class:v(["card",{"btn-outline-info":s.deleted_at==null,"btn-outline-danger border-danger":s.deleted_at!=null}]),style:{"min-height":"160px"},onClick:n=>e.selectSlug(s)},[o("div",Xe,[o("p",Ze,[xe,f(" "+m(s.command),1)]),o("p",eo,[o("small",null,[o("strong",null,[o("em",null,m(s.slug),1)])])]),o("p",null,m(s.comment||"Пояснение не указано"),1)])],10,We)]))),256)),o("div",oo,[e.slugs_paginate_object?(i(),C(I,{key:0,onPagination_page:e.nextSlugs,pagination:e.slugs_paginate_object},null,8,["onPagination_page","pagination"])):c("",!0)])])):(i(),a("p",to,"Глобальных скриптов не обнаружено")),l.canAdd?(i(),a("div",lo,[o("div",so,[o("div",no,[o("div",io,[l.canAdd&&e.slugs.length>0?(i(),a("form",{key:0,onSubmit:d[2]||(d[2]=F((...s)=>e.addSlug&&e.addSlug(...s),["prevent"]))},[o("p",null,"Идентификатор скрипта #"+m(e.slugForm.id||"Не указан"),1),o("div",ao,[o("label",ro,[b(g,null,{content:_(()=>[co]),default:_(()=>[uo]),_:1}),f(" Команда "),mo]),r(o("input",{type:"text",class:"form-control",placeholder:"Команда","aria-label":"Команда","onUpdate:modelValue":d[1]||(d[1]=s=>e.slugForm.command=s),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[u,e.slugForm.command]])]),o("p",null,[o("small",null,[o("em",null,m(e.slugForm.comment||"Не указан"),1)])]),go,o("button",{disabled:e.slugForm.slug==null,class:"btn btn-success mt-2 mb-2 w-100 p-3"},"Добавить скрипт в бота ",8,fo)],32)):c("",!0)]),ho])])])):c("",!0)],64)}}});export{ko as _,$o as a};
