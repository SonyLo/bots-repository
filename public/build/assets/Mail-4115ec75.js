import{S as B,o as n,q as r,t,z as h,D as b,O as C,F as _,B as f,G as y,H as k,v,x as g,T,N as K,C as p,J as V,A as q}from"./index.es-0d0be4b9.js";import{V as U}from"./vue3-json-editor.esm.prod-743a86dd.js";import{_ as M}from"./_plugin-vue_export-helper-c27b6911.js";import{v as F}from"./v4-a960c1f4.js";import{m as S}from"./index-d069a1eb.js";import{T as j}from"./TelegramChannelHelper-bcff88dc.js";const O={props:["editedKeyboard","type"],components:{Vue3JsonEditor:U},computed:{uuid(){return F()}},watch:{keyboard:{handler:function(o){this.save()},deep:!0}},data(){return{showCode:!1,showAssign:!1,selectedRow:null,load:!1,rowCount:1,keyboard:[],select:{row:0,col:0,type:this.type||"reply"}}},mounted(){this.editedKeyboard&&this.$nextTick(()=>{this.keyboard=this.editedKeyboard.menu})},methods:{needRemoveField(o,e,s){Object.keys(this.keyboard[e][s]).forEach(i=>{i!=="text"&&i!==o&&delete this.keyboard[e][s][i]})},save(){this.$emit("save",this.keyboard)},onJsonChange(o){this.keyboard=o,this.save()},removeColFromRow(o){this.keyboard[o].length>1?this.keyboard[o].splice(this.keyboard[o].length-1,1):this.keyboard.splice(o,1),this.keyboard.length===0&&(this.selectedRow=null),this.save()},addRowAbove(){this.addRow(!0)},moveCol(o=0){let e=this.select.row,s=this.select.col,i=this.keyboard[e].length,l=o===0?s-1>=0?s-1:i-1:s<i-1?s+1:0,c=this.keyboard[e][s];this.keyboard[e][s]=this.keyboard[e][l],this.keyboard[e][l]=c,this.select.row=e,this.select.col=l,this.select.text=this.keyboard[e][l].text},moveRow(o=0){if(this.selectedRow==null)return;let e=this.keyboard.length,s=o===0?this.selectedRow-1>=0?this.selectedRow-1:e-1:this.selectedRow<e-1?this.selectedRow+1:0,i=this.keyboard[this.selectedRow];this.keyboard[this.selectedRow]=this.keyboard[s],this.keyboard[s]=i,this.selectedRow=s,console.log("tmpRow",i)},addRowBelow(){this.addRow(!1)},addRow(o=!1){if(this.selectedRow==null)this.keyboard?this.keyboard.push([{text:"No Text"}]):this.keyboard=[[{text:"No Text"}]],this.selectedRow=null;else{let e=o?this.selectedRow:this.selectedRow+1;this.keyboard.splice(e,0,[{text:"No Text"}])}this.save()},addColToRow(o){this.keyboard[o].push({text:"No Text"}),this.save()},selectIndex(o,e){this.selectedRow=o,this.select.row=o,this.select.col=e,this.select.text=this.keyboard[o][e].text,this.load=!0,this.$nextTick(()=>{this.load=!1})},removeCol(o,e){this.keyboard[o].length>1?this.keyboard[o].splice(e,1):this.keyboard.splice(1,1),this.save()}}},N={class:"container"},J={class:"row"},D={class:"col-12 d-flex justify-content-between"},E=t("i",{class:"fa-solid fa-arrows-up-to-line"},null,-1),A=[E],P=t("i",{class:"fa-solid fa-arrows-down-to-line"},null,-1),L=[P],z=t("i",{class:"fa-solid fa-xmark"},null,-1),G=[z],H={class:"d-flex flex-column"},Y={class:"form-check"},Q=["id"],W=["for"],X={class:"col-12"},Z={class:"row"},I={class:"col-2 d-flex justify-content-around p-2"},x=["onClick"],ee=t("i",{class:"fa-solid fa-plus"},null,-1),te=[ee],oe=["onClick"],se=t("i",{class:"fa-solid fa-minus"},null,-1),le=[se],ne=t("i",{class:"fa-solid fa-caret-left"},null,-1),ae=[ne],ie=t("i",{class:"fa-solid fa-caret-right"},null,-1),de=[ie],re={class:"col-10 d-flex justify-content-center p-1"},ce={class:"btn-group dropdown-center w-100 m-1"},he=["onClick","onUpdate:modelValue"],ue=t("button",{type:"button",class:"btn btn-outline-primary dropdown-toggle dropdown-toggle-split","data-bs-toggle":"dropdown","aria-expanded":"false","data-bs-reference":"parent"},[t("span",{class:"visually-hidden"},"Toggle Dropdown")],-1),be={class:"dropdown-menu w-100",style:{"min-width":"350px"}},me={class:"px-4 py-3"},ye=t("div",{class:"alert alert-danger",role:"alert"}," Возможно выбрать только 1 тип действия ",-1),_e={class:"mb-3"},pe=["for"],fe=["onChange","onUpdate:modelValue","id"],ke={class:"mb-3"},ve=["for"],ge=["onChange","onUpdate:modelValue","id"],$e={class:"mb-3"},we=["for"],Ce=["onChange","onUpdate:modelValue","id"],Fe={class:"mb-3"},Re=["for"],Te=["onChange","onUpdate:modelValue","id"],Ke={class:"form-check"},Se=["onChange","id"],Be=["for"],Ve={key:0,class:"form-check"},qe=["onChange","onClick","id"],Ue=["for"],Me={class:"form-check"},je=["onChange","onClick","id"],Oe=["for"],Ne={class:"form-check"},Je=["onChange","onClick","id"],De=["for"],Ee={key:0,class:"row"},Ae={class:"col-12"},Pe=t("label",{class:"form-label",id:"bot-domain"},"JSON-код клавиатуры",-1);function Le(o,e,s,i,l,c){const w=B("Vue3JsonEditor");return n(),r("div",N,[t("div",J,[t("div",D,[t("div",null,[l.selectedRow==null?(n(),r("button",{key:0,type:"button",class:"btn btn-primary mb-2",onClick:e[0]||(e[0]=(...m)=>c.addRow&&c.addRow(...m))},"Добавить строку ")):h("",!0),l.selectedRow!=null?(n(),r("button",{key:1,type:"button",class:"btn btn-primary mb-2",onClick:e[1]||(e[1]=(...m)=>c.addRowAbove&&c.addRowAbove(...m))},"Добавить строку выше ")):h("",!0),l.selectedRow!=null?(n(),r("button",{key:2,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:e[2]||(e[2]=(...m)=>c.addRowBelow&&c.addRowBelow(...m))},"Добавить строку ниже ")):h("",!0),l.selectedRow!=null?(n(),r("button",{key:3,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:e[3]||(e[3]=m=>c.moveRow(0))},A)):h("",!0),l.selectedRow!=null?(n(),r("button",{key:4,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:e[4]||(e[4]=m=>c.moveRow(1))},L)):h("",!0),l.selectedRow!=null?(n(),r("button",{key:5,type:"button",class:"btn btn-outline-danger mb-2 ml-2",onClick:e[5]||(e[5]=m=>l.selectedRow=null)},G)):h("",!0)]),t("div",H,[t("div",Y,[b(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=m=>l.showCode=m),id:"showCode"+c.uuid},null,8,Q),[[C,l.showCode]]),t("label",{class:"form-check-label",for:"showCode"+c.uuid}," Отобразить код ",8,W)])])]),t("div",X,[(n(!0),r(_,null,f(l.keyboard,(m,a)=>(n(),r("div",Z,[t("div",I,[t("button",{type:"button",class:"btn btn-link w-100",onClick:$=>c.addColToRow(a)},te,8,x),t("button",{type:"button",class:"btn btn-link w-100",onClick:$=>c.removeColFromRow(a)},le,8,oe),t("button",{type:"button",class:"btn btn-link w-100",onClick:e[7]||(e[7]=$=>c.moveCol(0))},ae),t("button",{type:"button",class:"btn btn-link w-100",onClick:e[8]||(e[8]=$=>c.moveCol(1))},de)]),t("div",re,[(n(!0),r(_,null,f(m,($,d)=>(n(),r("div",ce,[b(t("input",{type:"text",onClick:u=>c.selectIndex(a,d),class:"btn btn-outline-primary w-100","onUpdate:modelValue":u=>l.keyboard[a][d].text=u},null,8,he),[[y,l.keyboard[a][d].text]]),ue,t("ul",be,[t("form",me,[ye,t("div",_e,[t("label",{for:"command-row-"+a+"-col-"+d,class:"form-label"},"Команда (для меню в сообщении)",8,pe),b(t("input",{type:"text",onChange:u=>c.needRemoveField("callback_data",a,d),"onUpdate:modelValue":u=>l.keyboard[a][d].callback_data=u,class:"form-control",id:"command-row-"+a+"-col-"+d,placeholder:"/start"},null,40,fe),[[y,l.keyboard[a][d].callback_data]])]),t("div",ke,[t("label",{for:"switch-inline-query-row-"+a+"-col-"+d,class:"form-label"},"Ссылка на аккаунт в ТЕЛЕГРАММ",8,ve),b(t("input",{type:"text",class:"form-control",onChange:u=>c.needRemoveField("switch_inline_query",a,d),"onUpdate:modelValue":u=>l.keyboard[a][d].switch_inline_query=u,id:"switch-inline-query-row-"+a+"-col-"+d,placeholder:"@YourAccountLink"},null,40,ge),[[y,l.keyboard[a][d].switch_inline_query]])]),t("div",$e,[t("label",{for:"url-row-"+a+"-col-"+d,class:"form-label"},"Внешняя URL-ссылка",8,we),b(t("input",{type:"text",class:"form-control",onChange:u=>c.needRemoveField("url",a,d),"onUpdate:modelValue":u=>l.keyboard[a][d].url=u,id:"url-row-"+a+"-col-"+d,placeholder:"https://t.me/example"},null,40,Ce),[[y,l.keyboard[a][d].url]])]),t("div",Fe,[t("label",{for:"switch-inline-query-current-chat-row-"+a+"-col-"+d,class:"form-label"},"Команда всплывающего меню бота",8,Re),b(t("input",{type:"text",class:"form-control",onChange:u=>c.needRemoveField("switch_inline_query_current_chat",a,d),"onUpdate:modelValue":u=>l.keyboard[a][d].switch_inline_query_current_chat=u,id:"witch-inline-query-current-chat-row-"+a+"-col-"+d,placeholder:"команда"},null,40,Te),[[y,l.keyboard[a][d].switch_inline_query_current_chat]])]),t("div",Ke,[t("input",{type:"radio",onChange:u=>c.needRemoveField(null,a,d),name:"request-radio",class:"form-check-input",id:"no-action-row-"+a+"-col-"+d},null,40,Se),t("label",{class:"form-check-label",for:"no-action-row-"+a+"-col-"+d}," Без действий ",8,Be)]),a===0?(n(),r("div",Ve,[t("input",{type:"radio",onChange:u=>c.needRemoveField("pay",a,d),onClick:u=>l.keyboard[a][d].pay=!0,name:"request-radio",class:"form-check-input",id:"pay-action-row-"+a+"-col-"+d},null,40,qe),t("label",{class:"form-check-label",for:"pay-action-row-"+a+"-col-"+d}," Кнопка оплаты ",8,Ue)])):h("",!0),t("div",Me,[t("input",{type:"radio",onChange:u=>c.needRemoveField("request_contact",a,d),onClick:u=>l.keyboard[a][d].request_contact=!0,name:"request-radio",class:"form-check-input",id:"phone-row-"+a+"-col-"+d},null,40,je),t("label",{class:"form-check-label",for:"phone-row-"+a+"-col-"+d}," Запросить телефон (для нижнего меню) ",8,Oe)]),t("div",Ne,[t("input",{type:"radio",name:"request-radio",onChange:u=>c.needRemoveField("request_location",a,d),onClick:u=>l.keyboard[a][d].request_location=!0,class:"form-check-input",id:"location-row-"+a+"-col-"+d},null,40,Je),t("label",{class:"form-check-label",for:"location-row-"+a+"-col-"+d}," Запросить локацию (для нижнего меню) ",8,De)])])])]))),256))])]))),256))])]),l.showCode?(n(),r("div",Ee,[t("div",Ae,[Pe,l.load?h("",!0):(n(),k(w,{key:0,mode:"code",modelValue:l.keyboard,"onUpdate:modelValue":e[9]||(e[9]=m=>l.keyboard=m),"show-btns":!1,expandedOnStart:!0,onJsonChange:c.onJsonChange},null,8,["modelValue","onJsonChange"]))])])):h("",!0)])}const R=M(O,[["render",Le]]);const ze={class:"card"},Ge={key:0,class:"card-header d-flex justify-content-between align-items-center"},He=["disabled"],Ye=t("i",{class:"fa-solid fa-arrow-left"},null,-1),Qe=[Ye],We=["data-bs-target","disabled"],Xe=t("i",{class:"fa-regular fa-pen-to-square"},null,-1),Ze=[Xe],Ie=["disabled"],xe=t("i",{class:"fa-regular fa-floppy-disk"},null,-1),et=[xe],tt={key:1,class:"card-header d-flex justify-content-between align-items-center"},ot={class:"mr-2"},st=["data-bs-target","disabled"],lt=t("i",{class:"fa-regular fa-pen-to-square"},null,-1),nt=[lt],at=["disabled"],it=t("i",{class:"fa-regular fa-clone"},null,-1),dt=[it],rt=["disabled"],ct=t("i",{class:"fa-regular fa-floppy-disk"},null,-1),ht=[ct],ut=["disabled"],bt=t("i",{class:"fa-solid fa-trash-can"},null,-1),mt=[bt],yt={class:"card-body"},_t={key:0,class:"row"},pt={class:"col-md-6 col-12"},ft={class:"mb-3"},kt=t("label",{class:"form-label",id:"bot-domain"},"Тип",-1),vt=t("option",{value:"reply"},"Нижняя клавиатура",-1),gt=t("option",{value:"inline"},"Встроенная клавиатура",-1),$t=[vt,gt],wt={class:"col-md-6 col-12"},Ct={class:"mb-3"},Ft=t("label",{class:"form-label",id:"bot-domain"},"Мнемоническое имя",-1),Rt={class:"row"},Tt={class:"col-12"},Kt={class:"row"},St={class:"col-12"},Bt={class:"row"},Vt={class:"col"},qt={type:"button",class:"btn btn-outline-primary w-100 mb-2"},Ut=["id"],Mt={class:"modal-dialog modal-fullscreen"},jt={class:"modal-content"},Ot=t("div",{class:"modal-header"},[t("h1",{class:"modal-title fs-5",id:"open-construct-label"},"Визуальный редактор клавиатуры"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Nt={class:"modal-body"},Jt=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),Dt={props:["keyboard","selectMode"],data:()=>({is_edited:!1,load:!1,keyboardForm:null}),computed:{uuid(){return F()}},watch:{keyboardForm:{handler(o){this.is_edited=!0},deep:!0}},mounted(){const o=this.keyboard;this.keyboardForm=o,this.$nextTick(()=>{this.is_edited=!1})},methods:{removeKeyboard(){this.$store.dispatch("removeKeyboardTemplate",{templateId:this.keyboardForm.id}).then(o=>{this.load=!0,this.$nextTick(()=>{this.load=!1}),this.$emit("callback",this.keyboardForm.id)}).catch(()=>{this.$emit("callback",this.keyboardForm.id)})},saveKeyboard(o){this.keyboardForm.menu=o},selectCard(){this.$emit("select",this.keyboardForm)},duplicateKeyboard(){let o=new FormData;Object.keys(this.keyboardForm).forEach(e=>{const s=this.keyboardForm[e]||"";typeof s=="object"?o.append(e,JSON.stringify(s)):o.append(e,s)}),this.$store.dispatch("createKeyboardTemplate",{keyboardForm:o}).then(e=>{this.$notify({title:"Конструктор ботов",text:"Меню успешно продублировано!",type:"success"}),this.load=!0,this.$nextTick(()=>{this.load=!1}),this.$emit("reload")})},updateKeyboard(){let o=new FormData;Object.keys(this.keyboardForm).forEach(e=>{const s=this.keyboardForm[e]||"";typeof s=="object"?o.append(e,JSON.stringify(s)):o.append(e,s)}),this.$store.dispatch("editKeyboardTemplate",{keyboardForm:o}).then(e=>{this.load=!0,this.$nextTick(()=>{this.load=!1,this.is_edited=!1}),this.$emit("callback")}).catch(()=>{this.is_edited=!0})}}},Et=Object.assign(Dt,{__name:"KeyboardCard",setup(o){return(e,s)=>(n(),r(_,null,[t("div",ze,[o.selectMode?(n(),r("div",Ge,[t("div",null,[t("button",{onClick:s[0]||(s[0]=(...i)=>e.selectCard&&e.selectCard(...i)),disabled:e.load,type:"button",class:"btn btn-outline-success mr-2"},Qe,8,He),t("button",{"data-bs-toggle":"modal","data-bs-target":"#open-construct-"+e.uuid,disabled:e.load,type:"button",title:"Редактировать клавиатуру",class:"btn btn-outline-success mr-2"},Ze,8,We),t("button",{onClick:s[1]||(s[1]=(...i)=>e.updateKeyboard&&e.updateKeyboard(...i)),type:"button",title:"Обновить клавиатуру",disabled:e.load||!e.is_edited,class:v(["btn btn-outline-primary mr-2",{"have-change":e.is_edited}])},et,10,Ie)])])):h("",!0),o.selectMode?h("",!0):(n(),r("div",tt,[t("div",null,[t("strong",ot,"#"+g(o.keyboard.id),1),t("button",{"data-bs-toggle":"modal","data-bs-target":"#open-construct-"+e.uuid,disabled:e.load,type:"button",title:"Редактировать клавиатуру",class:"btn btn-outline-success mr-2"},nt,8,st),t("button",{onClick:s[2]||(s[2]=(...i)=>e.duplicateKeyboard&&e.duplicateKeyboard(...i)),type:"button",title:"Дублировать клавиатуру",disabled:e.load,class:"btn btn-outline-primary mr-2"},dt,8,at),t("button",{onClick:s[3]||(s[3]=(...i)=>e.updateKeyboard&&e.updateKeyboard(...i)),type:"button",title:"Обновить клавиатуру",disabled:e.load||!e.is_edited,class:v(["btn btn-outline-primary mr-2",{"have-change":e.is_edited}])},ht,10,rt)]),t("button",{onClick:s[4]||(s[4]=(...i)=>e.removeKeyboard&&e.removeKeyboard(...i)),type:"button",disabled:e.load,title:"Удалить клавиатуру",class:"btn btn-outline-danger mr-2"},mt,8,ut)])),t("div",yt,[o.selectMode?h("",!0):(n(),r("div",_t,[t("div",pt,[t("div",ft,[kt,b(t("select",{disabled:!0,"onUpdate:modelValue":s[5]||(s[5]=i=>o.keyboard.type=i),class:"form-control"},$t,512),[[T,o.keyboard.type]])])]),t("div",wt,[t("div",Ct,[Ft,b(t("input",{type:"text",class:"form-control",placeholder:"Мнемоническое имя",disabled:!0,"aria-label":"Мнемоническое имя","onUpdate:modelValue":s[6]||(s[6]=i=>o.keyboard.slug=i),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[y,o.keyboard.slug]])])])])),t("div",Rt,[t("div",Tt,[t("div",Kt,[t("div",St,[(n(!0),r(_,null,f(o.keyboard.menu,(i,l)=>(n(),r("div",Bt,[(n(!0),r(_,null,f(i,(c,w)=>(n(),r("div",Vt,[t("button",qt,g(c.text),1)]))),256))]))),256))])])])])])]),t("div",{class:"modal fade",id:"open-construct-"+e.uuid,tabindex:"-1","aria-labelledby":"open-construct-label","aria-hidden":"true"},[t("div",Mt,[t("div",jt,[Ot,t("div",Nt,[e.keyboardForm?(n(),k(R,{key:0,onSave:e.saveKeyboard,"edited-keyboard":e.keyboardForm},null,8,["onSave","edited-keyboard"])):h("",!0)]),Jt])])],8,Ut)],64))}}),At={key:0,class:"row mb-2"},Pt={class:"col-12"},Lt={class:"card"},zt=t("div",{class:"card-header"},[t("h6",null,"Форма создания шаблона клавиатуры")],-1),Gt={class:"card-body"},Ht={class:"col-md-6 col-12"},Yt={class:"mb-3"},Qt=t("label",{class:"form-label",id:"bot-domain"},"Тип",-1),Wt=t("option",{value:"reply"},"Нижняя клавиатура",-1),Xt=t("option",{value:"inline"},"Встроенная клавиатура",-1),Zt=[Wt,Xt],It={class:"col-md-6 col-12"},xt={class:"mb-3"},eo={class:"form-label d-flex justify-content-between",id:"bot-domain"},to=t("span",null,"Мнемоническое имя",-1),oo=t("i",{class:"fa-solid fa-arrows-rotate"},null,-1),so=[oo],lo={class:"col-12"},no=t("div",{class:"col-12"},[t("button",{class:"btn btn-outline-success w-100 p-3"}," Добавить новый шаблон клавиатуры ")],-1),ao={class:"row"},io={key:0,class:"col-12"},ro={class:"badge bg-warning"},co={class:"col-12 mb-3"},ho={key:1,class:"card"},uo={class:"card-body"},bo={key:2,class:"col-12 mb-3"},mo=t("div",{class:"alert alert-warning",role:"alert"},[t("p",null,"Список шаблонов клавиатур пуст!")],-1),yo=[mo],_o={props:["selectMode","type"],data(){return{keyboards:[],load:!1,bot:null,editedKeyboard:null,selectMenuIndex:null,keyboardForm:{type:"reply",bot_id:null,slug:null,menu:[]}}},computed:{...S(["getCurrentBot"]),filteredKeyboard(){return this.type?this.keyboards.filter(o=>o.type==this.type):this.keyboards}},mounted(){this.loadCurrentBot().then(()=>{this.loadMenusByBotTemplate(),this.generateSlug()})},methods:{selectCard(o){this.$emit("select",o)},keyboardCallbackAction(o){let e=this.keyboards.find(s=>s.id===o);e.deleted_at=new Date,this.loadMenusByBotTemplate()},loadMenusByBotTemplate(){this.$store.dispatch("loadBotKeyboards",{botId:this.bot.id}).then(o=>{this.keyboards=o.data})},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},submitKeyboard(){this.keyboardForm.bot_id=this.bot.id;let o=new FormData;Object.keys(this.keyboardForm).forEach(e=>{const s=this.keyboardForm[e]||"";typeof s=="object"?o.append(e,JSON.stringify(s)):o.append(e,s)}),this.$store.dispatch("createKeyboardTemplate",{keyboardForm:o}).then(e=>{this.keyboardForm={type:"reply",bot_id:null,slug:null,menu:[]},this.load=!0,this.$nextTick(()=>{this.load=!1}),this.loadMenusByBotTemplate()})},generateSlug(){this.keyboardForm.slug=F()},changeKeyboardFormMenu(o){this.keyboardForm.menu=o}}},po=Object.assign(_o,{__name:"KeyboardList",setup(o){return(e,s)=>(n(),r(_,null,[o.selectMode?h("",!0):(n(),r("div",At,[t("div",Pt,[t("div",Lt,[zt,t("div",Gt,[t("form",{onSubmit:s[3]||(s[3]=K((...i)=>e.submitKeyboard&&e.submitKeyboard(...i),["prevent"])),class:"row"},[t("div",Ht,[t("div",Yt,[Qt,b(t("select",{"onUpdate:modelValue":s[0]||(s[0]=i=>e.keyboardForm.type=i),class:"form-control"},Zt,512),[[T,e.keyboardForm.type]])])]),t("div",It,[t("div",xt,[t("label",eo,[to,t("a",{onClick:s[1]||(s[1]=(...i)=>e.generateSlug&&e.generateSlug(...i)),href:"#generate"},so)]),b(t("input",{type:"text",class:"form-control",placeholder:"Мнемоническое имя","aria-label":"Мнемоническое имя","onUpdate:modelValue":s[2]||(s[2]=i=>e.keyboardForm.slug=i),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[y,e.keyboardForm.slug]])])]),t("div",lo,[e.load?h("",!0):(n(),k(R,{key:0,onSave:e.changeKeyboardFormMenu,"edited-keyboard":e.keyboardForm},null,8,["onSave","edited-keyboard"]))]),no],32)])])])])),t("div",ao,[e.keyboards&&e.bot?(n(),r("div",io,[t("p",null,[p("В списке клавиатур "),t("span",ro,g(e.filteredKeyboard.length)+" ед.",1)])])):h("",!0),e.keyboards&&e.bot?(n(!0),r(_,{key:1},f(e.filteredKeyboard,(i,l)=>(n(),r("div",co,[i.deleted_at?(n(),r("div",ho,[t("div",uo,[t("p",null,"Удаленная клавиатура #"+g(i.id),1)])])):(n(),k(Et,{key:0,"select-mode":o.selectMode,onSelect:e.selectCard,onReload:e.loadMenusByBotTemplate,onCallback:e.keyboardCallbackAction,keyboard:i},null,8,["select-mode","onSelect","onReload","onCallback","keyboard"]))]))),256)):h("",!0),e.filteredKeyboard.length===0?(n(),r("div",bo,yo)):h("",!0)])],64))}}),fo={class:"col-md-12 col-12"},ko={class:"mb-3"},vo=t("i",{class:"fa-solid fa-xmark"},null,-1),go=[vo],$o={class:"mb-3"},wo={class:"d-flex justify-content-between flex-wrap al"},Co=t("label",{class:"form-label",id:"bot-main-channel"},"Канал для постов (id,рекламный)",-1),Fo={class:"d-flex flex-wrap align-items-center"},Ro=t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),To={class:"col-12 mb-2"},Ko=t("label",{class:"form-label d-flex justify-content-between align-items-center mb-2",id:"bot-domain"},[p(" Текстовое содержимое страницы "),t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),So={class:"form-floating"},Bo={for:"floatingTextarea2"},Vo={key:0},qo={class:"col-12 mb-2"},Uo={class:"form-check"},Mo=t("label",{class:"form-check-label",for:"need-page-images"}," Изображения на странице (максимум 10) ",-1),jo={key:0,class:"col-12 mb-2"},Oo={class:"card mb-3"},No=t("div",{class:"card-header"},[t("h6",null,"Изображения на странице")],-1),Jo={class:"card-body d-flex justify-content-start"},Do={for:"photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},Eo={class:"row"},Ao={key:0,class:"col-12 d-flex flex-wrap"},Po={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Lo={class:"remove"},zo=["onClick"],Go={class:"col-12 mb-2"},Ho={class:"form-check"},Yo=t("label",{class:"form-check-label",for:"need-inline-menu"}," Меню под текстом страницы ",-1),Qo={key:1,class:"col-12 mb-2"},Wo={class:"card"},Xo={class:"card-header d-flex justify-between align-items-center"},Zo=t("h6",null,"Конструктор меню в сообщении",-1),Io={key:0},xo={key:1},es={class:"card-body"},ts=t("div",{class:"col-12"},[t("button",{type:"submit",class:"btn btn-success w-100 p-3"}," Отправить сообщение в канал ")],-1),os={data(){return{load:!1,photos:[],showInlineTemplateSelector:!1,need_page_images:!1,need_inline_menu:!1,bot:null,mailForm:{text:"",inline_keyboard:null,channel:null}}},computed:{...S(["getCurrentBot"])},mounted(){this.loadCurrentBot()},methods:{addTextTo(o={param:null,text:null}){this.mailForm.channel=o.text},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},submitMail(){let o=new FormData;if(Object.keys(this.mailForm).forEach(e=>{const s=this.mailForm[e]||"";typeof s=="object"?o.append(e,JSON.stringify(s)):o.append(e,s)}),this.bot&&o.append("bot_id",this.bot.id),this.photos.length>0)for(let e=0;e<this.photos.length;e++)o.append("photos[]",this.photos[e]);this.$store.dispatch("sendToChannel",{mailForm:o}).then(e=>{this.load=!0,this.photos=[],this.need_inline_menu=!1,this.need_page_images=!1,this.mailForm={text:"",channel:null,inline_keyboard:null},this.$notify({title:"Конструктор ботов",text:"Сообщение успещно отправлено!",type:"success"})}).catch(e=>{})},saveInlineKeyboard(o){this.mailForm.inline_keyboard=o},selectInlineKeyboard(o){this.mailForm.inline_keyboard=o,this.showInlineTemplateSelector=!1},getPhoto(o){return{imageUrl:URL.createObjectURL(o)}},removePhoto(o){this.photos.splice(o,1)},removeImage(o){this.mailForm.images.splice(o,1)},onChangePhotos(o){const e=o.target.files;for(let s=0;s<e.length;s++)this.photos.push(e[s])}}},rs=Object.assign(os,{__name:"Mail",setup(o){return(e,s)=>{const i=V("lazy");return e.bot?(n(),r("form",{key:0,onSubmit:s[9]||(s[9]=K((...l)=>e.submitMail&&e.submitMail(...l),["prevent"]))},[t("div",fo,[t("div",ko,[e.mailForm.channel!=null?(n(),r("button",{key:0,type:"button",class:"btn btn-outline-info",onClick:s[0]||(s[0]=l=>e.mailForm.channel=null)},go)):h("",!0),p(" , "),t("button",{type:"button",class:v(["btn",{"btn-info":e.mailForm.channel===e.bot.main_channel,"btn-outline-info":e.mailForm.channel!==e.bot.main_channel}]),onClick:s[1]||(s[1]=l=>e.mailForm.channel=e.bot.main_channel)},"Главный канал ",2),p(" , "),t("button",{type:"button",class:v(["btn",{"btn-info":e.mailForm.channel===e.bot.order_channel,"btn-outline-info":e.mailForm.channel!==e.bot.order_channel}]),onClick:s[2]||(s[2]=l=>e.mailForm.channel=e.bot.order_channel)},"Канал заказов ",2)]),t("div",$o,[t("div",wo,[Co,t("div",Fo,[q(j,{token:e.bot.bot_token,param:"channel",onCallback:e.addTextTo},null,8,["token","onCallback"]),Ro])]),b(t("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":s[3]||(s[3]=l=>e.mailForm.channel=l),maxlength:"255","aria-describedby":"bot-main-channel",required:""},null,512),[[y,e.mailForm.channel]])])]),t("div",To,[Ko,t("div",So,[b(t("textarea",{class:"form-control","onUpdate:modelValue":s[4]||(s[4]=l=>e.mailForm.text=l),maxlength:"4096",placeholder:"Введите текст",id:"floatingTextarea2",style:{"min-height":"100px"},required:""},null,512),[[y,e.mailForm.text]]),t("label",Bo,[p("Содержимое страницы "),e.mailForm.text?(n(),r("span",Vo,g(e.mailForm.text.length)+"/4096 ",1)):h("",!0)])])]),t("div",qo,[t("div",Uo,[b(t("input",{class:"form-check-input","onUpdate:modelValue":s[5]||(s[5]=l=>e.need_page_images=l),type:"checkbox",id:"need-page-images"},null,512),[[C,e.need_page_images]]),Mo])]),e.need_page_images?(n(),r("div",jo,[t("div",Oo,[No,t("div",Jo,[t("label",Do,[p(" + "),t("input",{type:"file",id:"photos",multiple:"",accept:"image/*",onChange:s[6]||(s[6]=(...l)=>e.onChangePhotos&&e.onChangePhotos(...l)),style:{display:"none"}},null,32)]),t("div",Eo,[e.photos.length>0?(n(),r("div",Ao,[(n(!0),r(_,null,f(e.photos,(l,c)=>(n(),r("div",Po,[b(t("img",null,null,512),[[i,e.getPhoto(l).imageUrl]]),t("div",Lo,[t("a",{onClick:w=>e.removePhoto(c)},"Удалить",8,zo)])]))),256))])):h("",!0)])])])])):h("",!0),t("div",Go,[t("div",Ho,[b(t("input",{class:"form-check-input","onUpdate:modelValue":s[7]||(s[7]=l=>e.need_inline_menu=l),type:"checkbox",id:"need-inline-menu"},null,512),[[C,e.need_inline_menu]]),Yo])]),e.need_inline_menu?(n(),r("div",Qo,[t("div",Wo,[t("div",Xo,[Zo,t("button",{class:v(["btn",{"btn-outline-primary":!e.showInlineTemplateSelector,"btn-primary":e.showInlineTemplateSelector}]),type:"button",onClick:s[8]||(s[8]=l=>e.showInlineTemplateSelector=!e.showInlineTemplateSelector)},[e.showInlineTemplateSelector?(n(),r("span",xo," Скрыть шаблоны меню")):(n(),r("span",Io," Открыть шаблоны меню"))],2)]),t("div",es,[e.showInlineTemplateSelector?(n(),k(po,{key:0,class:"mb-2",type:"inline",onSelect:e.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(n(),k(R,{key:1,type:"inline",onSave:e.saveInlineKeyboard,"edited-keyboard":e.mailForm.inline_keyboard},null,8,["onSave","edited-keyboard"]))])])])):h("",!0),ts],32)):h("",!0)}}});export{R as B,po as _,rs as a};
