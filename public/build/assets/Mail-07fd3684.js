import{Y as S,q as i,t as d,v as t,A as h,H as u,Q as w,F as _,C as k,J as y,K as f,x as p,y as g,X as K,G as T,P as V,D as C,L as B,B as U}from"./index.es-77235f88.js";import{V as M,T as j}from"./TelegramChannelHelper-587b5dac.js";import{_ as q}from"./_plugin-vue_export-helper-c27b6911.js";import{v as F}from"./v4-a960c1f4.js";const O={props:["editedKeyboard","type"],components:{Vue3JsonEditor:M},computed:{uuid(){return F()}},watch:{keyboard:{handler:function(o){this.save()},deep:!0}},data(){return{editor:!1,showCode:!1,showAssign:!1,selectedRow:null,load:!1,rowCount:1,keyboard:[],select:{row:0,col:0,type:this.type||"reply"}}},mounted(){this.editedKeyboard&&this.$nextTick(()=>{this.keyboard=this.editedKeyboard.menu})},methods:{needRemoveField(o,e,s){Object.keys(this.keyboard[e][s]).forEach(n=>{n!=="text"&&n!==o&&delete this.keyboard[e][s][n]})},save(){this.$emit("save",this.keyboard)},onJsonChange(o){this.keyboard=o,this.save()},removeColFromRow(o){this.keyboard[o].length>1?this.keyboard[o].splice(this.keyboard[o].length-1,1):this.keyboard.splice(o,1),this.keyboard.length===0&&(this.selectedRow=null),this.save()},addRowAbove(){this.addRow(!0)},moveCol(o,e=0){o!==this.select.row&&(this.select.row=o,this.select.col=0,this.select.text=this.keyboard[this.select.row][this.select.col].text);let s=this.select.row,n=this.select.col,l=this.keyboard[s].length,c=e===0?n-1>=0?n-1:l-1:n<l-1?n+1:0,v=this.keyboard[s][n];this.keyboard[s][n]=this.keyboard[s][c],this.keyboard[s][c]=v,this.select.row=s,this.select.col=c,this.select.text=this.keyboard[s][c].text},moveRow(o=0){if(this.selectedRow==null)return;let e=this.keyboard.length,s=o===0?this.selectedRow-1>=0?this.selectedRow-1:e-1:this.selectedRow<e-1?this.selectedRow+1:0,n=this.keyboard[this.selectedRow];this.keyboard[this.selectedRow]=this.keyboard[s],this.keyboard[s]=n,this.selectedRow=s},addRowBelow(){this.addRow(!1)},addRow(o=!1){if(this.selectedRow==null)this.keyboard?this.keyboard.push([{text:"No Text"}]):this.keyboard=[[{text:"No Text"}]],this.selectedRow=null;else{let e=o?this.selectedRow:this.selectedRow+1;this.keyboard.splice(e,0,[{text:"No Text"}])}this.save()},addColToRow(o){this.keyboard[o].push({text:"No Text"}),this.save()},selectIndex(o,e){this.selectedRow=o,this.select.row=o,this.select.col=e,this.select.text=this.keyboard[o][e].text||"",this.load=!0,this.$nextTick(()=>{this.load=!1})},removeCol(o,e){this.keyboard[o].length>1?this.keyboard[o].splice(e,1):this.keyboard.splice(1,1),this.save()}}},J={key:0,class:"container"},N={class:"row"},A={class:"col-12 d-flex justify-content-between"},D=t("i",{class:"fa-solid fa-arrows-up-to-line"},null,-1),E=[D],L=t("i",{class:"fa-solid fa-arrows-down-to-line"},null,-1),P=[L],z=t("i",{class:"fa-solid fa-xmark"},null,-1),G=[z],H={class:"d-flex flex-column"},Y={class:"form-check"},Q=["id"],X=["for"],W={key:0,class:"col-12"},Z={class:"row"},I={class:"col-2 d-flex justify-content-around p-2"},x=["onClick"],ee=t("i",{class:"fa-solid fa-plus"},null,-1),te=[ee],oe=["onClick"],se=t("i",{class:"fa-solid fa-minus"},null,-1),le=[se],ie=["onClick"],ne=t("i",{class:"fa-solid fa-caret-left"},null,-1),ae=[ne],de=["onClick"],re=t("i",{class:"fa-solid fa-caret-right"},null,-1),ce=[re],he={class:"col-10 d-flex justify-content-center p-1"},be={class:"btn-group dropdown-center w-100 m-1"},ue=["onClick","onUpdate:modelValue"],me=["data-bs-target"],ye=t("i",{class:"fa-solid fa-bars"},null,-1),_e=[ye],pe=["id"],ke={class:"modal-dialog"},fe={class:"modal-content"},ve={class:"modal-body"},ge={class:"px-4 py-3"},$e=t("div",{class:"alert alert-danger",role:"alert"}," Возможно выбрать только 1 тип действия ",-1),Ce={class:"mb-3"},we=["for"],Fe=["id","onUpdate:modelValue"],Re=t("hr",null,null,-1),Ke={class:"mb-3"},Te=["for"],Ve=["onChange","onUpdate:modelValue","id"],Se={class:"mb-3"},Be=["for"],Ue=["onChange","onUpdate:modelValue","id"],Me={class:"mb-3"},je=["for"],qe=["onChange","onUpdate:modelValue","id"],Oe={class:"mb-3"},Je=["for"],Ne=["onChange","onUpdate:modelValue","id"],Ae={class:"form-check"},De=["onChange","id"],Ee=["for"],Le={class:"form-check"},Pe=["onChange","onClick","id"],ze=["for"],Ge={class:"form-check"},He=["onChange","onClick","id"],Ye=["for"],Qe={key:0,class:"row"},Xe={class:"col-12"},We=t("label",{class:"form-label",id:"bot-domain"},"JSON-код клавиатуры",-1);function Ze(o,e,s,n,l,c){const v=S("Vue3JsonEditor");return l.editor?h("",!0):(i(),d("div",J,[t("div",N,[t("div",A,[t("div",null,[l.selectedRow==null?(i(),d("button",{key:0,type:"button",class:"btn btn-primary mb-2",onClick:e[0]||(e[0]=(...m)=>c.addRow&&c.addRow(...m))},"Добавить строку ")):h("",!0),l.selectedRow!=null?(i(),d("button",{key:1,type:"button",class:"btn btn-primary mb-2",onClick:e[1]||(e[1]=(...m)=>c.addRowAbove&&c.addRowAbove(...m))},"Добавить строку выше ")):h("",!0),l.selectedRow!=null?(i(),d("button",{key:2,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:e[2]||(e[2]=(...m)=>c.addRowBelow&&c.addRowBelow(...m))},"Добавить строку ниже ")):h("",!0),l.selectedRow!=null?(i(),d("button",{key:3,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:e[3]||(e[3]=m=>c.moveRow(0))},E)):h("",!0),l.selectedRow!=null?(i(),d("button",{key:4,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:e[4]||(e[4]=m=>c.moveRow(1))},P)):h("",!0),l.selectedRow!=null?(i(),d("button",{key:5,type:"button",class:"btn btn-outline-danger mb-2 ml-2",onClick:e[5]||(e[5]=m=>l.selectedRow=null)},G)):h("",!0)]),t("div",H,[t("div",Y,[u(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=m=>l.showCode=m),id:"showCode"+c.uuid},null,8,Q),[[w,l.showCode]]),t("label",{class:"form-check-label",for:"showCode"+c.uuid}," Отобразить код ",8,X)])])]),l.keyboard.length>0?(i(),d("div",W,[(i(!0),d(_,null,k(l.keyboard,(m,a)=>(i(),d("div",Z,[t("div",I,[t("button",{type:"button",class:"btn btn-link w-100",onClick:$=>c.addColToRow(a)},te,8,x),t("button",{type:"button",class:"btn btn-link w-100",onClick:$=>c.removeColFromRow(a)},le,8,oe),t("button",{type:"button",class:"btn btn-link w-100",onClick:$=>c.moveCol(a,0)},ae,8,ie),t("button",{type:"button",class:"btn btn-link w-100",onClick:$=>c.moveCol(a,1)},ce,8,de)]),t("div",he,[(i(!0),d(_,null,k(m,($,r)=>(i(),d("div",be,[u(t("input",{type:"text",onClick:b=>c.selectIndex(a,r),class:"btn btn-outline-primary w-100","onUpdate:modelValue":b=>l.keyboard[a][r].text=b},null,8,ue),[[y,l.keyboard[a][r].text]]),t("button",{type:"button","data-bs-toggle":"modal","data-bs-target":"#button-menu-btn-row-"+a+"col-"+r,class:"btn btn-outline-primary","aria-expanded":"false","data-bs-reference":"parent"},_e,8,me),t("div",{class:"modal fade",id:"button-menu-btn-row-"+a+"col-"+r,tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[t("div",ke,[t("div",fe,[t("div",ve,[t("form",ge,[$e,t("div",Ce,[t("label",{for:"command-title-"+a+"-col-"+r,class:"form-label"},"Название кнопки",8,we),u(t("input",{type:"text",id:"command-title-"+a+"-col-"+r,class:"form-control w-100","onUpdate:modelValue":b=>l.keyboard[a][r].text=b},null,8,Fe),[[y,l.keyboard[a][r].text]])]),Re,t("div",Ke,[t("label",{for:"command-row-"+a+"-col-"+r,class:"form-label"},"Команда (для меню в сообщении)",8,Te),u(t("input",{type:"text",onChange:b=>c.needRemoveField("callback_data",a,r),"onUpdate:modelValue":b=>l.keyboard[a][r].callback_data=b,class:"form-control",id:"command-row-"+a+"-col-"+r,placeholder:"/start"},null,40,Ve),[[y,l.keyboard[a][r].callback_data]])]),t("div",Se,[t("label",{for:"switch-inline-query-row-"+a+"-col-"+r,class:"form-label"},"Ссылка на аккаунт в ТЕЛЕГРАММ",8,Be),u(t("input",{type:"text",class:"form-control",onChange:b=>c.needRemoveField("switch_inline_query",a,r),"onUpdate:modelValue":b=>l.keyboard[a][r].switch_inline_query=b,id:"switch-inline-query-row-"+a+"-col-"+r,placeholder:"@YourAccountLink"},null,40,Ue),[[y,l.keyboard[a][r].switch_inline_query]])]),t("div",Me,[t("label",{for:"url-row-"+a+"-col-"+r,class:"form-label"},"Внешняя URL-ссылка",8,je),u(t("input",{type:"text",class:"form-control",onChange:b=>c.needRemoveField("url",a,r),"onUpdate:modelValue":b=>l.keyboard[a][r].url=b,id:"url-row-"+a+"-col-"+r,placeholder:"https://t.me/example"},null,40,qe),[[y,l.keyboard[a][r].url]])]),t("div",Oe,[t("label",{for:"switch-inline-query-current-chat-row-"+a+"-col-"+r,class:"form-label"},"Команда всплывающего меню бота",8,Je),u(t("input",{type:"text",class:"form-control",onChange:b=>c.needRemoveField("switch_inline_query_current_chat",a,r),"onUpdate:modelValue":b=>l.keyboard[a][r].switch_inline_query_current_chat=b,id:"witch-inline-query-current-chat-row-"+a+"-col-"+r,placeholder:"команда"},null,40,Ne),[[y,l.keyboard[a][r].switch_inline_query_current_chat]])]),t("div",Ae,[t("input",{type:"radio",onChange:b=>c.needRemoveField(null,a,r),name:"request-radio",class:"form-check-input",id:"no-action-row-"+a+"-col-"+r},null,40,De),t("label",{class:"form-check-label",for:"no-action-row-"+a+"-col-"+r}," Без действий ",8,Ee)]),t("div",Le,[t("input",{type:"radio",onChange:b=>c.needRemoveField("request_contact",a,r),onClick:b=>l.keyboard[a][r].request_contact=!0,name:"request-radio",class:"form-check-input",id:"phone-row-"+a+"-col-"+r},null,40,Pe),t("label",{class:"form-check-label",for:"phone-row-"+a+"-col-"+r}," Запросить телефон (для нижнего меню) ",8,ze)]),t("div",Ge,[t("input",{type:"radio",name:"request-radio",onChange:b=>c.needRemoveField("request_location",a,r),onClick:b=>l.keyboard[a][r].request_location=!0,class:"form-check-input",id:"location-row-"+a+"-col-"+r},null,40,He),t("label",{class:"form-check-label",for:"location-row-"+a+"-col-"+r}," Запросить локацию (для нижнего меню) ",8,Ye)])])])])])],8,pe)]))),256))])]))),256))])):h("",!0)]),l.showCode?(i(),d("div",Qe,[t("div",Xe,[We,l.load?h("",!0):(i(),f(v,{key:0,mode:"code",modelValue:l.keyboard,"onUpdate:modelValue":e[7]||(e[7]=m=>l.keyboard=m),"show-btns":!1,expandedOnStart:!0,onJsonChange:c.onJsonChange},null,8,["modelValue","onJsonChange"]))])])):h("",!0)]))}const R=q(O,[["render",Ze]]);const Ie={key:0,class:"card"},xe={key:0,class:"card-header d-flex justify-content-between align-items-center"},et=["disabled"],tt=t("i",{class:"fa-solid fa-arrow-left"},null,-1),ot=[tt],st=["disabled"],lt=t("i",{class:"fa-regular fa-pen-to-square"},null,-1),it=[lt],nt=["disabled"],at=t("i",{class:"fa-regular fa-floppy-disk"},null,-1),dt=[at],rt={key:1,class:"card-header d-flex justify-content-between align-items-center"},ct={class:"mr-2"},ht=["disabled"],bt=t("i",{class:"fa-regular fa-pen-to-square"},null,-1),ut=[bt],mt=["disabled"],yt=t("i",{class:"fa-regular fa-clone"},null,-1),_t=[yt],pt=["disabled"],kt=t("i",{class:"fa-regular fa-floppy-disk"},null,-1),ft=[kt],vt=["disabled"],gt=t("i",{class:"fa-solid fa-trash-can"},null,-1),$t=[gt],Ct={class:"card-body"},wt={key:0,class:"row"},Ft={class:"col-md-6 col-12"},Rt={class:"mb-3"},Kt=t("label",{class:"form-label",id:"bot-domain"},"Тип",-1),Tt=t("option",{value:"reply"},"Нижняя клавиатура",-1),Vt=t("option",{value:"inline"},"Встроенная клавиатура",-1),St=[Tt,Vt],Bt={class:"col-md-6 col-12"},Ut={class:"mb-3"},Mt=t("label",{class:"form-label",id:"bot-domain"},"Мнемоническое имя",-1),jt={class:"row"},qt={class:"col-12"},Ot={class:"row"},Jt={class:"col-12"},Nt={class:"row"},At={class:"col"},Dt={type:"button",class:"btn btn-outline-primary w-100 mb-2"},Et={key:1,class:"card"},Lt={class:"card-header d-flex justify-content-between align-items-center"},Pt=["disabled"],zt=t("i",{class:"fa-regular fa-floppy-disk"},null,-1),Gt=[zt],Ht={key:0,class:"card-body"},Yt={key:1,class:"card-body"},Qt=t("p",null,"Ошибка!",-1),Xt=[Qt],Wt={props:["keyboard","selectMode"],data:()=>({is_edited:!1,load:!1,keyboardForm:null}),computed:{uuid(){return F()}},watch:{keyboardForm:{handler(o){this.is_edited=!0},deep:!0}},mounted(){const o=this.keyboard;this.keyboardForm=o,this.$nextTick(()=>{this.is_edited=!1,Array.isArray(o.menu)||this.updateKeyboard()})},methods:{removeKeyboard(){this.$store.dispatch("removeKeyboardTemplate",{templateId:this.keyboardForm.id}).then(o=>{this.load=!0,this.$nextTick(()=>{this.load=!1}),this.$emit("callback",this.keyboardForm.id)}).catch(()=>{this.$emit("callback",this.keyboardForm.id)})},saveKeyboard(o){this.keyboardForm.menu=o},selectCard(){this.$emit("select",this.keyboardForm)},duplicateKeyboard(){let o=new FormData;Object.keys(this.keyboardForm).forEach(e=>{const s=this.keyboardForm[e]||"";typeof s=="object"?o.append(e,JSON.stringify(s)):o.append(e,s)}),this.$store.dispatch("createKeyboardTemplate",{keyboardForm:o}).then(e=>{this.$notify({title:"Конструктор ботов",text:"Меню успешно продублировано!",type:"success"}),this.load=!0,this.$nextTick(()=>{this.load=!1}),this.$emit("reload")})},updateKeyboard(){let o=new FormData;Object.keys(this.keyboardForm).forEach(e=>{const s=this.keyboardForm[e]||"";typeof s=="object"?o.append(e,JSON.stringify(s)):o.append(e,s)}),this.$store.dispatch("editKeyboardTemplate",{keyboardForm:o}).then(e=>{this.load=!0,this.$nextTick(()=>{this.load=!1,this.is_edited=!1}),this.$emit("callback")}).catch(()=>{this.is_edited=!1,this.$emit("callback")})}}},Zt=Object.assign(Wt,{__name:"KeyboardCard",setup(o){return(e,s)=>(i(),d(_,null,[e.is_edited?h("",!0):(i(),d("div",Ie,[o.selectMode?(i(),d("div",xe,[t("div",null,[t("button",{onClick:s[0]||(s[0]=(...n)=>e.selectCard&&e.selectCard(...n)),disabled:e.load,type:"button",class:"btn btn-outline-success mr-2"},ot,8,et),t("button",{onClick:s[1]||(s[1]=n=>e.is_edited=!0),disabled:e.load,type:"button",title:"Редактировать клавиатуру",class:"btn btn-outline-success mr-2"},it,8,st),t("button",{onClick:s[2]||(s[2]=(...n)=>e.updateKeyboard&&e.updateKeyboard(...n)),type:"button",title:"Обновить клавиатуру",disabled:e.load||!e.is_edited,class:p(["btn btn-outline-primary mr-2",{"have-change":e.is_edited}])},dt,10,nt)])])):h("",!0),o.selectMode?h("",!0):(i(),d("div",rt,[t("div",null,[t("strong",ct,"#"+g(o.keyboard.id),1),t("button",{onClick:s[3]||(s[3]=n=>e.is_edited=!0),disabled:e.load,type:"button",title:"Редактировать клавиатуру",class:"btn btn-outline-success mr-2"},ut,8,ht),t("button",{onClick:s[4]||(s[4]=(...n)=>e.duplicateKeyboard&&e.duplicateKeyboard(...n)),type:"button",title:"Дублировать клавиатуру",disabled:e.load,class:"btn btn-outline-primary mr-2"},_t,8,mt),t("button",{onClick:s[5]||(s[5]=(...n)=>e.updateKeyboard&&e.updateKeyboard(...n)),type:"button",title:"Обновить клавиатуру",disabled:e.load||!e.is_edited,class:p(["btn btn-outline-primary mr-2",{"have-change":e.is_edited}])},ft,10,pt)]),t("button",{onClick:s[6]||(s[6]=(...n)=>e.removeKeyboard&&e.removeKeyboard(...n)),type:"button",disabled:e.load,title:"Удалить клавиатуру",class:"btn btn-outline-danger mr-2"},$t,8,vt)])),t("div",Ct,[o.selectMode?h("",!0):(i(),d("div",wt,[t("div",Ft,[t("div",Rt,[Kt,u(t("select",{disabled:!0,"onUpdate:modelValue":s[7]||(s[7]=n=>o.keyboard.type=n),class:"form-control"},St,512),[[K,o.keyboard.type]])])]),t("div",Bt,[t("div",Ut,[Mt,u(t("input",{type:"text",class:"form-control",placeholder:"Мнемоническое имя",disabled:!0,"aria-label":"Мнемоническое имя","onUpdate:modelValue":s[8]||(s[8]=n=>o.keyboard.slug=n),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[y,o.keyboard.slug]])])])])),t("div",jt,[t("div",qt,[t("div",Ot,[t("div",Jt,[(i(!0),d(_,null,k(o.keyboard.menu,(n,l)=>(i(),d("div",Nt,[(i(!0),d(_,null,k(n,(c,v)=>(i(),d("div",At,[t("button",Dt,g(c.text),1)]))),256))]))),256))])])])])])])),e.is_edited?(i(),d("div",Et,[t("div",Lt,[t("button",{onClick:s[9]||(s[9]=(...n)=>e.updateKeyboard&&e.updateKeyboard(...n)),type:"button",title:"Обновить клавиатуру",disabled:e.load||!e.is_edited,class:p(["btn btn-outline-primary mr-2",{"have-change":e.is_edited}])},Gt,10,Pt)]),e.keyboardForm.length>0?(i(),d("div",Ht,[e.keyboardForm?(i(),f(R,{key:0,onSave:e.saveKeyboard,"edited-keyboard":e.keyboardForm},null,8,["onSave","edited-keyboard"])):h("",!0)])):(i(),d("div",Yt,Xt))])):h("",!0)],64))}}),It={key:0,class:"row mb-2"},xt={class:"col-12"},eo={class:"card"},to=t("div",{class:"card-header"},[t("h6",null,"Форма создания шаблона клавиатуры")],-1),oo={class:"card-body"},so={class:"col-md-6 col-12"},lo={class:"mb-3"},io=t("label",{class:"form-label",id:"bot-domain"},"Тип",-1),no=t("option",{value:"reply"},"Нижняя клавиатура",-1),ao=t("option",{value:"inline"},"Встроенная клавиатура",-1),ro=[no,ao],co={class:"col-md-6 col-12"},ho={class:"mb-3"},bo={class:"form-label d-flex justify-content-between",id:"bot-domain"},uo=t("span",null,"Мнемоническое имя",-1),mo=t("i",{class:"fa-solid fa-arrows-rotate"},null,-1),yo=[mo],_o={class:"col-12"},po=t("div",{class:"col-12"},[t("button",{class:"btn btn-outline-success w-100 p-3"}," Добавить новый шаблон клавиатуры ")],-1),ko={class:"row"},fo={key:0,class:"col-12"},vo={class:"badge bg-warning"},go={class:"col-12 mb-3"},$o={key:1,class:"card"},Co={class:"card-body"},wo={key:2,class:"col-12 mb-3"},Fo=t("div",{class:"alert alert-warning",role:"alert"},[t("p",null,"Список шаблонов клавиатур пуст!")],-1),Ro=[Fo],Ko={props:["selectMode","type"],data(){return{keyboards:[],load:!1,bot:null,editedKeyboard:null,selectMenuIndex:null,keyboardForm:{type:"reply",bot_id:null,slug:null,menu:[]}}},computed:{...T(["getCurrentBot"]),filteredKeyboard(){return this.type?this.keyboards.filter(o=>o.type==this.type):this.keyboards}},mounted(){this.loadCurrentBot().then(()=>{this.loadMenusByBotTemplate(),this.generateSlug()})},methods:{selectCard(o){this.$emit("select",o)},keyboardCallbackAction(o){let e=this.keyboards.find(s=>s.id===o);e&&(e.deleted_at=new Date),this.loadMenusByBotTemplate()},loadMenusByBotTemplate(){this.$store.dispatch("loadBotKeyboards",{botId:this.bot.id}).then(o=>{this.keyboards=o.data})},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},submitKeyboard(){this.keyboardForm.bot_id=this.bot.id;let o=new FormData;Object.keys(this.keyboardForm).forEach(e=>{const s=this.keyboardForm[e]||"";typeof s=="object"?o.append(e,JSON.stringify(s)):o.append(e,s)}),this.$store.dispatch("createKeyboardTemplate",{keyboardForm:o}).then(e=>{this.keyboardForm={type:"reply",bot_id:null,slug:null,menu:[]},this.load=!0,this.$nextTick(()=>{this.load=!1}),this.loadMenusByBotTemplate()})},generateSlug(){this.keyboardForm.slug=F()},changeKeyboardFormMenu(o){this.keyboardForm.menu=o}}},To=Object.assign(Ko,{__name:"KeyboardList",setup(o){return(e,s)=>(i(),d(_,null,[o.selectMode?h("",!0):(i(),d("div",It,[t("div",xt,[t("div",eo,[to,t("div",oo,[t("form",{onSubmit:s[3]||(s[3]=V((...n)=>e.submitKeyboard&&e.submitKeyboard(...n),["prevent"])),class:"row"},[t("div",so,[t("div",lo,[io,u(t("select",{"onUpdate:modelValue":s[0]||(s[0]=n=>e.keyboardForm.type=n),class:"form-control"},ro,512),[[K,e.keyboardForm.type]])])]),t("div",co,[t("div",ho,[t("label",bo,[uo,t("a",{onClick:s[1]||(s[1]=(...n)=>e.generateSlug&&e.generateSlug(...n)),href:"#generate"},yo)]),u(t("input",{type:"text",class:"form-control",placeholder:"Мнемоническое имя","aria-label":"Мнемоническое имя","onUpdate:modelValue":s[2]||(s[2]=n=>e.keyboardForm.slug=n),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[y,e.keyboardForm.slug]])])]),t("div",_o,[e.load?h("",!0):(i(),f(R,{key:0,onSave:e.changeKeyboardFormMenu,"edited-keyboard":e.keyboardForm},null,8,["onSave","edited-keyboard"]))]),po],32)])])])])),t("div",ko,[e.keyboards&&e.bot?(i(),d("div",fo,[t("p",null,[C("В списке клавиатур "),t("span",vo,g(e.filteredKeyboard.length)+" ед.",1)])])):h("",!0),e.keyboards&&e.bot?(i(!0),d(_,{key:1},k(e.filteredKeyboard,(n,l)=>(i(),d("div",go,[n.deleted_at?(i(),d("div",$o,[t("div",Co,[t("p",null,"Удаленная клавиатура #"+g(n.id),1)])])):(i(),f(Zt,{key:0,"select-mode":o.selectMode,onSelect:e.selectCard,onReload:e.loadMenusByBotTemplate,onCallback:e.keyboardCallbackAction,keyboard:n},null,8,["select-mode","onSelect","onReload","onCallback","keyboard"]))]))),256)):h("",!0),e.filteredKeyboard.length===0?(i(),d("div",wo,Ro)):h("",!0)])],64))}}),Vo={class:"col-md-12 col-12"},So={class:"mb-3"},Bo=t("i",{class:"fa-solid fa-xmark"},null,-1),Uo=[Bo],Mo={class:"mb-3"},jo={class:"d-flex justify-content-between flex-wrap al"},qo=t("label",{class:"form-label",id:"bot-main-channel"},"Канал для постов (id,рекламный)",-1),Oo={class:"d-flex flex-wrap align-items-center"},Jo=t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),No={class:"col-12 mb-2"},Ao=t("label",{class:"form-label d-flex justify-content-between align-items-center mb-2",id:"bot-domain"},[C(" Текстовое содержимое страницы "),t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),Do={class:"form-floating"},Eo={for:"floatingTextarea2"},Lo={key:0},Po={class:"col-12 mb-2"},zo={class:"form-check"},Go=t("label",{class:"form-check-label",for:"need-page-images"}," Изображения на странице (максимум 10) ",-1),Ho={key:0,class:"col-12 mb-2"},Yo={class:"card mb-3"},Qo=t("div",{class:"card-header"},[t("h6",null,"Изображения на странице")],-1),Xo={class:"card-body d-flex justify-content-start"},Wo={for:"photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},Zo={class:"row"},Io={key:0,class:"col-12 d-flex flex-wrap"},xo={class:"mb-2 img-preview",style:{"margin-right":"10px"}},es={class:"remove"},ts=["onClick"],os={class:"col-12 mb-2"},ss={class:"form-check"},ls=t("label",{class:"form-check-label",for:"need-inline-menu"}," Меню под текстом страницы ",-1),is={key:1,class:"col-12 mb-2"},ns={class:"card"},as={class:"card-header d-flex justify-between align-items-center"},ds=t("h6",null,"Конструктор меню в сообщении",-1),rs={key:0},cs={key:1},hs={class:"card-body"},bs=t("div",{class:"col-12"},[t("button",{type:"submit",class:"btn btn-success w-100 p-3"}," Отправить сообщение в канал ")],-1),us={data(){return{load:!1,photos:[],showInlineTemplateSelector:!1,need_page_images:!1,need_inline_menu:!1,bot:null,mailForm:{text:"",inline_keyboard:null,channel:null}}},computed:{...T(["getCurrentBot"])},mounted(){this.loadCurrentBot()},methods:{addTextTo(o={param:null,text:null}){this.mailForm.channel=o.text},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},submitMail(){let o=new FormData;if(Object.keys(this.mailForm).forEach(e=>{const s=this.mailForm[e]||"";typeof s=="object"?o.append(e,JSON.stringify(s)):o.append(e,s)}),this.bot&&o.append("bot_id",this.bot.id),this.photos.length>0)for(let e=0;e<this.photos.length;e++)o.append("photos[]",this.photos[e]);this.$store.dispatch("sendToChannel",{mailForm:o}).then(e=>{this.load=!0,this.photos=[],this.need_inline_menu=!1,this.need_page_images=!1,this.mailForm={text:"",channel:null,inline_keyboard:null},this.$notify({title:"Конструктор ботов",text:"Сообщение успещно отправлено!",type:"success"})}).catch(e=>{})},saveInlineKeyboard(o){this.mailForm.inline_keyboard=o},selectInlineKeyboard(o){this.mailForm.inline_keyboard=o,this.showInlineTemplateSelector=!1},getPhoto(o){return{imageUrl:URL.createObjectURL(o)}},removePhoto(o){this.photos.splice(o,1)},removeImage(o){this.mailForm.images.splice(o,1)},onChangePhotos(o){const e=o.target.files;for(let s=0;s<e.length;s++)this.photos.push(e[s])}}},ks=Object.assign(us,{__name:"Mail",setup(o){return(e,s)=>{const n=B("lazy");return e.bot?(i(),d("form",{key:0,onSubmit:s[9]||(s[9]=V((...l)=>e.submitMail&&e.submitMail(...l),["prevent"]))},[t("div",Vo,[t("div",So,[e.mailForm.channel!=null?(i(),d("button",{key:0,type:"button",class:"btn btn-outline-info mr-2",onClick:s[0]||(s[0]=l=>e.mailForm.channel=null)},Uo)):h("",!0),t("button",{type:"button",class:p(["btn mr-2",{"btn-info":e.mailForm.channel===e.bot.main_channel,"btn-outline-info":e.mailForm.channel!==e.bot.main_channel}]),onClick:s[1]||(s[1]=l=>e.mailForm.channel=e.bot.main_channel)},"Главный канал ",2),t("button",{type:"button",class:p(["btn",{"btn-info":e.mailForm.channel===e.bot.order_channel,"btn-outline-info":e.mailForm.channel!==e.bot.order_channel}]),onClick:s[2]||(s[2]=l=>e.mailForm.channel=e.bot.order_channel)},"Канал заказов ",2)]),t("div",Mo,[t("div",jo,[qo,t("div",Oo,[U(j,{token:e.bot.bot_token,param:"channel",onCallback:e.addTextTo},null,8,["token","onCallback"]),Jo])]),u(t("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":s[3]||(s[3]=l=>e.mailForm.channel=l),maxlength:"255","aria-describedby":"bot-main-channel",required:""},null,512),[[y,e.mailForm.channel]])])]),t("div",No,[Ao,t("div",Do,[u(t("textarea",{class:"form-control","onUpdate:modelValue":s[4]||(s[4]=l=>e.mailForm.text=l),maxlength:"4096",placeholder:"Введите текст",id:"floatingTextarea2",style:{"min-height":"100px"},required:""},null,512),[[y,e.mailForm.text]]),t("label",Eo,[C("Содержимое страницы "),e.mailForm.text?(i(),d("span",Lo,g(e.mailForm.text.length)+"/4096 ",1)):h("",!0)])])]),t("div",Po,[t("div",zo,[u(t("input",{class:"form-check-input","onUpdate:modelValue":s[5]||(s[5]=l=>e.need_page_images=l),type:"checkbox",id:"need-page-images"},null,512),[[w,e.need_page_images]]),Go])]),e.need_page_images?(i(),d("div",Ho,[t("div",Yo,[Qo,t("div",Xo,[t("label",Wo,[C(" + "),t("input",{type:"file",id:"photos",multiple:"",accept:"image/*",onChange:s[6]||(s[6]=(...l)=>e.onChangePhotos&&e.onChangePhotos(...l)),style:{display:"none"}},null,32)]),t("div",Zo,[e.photos.length>0?(i(),d("div",Io,[(i(!0),d(_,null,k(e.photos,(l,c)=>(i(),d("div",xo,[u(t("img",null,null,512),[[n,e.getPhoto(l).imageUrl]]),t("div",es,[t("a",{onClick:v=>e.removePhoto(c)},"Удалить",8,ts)])]))),256))])):h("",!0)])])])])):h("",!0),t("div",os,[t("div",ss,[u(t("input",{class:"form-check-input","onUpdate:modelValue":s[7]||(s[7]=l=>e.need_inline_menu=l),type:"checkbox",id:"need-inline-menu"},null,512),[[w,e.need_inline_menu]]),ls])]),e.need_inline_menu?(i(),d("div",is,[t("div",ns,[t("div",as,[ds,t("button",{class:p(["btn",{"btn-outline-primary":!e.showInlineTemplateSelector,"btn-primary":e.showInlineTemplateSelector}]),type:"button",onClick:s[8]||(s[8]=l=>e.showInlineTemplateSelector=!e.showInlineTemplateSelector)},[e.showInlineTemplateSelector?(i(),d("span",cs," Скрыть шаблоны меню")):(i(),d("span",rs," Открыть шаблоны меню"))],2)]),t("div",hs,[e.showInlineTemplateSelector?(i(),f(To,{key:0,class:"mb-2",type:"inline",onSelect:e.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(i(),f(R,{key:1,type:"inline",onSave:e.saveInlineKeyboard,"edited-keyboard":e.mailForm.inline_keyboard},null,8,["onSave","edited-keyboard"]))])])])):h("",!0),bs],32)):h("",!0)}}});export{R as B,To as _,ks as a};
