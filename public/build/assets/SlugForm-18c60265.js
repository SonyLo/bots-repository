import{U as F,o as s,q as n,t,F as f,B as p,v as b,C as h,x as c,z as m,H as _,N as C,A as k,M as v,D as u,G as g,J as w,O as S,y as V}from"./index.es-2ae4469e.js";import{P as $}from"./Pagination-45f9fbc7.js";import{m as y}from"./index-6983e48f.js";import{T as j}from"./TelegramChannelHelper-d571320b.js";const O={key:0,class:"row"},U={class:"col-12 mb-3"},M={class:"list-group w-100"},P=["onClick"],B={key:0,class:"badge bg-info"},I=["onClick"],A=t("i",{class:"fa-solid fa-trash-can"},null,-1),T=[A],G={class:"col-12"},N={key:2},L={class:"card-body"},q={class:"mb-3"},D={class:"form-label",id:"bot-domain"},E=t("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),z=t("div",null,[h("Измените только текст команды,"),t("br"),h(" если хотите чтоб скрипт вызывался по кнопке из меню. "),t("br"),h(" Или оставьте как есть. "),t("br"),h(" Текст скрипта нужно также указать в качестве пункта меню. ")],-1),J=t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),H=["disabled"],K={props:["canAdd","bot"],data(){return{search:null,slugs:[],slugs_paginate_object:null,slugForm:{command:null,comment:null,slug:null,config:[],is_global:!0,bot_id:null}}},computed:{...y(["getGlobalSlugs","getGlobalSlugsPaginateObject"]),filteredAllSlugs(){return this.slugs.length===0?[]:this.search==null?this.slugs:this.slugs.filter(o=>{let e=o.slug||"",a=o.command||"",r=o.comment||"";return a.toLowerCase().indexOf(this.search.toLowerCase())!==-1||r.toLowerCase().indexOf(this.search.toLowerCase())!==-1||e.toLowerCase().indexOf(this.search.toLowerCase())!==-1})}},mounted(){this.loadAllSlugs()},methods:{loadAllSlugs(o=0){this.$store.dispatch("loadGlobalSlugs",{dataObject:{needGlobal:!0},page:o}).then(e=>{this.slugs=this.getGlobalSlugs,this.slugs_paginate_object=this.getGlobalSlugsPaginateObject})},removeSlug(o){this.$store.dispatch("removeSlug",{dataObject:{slugId:o.id}}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно удалена",type:"success"}),this.loadAllSlugs()}).catch(e=>{this.loadAllSlugs()})},nextSlugs(o){this.loadAllSlugs(o)},selectSlug(o){this.slugForm.id=o.id||null,this.slugForm.slug=o.slug,this.slugForm.comment=o.comment,this.slugForm.command=this.command||o.command,this.slugForm.config=o.config||[],this.slugForm.is_global=o.is_global||!1,this.$emit("select",o)},addSlug(){let o=new FormData;Object.keys(this.slugForm).forEach(e=>{const a=this.slugForm[e]||"";typeof a=="object"?o.append(e,JSON.stringify(a)):o.append(e,a)}),this.bot&&o.append("bot_id",this.bot.id),this.$store.dispatch("createSlug",{slugForm:o}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно обновлена",type:"success"}),this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0,this.$emit("callback")}).catch(e=>{})}}},jt=Object.assign(K,{__name:"GlobalSlugList",setup(o){return(e,a)=>{const r=F("Popper");return s(),n(f,null,[e.filteredAllSlugs.length>0?(s(),n("div",O,[t("div",U,[t("ul",M,[(s(!0),n(f,null,p(e.filteredAllSlugs,(i,l)=>(s(),n("li",{class:b(["list-group-item cursor-pointer btn mb-1 d-flex align-items-center justify-between",{"btn-outline-info":i.deleted_at==null,"btn-outline-danger border-danger":i.deleted_at!=null}])},[t("strong",{onClick:d=>e.selectSlug(i),style:{"word-wrap":"break-word"}},[t("i",{class:b([{"text-danger":i.deleted_at!=null},"fa-solid fa-scroll"])},null,2),h(" "+c(i.command)+" (",1),t("span",null,c(i.slug),1),h(") ")],8,P),i.comment?(s(),n("span",B,c(i.comment||"Пояснение не указано"),1)):m("",!0),t("button",{class:"btn btn-outline-danger",onClick:d=>e.removeSlug(i),type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},T,8,I)],2))),256))])]),t("div",G,[e.slugs_paginate_object?(s(),_($,{key:0,onPagination_page:e.nextSlugs,pagination:e.slugs_paginate_object},null,8,["onPagination_page","pagination"])):m("",!0)])])):(s(),n("p",N,"Глобальных скриптов не обноружено")),o.canAdd&&e.filteredAllSlugs.length>0?(s(),n("form",{key:3,onSubmit:a[1]||(a[1]=C((...i)=>e.addSlug&&e.addSlug(...i),["prevent"])),class:"card mb-3"},[t("div",L,[t("div",q,[t("label",D,[k(r,null,{content:v(()=>[z]),default:v(()=>[E]),_:1}),h(" Команда "),J]),u(t("input",{type:"text",class:"form-control",placeholder:"Команда","aria-label":"Команда","onUpdate:modelValue":a[0]||(a[0]=i=>e.slugForm.command=i),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[g,e.slugForm.command]])]),t("button",{disabled:e.slugForm.slug==null,class:"btn btn-outline-success mt-2 mb-2 w-100 p-3"},"Добавить скрипт в бота ",8,H)])],32)):m("",!0)],64)}}}),Q={class:"row"},R={class:"input-group mb-3"},W={key:0,class:"row"},X={class:"col-12 col-md-12 mb-3"},Y={class:"list-group"},Z=["onClick"],x={class:"ms-2 me-auto w-100"},ee={class:"fw-bold"},te={class:"badge bg-info rounded-pill"},oe={class:"w-100"},le={class:"d-flex justify-content-between"},se=["onClick"],ie=["onClick"],ne={style:{position:"absolute",right:"10px"},class:"badge bg-primary rounded-pill"},ae={class:"col-12"},de={key:1,class:"row"},re=t("div",{class:"col-12"},[t("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет медиа-файлов ")],-1),ue=[re],ce={props:["selected","needVideo","needVideoNote","needPhoto"],data(){return{bot:null,loading:!0,media:[],search:null,media_paginate_object:null}},computed:{...y(["getMedia","getMediaPaginateObject","getCurrentBot"])},mounted(){this.loadCurrentBot().then(()=>{this.loadMedia()})},methods:{selectMedia(o){this.$emit("select",o)},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},nextMedia(o){this.loadMedia(o)},remove(o){this.$store.dispatch("removeMedia",{dataObject:{mediaId:o}}).then(e=>{this.loadMedia(),this.$notify({title:"Удаление медиа-контента",text:"Медиа контент удален"})}).catch(()=>{})},showPreview(o){this.$store.dispatch("showMediaPreview",{dataObject:{mediaId:o}}).then(e=>{this.$notify({title:"Превью медиа-контента",text:"Отправлено в бота"})}).catch(()=>{})},loadMedia(o=0){this.loading=!0,this.$store.dispatch("loadMedia",{dataObject:{botId:this.bot.id||null,search:this.search,needVideo:this.needVideo||!1,needVideoNote:this.needVideoNote||!1,needPhoto:this.needPhoto||!1},page:o}).then(e=>{this.loading=!1,this.media=this.getMedia,this.media_paginate_object=this.getMediaPaginateObject}).catch(()=>{this.loading=!1})}}},ge=Object.assign(ce,{__name:"BotMediaList",setup(o){return(e,a)=>(s(),n(f,null,[t("div",Q,[t("div",R,[u(t("input",{type:"search",class:"form-control",placeholder:"Поиск файла","aria-label":"Поиск файла","onUpdate:modelValue":a[0]||(a[0]=r=>e.search=r)},null,512),[[g,e.search]]),t("button",{class:"btn btn-outline-secondary",onClick:a[1]||(a[1]=r=>e.loadMedia(0)),type:"button",id:"button-addon2"},"Найти ")])]),e.media.length>0?(s(),n("div",W,[t("div",X,[t("ul",Y,[(s(!0),n(f,null,p(e.media,(r,i)=>(s(),n("li",{onClick:l=>e.selectMedia(r),class:b([{"border-info":o.selected.indexOf(r.file_id)!=-1},"list-group-item d-flex justify-content-between align-items-start"])},[t("div",x,[t("div",ee,[h(c(r.caption??"Без подписи")+" ",1),t("span",te,c(r.type),1)]),t("small",oe,c(r.file_id),1),t("div",le,[t("a",{href:"javascript:void(0)",class:"btn btn-link p-0 my-2",onClick:l=>e.showPreview(r.id)},"Показать превью",8,se),t("a",{href:"javascript:void(0)",class:"btn btn-link p-0 my-2 text-danger",onClick:l=>e.remove(r.id)},"Удалить",8,ie)])]),t("span",ne,"#"+c(r.id),1)],10,Z))),256))])]),t("div",ae,[e.media_paginate_object?(s(),_($,{key:0,onPagination_page:e.nextMedia,pagination:e.media_paginate_object},null,8,["onPagination_page","pagination"])):m("",!0)])])):(s(),n("div",de,ue))],64))}}),me={class:"form-floating mb-3"},he=t("label",{for:"floatingInput"},"Команда",-1),fe={class:"form-floating mb-3"},pe=t("label",{for:"floatingInput"},"Мнемоническое имя",-1),be={class:"form-floating mb-3"},_e=t("label",{for:"floatingInput"},"Описание скрипта",-1),ye=t("h6",null," Параметры скрипта ",-1),ve=t("div",{class:"alert alert-info",role:"alert"}," Данные параметры используются для настройки скриптов на стороне сервера ",-1),Ce={class:"dropdown"},ke=t("button",{class:"btn btn-outline-info w-100 dropdown-toggle mb-2",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," Добавить ",-1),$e={class:"dropdown-menu w-100"},Fe=["onClick"],we={class:"row"},Se={class:"col-12"},Ve=["onClick"],je={key:0,class:"row"},Oe={class:"col-md-6 mb-1"},Ue={class:"card"},Me={class:"card-header d-flex justify-content-between align-items-center"},Pe=["onClick"],Be=t("i",{class:"fa-solid fa-trash-can"},null,-1),Ie=[Be],Ae=["onClick"],Te=t("i",{class:"fa-solid fa-caret-left"},null,-1),Ge=[Te],Ne=["onClick"],Le=t("i",{class:"fa-solid fa-caret-right"},null,-1),qe=[Le],De={class:"dropdown"},Ee={class:"btn btn-outline-info dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},ze={class:"dropdown-menu"},Je=["onClick"],He={class:"card-body"},Ke={class:"form-floating mb-1"},Qe=["onUpdate:modelValue","id"],Re=["for"],We={key:0,class:"form-floating mb-1"},Xe=["id","onUpdate:modelValue"],Ye=["for"],Ze={key:1,class:"form-check mb-1 mt-2"},xe=["onUpdate:modelValue","id"],et=["for"],tt={key:2,class:"form-floating mb-1 mt-2"},ot=["onUpdate:modelValue","id"],lt=["for"],st={key:3,class:"form-floating mb-1 mt-2"},it=["onUpdate:modelValue","id"],nt=["for"],at={key:4,class:"form-check mb-1 mt-2"},dt=["onUpdate:modelValue","id"],rt=["for"],ut={key:5,class:"form-floating mb-3"},ct=["id","onUpdate:modelValue"],gt=["for"],mt={key:6,class:"form-floating mb-3"},ht=["id","onUpdate:modelValue"],ft=["for"],pt={key:1,class:"row"},bt=t("div",{class:"col-12"},[t("p",null,"Параметры скрипта еще не добавлены")],-1),_t=[bt],yt={class:"btn btn-outline-primary w-100 mt-2 p-3"},vt={key:0},Ct={key:1},kt={props:["item"],data(){return{filters:[],simple:!0,configTypes:[{title:"Текстовый или числовой параметр",type:"text"},{title:"Большое текстовое поле",type:"large-text"},{title:"Канал обратной связи",type:"channel"},{title:"Логический оператор",type:"boolean"},{title:"Ссылка на изображение",type:"image"},{title:"Цвет",type:"color"},{title:"Geo",type:"geo"},{title:"Номер телефона",type:"phone"}],bot:null,photos:[],slugForm:{bot_id:null,id:null,command:null,comment:null,slug:null,config:[],is_global:!0}}},computed:{...y(["getCurrentBot"]),filteredConfigs(){return this.filters.length==0?this.slugForm.config:this.slugForm.config.filter(o=>this.filters.indexOf(o.type)>=0)}},mounted(){this.loadCurrentBot(),this.item&&(this.slugForm.id=this.item.id||null,this.slugForm.command=this.item.command,this.slugForm.comment=this.item.comment,this.slugForm.bot_id=this.item.bot_id,this.slugForm.slug=this.item.slug,this.slugForm.config=this.item.config||[],this.slugForm.is_global=this.item.is_global||!1)},methods:{toggleFilter(o){let e=this.filters.indexOf(o);e>=0?this.filters.splice(e,1):this.filters.push(o)},addTextTo(o,e={text:null}){this.slugForm.config[o].value=e.text},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},submit(){let o=new FormData;Object.keys(this.slugForm).forEach(e=>{const a=this.slugForm[e]||"";typeof a=="object"?o.append(e,JSON.stringify(a)):o.append(e,a)}),this.$store.dispatch(this.slugForm.id===null?"createSlug":"updateSlug",{slugForm:o}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно обновлена",type:"success"}),this.slugForm.id===null&&(this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0),this.$emit("callback")}).catch(e=>{})},addConfig(o){this.slugForm.config.splice(0,0,{key:null,value:null,type:o||"text"})},move(o,e=0){let a=this.slugForm.config[o],r=this.slugForm.config.length||0,i=e===0?o-1>=0?o-1:r-1:o<r-1?o+1:0;this.slugForm.config[o]=this.slugForm.config[i],this.slugForm.config[i]=a},removeConfigItem(o){try{this.slugForm.config.splice(o,1)}catch{this.slugForm.config=[]}},selectPhoto(o,e){this.filteredConfigs[e].value=o.file_id}}},Ot=Object.assign(kt,{__name:"SlugForm",setup(o){return(e,a)=>{const r=w("mask");return s(),n("form",{onSubmit:a[3]||(a[3]=C((...i)=>e.submit&&e.submit(...i),["prevent"]))},[t("div",me,[u(t("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=i=>e.slugForm.command=i),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[g,e.slugForm.command]]),he]),t("div",fe,[u(t("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=i=>e.slugForm.slug=i),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[g,e.slugForm.slug]]),pe]),t("div",be,[u(t("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=i=>e.slugForm.comment=i),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[g,e.slugForm.comment]]),_e]),ye,ve,t("div",Ce,[ke,t("ul",$e,[(s(!0),n(f,null,p(e.configTypes,(i,l)=>(s(),n("li",null,[t("a",{class:"dropdown-item",onClick:d=>e.addConfig(i.type)},c(i.title||"Не установлен"),9,Fe)]))),256))])]),t("div",we,[t("div",Se,[t("p",null,[h("Фильтры: "),(s(!0),n(f,null,p(e.configTypes,(i,l)=>(s(),n("span",{class:b(["badge mb-1 bg-gray-100 cursor-pointer mr-1",{"bg-info":e.filters.indexOf(i.type)>=0}]),onClick:d=>e.toggleFilter(i.type)},c(i.type),11,Ve))),256))])])]),e.filteredConfigs.length>0?(s(),n("div",je,[(s(!0),n(f,null,p(e.filteredConfigs,(i,l)=>(s(),n("div",Oe,[t("div",Ue,[t("div",Me,[t("div",null,[t("button",{onClick:d=>e.removeConfigItem(l),class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Ie,8,Pe),t("button",{onClick:d=>e.move(l,0),style:{"margin-left":"5px"},class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Ge,8,Ae),t("button",{onClick:d=>e.move(l,1),style:{"margin-left":"5px"},class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},qe,8,Ne)]),e.bot&&e.filteredConfigs[l].type==="channel"?(s(),_(j,{key:0,token:e.bot.bot_token,onCallback:d=>e.addTextTo(l,d)},null,8,["token","onCallback"])):m("",!0),t("div",null,[t("div",De,[t("button",Ee,c(e.filteredConfigs[l].type),1),t("ul",ze,[(s(!0),n(f,null,p(e.configTypes,d=>(s(),n("li",null,[t("a",{class:"dropdown-item",onClick:$t=>e.filteredConfigs[l].type=d.type},c(d.title||i.type),9,Je)]))),256))])])])]),t("div",He,[t("div",Ke,[u(t("input",{type:"text",class:"form-control","onUpdate:modelValue":d=>e.filteredConfigs[l].key=d,id:"field-input-key-"+l,placeholder:"name@example.com"},null,8,Qe),[[g,e.filteredConfigs[l].key]]),t("label",{for:"field-input-key-"+l},"Ключ",8,Re)]),e.filteredConfigs[l].type==="text"||e.filteredConfigs[l].type==="channel"?(s(),n("div",We,[u(t("input",{type:"text",class:"form-control",id:"field-input-"+l,"onUpdate:modelValue":d=>e.filteredConfigs[l].value=d,placeholder:"name@example.com"},null,8,Xe),[[g,e.filteredConfigs[l].value]]),t("label",{for:"field-input-"+l},"Значение",8,Ye)])):m("",!0),e.filteredConfigs[l].type==="boolean"?(s(),n("div",Ze,[u(t("input",{class:"form-check-input","onUpdate:modelValue":d=>e.filteredConfigs[l].value=d,type:"checkbox",value:"false",id:"filtered-config-"+l+"-checkbox"},null,8,xe),[[S,e.filteredConfigs[l].value]]),t("label",{class:"form-check-label",for:"filtered-config-"+l+"-checkbox"},c(e.filteredConfigs[l].value?"Истина":"Ложь"),9,et)])):m("",!0),e.filteredConfigs[l].type==="geo"?(s(),n("div",tt,[u(t("input",{class:"form-control",placeholder:"##.######,##.######","onUpdate:modelValue":d=>e.filteredConfigs[l].value=d,type:"text",id:"filtered-config-"+l+"-geo"},null,8,ot),[[r,"##.######,##.######"],[g,e.filteredConfigs[l].value]]),t("label",{for:"filtered-config-"+l+"-geo"},"Значение",8,lt)])):m("",!0),e.filteredConfigs[l].type==="phone"?(s(),n("div",st,[u(t("input",{class:"form-control",placeholder:"+7(###)###-##-##","onUpdate:modelValue":d=>e.filteredConfigs[l].value=d,type:"text",id:"filtered-config-"+l+"-phone"},null,8,it),[[r,"+7(###)###-##-##"],[g,e.filteredConfigs[l].value]]),t("label",{for:"filtered-config-"+l+"-phone"},"Значение",8,nt)])):m("",!0),e.filteredConfigs[l].type==="color"?(s(),n("div",at,[u(t("input",{class:"form-control","onUpdate:modelValue":d=>e.filteredConfigs[l].value=d,type:"color",id:"filtered-config-"+l+"-color"},null,8,dt),[[g,e.filteredConfigs[l].value]]),t("label",{for:"filtered-config-"+l+"-color"},[t("p",{style:V({color:e.filteredConfigs[l].value})},"Цвет: "+c(e.filteredConfigs[l].value),5)],8,rt)])):m("",!0),e.filteredConfigs[l].type==="large-text"?(s(),n("div",ut,[u(t("textarea",{class:"form-control",id:"field-input-"+l,"onUpdate:modelValue":d=>e.filteredConfigs[l].value=d,placeholder:"name@example.com"},`
                            `,8,ct),[[g,e.filteredConfigs[l].value]]),t("label",{for:"field-input-"+l},"Значение",8,gt)])):m("",!0),e.filteredConfigs[l].type==="image"?(s(),n("div",mt,[u(t("input",{class:"form-control mb-2",id:"field-input-"+l,type:"text",disabled:"true","onUpdate:modelValue":d=>e.filteredConfigs[l].value=d,placeholder:"name@example.com"},null,8,ht),[[g,e.filteredConfigs[l].value]]),t("label",{for:"field-input-"+l},"FileId ссылка на изображение",8,ft),k(ge,{"need-video":!1,"need-photo":!0,selected:[e.filteredConfigs[l].value],onSelect:d=>e.selectPhoto(d,l)},null,8,["selected","onSelect"])])):m("",!0)])])]))),256))])):(s(),n("div",pt,_t)),t("button",yt,[e.slugForm.id==null?(s(),n("span",vt," Сохранить команду ")):(s(),n("span",Ct," Обновить команду "))])],32)}}});export{Ot as _,jt as a,ge as b};
