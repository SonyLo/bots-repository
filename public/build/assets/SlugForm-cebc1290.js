import{m as k,C as v,o as n,c as i,a as e,F as p,r as f,n as b,f as m,t as g,d as h,e as C,g as _,b as F,l as y,w as d,v as c,_ as w,q as $}from"./app-5050072f.js";import{P as S}from"./Pagination-a52c7253.js";const I={key:0,class:"row"},L={class:"col-12 mb-3"},O={class:"list-group w-100"},j=["onClick"],T={key:0,class:"badge bg-info"},V=["onClick"],q=e("i",{class:"fa-solid fa-trash-can"},null,-1),U=[q],A={class:"col-12"},B={key:2},P={class:"card-body"},N={class:"mb-3"},D={class:"form-label",id:"bot-domain"},E=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),G=e("div",null,[m("Измените только текст команды,"),e("br"),m(" если хотите чтоб скрипт вызывался по кнопке из меню. "),e("br"),m(" Или оставьте как есть. "),e("br"),m(" Текст скрипта нужно также указать в качестве пункта меню. ")],-1),M=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),H=["disabled"],J={props:["canAdd","bot"],data(){return{search:null,slugs:[],slugs_paginate_object:null,slugForm:{command:null,comment:null,slug:null,config:[],is_global:!0,bot_id:null}}},computed:{...k(["getSlugs","getSlugsPaginateObject"]),filteredAllSlugs(){return this.slugs.length===0?[]:this.search==null?this.slugs:this.slugs.filter(l=>{let t=l.slug||"",o=l.command||"",a=l.comment||"";return o.toLowerCase().indexOf(this.search.toLowerCase())!==-1||a.toLowerCase().indexOf(this.search.toLowerCase())!==-1||t.toLowerCase().indexOf(this.search.toLowerCase())!==-1})}},mounted(){this.loadAllSlugs()},methods:{loadAllSlugs(l=0){this.$store.dispatch("loadSlugs",{dataObject:{needGlobal:!0},page:l}).then(t=>{this.slugs=this.getSlugs,this.slugs_paginate_object=this.getSlugsPaginateObject})},removeSlug(l){this.$store.dispatch("removeSlug",{dataObject:{slugId:l.id}}).then(t=>{this.$notify({title:"Конструктор команд",text:"Команда успешно удалена",type:"success"}),this.loadAllSlugs()}).catch(t=>{this.loadAllSlugs()})},nextSlugs(l){this.loadAllSlugs(l)},selectSlug(l){this.slugForm.id=l.id||null,this.slugForm.slug=l.slug,this.slugForm.comment=l.comment,this.slugForm.command=this.command||l.command,this.slugForm.config=l.config||[],this.slugForm.is_global=l.is_global||!1,this.$emit("select",l)},addSlug(){let l=new FormData;Object.keys(this.slugForm).forEach(t=>{const o=this.slugForm[t]||"";typeof o=="object"?l.append(t,JSON.stringify(o)):l.append(t,o)}),this.bot&&l.append("bot_id",this.bot.id),this.$store.dispatch("createSlug",{slugForm:l}).then(t=>{this.$notify({title:"Конструктор команд",text:"Команда успешно обновлена",type:"success"}),this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0,this.$emit("callback")}).catch(t=>{})}}},Qt=Object.assign(J,{__name:"GlobalSlugList",setup(l){return(t,o)=>{const a=v("Popper");return n(),i(p,null,[t.filteredAllSlugs.length>0?(n(),i("div",I,[e("div",L,[e("ul",O,[(n(!0),i(p,null,f(t.filteredAllSlugs,(s,r)=>(n(),i("li",{class:b(["list-group-item cursor-pointer btn mb-1 d-flex align-items-center justify-between",{"btn-outline-info":s.deleted_at==null,"btn-outline-danger border-danger":s.deleted_at!=null}])},[e("strong",{onClick:u=>t.selectSlug(s),style:{"word-wrap":"break-word"}},[e("i",{class:b([{"text-danger":s.deleted_at!=null},"fa-solid fa-scroll"])},null,2),m(" "+g(s.command)+" (",1),e("span",null,g(s.slug),1),m(") ")],8,j),s.comment?(n(),i("span",T,g(s.comment||"Пояснение не указано"),1)):h("",!0),e("button",{class:"btn btn-outline-danger",onClick:u=>t.removeSlug(s),type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},U,8,V)],2))),256))])]),e("div",A,[t.slugs_paginate_object?(n(),C(S,{key:0,onPagination_page:t.nextSlugs,pagination:t.slugs_paginate_object},null,8,["onPagination_page","pagination"])):h("",!0)])])):(n(),i("p",B,"Глобальных скриптов не обноружено")),l.canAdd&&t.filteredAllSlugs.length>0?(n(),i("form",{key:3,onSubmit:o[1]||(o[1]=_((...s)=>t.addSlug&&t.addSlug(...s),["prevent"])),class:"card mb-3"},[e("div",P,[e("div",N,[e("label",D,[F(a,null,{content:y(()=>[G]),default:y(()=>[E]),_:1}),m(" Команда "),M]),d(e("input",{type:"text",class:"form-control",placeholder:"Команда","aria-label":"Команда","onUpdate:modelValue":o[0]||(o[0]=s=>t.slugForm.command=s),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[c,t.slugForm.command]])]),e("button",{disabled:t.slugForm.slug==null,class:"btn btn-outline-success mt-2 mb-2 w-100 p-3"},"Добавить скрипт в бота ",8,H)])],32)):h("",!0)],64)}}});const z={props:["token","param"],data(){return{channelLink:null}},mounted(){},methods:{checkLink(){this.channelLink.indexOf("https://t.me/")!==-1&&(this.channelLink="@"+(this.channelLink.split("https://t.me/")[1]||this.channelLink))},requestTelegramChannelId(){this.$store.dispatch("requestTelegramChannelId",{dataObject:{token:this.token,channel:this.channelLink}}).then(l=>{l.ok&&this.$emit("callback",{param:this.param||null,text:l.result.chat.id}),l.ok||(this.$notify({title:"Конструктор ботов",text:l.description,type:"error"}),this.$emit("callback",{param:this.param||null,text:null}))}).catch(()=>{})}}},K={class:"dropdown"},Q=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-brands fa-telegram"})],-1),R={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},W={key:0,class:"alert alert-danger mb-2",role:"alert"},X=["disabled"];function Y(l,t,o,a,s,r){return n(),i("div",K,[Q,e("div",R,[e("form",{onSubmit:t[2]||(t[2]=_((...u)=>r.requestTelegramChannelId&&r.requestTelegramChannelId(...u),["prevent"]))},[d(e("input",{type:"text",class:"form-control mb-2",id:"search-description-text","onUpdate:modelValue":t[0]||(t[0]=u=>s.channelLink=u),onChange:t[1]||(t[1]=(...u)=>r.checkLink&&r.checkLink(...u)),placeholder:"@telegram_channel",required:""},null,544),[[c,s.channelLink]]),o.token?h("",!0):(n(),i("div",W," Вам необходимо указать тоукен бота! ")),e("button",{disabled:!o.token,class:"btn btn-outline-primary w-100"},"Узнать id канала ",8,X)],32)])])}const Z=w(z,[["render",Y]]),x={class:"form-floating mb-3"},tt=e("label",{for:"floatingInput"},"Команда",-1),et={class:"form-floating mb-3"},lt=e("label",{for:"floatingInput"},"Мнемоническое имя",-1),st={class:"form-floating mb-3"},ot=e("label",{for:"floatingInput"},"Описание скрипта",-1),nt=e("h6",null," Параметры скрипта ",-1),it=e("div",{class:"alert alert-info",role:"alert"}," Данные параметры используются для настройки скриптов на стороне сервера ",-1),at={class:"dropdown"},rt=e("button",{class:"btn btn-outline-info w-100 dropdown-toggle mb-2",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," Добавить ",-1),dt={class:"dropdown-menu w-100"},ut=["onClick"],ct={class:"row"},gt={class:"col-12"},mt=["onClick"],ht={key:0,class:"row"},pt={class:"col-md-6 mb-1"},ft={class:"card"},bt={class:"card-header d-flex justify-content-between align-items-center"},_t=["onClick"],yt=e("i",{class:"fa-solid fa-trash-can"},null,-1),kt=[yt],Ct={class:"dropdown"},vt={class:"btn btn-outline-info dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Ft={class:"dropdown-menu"},wt=["onClick"],$t={class:"card-body"},St={class:"form-floating mb-1"},It=["onUpdate:modelValue"],Lt=e("label",{for:"floatingInput"},"Ключ",-1),Ot={key:0,class:"form-floating mb-1"},jt=["onUpdate:modelValue"],Tt=e("label",{for:"floatingInput"},"Значение",-1),Vt={key:1,class:"form-check mb-1 mt-2"},qt=["onUpdate:modelValue","id"],Ut=["for"],At={key:2,class:"form-floating mb-3"},Bt=["onUpdate:modelValue"],Pt=e("label",{for:"floatingInput"},"Значение",-1),Nt={key:1,class:"row"},Dt=e("div",{class:"col-12"},[e("p",null,"Параметры скрипта еще не добавлены")],-1),Et=[Dt],Gt={class:"btn btn-outline-primary w-100 mt-2 p-3"},Mt={key:0},Ht={key:1},Jt={props:["item"],data(){return{filters:[],simple:!0,configTypes:[{title:"Текстовый или числовой параметр",type:"text"},{title:"Большое текстовое поле",type:"large-text"},{title:"Канал обратной связи",type:"channel"},{title:"Логический оператор",type:"boolean"}],bot:null,slugForm:{bot_id:null,id:null,command:null,comment:null,slug:null,config:[],is_global:!0}}},computed:{...k(["getCurrentBot"]),filteredConfigs(){return this.filters.length==0?this.slugForm.config:this.slugForm.config.filter(l=>this.filters.indexOf(l.type)>=0)}},mounted(){this.loadCurrentBot(),this.item&&(this.slugForm.id=this.item.id||null,this.slugForm.command=this.item.command,this.slugForm.comment=this.item.comment,this.slugForm.bot_id=this.item.bot_id,this.slugForm.slug=this.item.slug,this.slugForm.config=this.item.config||[],this.slugForm.is_global=this.item.is_global||!1)},methods:{toggleFilter(l){let t=this.filters.indexOf(l);t>=0?this.filters.splice(t,1):this.filters.push(l)},addTextTo(l,t={text:null}){this.slugForm.config[l].value=t.text},loadCurrentBot(l=null){return this.$store.dispatch("updateCurrentBot",{bot:l}).then(()=>{this.bot=this.getCurrentBot})},onChangePhotos(l,t){const o=l.target.files;this.slugForm.config[t].value=o[0]},submit(){let l=new FormData;Object.keys(this.slugForm).forEach(t=>{const o=this.slugForm[t]||"";typeof o=="object"?l.append(t,JSON.stringify(o)):l.append(t,o)}),this.$store.dispatch(this.slugForm.id===null?"createSlug":"updateSlug",{slugForm:l}).then(t=>{this.$notify({title:"Конструктор команд",text:"Команда успешно обновлена",type:"success"}),this.slugForm.id===null&&(this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0),this.$emit("callback")}).catch(t=>{})},addConfig(l){this.slugForm.config.splice(0,0,{key:null,value:null,type:l||"text"})},removeConfigItem(l){try{this.slugForm.config.splice(l,1)}catch{this.slugForm.config=[]}}}},Rt=Object.assign(Jt,{__name:"SlugForm",setup(l){return(t,o)=>(n(),i("form",{onSubmit:o[3]||(o[3]=_((...a)=>t.submit&&t.submit(...a),["prevent"]))},[e("div",x,[d(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=a=>t.slugForm.command=a),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[c,t.slugForm.command]]),tt]),e("div",et,[d(e("input",{type:"text","onUpdate:modelValue":o[1]||(o[1]=a=>t.slugForm.slug=a),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[c,t.slugForm.slug]]),lt]),e("div",st,[d(e("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=a=>t.slugForm.comment=a),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[c,t.slugForm.comment]]),ot]),nt,it,e("div",at,[rt,e("ul",dt,[(n(!0),i(p,null,f(t.configTypes,(a,s)=>(n(),i("li",null,[e("a",{class:"dropdown-item",onClick:r=>t.addConfig(a.type)},g(a.title||"Не установлен"),9,ut)]))),256))])]),e("div",ct,[e("div",gt,[e("p",null,[m("Фильтры: "),(n(!0),i(p,null,f(t.configTypes,(a,s)=>(n(),i("span",{class:b(["badge mb-1 bg-gray-100 cursor-pointer mr-1",{"bg-info":t.filters.indexOf(a.type)>=0}]),onClick:r=>t.toggleFilter(a.type)},g(a.type),11,mt))),256))])])]),t.filteredConfigs.length>0?(n(),i("div",ht,[(n(!0),i(p,null,f(t.filteredConfigs,(a,s)=>(n(),i("div",pt,[e("div",ft,[e("div",bt,[e("button",{onClick:r=>t.removeConfigItem(s),class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},kt,8,_t),t.bot&&t.filteredConfigs[s].type==="channel"?(n(),C(Z,{key:0,token:t.bot.bot_token,onCallback:r=>t.addTextTo(s,r)},null,8,["token","onCallback"])):h("",!0),e("div",null,[e("div",Ct,[e("button",vt,g(t.filteredConfigs[s].type),1),e("ul",Ft,[(n(!0),i(p,null,f(t.configTypes,r=>(n(),i("li",null,[e("a",{class:"dropdown-item",onClick:u=>t.filteredConfigs[s].type=r.type},g(r.title||a.type),9,wt)]))),256))])])])]),e("div",$t,[e("div",St,[d(e("input",{type:"text",class:"form-control","onUpdate:modelValue":r=>t.filteredConfigs[s].key=r,id:"floatingInput",placeholder:"name@example.com",required:""},null,8,It),[[c,t.filteredConfigs[s].key]]),Lt]),t.filteredConfigs[s].type==="text"||t.filteredConfigs[s].type==="channel"?(n(),i("div",Ot,[d(e("input",{type:"text",class:"form-control",id:"floatingInput","onUpdate:modelValue":r=>t.filteredConfigs[s].value=r,placeholder:"name@example.com",required:""},null,8,jt),[[c,t.filteredConfigs[s].value]]),Tt])):h("",!0),t.filteredConfigs[s].type==="boolean"?(n(),i("div",Vt,[d(e("input",{class:"form-check-input","onUpdate:modelValue":r=>t.filteredConfigs[s].value=r,type:"checkbox",value:"false",id:"filtered-config-"+s+"-checkbox"},null,8,qt),[[$,t.filteredConfigs[s].value]]),e("label",{class:"form-check-label",for:"filtered-config-"+s+"-checkbox"},g(t.filteredConfigs[s].value?"Истина":"Ложь"),9,Ut)])):h("",!0),t.filteredConfigs[s].type==="large-text"?(n(),i("div",At,[d(e("textarea",{class:"form-control",id:"floatingInput","onUpdate:modelValue":r=>t.filteredConfigs[s].value=r,placeholder:"name@example.com",required:""},`
                            `,8,Bt),[[c,t.filteredConfigs[s].value]]),Pt])):h("",!0)])])]))),256))])):(n(),i("div",Nt,Et)),e("button",Gt,[t.slugForm.id==null?(n(),i("span",Mt," Сохранить команду ")):(n(),i("span",Ht," Обновить команду "))])],32))}});export{Z as T,Rt as _,Qt as a};
