import{W as B,o as n,q as r,t as e,z as h,D as b,O as w,F as _,B as f,G as y,H as k,v as g,x as $,U as T,N as K,C as p,J as V,A as U}from"./index.es-ce2063b4.js";import{V as q}from"./vue3-json-editor.esm.prod-f7e1c3ed.js";import{_ as M}from"./_plugin-vue_export-helper-c27b6911.js";import{v as F}from"./v4-a960c1f4.js";import{m as S}from"./index-490ab070.js";import{T as j}from"./TelegramChannelHelper-618162e9.js";const O={props:["editedKeyboard","type"],components:{Vue3JsonEditor:q},computed:{uuid(){return F()}},watch:{keyboard:{handler:function(o){this.save()},deep:!0}},data(){return{showCode:!1,showAssign:!1,selectedRow:null,load:!1,rowCount:1,keyboard:[],select:{row:0,col:0,type:this.type||"reply"}}},mounted(){this.editedKeyboard&&this.$nextTick(()=>{this.keyboard=this.editedKeyboard.menu})},methods:{needRemoveField(o,t,s){Object.keys(this.keyboard[t][s]).forEach(i=>{i!=="text"&&i!==o&&delete this.keyboard[t][s][i]})},save(){this.$emit("save",this.keyboard)},onJsonChange(o){this.keyboard=o,this.save()},removeColFromRow(o){this.keyboard[o].length>1?this.keyboard[o].splice(this.keyboard[o].length-1,1):this.keyboard.splice(o,1),this.keyboard.length===0&&(this.selectedRow=null),this.save()},addRowAbove(){this.addRow(!0)},moveCol(o,t=0){o!==this.select.row&&(this.select.row=o,this.select.col=0,this.select.text=this.keyboard[this.select.row][this.select.col].text);let s=this.select.row,i=this.select.col,l=this.keyboard[s].length,c=t===0?i-1>=0?i-1:l-1:i<l-1?i+1:0,v=this.keyboard[s][i];this.keyboard[s][i]=this.keyboard[s][c],this.keyboard[s][c]=v,this.select.row=s,this.select.col=c,this.select.text=this.keyboard[s][c].text},moveRow(o=0){if(this.selectedRow==null)return;let t=this.keyboard.length,s=o===0?this.selectedRow-1>=0?this.selectedRow-1:t-1:this.selectedRow<t-1?this.selectedRow+1:0,i=this.keyboard[this.selectedRow];this.keyboard[this.selectedRow]=this.keyboard[s],this.keyboard[s]=i,this.selectedRow=s,console.log("tmpRow",i)},addRowBelow(){this.addRow(!1)},addRow(o=!1){if(this.selectedRow==null)this.keyboard?this.keyboard.push([{text:"No Text"}]):this.keyboard=[[{text:"No Text"}]],this.selectedRow=null;else{let t=o?this.selectedRow:this.selectedRow+1;this.keyboard.splice(t,0,[{text:"No Text"}])}this.save()},addColToRow(o){this.keyboard[o].push({text:"No Text"}),this.save()},selectIndex(o,t){this.selectedRow=o,this.select.row=o,this.select.col=t,this.select.text=this.keyboard[o][t].text,this.load=!0,this.$nextTick(()=>{this.load=!1})},removeCol(o,t){this.keyboard[o].length>1?this.keyboard[o].splice(t,1):this.keyboard.splice(1,1),this.save()}}},N={class:"container"},J={class:"row"},D={class:"col-12 d-flex justify-content-between"},E=e("i",{class:"fa-solid fa-arrows-up-to-line"},null,-1),A=[E],P=e("i",{class:"fa-solid fa-arrows-down-to-line"},null,-1),L=[P],z=e("i",{class:"fa-solid fa-xmark"},null,-1),G=[z],H={class:"d-flex flex-column"},W={class:"form-check"},Y=["id"],Q=["for"],X={class:"col-12"},Z={class:"row"},I={class:"col-2 d-flex justify-content-around p-2"},x=["onClick"],ee=e("i",{class:"fa-solid fa-plus"},null,-1),te=[ee],oe=["onClick"],se=e("i",{class:"fa-solid fa-minus"},null,-1),le=[se],ie=["onClick"],ne=e("i",{class:"fa-solid fa-caret-left"},null,-1),ae=[ne],de=["onClick"],re=e("i",{class:"fa-solid fa-caret-right"},null,-1),ce=[re],he={class:"col-10 d-flex justify-content-center p-1"},ue={class:"btn-group dropdown-center w-100 m-1"},be=["onClick","onUpdate:modelValue"],me=e("button",{type:"button",class:"btn btn-outline-primary dropdown-toggle dropdown-toggle-split","data-bs-toggle":"dropdown","aria-expanded":"false","data-bs-reference":"parent"},[e("span",{class:"visually-hidden"},"Toggle Dropdown")],-1),ye={class:"dropdown-menu w-100",style:{"min-width":"350px"}},_e={class:"px-4 py-3"},pe=e("div",{class:"alert alert-danger",role:"alert"}," Возможно выбрать только 1 тип действия ",-1),fe={class:"mb-3"},ke=["for"],ve=["onChange","onUpdate:modelValue","id"],ge={class:"mb-3"},$e=["for"],Ce=["onChange","onUpdate:modelValue","id"],we={class:"mb-3"},Fe=["for"],Re=["onChange","onUpdate:modelValue","id"],Te={class:"mb-3"},Ke=["for"],Se=["onChange","onUpdate:modelValue","id"],Be={class:"form-check"},Ve=["onChange","id"],Ue=["for"],qe={key:0,class:"form-check"},Me=["onChange","onClick","id"],je=["for"],Oe={class:"form-check"},Ne=["onChange","onClick","id"],Je=["for"],De={class:"form-check"},Ee=["onChange","onClick","id"],Ae=["for"],Pe={key:0,class:"row"},Le={class:"col-12"},ze=e("label",{class:"form-label",id:"bot-domain"},"JSON-код клавиатуры",-1);function Ge(o,t,s,i,l,c){const v=B("Vue3JsonEditor");return n(),r("div",N,[e("div",J,[e("div",D,[e("div",null,[l.selectedRow==null?(n(),r("button",{key:0,type:"button",class:"btn btn-primary mb-2",onClick:t[0]||(t[0]=(...m)=>c.addRow&&c.addRow(...m))},"Добавить строку ")):h("",!0),l.selectedRow!=null?(n(),r("button",{key:1,type:"button",class:"btn btn-primary mb-2",onClick:t[1]||(t[1]=(...m)=>c.addRowAbove&&c.addRowAbove(...m))},"Добавить строку выше ")):h("",!0),l.selectedRow!=null?(n(),r("button",{key:2,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:t[2]||(t[2]=(...m)=>c.addRowBelow&&c.addRowBelow(...m))},"Добавить строку ниже ")):h("",!0),l.selectedRow!=null?(n(),r("button",{key:3,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:t[3]||(t[3]=m=>c.moveRow(0))},A)):h("",!0),l.selectedRow!=null?(n(),r("button",{key:4,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:t[4]||(t[4]=m=>c.moveRow(1))},L)):h("",!0),l.selectedRow!=null?(n(),r("button",{key:5,type:"button",class:"btn btn-outline-danger mb-2 ml-2",onClick:t[5]||(t[5]=m=>l.selectedRow=null)},G)):h("",!0)]),e("div",H,[e("div",W,[b(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=m=>l.showCode=m),id:"showCode"+c.uuid},null,8,Y),[[w,l.showCode]]),e("label",{class:"form-check-label",for:"showCode"+c.uuid}," Отобразить код ",8,Q)])])]),e("div",X,[(n(!0),r(_,null,f(l.keyboard,(m,a)=>(n(),r("div",Z,[e("div",I,[e("button",{type:"button",class:"btn btn-link w-100",onClick:C=>c.addColToRow(a)},te,8,x),e("button",{type:"button",class:"btn btn-link w-100",onClick:C=>c.removeColFromRow(a)},le,8,oe),e("button",{type:"button",class:"btn btn-link w-100",onClick:C=>c.moveCol(a,0)},ae,8,ie),e("button",{type:"button",class:"btn btn-link w-100",onClick:C=>c.moveCol(a,1)},ce,8,de)]),e("div",he,[(n(!0),r(_,null,f(m,(C,d)=>(n(),r("div",ue,[b(e("input",{type:"text",onClick:u=>c.selectIndex(a,d),class:"btn btn-outline-primary w-100","onUpdate:modelValue":u=>l.keyboard[a][d].text=u},null,8,be),[[y,l.keyboard[a][d].text]]),me,e("ul",ye,[e("form",_e,[pe,e("div",fe,[e("label",{for:"command-row-"+a+"-col-"+d,class:"form-label"},"Команда (для меню в сообщении)",8,ke),b(e("input",{type:"text",onChange:u=>c.needRemoveField("callback_data",a,d),"onUpdate:modelValue":u=>l.keyboard[a][d].callback_data=u,class:"form-control",id:"command-row-"+a+"-col-"+d,placeholder:"/start"},null,40,ve),[[y,l.keyboard[a][d].callback_data]])]),e("div",ge,[e("label",{for:"switch-inline-query-row-"+a+"-col-"+d,class:"form-label"},"Ссылка на аккаунт в ТЕЛЕГРАММ",8,$e),b(e("input",{type:"text",class:"form-control",onChange:u=>c.needRemoveField("switch_inline_query",a,d),"onUpdate:modelValue":u=>l.keyboard[a][d].switch_inline_query=u,id:"switch-inline-query-row-"+a+"-col-"+d,placeholder:"@YourAccountLink"},null,40,Ce),[[y,l.keyboard[a][d].switch_inline_query]])]),e("div",we,[e("label",{for:"url-row-"+a+"-col-"+d,class:"form-label"},"Внешняя URL-ссылка",8,Fe),b(e("input",{type:"text",class:"form-control",onChange:u=>c.needRemoveField("url",a,d),"onUpdate:modelValue":u=>l.keyboard[a][d].url=u,id:"url-row-"+a+"-col-"+d,placeholder:"https://t.me/example"},null,40,Re),[[y,l.keyboard[a][d].url]])]),e("div",Te,[e("label",{for:"switch-inline-query-current-chat-row-"+a+"-col-"+d,class:"form-label"},"Команда всплывающего меню бота",8,Ke),b(e("input",{type:"text",class:"form-control",onChange:u=>c.needRemoveField("switch_inline_query_current_chat",a,d),"onUpdate:modelValue":u=>l.keyboard[a][d].switch_inline_query_current_chat=u,id:"witch-inline-query-current-chat-row-"+a+"-col-"+d,placeholder:"команда"},null,40,Se),[[y,l.keyboard[a][d].switch_inline_query_current_chat]])]),e("div",Be,[e("input",{type:"radio",onChange:u=>c.needRemoveField(null,a,d),name:"request-radio",class:"form-check-input",id:"no-action-row-"+a+"-col-"+d},null,40,Ve),e("label",{class:"form-check-label",for:"no-action-row-"+a+"-col-"+d}," Без действий ",8,Ue)]),a===0?(n(),r("div",qe,[e("input",{type:"radio",onChange:u=>c.needRemoveField("pay",a,d),onClick:u=>l.keyboard[a][d].pay=!0,name:"request-radio",class:"form-check-input",id:"pay-action-row-"+a+"-col-"+d},null,40,Me),e("label",{class:"form-check-label",for:"pay-action-row-"+a+"-col-"+d}," Кнопка оплаты ",8,je)])):h("",!0),e("div",Oe,[e("input",{type:"radio",onChange:u=>c.needRemoveField("request_contact",a,d),onClick:u=>l.keyboard[a][d].request_contact=!0,name:"request-radio",class:"form-check-input",id:"phone-row-"+a+"-col-"+d},null,40,Ne),e("label",{class:"form-check-label",for:"phone-row-"+a+"-col-"+d}," Запросить телефон (для нижнего меню) ",8,Je)]),e("div",De,[e("input",{type:"radio",name:"request-radio",onChange:u=>c.needRemoveField("request_location",a,d),onClick:u=>l.keyboard[a][d].request_location=!0,class:"form-check-input",id:"location-row-"+a+"-col-"+d},null,40,Ee),e("label",{class:"form-check-label",for:"location-row-"+a+"-col-"+d}," Запросить локацию (для нижнего меню) ",8,Ae)])])])]))),256))])]))),256))])]),l.showCode?(n(),r("div",Pe,[e("div",Le,[ze,l.load?h("",!0):(n(),k(v,{key:0,mode:"code",modelValue:l.keyboard,"onUpdate:modelValue":t[7]||(t[7]=m=>l.keyboard=m),"show-btns":!1,expandedOnStart:!0,onJsonChange:c.onJsonChange},null,8,["modelValue","onJsonChange"]))])])):h("",!0)])}const R=M(O,[["render",Ge]]);const He={class:"card"},We={key:0,class:"card-header d-flex justify-content-between align-items-center"},Ye=["disabled"],Qe=e("i",{class:"fa-solid fa-arrow-left"},null,-1),Xe=[Qe],Ze=["data-bs-target","disabled"],Ie=e("i",{class:"fa-regular fa-pen-to-square"},null,-1),xe=[Ie],et=["disabled"],tt=e("i",{class:"fa-regular fa-floppy-disk"},null,-1),ot=[tt],st={key:1,class:"card-header d-flex justify-content-between align-items-center"},lt={class:"mr-2"},it=["data-bs-target","disabled"],nt=e("i",{class:"fa-regular fa-pen-to-square"},null,-1),at=[nt],dt=["disabled"],rt=e("i",{class:"fa-regular fa-clone"},null,-1),ct=[rt],ht=["disabled"],ut=e("i",{class:"fa-regular fa-floppy-disk"},null,-1),bt=[ut],mt=["disabled"],yt=e("i",{class:"fa-solid fa-trash-can"},null,-1),_t=[yt],pt={class:"card-body"},ft={key:0,class:"row"},kt={class:"col-md-6 col-12"},vt={class:"mb-3"},gt=e("label",{class:"form-label",id:"bot-domain"},"Тип",-1),$t=e("option",{value:"reply"},"Нижняя клавиатура",-1),Ct=e("option",{value:"inline"},"Встроенная клавиатура",-1),wt=[$t,Ct],Ft={class:"col-md-6 col-12"},Rt={class:"mb-3"},Tt=e("label",{class:"form-label",id:"bot-domain"},"Мнемоническое имя",-1),Kt={class:"row"},St={class:"col-12"},Bt={class:"row"},Vt={class:"col-12"},Ut={class:"row"},qt={class:"col"},Mt={type:"button",class:"btn btn-outline-primary w-100 mb-2"},jt=["id"],Ot={class:"modal-dialog modal-fullscreen"},Nt={class:"modal-content"},Jt=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"open-construct-label"},"Визуальный редактор клавиатуры"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Dt={class:"modal-body"},Et=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),At={props:["keyboard","selectMode"],data:()=>({is_edited:!1,load:!1,keyboardForm:null}),computed:{uuid(){return F()}},watch:{keyboardForm:{handler(o){this.is_edited=!0},deep:!0}},mounted(){const o=this.keyboard;this.keyboardForm=o,this.$nextTick(()=>{this.is_edited=!1})},methods:{removeKeyboard(){this.$store.dispatch("removeKeyboardTemplate",{templateId:this.keyboardForm.id}).then(o=>{this.load=!0,this.$nextTick(()=>{this.load=!1}),this.$emit("callback",this.keyboardForm.id)}).catch(()=>{this.$emit("callback",this.keyboardForm.id)})},saveKeyboard(o){this.keyboardForm.menu=o},selectCard(){this.$emit("select",this.keyboardForm)},duplicateKeyboard(){let o=new FormData;Object.keys(this.keyboardForm).forEach(t=>{const s=this.keyboardForm[t]||"";typeof s=="object"?o.append(t,JSON.stringify(s)):o.append(t,s)}),this.$store.dispatch("createKeyboardTemplate",{keyboardForm:o}).then(t=>{this.$notify({title:"Конструктор ботов",text:"Меню успешно продублировано!",type:"success"}),this.load=!0,this.$nextTick(()=>{this.load=!1}),this.$emit("reload")})},updateKeyboard(){let o=new FormData;Object.keys(this.keyboardForm).forEach(t=>{const s=this.keyboardForm[t]||"";typeof s=="object"?o.append(t,JSON.stringify(s)):o.append(t,s)}),this.$store.dispatch("editKeyboardTemplate",{keyboardForm:o}).then(t=>{this.load=!0,this.$nextTick(()=>{this.load=!1,this.is_edited=!1}),this.$emit("callback")}).catch(()=>{this.is_edited=!0})}}},Pt=Object.assign(At,{__name:"KeyboardCard",setup(o){return(t,s)=>(n(),r(_,null,[e("div",He,[o.selectMode?(n(),r("div",We,[e("div",null,[e("button",{onClick:s[0]||(s[0]=(...i)=>t.selectCard&&t.selectCard(...i)),disabled:t.load,type:"button",class:"btn btn-outline-success mr-2"},Xe,8,Ye),e("button",{"data-bs-toggle":"modal","data-bs-target":"#open-construct-"+t.uuid,disabled:t.load,type:"button",title:"Редактировать клавиатуру",class:"btn btn-outline-success mr-2"},xe,8,Ze),e("button",{onClick:s[1]||(s[1]=(...i)=>t.updateKeyboard&&t.updateKeyboard(...i)),type:"button",title:"Обновить клавиатуру",disabled:t.load||!t.is_edited,class:g(["btn btn-outline-primary mr-2",{"have-change":t.is_edited}])},ot,10,et)])])):h("",!0),o.selectMode?h("",!0):(n(),r("div",st,[e("div",null,[e("strong",lt,"#"+$(o.keyboard.id),1),e("button",{"data-bs-toggle":"modal","data-bs-target":"#open-construct-"+t.uuid,disabled:t.load,type:"button",title:"Редактировать клавиатуру",class:"btn btn-outline-success mr-2"},at,8,it),e("button",{onClick:s[2]||(s[2]=(...i)=>t.duplicateKeyboard&&t.duplicateKeyboard(...i)),type:"button",title:"Дублировать клавиатуру",disabled:t.load,class:"btn btn-outline-primary mr-2"},ct,8,dt),e("button",{onClick:s[3]||(s[3]=(...i)=>t.updateKeyboard&&t.updateKeyboard(...i)),type:"button",title:"Обновить клавиатуру",disabled:t.load||!t.is_edited,class:g(["btn btn-outline-primary mr-2",{"have-change":t.is_edited}])},bt,10,ht)]),e("button",{onClick:s[4]||(s[4]=(...i)=>t.removeKeyboard&&t.removeKeyboard(...i)),type:"button",disabled:t.load,title:"Удалить клавиатуру",class:"btn btn-outline-danger mr-2"},_t,8,mt)])),e("div",pt,[o.selectMode?h("",!0):(n(),r("div",ft,[e("div",kt,[e("div",vt,[gt,b(e("select",{disabled:!0,"onUpdate:modelValue":s[5]||(s[5]=i=>o.keyboard.type=i),class:"form-control"},wt,512),[[T,o.keyboard.type]])])]),e("div",Ft,[e("div",Rt,[Tt,b(e("input",{type:"text",class:"form-control",placeholder:"Мнемоническое имя",disabled:!0,"aria-label":"Мнемоническое имя","onUpdate:modelValue":s[6]||(s[6]=i=>o.keyboard.slug=i),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[y,o.keyboard.slug]])])])])),e("div",Kt,[e("div",St,[e("div",Bt,[e("div",Vt,[(n(!0),r(_,null,f(o.keyboard.menu,(i,l)=>(n(),r("div",Ut,[(n(!0),r(_,null,f(i,(c,v)=>(n(),r("div",qt,[e("button",Mt,$(c.text),1)]))),256))]))),256))])])])])])]),e("div",{class:"modal fade",id:"open-construct-"+t.uuid,tabindex:"-1","aria-labelledby":"open-construct-label","aria-hidden":"true"},[e("div",Ot,[e("div",Nt,[Jt,e("div",Dt,[t.keyboardForm?(n(),k(R,{key:0,onSave:t.saveKeyboard,"edited-keyboard":t.keyboardForm},null,8,["onSave","edited-keyboard"])):h("",!0)]),Et])])],8,jt)],64))}}),Lt={key:0,class:"row mb-2"},zt={class:"col-12"},Gt={class:"card"},Ht=e("div",{class:"card-header"},[e("h6",null,"Форма создания шаблона клавиатуры")],-1),Wt={class:"card-body"},Yt={class:"col-md-6 col-12"},Qt={class:"mb-3"},Xt=e("label",{class:"form-label",id:"bot-domain"},"Тип",-1),Zt=e("option",{value:"reply"},"Нижняя клавиатура",-1),It=e("option",{value:"inline"},"Встроенная клавиатура",-1),xt=[Zt,It],eo={class:"col-md-6 col-12"},to={class:"mb-3"},oo={class:"form-label d-flex justify-content-between",id:"bot-domain"},so=e("span",null,"Мнемоническое имя",-1),lo=e("i",{class:"fa-solid fa-arrows-rotate"},null,-1),io=[lo],no={class:"col-12"},ao=e("div",{class:"col-12"},[e("button",{class:"btn btn-outline-success w-100 p-3"}," Добавить новый шаблон клавиатуры ")],-1),ro={class:"row"},co={key:0,class:"col-12"},ho={class:"badge bg-warning"},uo={class:"col-12 mb-3"},bo={key:1,class:"card"},mo={class:"card-body"},yo={key:2,class:"col-12 mb-3"},_o=e("div",{class:"alert alert-warning",role:"alert"},[e("p",null,"Список шаблонов клавиатур пуст!")],-1),po=[_o],fo={props:["selectMode","type"],data(){return{keyboards:[],load:!1,bot:null,editedKeyboard:null,selectMenuIndex:null,keyboardForm:{type:"reply",bot_id:null,slug:null,menu:[]}}},computed:{...S(["getCurrentBot"]),filteredKeyboard(){return this.type?this.keyboards.filter(o=>o.type==this.type):this.keyboards}},mounted(){this.loadCurrentBot().then(()=>{this.loadMenusByBotTemplate(),this.generateSlug()})},methods:{selectCard(o){this.$emit("select",o)},keyboardCallbackAction(o){let t=this.keyboards.find(s=>s.id===o);t.deleted_at=new Date,this.loadMenusByBotTemplate()},loadMenusByBotTemplate(){this.$store.dispatch("loadBotKeyboards",{botId:this.bot.id}).then(o=>{this.keyboards=o.data})},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},submitKeyboard(){this.keyboardForm.bot_id=this.bot.id;let o=new FormData;Object.keys(this.keyboardForm).forEach(t=>{const s=this.keyboardForm[t]||"";typeof s=="object"?o.append(t,JSON.stringify(s)):o.append(t,s)}),this.$store.dispatch("createKeyboardTemplate",{keyboardForm:o}).then(t=>{this.keyboardForm={type:"reply",bot_id:null,slug:null,menu:[]},this.load=!0,this.$nextTick(()=>{this.load=!1}),this.loadMenusByBotTemplate()})},generateSlug(){this.keyboardForm.slug=F()},changeKeyboardFormMenu(o){this.keyboardForm.menu=o}}},ko=Object.assign(fo,{__name:"KeyboardList",setup(o){return(t,s)=>(n(),r(_,null,[o.selectMode?h("",!0):(n(),r("div",Lt,[e("div",zt,[e("div",Gt,[Ht,e("div",Wt,[e("form",{onSubmit:s[3]||(s[3]=K((...i)=>t.submitKeyboard&&t.submitKeyboard(...i),["prevent"])),class:"row"},[e("div",Yt,[e("div",Qt,[Xt,b(e("select",{"onUpdate:modelValue":s[0]||(s[0]=i=>t.keyboardForm.type=i),class:"form-control"},xt,512),[[T,t.keyboardForm.type]])])]),e("div",eo,[e("div",to,[e("label",oo,[so,e("a",{onClick:s[1]||(s[1]=(...i)=>t.generateSlug&&t.generateSlug(...i)),href:"#generate"},io)]),b(e("input",{type:"text",class:"form-control",placeholder:"Мнемоническое имя","aria-label":"Мнемоническое имя","onUpdate:modelValue":s[2]||(s[2]=i=>t.keyboardForm.slug=i),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[y,t.keyboardForm.slug]])])]),e("div",no,[t.load?h("",!0):(n(),k(R,{key:0,onSave:t.changeKeyboardFormMenu,"edited-keyboard":t.keyboardForm},null,8,["onSave","edited-keyboard"]))]),ao],32)])])])])),e("div",ro,[t.keyboards&&t.bot?(n(),r("div",co,[e("p",null,[p("В списке клавиатур "),e("span",ho,$(t.filteredKeyboard.length)+" ед.",1)])])):h("",!0),t.keyboards&&t.bot?(n(!0),r(_,{key:1},f(t.filteredKeyboard,(i,l)=>(n(),r("div",uo,[i.deleted_at?(n(),r("div",bo,[e("div",mo,[e("p",null,"Удаленная клавиатура #"+$(i.id),1)])])):(n(),k(Pt,{key:0,"select-mode":o.selectMode,onSelect:t.selectCard,onReload:t.loadMenusByBotTemplate,onCallback:t.keyboardCallbackAction,keyboard:i},null,8,["select-mode","onSelect","onReload","onCallback","keyboard"]))]))),256)):h("",!0),t.filteredKeyboard.length===0?(n(),r("div",yo,po)):h("",!0)])],64))}}),vo={class:"col-md-12 col-12"},go={class:"mb-3"},$o=e("i",{class:"fa-solid fa-xmark"},null,-1),Co=[$o],wo={class:"mb-3"},Fo={class:"d-flex justify-content-between flex-wrap al"},Ro=e("label",{class:"form-label",id:"bot-main-channel"},"Канал для постов (id,рекламный)",-1),To={class:"d-flex flex-wrap align-items-center"},Ko=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),So={class:"col-12 mb-2"},Bo=e("label",{class:"form-label d-flex justify-content-between align-items-center mb-2",id:"bot-domain"},[p(" Текстовое содержимое страницы "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),Vo={class:"form-floating"},Uo={for:"floatingTextarea2"},qo={key:0},Mo={class:"col-12 mb-2"},jo={class:"form-check"},Oo=e("label",{class:"form-check-label",for:"need-page-images"}," Изображения на странице (максимум 10) ",-1),No={key:0,class:"col-12 mb-2"},Jo={class:"card mb-3"},Do=e("div",{class:"card-header"},[e("h6",null,"Изображения на странице")],-1),Eo={class:"card-body d-flex justify-content-start"},Ao={for:"photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},Po={class:"row"},Lo={key:0,class:"col-12 d-flex flex-wrap"},zo={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Go={class:"remove"},Ho=["onClick"],Wo={class:"col-12 mb-2"},Yo={class:"form-check"},Qo=e("label",{class:"form-check-label",for:"need-inline-menu"}," Меню под текстом страницы ",-1),Xo={key:1,class:"col-12 mb-2"},Zo={class:"card"},Io={class:"card-header d-flex justify-between align-items-center"},xo=e("h6",null,"Конструктор меню в сообщении",-1),es={key:0},ts={key:1},os={class:"card-body"},ss=e("div",{class:"col-12"},[e("button",{type:"submit",class:"btn btn-success w-100 p-3"}," Отправить сообщение в канал ")],-1),ls={data(){return{load:!1,photos:[],showInlineTemplateSelector:!1,need_page_images:!1,need_inline_menu:!1,bot:null,mailForm:{text:"",inline_keyboard:null,channel:null}}},computed:{...S(["getCurrentBot"])},mounted(){this.loadCurrentBot()},methods:{addTextTo(o={param:null,text:null}){this.mailForm.channel=o.text},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},submitMail(){let o=new FormData;if(Object.keys(this.mailForm).forEach(t=>{const s=this.mailForm[t]||"";typeof s=="object"?o.append(t,JSON.stringify(s)):o.append(t,s)}),this.bot&&o.append("bot_id",this.bot.id),this.photos.length>0)for(let t=0;t<this.photos.length;t++)o.append("photos[]",this.photos[t]);this.$store.dispatch("sendToChannel",{mailForm:o}).then(t=>{this.load=!0,this.photos=[],this.need_inline_menu=!1,this.need_page_images=!1,this.mailForm={text:"",channel:null,inline_keyboard:null},this.$notify({title:"Конструктор ботов",text:"Сообщение успещно отправлено!",type:"success"})}).catch(t=>{})},saveInlineKeyboard(o){this.mailForm.inline_keyboard=o},selectInlineKeyboard(o){this.mailForm.inline_keyboard=o,this.showInlineTemplateSelector=!1},getPhoto(o){return{imageUrl:URL.createObjectURL(o)}},removePhoto(o){this.photos.splice(o,1)},removeImage(o){this.mailForm.images.splice(o,1)},onChangePhotos(o){const t=o.target.files;for(let s=0;s<t.length;s++)this.photos.push(t[s])}}},hs=Object.assign(ls,{__name:"Mail",setup(o){return(t,s)=>{const i=V("lazy");return t.bot?(n(),r("form",{key:0,onSubmit:s[9]||(s[9]=K((...l)=>t.submitMail&&t.submitMail(...l),["prevent"]))},[e("div",vo,[e("div",go,[t.mailForm.channel!=null?(n(),r("button",{key:0,type:"button",class:"btn btn-outline-info",onClick:s[0]||(s[0]=l=>t.mailForm.channel=null)},Co)):h("",!0),p(" , "),e("button",{type:"button",class:g(["btn",{"btn-info":t.mailForm.channel===t.bot.main_channel,"btn-outline-info":t.mailForm.channel!==t.bot.main_channel}]),onClick:s[1]||(s[1]=l=>t.mailForm.channel=t.bot.main_channel)},"Главный канал ",2),p(" , "),e("button",{type:"button",class:g(["btn",{"btn-info":t.mailForm.channel===t.bot.order_channel,"btn-outline-info":t.mailForm.channel!==t.bot.order_channel}]),onClick:s[2]||(s[2]=l=>t.mailForm.channel=t.bot.order_channel)},"Канал заказов ",2)]),e("div",wo,[e("div",Fo,[Ro,e("div",To,[U(j,{token:t.bot.bot_token,param:"channel",onCallback:t.addTextTo},null,8,["token","onCallback"]),Ko])]),b(e("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":s[3]||(s[3]=l=>t.mailForm.channel=l),maxlength:"255","aria-describedby":"bot-main-channel",required:""},null,512),[[y,t.mailForm.channel]])])]),e("div",So,[Bo,e("div",Vo,[b(e("textarea",{class:"form-control","onUpdate:modelValue":s[4]||(s[4]=l=>t.mailForm.text=l),maxlength:"4096",placeholder:"Введите текст",id:"floatingTextarea2",style:{"min-height":"100px"},required:""},null,512),[[y,t.mailForm.text]]),e("label",Uo,[p("Содержимое страницы "),t.mailForm.text?(n(),r("span",qo,$(t.mailForm.text.length)+"/4096 ",1)):h("",!0)])])]),e("div",Mo,[e("div",jo,[b(e("input",{class:"form-check-input","onUpdate:modelValue":s[5]||(s[5]=l=>t.need_page_images=l),type:"checkbox",id:"need-page-images"},null,512),[[w,t.need_page_images]]),Oo])]),t.need_page_images?(n(),r("div",No,[e("div",Jo,[Do,e("div",Eo,[e("label",Ao,[p(" + "),e("input",{type:"file",id:"photos",multiple:"",accept:"image/*",onChange:s[6]||(s[6]=(...l)=>t.onChangePhotos&&t.onChangePhotos(...l)),style:{display:"none"}},null,32)]),e("div",Po,[t.photos.length>0?(n(),r("div",Lo,[(n(!0),r(_,null,f(t.photos,(l,c)=>(n(),r("div",zo,[b(e("img",null,null,512),[[i,t.getPhoto(l).imageUrl]]),e("div",Go,[e("a",{onClick:v=>t.removePhoto(c)},"Удалить",8,Ho)])]))),256))])):h("",!0)])])])])):h("",!0),e("div",Wo,[e("div",Yo,[b(e("input",{class:"form-check-input","onUpdate:modelValue":s[7]||(s[7]=l=>t.need_inline_menu=l),type:"checkbox",id:"need-inline-menu"},null,512),[[w,t.need_inline_menu]]),Qo])]),t.need_inline_menu?(n(),r("div",Xo,[e("div",Zo,[e("div",Io,[xo,e("button",{class:g(["btn",{"btn-outline-primary":!t.showInlineTemplateSelector,"btn-primary":t.showInlineTemplateSelector}]),type:"button",onClick:s[8]||(s[8]=l=>t.showInlineTemplateSelector=!t.showInlineTemplateSelector)},[t.showInlineTemplateSelector?(n(),r("span",ts," Скрыть шаблоны меню")):(n(),r("span",es," Открыть шаблоны меню"))],2)]),e("div",os,[t.showInlineTemplateSelector?(n(),k(ko,{key:0,class:"mb-2",type:"inline",onSelect:t.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(n(),k(R,{key:1,type:"inline",onSave:t.saveInlineKeyboard,"edited-keyboard":t.mailForm.inline_keyboard},null,8,["onSave","edited-keyboard"]))])])])):h("",!0),ss],32)):h("",!0)}}});export{R as B,ko as _,hs as a};
