import{o as s,q as a,t,D as u,G as m,F as f,B as p,v as b,C as h,x as g,H as y,z as c,J as w,O as S,A as _,u as V,y as j,N as k,W as O,M as C}from"./index.es-ce2063b4.js";import{V as $,T as U}from"./TelegramChannelHelper-03e7b968.js";import{P as F}from"./Pagination-e8ce4012.js";import{m as v}from"./index-490ab070.js";const M={class:"row"},P={class:"input-group mb-3"},B={key:0,class:"row"},A={class:"col-12 col-md-12 mb-3"},I={class:"list-group"},N=["onClick"],T={class:"ms-2 me-auto w-100"},G={class:"fw-bold"},J={class:"badge bg-info rounded-pill"},D={class:"w-100"},L={class:"d-flex justify-content-between"},q=["onClick"],E=["onClick"],z={style:{position:"absolute",right:"10px"},class:"badge bg-primary rounded-pill"},H={class:"col-12"},W={key:1,class:"row"},K=t("div",{class:"col-12"},[t("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет медиа-файлов ")],-1),Q=[K],R={props:["selected","needVideo","needVideoNote","needPhoto","needAudio","needDocument","needSticker"],data(){return{bot:null,loading:!0,media:[],search:null,media_paginate_object:null}},computed:{...v(["getMedia","getMediaPaginateObject","getCurrentBot"])},mounted(){this.loadCurrentBot().then(()=>{this.loadMedia()})},methods:{selectMedia(o){this.$emit("select",o)},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},nextMedia(o){this.loadMedia(o)},remove(o){this.$store.dispatch("removeMedia",{dataObject:{mediaId:o}}).then(e=>{this.loadMedia(),this.$notify({title:"Удаление медиа-контента",text:"Медиа контент удален"})}).catch(()=>{})},showPreview(o){this.$store.dispatch("showMediaPreview",{dataObject:{mediaId:o}}).then(e=>{this.$notify({title:"Превью медиа-контента",text:"Отправлено в бота"})}).catch(()=>{})},loadMedia(o=0){this.loading=!0,this.$store.dispatch("loadMedia",{dataObject:{botId:this.bot.id||null,search:this.search,needVideo:this.needVideo||!1,needVideoNote:this.needVideoNote||!1,needPhoto:this.needPhoto||!1,needAudio:this.needAudio||!1,needDocument:this.needDocument||!1,needSticker:this.needSticker||!1},page:o}).then(e=>{this.loading=!1,this.media=this.getMedia,this.media_paginate_object=this.getMediaPaginateObject}).catch(()=>{this.loading=!1})}}},X=Object.assign(R,{__name:"BotMediaList",setup(o){return(e,d)=>(s(),a(f,null,[t("div",M,[t("div",P,[u(t("input",{type:"search",class:"form-control",placeholder:"Поиск файла","aria-label":"Поиск файла","onUpdate:modelValue":d[0]||(d[0]=r=>e.search=r)},null,512),[[m,e.search]]),t("button",{class:"btn btn-outline-secondary",onClick:d[1]||(d[1]=r=>e.loadMedia(0)),type:"button",id:"button-addon2"},"Найти ")])]),e.media.length>0?(s(),a("div",B,[t("div",A,[t("ul",I,[(s(!0),a(f,null,p(e.media,(r,i)=>(s(),a("li",{onClick:l=>e.selectMedia(r),class:b([{"border-info":o.selected.indexOf(r.file_id)!=-1},"list-group-item d-flex justify-content-between align-items-start"])},[t("div",T,[t("div",G,[h(g(r.caption??"Без подписи")+" ",1),t("span",J,g(r.type),1)]),t("small",D,g(r.file_id),1),t("div",L,[t("a",{href:"javascript:void(0)",class:"btn btn-link p-0 my-2",onClick:l=>e.showPreview(r.id)},"Показать превью",8,q),t("a",{href:"javascript:void(0)",class:"btn btn-link p-0 my-2 text-danger",onClick:l=>e.remove(r.id)},"Удалить",8,E)])]),t("span",z,"#"+g(r.id),1)],10,N))),256))])]),t("div",H,[e.media_paginate_object?(s(),y(F,{key:0,onPagination_page:e.nextMedia,pagination:e.media_paginate_object},null,8,["onPagination_page","pagination"])):c("",!0)])])):(s(),a("div",W,Q))],64))}}),Y={class:"form-floating mb-3"},Z=t("label",{for:"floatingInput"},"Команда",-1),x={class:"form-floating mb-3"},ee=t("label",{for:"floatingInput"},"Мнемоническое имя",-1),te={class:"form-floating mb-3"},oe=t("label",{for:"floatingInput"},"Описание скрипта",-1),le=t("h6",null," Параметры скрипта ",-1),se=t("div",{class:"alert alert-info",role:"alert"}," Данные параметры используются для настройки скриптов на стороне сервера ",-1),ie={class:"dropdown"},ne=t("button",{class:"btn btn-outline-info w-100 dropdown-toggle mb-2",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," Добавить ",-1),ae={class:"dropdown-menu w-100"},de=["onClick"],re={class:"row"},ue={class:"col-12"},ce=["onClick"],ge={key:0,class:"row"},me={class:"col-md-6 mb-1"},he={class:"card"},fe={class:"card-header d-flex justify-content-between align-items-center"},pe=["onClick"],be=t("i",{class:"fa-solid fa-trash-can"},null,-1),_e=[be],ye=["onClick"],ve=t("i",{class:"fa-solid fa-caret-left"},null,-1),Ce=[ve],ke=["onClick"],$e=t("i",{class:"fa-solid fa-caret-right"},null,-1),Fe=[$e],we={class:"dropdown"},Se={class:"btn btn-outline-info dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Ve={class:"dropdown-menu"},je=["onClick"],Oe={class:"card-body"},Ue={class:"form-floating mb-1"},Me=["onUpdate:modelValue","id"],Pe=["for"],Be={key:0,class:"form-floating mb-1"},Ae=["id","onUpdate:modelValue"],Ie=["for"],Ne={key:1,class:"form-check mb-1 mt-2"},Te=["onUpdate:modelValue","id"],Ge=["for"],Je={key:2,class:"form-floating mb-1 mt-2"},De=["onUpdate:modelValue","id"],Le=["for"],qe={key:3,class:"form-floating mb-1 mt-2"},Ee=["onUpdate:modelValue","id"],ze=["for"],He={key:4,class:"form-floating mb-1 mt-2"},We=t("label",{class:"form-label",id:"bot-domain"},"JSON-код",-1),Ke={key:5,class:"form-check mb-1 mt-2"},Qe=["onUpdate:modelValue","id"],Re=["for"],Xe={key:6,class:"form-floating mb-3"},Ye=["id","onUpdate:modelValue"],Ze=["for"],xe={key:7,class:"form-floating mb-3"},et=["id","onUpdate:modelValue"],tt=["for"],ot={key:1,class:"row"},lt=t("div",{class:"col-12"},[t("p",null,"Параметры скрипта еще не добавлены")],-1),st=[lt],it={class:"btn btn-outline-primary w-100 mt-2 p-3"},nt={key:0},at={key:1},dt={props:["item"],components:{Vue3JsonEditor:$},data(){return{filters:[],simple:!0,configTypes:[{title:"Текстовый или числовой параметр",type:"text"},{title:"Большое текстовое поле",type:"large-text"},{title:"Канал обратной связи",type:"channel"},{title:"Логический оператор",type:"boolean"},{title:"Ссылка на изображение",type:"image"},{title:"Цвет",type:"color"},{title:"Geo",type:"geo"},{title:"Номер телефона",type:"phone"},{title:"JSON",type:"json"}],bot:null,photos:[],slugForm:{bot_id:null,id:null,command:null,comment:null,slug:null,config:[],is_global:!0}}},computed:{...v(["getCurrentBot"]),filteredConfigs(){return this.filters.length==0?this.slugForm.config:this.slugForm.config.filter(o=>this.filters.indexOf(o.type)>=0)}},mounted(){this.loadCurrentBot(),this.item&&(this.slugForm.id=this.item.id||null,this.slugForm.command=this.item.command,this.slugForm.comment=this.item.comment,this.slugForm.bot_id=this.item.bot_id,this.slugForm.slug=this.item.slug,this.slugForm.config=this.item.config||[],this.slugForm.is_global=this.item.is_global||!1)},methods:{toggleFilter(o){let e=this.filters.indexOf(o);e>=0?this.filters.splice(e,1):this.filters.push(o)},addTextTo(o,e={text:null}){this.slugForm.config[o].value=e.text},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},submit(){let o=new FormData;Object.keys(this.slugForm).forEach(e=>{const d=this.slugForm[e]||"";typeof d=="object"?o.append(e,JSON.stringify(d)):o.append(e,d)}),this.$store.dispatch(this.slugForm.id===null?"createSlug":"updateSlug",{slugForm:o}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно обновлена",type:"success"}),this.slugForm.id===null&&(this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0),this.$emit("callback")}).catch(e=>{})},onJsonChange(o,e){this.filteredConfigs[e].value=o},addConfig(o){this.slugForm.config.splice(0,0,{key:null,value:null,type:o||"text"})},move(o,e=0){let d=this.slugForm.config[o],r=this.slugForm.config.length||0,i=e===0?o-1>=0?o-1:r-1:o<r-1?o+1:0;this.slugForm.config[o]=this.slugForm.config[i],this.slugForm.config[i]=d},removeConfigItem(o){try{this.slugForm.config.splice(o,1)}catch{this.slugForm.config=[]}},selectPhoto(o,e){this.filteredConfigs[e].value=o.file_id}}},Pt=Object.assign(dt,{__name:"SlugForm",setup(o){return(e,d)=>{const r=w("mask");return s(),a("form",{onSubmit:d[3]||(d[3]=k((...i)=>e.submit&&e.submit(...i),["prevent"]))},[t("div",Y,[u(t("input",{type:"text","onUpdate:modelValue":d[0]||(d[0]=i=>e.slugForm.command=i),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[m,e.slugForm.command]]),Z]),t("div",x,[u(t("input",{type:"text","onUpdate:modelValue":d[1]||(d[1]=i=>e.slugForm.slug=i),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[m,e.slugForm.slug]]),ee]),t("div",te,[u(t("input",{type:"text","onUpdate:modelValue":d[2]||(d[2]=i=>e.slugForm.comment=i),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[m,e.slugForm.comment]]),oe]),le,se,t("div",ie,[ne,t("ul",ae,[(s(!0),a(f,null,p(e.configTypes,(i,l)=>(s(),a("li",null,[t("a",{class:"dropdown-item",onClick:n=>e.addConfig(i.type)},g(i.title||"Не установлен"),9,de)]))),256))])]),t("div",re,[t("div",ue,[t("p",null,[h("Фильтры: "),(s(!0),a(f,null,p(e.configTypes,(i,l)=>(s(),a("span",{class:b(["badge mb-1 bg-gray-100 cursor-pointer mr-1",{"bg-info":e.filters.indexOf(i.type)>=0}]),onClick:n=>e.toggleFilter(i.type)},g(i.type),11,ce))),256))])])]),e.filteredConfigs.length>0?(s(),a("div",ge,[(s(!0),a(f,null,p(e.filteredConfigs,(i,l)=>(s(),a("div",me,[t("div",he,[t("div",fe,[t("div",null,[t("button",{onClick:n=>e.removeConfigItem(l),class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},_e,8,pe),t("button",{onClick:n=>e.move(l,0),style:{"margin-left":"5px"},class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Ce,8,ye),t("button",{onClick:n=>e.move(l,1),style:{"margin-left":"5px"},class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Fe,8,ke)]),e.bot&&e.filteredConfigs[l].type==="channel"?(s(),y(U,{key:0,token:e.bot.bot_token,onCallback:n=>e.addTextTo(l,n)},null,8,["token","onCallback"])):c("",!0),t("div",null,[t("div",we,[t("button",Se,g(e.filteredConfigs[l].type),1),t("ul",Ve,[(s(!0),a(f,null,p(e.configTypes,n=>(s(),a("li",null,[t("a",{class:"dropdown-item",onClick:Vt=>e.filteredConfigs[l].type=n.type},g(n.title||i.type),9,je)]))),256))])])])]),t("div",Oe,[t("div",Ue,[u(t("input",{type:"text",class:"form-control","onUpdate:modelValue":n=>e.filteredConfigs[l].key=n,id:"field-input-key-"+l,placeholder:"name@example.com"},null,8,Me),[[m,e.filteredConfigs[l].key]]),t("label",{for:"field-input-key-"+l},"Ключ",8,Pe)]),e.filteredConfigs[l].type==="text"||e.filteredConfigs[l].type==="channel"?(s(),a("div",Be,[u(t("input",{type:"text",class:"form-control",id:"field-input-"+l,"onUpdate:modelValue":n=>e.filteredConfigs[l].value=n,placeholder:"name@example.com"},null,8,Ae),[[m,e.filteredConfigs[l].value]]),t("label",{for:"field-input-"+l},"Значение",8,Ie)])):c("",!0),e.filteredConfigs[l].type==="boolean"?(s(),a("div",Ne,[u(t("input",{class:"form-check-input","onUpdate:modelValue":n=>e.filteredConfigs[l].value=n,type:"checkbox",value:"false",id:"filtered-config-"+l+"-checkbox"},null,8,Te),[[S,e.filteredConfigs[l].value]]),t("label",{class:"form-check-label",for:"filtered-config-"+l+"-checkbox"},g(e.filteredConfigs[l].value?"Истина":"Ложь"),9,Ge)])):c("",!0),e.filteredConfigs[l].type==="geo"?(s(),a("div",Je,[u(t("input",{class:"form-control",placeholder:"##.######,##.######","onUpdate:modelValue":n=>e.filteredConfigs[l].value=n,type:"text",id:"filtered-config-"+l+"-geo"},null,8,De),[[r,"##.######,##.######"],[m,e.filteredConfigs[l].value]]),t("label",{for:"filtered-config-"+l+"-geo"},"Значение",8,Le)])):c("",!0),e.filteredConfigs[l].type==="phone"?(s(),a("div",qe,[u(t("input",{class:"form-control",placeholder:"+7(###)###-##-##","onUpdate:modelValue":n=>e.filteredConfigs[l].value=n,type:"text",id:"filtered-config-"+l+"-phone"},null,8,Ee),[[r,"+7(###)###-##-##"],[m,e.filteredConfigs[l].value]]),t("label",{for:"filtered-config-"+l+"-phone"},"Значение",8,ze)])):c("",!0),e.filteredConfigs[l].type==="json"?(s(),a("div",He,[We,_(V($),{mode:"form",modelValue:e.filteredConfigs[l].value,"onUpdate:modelValue":n=>e.filteredConfigs[l].value=n,"show-btns":!1,expandedOnStart:!0,onJsonChange:n=>e.onJsonChange(n,l)},null,8,["modelValue","onUpdate:modelValue","onJsonChange"])])):c("",!0),e.filteredConfigs[l].type==="color"?(s(),a("div",Ke,[u(t("input",{class:"form-control","onUpdate:modelValue":n=>e.filteredConfigs[l].value=n,type:"color",id:"filtered-config-"+l+"-color"},null,8,Qe),[[m,e.filteredConfigs[l].value]]),t("label",{for:"filtered-config-"+l+"-color"},[t("p",{style:j({color:e.filteredConfigs[l].value})},"Цвет: "+g(e.filteredConfigs[l].value),5)],8,Re)])):c("",!0),e.filteredConfigs[l].type==="large-text"?(s(),a("div",Xe,[u(t("textarea",{class:"form-control",id:"field-input-"+l,"onUpdate:modelValue":n=>e.filteredConfigs[l].value=n,placeholder:"name@example.com"},`
                            `,8,Ye),[[m,e.filteredConfigs[l].value]]),t("label",{for:"field-input-"+l},"Значение",8,Ze)])):c("",!0),e.filteredConfigs[l].type==="image"?(s(),a("div",xe,[u(t("input",{class:"form-control mb-2",id:"field-input-"+l,type:"text",disabled:"true","onUpdate:modelValue":n=>e.filteredConfigs[l].value=n,placeholder:"name@example.com"},null,8,et),[[m,e.filteredConfigs[l].value]]),t("label",{for:"field-input-"+l},"FileId ссылка на изображение",8,tt),_(X,{"need-video":!1,"need-photo":!0,selected:[e.filteredConfigs[l].value],onSelect:n=>e.selectPhoto(n,l)},null,8,["selected","onSelect"])])):c("",!0)])])]))),256))])):(s(),a("div",ot,st)),t("button",it,[e.slugForm.id==null?(s(),a("span",nt," Сохранить команду ")):(s(),a("span",at," Обновить команду "))])],32)}}}),rt={key:0,class:"row"},ut={class:"col-12 mb-3"},ct={class:"list-group w-100"},gt=["onClick"],mt={key:0,class:"badge bg-info"},ht=["onClick"],ft=t("i",{class:"fa-solid fa-trash-can"},null,-1),pt=[ft],bt={class:"col-12"},_t={key:2},yt={class:"card-body"},vt={class:"mb-3"},Ct={class:"form-label",id:"bot-domain"},kt=t("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),$t=t("div",null,[h("Измените только текст команды,"),t("br"),h(" если хотите чтоб скрипт вызывался по кнопке из меню. "),t("br"),h(" Или оставьте как есть. "),t("br"),h(" Текст скрипта нужно также указать в качестве пункта меню. ")],-1),Ft=t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),wt=["disabled"],St={props:["canAdd","bot"],data(){return{search:null,slugs:[],slugs_paginate_object:null,slugForm:{command:null,comment:null,slug:null,config:[],is_global:!0,bot_id:null}}},computed:{...v(["getGlobalSlugs","getGlobalSlugsPaginateObject"]),filteredAllSlugs(){return this.slugs.length===0?[]:this.search==null?this.slugs:this.slugs.filter(o=>{let e=o.slug||"",d=o.command||"",r=o.comment||"";return d.toLowerCase().indexOf(this.search.toLowerCase())!==-1||r.toLowerCase().indexOf(this.search.toLowerCase())!==-1||e.toLowerCase().indexOf(this.search.toLowerCase())!==-1})}},mounted(){this.loadAllSlugs()},methods:{loadAllSlugs(o=0){this.$store.dispatch("loadGlobalSlugs",{dataObject:{needGlobal:!0},page:o}).then(e=>{this.slugs=this.getGlobalSlugs,this.slugs_paginate_object=this.getGlobalSlugsPaginateObject})},removeSlug(o){this.$store.dispatch("removeSlug",{dataObject:{slugId:o.id}}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно удалена",type:"success"}),this.loadAllSlugs()}).catch(e=>{this.loadAllSlugs()})},nextSlugs(o){this.loadAllSlugs(o)},selectSlug(o){this.slugForm.id=o.id||null,this.slugForm.slug=o.slug,this.slugForm.comment=o.comment,this.slugForm.command=this.command||o.command,this.slugForm.config=o.config||[],this.slugForm.is_global=o.is_global||!1,this.$emit("select",o)},addSlug(){let o=new FormData;Object.keys(this.slugForm).forEach(e=>{const d=this.slugForm[e]||"";typeof d=="object"?o.append(e,JSON.stringify(d)):o.append(e,d)}),this.bot&&o.append("bot_id",this.bot.id),this.$store.dispatch("createSlug",{slugForm:o}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно обновлена",type:"success"}),this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0,this.$emit("callback")}).catch(e=>{})}}},Bt=Object.assign(St,{__name:"GlobalSlugList",setup(o){return(e,d)=>{const r=O("Popper");return s(),a(f,null,[e.filteredAllSlugs.length>0?(s(),a("div",rt,[t("div",ut,[t("ul",ct,[(s(!0),a(f,null,p(e.filteredAllSlugs,(i,l)=>(s(),a("li",{class:b(["list-group-item cursor-pointer btn mb-1 d-flex align-items-center justify-between",{"btn-outline-info":i.deleted_at==null,"btn-outline-danger border-danger":i.deleted_at!=null}])},[t("strong",{onClick:n=>e.selectSlug(i),style:{"word-wrap":"break-word"}},[t("i",{class:b([{"text-danger":i.deleted_at!=null},"fa-solid fa-scroll"])},null,2),h(" "+g(i.command)+" (",1),t("span",null,g(i.slug),1),h(") ")],8,gt),i.comment?(s(),a("span",mt,g(i.comment||"Пояснение не указано"),1)):c("",!0),t("button",{class:"btn btn-outline-danger",onClick:n=>e.removeSlug(i),type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},pt,8,ht)],2))),256))])]),t("div",bt,[e.slugs_paginate_object?(s(),y(F,{key:0,onPagination_page:e.nextSlugs,pagination:e.slugs_paginate_object},null,8,["onPagination_page","pagination"])):c("",!0)])])):(s(),a("p",_t,"Глобальных скриптов не обноружено")),o.canAdd&&e.filteredAllSlugs.length>0?(s(),a("form",{key:3,onSubmit:d[1]||(d[1]=k((...i)=>e.addSlug&&e.addSlug(...i),["prevent"])),class:"card mb-3"},[t("div",yt,[t("div",vt,[t("label",Ct,[_(r,null,{content:C(()=>[$t]),default:C(()=>[kt]),_:1}),h(" Команда "),Ft]),u(t("input",{type:"text",class:"form-control",placeholder:"Команда","aria-label":"Команда","onUpdate:modelValue":d[0]||(d[0]=i=>e.slugForm.command=i),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[m,e.slugForm.command]])]),t("button",{disabled:e.slugForm.slug==null,class:"btn btn-outline-success mt-2 mb-2 w-100 p-3"},"Добавить скрипт в бота ",8,wt)])],32)):c("",!0)],64)}}});export{Pt as _,Bt as a,X as b};
