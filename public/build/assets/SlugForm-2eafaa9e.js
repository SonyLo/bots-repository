import{O as v,o,q as i,t,F as p,B as f,v as b,C as h,x as g,z as c,D as k,K as _,A as F,N as y,H as d,L as u,P as w}from"./index.es-065e5c55.js";import{P as $}from"./Pagination-28bcf227.js";import{m as C}from"./index-f4e1173c.js";import{_ as S}from"./_plugin-vue_export-helper-c27b6911.js";const L={key:0,class:"row"},O={class:"col-12 mb-3"},V={class:"list-group w-100"},j=["onClick"],T={key:0,class:"badge bg-info"},U=["onClick"],q=t("i",{class:"fa-solid fa-trash-can"},null,-1),I=[q],A={class:"col-12"},B={key:2},P={class:"card-body"},N={class:"mb-3"},D={class:"form-label",id:"bot-domain"},E=t("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),G=t("div",null,[h("Измените только текст команды,"),t("br"),h(" если хотите чтоб скрипт вызывался по кнопке из меню. "),t("br"),h(" Или оставьте как есть. "),t("br"),h(" Текст скрипта нужно также указать в качестве пункта меню. ")],-1),H=t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),M=["disabled"],z={props:["canAdd","bot"],data(){return{search:null,slugs:[],slugs_paginate_object:null,slugForm:{command:null,comment:null,slug:null,config:[],is_global:!0,bot_id:null}}},computed:{...C(["getSlugs","getSlugsPaginateObject"]),filteredAllSlugs(){return this.slugs.length===0?[]:this.search==null?this.slugs:this.slugs.filter(s=>{let e=s.slug||"",n=s.command||"",r=s.comment||"";return n.toLowerCase().indexOf(this.search.toLowerCase())!==-1||r.toLowerCase().indexOf(this.search.toLowerCase())!==-1||e.toLowerCase().indexOf(this.search.toLowerCase())!==-1})}},mounted(){this.loadAllSlugs()},methods:{loadAllSlugs(s=0){this.$store.dispatch("loadSlugs",{dataObject:{needGlobal:!0},page:s}).then(e=>{this.slugs=this.getSlugs,this.slugs_paginate_object=this.getSlugsPaginateObject})},removeSlug(s){this.$store.dispatch("removeSlug",{dataObject:{slugId:s.id}}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно удалена",type:"success"}),this.loadAllSlugs()}).catch(e=>{this.loadAllSlugs()})},nextSlugs(s){this.loadAllSlugs(s)},selectSlug(s){this.slugForm.id=s.id||null,this.slugForm.slug=s.slug,this.slugForm.comment=s.comment,this.slugForm.command=this.command||s.command,this.slugForm.config=s.config||[],this.slugForm.is_global=s.is_global||!1,this.$emit("select",s)},addSlug(){let s=new FormData;Object.keys(this.slugForm).forEach(e=>{const n=this.slugForm[e]||"";typeof n=="object"?s.append(e,JSON.stringify(n)):s.append(e,n)}),this.bot&&s.append("bot_id",this.bot.id),this.$store.dispatch("createSlug",{slugForm:s}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно обновлена",type:"success"}),this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0,this.$emit("callback")}).catch(e=>{})}}},Ze=Object.assign(z,{__name:"GlobalSlugList",setup(s){return(e,n)=>{const r=v("Popper");return o(),i(p,null,[e.filteredAllSlugs.length>0?(o(),i("div",L,[t("div",O,[t("ul",V,[(o(!0),i(p,null,f(e.filteredAllSlugs,(l,a)=>(o(),i("li",{class:b(["list-group-item cursor-pointer btn mb-1 d-flex align-items-center justify-between",{"btn-outline-info":l.deleted_at==null,"btn-outline-danger border-danger":l.deleted_at!=null}])},[t("strong",{onClick:m=>e.selectSlug(l),style:{"word-wrap":"break-word"}},[t("i",{class:b([{"text-danger":l.deleted_at!=null},"fa-solid fa-scroll"])},null,2),h(" "+g(l.command)+" (",1),t("span",null,g(l.slug),1),h(") ")],8,j),l.comment?(o(),i("span",T,g(l.comment||"Пояснение не указано"),1)):c("",!0),t("button",{class:"btn btn-outline-danger",onClick:m=>e.removeSlug(l),type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},I,8,U)],2))),256))])]),t("div",A,[e.slugs_paginate_object?(o(),k($,{key:0,onPagination_page:e.nextSlugs,pagination:e.slugs_paginate_object},null,8,["onPagination_page","pagination"])):c("",!0)])])):(o(),i("p",B,"Глобальных скриптов не обноружено")),s.canAdd&&e.filteredAllSlugs.length>0?(o(),i("form",{key:3,onSubmit:n[1]||(n[1]=_((...l)=>e.addSlug&&e.addSlug(...l),["prevent"])),class:"card mb-3"},[t("div",P,[t("div",N,[t("label",D,[F(r,null,{content:y(()=>[G]),default:y(()=>[E]),_:1}),h(" Команда "),H]),d(t("input",{type:"text",class:"form-control",placeholder:"Команда","aria-label":"Команда","onUpdate:modelValue":n[0]||(n[0]=l=>e.slugForm.command=l),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[u,e.slugForm.command]])]),t("button",{disabled:e.slugForm.slug==null,class:"btn btn-outline-success mt-2 mb-2 w-100 p-3"},"Добавить скрипт в бота ",8,M)])],32)):c("",!0)],64)}}});const J={props:["token","param"],data(){return{channelLink:null}},mounted(){},methods:{checkLink(){this.channelLink.indexOf("https://t.me/")!==-1&&(this.channelLink="@"+(this.channelLink.split("https://t.me/")[1]||this.channelLink))},requestTelegramChannelId(){this.$store.dispatch("requestTelegramChannelId",{dataObject:{token:this.token,channel:this.channelLink}}).then(s=>{s.ok&&this.$emit("callback",{param:this.param||null,text:s.result.chat.id}),s.ok||(this.$notify({title:"Конструктор ботов",text:s.description,type:"error"}),this.$emit("callback",{param:this.param||null,text:null}))}).catch(()=>{})}}},K={class:"dropdown"},R=t("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"fa-brands fa-telegram"})],-1),Q={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},W={key:0,class:"alert alert-danger mb-2",role:"alert"},X=["disabled"];function Y(s,e,n,r,l,a){return o(),i("div",K,[R,t("div",Q,[t("form",{onSubmit:e[2]||(e[2]=_((...m)=>a.requestTelegramChannelId&&a.requestTelegramChannelId(...m),["prevent"]))},[d(t("input",{type:"text",class:"form-control mb-2",id:"search-description-text","onUpdate:modelValue":e[0]||(e[0]=m=>l.channelLink=m),onChange:e[1]||(e[1]=(...m)=>a.checkLink&&a.checkLink(...m)),placeholder:"@telegram_channel",required:""},null,544),[[u,l.channelLink]]),n.token?c("",!0):(o(),i("div",W," Вам необходимо указать тоукен бота! ")),t("button",{disabled:!n.token,class:"btn btn-outline-primary w-100"},"Узнать id канала ",8,X)],32)])])}const Z=S(J,[["render",Y]]),x={class:"form-floating mb-3"},ee=t("label",{for:"floatingInput"},"Команда",-1),te={class:"form-floating mb-3"},le=t("label",{for:"floatingInput"},"Мнемоническое имя",-1),se={class:"form-floating mb-3"},oe=t("label",{for:"floatingInput"},"Описание скрипта",-1),ne=t("h6",null," Параметры скрипта ",-1),ie=t("div",{class:"alert alert-info",role:"alert"}," Данные параметры используются для настройки скриптов на стороне сервера ",-1),ae={class:"dropdown"},re=t("button",{class:"btn btn-outline-info w-100 dropdown-toggle mb-2",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," Добавить ",-1),de={class:"dropdown-menu w-100"},ue=["onClick"],ce={class:"row"},me={class:"col-12"},ge=["onClick"],he={key:0,class:"row"},pe={class:"col-md-6 mb-1"},fe={class:"card"},be={class:"card-header d-flex justify-content-between align-items-center"},_e=["onClick"],ye=t("i",{class:"fa-solid fa-trash-can"},null,-1),ke=[ye],Ce={class:"dropdown"},ve={class:"btn btn-outline-info dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Fe={class:"dropdown-menu"},we=["onClick"],$e={class:"card-body"},Se={class:"form-floating mb-1"},Le=["onUpdate:modelValue","id"],Oe=["for"],Ve={key:0,class:"form-floating mb-1"},je=["id","onUpdate:modelValue"],Te=["for"],Ue={key:1,class:"form-check mb-1 mt-2"},qe=["onUpdate:modelValue","id"],Ie=["for"],Ae={key:2,class:"form-floating mb-3"},Be=["id","onUpdate:modelValue"],Pe=["for"],Ne={key:3,class:"form-floating mb-3"},De=["id","onUpdate:modelValue"],Ee=["for"],Ge={key:1,class:"row"},He=t("div",{class:"col-12"},[t("p",null,"Параметры скрипта еще не добавлены")],-1),Me=[He],ze={class:"btn btn-outline-primary w-100 mt-2 p-3"},Je={key:0},Ke={key:1},Re={props:["item"],data(){return{filters:[],simple:!0,configTypes:[{title:"Текстовый или числовой параметр",type:"text"},{title:"Большое текстовое поле",type:"large-text"},{title:"Канал обратной связи",type:"channel"},{title:"Логический оператор",type:"boolean"},{title:"Ссылка на изображение",type:"image"}],bot:null,photos:[],slugForm:{bot_id:null,id:null,command:null,comment:null,slug:null,config:[],is_global:!0}}},computed:{...C(["getCurrentBot"]),filteredConfigs(){return this.filters.length==0?this.slugForm.config:this.slugForm.config.filter(s=>this.filters.indexOf(s.type)>=0)}},mounted(){this.loadCurrentBot(),this.item&&(this.slugForm.id=this.item.id||null,this.slugForm.command=this.item.command,this.slugForm.comment=this.item.comment,this.slugForm.bot_id=this.item.bot_id,this.slugForm.slug=this.item.slug,this.slugForm.config=this.item.config||[],this.slugForm.is_global=this.item.is_global||!1)},methods:{toggleFilter(s){let e=this.filters.indexOf(s);e>=0?this.filters.splice(e,1):this.filters.push(s)},addTextTo(s,e={text:null}){this.slugForm.config[s].value=e.text},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},submit(){let s=new FormData;Object.keys(this.slugForm).forEach(e=>{const n=this.slugForm[e]||"";typeof n=="object"?s.append(e,JSON.stringify(n)):s.append(e,n)}),this.$store.dispatch(this.slugForm.id===null?"createSlug":"updateSlug",{slugForm:s}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно обновлена",type:"success"}),this.slugForm.id===null&&(this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0),this.$emit("callback")}).catch(e=>{})},addConfig(s){this.slugForm.config.splice(0,0,{key:null,value:null,type:s||"text"})},removeConfigItem(s){try{this.slugForm.config.splice(s,1)}catch{this.slugForm.config=[]}}}},xe=Object.assign(Re,{__name:"SlugForm",setup(s){return(e,n)=>(o(),i("form",{onSubmit:n[3]||(n[3]=_((...r)=>e.submit&&e.submit(...r),["prevent"]))},[t("div",x,[d(t("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=r=>e.slugForm.command=r),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[u,e.slugForm.command]]),ee]),t("div",te,[d(t("input",{type:"text","onUpdate:modelValue":n[1]||(n[1]=r=>e.slugForm.slug=r),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[u,e.slugForm.slug]]),le]),t("div",se,[d(t("input",{type:"text","onUpdate:modelValue":n[2]||(n[2]=r=>e.slugForm.comment=r),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[u,e.slugForm.comment]]),oe]),ne,ie,t("div",ae,[re,t("ul",de,[(o(!0),i(p,null,f(e.configTypes,(r,l)=>(o(),i("li",null,[t("a",{class:"dropdown-item",onClick:a=>e.addConfig(r.type)},g(r.title||"Не установлен"),9,ue)]))),256))])]),t("div",ce,[t("div",me,[t("p",null,[h("Фильтры: "),(o(!0),i(p,null,f(e.configTypes,(r,l)=>(o(),i("span",{class:b(["badge mb-1 bg-gray-100 cursor-pointer mr-1",{"bg-info":e.filters.indexOf(r.type)>=0}]),onClick:a=>e.toggleFilter(r.type)},g(r.type),11,ge))),256))])])]),e.filteredConfigs.length>0?(o(),i("div",he,[(o(!0),i(p,null,f(e.filteredConfigs,(r,l)=>(o(),i("div",pe,[t("div",fe,[t("div",be,[t("button",{onClick:a=>e.removeConfigItem(l),class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},ke,8,_e),e.bot&&e.filteredConfigs[l].type==="channel"?(o(),k(Z,{key:0,token:e.bot.bot_token,onCallback:a=>e.addTextTo(l,a)},null,8,["token","onCallback"])):c("",!0),t("div",null,[t("div",Ce,[t("button",ve,g(e.filteredConfigs[l].type),1),t("ul",Fe,[(o(!0),i(p,null,f(e.configTypes,a=>(o(),i("li",null,[t("a",{class:"dropdown-item",onClick:m=>e.filteredConfigs[l].type=a.type},g(a.title||r.type),9,we)]))),256))])])])]),t("div",$e,[t("div",Se,[d(t("input",{type:"text",class:"form-control","onUpdate:modelValue":a=>e.filteredConfigs[l].key=a,id:"field-input-key-"+l,placeholder:"name@example.com",required:""},null,8,Le),[[u,e.filteredConfigs[l].key]]),t("label",{for:"field-input-key-"+l},"Ключ",8,Oe)]),e.filteredConfigs[l].type==="text"||e.filteredConfigs[l].type==="channel"?(o(),i("div",Ve,[d(t("input",{type:"text",class:"form-control",id:"field-input-"+l,"onUpdate:modelValue":a=>e.filteredConfigs[l].value=a,placeholder:"name@example.com",required:""},null,8,je),[[u,e.filteredConfigs[l].value]]),t("label",{for:"field-input-"+l},"Значение",8,Te)])):c("",!0),e.filteredConfigs[l].type==="boolean"?(o(),i("div",Ue,[d(t("input",{class:"form-check-input","onUpdate:modelValue":a=>e.filteredConfigs[l].value=a,type:"checkbox",value:"false",id:"filtered-config-"+l+"-checkbox"},null,8,qe),[[w,e.filteredConfigs[l].value]]),t("label",{class:"form-check-label",for:"filtered-config-"+l+"-checkbox"},g(e.filteredConfigs[l].value?"Истина":"Ложь"),9,Ie)])):c("",!0),e.filteredConfigs[l].type==="large-text"?(o(),i("div",Ae,[d(t("textarea",{class:"form-control",id:"field-input-"+l,"onUpdate:modelValue":a=>e.filteredConfigs[l].value=a,placeholder:"name@example.com",required:""},`
                            `,8,Be),[[u,e.filteredConfigs[l].value]]),t("label",{for:"field-input-"+l},"Значение",8,Pe)])):c("",!0),e.filteredConfigs[l].type==="image"?(o(),i("div",Ne,[d(t("input",{class:"form-control",id:"field-input-"+l,type:"url",pattern:"^(http(s)?:\\/\\/)+[\\w\\-\\._~:\\/?#[\\]@!\\$&'\\(\\)\\*\\+,;=.]+$","onUpdate:modelValue":a=>e.filteredConfigs[l].value=a,placeholder:"name@example.com",required:""},null,8,De),[[u,e.filteredConfigs[l].value]]),t("label",{for:"field-input-"+l},"URL ссылка на изображение",8,Ee)])):c("",!0)])])]))),256))])):(o(),i("div",Ge,Me)),t("button",ze,[e.slugForm.id==null?(o(),i("span",Je," Сохранить команду ")):(o(),i("span",Ke," Обновить команду "))])],32))}});export{Z as T,xe as _,Ze as a};
