import{o as n,q as i,t,x as l,z as r,C as c,D as w,N as y,u as _,H as d,L as h,K as g,J as m}from"./index.es-b4fa9b8f.js";import{s as p}from"./app-ae814666.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./index-77633b4c.js";import"./vue3-perfect-scrollbar-091cf649.js";const f={class:"container"},v={key:0,class:"row"},F={key:0,class:"col-12 mb-2 mt-2"},k={class:"card"},W={class:"card-body"},C={class:"col-12 mb-2 mt-2"},S={key:0,style:{"text-align":"center","font-size":"larger"}},D={key:1,style:{"text-align":"center","font-size":"larger"}},O={key:1,class:"col-12 d-flex justify-content-center align-items-center"},E=t("div",null,"Поехали",-1),j={key:2,class:"col-12 p-2"},z={class:"alert alert-info mb-2",role:"alert"},N=t("h6",{class:"text-center"},"Укажите своё имя, как к Вам может обращаться менеджер?",-1),P={class:"input-group mb-2"},U=t("h6",{class:"text-center"},"Введите свой номер телефона чтобы наш менеджер мог связаться с Вами!",-1),T={class:"input-group mb-2"},V=t("button",{class:"btn btn-outline-primary p-3 w-100"}," Получить выигрышь ",-1),A={class:"col-12 p-2"},B={key:1,class:"row"},K={class:"col-12"},$={class:"w-100",style:{"object-fit":"cover"},alt:""},q={name:"App",components:{Roulette:p},data(){return{rouletteKey:0,action:null,winForm:{win:null,name:null,phone:null},items:[]}},computed:{canPlay(){return this.action.current_attempts<this.action.max_attempts},tg(){return window.Telegram.WebApp},tgUserId(){let s=JSON.parse(new URLSearchParams(window.Telegram.WebApp.initData).get("user"));return s?s.id:null}},mounted(){this.prepare().then(()=>{let s=1;this.items=[],this.wheels.forEach(e=>{this.items.push({id:s,name:e.value,htmlContent:e.value,textColor:"",background:""}),s++})})},methods:{prepare(){return this.$store.dispatch("wheelOfFortunePrepare",{prepareForm:{telegram_chat_id:this.tgUserId},botDomain:this.bot.bot_domain}).then(s=>{this.action=s})},submit(){let s=new FormData;Object.keys(this.winForm).forEach(e=>{const o=this.winForm[e]||"";typeof o=="object"?s.append(e,JSON.stringify(o)):s.append(e,o)}),s.append("telegram_chat_id",this.tgUserId),this.$store.dispatch("wheelOfFortuneWin",{winForm:s,botDomain:this.bot.bot_domain}).then(e=>{this.winForm={win:null,name:null,phone:null},this.$notify({title:"Колесо фортуны",text:"Вы успешно приняли участие в розыгрыше! Наш менеджер свяжется с вами для дальнейших инструкций.",type:"success"}),this.prepare()}).catch(e=>{})},closeWheel(){this.tg.close()},launchWheel(){this.rouletteKey+=1,setTimeout(()=>this.$refs.wheel.launchWheel(),0)},wheelStartedCallback(){},wheelEndedCallback(s){this.winForm.win=s.id}}},H=Object.assign(q,{props:{bot:Object,wheels:Array,rules:String},setup(s){return(e,o)=>{const u=m("mask"),b=m("lazy");return n(),i("div",f,[e.action?(n(),i("div",v,[s.rules?(n(),i("div",F,[t("div",k,[t("div",W,[t("p",null,l(s.rules),1)])])])):r("",!0),t("div",C,[e.canPlay?(n(),i("p",S,[c("Ваши попытки: "),t("strong",null,l(e.action.current_attempts||0),1),c(" из "),t("strong",null,l(e.action.max_attempts||1),1)])):(n(),i("p",D,"Вы израсходовали все ваши попытки"))]),e.canPlay&&e.winForm.win==null?(n(),i("div",O,[(n(),w(_(p),{ref:"wheel",size:"300",key:e.rouletteKey,items:e.items,"centered-indicator":"","indicator-position":"top","display-shadow":"","display-border":"","base-display":"","base-display-indicator":"","base-background":"orange","base-display-shadow":"",easing:"bounce",onWheelStart:e.wheelStartedCallback,onWheelEnd:e.wheelEndedCallback,onClick:e.launchWheel},{baseContent:y(()=>[E]),_:1},8,["items","onWheelStart","onWheelEnd","onClick"]))])):r("",!0),e.canPlay&&e.winForm.win?(n(),i("div",j,[t("div",z,[t("p",null,"Вы выиграли - "+l(e.winForm.win)+".",1)]),t("form",{onSubmit:o[2]||(o[2]=g((...a)=>e.submit&&e.submit(...a),["prevent"]))},[N,t("div",P,[d(t("input",{type:"text",class:"form-control text-center p-3",placeholder:"Петров Петр Семенович","aria-label":"winForm-name","onUpdate:modelValue":o[0]||(o[0]=a=>e.winForm.name=a),"aria-describedby":"winForm-name",required:""},null,512),[[h,e.winForm.name]])]),U,t("div",T,[d(t("input",{type:"text",class:"form-control p-3 text-center","onUpdate:modelValue":o[1]||(o[1]=a=>e.winForm.phone=a),placeholder:"+7(000)000-00-00","aria-label":"winForm-phone","aria-describedby":"vipForm-phone",required:""},null,512),[[u,"+7(###)###-##-##"],[h,e.winForm.phone]])]),V],32)])):r("",!0),t("div",A,[t("button",{onClick:o[3]||(o[3]=(...a)=>e.closeWheel&&e.closeWheel(...a)),type:"button",class:"btn btn-outline-success p-3 w-100"}," Вернуться в бота ")])])):(n(),i("div",B,[t("div",K,[d(t("img",$,null,512),[[b,"/images/load.gif"]])])]))])}}});export{H as default};
