import{Y as C,o as n,q as a,t,F as f,B as p,v as b,C as g,x as m,z as c,J as k,H as _,A as F,N as y,D as d,G as u,L as w,O as $,y as S}from"./index.es-3f23c3ba.js";import{P as V}from"./Pagination-7feb7ae2.js";import{m as v}from"./index-2a9de1d3.js";import{_ as L}from"./_plugin-vue_export-helper-c27b6911.js";const U={key:0,class:"row"},O={class:"col-12 mb-3"},j={class:"list-group w-100"},T=["onClick"],q={key:0,class:"badge bg-info"},I=["onClick"],A=t("i",{class:"fa-solid fa-trash-can"},null,-1),B=[A],P={class:"col-12"},N={key:2},D={class:"card-body"},G={class:"mb-3"},z={class:"form-label",id:"bot-domain"},E=t("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),H=t("div",null,[g("Измените только текст команды,"),t("br"),g(" если хотите чтоб скрипт вызывался по кнопке из меню. "),t("br"),g(" Или оставьте как есть. "),t("br"),g(" Текст скрипта нужно также указать в качестве пункта меню. ")],-1),J=t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),M=["disabled"],R={props:["canAdd","bot"],data(){return{search:null,slugs:[],slugs_paginate_object:null,slugForm:{command:null,comment:null,slug:null,config:[],is_global:!0,bot_id:null}}},computed:{...v(["getSlugs","getSlugsPaginateObject"]),filteredAllSlugs(){return this.slugs.length===0?[]:this.search==null?this.slugs:this.slugs.filter(o=>{let e=o.slug||"",r=o.command||"",h=o.comment||"";return r.toLowerCase().indexOf(this.search.toLowerCase())!==-1||h.toLowerCase().indexOf(this.search.toLowerCase())!==-1||e.toLowerCase().indexOf(this.search.toLowerCase())!==-1})}},mounted(){this.loadAllSlugs()},methods:{loadAllSlugs(o=0){this.$store.dispatch("loadSlugs",{dataObject:{needGlobal:!0},page:o}).then(e=>{this.slugs=this.getSlugs,this.slugs_paginate_object=this.getSlugsPaginateObject})},removeSlug(o){this.$store.dispatch("removeSlug",{dataObject:{slugId:o.id}}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно удалена",type:"success"}),this.loadAllSlugs()}).catch(e=>{this.loadAllSlugs()})},nextSlugs(o){this.loadAllSlugs(o)},selectSlug(o){this.slugForm.id=o.id||null,this.slugForm.slug=o.slug,this.slugForm.comment=o.comment,this.slugForm.command=this.command||o.command,this.slugForm.config=o.config||[],this.slugForm.is_global=o.is_global||!1,this.$emit("select",o)},addSlug(){let o=new FormData;Object.keys(this.slugForm).forEach(e=>{const r=this.slugForm[e]||"";typeof r=="object"?o.append(e,JSON.stringify(r)):o.append(e,r)}),this.bot&&o.append("bot_id",this.bot.id),this.$store.dispatch("createSlug",{slugForm:o}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно обновлена",type:"success"}),this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0,this.$emit("callback")}).catch(e=>{})}}},at=Object.assign(R,{__name:"GlobalSlugList",setup(o){return(e,r)=>{const h=C("Popper");return n(),a(f,null,[e.filteredAllSlugs.length>0?(n(),a("div",U,[t("div",O,[t("ul",j,[(n(!0),a(f,null,p(e.filteredAllSlugs,(s,l)=>(n(),a("li",{class:b(["list-group-item cursor-pointer btn mb-1 d-flex align-items-center justify-between",{"btn-outline-info":s.deleted_at==null,"btn-outline-danger border-danger":s.deleted_at!=null}])},[t("strong",{onClick:i=>e.selectSlug(s),style:{"word-wrap":"break-word"}},[t("i",{class:b([{"text-danger":s.deleted_at!=null},"fa-solid fa-scroll"])},null,2),g(" "+m(s.command)+" (",1),t("span",null,m(s.slug),1),g(") ")],8,T),s.comment?(n(),a("span",q,m(s.comment||"Пояснение не указано"),1)):c("",!0),t("button",{class:"btn btn-outline-danger",onClick:i=>e.removeSlug(s),type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},B,8,I)],2))),256))])]),t("div",P,[e.slugs_paginate_object?(n(),k(V,{key:0,onPagination_page:e.nextSlugs,pagination:e.slugs_paginate_object},null,8,["onPagination_page","pagination"])):c("",!0)])])):(n(),a("p",N,"Глобальных скриптов не обноружено")),o.canAdd&&e.filteredAllSlugs.length>0?(n(),a("form",{key:3,onSubmit:r[1]||(r[1]=_((...s)=>e.addSlug&&e.addSlug(...s),["prevent"])),class:"card mb-3"},[t("div",D,[t("div",G,[t("label",z,[F(h,null,{content:y(()=>[H]),default:y(()=>[E]),_:1}),g(" Команда "),J]),d(t("input",{type:"text",class:"form-control",placeholder:"Команда","aria-label":"Команда","onUpdate:modelValue":r[0]||(r[0]=s=>e.slugForm.command=s),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[u,e.slugForm.command]])]),t("button",{disabled:e.slugForm.slug==null,class:"btn btn-outline-success mt-2 mb-2 w-100 p-3"},"Добавить скрипт в бота ",8,M)])],32)):c("",!0)],64)}}});const Y={props:["token","param"],data(){return{channelLink:null}},mounted(){},methods:{checkLink(){this.channelLink.indexOf("https://t.me/")!==-1&&(this.channelLink="@"+(this.channelLink.split("https://t.me/")[1]||this.channelLink))},requestTelegramChannelId(){this.$store.dispatch("requestTelegramChannelId",{dataObject:{token:this.token,channel:this.channelLink}}).then(o=>{o.ok&&this.$emit("callback",{param:this.param||null,text:o.result.chat.id}),o.ok||(this.$notify({title:"Конструктор ботов",text:o.description,type:"error"}),this.$emit("callback",{param:this.param||null,text:null}))}).catch(()=>{})}}},K={class:"dropdown"},Q=t("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"fa-brands fa-telegram"})],-1),W={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},X={key:0,class:"alert alert-danger mb-2",role:"alert"},Z=["disabled"];function x(o,e,r,h,s,l){return n(),a("div",K,[Q,t("div",W,[t("form",{onSubmit:e[2]||(e[2]=_((...i)=>l.requestTelegramChannelId&&l.requestTelegramChannelId(...i),["prevent"]))},[d(t("input",{type:"text",class:"form-control mb-2",id:"search-description-text","onUpdate:modelValue":e[0]||(e[0]=i=>s.channelLink=i),onChange:e[1]||(e[1]=(...i)=>l.checkLink&&l.checkLink(...i)),placeholder:"@telegram_channel",required:""},null,544),[[u,s.channelLink]]),r.token?c("",!0):(n(),a("div",X," Вам необходимо указать тоукен бота! ")),t("button",{disabled:!r.token,class:"btn btn-outline-primary w-100"},"Узнать id канала ",8,Z)],32)])])}const ee=L(Y,[["render",x]]),te={class:"form-floating mb-3"},le=t("label",{for:"floatingInput"},"Команда",-1),oe={class:"form-floating mb-3"},se=t("label",{for:"floatingInput"},"Мнемоническое имя",-1),ne={class:"form-floating mb-3"},ie=t("label",{for:"floatingInput"},"Описание скрипта",-1),ae=t("h6",null," Параметры скрипта ",-1),re=t("div",{class:"alert alert-info",role:"alert"}," Данные параметры используются для настройки скриптов на стороне сервера ",-1),de={class:"dropdown"},ue=t("button",{class:"btn btn-outline-info w-100 dropdown-toggle mb-2",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," Добавить ",-1),ce={class:"dropdown-menu w-100"},me=["onClick"],ge={class:"row"},he={class:"col-12"},fe=["onClick"],pe={key:0,class:"row"},be={class:"col-md-6 mb-1"},_e={class:"card"},ye={class:"card-header d-flex justify-content-between align-items-center"},ke=["onClick"],ve=t("i",{class:"fa-solid fa-trash-can"},null,-1),Ce=[ve],Fe={class:"dropdown"},we={class:"btn btn-outline-info dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},$e={class:"dropdown-menu"},Se=["onClick"],Ve={class:"card-body"},Le={class:"form-floating mb-1"},Ue=["onUpdate:modelValue","id"],Oe=["for"],je={key:0,class:"form-floating mb-1"},Te=["id","onUpdate:modelValue"],qe=["for"],Ie={key:1,class:"form-check mb-1 mt-2"},Ae=["onUpdate:modelValue","id"],Be=["for"],Pe={key:2,class:"form-check mb-1 mt-2"},Ne=["onUpdate:modelValue","id"],De=["for"],Ge={key:3,class:"form-check mb-1 mt-2"},ze=["onUpdate:modelValue","id"],Ee=["for"],He={key:4,class:"form-floating mb-3"},Je=["id","onUpdate:modelValue"],Me=["for"],Re={key:5,class:"form-floating mb-3"},Ye=["id","onUpdate:modelValue"],Ke=["for"],Qe={key:1,class:"row"},We=t("div",{class:"col-12"},[t("p",null,"Параметры скрипта еще не добавлены")],-1),Xe=[We],Ze={class:"btn btn-outline-primary w-100 mt-2 p-3"},xe={key:0},et={key:1},tt={props:["item"],data(){return{filters:[],simple:!0,configTypes:[{title:"Текстовый или числовой параметр",type:"text"},{title:"Большое текстовое поле",type:"large-text"},{title:"Канал обратной связи",type:"channel"},{title:"Логический оператор",type:"boolean"},{title:"Ссылка на изображение",type:"image"},{title:"Цвет",type:"color"},{title:"Geo",type:"geo"}],bot:null,photos:[],slugForm:{bot_id:null,id:null,command:null,comment:null,slug:null,config:[],is_global:!0}}},computed:{...v(["getCurrentBot"]),filteredConfigs(){return this.filters.length==0?this.slugForm.config:this.slugForm.config.filter(o=>this.filters.indexOf(o.type)>=0)}},mounted(){this.loadCurrentBot(),this.item&&(this.slugForm.id=this.item.id||null,this.slugForm.command=this.item.command,this.slugForm.comment=this.item.comment,this.slugForm.bot_id=this.item.bot_id,this.slugForm.slug=this.item.slug,this.slugForm.config=this.item.config||[],this.slugForm.is_global=this.item.is_global||!1)},methods:{toggleFilter(o){let e=this.filters.indexOf(o);e>=0?this.filters.splice(e,1):this.filters.push(o)},addTextTo(o,e={text:null}){this.slugForm.config[o].value=e.text},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},submit(){let o=new FormData;Object.keys(this.slugForm).forEach(e=>{const r=this.slugForm[e]||"";typeof r=="object"?o.append(e,JSON.stringify(r)):o.append(e,r)}),this.$store.dispatch(this.slugForm.id===null?"createSlug":"updateSlug",{slugForm:o}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно обновлена",type:"success"}),this.slugForm.id===null&&(this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0),this.$emit("callback")}).catch(e=>{})},addConfig(o){this.slugForm.config.splice(0,0,{key:null,value:null,type:o||"text"})},removeConfigItem(o){try{this.slugForm.config.splice(o,1)}catch{this.slugForm.config=[]}}}},rt=Object.assign(tt,{__name:"SlugForm",setup(o){return(e,r)=>{const h=w("mask");return n(),a("form",{onSubmit:r[3]||(r[3]=_((...s)=>e.submit&&e.submit(...s),["prevent"]))},[t("div",te,[d(t("input",{type:"text","onUpdate:modelValue":r[0]||(r[0]=s=>e.slugForm.command=s),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[u,e.slugForm.command]]),le]),t("div",oe,[d(t("input",{type:"text","onUpdate:modelValue":r[1]||(r[1]=s=>e.slugForm.slug=s),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[u,e.slugForm.slug]]),se]),t("div",ne,[d(t("input",{type:"text","onUpdate:modelValue":r[2]||(r[2]=s=>e.slugForm.comment=s),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[u,e.slugForm.comment]]),ie]),ae,re,t("div",de,[ue,t("ul",ce,[(n(!0),a(f,null,p(e.configTypes,(s,l)=>(n(),a("li",null,[t("a",{class:"dropdown-item",onClick:i=>e.addConfig(s.type)},m(s.title||"Не установлен"),9,me)]))),256))])]),t("div",ge,[t("div",he,[t("p",null,[g("Фильтры: "),(n(!0),a(f,null,p(e.configTypes,(s,l)=>(n(),a("span",{class:b(["badge mb-1 bg-gray-100 cursor-pointer mr-1",{"bg-info":e.filters.indexOf(s.type)>=0}]),onClick:i=>e.toggleFilter(s.type)},m(s.type),11,fe))),256))])])]),e.filteredConfigs.length>0?(n(),a("div",pe,[(n(!0),a(f,null,p(e.filteredConfigs,(s,l)=>(n(),a("div",be,[t("div",_e,[t("div",ye,[t("button",{onClick:i=>e.removeConfigItem(l),class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Ce,8,ke),e.bot&&e.filteredConfigs[l].type==="channel"?(n(),k(ee,{key:0,token:e.bot.bot_token,onCallback:i=>e.addTextTo(l,i)},null,8,["token","onCallback"])):c("",!0),t("div",null,[t("div",Fe,[t("button",we,m(e.filteredConfigs[l].type),1),t("ul",$e,[(n(!0),a(f,null,p(e.configTypes,i=>(n(),a("li",null,[t("a",{class:"dropdown-item",onClick:lt=>e.filteredConfigs[l].type=i.type},m(i.title||s.type),9,Se)]))),256))])])])]),t("div",Ve,[t("div",Le,[d(t("input",{type:"text",class:"form-control","onUpdate:modelValue":i=>e.filteredConfigs[l].key=i,id:"field-input-key-"+l,placeholder:"name@example.com",required:""},null,8,Ue),[[u,e.filteredConfigs[l].key]]),t("label",{for:"field-input-key-"+l},"Ключ",8,Oe)]),e.filteredConfigs[l].type==="text"||e.filteredConfigs[l].type==="channel"?(n(),a("div",je,[d(t("input",{type:"text",class:"form-control",id:"field-input-"+l,"onUpdate:modelValue":i=>e.filteredConfigs[l].value=i,placeholder:"name@example.com",required:""},null,8,Te),[[u,e.filteredConfigs[l].value]]),t("label",{for:"field-input-"+l},"Значение",8,qe)])):c("",!0),e.filteredConfigs[l].type==="boolean"?(n(),a("div",Ie,[d(t("input",{class:"form-check-input","onUpdate:modelValue":i=>e.filteredConfigs[l].value=i,type:"checkbox",value:"false",id:"filtered-config-"+l+"-checkbox"},null,8,Ae),[[$,e.filteredConfigs[l].value]]),t("label",{class:"form-check-label",for:"filtered-config-"+l+"-checkbox"},m(e.filteredConfigs[l].value?"Истина":"Ложь"),9,Be)])):c("",!0),e.filteredConfigs[l].type==="geo"?(n(),a("div",Pe,[d(t("input",{class:"form-control","onUpdate:modelValue":i=>e.filteredConfigs[l].value=i,type:"text",id:"filtered-config-"+l+"-geo"},null,8,Ne),[[h,"##.######,##.######"],[u,e.filteredConfigs[l].value]]),t("label",{for:"filtered-config-"+l+"-geo"},"Значение",8,De)])):c("",!0),e.filteredConfigs[l].type==="color"?(n(),a("div",Ge,[d(t("input",{class:"form-control","onUpdate:modelValue":i=>e.filteredConfigs[l].value=i,type:"color",id:"filtered-config-"+l+"-color"},null,8,ze),[[u,e.filteredConfigs[l].value]]),t("label",{for:"filtered-config-"+l+"-color"},[t("p",{style:S({color:e.filteredConfigs[l].value})},"Цвет: "+m(e.filteredConfigs[l].value),5)],8,Ee)])):c("",!0),e.filteredConfigs[l].type==="large-text"?(n(),a("div",He,[d(t("textarea",{class:"form-control",id:"field-input-"+l,"onUpdate:modelValue":i=>e.filteredConfigs[l].value=i,placeholder:"name@example.com",required:""},`
                            `,8,Je),[[u,e.filteredConfigs[l].value]]),t("label",{for:"field-input-"+l},"Значение",8,Me)])):c("",!0),e.filteredConfigs[l].type==="image"?(n(),a("div",Re,[d(t("input",{class:"form-control",id:"field-input-"+l,type:"url",pattern:"^(http(s)?:\\/\\/)+[\\w\\-\\._~:\\/?#[\\]@!\\$&'\\(\\)\\*\\+,;=.]+$","onUpdate:modelValue":i=>e.filteredConfigs[l].value=i,placeholder:"name@example.com",required:""},null,8,Ye),[[u,e.filteredConfigs[l].value]]),t("label",{for:"field-input-"+l},"URL ссылка на изображение",8,Ke)])):c("",!0)])])]))),256))])):(n(),a("div",Qe,Xe)),t("button",Ze,[e.slugForm.id==null?(n(),a("span",xe," Сохранить команду ")):(n(),a("span",et," Обновить команду "))])],32)}}});export{ee as T,rt as _,at as a};
