import{Y as B,q as n,t as d,v as t,A as c,H as h,Q as F,F as m,C as _,J as b,x as y,K as p,y as v,X as K,G as T,P as S,D as g,L as V,B as j}from"./index.es-77235f88.js";import{V as q,T as M}from"./TelegramChannelHelper-587b5dac.js";import{_ as U}from"./_plugin-vue_export-helper-c27b6911.js";import{v as R}from"./v4-a960c1f4.js";const O={props:["editedKeyboard","type"],components:{Vue3JsonEditor:q},computed:{uuid(){return R()}},watch:{keyboard:{handler:function(s){this.save()},deep:!0}},data(){return{mode:0,editor:!1,showCode:!1,showAssign:!1,selectedRow:null,load:!1,rowCount:1,keyboard:[],select:{row:-1,col:-1,type:this.type||"reply"}}},mounted(){this.editedKeyboard&&this.$nextTick(()=>{this.keyboard=this.editedKeyboard.menu})},methods:{reset(){this.selectedRow=null,this.select={row:-1,col:-1,type:this.type||"reply"}},needRemoveField(s,e,l){Object.keys(this.keyboard[e][l]).forEach(i=>{i!=="text"&&i!==s&&delete this.keyboard[e][l][i]})},save(){this.$emit("save",this.keyboard)},onJsonChange(s){this.keyboard=s,this.save()},removeColFromRow(s){this.keyboard[s].length>1?this.keyboard[s].splice(this.keyboard[s].length-1,1):this.keyboard.splice(s,1),this.keyboard.length===0&&(this.selectedRow=null),this.save()},addRowAbove(){this.addRow(!0)},moveCol(s,e=0){s!==this.select.row&&(this.select.row=s,this.select.col=0,this.select.text=this.keyboard[this.select.row][this.select.col].text);let l=this.select.row,i=this.select.col,o=this.keyboard[l].length,a=e===0?i-1>=0?i-1:o-1:i<o-1?i+1:0,k=this.keyboard[l][i];this.keyboard[l][i]=this.keyboard[l][a],this.keyboard[l][a]=k,this.select.row=l,this.select.col=a,this.select.text=this.keyboard[l][a].text},moveRow(s=0){if(this.selectedRow==null)return;let e=this.keyboard.length,l=s===0?this.selectedRow-1>=0?this.selectedRow-1:e-1:this.selectedRow<e-1?this.selectedRow+1:0,i=this.keyboard[this.selectedRow];this.keyboard[this.selectedRow]=this.keyboard[l],this.keyboard[l]=i,this.select.row=l,this.select.col=0,this.select.text=this.keyboard[l][0].text,this.selectedRow=l},addRowBelow(){this.addRow(!1)},addRow(s=!1){if(this.selectedRow==null)this.keyboard?this.keyboard.push([{text:"No Text"}]):this.keyboard=[[{text:"No Text"}]],this.selectedRow=null;else{let e=s?this.selectedRow:this.selectedRow+1;this.keyboard.splice(e,0,[{text:"No Text"}])}this.save()},addColToRow(s){this.keyboard[s].push({text:"No Text"}),this.save()},selectIndex(s,e){this.selectedRow=s,this.select.row=s,this.select.col=e,this.select.text=this.keyboard[s][e].text||"",this.load=!0,this.$nextTick(()=>{this.load=!1})},removeCol(s,e){this.keyboard[s].length>1?this.keyboard[s].splice(e,1):this.keyboard.splice(1,1),this.save()}}},J={key:0},N={class:"row"},A={class:"col-12 d-flex justify-content-between"},D=t("i",{class:"fa-solid fa-arrows-up-to-line"},null,-1),E=[D],P=t("i",{class:"fa-solid fa-arrows-down-to-line"},null,-1),L=[P],I=t("i",{class:"fa-solid fa-xmark"},null,-1),z=[I],G={class:"d-flex flex-column"},H={class:"form-check"},Y=["id"],Q=["for"],X={key:0,class:"col-12"},W={class:"row"},Z={class:"col-2 d-flex justify-content-around p-2"},x=["onClick"],ee=t("i",{class:"fa-solid fa-plus"},null,-1),te=[ee],oe=["onClick"],se=t("i",{class:"fa-solid fa-minus"},null,-1),le=[se],ne=["onClick"],ie=t("i",{class:"fa-solid fa-caret-left"},null,-1),de=[ie],re=["onClick"],ae=t("i",{class:"fa-solid fa-caret-right"},null,-1),ce=[ae],he={class:"col-10 d-flex justify-content-center p-1"},be=["onClick"],ue=["onUpdate:modelValue"],me=t("i",{class:"fa-solid fa-bars"},null,-1),ye=[me],_e={key:0,class:"row"},pe={class:"col-12"},ke=t("label",{class:"form-label",id:"bot-domain"},"JSON-код клавиатуры",-1),fe={key:1},ve={class:"row"},we={class:"col-12 mb-2"},ge={class:"col-12"},Ce=t("div",{class:"alert alert-danger",role:"alert"}," Возможно выбрать только 1 тип действия ",-1),Fe={class:"mb-3"},Re=["for"],$e=["id"],Ke=t("hr",null,null,-1),Te={class:"mb-3"},Se=["for"],Be=["id"],Ve={class:"mb-3"},je=["for"],qe=["id"],Me={class:"mb-3"},Ue=["for"],Oe=["id"],Je={class:"mb-3"},Ne=["for"],Ae=["id"],De={class:"form-check"},Ee=["id"],Pe=["for"],Le={class:"form-check"},Ie=["id"],ze=["for"],Ge={class:"form-check"},He=["id"],Ye=["for"];function Qe(s,e,l,i,o,a){const k=B("Vue3JsonEditor");return n(),d(m,null,[!o.editor&&o.mode===0?(n(),d("div",J,[t("div",N,[t("div",A,[t("div",null,[o.selectedRow==null?(n(),d("button",{key:0,type:"button",class:"btn btn-primary mb-2",onClick:e[0]||(e[0]=(...r)=>a.addRow&&a.addRow(...r))},"Добавить строку ")):c("",!0),o.selectedRow!=null?(n(),d("button",{key:1,type:"button",class:"btn btn-primary mb-2",onClick:e[1]||(e[1]=(...r)=>a.addRowAbove&&a.addRowAbove(...r))},"Добавить строку выше ")):c("",!0),o.selectedRow!=null?(n(),d("button",{key:2,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:e[2]||(e[2]=(...r)=>a.addRowBelow&&a.addRowBelow(...r))},"Добавить строку ниже ")):c("",!0),o.selectedRow!=null?(n(),d("button",{key:3,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:e[3]||(e[3]=r=>a.moveRow(0))},E)):c("",!0),o.selectedRow!=null?(n(),d("button",{key:4,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:e[4]||(e[4]=r=>a.moveRow(1))},L)):c("",!0),o.selectedRow!=null?(n(),d("button",{key:5,type:"button",class:"btn btn-outline-danger mb-2 ml-2",onClick:e[5]||(e[5]=(...r)=>a.reset&&a.reset(...r))},z)):c("",!0)]),t("div",G,[t("div",H,[h(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=r=>o.showCode=r),id:"showCode"+a.uuid},null,8,Y),[[F,o.showCode]]),t("label",{class:"form-check-label",for:"showCode"+a.uuid}," Отобразить код ",8,Q)])])]),o.keyboard.length>0?(n(),d("div",X,[(n(!0),d(m,null,_(o.keyboard,(r,u)=>(n(),d("div",W,[t("div",Z,[t("button",{type:"button",class:"btn btn-link w-100",onClick:w=>a.addColToRow(u)},te,8,x),t("button",{type:"button",class:"btn btn-link w-100",onClick:w=>a.removeColFromRow(u)},le,8,oe),t("button",{type:"button",class:"btn btn-link w-100",onClick:w=>a.moveCol(u,0)},de,8,ne),t("button",{type:"button",class:"btn btn-link w-100",onClick:w=>a.moveCol(u,1)},ce,8,re)]),t("div",he,[(n(!0),d(m,null,_(r,(w,f)=>(n(),d("div",{class:"btn-group dropdown-center w-100 m-1",onClick:C=>a.selectIndex(u,f)},[h(t("input",{type:"text",class:y([{"btn-outline-primary":o.select.row!=u||o.select.col!=f,"btn-primary":o.select.row==u&&o.select.col==f},"btn w-100"]),"onUpdate:modelValue":C=>o.keyboard[u][f].text=C},null,10,ue),[[b,o.keyboard[u][f].text]]),t("button",{type:"button",onClick:e[7]||(e[7]=C=>o.mode=1),class:"btn btn-outline-primary","aria-expanded":"false"},ye)],8,be))),256))])]))),256))])):c("",!0)]),o.showCode?(n(),d("div",_e,[t("div",pe,[ke,o.load?c("",!0):(n(),p(k,{key:0,mode:"code",modelValue:o.keyboard,"onUpdate:modelValue":e[8]||(e[8]=r=>o.keyboard=r),"show-btns":!1,expandedOnStart:!0,onJsonChange:a.onJsonChange},null,8,["modelValue","onJsonChange"]))])])):c("",!0)])):c("",!0),o.mode===1?(n(),d("div",fe,[t("div",ve,[t("div",we,[t("button",{type:"button",onClick:e[9]||(e[9]=r=>o.mode=0),class:"btn btn-outline-primary"},"Назад ")]),t("form",ge,[Ce,t("div",Fe,[t("label",{for:"command-title-"+o.select.row+"-col-"+o.select.сol,class:"form-label"},"Название кнопки",8,Re),h(t("input",{type:"text",id:"command-title-"+o.select.row+"-col-"+o.select.col,class:"form-control w-100","onUpdate:modelValue":e[10]||(e[10]=r=>o.keyboard[o.select.row][o.select.col].text=r)},null,8,$e),[[b,o.keyboard[o.select.row][o.select.col].text]])]),Ke,t("div",Te,[t("label",{for:"command-row-"+o.select.row+"-col-"+o.select.col,class:"form-label"},"Команда (для меню в сообщении)",8,Se),h(t("input",{type:"text",onChange:e[11]||(e[11]=r=>a.needRemoveField("callback_data",o.select.row,o.select.col)),"onUpdate:modelValue":e[12]||(e[12]=r=>o.keyboard[o.select.row][o.select.col].callback_data=r),class:"form-control",id:"command-row-"+o.select.row+"-col-"+o.select.col,placeholder:"/start"},null,40,Be),[[b,o.keyboard[o.select.row][o.select.col].callback_data]])]),t("div",Ve,[t("label",{for:"switch-inline-query-row-"+o.select.row+"-col-"+o.select.col,class:"form-label"},"Ссылка на аккаунт в ТЕЛЕГРАММ",8,je),h(t("input",{type:"text",class:"form-control",onChange:e[13]||(e[13]=r=>a.needRemoveField("switch_inline_query",o.select.row,o.select.col)),"onUpdate:modelValue":e[14]||(e[14]=r=>o.keyboard[o.select.row][o.select.col].switch_inline_query=r),id:"switch-inline-query-row-"+o.select.row+"-col-"+o.select.col,placeholder:"@YourAccountLink"},null,40,qe),[[b,o.keyboard[o.select.row][o.select.col].switch_inline_query]])]),t("div",Me,[t("label",{for:"url-row-"+o.select.row+"-col-"+o.select.col,class:"form-label"},"Внешняя URL-ссылка",8,Ue),h(t("input",{type:"text",class:"form-control",onChange:e[15]||(e[15]=r=>a.needRemoveField("url",o.select.row,o.select.col)),"onUpdate:modelValue":e[16]||(e[16]=r=>o.keyboard[o.select.row][o.select.col].url=r),id:"url-row-"+o.select.row+"-col-"+s.colIndex,placeholder:"https://t.me/example"},null,40,Oe),[[b,o.keyboard[o.select.row][o.select.col].url]])]),t("div",Je,[t("label",{for:"switch-inline-query-current-chat-row-"+o.select.row+"-col-"+o.select.col,class:"form-label"},"Команда всплывающего меню бота",8,Ne),h(t("input",{type:"text",class:"form-control",onChange:e[17]||(e[17]=r=>a.needRemoveField("switch_inline_query_current_chat",o.select.row,o.select.col)),"onUpdate:modelValue":e[18]||(e[18]=r=>o.keyboard[o.select.row][o.select.col].switch_inline_query_current_chat=r),id:"witch-inline-query-current-chat-row-"+o.select.row+"-col-"+o.select.col,placeholder:"команда"},null,40,Ae),[[b,o.keyboard[o.select.row][o.select.col].switch_inline_query_current_chat]])]),t("div",De,[t("input",{type:"radio",onChange:e[19]||(e[19]=r=>a.needRemoveField(null,o.select.row,o.select.col)),name:"request-radio",class:"form-check-input",id:"no-action-row-"+o.select.row+"-col-"+o.select.col},null,40,Ee),t("label",{class:"form-check-label",for:"no-action-row-"+o.select.row+"-col-"+o.select.col}," Без действий ",8,Pe)]),t("div",Le,[t("input",{type:"radio",onChange:e[20]||(e[20]=r=>a.needRemoveField("request_contact",o.select.row,o.select.col)),onClick:e[21]||(e[21]=r=>o.keyboard[o.select.row][o.select.col].request_contact=!0),name:"request-radio",class:"form-check-input",id:"phone-row-"+o.select.row+"-col-"+o.select.col},null,40,Ie),t("label",{class:"form-check-label",for:"phone-row-"+o.select.row+"-col-"+o.select.col}," Запросить телефон (для нижнего меню) ",8,ze)]),t("div",Ge,[t("input",{type:"radio",name:"request-radio",onChange:e[22]||(e[22]=r=>a.needRemoveField("request_location",o.select.row,o.select.col)),onClick:e[23]||(e[23]=r=>o.keyboard[o.select.row][o.select.col].request_location=!0),class:"form-check-input",id:"location-row-"+o.select.row+"-col-"+o.select.col},null,40,He),t("label",{class:"form-check-label",for:"location-row-"+o.select.row+"-col-"+o.select.col}," Запросить локацию (для нижнего меню) ",8,Ye)])])])])):c("",!0)],64)}const $=U(O,[["render",Qe]]);const Xe={key:0,class:"card"},We={key:0,class:"card-header d-flex justify-content-between align-items-center"},Ze=["disabled"],xe=t("i",{class:"fa-solid fa-arrow-left"},null,-1),et=[xe],tt=["disabled"],ot=t("i",{class:"fa-regular fa-pen-to-square"},null,-1),st=[ot],lt=["disabled"],nt=t("i",{class:"fa-regular fa-floppy-disk"},null,-1),it=[nt],dt={key:1,class:"card-header d-flex justify-content-between align-items-center"},rt={class:"mr-2"},at=["disabled"],ct=t("i",{class:"fa-regular fa-pen-to-square"},null,-1),ht=[ct],bt=["disabled"],ut=t("i",{class:"fa-regular fa-clone"},null,-1),mt=[ut],yt=["disabled"],_t=t("i",{class:"fa-regular fa-floppy-disk"},null,-1),pt=[_t],kt=["disabled"],ft=t("i",{class:"fa-solid fa-trash-can"},null,-1),vt=[ft],wt={class:"card-body"},gt={key:0,class:"row"},Ct={class:"col-md-6 col-12"},Ft={class:"mb-3"},Rt=t("label",{class:"form-label",id:"bot-domain"},"Тип",-1),$t=t("option",{value:"reply"},"Нижняя клавиатура",-1),Kt=t("option",{value:"inline"},"Встроенная клавиатура",-1),Tt=[$t,Kt],St={class:"col-md-6 col-12"},Bt={class:"mb-3"},Vt=t("label",{class:"form-label",id:"bot-domain"},"Мнемоническое имя",-1),jt={class:"row"},qt={class:"col-12"},Mt={class:"row"},Ut={class:"col-12"},Ot={class:"row"},Jt={class:"col"},Nt={type:"button",class:"btn btn-outline-primary w-100 mb-2"},At={key:1,class:"card"},Dt={class:"card-header d-flex justify-content-between align-items-center"},Et=["disabled"],Pt=t("i",{class:"fa-regular fa-floppy-disk"},null,-1),Lt=[Pt],It={key:0,class:"card-body"},zt={key:1,class:"card-body"},Gt=t("p",null,"Ошибка!",-1),Ht=[Gt],Yt={props:["keyboard","selectMode"],data:()=>({is_edited:!1,load:!1,keyboardForm:null}),computed:{uuid(){return R()}},watch:{keyboardForm:{handler(s){this.is_edited=!0},deep:!0}},mounted(){const s=this.keyboard;this.keyboardForm=s,this.$nextTick(()=>{this.is_edited=!1,Array.isArray(s.menu)||this.updateKeyboard()})},methods:{removeKeyboard(){this.$store.dispatch("removeKeyboardTemplate",{templateId:this.keyboardForm.id}).then(s=>{this.load=!0,this.$nextTick(()=>{this.load=!1}),this.$emit("callback",this.keyboardForm.id)}).catch(()=>{this.$emit("callback",this.keyboardForm.id)})},saveKeyboard(s){this.keyboardForm.menu=s},selectCard(){this.$emit("select",this.keyboardForm)},duplicateKeyboard(){let s=new FormData;Object.keys(this.keyboardForm).forEach(e=>{const l=this.keyboardForm[e]||"";typeof l=="object"?s.append(e,JSON.stringify(l)):s.append(e,l)}),this.$store.dispatch("createKeyboardTemplate",{keyboardForm:s}).then(e=>{this.$notify({title:"Конструктор ботов",text:"Меню успешно продублировано!",type:"success"}),this.load=!0,this.$nextTick(()=>{this.load=!1}),this.$emit("reload")})},updateKeyboard(){let s=new FormData;Object.keys(this.keyboardForm).forEach(e=>{const l=this.keyboardForm[e]||"";typeof l=="object"?s.append(e,JSON.stringify(l)):s.append(e,l)}),this.$store.dispatch("editKeyboardTemplate",{keyboardForm:s}).then(e=>{this.load=!0,this.$nextTick(()=>{this.load=!1,this.is_edited=!1}),this.$emit("callback")}).catch(()=>{this.is_edited=!1,this.$emit("callback")})}}},Qt=Object.assign(Yt,{__name:"KeyboardCard",setup(s){return(e,l)=>(n(),d(m,null,[e.is_edited?c("",!0):(n(),d("div",Xe,[s.selectMode?(n(),d("div",We,[t("div",null,[t("button",{onClick:l[0]||(l[0]=(...i)=>e.selectCard&&e.selectCard(...i)),disabled:e.load,type:"button",class:"btn btn-outline-success mr-2"},et,8,Ze),t("button",{onClick:l[1]||(l[1]=i=>e.is_edited=!0),disabled:e.load,type:"button",title:"Редактировать клавиатуру",class:"btn btn-outline-success mr-2"},st,8,tt),t("button",{onClick:l[2]||(l[2]=(...i)=>e.updateKeyboard&&e.updateKeyboard(...i)),type:"button",title:"Обновить клавиатуру",disabled:e.load||!e.is_edited,class:y(["btn btn-outline-primary mr-2",{"have-change":e.is_edited}])},it,10,lt)])])):c("",!0),s.selectMode?c("",!0):(n(),d("div",dt,[t("div",null,[t("strong",rt,"#"+v(s.keyboard.id),1),t("button",{onClick:l[3]||(l[3]=i=>e.is_edited=!0),disabled:e.load,type:"button",title:"Редактировать клавиатуру",class:"btn btn-outline-success mr-2"},ht,8,at),t("button",{onClick:l[4]||(l[4]=(...i)=>e.duplicateKeyboard&&e.duplicateKeyboard(...i)),type:"button",title:"Дублировать клавиатуру",disabled:e.load,class:"btn btn-outline-primary mr-2"},mt,8,bt),t("button",{onClick:l[5]||(l[5]=(...i)=>e.updateKeyboard&&e.updateKeyboard(...i)),type:"button",title:"Обновить клавиатуру",disabled:e.load||!e.is_edited,class:y(["btn btn-outline-primary mr-2",{"have-change":e.is_edited}])},pt,10,yt)]),t("button",{onClick:l[6]||(l[6]=(...i)=>e.removeKeyboard&&e.removeKeyboard(...i)),type:"button",disabled:e.load,title:"Удалить клавиатуру",class:"btn btn-outline-danger mr-2"},vt,8,kt)])),t("div",wt,[s.selectMode?c("",!0):(n(),d("div",gt,[t("div",Ct,[t("div",Ft,[Rt,h(t("select",{disabled:!0,"onUpdate:modelValue":l[7]||(l[7]=i=>s.keyboard.type=i),class:"form-control"},Tt,512),[[K,s.keyboard.type]])])]),t("div",St,[t("div",Bt,[Vt,h(t("input",{type:"text",class:"form-control",placeholder:"Мнемоническое имя",disabled:!0,"aria-label":"Мнемоническое имя","onUpdate:modelValue":l[8]||(l[8]=i=>s.keyboard.slug=i),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[b,s.keyboard.slug]])])])])),t("div",jt,[t("div",qt,[t("div",Mt,[t("div",Ut,[(n(!0),d(m,null,_(s.keyboard.menu,(i,o)=>(n(),d("div",Ot,[(n(!0),d(m,null,_(i,(a,k)=>(n(),d("div",Jt,[t("button",Nt,v(a.text),1)]))),256))]))),256))])])])])])])),e.is_edited?(n(),d("div",At,[t("div",Dt,[t("button",{onClick:l[9]||(l[9]=(...i)=>e.updateKeyboard&&e.updateKeyboard(...i)),type:"button",title:"Обновить клавиатуру",disabled:e.load||!e.is_edited,class:y(["btn btn-outline-primary mr-2",{"have-change":e.is_edited}])},Lt,10,Et)]),e.keyboardForm.length>0?(n(),d("div",It,[e.keyboardForm?(n(),p($,{key:0,onSave:e.saveKeyboard,"edited-keyboard":e.keyboardForm},null,8,["onSave","edited-keyboard"])):c("",!0)])):(n(),d("div",zt,Ht))])):c("",!0)],64))}}),Xt={key:0,class:"row mb-2"},Wt={class:"col-12"},Zt={class:"card"},xt=t("div",{class:"card-header"},[t("h6",null,"Форма создания шаблона клавиатуры")],-1),eo={class:"card-body"},to={class:"col-md-6 col-12"},oo={class:"mb-3"},so=t("label",{class:"form-label",id:"bot-domain"},"Тип",-1),lo=t("option",{value:"reply"},"Нижняя клавиатура",-1),no=t("option",{value:"inline"},"Встроенная клавиатура",-1),io=[lo,no],ro={class:"col-md-6 col-12"},ao={class:"mb-3"},co={class:"form-label d-flex justify-content-between",id:"bot-domain"},ho=t("span",null,"Мнемоническое имя",-1),bo=t("i",{class:"fa-solid fa-arrows-rotate"},null,-1),uo=[bo],mo={class:"col-12"},yo=t("div",{class:"col-12"},[t("button",{class:"btn btn-outline-success w-100 p-3"}," Добавить новый шаблон клавиатуры ")],-1),_o={class:"row"},po={key:0,class:"col-12"},ko={class:"badge bg-warning"},fo={class:"col-12 mb-3"},vo={key:1,class:"card"},wo={class:"card-body"},go={key:2,class:"col-12 mb-3"},Co=t("div",{class:"alert alert-warning",role:"alert"},[t("p",null,"Список шаблонов клавиатур пуст!")],-1),Fo=[Co],Ro={props:["selectMode","type"],data(){return{keyboards:[],load:!1,bot:null,editedKeyboard:null,selectMenuIndex:null,keyboardForm:{type:"reply",bot_id:null,slug:null,menu:[]}}},computed:{...T(["getCurrentBot"]),filteredKeyboard(){return this.type?this.keyboards.filter(s=>s.type==this.type):this.keyboards}},mounted(){this.loadCurrentBot().then(()=>{this.loadMenusByBotTemplate(),this.generateSlug()})},methods:{selectCard(s){this.$emit("select",s)},keyboardCallbackAction(s){let e=this.keyboards.find(l=>l.id===s);e&&(e.deleted_at=new Date),this.loadMenusByBotTemplate()},loadMenusByBotTemplate(){this.$store.dispatch("loadBotKeyboards",{botId:this.bot.id}).then(s=>{this.keyboards=s.data})},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},submitKeyboard(){this.keyboardForm.bot_id=this.bot.id;let s=new FormData;Object.keys(this.keyboardForm).forEach(e=>{const l=this.keyboardForm[e]||"";typeof l=="object"?s.append(e,JSON.stringify(l)):s.append(e,l)}),this.$store.dispatch("createKeyboardTemplate",{keyboardForm:s}).then(e=>{this.keyboardForm={type:"reply",bot_id:null,slug:null,menu:[]},this.load=!0,this.$nextTick(()=>{this.load=!1}),this.loadMenusByBotTemplate()})},generateSlug(){this.keyboardForm.slug=R()},changeKeyboardFormMenu(s){this.keyboardForm.menu=s}}},$o=Object.assign(Ro,{__name:"KeyboardList",setup(s){return(e,l)=>(n(),d(m,null,[s.selectMode?c("",!0):(n(),d("div",Xt,[t("div",Wt,[t("div",Zt,[xt,t("div",eo,[t("form",{onSubmit:l[3]||(l[3]=S((...i)=>e.submitKeyboard&&e.submitKeyboard(...i),["prevent"])),class:"row"},[t("div",to,[t("div",oo,[so,h(t("select",{"onUpdate:modelValue":l[0]||(l[0]=i=>e.keyboardForm.type=i),class:"form-control"},io,512),[[K,e.keyboardForm.type]])])]),t("div",ro,[t("div",ao,[t("label",co,[ho,t("a",{onClick:l[1]||(l[1]=(...i)=>e.generateSlug&&e.generateSlug(...i)),href:"#generate"},uo)]),h(t("input",{type:"text",class:"form-control",placeholder:"Мнемоническое имя","aria-label":"Мнемоническое имя","onUpdate:modelValue":l[2]||(l[2]=i=>e.keyboardForm.slug=i),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[b,e.keyboardForm.slug]])])]),t("div",mo,[e.load?c("",!0):(n(),p($,{key:0,onSave:e.changeKeyboardFormMenu,"edited-keyboard":e.keyboardForm},null,8,["onSave","edited-keyboard"]))]),yo],32)])])])])),t("div",_o,[e.keyboards&&e.bot?(n(),d("div",po,[t("p",null,[g("В списке клавиатур "),t("span",ko,v(e.filteredKeyboard.length)+" ед.",1)])])):c("",!0),e.keyboards&&e.bot?(n(!0),d(m,{key:1},_(e.filteredKeyboard,(i,o)=>(n(),d("div",fo,[i.deleted_at?(n(),d("div",vo,[t("div",wo,[t("p",null,"Удаленная клавиатура #"+v(i.id),1)])])):(n(),p(Qt,{key:0,"select-mode":s.selectMode,onSelect:e.selectCard,onReload:e.loadMenusByBotTemplate,onCallback:e.keyboardCallbackAction,keyboard:i},null,8,["select-mode","onSelect","onReload","onCallback","keyboard"]))]))),256)):c("",!0),e.filteredKeyboard.length===0?(n(),d("div",go,Fo)):c("",!0)])],64))}}),Ko={class:"col-md-12 col-12"},To={class:"mb-3"},So=t("i",{class:"fa-solid fa-xmark"},null,-1),Bo=[So],Vo={class:"mb-3"},jo={class:"d-flex justify-content-between flex-wrap al"},qo=t("label",{class:"form-label",id:"bot-main-channel"},"Канал для постов (id,рекламный)",-1),Mo={class:"d-flex flex-wrap align-items-center"},Uo=t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Oo={class:"col-12 mb-2"},Jo=t("label",{class:"form-label d-flex justify-content-between align-items-center mb-2",id:"bot-domain"},[g(" Текстовое содержимое страницы "),t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),No={class:"form-floating"},Ao={for:"floatingTextarea2"},Do={key:0},Eo={class:"col-12 mb-2"},Po={class:"form-check"},Lo=t("label",{class:"form-check-label",for:"need-page-images"}," Изображения на странице (максимум 10) ",-1),Io={key:0,class:"col-12 mb-2"},zo={class:"card mb-3"},Go=t("div",{class:"card-header"},[t("h6",null,"Изображения на странице")],-1),Ho={class:"card-body d-flex justify-content-start"},Yo={for:"photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},Qo={class:"row"},Xo={key:0,class:"col-12 d-flex flex-wrap"},Wo={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Zo={class:"remove"},xo=["onClick"],es={class:"col-12 mb-2"},ts={class:"form-check"},os=t("label",{class:"form-check-label",for:"need-inline-menu"}," Меню под текстом страницы ",-1),ss={key:1,class:"col-12 mb-2"},ls={class:"card"},ns={class:"card-header d-flex justify-between align-items-center"},is=t("h6",null,"Конструктор меню в сообщении",-1),ds={key:0},rs={key:1},as={class:"card-body"},cs=t("div",{class:"col-12"},[t("button",{type:"submit",class:"btn btn-success w-100 p-3"}," Отправить сообщение в канал ")],-1),hs={data(){return{load:!1,photos:[],showInlineTemplateSelector:!1,need_page_images:!1,need_inline_menu:!1,bot:null,mailForm:{text:"",inline_keyboard:null,channel:null}}},computed:{...T(["getCurrentBot"])},mounted(){this.loadCurrentBot()},methods:{addTextTo(s={param:null,text:null}){this.mailForm.channel=s.text},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},submitMail(){let s=new FormData;if(Object.keys(this.mailForm).forEach(e=>{const l=this.mailForm[e]||"";typeof l=="object"?s.append(e,JSON.stringify(l)):s.append(e,l)}),this.bot&&s.append("bot_id",this.bot.id),this.photos.length>0)for(let e=0;e<this.photos.length;e++)s.append("photos[]",this.photos[e]);this.$store.dispatch("sendToChannel",{mailForm:s}).then(e=>{this.load=!0,this.photos=[],this.need_inline_menu=!1,this.need_page_images=!1,this.mailForm={text:"",channel:null,inline_keyboard:null},this.$notify({title:"Конструктор ботов",text:"Сообщение успещно отправлено!",type:"success"})}).catch(e=>{})},saveInlineKeyboard(s){this.mailForm.inline_keyboard=s},selectInlineKeyboard(s){this.mailForm.inline_keyboard=s,this.showInlineTemplateSelector=!1},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removePhoto(s){this.photos.splice(s,1)},removeImage(s){this.mailForm.images.splice(s,1)},onChangePhotos(s){const e=s.target.files;for(let l=0;l<e.length;l++)this.photos.push(e[l])}}},_s=Object.assign(hs,{__name:"Mail",setup(s){return(e,l)=>{const i=V("lazy");return e.bot?(n(),d("form",{key:0,onSubmit:l[9]||(l[9]=S((...o)=>e.submitMail&&e.submitMail(...o),["prevent"]))},[t("div",Ko,[t("div",To,[e.mailForm.channel!=null?(n(),d("button",{key:0,type:"button",class:"btn btn-outline-info mr-2",onClick:l[0]||(l[0]=o=>e.mailForm.channel=null)},Bo)):c("",!0),t("button",{type:"button",class:y(["btn mr-2",{"btn-info":e.mailForm.channel===e.bot.main_channel,"btn-outline-info":e.mailForm.channel!==e.bot.main_channel}]),onClick:l[1]||(l[1]=o=>e.mailForm.channel=e.bot.main_channel)},"Главный канал ",2),t("button",{type:"button",class:y(["btn",{"btn-info":e.mailForm.channel===e.bot.order_channel,"btn-outline-info":e.mailForm.channel!==e.bot.order_channel}]),onClick:l[2]||(l[2]=o=>e.mailForm.channel=e.bot.order_channel)},"Канал заказов ",2)]),t("div",Vo,[t("div",jo,[qo,t("div",Mo,[j(M,{token:e.bot.bot_token,param:"channel",onCallback:e.addTextTo},null,8,["token","onCallback"]),Uo])]),h(t("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":l[3]||(l[3]=o=>e.mailForm.channel=o),maxlength:"255","aria-describedby":"bot-main-channel",required:""},null,512),[[b,e.mailForm.channel]])])]),t("div",Oo,[Jo,t("div",No,[h(t("textarea",{class:"form-control","onUpdate:modelValue":l[4]||(l[4]=o=>e.mailForm.text=o),maxlength:"4096",placeholder:"Введите текст",id:"floatingTextarea2",style:{"min-height":"100px"},required:""},null,512),[[b,e.mailForm.text]]),t("label",Ao,[g("Содержимое страницы "),e.mailForm.text?(n(),d("span",Do,v(e.mailForm.text.length)+"/4096 ",1)):c("",!0)])])]),t("div",Eo,[t("div",Po,[h(t("input",{class:"form-check-input","onUpdate:modelValue":l[5]||(l[5]=o=>e.need_page_images=o),type:"checkbox",id:"need-page-images"},null,512),[[F,e.need_page_images]]),Lo])]),e.need_page_images?(n(),d("div",Io,[t("div",zo,[Go,t("div",Ho,[t("label",Yo,[g(" + "),t("input",{type:"file",id:"photos",multiple:"",accept:"image/*",onChange:l[6]||(l[6]=(...o)=>e.onChangePhotos&&e.onChangePhotos(...o)),style:{display:"none"}},null,32)]),t("div",Qo,[e.photos.length>0?(n(),d("div",Xo,[(n(!0),d(m,null,_(e.photos,(o,a)=>(n(),d("div",Wo,[h(t("img",null,null,512),[[i,e.getPhoto(o).imageUrl]]),t("div",Zo,[t("a",{onClick:k=>e.removePhoto(a)},"Удалить",8,xo)])]))),256))])):c("",!0)])])])])):c("",!0),t("div",es,[t("div",ts,[h(t("input",{class:"form-check-input","onUpdate:modelValue":l[7]||(l[7]=o=>e.need_inline_menu=o),type:"checkbox",id:"need-inline-menu"},null,512),[[F,e.need_inline_menu]]),os])]),e.need_inline_menu?(n(),d("div",ss,[t("div",ls,[t("div",ns,[is,t("button",{class:y(["btn",{"btn-outline-primary":!e.showInlineTemplateSelector,"btn-primary":e.showInlineTemplateSelector}]),type:"button",onClick:l[8]||(l[8]=o=>e.showInlineTemplateSelector=!e.showInlineTemplateSelector)},[e.showInlineTemplateSelector?(n(),d("span",rs," Скрыть шаблоны меню")):(n(),d("span",ds," Открыть шаблоны меню"))],2)]),t("div",as,[e.showInlineTemplateSelector?(n(),p($o,{key:0,class:"mb-2",type:"inline",onSelect:e.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(n(),p($,{key:1,type:"inline",onSave:e.saveInlineKeyboard,"edited-keyboard":e.mailForm.inline_keyboard},null,8,["onSave","edited-keyboard"]))])])])):c("",!0),cs],32)):c("",!0)}}});export{$ as B,$o as _,_s as a};
