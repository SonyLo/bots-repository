import{G as v,q as i,t as n,v as t,H as r,J as h,R as m,K as _,A as a,F as b,C as g,x as p,D as c,y as f,u as j,B as $,X as S,P,L as K}from"./index.es-71d37bd0.js";import{P as F}from"./Pagination-c0ff4992.js";import{V as w}from"./vue3-json-editor.esm.prod-61e9e0df.js";import{v as R}from"./v4-a960c1f4.js";import{T as B}from"./TelegramChannelHelper-93d52940.js";import{_ as T}from"./BotMediaList-53d8d6dc.js";const I={class:"row"},M={class:"input-group mb-3"},O={class:"row"},U={class:"col-12"},q={class:"form-check"},Q=t("label",{class:"form-check-label",for:"need-new-first"},"Сперва новые",-1),A={class:"col-12"},D={class:"form-check"},J=t("label",{class:"form-check-label",for:"needDeleted"},"Отобразить удаленные",-1),L={key:0,class:"row"},z={key:0,class:"col-12"},N={class:"col-12 mb-3"},E={class:"list-group w-100"},G={class:"d-flex justify-content-between"},H=["onClick"],X={key:0},Y={key:1},W={key:2,title:"Вы не можете выбрать данную страницу"},Z=t("i",{class:"fa-solid fa-lock ml-2 text-danger"},null,-1),x=[Z],ee={key:0},te={class:"dropdown"},se=t("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"fa-solid fa-ellipsis"})],-1),oe={class:"dropdown-menu"},le={key:0},ie=["onClick"],ne=t("i",{class:"fa-solid fa-copy mr-1"},null,-1),ae={key:1},de=["onClick"],re=t("i",{class:"fa-solid fa-ban mr-1"},null,-1),ce=["onClick"],he=t("i",{class:"fa-solid fa-copy mr-1"},null,-1),ue={key:2},me=["onClick"],be=t("i",{class:"fa-solid fa-trash mr-1"},null,-1),pe={key:0,class:"component-icons"},_e={key:0},ye=t("i",{class:"fa-regular fa-images"},null,-1),fe=[ye],ke={key:1},ge=t("i",{class:"fa-regular fa-note-sticky"},null,-1),$e=[ge],ve={key:2},we=t("i",{class:"fa-solid fa-photo-film"},null,-1),Ce=[we],Fe={key:3},Pe=t("i",{class:"fa-regular fa-file-audio"},null,-1),Re=[Pe],je={key:4},Se=t("i",{class:"fa-regular fa-file-word"},null,-1),Ve=[Se],Ke={key:5},Be=t("i",{class:"fa-solid fa-link"},null,-1),Te=[Be],Ie={key:6},Me=t("i",{class:"fa-solid fa-scroll"},null,-1),Oe=[Me],Ue={key:7},qe=t("i",{class:"fa-regular fa-comment-dots"},null,-1),Qe=[qe],Ae={key:8},De=t("i",{class:"fa-solid fa-scale-balanced"},null,-1),Je=[De],Le={key:9},ze=t("i",{class:"fa-regular fa-keyboard"},null,-1),Ne=[ze],Ee={key:10},Ge=t("i",{class:"fa-solid fa-ellipsis"},null,-1),He=[Ge],Xe={class:"col-12"},Ye={key:1,class:"row"},We=t("div",{class:"col-12"},[t("div",{class:"alert alert-warning",role:"alert"}," Созданных страниц не найдено! ")],-1),Ze=[We],xe={props:["editor","current","selected"],data(){return{bot:null,current_page:0,need_deleted:!1,need_new_first:!0,loading:!0,pages:[],search:null,pages_paginate_object:null,need_new_page:!1}},watch:{need_new_first:function(o,e){this.nextPages(0)},need_deleted:function(o,e){this.nextPages(0)},getPages:function(o,e){this.$nextTick(()=>{this.search||(this.pages=this.getPages)})},search:function(o,e){this.nextPages(0)}},computed:{...v(["getPages","getCurrentBot","getPagesPaginateObject"])},mounted(){this.loadCurrentBot().then(()=>{this.bot&&(this.current_page=localStorage.getItem(`cashman_pagelist_${this.bot.id}_page_index`)||0),this.loadPages()})},methods:{loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},selectPage(o){this.$emit("callback",o)},nextPages(o){this.current_page=o,this.bot&&localStorage.setItem(`cashman_pagelist_${this.bot.id}_page_index`,this.current_page),this.loadPages()},duplicatePage(o){this.loading=!0,this.$store.dispatch("duplicatePage",{dataObject:{pageId:o}}).then(e=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},forceRemovePage(o){this.loading=!0,this.$store.dispatch("forceRemovePage",{dataObject:{pageId:o}}).then(e=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},restorePage(o){this.loading=!0,this.$store.dispatch("restorePage",{dataObject:{pageId:o}}).then(e=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},removePage(o){this.loading=!0,this.$store.dispatch("removePage",{dataObject:{pageId:o}}).then(e=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},loadPages(){this.loading=!0,this.$store.dispatch("loadPages",{dataObject:{botId:this.bot.id||null,search:this.search||null,needDeleted:this.need_deleted,needNewFirst:this.need_new_first},page:this.current_page||0}).then(o=>{this.loading=!1,this.pages=this.getPages,this.pages_paginate_object=this.getPagesPaginateObject,this.pages.length===0&&localStorage.setItem(`cashman_pagelist_${this.bot.id}_page_index`,0)}).catch(()=>{this.loading=!1})}}},et=Object.assign(xe,{__name:"PagesList",setup(o){return(e,s)=>(i(),n(b,null,[t("div",I,[t("div",M,[r(t("input",{type:"search",class:"form-control",placeholder:"Поиск страницы","aria-label":"Поиск бота","onUpdate:modelValue":s[0]||(s[0]=l=>e.search=l),"aria-describedby":"button-addon2"},null,512),[[h,e.search]]),t("button",{class:"btn btn-outline-secondary",onClick:s[1]||(s[1]=(...l)=>e.loadPages&&e.loadPages(...l)),type:"button",id:"button-addon2"},"Найти ")])]),t("div",O,[t("div",U,[t("div",q,[r(t("input",{class:"form-check-input","onUpdate:modelValue":s[2]||(s[2]=l=>e.need_new_first=l),type:"checkbox",id:"need-new-first"},null,512),[[m,e.need_new_first]]),Q])]),t("div",A,[t("div",D,[r(t("input",{class:"form-check-input","onUpdate:modelValue":s[3]||(s[3]=l=>e.need_deleted=l),type:"checkbox",id:"needDeleted"},null,512),[[m,e.need_deleted]]),J])])]),e.pages.length>0?(i(),n("div",L,[e.pages.length>7?(i(),n("div",z,[e.pages_paginate_object?(i(),_(F,{key:0,onPagination_page:e.nextPages,pagination:e.pages_paginate_object},null,8,["onPagination_page","pagination"])):a("",!0)])):a("",!0),t("div",N,[t("ul",E,[(i(!0),n(b,null,g(e.pages,(l,d)=>(i(),n("li",{class:p(["list-group-item cursor-pointer page-menu-item btn btn-outline-info mb-1",{"border border-warning":l.deleted_at!=null}])},[t("div",G,[t("strong",{onClick:u=>e.selectPage(l)},[c("#"+f(l.id||"Не указано")+" ",1),l.slug?(i(),n("span",X,f(l.slug.command||"Не указано"),1)):(i(),n("span",Y,"Не привязано к команде")),o.current&&o.current==l.id||(o.selected||[]).indexOf(l.id)!=-1?(i(),n("span",W,x)):a("",!0)],8,H),o.editor?(i(),n("div",ee,[t("div",te,[se,t("ul",oe,[l.deleted_at!=null?(i(),n("li",le,[t("a",{class:"dropdown-item",onClick:u=>e.restorePage(l.id)},[ne,c("Восстановить")],8,ie)])):a("",!0),l.deleted_at!=null?(i(),n("li",ae,[t("a",{class:"dropdown-item",onClick:u=>e.forceRemovePage(l.id)},[re,c("Удалить полностью")],8,de)])):a("",!0),t("li",null,[t("a",{class:"dropdown-item",onClick:u=>e.duplicatePage(l.id)},[he,c("Дублировать")],8,ce)]),l.deleted_at==null?(i(),n("li",ue,[t("a",{class:"dropdown-item",onClick:u=>e.removePage(l.id)},[be,c("Удалить")],8,me)])):a("",!0)])])])):a("",!0)]),l?(i(),n("ul",pe,[(l.images||[]).length>0?(i(),n("li",_e,fe)):a("",!0),l.sticker?(i(),n("li",ke,$e)):a("",!0),(l.videos||[]).length>0?(i(),n("li",ve,Ce)):a("",!0),(l.audios||[]).length>0?(i(),n("li",Fe,Re)):a("",!0),(l.documents||[]).length>0?(i(),n("li",je,Ve)):a("",!0),l.next_page_id?(i(),n("li",Ke,Te)):a("",!0),l.next_bot_menu_slug_id?(i(),n("li",Ie,Oe)):a("",!0),l.next_bot_dialog_command_id?(i(),n("li",Ue,Qe)):a("",!0),l.rules_if?(i(),n("li",Ae,Je)):a("",!0),l.reply_keyboard_id?(i(),n("li",Le,Ne)):a("",!0),l.inline_keyboard_id?(i(),n("li",Ee,He)):a("",!0)])):a("",!0)],2))),256))])]),t("div",Xe,[e.pages_paginate_object?(i(),_(F,{key:0,onPagination_page:e.nextPages,pagination:e.pages_paginate_object},null,8,["onPagination_page","pagination"])):a("",!0)])])):(i(),n("div",Ye,Ze))],64))}}),tt={class:"row"},st={class:"col-12"},ot={class:"input-group mb-3"},lt={class:"col-12"},it={class:"form-check"},nt={class:"form-check-label",for:"loadAndOrder-id"},at={key:0,class:"fa-solid fa-chevron-up"},dt={key:1,class:"fa-solid fa-chevron-down"},rt={class:"form-check"},ct={class:"form-check-label",for:"loadAndOrder-command"},ht={key:0,class:"fa-solid fa-chevron-up"},ut={key:1,class:"fa-solid fa-chevron-down"},mt={class:"form-check"},bt={class:"form-check-label",for:"loadAndOrder-updated_at"},pt={key:0,class:"fa-solid fa-chevron-up"},_t={key:1,class:"fa-solid fa-chevron-down"},yt=["onClick"],ft={class:"card-body d-flex justify-content-between"},kt={style:{"min-width":"50px"},class:"badge bg-primary d-flex justify-content-center align-items-center"},gt={key:1},$t={class:"col-12 mt-2"},vt={data(){return{direction:"desc",order:"updated_at",show:!0,loading:!0,current_page:0,queries:[],search:null,paginate_object:null}},computed:{...v(["getCurrentBot","getInlineQueries","getInlineQueriesPaginateObject"])},mounted(){this.loadCurrentBot().then(()=>{this.bot&&(this.current_page=localStorage.getItem(`cashman_inline_query_list_${this.bot.id}_page_index`)||0),this.loadInlineQueries()})},methods:{loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},nextInlineQuery(o){this.loadInlineQueries(o)},selectInlineQuery(o){this.$emit("select",o)},loadAndOrder(o){this.order=o,this.direction=this.direction==="desc"?"asc":"desc",this.loadInlineQueries(0)},loadInlineQueries(o=0){this.loading=!0,this.$store.dispatch("loadInlineQueries",{dataObject:{bot_id:this.bot.id||null,search:this.search,order:this.order,direction:this.direction},page:o,size:100}).then(e=>{this.loading=!1,this.queries=this.getInlineQueries,this.paginate_object=this.getInlineQueriesPaginateObject}).catch(()=>{this.loading=!1})}}},wt=Object.assign(vt,{__name:"InlineQueryList",setup(o){return(e,s)=>(i(),n("div",tt,[t("div",st,[t("div",ot,[r(t("input",{type:"search",class:"form-control",placeholder:"Поиск страницы","aria-label":"Поиск бота","onUpdate:modelValue":s[0]||(s[0]=l=>e.search=l),"aria-describedby":"button-addon2"},null,512),[[h,e.search]]),t("button",{class:"btn btn-outline-secondary",onClick:s[1]||(s[1]=l=>e.loadInlineQueries(0)),type:"button",id:"button-addon2"},"Найти ")])]),t("div",lt,[t("div",it,[t("input",{class:"form-check-input",onClick:s[2]||(s[2]=l=>e.loadAndOrder("id")),type:"radio",name:"flexRadioDefault",id:"loadAndOrder-id"}),t("label",nt,[c(" По порядку "),e.direction==="asc"&&e.order==="id"?(i(),n("i",at)):a("",!0),e.direction==="desc"&&e.order==="id"?(i(),n("i",dt)):a("",!0)])]),t("div",rt,[t("input",{class:"form-check-input",onClick:s[3]||(s[3]=l=>e.loadAndOrder("command")),type:"radio",name:"flexRadioDefault",id:"loadAndOrder-command"}),t("label",ct,[c(" По команде "),e.direction==="asc"&&e.order==="command"?(i(),n("i",ht)):a("",!0),e.direction==="desc"&&e.order==="command"?(i(),n("i",ut)):a("",!0)])]),t("div",mt,[t("input",{class:"form-check-input",onClick:s[4]||(s[4]=l=>e.loadAndOrder("updated_at")),type:"radio",name:"flexRadioDefault",id:"loadAndOrder-updated_at"}),t("label",bt,[c(" По дате обновления "),e.direction==="asc"&&e.order==="updated_at"?(i(),n("i",pt)):a("",!0),e.direction==="desc"&&e.order==="updated_at"?(i(),n("i",_t)):a("",!0)])]),e.queries.length>0?(i(!0),n(b,{key:0},g(e.queries,(l,d)=>(i(),n("div",{class:p(["card mb-2 cursor-pointer",{"border-info":l.deleted_at==null,"border-danger":l.deleted_at!=null}]),onClick:u=>e.selectInlineQuery(l)},[t("div",ft,[t("p",null,f(l.command||"Не указано"),1),t("span",kt,f(l.items.length),1)])],10,yt))),256)):(i(),n("p",gt,"На текущий момент нет ни одной созданной команды"))]),t("div",$t,[e.paginate_object?(i(),_(F,{key:0,onPagination_page:e.nextInlineQuery,pagination:e.paginate_object},null,8,["onPagination_page","pagination"])):a("",!0)])]))}});const Ct={key:0},Ft={class:"row"},Pt={class:"col-12 d-flex justify-content-between"},Rt=t("i",{class:"fa-solid fa-arrows-up-to-line"},null,-1),jt=[Rt],St=t("i",{class:"fa-solid fa-arrows-down-to-line"},null,-1),Vt=[St],Kt=t("i",{class:"fa-solid fa-xmark"},null,-1),Bt=[Kt],Tt={class:"d-flex flex-column"},It={class:"form-check"},Mt=["id"],Ot=["for"],Ut={key:0,class:"col-12"},qt={class:"row"},Qt={class:"col-12 d-flex justify-content-center p-1"},At=["onClick"],Dt=["onUpdate:modelValue"],Jt={class:"dropdown"},Lt=t("a",{class:"btn btn-outline-primary rounded-0",href:"javascript:void(0)",role:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"fa-solid fa-ellipsis-vertical"})],-1),zt={class:"dropdown-menu"},Nt=["onClick"],Et=t("a",{class:"dropdown-item",href:"javascript:void(0)"},[t("i",{class:"fa-solid fa-plus mr-2"}),c(" добавить кнопку ")],-1),Gt=[Et],Ht=t("a",{class:"dropdown-item",href:"javascript:void(0)"},[t("i",{class:"fa-solid fa-minus mr-2"}),c(" удалить кнопку ")],-1),Xt=[Ht],Yt=["onClick"],Wt=t("a",{class:"dropdown-item",href:"javascript:void(0)"},[t("i",{class:"fa-solid fa-caret-left mr-2"}),c(" переместить влево ")],-1),Zt=[Wt],xt=["onClick"],es=t("a",{class:"dropdown-item",href:"javascript:void(0)"},[t("i",{class:"fa-solid fa-caret-right mr-2"}),c(" переместить вправо ")],-1),ts=[es],ss=["onClick"],os=t("a",{class:"dropdown-item",href:"javascript:void(0)"},[t("i",{class:"fa-solid fa-caret-up mr-2"}),c(" переместить вверх ")],-1),ls=[os],is=["onClick"],ns=t("a",{class:"dropdown-item",href:"javascript:void(0)"},[t("i",{class:"fa-solid fa-caret-down mr-2"}),c(" переместить вниз ")],-1),as=[ns],ds=t("i",{class:"fa-solid fa-bars"},null,-1),rs=[ds],cs={key:0,class:"mb-3"},hs={class:"form-check"},us=t("label",{class:"form-check-label",for:"need-is_persistent"}," Скрывать клавиатуру автоматически ",-1),ms={class:"form-check"},bs=t("label",{class:"form-check-label",for:"need-one_time_keyboard"}," Клавиатура показывается только 1 раз ",-1),ps={class:"form-check"},_s=t("label",{class:"form-check-label",for:"need-resize_keyboard"}," Клавиши масштабируются ",-1),ys={class:"form-check"},fs=t("label",{class:"form-check-label",for:"need_input_field_placeholder"}," Нужна подсказка к клавиатуре ",-1),ks={key:0,class:"form-floating mb-3"},gs=t("label",{for:"input_field_placeholder"},"Подсказка к клавиатуре",-1),$s={key:1,class:"row"},vs={class:"col-12"},ws=t("label",{class:"form-label",id:"bot-domain"},"JSON-код клавиатуры",-1),Cs={key:1},Fs={class:"row"},Ps={class:"col-12 mb-2"},Rs={class:"col-12"},js=t("div",{class:"alert alert-danger",role:"alert"}," Возможно выбрать только 1 тип действия ",-1),Ss={class:"mb-3"},Vs=["for"],Ks={class:"input-group"},Bs=["id"],Ts=t("i",{class:"fa-solid fa-bars"},null,-1),Is=[Ts],Ms=t("hr",null,null,-1),Os={key:0,class:"mb-3"},Us=["for"],qs=["id"],Qs={key:1,class:"mb-3"},As=["for"],Ds=["id"],Js={key:2,class:"mb-3"},Ls=["for"],zs=["id"],Ns={key:3,class:"mb-3"},Es=["for"],Gs=t("div",{class:"alert alert-warning",role:"alert"}," Внимание! Режим всплывающего меню должен быть настроен в BotFather-е в разделе редактирования бота InlineMode. Сперва нужно включить данный режим. ",-1),Hs={class:"input-group mb-3"},Xs=["id"],Ys=t("i",{class:"fa-solid fa-bars"},null,-1),Ws=[Ys],Zs={key:4,class:"mb-3"},xs={class:"form-check"},eo=t("label",{class:"form-check-label",for:"need-login-url"}," Добавить ссылку авторизации ",-1),to={key:0,class:"mb-3"},so=["for"],oo=["id"],lo={key:1,class:"mb-3"},io=["for"],no=["id"],ao={key:2,class:"mb-3"},ro=["for"],co=["id"],ho={key:3,class:"form-check mb-3"},uo=t("label",{class:"form-check-label",for:"need-request_write_access"}," Запросить отправку сообщений ботом ",-1),mo={key:5,class:"form-check"},bo=["id"],po=["for"],_o={key:6,class:"form-check"},yo=["checked","id"],fo=["for"],ko={key:7,class:"form-check"},go=["checked","id"],$o=["for"],vo=["id"],wo={class:"modal-dialog"},Co={class:"modal-content"},Fo={class:"modal-body"},Po=["id"],Ro={class:"modal-dialog"},jo={class:"modal-content"},So={class:"modal-body"},Vo={props:["editedKeyboard","type"],components:{Vue3JsonEditor:w},computed:{uuid(){return R()}},watch:{need_login_url:{handler:function(o){this.need_login_url?this.keyboard[this.select.row][this.select.col].login_url={url:null,forward_text:null,bot_username:null,request_write_access:!0}:delete this.keyboard[this.select.row][this.select.col].login_url},deep:!0},keyboard:{handler:function(o){this.save()},deep:!0}},data(){return{need_input_field_placeholder:!1,settings:{resize_keyboard:!0,one_time_keyboard:!1,input_field_placeholder:null,is_persistent:!1},need_login_url:!1,pageModal:null,inlineQueryModal:null,mode:0,editor:!1,showCode:!1,showAssign:!1,selectedRow:null,load:!1,rowCount:1,keyboard:[],select:{row:0,col:0,type:this.type||"reply"}}},mounted(){this.pageModal=new bootstrap.Modal(document.getElementById("page-list-in-keyboard-"+this.uuid),{}),this.inlineQueryModal=new bootstrap.Modal(document.getElementById("inline-query-list-in-keyboard-"+this.uuid),{}),this.editedKeyboard&&this.$nextTick(()=>{this.keyboard=this.editedKeyboard.menu,this.settings={resize_keyboard:this.editedKeyboard.settings.resize_keyboard||!0,one_time_keyboard:this.editedKeyboard.settings.one_time_keyboard||!1,input_field_placeholder:this.editedKeyboard.settings.input_field_placeholder||null,is_persistent:this.editedKeyboard.settings.is_persistent||!1},this.settings.input_field_placeholder!=null&&(this.need_input_field_placeholder=!0)})},methods:{selectInlineQuery(o){this.keyboard[this.select.row][this.select.col].switch_inline_query_current_chat=o.command,this.$notify({title:"Конструктор страниц",text:"Вы успешно выбрали страницу",type:"success"}),this.inlineQueryModal.hide()},openInlineQueryModal(){this.inlineQueryModal.show()},openPageModal(){this.pageModal.show()},attachPage(o){let e=(o.slug.command||"Нет команды").replace(".*","");this.keyboard[this.select.row][this.select.col].text=e,this.$notify({title:"Конструктор страниц",text:"Вы успешно выбрали страницу",type:"success"}),this.type==="inline"&&(this.keyboard[this.select.row][this.select.col].callback_data=e)},reset(){this.selectedRow=null,this.select={row:-1,col:-1,type:this.type||"reply"}},removeSelectedButton(){this.keyboard[this.select.row].splice(this.select.col,1);let o=this.select.row;this.reset(),this.keyboard[o].length===0&&this.keyboard.splice(o,1)},needRemoveField(o,e,s){Object.keys(this.keyboard[e][s]).forEach(l=>{l!=="text"&&l!==o&&delete this.keyboard[e][s][l]})},save(){this.$emit("save",this.keyboard),this.type==="reply"&&this.$emit("save-settings",this.settings)},onJsonChange(o){this.keyboard=o,this.save()},removeColFromRow(o){this.keyboard[o].length>1?this.keyboard[o].splice(this.keyboard[o].length-1,1):this.keyboard.splice(o,1),this.keyboard.length===0&&(this.selectedRow=null),this.save()},addRowAbove(){this.addRow(!0)},moveColVertical(o,e){let s=this.keyboard.length,l=e===0?this.select.row-1>=0?this.select.row-1:s-1:this.select.row<s-1?this.select.row+1:0,d=this.keyboard[this.select.row][this.select.col];this.keyboard[this.select.row].splice(this.select.col,1),console.log(this.keyboard[this.select.row].length,this.select.row),this.keyboard[l].push(d),this.keyboard[this.select.row].length===0&&this.keyboard.splice(this.select.row,1),this.select.row=l,this.select.col=this.keyboard[l].length-1,this.select.text=this.keyboard[l][0].text,this.selectedRow=l},moveCol(o,e=0){o!==this.select.row&&(this.select.row=o,this.select.col=0,this.select.text=this.keyboard[this.select.row][this.select.col]);let s=this.select.row,l=this.select.col,d=this.keyboard[s].length,u=e===0?l-1>=0?l-1:d-1:l<d-1?l+1:0,k=this.keyboard[s][l];this.keyboard[s][l]=this.keyboard[s][u],this.keyboard[s][u]=k,this.select.row=s,this.select.col=u,this.select.text=this.keyboard[s][u].text},moveRow(o=0){if(this.selectedRow==null)return;let e=this.keyboard.length,s=o===0?this.selectedRow-1>=0?this.selectedRow-1:e-1:this.selectedRow<e-1?this.selectedRow+1:0,l=this.keyboard[this.selectedRow];this.keyboard[this.selectedRow]=this.keyboard[s],this.keyboard[s]=l,this.select.row=s,this.select.col=0,this.select.text=this.keyboard[s][0].text,this.selectedRow=s},addRowBelow(){this.addRow(!1)},addRow(o=!1){if(this.selectedRow==null)this.keyboard?this.keyboard.push([{text:"Нет команды"}]):this.keyboard=[[{text:"Нет команды"}]],this.selectedRow=null;else{let e=o?this.selectedRow:this.selectedRow+1;this.keyboard.splice(e,0,[{text:"Нет команды"}])}this.save()},addColToRow(o){this.keyboard[o].push({text:"Нет команды"}),this.save()},selectIndex(o,e){this.selectedRow=o,this.select.row=o,this.select.col=e,this.keyboard[o]&&this.keyboard[o][e]&&(this.select.text=this.keyboard[o][e].text||""),this.load=!0,this.$nextTick(()=>{this.load=!1})},removeCol(o,e){this.keyboard[o].length>1?this.keyboard[o].splice(e,1):this.keyboard.splice(1,1),this.save()}}},C=Object.assign(Vo,{__name:"KeyboardConstructor",setup(o){return(e,s)=>(i(),n(b,null,[!e.editor&&e.mode===0?(i(),n("div",Ct,[t("div",Ft,[t("div",Pt,[t("div",null,[e.selectedRow==null?(i(),n("button",{key:0,type:"button",class:"btn btn-primary mb-2",onClick:s[0]||(s[0]=(...l)=>e.addRow&&e.addRow(...l))},"Добавить строку ")):a("",!0),e.selectedRow!=null?(i(),n("button",{key:1,type:"button",class:"btn btn-primary mb-2",onClick:s[1]||(s[1]=(...l)=>e.addRowAbove&&e.addRowAbove(...l))},"Добавить строку выше ")):a("",!0),e.selectedRow!=null?(i(),n("button",{key:2,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:s[2]||(s[2]=(...l)=>e.addRowBelow&&e.addRowBelow(...l))},"Добавить строку ниже ")):a("",!0),e.selectedRow!=null?(i(),n("button",{key:3,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:s[3]||(s[3]=l=>e.moveRow(0))},jt)):a("",!0),e.selectedRow!=null?(i(),n("button",{key:4,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:s[4]||(s[4]=l=>e.moveRow(1))},Vt)):a("",!0),e.selectedRow!=null?(i(),n("button",{key:5,type:"button",class:"btn btn-outline-danger mb-2 ml-2",onClick:s[5]||(s[5]=(...l)=>e.reset&&e.reset(...l))},Bt)):a("",!0)]),t("div",Tt,[t("div",It,[r(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[6]||(s[6]=l=>e.showCode=l),id:"showCode"+e.uuid},null,8,Mt),[[m,e.showCode]]),t("label",{class:"form-check-label",for:"showCode"+e.uuid}," Отобразить код ",8,Ot)])])]),(e.keyboard||[]).length>0?(i(),n("div",Ut,[(i(!0),n(b,null,g(e.keyboard,(l,d)=>(i(),n("div",qt,[t("div",Qt,[(i(!0),n(b,null,g(l,(u,k)=>(i(),n("div",{class:"btn-group dropdown-center w-100 m-1",onClick:y=>e.selectIndex(d,k)},[r(t("input",{type:"text",class:p([{"btn-outline-primary":e.select.row!=d||e.select.col!=k,"btn-primary":e.select.row==d&&e.select.col==k},"btn w-100"]),"onUpdate:modelValue":y=>e.keyboard[d][k].text=y},null,10,Dt),[[h,e.keyboard[d][k].text]]),t("div",Jt,[Lt,t("ul",zt,[t("li",{onClick:y=>e.addColToRow(d)},Gt,8,Nt),t("li",{onClick:s[7]||(s[7]=(...y)=>e.removeSelectedButton&&e.removeSelectedButton(...y))},Xt),t("li",{onClick:y=>e.moveCol(d,0)},Zt,8,Yt),t("li",{onClick:y=>e.moveCol(d,1)},ts,8,xt),t("li",{onClick:y=>e.moveColVertical(d,0)},ls,8,ss),t("li",{onClick:y=>e.moveColVertical(d,1)},as,8,is)])]),t("button",{type:"button",onClick:s[8]||(s[8]=y=>e.mode=1),class:"btn btn-outline-primary","aria-expanded":"false"},rs)],8,At))),256))])]))),256))])):a("",!0)]),o.type==="reply"?(i(),n("div",cs,[t("div",hs,[r(t("input",{class:"form-check-input","onUpdate:modelValue":s[9]||(s[9]=l=>e.settings.is_persistent=l),type:"checkbox",id:"need-is_persistent"},null,512),[[m,e.settings.is_persistent]]),us]),t("div",ms,[r(t("input",{class:"form-check-input","onUpdate:modelValue":s[10]||(s[10]=l=>e.settings.one_time_keyboard=l),type:"checkbox",id:"need-one_time_keyboard"},null,512),[[m,e.settings.one_time_keyboard]]),bs]),t("div",ps,[r(t("input",{class:"form-check-input","onUpdate:modelValue":s[11]||(s[11]=l=>e.settings.resize_keyboard=l),type:"checkbox",id:"need-resize_keyboard"},null,512),[[m,e.settings.resize_keyboard]]),_s]),t("div",ys,[r(t("input",{class:"form-check-input","onUpdate:modelValue":s[12]||(s[12]=l=>e.need_input_field_placeholder=l),type:"checkbox",id:"need_input_field_placeholder"},null,512),[[m,e.need_input_field_placeholder]]),fs]),e.need_input_field_placeholder?(i(),n("div",ks,[r(t("input",{type:"text","onUpdate:modelValue":s[13]||(s[13]=l=>e.settings.input_field_placeholder=l),class:"form-control",id:"input_field_placeholder",placeholder:"Клавиатура"},null,512),[[h,e.settings.input_field_placeholder]]),gs])):a("",!0)])):a("",!0),e.showCode?(i(),n("div",$s,[t("div",vs,[ws,e.load?a("",!0):(i(),_(j(w),{key:0,mode:"code",modelValue:e.keyboard,"onUpdate:modelValue":s[14]||(s[14]=l=>e.keyboard=l),"show-btns":!1,expandedOnStart:!0,onJsonChange:e.onJsonChange},null,8,["modelValue","onJsonChange"]))])])):a("",!0)])):a("",!0),e.mode===1?(i(),n("div",Cs,[t("div",Fs,[t("div",Ps,[t("button",{type:"button",onClick:s[15]||(s[15]=l=>e.mode=0),class:"btn btn-outline-primary"},"Назад ")]),t("form",Rs,[js,t("div",Ss,[t("label",{for:"command-title-"+e.select.row+"-col-"+e.select.сol,class:"form-label"},"Название кнопки",8,Vs),t("div",Ks,[r(t("input",{type:"text",id:"command-title-"+e.select.row+"-col-"+e.select.col,class:"form-control","onUpdate:modelValue":s[16]||(s[16]=l=>e.keyboard[e.select.row][e.select.col].text=l)},null,8,Bs),[[h,e.keyboard[e.select.row][e.select.col].text]]),t("button",{type:"button",onClick:s[17]||(s[17]=(...l)=>e.openPageModal&&e.openPageModal(...l)),class:"btn btn-outline-primary","aria-expanded":"false"},Is)])]),Ms,o.type==="inline"?(i(),n("div",Os,[t("label",{for:"command-row-"+e.select.row+"-col-"+e.select.col,class:"form-label"},"Команда (для меню в сообщении)",8,Us),r(t("input",{type:"text",onChange:s[18]||(s[18]=l=>e.needRemoveField("callback_data",e.select.row,e.select.col)),"onUpdate:modelValue":s[19]||(s[19]=l=>e.keyboard[e.select.row][e.select.col].callback_data=l),class:"form-control",id:"command-row-"+e.select.row+"-col-"+e.select.col,placeholder:"/start"},null,40,qs),[[h,e.keyboard[e.select.row][e.select.col].callback_data]])])):a("",!0),o.type==="inline"?(i(),n("div",Qs,[t("label",{for:"switch-inline-query-row-"+e.select.row+"-col-"+e.select.col,class:"form-label"},"Ссылка на аккаунт в ТЕЛЕГРАММ",8,As),r(t("input",{type:"text",class:"form-control",onChange:s[20]||(s[20]=l=>e.needRemoveField("switch_inline_query",e.select.row,e.select.col)),"onUpdate:modelValue":s[21]||(s[21]=l=>e.keyboard[e.select.row][e.select.col].switch_inline_query=l),id:"switch-inline-query-row-"+e.select.row+"-col-"+e.select.col,placeholder:"@YourAccountLink"},null,40,Ds),[[h,e.keyboard[e.select.row][e.select.col].switch_inline_query]])])):a("",!0),o.type==="inline"?(i(),n("div",Js,[t("label",{for:"url-row-"+e.select.row+"-col-"+e.select.col,class:"form-label"},"Внешняя URL-ссылка",8,Ls),r(t("input",{type:"text",class:"form-control",onChange:s[22]||(s[22]=l=>e.needRemoveField("url",e.select.row,e.select.col)),"onUpdate:modelValue":s[23]||(s[23]=l=>e.keyboard[e.select.row][e.select.col].url=l),id:"url-row-"+e.select.row+"-col-"+e.colIndex,placeholder:"https://t.me/example"},null,40,zs),[[h,e.keyboard[e.select.row][e.select.col].url]])])):a("",!0),o.type==="inline"?(i(),n("div",Ns,[t("label",{for:"switch-inline-query-current-chat-row-"+e.select.row+"-col-"+e.select.col,class:"form-label"},"Команда всплывающего меню бота",8,Es),Gs,t("div",Hs,[r(t("input",{type:"text",class:"form-control",onChange:s[24]||(s[24]=l=>e.needRemoveField("switch_inline_query_current_chat",e.select.row,e.select.col)),"onUpdate:modelValue":s[25]||(s[25]=l=>e.keyboard[e.select.row][e.select.col].switch_inline_query_current_chat=l),id:"switch-inline-query-current-chat-row-"+e.select.row+"-col-"+e.select.col,placeholder:"команда"},null,40,Xs),[[h,e.keyboard[e.select.row][e.select.col].switch_inline_query_current_chat]]),t("button",{type:"button",onClick:s[26]||(s[26]=(...l)=>e.openInlineQueryModal&&e.openInlineQueryModal(...l)),class:"btn btn-outline-primary","aria-expanded":"false"},Ws)])])):a("",!0),o.type==="inline"?(i(),n("div",Zs,[t("div",xs,[r(t("input",{class:"form-check-input","onUpdate:modelValue":s[27]||(s[27]=l=>e.need_login_url=l),type:"checkbox",id:"need-login-url"},null,512),[[m,e.need_login_url]]),eo]),e.need_login_url?(i(),n("div",to,[t("label",{for:"login-link-row-"+e.select.row+"-col-"+e.select.col,class:"form-label"},"Ссылка авторизации ",8,so),r(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[28]||(s[28]=l=>e.keyboard[e.select.row][e.select.col].login_url.url=l),id:"login-link-row-"+e.select.row+"-col-"+e.select.col,placeholder:"Ссылка авторизации",required:""},null,8,oo),[[h,e.keyboard[e.select.row][e.select.col].login_url.url]])])):a("",!0),e.need_login_url?(i(),n("div",lo,[t("label",{for:"login-link-forward-text-row-"+e.select.row+"-col-"+e.select.col,class:"form-label"},"Новый текст кнопки в пересылаемых сообщениях ",8,io),r(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[29]||(s[29]=l=>e.keyboard[e.select.row][e.select.col].login_url.forward_text=l),id:"login-link-forward-text-row-"+e.select.row+"-col-"+e.select.col,placeholder:"Текст кнопки"},null,8,no),[[h,e.keyboard[e.select.row][e.select.col].login_url.forward_text]])])):a("",!0),e.need_login_url?(i(),n("div",ao,[t("label",{for:"login-link-bot-username-row-"+e.select.row+"-col-"+e.select.col,class:"form-label"},"Имя бота, которое будет использоваться для авторизации ",8,ro),r(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[30]||(s[30]=l=>e.keyboard[e.select.row][e.select.col].login_url.bot_username=l),id:"login-link-bot-username-row-"+e.select.row+"-col-"+e.select.col,placeholder:"Имя бота"},null,8,co),[[h,e.keyboard[e.select.row][e.select.col].login_url.bot_username]])])):a("",!0),e.need_login_url?(i(),n("div",ho,[r(t("input",{class:"form-check-input","onUpdate:modelValue":s[31]||(s[31]=l=>e.keyboard[e.select.row][e.select.col].login_url.request_write_access=l),type:"checkbox",id:"need-request_write_access"},null,512),[[m,e.keyboard[e.select.row][e.select.col].login_url.request_write_access]]),uo])):a("",!0)])):a("",!0),o.type==="reply"?(i(),n("div",mo,[t("input",{type:"radio",onChange:s[32]||(s[32]=l=>e.needRemoveField(null,e.select.row,e.select.col)),name:"request-radio",class:"form-check-input",id:"no-action-row-"+e.select.row+"-col-"+e.select.col},null,40,bo),t("label",{class:"form-check-label",for:"no-action-row-"+e.select.row+"-col-"+e.select.col}," Без действий ",8,po)])):a("",!0),o.type==="reply"?(i(),n("div",_o,[t("input",{type:"radio",onChange:s[33]||(s[33]=l=>e.needRemoveField("request_contact",e.select.row,e.select.col)),onClick:s[34]||(s[34]=l=>e.keyboard[e.select.row][e.select.col].request_contact=!0),name:"request-radio",checked:e.keyboard[e.select.row][e.select.col].request_contact,class:"form-check-input",id:"phone-row-"+e.select.row+"-col-"+e.select.col},null,40,yo),t("label",{class:"form-check-label",for:"phone-row-"+e.select.row+"-col-"+e.select.col}," Запросить телефон ",8,fo)])):a("",!0),o.type==="reply"?(i(),n("div",ko,[t("input",{type:"radio",name:"request-radio",checked:e.keyboard[e.select.row][e.select.col].request_location,onChange:s[35]||(s[35]=l=>e.needRemoveField("request_location",e.select.row,e.select.col)),onClick:s[36]||(s[36]=l=>e.keyboard[e.select.row][e.select.col].request_location=!0),class:"form-check-input",id:"location-row-"+e.select.row+"-col-"+e.select.col},null,40,go),t("label",{class:"form-check-label",for:"location-row-"+e.select.row+"-col-"+e.select.col}," Запросить локацию ",8,$o)])):a("",!0)])])])):a("",!0),t("div",{class:"modal fade",id:"page-list-in-keyboard-"+e.uuid,tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[t("div",wo,[t("div",Co,[t("div",Fo,[$(et,{onCallback:e.attachPage,editor:!1},null,8,["onCallback"])])])])],8,vo),t("div",{class:"modal fade",id:"inline-query-list-in-keyboard-"+e.uuid,tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[t("div",Ro,[t("div",jo,[t("div",So,[$(wt,{onSelect:e.selectInlineQuery},null,8,["onSelect"])])])])],8,Po)],64))}});const Ko={key:0,class:"card"},Bo={key:0,class:"card-header"},To={key:0,class:"d-flex justify-content-start align-items-center"},Io=["disabled"],Mo=t("i",{class:"fa-solid fa-arrow-left"},null,-1),Oo=[Mo],Uo=["disabled"],qo=t("i",{class:"fa-regular fa-pen-to-square"},null,-1),Qo=[qo],Ao=["disabled"],Do=t("i",{class:"fa-regular fa-floppy-disk"},null,-1),Jo=[Do],Lo={key:1,class:"d-flex justify-content-between align-items-center"},zo={class:"mr-2"},No=["disabled"],Eo=t("i",{class:"fa-regular fa-pen-to-square"},null,-1),Go=[Eo],Ho=["disabled"],Xo=t("i",{class:"fa-regular fa-clone"},null,-1),Yo=[Xo],Wo=["disabled"],Zo=t("i",{class:"fa-regular fa-floppy-disk"},null,-1),xo=[Zo],el=["disabled"],tl=t("i",{class:"fa-solid fa-trash-can"},null,-1),sl=[tl],ol={class:"card-body"},ll={key:0,class:"row"},il={class:"col-md-6 col-12"},nl={class:"mb-3"},al=t("label",{class:"form-label",id:"bot-domain"},"Тип",-1),dl=t("option",{value:"reply"},"Нижняя клавиатура",-1),rl=t("option",{value:"inline"},"Встроенная клавиатура",-1),cl=[dl,rl],hl={class:"col-md-6 col-12"},ul={class:"mb-3"},ml=t("label",{class:"form-label",id:"bot-domain"},"Мнемоническое имя",-1),bl={class:"row"},pl={class:"col-12"},_l={class:"row"},yl={class:"col-12"},fl={class:"row"},kl={class:"col"},gl={type:"button",class:"btn btn-outline-primary w-100 mb-2"},$l={key:1,class:"card"},vl={class:"card-header d-flex justify-content-between align-items-center"},wl=["disabled"],Cl=t("i",{class:"fa-regular fa-floppy-disk"},null,-1),Fl=[Cl],Pl={class:"card-body"},Rl={props:["keyboard","selectMode","simple"],data:()=>({is_edited:!1,load:!1,keyboardForm:null}),components:{Vue3JsonEditor:w},computed:{uuid(){return R()}},watch:{keyboardForm:{handler(o){this.is_edited=!0},deep:!0}},mounted(){const o=this.keyboard;this.keyboardForm=o,this.$nextTick(()=>{this.is_edited=!1,Array.isArray(o.menu)||this.updateKeyboard()})},methods:{onJsonChange(o){this.keyboardForm=o},removeKeyboard(){this.$store.dispatch("removeKeyboardTemplate",{templateId:this.keyboardForm.id}).then(o=>{this.load=!0,this.$nextTick(()=>{this.load=!1}),this.$emit("callback",this.keyboardForm.id)}).catch(()=>{this.$emit("callback",this.keyboardForm.id)})},saveKeyboard(o){this.keyboardForm.menu=o},selectCard(){this.$emit("select",this.keyboardForm)},duplicateKeyboard(){let o=new FormData;Object.keys(this.keyboardForm).forEach(e=>{const s=this.keyboardForm[e]||"";typeof s=="object"?o.append(e,JSON.stringify(s)):o.append(e,s)}),this.$store.dispatch("createKeyboardTemplate",{keyboardForm:o}).then(e=>{this.$notify({title:"Конструктор ботов",text:"Меню успешно продублировано!",type:"success"}),this.load=!0,this.$nextTick(()=>{this.load=!1}),this.$emit("reload")})},updateKeyboard(){let o=new FormData;Object.keys(this.keyboardForm).forEach(e=>{const s=this.keyboardForm[e]||"";typeof s=="object"?o.append(e,JSON.stringify(s)):o.append(e,s)}),this.$store.dispatch("editKeyboardTemplate",{keyboardForm:o}).then(e=>{this.load=!0,this.$nextTick(()=>{this.load=!1,this.is_edited=!1}),this.$emit("callback")}).catch(()=>{this.is_edited=!1,this.$emit("callback")})}}},jl=Object.assign(Rl,{__name:"KeyboardCard",setup(o){return(e,s)=>(i(),n(b,null,[e.is_edited?a("",!0):(i(),n("div",Ko,[o.simple?a("",!0):(i(),n("div",Bo,[o.selectMode?(i(),n("div",To,[t("button",{onClick:s[0]||(s[0]=(...l)=>e.selectCard&&e.selectCard(...l)),disabled:e.load,type:"button",class:"btn btn-outline-success mr-2"},Oo,8,Io),t("button",{onClick:s[1]||(s[1]=l=>e.is_edited=!0),disabled:e.load,type:"button",title:"Редактировать клавиатуру",class:"btn btn-outline-success mr-2"},Qo,8,Uo),t("button",{onClick:s[2]||(s[2]=(...l)=>e.updateKeyboard&&e.updateKeyboard(...l)),type:"button",title:"Обновить клавиатуру",disabled:e.load||!e.is_edited,class:p(["btn btn-outline-primary mr-2",{"have-change":e.is_edited}])},Jo,10,Ao)])):a("",!0),o.selectMode?a("",!0):(i(),n("div",Lo,[t("div",null,[t("strong",zo,"#"+f(o.keyboard.id),1),t("button",{onClick:s[3]||(s[3]=l=>e.is_edited=!0),disabled:e.load,type:"button",title:"Редактировать клавиатуру",class:"btn btn-outline-success mr-2"},Go,8,No),t("button",{onClick:s[4]||(s[4]=(...l)=>e.duplicateKeyboard&&e.duplicateKeyboard(...l)),type:"button",title:"Дублировать клавиатуру",disabled:e.load,class:"btn btn-outline-primary mr-2"},Yo,8,Ho),t("button",{onClick:s[5]||(s[5]=(...l)=>e.updateKeyboard&&e.updateKeyboard(...l)),type:"button",title:"Обновить клавиатуру",disabled:e.load||!e.is_edited,class:p(["btn btn-outline-primary mr-2",{"have-change":e.is_edited}])},xo,10,Wo)]),t("button",{onClick:s[6]||(s[6]=(...l)=>e.removeKeyboard&&e.removeKeyboard(...l)),type:"button",disabled:e.load,title:"Удалить клавиатуру",class:"btn btn-outline-danger mr-2"},sl,8,el)]))])),t("div",ol,[o.selectMode?a("",!0):(i(),n("div",ll,[t("div",il,[t("div",nl,[al,r(t("select",{disabled:!0,"onUpdate:modelValue":s[7]||(s[7]=l=>o.keyboard.type=l),class:"form-control"},cl,512),[[S,o.keyboard.type]])])]),t("div",hl,[t("div",ul,[ml,r(t("input",{type:"text",class:"form-control",placeholder:"Мнемоническое имя",disabled:!0,"aria-label":"Мнемоническое имя","onUpdate:modelValue":s[8]||(s[8]=l=>o.keyboard.slug=l),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[h,o.keyboard.slug]])])])])),t("div",bl,[t("div",pl,[t("div",_l,[t("div",yl,[(i(!0),n(b,null,g(o.keyboard.menu,(l,d)=>(i(),n("div",fl,[(i(!0),n(b,null,g(l,(u,k)=>(i(),n("div",kl,[t("button",gl,f(u.text),1)]))),256))]))),256))])])])])])])),e.is_edited?(i(),n("div",$l,[t("div",vl,[t("button",{onClick:s[9]||(s[9]=(...l)=>e.updateKeyboard&&e.updateKeyboard(...l)),type:"button",title:"Обновить клавиатуру",disabled:e.load||!e.is_edited,class:p(["btn btn-outline-primary mr-2",{"have-change":e.is_edited}])},Fl,10,wl)]),t("div",Pl,[e.keyboardForm?(i(),_(C,{key:0,onSave:e.saveKeyboard,"edited-keyboard":e.keyboardForm},null,8,["onSave","edited-keyboard"])):a("",!0),$(j(w),{mode:"code",modelValue:e.keyboardForm,"onUpdate:modelValue":s[10]||(s[10]=l=>e.keyboardForm=l),"show-btns":!1,expandedOnStart:!0,onJsonChange:e.onJsonChange},null,8,["modelValue","onJsonChange"])])])):a("",!0)],64))}}),Sl={key:0,class:"row mb-2 py-3"},Vl={class:"col-12"},Kl={class:"card"},Bl=t("div",{class:"card-header"},[t("h6",null,"Форма создания шаблона клавиатуры")],-1),Tl={class:"card-body"},Il={class:"col-md-6 col-12"},Ml={class:"mb-3"},Ol=t("label",{class:"form-label",id:"bot-domain"},"Тип",-1),Ul=t("option",{value:"reply"},"Нижняя клавиатура",-1),ql=t("option",{value:"inline"},"Встроенная клавиатура",-1),Ql=[Ul,ql],Al={class:"col-md-6 col-12"},Dl={class:"mb-3"},Jl={class:"form-label d-flex justify-content-between",id:"bot-domain"},Ll=t("span",null,"Мнемоническое имя",-1),zl=t("i",{class:"fa-solid fa-arrows-rotate"},null,-1),Nl=[zl],El={class:"col-12"},Gl=t("div",{class:"col-12"},[t("button",{class:"btn btn-outline-success w-100 p-3"}," Добавить новый шаблон клавиатуры ")],-1),Hl={class:"row"},Xl={key:0,class:"col-12"},Yl={class:"badge bg-warning"},Wl={class:"col-12 mb-3"},Zl={key:1,class:"card"},xl={class:"card-body"},ei={key:2,class:"col-12 mb-3"},ti=t("div",{class:"alert alert-warning",role:"alert"},[t("p",null,"Список шаблонов клавиатур пуст!")],-1),si=[ti],oi={props:["selectMode","type"],data(){return{keyboards:[],load:!1,bot:null,editedKeyboard:null,selectMenuIndex:null,keyboardForm:{type:"reply",bot_id:null,slug:null,menu:[]}}},computed:{...v(["getCurrentBot"]),filteredKeyboard(){return this.type?this.keyboards.filter(o=>o.type==this.type):this.keyboards}},mounted(){this.loadCurrentBot().then(()=>{this.loadMenusByBotTemplate(),this.generateSlug()})},methods:{selectCard(o){this.$emit("select",o)},keyboardCallbackAction(o){let e=this.keyboards.find(s=>s.id===o);e&&(e.deleted_at=new Date),this.loadMenusByBotTemplate()},loadMenusByBotTemplate(){this.$store.dispatch("loadBotKeyboards",{botId:this.bot.id}).then(o=>{this.keyboards=o.data})},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},submitKeyboard(){this.keyboardForm.bot_id=this.bot.id;let o=new FormData;Object.keys(this.keyboardForm).forEach(e=>{const s=this.keyboardForm[e]||"";typeof s=="object"?o.append(e,JSON.stringify(s)):o.append(e,s)}),this.$store.dispatch("createKeyboardTemplate",{keyboardForm:o}).then(e=>{this.keyboardForm={type:"reply",bot_id:null,slug:null,menu:[]},this.load=!0,this.$nextTick(()=>{this.load=!1}),this.loadMenusByBotTemplate()})},generateSlug(){this.keyboardForm.slug=R()},changeKeyboardFormMenu(o){this.keyboardForm.menu=o}}},V=Object.assign(oi,{__name:"KeyboardList",setup(o){return(e,s)=>(i(),n(b,null,[o.selectMode?a("",!0):(i(),n("div",Sl,[t("div",Vl,[t("div",Kl,[Bl,t("div",Tl,[t("form",{onSubmit:s[3]||(s[3]=P((...l)=>e.submitKeyboard&&e.submitKeyboard(...l),["prevent"])),class:"row"},[t("div",Il,[t("div",Ml,[Ol,r(t("select",{"onUpdate:modelValue":s[0]||(s[0]=l=>e.keyboardForm.type=l),class:"form-control"},Ql,512),[[S,e.keyboardForm.type]])])]),t("div",Al,[t("div",Dl,[t("label",Jl,[Ll,t("a",{onClick:s[1]||(s[1]=(...l)=>e.generateSlug&&e.generateSlug(...l)),href:"#generate"},Nl)]),r(t("input",{type:"text",class:"form-control",placeholder:"Мнемоническое имя","aria-label":"Мнемоническое имя","onUpdate:modelValue":s[2]||(s[2]=l=>e.keyboardForm.slug=l),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[h,e.keyboardForm.slug]])])]),t("div",El,[e.load?a("",!0):(i(),_(C,{key:0,onSave:e.changeKeyboardFormMenu,"edited-keyboard":e.keyboardForm},null,8,["onSave","edited-keyboard"]))]),Gl],32)])])])])),t("div",Hl,[e.keyboards&&e.bot?(i(),n("div",Xl,[t("p",null,[c("В списке клавиатур "),t("span",Yl,f(e.filteredKeyboard.length)+" ед.",1)])])):a("",!0),e.keyboards&&e.bot?(i(!0),n(b,{key:1},g(e.filteredKeyboard,(l,d)=>(i(),n("div",Wl,[l.deleted_at?(i(),n("div",Zl,[t("div",xl,[t("p",null,"Удаленная клавиатура #"+f(l.id),1)])])):(i(),_(jl,{key:0,"select-mode":o.selectMode,onSelect:e.selectCard,onReload:e.loadMenusByBotTemplate,onCallback:e.keyboardCallbackAction,keyboard:l},null,8,["select-mode","onSelect","onReload","onCallback","keyboard"]))]))),256)):a("",!0),e.filteredKeyboard.length===0?(i(),n("div",ei,si)):a("",!0)])],64))}}),li={class:"col-md-12 col-12"},ii={class:"mb-3"},ni=t("i",{class:"fa-solid fa-xmark"},null,-1),ai=[ni],di={class:"mb-3"},ri={class:"d-flex justify-content-between flex-wrap al"},ci=t("label",{class:"form-label",id:"bot-main-channel"},"Канал для постов (id,рекламный)",-1),hi={class:"d-flex flex-wrap align-items-center"},ui=t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),mi={class:"col-12 mb-2"},bi=t("label",{class:"form-label d-flex justify-content-between align-items-center mb-2",id:"bot-domain"},[c(" Текстовое содержимое страницы "),t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),pi={class:"form-floating"},_i={for:"floatingTextarea2"},yi={key:0},fi={class:"col-12 mb-2"},ki={class:"form-check"},gi=t("label",{class:"form-check-label",for:"need-page-images"}," Изображения на странице (максимум 10) ",-1),$i={key:0,class:"col-12 mb-2"},vi={class:"card mb-3"},wi=t("div",{class:"card-header"},[t("h6",null,"Изображения на странице")],-1),Ci={class:"card-body d-flex justify-content-start"},Fi={for:"photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},Pi={class:"row"},Ri={key:0,class:"col-12 d-flex flex-wrap"},ji={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Si={class:"remove"},Vi=["onClick"],Ki={class:"col-12 mb-2"},Bi={class:"form-check"},Ti=t("label",{class:"form-check-label",for:"need-inline-menu"}," Меню под текстом страницы ",-1),Ii={key:1,class:"col-12 mb-2"},Mi={class:"card"},Oi={class:"card-header d-flex justify-between align-items-center"},Ui=t("h6",null,"Конструктор меню в сообщении",-1),qi={key:0},Qi={key:1},Ai={class:"card-body"},Di=t("div",{class:"col-12"},[t("button",{type:"submit",class:"btn btn-success w-100 p-3"}," Отправить сообщение в канал ")],-1),Ji={data(){return{load:!1,photos:[],showInlineTemplateSelector:!1,need_page_images:!1,need_inline_menu:!1,bot:null,mailForm:{text:"",inline_keyboard:null,channel:null}}},computed:{...v(["getCurrentBot"])},mounted(){this.loadCurrentBot()},methods:{addTextTo(o={param:null,text:null}){this.mailForm.channel=o.text},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},submitMail(){let o=new FormData;if(Object.keys(this.mailForm).forEach(e=>{const s=this.mailForm[e]||"";typeof s=="object"?o.append(e,JSON.stringify(s)):o.append(e,s)}),this.bot&&o.append("bot_id",this.bot.id),this.photos.length>0)for(let e=0;e<this.photos.length;e++)o.append("photos[]",this.photos[e]);this.$store.dispatch("sendToChannel",{mailForm:o}).then(e=>{this.load=!0,this.photos=[],this.need_inline_menu=!1,this.need_page_images=!1,this.mailForm={text:"",channel:null,inline_keyboard:null},this.$notify({title:"Конструктор ботов",text:"Сообщение успещно отправлено!",type:"success"})}).catch(e=>{})},saveInlineKeyboard(o){this.mailForm.inline_keyboard=o},selectInlineKeyboard(o){this.mailForm.inline_keyboard=o,this.showInlineTemplateSelector=!1},getPhoto(o){return{imageUrl:URL.createObjectURL(o)}},removePhoto(o){this.photos.splice(o,1)},removeImage(o){this.mailForm.images.splice(o,1)},onChangePhotos(o){const e=o.target.files;for(let s=0;s<e.length;s++)this.photos.push(e[s])}}},Li=Object.assign(Ji,{__name:"ChannelMailForm",setup(o){return(e,s)=>{const l=K("lazy");return e.bot?(i(),n("form",{key:0,onSubmit:s[9]||(s[9]=P((...d)=>e.submitMail&&e.submitMail(...d),["prevent"]))},[t("div",li,[t("div",ii,[e.mailForm.channel!=null?(i(),n("button",{key:0,type:"button",class:"btn btn-outline-info mr-2",onClick:s[0]||(s[0]=d=>e.mailForm.channel=null)},ai)):a("",!0),t("button",{type:"button",class:p(["btn mr-2",{"btn-info":e.mailForm.channel===e.bot.main_channel,"btn-outline-info":e.mailForm.channel!==e.bot.main_channel}]),onClick:s[1]||(s[1]=d=>e.mailForm.channel=e.bot.main_channel)},"Главный канал ",2),t("button",{type:"button",class:p(["btn",{"btn-info":e.mailForm.channel===e.bot.order_channel,"btn-outline-info":e.mailForm.channel!==e.bot.order_channel}]),onClick:s[2]||(s[2]=d=>e.mailForm.channel=e.bot.order_channel)},"Канал заказов ",2)]),t("div",di,[t("div",ri,[ci,t("div",hi,[$(B,{token:e.bot.bot_token,param:"channel",onCallback:e.addTextTo},null,8,["token","onCallback"]),ui])]),r(t("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":s[3]||(s[3]=d=>e.mailForm.channel=d),maxlength:"255","aria-describedby":"bot-main-channel",required:""},null,512),[[h,e.mailForm.channel]])])]),t("div",mi,[bi,t("div",pi,[r(t("textarea",{class:"form-control","onUpdate:modelValue":s[4]||(s[4]=d=>e.mailForm.text=d),maxlength:"4096",placeholder:"Введите текст",id:"floatingTextarea2",style:{"min-height":"100px"},required:""},null,512),[[h,e.mailForm.text]]),t("label",_i,[c("Содержимое страницы "),e.mailForm.text?(i(),n("span",yi,f(e.mailForm.text.length)+"/4096 ",1)):a("",!0)])])]),t("div",fi,[t("div",ki,[r(t("input",{class:"form-check-input","onUpdate:modelValue":s[5]||(s[5]=d=>e.need_page_images=d),type:"checkbox",id:"need-page-images"},null,512),[[m,e.need_page_images]]),gi])]),e.need_page_images?(i(),n("div",$i,[t("div",vi,[wi,t("div",Ci,[t("label",Fi,[c(" + "),t("input",{type:"file",id:"photos",multiple:"",accept:"image/*",onChange:s[6]||(s[6]=(...d)=>e.onChangePhotos&&e.onChangePhotos(...d)),style:{display:"none"}},null,32)]),t("div",Pi,[e.photos.length>0?(i(),n("div",Ri,[(i(!0),n(b,null,g(e.photos,(d,u)=>(i(),n("div",ji,[r(t("img",null,null,512),[[l,e.getPhoto(d).imageUrl]]),t("div",Si,[t("a",{onClick:k=>e.removePhoto(u)},"Удалить",8,Vi)])]))),256))])):a("",!0)])])])])):a("",!0),t("div",Ki,[t("div",Bi,[r(t("input",{class:"form-check-input","onUpdate:modelValue":s[7]||(s[7]=d=>e.need_inline_menu=d),type:"checkbox",id:"need-inline-menu"},null,512),[[m,e.need_inline_menu]]),Ti])]),e.need_inline_menu?(i(),n("div",Ii,[t("div",Mi,[t("div",Oi,[Ui,t("button",{class:p(["btn",{"btn-outline-primary":!e.showInlineTemplateSelector,"btn-primary":e.showInlineTemplateSelector}]),type:"button",onClick:s[8]||(s[8]=d=>e.showInlineTemplateSelector=!e.showInlineTemplateSelector)},[e.showInlineTemplateSelector?(i(),n("span",Qi," Скрыть шаблоны меню")):(i(),n("span",qi," Открыть шаблоны меню"))],2)]),t("div",Ai,[e.showInlineTemplateSelector?(i(),_(V,{key:0,class:"mb-2",type:"inline",onSelect:e.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(i(),_(C,{key:1,type:"inline",onSave:e.saveInlineKeyboard,"edited-keyboard":e.mailForm.inline_keyboard},null,8,["onSave","edited-keyboard"]))])])])):a("",!0),Di],32)):a("",!0)}}}),zi={class:"col-12 mb-2"},Ni=t("label",{class:"form-label d-flex justify-content-between align-items-center mb-2",id:"bot-domain"},[c(" Текстовое содержимое рассылки "),t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),Ei={class:"form-floating"},Gi={for:"floatingTextarea2"},Hi={key:0},Xi={class:"col-12 mb-2"},Yi={class:"form-check"},Wi=t("label",{class:"form-check-label",for:"need-page-images"}," Изображения в рассылке (максимум 10) ",-1),Zi={key:0,class:"col-12 mb-2"},xi={class:"card mb-3"},en=t("div",{class:"card-header"},[t("h6",null,"Изображения в рассылке")],-1),tn={class:"card-body"},sn={class:"col-12 mb-2"},on={class:"form-check"},ln=t("label",{class:"form-check-label",for:"need-inline-menu"}," Меню под текстом рассылки ",-1),nn={key:1,class:"col-12 mb-2"},an={class:"card"},dn={class:"card-header d-flex justify-between align-items-center"},rn=t("h6",null,"Конструктор меню в сообщении",-1),cn={key:0},hn={key:1},un={class:"card-body"},mn=t("div",{class:"col-12"},[t("button",{type:"submit",class:"btn btn-success w-100 p-3"}," Поставить сообщение в очередь ")],-1),bn={data(){return{load:!1,showInlineTemplateSelector:!1,need_page_images:!1,need_inline_menu:!1,bot:null,mailForm:{message:"",inline_keyboard:null,images:[]}}},computed:{...v(["getCurrentBot"])},mounted(){this.loadCurrentBot()},methods:{selectImages(o){this.mailForm.images||(this.mailForm.images=[]);let e=this.mailForm.images.indexOf(o.file_id);e!==-1?this.mailForm.images.splice(e,1):this.mailForm.images.push(o.file_id)},addTextTo(o={param:null,text:null}){this.mailForm.channel=o.text},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},submitMail(){let o=new FormData;Object.keys(this.mailForm).forEach(e=>{const s=this.mailForm[e]||"";typeof s=="object"?o.append(e,JSON.stringify(s)):o.append(e,s)}),this.bot&&o.append("bot_id",this.bot.id),this.$store.dispatch("sendToQueue",{mailForm:o}).then(e=>{this.load=!0,this.need_inline_menu=!1,this.need_page_images=!1,this.mailForm={message:"",images:null,inline_keyboard:null},this.$notify({title:"Рассылка",text:"Сообщение успешно поставлено в очередь!",type:"success"})}).catch(e=>{})},saveInlineKeyboard(o){this.mailForm.inline_keyboard=o},selectInlineKeyboard(o){this.mailForm.inline_keyboard=o,this.showInlineTemplateSelector=!1},getPhoto(o){return{imageUrl:URL.createObjectURL(o)}},removePhoto(o){this.photos.splice(o,1)},removeImage(o){this.mailForm.images.splice(o,1)},onChangePhotos(o){const e=o.target.files;for(let s=0;s<e.length;s++)this.photos.push(e[s])}}},pn=Object.assign(bn,{__name:"PersonalMailForm",setup(o){return(e,s)=>e.bot?(i(),n("form",{key:0,onSubmit:s[4]||(s[4]=P((...l)=>e.submitMail&&e.submitMail(...l),["prevent"]))},[t("div",zi,[Ni,t("div",Ei,[r(t("textarea",{class:"form-control","onUpdate:modelValue":s[0]||(s[0]=l=>e.mailForm.message=l),maxlength:"4096",placeholder:"Введите текст",id:"floatingTextarea2",style:{"min-height":"100px"},required:""},null,512),[[h,e.mailForm.message]]),t("label",Gi,[c("Содержимое страницы "),e.mailForm.message?(i(),n("span",Hi,f(e.mailForm.message.length)+"/4096 ",1)):a("",!0)])])]),t("div",Xi,[t("div",Yi,[r(t("input",{class:"form-check-input","onUpdate:modelValue":s[1]||(s[1]=l=>e.need_page_images=l),type:"checkbox",id:"need-page-images"},null,512),[[m,e.need_page_images]]),Wi])]),e.need_page_images?(i(),n("div",Zi,[t("div",xi,[en,t("div",tn,[$(T,{"need-photo":!0,selected:e.mailForm.images,onSelect:e.selectImages},null,8,["selected","onSelect"])])])])):a("",!0),t("div",sn,[t("div",on,[r(t("input",{class:"form-check-input","onUpdate:modelValue":s[2]||(s[2]=l=>e.need_inline_menu=l),type:"checkbox",id:"need-inline-menu"},null,512),[[m,e.need_inline_menu]]),ln])]),e.need_inline_menu?(i(),n("div",nn,[t("div",an,[t("div",dn,[rn,t("button",{class:p(["btn",{"btn-outline-primary":!e.showInlineTemplateSelector,"btn-primary":e.showInlineTemplateSelector}]),type:"button",onClick:s[3]||(s[3]=l=>e.showInlineTemplateSelector=!e.showInlineTemplateSelector)},[e.showInlineTemplateSelector?(i(),n("span",hn," Скрыть шаблоны меню")):(i(),n("span",cn," Открыть шаблоны меню"))],2)]),t("div",un,[e.showInlineTemplateSelector?(i(),_(V,{key:0,class:"mb-2",type:"inline",onSelect:e.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(i(),_(C,{key:1,type:"inline",onSave:e.saveInlineKeyboard,"edited-keyboard":e.mailForm.inline_keyboard},null,8,["onSave","edited-keyboard"]))])])])):a("",!0),mn],32)):a("",!0)}}),_n={class:"py-2"},yn={class:"nav nav-tabs"},fn={class:"nav-item"},kn={class:"nav-item"},gn={key:0,class:"row"},$n={class:"col-12 py-2"},vn={key:1,class:"row"},wn={class:"col-12 py-2"},Cn={data(){return{tab:1,load:!1}},computed:{...v(["getCurrentBot"])},mounted(){},methods:{}},Kn=Object.assign(Cn,{__name:"Mail",setup(o){return(e,s)=>(i(),n("div",_n,[t("ul",yn,[t("li",fn,[t("a",{class:p(["nav-link",{active:e.tab===0}]),onClick:s[0]||(s[0]=l=>e.tab=0),"aria-current":"page",href:"#"},"Рассылка в канал",2)]),t("li",kn,[t("a",{class:p(["nav-link",{active:e.tab===1}]),onClick:s[1]||(s[1]=l=>e.tab=1),href:"#"},"Рассылка в бота",2)])]),e.tab===0?(i(),n("div",gn,[t("div",$n,[$(Li)])])):a("",!0),e.tab===1?(i(),n("div",vn,[t("div",wn,[$(pn)])])):a("",!0)]))}});export{et as _,C as a,jl as b,V as c,Kn as d};
