import{o as s,c as a,e as w,l as v,F as h,r as p,n as x,a as e,t as b,d,w as f,v as g,z as k,g as F,A as C,j as S,b as j}from"./app-ca97cbda.js";import{_ as V}from"./_plugin-vue_export-helper-c27b6911.js";import{v as T}from"./v4-a960c1f4.js";const U={props:["domain"],watch:{messages:function(r){this.$nextTick(function(){var n=this.$el.querySelector("#scroll-area");n.scrollTop=n.scrollHeight+120})}},data(){return{loaded:!0,canEnter:!1,messages:[],buttons:[],dataForm:{message:null,query:null,user:{id:null,first_name:null,last_name:null,username:null}}}},methods:{login(){this.canEnter=!0,this.dataForm.user.id=T(),this.send("/start")},send(r=null,n=0){this.loaded=!1,console.log(r);let y=r||this.dataForm.message;r&&(this.dataForm.message=null,this.dataForm.query=r),n===0&&this.messages.push({text:y,direction:"outgoing",created_at:(()=>{let u=new Date,o=String(u.getDate()).padStart(2,"0"),l=String(u.getMonth()+1).padStart(2,"0"),m=u.getFullYear(),_=u.getMinutes(),t=u.getHours(),c=u.getSeconds();return m+"-"+l+"-"+o+" "+t+":"+_+":"+c})()}),axios.post("/web/"+this.domain,this.dataForm).then(u=>{this.dataForm.message=null,this.dataForm.query=null,u.data.forEach(l=>{let m=null;if(l.reply_markup){let _=JSON.parse(l.reply_markup);_.keyboard&&(this.buttons=_.keyboard,this.is_keyboard=!0),m=_.inline_keyboard||null}this.messages.push({text:l.text||null,direction:"incoming",keyboard:m,photo:l.photo||null,created_at:l.created_at||null}),this.$nextTick(()=>{this.loaded=!0})}).catch(()=>{this.$nextTick(()=>{this.loaded=!0})})})}}},q={class:"chat-window d-flex justify-content-between align-items-center flex-column"},E={class:"message-card-body"},D=["innerHTML"],I={key:0},M={key:1,class:"inline-keyboard w-100"},O={class:"d-flex justify-content-between flex-wrap"},N={class:"d-flex justify-content-between w-100"},B={class:"chat-inline-btn w-100"},H=["onClick"],L=["href"],K={key:1,class:"footer"},z={class:"menu"},A={class:"dropdown dropup w-100"},J=e("button",{class:"chat-menu-btn w-100",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),P={class:"dropdown-menu w-100 chat-custom-dropdown-menu"},W={class:"d-flex justify-content-between flex-wrap"},R={class:"d-flex justify-content-between w-100"},Y={class:"chat-inline-btn w-100"},G=["onClick"],Q={class:"message"},X=["disabled"],Z={key:2,class:"p-1"},$={class:"form-floating mb-3"},tt=e("label",{for:"floatingInput"},"Ваше имя",-1),et={class:"form-floating mb-3"},st=e("label",{for:"floatingInput"},"Ваша фамилия",-1),nt={class:"form-floating mb-3"},ot=e("label",{for:"floatingInput"},"Ваш номер телефона",-1),at=e("button",{class:"btn btn-outline-primary p-3 w-100"},"Войти",-1);function lt(r,n,y,u,o,l){const m=C("perfect-scrollbar"),_=S("mask");return s(),a("div",q,[o.canEnter?(s(),w(m,{key:0,class:"ps-container w-100"},{default:v(()=>[(s(!0),a(h,null,p(o.messages,t=>(s(),a("div",{class:x(["message-card",{incoming:t.direction==="incoming",outgoing:t.direction==="outgoing"}])},[e("div",E,[e("p",{innerHTML:t.text},null,8,D),t.created_at?(s(),a("p",I,b(t.created_at),1)):d("",!0),t.keyboard?(s(),a("div",M,[(s(!0),a(h,null,p(t.keyboard,c=>(s(),a("div",O,[e("div",N,[(s(!0),a(h,null,p(c,i=>(s(),a("div",B,[i.callback_data?(s(),a("button",{key:0,onClick:ut=>l.send(i.callback_data||i.text,1),class:"btn btn-outline-light w-100"},b(i.text||i||"-"),9,H)):d("",!0),i.url?(s(),a("a",{key:1,class:"btn btn-outline-light w-100",href:i.url,target:"_blank"},b(i.text||i||"-"),9,L)):d("",!0)]))),256))])]))),256))])):d("",!0)])],2))),256))]),_:1})):d("",!0),o.canEnter?(s(),a("div",K,[e("div",z,[e("div",A,[J,e("div",P,[o.buttons.length===0?(s(),a("button",{key:0,onClick:n[0]||(n[0]=t=>l.send("/start")),class:"btn btn-outline-light w-100 text-center"},"Начать ")):d("",!0),o.buttons.length>0?(s(),w(m,{key:1,class:"ps-keyboard-container buttons"},{default:v(()=>[(s(!0),a(h,null,p(o.buttons,t=>(s(),a("div",W,[e("div",R,[(s(!0),a(h,null,p(t,c=>(s(),a("div",Y,[e("button",{onClick:i=>l.send(c.text||c),class:"btn btn-outline-light w-100"},b(c.text||c||"-"),9,G)]))),256))])]))),256))]),_:1})):d("",!0)])])]),e("div",Q,[f(e("input",{type:"text",disabled:!o.loaded,class:"form-control w-100",placeholder:"text",onKeydown:n[1]||(n[1]=k(t=>l.send(null),["enter"])),"onUpdate:modelValue":n[2]||(n[2]=t=>o.dataForm.message=t)},null,40,X),[[g,o.dataForm.message]])])])):d("",!0),o.canEnter?d("",!0):(s(),a("div",Z,[e("form",{onSubmit:n[6]||(n[6]=F((...t)=>l.login&&l.login(...t),["prevent"])),class:"pt-2 pb-2"},[e("div",$,[f(e("input",{type:"text","onUpdate:modelValue":n[3]||(n[3]=t=>o.dataForm.user.first_name=t),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[g,o.dataForm.user.first_name]]),tt]),e("div",et,[f(e("input",{type:"text","onUpdate:modelValue":n[4]||(n[4]=t=>o.dataForm.user.last_name=t),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[g,o.dataForm.user.last_name]]),st]),e("div",nt,[f(e("input",{type:"text","onUpdate:modelValue":n[5]||(n[5]=t=>o.dataForm.user.username=t),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[_,"+7(###)###-##-##"],[g,o.dataForm.user.username]]),ot]),at],32)]))])}const rt=V(U,[["render",lt]]),it={key:0},dt={data(){return{load:!1,confirm:!1,vipForm:{name:null,phone:null,email:null,birthday:null,city:null,country:null,address:null,sex:!0}}},computed:{tg(){return window.Telegram.WebApp},tgUser(){const r=new URLSearchParams(this.tg.initData);return JSON.parse(r.get("user"))}},methods:{submit(){this.loading=!0,this.$store.dispatch("saveVip",{dataObject:{bot_id:this.bot.id,tg:this.tgUser,form:this.vipForm}}).then(r=>{this.loading=!1,window.location.reload()}).catch(()=>{this.loading=!1})}}},ht=Object.assign(dt,{__name:"ChatWindow",props:{bot:{type:Object},botUser:{type:Object}},setup(r){return(n,y)=>r.bot?(s(),a("div",it,[j(rt,{domain:r.bot.bot_domain},null,8,["domain"])])):d("",!0)}});export{ht as default};
