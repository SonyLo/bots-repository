import{o as n,q as a,t as e,F as y,B as v,x as g,D as c,G as p,C as r,z as d,J as f,A as b,Y as S,L as V,N as _,O as k,v as $,H as w,X as L}from"./index.es-3f23c3ba.js";import{b as q,c as M,_ as P,B as T,d as D,a as R,e as G,f as z}from"./Shop-abf8d006.js";import{_ as C}from"./_plugin-vue_export-helper-c27b6911.js";import{T as I}from"./SlugForm-2c18ca5f.js";import{P as j}from"./Pagination-7feb7ae2.js";import{m as F}from"./index-2a9de1d3.js";const A={props:["param"],data(){return{expressions:[{expression:"{{userName}}",description:"Имя пользователя"},{expression:"{{telegramChatId}}",description:"Идентификатор чата"},{expression:"{{referralLink}}",description:"Реферальная ссылка"},{expression:"{{referralQr}}",description:"Реферальный QR-код"}]}},methods:{expressionsSelect(o){this.$emit("callback",{param:this.param,text:o.expression})}}},N={class:"dropdown"},K=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-brands fa-hire-a-helper"})],-1),E={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},x=["onClick"];function J(o,t,s,i,u,l){return n(),a("div",N,[K,e("div",E,[e("li",null,[(n(!0),a(y,null,v(u.expressions,h=>(n(),a("a",{class:"dropdown-item",onClick:m=>l.expressionsSelect(h)},g(h.description||"-"),9,x))),256))])])])}const H=C(A,[["render",J]]);const Q={props:["param"],data(){return{search:null,descriptions:[]}},computed:{filteredDescription(){return this.search?this.descriptions.filter(o=>o.text.indexOf(this.search)!==-1):this.descriptions}},mounted(){this.loadDescription()},methods:{select(o){this.$emit("callback",{param:this.param,text:o})},loadDescription(){this.$store.dispatch("loadDescription").then(o=>{this.descriptions=o.data})}}},X={class:"dropdown"},Y=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-spell-check"})],-1),W={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},Z=e("div",{class:"dropdown-divider"},null,-1),ee=["onClick"];function te(o,t,s,i,u,l){return n(),a("div",X,[Y,e("div",W,[c(e("input",{type:"search",class:"form-control",id:"search-description-text","onUpdate:modelValue":t[0]||(t[0]=h=>u.search=h),placeholder:"Введите текст для поиска"},null,512),[[p,u.search]]),Z,(n(!0),a(y,null,v(l.filteredDescription,(h,m)=>(n(),a("p",{class:"p-1 text-left w-100",onClick:U=>l.select(h.text)},g(h.text),9,ee))),256))])])}const B=C(Q,[["render",te]]);const oe={class:"row"},se={class:"input-group mb-3"},le={key:0,class:"row"},ne={class:"col-12 mb-3"},ae={class:"list-group w-100"},ie={class:"list-group-item cursor-pointer page-menu-item btn btn-outline-info mb-1"},de={class:"d-flex justify-content-between"},re=["onClick"],ce={key:0},ue={key:1},me={key:2},_e=e("i",{class:"fa-solid fa-lock"},null,-1),he=[_e],pe={key:0},be={class:"dropdown"},ge=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),fe={class:"dropdown-menu"},ye=["onClick"],ve=e("i",{class:"fa-solid fa-copy mr-1"},null,-1),ke=["onClick"],$e=e("i",{class:"fa-solid fa-trash mr-1"},null,-1),Fe={class:"col-12"},we={key:1,class:"row"},Ce=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," Созданных страниц не найдено! ")],-1),Be=[Ce],Pe={props:["editor","current"],data(){return{bot:null,loading:!0,pages:[],search:null,pages_paginate_object:null,need_new_page:!1}},watch:{search:function(o,t){this.loadPages()}},computed:{...F(["getPages","getCurrentBot","getPagesPaginateObject"])},mounted(){this.loadCurrentBot().then(()=>{this.loadPages()})},methods:{loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},selectPage(o){this.$emit("callback",o),this.$notify("Вы выбрали страницу из списка! Все остальные действия будут производится для этой страницы")},nextPages(o){this.loadPages(o)},duplicatePage(o){this.loading=!0,this.$store.dispatch("duplicatePage",{dataObject:{pageId:o}}).then(t=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},removePage(o){this.loading=!0,this.$store.dispatch("removePage",{dataObject:{pageId:o}}).then(t=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},loadPages(o=0){this.loading=!0,this.$store.dispatch("loadPages",{dataObject:{botId:this.bot.id||null,search:this.search},page:o}).then(t=>{this.loading=!1,this.pages=this.getPages,this.pages_paginate_object=this.getPagesPaginateObject}).catch(()=>{this.loading=!1})}}},O=Object.assign(Pe,{__name:"PagesList",setup(o){return(t,s)=>(n(),a(y,null,[e("div",oe,[e("div",se,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск страницы","aria-label":"Поиск бота","onUpdate:modelValue":s[0]||(s[0]=i=>t.search=i),"aria-describedby":"button-addon2"},null,512),[[p,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:s[1]||(s[1]=(...i)=>t.loadPages&&t.loadPages(...i)),type:"button",id:"button-addon2"},"Найти")])]),t.pages.length>0?(n(),a("div",le,[e("div",ne,[e("ul",ae,[(n(!0),a(y,null,v(t.pages,(i,u)=>(n(),a("li",ie,[e("div",de,[e("strong",{onClick:l=>t.selectPage(i)},[r("#"+g(i.id||"Не указано")+" ",1),i.slug?(n(),a("span",ce,g(i.slug.command||"Не указано"),1)):(n(),a("span",ue,"Не привязано к команде")),o.current&&o.current===i.id?(n(),a("span",me,he)):d("",!0)],8,re),o.editor?(n(),a("div",pe,[e("div",be,[ge,e("ul",fe,[e("li",null,[e("a",{class:"dropdown-item",onClick:l=>t.duplicatePage(i.id)},[ve,r("Дублировать")],8,ye)]),e("li",null,[e("a",{class:"dropdown-item",onClick:l=>t.removePage(i.id)},[$e,r("Удалить")],8,ke)])])])])):d("",!0)])]))),256))])]),e("div",Fe,[t.pages_paginate_object?(n(),f(j,{key:0,onPagination_page:t.nextPages,pagination:t.pages_paginate_object},null,8,["onPagination_page","pagination"])):d("",!0)])])):(n(),a("div",we,Be))],64))}}),Se={class:"row"},Ve={class:"col-12"},je={class:"card-body"},Ue=e("h6",null,"Добавление нового скрипта в бота",-1),Te={key:0,class:"row"},Ie={class:"col-md-6 mb-2"},Oe={key:1,class:"row"},Le=e("div",{class:"col-12"},[e("div",{class:"alert alert-danger",role:"alert"},' У вас еще нет добавленных скриптов! Воспользуйтесь разделом "Скрипты" для добавления. ')],-1),qe=[Le],Me={props:["bot","global"],data(){return{load:!1,search:null,slugs:[]}},computed:{filteredSlugs(){return this.slugs?this.slugs.length===0?[]:this.search==null?this.slugs:this.slugs.filter(o=>{let t=o.slug||"",s=o.command||"",i=o.comment||"";return s.toLowerCase().indexOf(this.search.toLowerCase())!==-1||i.toLowerCase().indexOf(this.search.toLowerCase())!==-1||t.toLowerCase().indexOf(this.search.toLowerCase())!==-1}):[]}},mounted(){this.loadSlugs()},methods:{selectSlug(o){this.$emit("callback",{id:o.id||null,slug:o.slug,comment:o.comment,command:o.command}),this.$notify("Вы выбрали скрипт из списка!")},loadSlugs(){this.$store.dispatch("loadBotSlugs",{botId:this.bot.id,isGlobal:this.global||!1}).then(o=>{this.slugs=o})}}},De=Object.assign(Me,{__name:"BotSlugListSimple",setup(o){return(t,s)=>(n(),a("div",Se,[e("div",Ve,[e("div",je,[Ue,e("div",null,[c(e("input",{type:"text",class:"form-control mt-1 mb-1","onUpdate:modelValue":s[0]||(s[0]=i=>t.search=i),placeholder:"Поиск нужного скрипта по описанию"},null,512),[[p,t.search]])]),t.filteredSlugs.length>0?(n(),a("div",Te,[(n(!0),a(y,null,v(t.filteredSlugs,(i,u)=>(n(),a("div",Ie,[b(q,{item:i,bot:o.bot,onCallback:t.callbackSlugs,onSelect:t.selectSlug},null,8,["item","bot","onCallback","onSelect"])]))),256))])):(n(),a("div",Oe,qe))])])]))}});const Re={key:0,class:"row"},Ge={class:"col-12 mb-3"},ze={class:"card mb-2"},Ae={class:"card-header"},Ne={class:"card-body"},Ke={key:0,class:"row"},Ee={class:"col-md-6 col-lg-4 col-12 col-sm-6 mb-2"},xe={key:1,class:"row"},Je=e("div",{class:"col-12"},[e("p",null,"Диалоговых скриптов не найдено")],-1),He=[Je],Qe={class:"col-12"},Xe={key:1,class:"row"},Ye=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет созданных диалоговых групп ")],-1),We=[Ye],Ze={props:["bot"],data(){return{groupForm:{slug:null,title:null},loading:!0,dialog_groups:[],search:null,dialog_groups_paginate_object:null,link:null,selected_dialog_id:null,group:null}},computed:{...F(["getDialogGroups","getDialogGroupsPaginateObject"])},mounted(){this.loadGroups()},methods:{selectDialog(o){this.$emit("select-dialog",o),this.selected_dialog_id=o.id,this.$notify("Вы выбрали диалог из списка!")},nextGroups(o){this.loadGroups(o)},loadGroups(o=0){this.loading=!0,this.$store.dispatch("loadDialogGroups",{dataObject:{botId:this.bot.id||null,search:this.search},page:o}).then(t=>{this.loading=!1,this.dialog_groups=this.getDialogGroups,this.dialog_groups_paginate_object=this.getDialogGroupsPaginateObject}).catch(()=>{this.loading=!1})}}},et=Object.assign(Ze,{__name:"BotDialogGroupListSimple",setup(o){return(t,s)=>t.dialog_groups.length>0?(n(),a("div",Re,[e("div",Ge,[(n(!0),a(y,null,v(t.dialog_groups,(i,u)=>(n(),a("div",ze,[e("div",Ae,[e("h6",null," #"+g(i.id)+" - "+g(i.title||"Не указано ")+" ("+g(i.slug||"Не указано")+")",1)]),e("div",Ne,[i.bot_dialog_commands.length>0?(n(),a("div",Ke,[(n(!0),a(y,null,v(i.bot_dialog_commands,(l,h)=>(n(),a("div",Ee,[b(M,{onSelect:t.selectDialog,item:l},null,8,["onSelect","item"])]))),256))])):(n(),a("div",xe,He))])]))),256))]),e("div",Qe,[t.dialog_groups_paginate_object?(n(),f(j,{key:0,onPagination_page:t.nextGroups,pagination:t.dialog_groups_paginate_object},null,8,["onPagination_page","pagination"])):d("",!0)])])):(n(),a("div",Xe,We))}}),tt={class:"col-12 mb-2"},ot={class:"d-flex justify-between"},st={class:"col-12 mb-2"},lt={class:"form-label",id:"bot-domain"},nt=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),at=e("div",null,[r(" Команда должна начинаться с символва . и *"),e("br"),r(" Например: .*Меню"),e("br")],-1),it=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),dt={class:"col-12 mb-2"},rt={class:"form-label",id:"bot-domain"},ct=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),ut=e("div",null,"Напишите для себя пояснение для чего нужна данная страница. Это поможет другим менеджерам лучше понять вас. ",-1),mt=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),_t={class:"col-12 mb-2"},ht={class:"form-label d-flex justify-content-between align-items-center mb-0",id:"bot-domain"},pt=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),bt=e("div",null,[r(" Текстовый редактор. Данный текст будет в таком"),e("br"),r(" же виде отображен в посте в телеграм. ")],-1),gt=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),ft={class:"form-floating"},yt={for:"floatingTextarea2"},vt={key:0},kt={class:"col-12 mb-2"},$t={class:"form-check"},Ft=e("label",{class:"form-check-label",for:"need-page-images"}," Изображения на странице (максимум 10) ",-1),wt={key:0,class:"col-12 mb-2"},Ct={class:"card mb-3"},Bt=e("div",{class:"card-header"},[e("h6",null,"Изображения на странице")],-1),Pt={class:"card-body d-flex justify-content-start"},St={for:"photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},Vt={class:"row"},jt={key:0,class:"col-12 d-flex flex-wrap"},Ut={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Tt={class:"remove"},It=["onClick"],Ot={key:1},Lt={key:2,class:"col-12 d-flex flex-wrap"},qt={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Mt={class:"remove"},Dt=["onClick"],Rt={class:"col-12 mb-2"},Gt={class:"form-check"},zt=e("label",{class:"form-check-label",for:"need-reply-menu"}," Нижнее меню страницы ",-1),At={key:1,class:"col-12 mb-2"},Nt={class:"card"},Kt={class:"card-header d-flex justify-between align-items-center"},Et=e("h6",null,"Конструктор нижнего меню",-1),xt={key:0},Jt={key:1},Ht={class:"card-body"},Qt={class:"col-12 mb-2"},Xt={class:"form-check"},Yt=e("label",{class:"form-check-label",for:"need-inline-menu"}," Меню под текстом страницы ",-1),Wt={key:2,class:"col-12 mb-2"},Zt={class:"card"},eo={class:"card-header d-flex justify-between align-items-center"},to=e("h6",null,"Конструктор меню в сообщении",-1),oo={key:0},so={key:1},lo={class:"card-body"},no={class:"col-12 mb-2"},ao={class:"form-check"},io=e("label",{class:"form-check-label",for:"need-page-attach"}," Связать с другой страницей ",-1),ro={key:3,class:"col-12 mb-2"},co={key:0},uo={class:"col-12 mb-2"},mo={class:"form-check"},_o=e("label",{class:"form-check-label",for:"need-slug-attach"}," Привязать скрипт ",-1),ho={key:4,class:"col-12 mb-2"},po={key:0},bo={class:"col-12 mb-2"},go={class:"form-check"},fo=e("label",{class:"form-check-label",for:"need-dialog-attach"}," Привязать начало диалога ",-1),yo={key:5,class:"col-12 mb-2"},vo={key:0},ko=e("div",{class:"col-12 mb-2"},[e("button",{class:"btn btn-outline-primary w-100 p-3"},"Сохранить страницу")],-1),$o={props:["page"],data(){return{need_clean:!1,load:!1,photos:[],showReplyTemplateSelector:!1,showInlineTemplateSelector:!1,need_page_images:!1,need_inline_menu:!1,need_reply_menu:!1,need_attach_page:!1,need_attach_dialog:!1,need_attach_slug:!1,bot:null,pageForm:{id:null,content:"",command:null,slug:null,comment:null,images:[],reply_keyboard:null,inline_keyboard:null,next_page_id:null,next_bot_dialog_command_id:null,next_bot_menu_slug_id:null}}},watch:{need_page_images:function(o,t){this.need_page_images||(this.photos=[],this.pageForm.images=[])},need_inline_menu:function(o,t){this.need_inline_menu||(this.pageForm.inline_keyboard=null,this.pageForm.inline_keyboard_id=null)},need_reply_menu:function(o,t){this.need_reply_menu||(this.pageForm.reply_keyboard=null,this.pageForm.reply_keyboard_id=null)},need_attach_page:function(o,t){this.need_attach_page||(this.pageForm.next_page_id=null)},need_attach_dialog:function(o,t){this.need_attach_dialog||(this.pageForm.next_bot_dialog_command_id=null)},need_attach_slug:function(o,t){this.need_attach_slug||(this.pageForm.next_bot_menu_slug_id=null)},pageForm:{handler:function(o){this.pageForm.reply_keyboard!=null&&(this.need_reply_menu=!0),this.pageForm.inline_keyboard!=null&&(this.need_inline_menu=!0),this.pageForm.images.length>0&&(this.need_page_images=!0),this.pageForm.next_bot_dialog_command_id!=null&&(this.need_attach_dialog=!0),this.pageForm.next_bot_menu_slug_id!=null&&(this.need_attach_slug=!0),this.pageForm.next_page_id!=null&&(this.need_attach_page=!0),this.need_clean=!0},deep:!0}},computed:{...F(["getCurrentBot"])},mounted(){if(this.page){let o=this.page;this.photos=[],this.pageForm={id:o.id,slug_id:o.slug.id||null,content:o.content,command:o.slug.command||null,slug:o.slug.slug||null,comment:o.slug.comment||null,images:o.images||[],reply_keyboard_id:o.reply_keyboard_id||null,inline_keyboard_id:o.inline_keyboard_id||null,reply_keyboard:o.replyKeyboard||null,inline_keyboard:o.inlineKeyboard||null,next_page_id:o.next_page_id||null,next_bot_dialog_command_id:o.next_bot_dialog_command_id||null,next_bot_menu_slug_id:o.next_bot_menu_slug_id||null}}else this.clearForm();this.loadCurrentBot().then(()=>{})},methods:{associateDialog(o){this.pageForm.next_bot_dialog_command_id=o.id},associateSlug(o){this.pageForm.next_bot_menu_slug_id=o.id},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},attachPage(o){o.id!=this.pageForm.id?this.pageForm.next_page_id=o.id:this.$notify({title:"Конструктор страниц",text:"Вы не можете связать данную страницу с собой",type:"error"})},injectContent(o){this.pageForm.content?this.pageForm.content+=o.text:this.pageForm.content=o.text},clearForm(){this.photos=[],this.pageForm={id:null,content:null,command:null,slug:null,comment:null,images:[],reply_keyboard:null,inline_keyboard:null,reply_keyboard_id:null,inline_keyboard_id:null,next_page_id:null,next_bot_dialog_command_id:null,next_bot_menu_slug_id:null},this.photos=[],this.showReplyTemplateSelector=!1,this.showInlineTemplateSelector=!1,this.need_page_images=!1,this.need_inline_menu=!1,this.need_reply_menu=!1,this.need_attach_page=!1,this.need_attach_dialog=!1,this.need_attach_slug=!1,this.$nextTick(()=>{this.need_clean=!1})},submitPage(){let o=new FormData;if(Object.keys(this.pageForm).forEach(t=>{const s=this.pageForm[t]||"";typeof s=="object"?o.append(t,JSON.stringify(s)):o.append(t,s)}),this.bot&&o.append("bot_id",this.bot.id),this.photos.length>0)for(let t=0;t<this.photos.length;t++)o.append("photos[]",this.photos[t]);this.$store.dispatch(this.pageForm.id==null?"createPage":"updatePage",{pageForm:o}).then(t=>{this.load=!0,this.$nextTick(()=>{this.load=!1,this.clearForm()}),this.$emit("callback",t.data),this.$notify({title:"Конструктор ботов",text:this.pageForm.id==null?"Страница успешно создана!":"Страница успешно обновлена!",type:"success"})}).catch(t=>{})},saveInlineKeyboard(o){this.pageForm.inline_keyboard=o},selectReplyKeyboard(o){this.pageForm.reply_keyboard=o,this.showReplyTemplateSelector=!1},selectInlineKeyboard(o){this.pageForm.inline_keyboard=o,console.log(o),this.showInlineTemplateSelector=!1},saveReplyKeyboard(o){this.pageForm.reply_keyboard=o},getPhoto(o){return{imageUrl:URL.createObjectURL(o)}},removePhoto(o){this.photos.splice(o,1)},removeImage(o){this.pageForm.images.splice(o,1)},onChangePhotos(o){const t=o.target.files;for(let s=0;s<t.length;s++)this.photos.push(t[s])},onChange(o){this.pageForm.content=o}}},Fo=Object.assign($o,{__name:"Page",setup(o){return(t,s)=>{const i=S("Popper"),u=V("lazy");return t.bot?(n(),a("form",{key:0,onSubmit:s[16]||(s[16]=w((...l)=>t.submitPage&&t.submitPage(...l),["prevent"]))},[e("div",tt,[e("h6",ot,[e("span",null,"Вы создаете страницу для "+g(t.bot.bot_domain),1),t.pageForm.id||t.need_clean?(n(),a("a",{key:0,href:"#clear-form",onClick:s[0]||(s[0]=(...l)=>t.clearForm&&t.clearForm(...l))},"очистить форму")):d("",!0)])]),e("div",st,[e("label",lt,[b(i,null,{content:_(()=>[at]),default:_(()=>[nt]),_:1}),r(" Команда "),it]),c(e("input",{type:"text",class:"form-control",placeholder:"Команда","aria-label":"Команда","onUpdate:modelValue":s[1]||(s[1]=l=>t.pageForm.command=l),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[p,t.pageForm.command]])]),e("div",dt,[e("label",rt,[b(i,null,{content:_(()=>[ut]),default:_(()=>[ct]),_:1}),r(" Описание страницы "),mt]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Описание страницы","aria-label":"Описание страницы","onUpdate:modelValue":s[2]||(s[2]=l=>t.pageForm.comment=l),maxlength:"255","aria-describedby":"bot-domain",required:""},`
            `,512),[[p,t.pageForm.comment]])]),e("div",_t,[e("label",ht,[e("div",null,[b(i,null,{content:_(()=>[bt]),default:_(()=>[pt]),_:1}),r(" Текстовое содержимое страницы "),gt]),b(H,{param:"content",onCallback:t.injectContent},null,8,["onCallback"])]),e("div",ft,[c(e("textarea",{class:"form-control","onUpdate:modelValue":s[3]||(s[3]=l=>t.pageForm.content=l),maxlength:"4096",placeholder:"Введите текст",id:"floatingTextarea2",style:{"min-height":"100px"}},null,512),[[p,t.pageForm.content]]),e("label",yt,[r("Содержимое страницы "),t.pageForm.content?(n(),a("span",vt,g(t.pageForm.content.length)+"/4096 ",1)):d("",!0)])])]),e("div",kt,[e("div",$t,[c(e("input",{class:"form-check-input","onUpdate:modelValue":s[4]||(s[4]=l=>t.need_page_images=l),type:"checkbox",id:"need-page-images"},null,512),[[k,t.need_page_images]]),Ft])]),t.need_page_images?(n(),a("div",wt,[e("div",Ct,[Bt,e("div",Pt,[e("label",St,[r(" + "),e("input",{type:"file",id:"photos",multiple:"",accept:"image/*",onChange:s[5]||(s[5]=(...l)=>t.onChangePhotos&&t.onChangePhotos(...l)),style:{display:"none"}},null,32)]),e("div",Vt,[t.photos.length>0?(n(),a("div",jt,[(n(!0),a(y,null,v(t.photos,(l,h)=>(n(),a("div",Ut,[c(e("img",null,null,512),[[u,t.getPhoto(l).imageUrl]]),e("div",Tt,[e("a",{onClick:m=>t.removePhoto(h)},"Удалить",8,It)])]))),256))])):d("",!0),t.pageForm.images.length>0?(n(),a("h6",Ot,"Ранее загруженные фотографии")):d("",!0),t.pageForm.images.length>0?(n(),a("div",Lt,[(n(!0),a(y,null,v(t.pageForm.images,(l,h)=>(n(),a("div",qt,[c(e("img",null,null,512),[[u,"/images-by-bot-id/"+t.bot.id+"/"+l]]),e("div",Mt,[e("a",{onClick:m=>t.removeImage(h)},"Удалить",8,Dt)])]))),256))])):d("",!0)])])])])):d("",!0),e("div",Rt,[e("div",Gt,[c(e("input",{class:"form-check-input","onUpdate:modelValue":s[6]||(s[6]=l=>t.need_reply_menu=l),type:"checkbox",id:"need-reply-menu"},null,512),[[k,t.need_reply_menu]]),zt])]),t.need_reply_menu?(n(),a("div",At,[e("div",Nt,[e("div",Kt,[Et,e("button",{class:$(["btn",{"btn-outline-primary":!t.showReplyTemplateSelector,"btn-primary":t.showReplyTemplateSelector}]),type:"button",onClick:s[7]||(s[7]=l=>t.showReplyTemplateSelector=!t.showReplyTemplateSelector)},[t.showReplyTemplateSelector?(n(),a("span",Jt," Скрыть шаблоны меню")):(n(),a("span",xt," Открыть шаблоны меню"))],2)]),e("div",Ht,[t.showReplyTemplateSelector?(n(),f(P,{key:0,class:"mb-2",type:"reply",onSelect:t.selectReplyKeyboard,"select-mode":!0},null,8,["onSelect"])):(n(),f(T,{key:1,type:"reply",onSave:t.saveReplyKeyboard,"edited-keyboard":t.pageForm.reply_keyboard},null,8,["onSave","edited-keyboard"]))])])])):d("",!0),e("div",Qt,[e("div",Xt,[c(e("input",{class:"form-check-input","onUpdate:modelValue":s[8]||(s[8]=l=>t.need_inline_menu=l),type:"checkbox",id:"need-inline-menu"},null,512),[[k,t.need_inline_menu]]),Yt])]),t.need_inline_menu?(n(),a("div",Wt,[e("div",Zt,[e("div",eo,[to,e("button",{class:$(["btn",{"btn-outline-primary":!t.showInlineTemplateSelector,"btn-primary":t.showInlineTemplateSelector}]),type:"button",onClick:s[9]||(s[9]=l=>t.showInlineTemplateSelector=!t.showInlineTemplateSelector)},[t.showInlineTemplateSelector?(n(),a("span",so," Скрыть шаблоны меню")):(n(),a("span",oo," Открыть шаблоны меню"))],2)]),e("div",lo,[t.showInlineTemplateSelector?(n(),f(P,{key:0,class:"mb-2",type:"inline",onSelect:t.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(n(),f(T,{key:1,type:"inline",onSave:t.saveInlineKeyboard,"edited-keyboard":t.pageForm.inline_keyboard},null,8,["onSave","edited-keyboard"]))])])])):d("",!0),e("div",no,[e("div",ao,[c(e("input",{class:"form-check-input","onUpdate:modelValue":s[10]||(s[10]=l=>t.need_attach_page=l),type:"checkbox",id:"need-page-attach"},null,512),[[k,t.need_attach_page]]),io])]),t.need_attach_page?(n(),a("div",ro,[t.pageForm.next_page_id?(n(),a("p",co,[r("Связано со страницей #"+g(t.pageForm.next_page_id)+" ",1),e("a",{class:"btn btn-link",onClick:s[11]||(s[11]=l=>t.pageForm.next_page_id=null)},"Очистить")])):d("",!0),b(O,{current:t.pageForm.id,onCallback:t.attachPage,editor:!1},null,8,["current","onCallback"])])):d("",!0),e("div",uo,[e("div",mo,[c(e("input",{class:"form-check-input","onUpdate:modelValue":s[12]||(s[12]=l=>t.need_attach_slug=l),type:"checkbox",id:"need-slug-attach"},null,512),[[k,t.need_attach_slug]]),_o])]),t.need_attach_slug?(n(),a("div",ho,[t.pageForm.next_bot_menu_slug_id?(n(),a("p",po,[r("Связано со скриптом #"+g(t.pageForm.next_bot_menu_slug_id)+" ",1),e("a",{class:"btn btn-link",onClick:s[13]||(s[13]=l=>t.pageForm.next_bot_menu_slug_id=null)},"Очистить")])):d("",!0),t.bot?(n(),f(De,{key:1,global:!0,onCallback:t.associateSlug,bot:t.bot},null,8,["onCallback","bot"])):d("",!0)])):d("",!0),e("div",bo,[e("div",go,[c(e("input",{class:"form-check-input","onUpdate:modelValue":s[14]||(s[14]=l=>t.need_attach_dialog=l),type:"checkbox",id:"need-dialog-attach"},null,512),[[k,t.need_attach_dialog]]),fo])]),t.need_attach_dialog?(n(),a("div",yo,[t.pageForm.next_bot_dialog_command_id?(n(),a("p",vo,[r("Связано с диалогом #"+g(t.pageForm.next_bot_dialog_command_id)+" ",1),e("a",{class:"btn btn-link",onClick:s[15]||(s[15]=l=>t.pageForm.next_bot_dialog_command_id=null)},"Очистить")])):d("",!0),t.bot?(n(),f(et,{key:1,onSelectDialog:t.associateDialog,bot:t.bot},null,8,["onSelectDialog","bot"])):d("",!0)])):d("",!0),ko],32)):d("",!0)}}}),wo={data(){return{bot:null,menus:[],deletedMenus:[],menuForm:{title:null,description:null,image:null,info_link:null,bot_id:null}}},computed:{...F(["getCurrentBot"])},mounted(){this.loadCurrentBot().then(()=>{this.loadMenuByBotId()})},methods:{loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},loadMenuByBotId(){this.$store.dispatch("loadMenuByBotId",{botId:this.bot.id}).then(o=>{this.menus=o}).catch(()=>{})},getPhoto(o){return{imageUrl:URL.createObjectURL(o)}},removePhoto(){this.menuForm.image=null},removeItem(o){this.menus[o].id&&this.deletedMenus.push(this.menus[o].id),this.menus.splice(o,1)},submitMenus(){this.menus.forEach(o=>{let t=new FormData;Object.keys(o).forEach(s=>{const i=o[s]||"";typeof i=="object"?t.append(s,JSON.stringify(i)):t.append(s,i)}),this.deletedMenus.length>0&&t.append("deleted_menus",JSON.stringify(this.deletedMenus)),typeof o.image!="string"&&(t.append("preview",o.image),t.delete("image")),this.$store.dispatch("createImageMenu",{menuForm:t}).then(s=>{this.$emit("callback",s.data),this.$notify("Меню успешно создано и сохранено")}).catch(s=>{})})},addImageMenu(){this.menuForm.bot_id=this.bot.id,this.menus.push(this.menuForm),this.$notify("Меню успешно добавлено в список"),this.menuForm={title:null,description:null,image:null,info_link:null,bot_id:null}},onChangePhotos(o){const t=o.target.files[0];this.menuForm.image=t}}},Co={key:0,class:"card"},Bo={class:"card-body"},Po={class:"row"},So={class:"col-md-8"},Vo={class:"row"},jo={class:"col-12"},Uo={class:"mb-3"},To=e("label",{class:"form-label",id:"menu-address"},[r(" Заголовок меню "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),Io={class:"row"},Oo={class:"col-12"},Lo={class:"mb-3"},qo={class:"form-label",id:"menu-description"},Mo=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Do={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},Ro={class:"row"},Go={class:"col-12"},zo={class:"mb-3"},Ao=e("label",{class:"form-label",id:"menu-address"},[r("Ссылка на страницу в "),e("a",{target:"_blank",href:"https://telegra.ph"},"telegra.ph")],-1),No={class:"row"},Ko={class:"col-12 mb-3"},Eo=e("h5",null,"Картинка меню с позициями",-1),xo={class:"photo-preview d-flex justify-content-start flex-wrap w-100"},Jo={for:"menu-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},Ho=e("span",null,"+",-1),Qo={key:0,class:"mb-2 img-preview",style:{"margin-right":"10px"}},Xo={class:"remove"},Yo=e("div",{class:"row"},[e("div",{class:"col-12"},[e("button",{class:"btn btn-outline-success w-100",type:"submit"},"Добавить меню ")])],-1),Wo={class:"col-md-4"},Zo={class:"row"},es={class:"col-12 mt-3"},ts={class:"card"},os={class:"card-header d-flex justify-content-between"},ss=["onClick"],ls={class:"card-body"},ns={class:"w-100 d-flex"},as={key:0,class:"mb-2 img-preview",style:{"margin-right":"10px"}},is={key:0},ds={key:1},rs={key:1,class:"col-12 mt-3"},cs=e("p",null,"На текущий момент у заведения нет ни 1 созданного меню",-1),us=[cs],ms={class:"row mt-3"},_s={class:"col-12"},hs=["disabled"];function ps(o,t,s,i,u,l){const h=V("lazy");return u.bot?(n(),a("div",Co,[e("div",Bo,[e("div",Po,[e("div",So,[e("form",{onSubmit:t[5]||(t[5]=w((...m)=>l.addImageMenu&&l.addImageMenu(...m),["prevent"]))},[e("h6",null,"Графическое Меню к боту #"+g(u.bot.id||"Не установлен"),1),e("div",Vo,[e("div",jo,[e("div",Uo,[To,c(e("input",{type:"text",class:"form-control",placeholder:"Название меню","aria-label":"Название меню",maxlength:"255","onUpdate:modelValue":t[0]||(t[0]=m=>u.menuForm.title=m),"aria-describedby":"menu-address",required:""},null,512),[[p,u.menuForm.title]])])])]),e("div",Io,[e("div",Oo,[e("div",Lo,[e("label",qo,[r(" Описание меню "),Mo,u.menuForm.description?(n(),a("small",Do," Длина текста "+g(u.menuForm.description.length),1)):d("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Описание меню","aria-label":"Описание меню",maxlength:"255","onUpdate:modelValue":t[1]||(t[1]=m=>u.menuForm.description=m),"aria-describedby":"menu-description"},`
                    `,512),[[p,u.menuForm.description]])])])]),e("div",Ro,[e("div",Go,[e("div",zo,[Ao,r(" с вашим меню "),c(e("input",{type:"text",class:"form-control",placeholder:"Информационная ссылка","aria-label":"Информационная ссылка",maxlength:"255","onUpdate:modelValue":t[2]||(t[2]=m=>u.menuForm.info_link=m),"aria-describedby":"menu-info-link"},null,512),[[p,u.menuForm.info_link]])])])]),e("div",No,[e("div",Ko,[Eo,e("div",xo,[e("label",Jo,[Ho,e("input",{type:"file",id:"menu-photos",accept:"image/*",onChange:t[3]||(t[3]=(...m)=>l.onChangePhotos&&l.onChangePhotos(...m)),style:{display:"none"}},null,32)]),u.menuForm.image?(n(),a("div",Qo,[c(e("img",null,null,512),[[h,l.getPhoto(u.menuForm.image).imageUrl]]),e("div",Xo,[e("a",{onClick:t[4]||(t[4]=m=>l.removePhoto())},"Удалить")])])):d("",!0)])])]),Yo],32)]),e("div",Wo,[e("div",Zo,[u.menus.length>0?(n(!0),a(y,{key:0},v(u.menus,(m,U)=>(n(),a("div",es,[e("div",ts,[e("div",os,[e("h6",null,[r("Название "),e("strong",null,g(m.title||"Не указано"),1)]),e("a",{class:"cursor-pointer",onClick:Hi=>l.removeItem(U)},"Удалить",8,ss)]),e("div",ls,[e("p",null,g(m.description||"Не указано"),1),e("p",null," ссылка на меню из telegra.ph "+g(m.info_link||"Не указано"),1),e("div",ns,[m.image?(n(),a("div",as,[typeof m.image=="string"?c((n(),a("img",is,null,512)),[[h,"/images-by-bot-id/"+u.bot.id+"/"+m.image]]):c((n(),a("img",ds,null,512)),[[h,l.getPhoto(m.image).imageUrl]])])):d("",!0)])])])]))),256)):(n(),a("div",rs,us))])])]),e("div",ms,[e("div",_s,[e("button",{onClick:t[6]||(t[6]=(...m)=>l.submitMenus&&l.submitMenus(...m)),disabled:u.menus.length===0,class:"btn btn-outline-primary p-3 w-100"},"Сохранить меню для заведения ",8,hs)])])])])):d("",!0)}const bs=C(wo,[["render",ps]]),gs={props:["data"],data(){return{hasConnect:!1,bot:null,amoForm:{client_id:null,client_secret:null,auth_code:null,redirect_uri:null,subdomain:null,bot_id:null}}},computed:{...F(["getCurrentBot"])},mounted(){this.bot=this.getCurrentBot,this.data?this.$nextTick(()=>{this.amoForm.client_id=this.data.client_id||null,this.amoForm.client_secret=this.data.client_secret||null,this.amoForm.auth_code=this.data.auth_code||null,this.amoForm.redirect_uri=this.data.redirect_uri||null,this.amoForm.subdomain=this.data.subdomain||null,this.amoForm.bot_id=this.data.bot_id||this.bot.id||null}):this.amoForm.bot_id=this.bot.id||null},methods:{submitAmo(){let o=new FormData;Object.keys(this.amoForm).forEach(t=>{const s=this.amoForm[t]||"";typeof s=="object"?o.append(t,JSON.stringify(s)):o.append(t,s)}),this.$store.dispatch("saveAmoCRM",{amoForm:o}).then(t=>{this.$notify("Данные CRM успешно сохранены")}).catch(t=>{})}}},fs=e("div",{class:"col-12"},[e("p",null,[e("a",{target:"_blank",href:"https://www.amocrm.ru/developers/content/oauth/step-by-step"},"Документация для разработчика "),r(" по шагам")])],-1),ys={class:"col-md-6 col-12 mb-2"},vs={class:"form-label",id:"client_id"},ks=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),$s=e("div",null,"ID интеграции",-1),Fs=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),ws={class:"col-md-6 col-12 mb-2"},Cs={class:"form-label",id:"client_secret"},Bs=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Ps=e("div",null,"Секрет интеграции",-1),Ss=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Vs={class:"col-md-6 mb-2"},js={class:"form-label",id:"auth_code"},Us=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Ts=e("div",null,"Полученный код авторизации",-1),Is=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Os={class:"col-md-6 col-12 mb-2"},Ls={class:"form-label",id:"subdomain2"},qs=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Ms=e("div",null,"Ваш поддомен в системе AMO CRM",-1),Ds=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Rs=e("div",{class:"col-md-12 col-12"},[e("button",{type:"submit",class:"btn btn-outline-primary p-3 w-100"},[e("i",{class:"fa-solid fa-cloud-arrow-down mr-1"}),r(" Сохранить настройку AMO ")])],-1);function Gs(o,t,s,i,u,l){const h=S("Popper");return n(),a("form",{onSubmit:t[4]||(t[4]=w((...m)=>l.submitAmo&&l.submitAmo(...m),["prevent"])),class:"row"},[fs,e("div",ys,[e("label",vs,[b(h,null,{content:_(()=>[$s]),default:_(()=>[ks]),_:1}),r(" client_id "),Fs]),c(e("input",{type:"text",class:"form-control",placeholder:"client_id","aria-label":"client_id","onUpdate:modelValue":t[0]||(t[0]=m=>u.amoForm.client_id=m),"aria-describedby":"client_id"},null,512),[[p,u.amoForm.client_id]])]),e("div",ws,[e("label",Cs,[b(h,null,{content:_(()=>[Ps]),default:_(()=>[Bs]),_:1}),r(" client_secret "),Ss]),c(e("input",{type:"text",class:"form-control",placeholder:"client_secret","aria-label":"client_secret","onUpdate:modelValue":t[1]||(t[1]=m=>u.amoForm.client_secret=m),"aria-describedby":"client_secret"},null,512),[[p,u.amoForm.client_secret]])]),e("div",Vs,[e("label",js,[b(h,null,{content:_(()=>[Ts]),default:_(()=>[Us]),_:1}),r(" auth_code "),Is]),c(e("textarea",{class:"form-control",placeholder:"auth_code","aria-label":"auth_code","onUpdate:modelValue":t[2]||(t[2]=m=>u.amoForm.auth_code=m),"aria-describedby":"auth_code"},`
                                    `,512),[[p,u.amoForm.auth_code]])]),e("div",Os,[e("label",Ls,[b(h,null,{content:_(()=>[Ms]),default:_(()=>[qs]),_:1}),r(" subdomain "),Ds]),c(e("input",{type:"text",class:"form-control",placeholder:"subdomain","aria-label":"subdomain","onUpdate:modelValue":t[3]||(t[3]=m=>u.amoForm.subdomain=m),"aria-describedby":"subdomain"},null,512),[[p,u.amoForm.subdomain]])]),Rs],32)}const zs=C(gs,[["render",Gs]]);const As={key:0,class:"row"},Ns={class:"col-12"},Ks={key:1,class:"row mb-3 bot-sub-menu"},Es={class:"col-12"},xs={class:"btn-group",role:"group","aria-label":"Basic outlined example"},Js=e("i",{class:"fa-solid fa-info mr-1"},null,-1),Hs=["disabled"],Qs=e("i",{class:"fa-solid fa-file mr-2"},null,-1),Xs=e("i",{class:"fa-solid fa-list-check mr-2"},null,-1),Ys=e("i",{class:"fa-brands fa-shopify mr-2"},null,-1),Ws={class:"dropdown"},Zs=["disabled"],el=e("i",{class:"fa-solid fa-bars"},null,-1),tl=[el],ol={class:"dropdown-menu","aria-labelledby":"dropdownMenuLink"},sl={key:0},ll={key:0,class:"row"},nl={class:"col-12"},al={class:"card border-success mb-3 mt-3"},il={class:"card-body"},dl={class:"form-label",id:"bot-level-2"},rl=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),cl=e("div",null,[r("Ваш бот будет 1 в 1 как в шаблоне!"),e("br"),r("Потом можно исправить названия кнопок в меню. ")],-1),ul=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),ml=["value"],_l={class:"row"},hl={class:"col-md-12 col-12"},pl={class:"form-check mb-3"},bl=["value"],gl=e("label",{class:"form-check-label",for:"bot-is-template"}," Сделать шаблоном ",-1),fl={key:0,class:"col-md-12 col-12"},yl={class:"mb-3"},vl={class:"form-label",id:"bot-template-description"},kl=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),$l=e("div",null,"Если вы создаете шаблон, а не реального бота ",-1),Fl=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),wl={class:"row"},Cl=e("div",{class:"col-12"},[e("p",null,[r("Для создания бота в Телеграм воспользуйтесь "),e("a",{href:"https://telegra.ph/Sozdanie-telegram-bota-06-12",target:"_blank"},"инструкцией")])],-1),Bl={class:"col-12"},Pl={class:"mb-3"},Sl={class:"form-label",id:"bot-domain"},Vl=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),jl=e("div",null,'Строго взять из BotFather! ТО что при создании с окончанием на "bot"',-1),Ul=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Tl={key:0},Il=["href"],Ol={class:"col-md-6 col-12"},Ll={class:"mb-3"},ql={class:"form-label d-flex justify-content-between",id:"bot-token"},Ml=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Dl=e("div",null,"Взять из BotFater при создании бота! Длинная нечитаемая подсвеченная строка! ",-1),Rl=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Gl=e("a",{href:"https://t.me/botfather",target:"_blank"},"Создать нового бота в ТГ",-1),zl={class:"col-md-6 col-12"},Al={class:"mb-3"},Nl=e("label",{class:"form-label",id:"bot-token-dev"},"Токен бота (для тестирования)",-1),Kl={class:"col-md-6 col-12"},El={class:"mb-3"},xl={class:"d-flex justify-content-between align-items-center"},Jl={class:"form-label d-flex justify-content-between",id:"bot-order-channel"},Hl=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Ql=e("div",null,"Ввести адрес ссылки на канал в форму после добавления тоукена ",-1),Xl=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Yl={class:"col-md-6 col-12"},Wl={class:"mb-3"},Zl={class:"d-flex justify-content-between"},en=e("label",{class:"form-label",id:"bot-main-channel"},"Канал для постов (id,рекламный)",-1),tn={key:1,class:"row"},on={class:"col-12"},sn={class:"mb-3"},ln={class:"d-flex justify-content-between"},nn={class:"form-label",id:"bot-description"},an=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),dn=e("div",null,"Отобразится пользователю при первом запуске",-1),rn=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),cn={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},un={class:"col-12"},mn={class:"mb-3"},_n={class:"d-flex justify-content-between"},hn={class:"form-label",id:"bot-description"},pn=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),bn=e("div",null,'Для меню "О Боте"',-1),gn=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),fn={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},yn={class:"col-12"},vn={class:"mb-3"},kn={class:"d-flex justify-content-between"},$n={class:"form-label",id:"bot-maintenance-message"},Fn=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),wn={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},Cn={class:"col-md-6 col-12"},Bn={class:"mb-3"},Pn={class:"form-label",id:"bot-balance"},Sn=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Vn=e("div",null,"Начальная сумма денег на счету у конкретного бота",-1),jn=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Un={class:"col-md-6 col-12"},Tn={class:"mb-3"},In={class:"form-label",id:"bot-tax-per-day"},On=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Ln=e("div",null,"Сумма списания денег за сутки работы бота (тариф)",-1),qn=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Mn={class:"col-md-6 col-12"},Dn={class:"mb-3"},Rn=e("label",{class:"form-label",id:"bot-level-1"},[r(" Уровень 1 CashBack, % "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),Gn={class:"col-md-6 col-12"},zn={class:"mb-3"},An=e("label",{class:"form-label",id:"bot-level-2"},"Уровень 2 CashBack, %",-1),Nn={class:"col-md-6 col-12"},Kn={class:"mb-3"},En=e("label",{class:"form-label",id:"bot-level-3"},"Уровень 3 CashBack, %",-1),xn={class:"col-12 mb-2"},Jn={class:"form-check"},Hn=e("label",{class:"form-check-label",for:"need-payments"}," Необходимо подключить платежную систему ",-1),Qn={key:0,class:"col-md-12 col-12"},Xn={class:"form-check mb-3"},Yn=["value"],Wn=e("label",{class:"form-check-label",for:"bot-auto-cashback-on-payments"}," Начислять CashBack автоматически после успешной оплаты ",-1),Zn={class:"mb-3"},ea=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),ta=e("div",null,"Если в боте планируется оплата, то необходимо через BotFather привязать нужную платежную систему и указать в данном поле полученный токен ",-1),oa=e("label",{class:"form-label",id:"bot-level-3"},[r("Токен платежной системы "),e("a",{href:"https://t.me/botfather",target:"_blank"},"Подключить")],-1),sa={class:"col-12 mb-2"},la={class:"form-check"},na=e("label",{class:"form-check-label",for:"need-shop"}," Необходимо интегрировать магазин в бота ",-1),aa={key:1,class:"col-md-12 col-12"},ia={class:"mb-3"},da=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),ra=e("div",null,"Ссылка на страницу ВК с товарами для вашего магазина в боте ",-1),ca=e("label",{class:"form-label",id:"bot-level-3"},[r("Ссылка на группу ВК с товарами "),e("a",{href:"https://vk.com/groups?w=groups_create",target:"_blank"},"Создать")],-1),ua={class:"col-12"},ma={class:"card mb-3"},_a=e("div",{class:"card-header"},[e("h6",null,[r("Информационная ссылка: создайте контент в "),e("a",{target:"_blank",href:"https://telegra.ph"},"https://telegra.ph")])],-1),ha={class:"card-body"},pa=e("div",{class:"row"},[e("div",{class:"col-12"},[e("h6",null,"Ссылка")])],-1),ba={class:"row"},ga={class:"col-12"},fa={class:"mb-3"},ya={class:"col-12"},va={class:"card mb-3"},ka=e("div",{class:"card-header"},[e("h6",null,"Ссылки на соц. сети")],-1),$a={class:"card-body"},Fa=e("div",{class:"row"},[e("div",{class:"col-12"},[e("h6",null,"Ссылка")])],-1),wa={class:"col-5"},Ca={class:"mb-3"},Ba=["onUpdate:modelValue","aria-describedby"],Pa={class:"col-5"},Sa={class:"mb-3"},Va=["onUpdate:modelValue","aria-describedby"],ja={class:"col-2"},Ua=["onClick"],Ta=e("i",{class:"fa-regular fa-trash-can"},null,-1),Ia=[Ta],Oa={class:"row"},La={class:"col-12"},qa={class:"col-12 mb-3"},Ma=e("h6",null,[r("Аватар для бота "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),Da={class:"photo-preview d-flex justify-content-start flex-wrap w-100"},Ra={for:"bot-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},Ga=e("span",null,"+",-1),za={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Aa={class:"remove"},Na=["onClick"],Ka=e("i",{class:"fa-regular fa-trash-can"},null,-1),Ea=[Ka],xa={key:1,class:"mb-2 img-preview",style:{"margin-right":"10px"}},Ja={class:"remove"},Ha=e("i",{class:"fa-regular fa-trash-can"},null,-1),Qa=[Ha],Xa={class:"row"},Ya={class:"col-12"},Wa=["disabled"],Za={key:0},ei={key:1},ti={key:1},oi={key:2},si={key:3},li={key:4},ni={key:5},ai={key:6},ii={key:7},di={key:8,class:"row"},ri={key:0,class:"col-12 col-md-8"},ci={key:1,class:"col-12 col-md-4"},ui={props:["company","bot","editor"],data(){return{page:null,step:0,templates:[],load:!1,loadPage:!1,loadPageList:!1,need_payments:!1,need_shop:!1,command:null,botForm:{is_template:!1,auto_cashback_on_payments:!1,template_description:null,bot_domain:null,bot_token:null,bot_token_dev:null,order_channel:null,main_channel:null,vk_shop_link:null,balance:null,tax_per_day:null,welcome_message:null,image:null,description:null,info_link:null,social_links:[],maintenance_message:null,payment_provider_token:null,level_1:10,level_2:0,level_3:0,photos:[],selected_bot_template_id:null,pages:[],amo:null}}},watch:{need_payments:function(o,t){this.need_payments||(this.botForm.auto_cashback_on_payments=!1)},"botForm.selected_bot_template_id":function(o,t){this.botForm.selected_bot_template_id!=null&&(this.loadSlugsByBotTemplate(this.botForm.selected_bot_template_id),this.loadPagesByBotTemplate(this.botForm.selected_bot_template_id))}},mounted(){this.loadBotTemplates(),this.bot&&this.$nextTick(()=>{this.loadSlugsByBotTemplate(this.bot.id),this.loadPagesByBotTemplate(this.bot.id),this.botForm={id:this.bot.id||null,is_template:this.bot.is_template||!1,auto_cashback_on_payments:this.bot.auto_cashback_on_payments||!1,template_description:this.bot.template_description||null,bot_domain:this.bot.bot_domain||null,bot_token:this.bot.bot_token||null,bot_token_dev:this.bot.bot_token_dev||null,order_channel:this.bot.order_channel||null,main_channel:this.bot.main_channel||null,balance:this.bot.balance||null,tax_per_day:this.bot.tax_per_day||null,vk_shop_link:this.bot.vk_shop_link||null,image:this.bot.image||null,description:this.bot.description||null,info_link:this.bot.info_link||null,social_links:this.bot.social_links||[],maintenance_message:this.bot.maintenance_message||null,welcome_message:this.bot.welcome_message||null,payment_provider_token:this.bot.payment_provider_token||null,level_1:this.bot.level_1||10,level_2:this.bot.level_2||0,level_3:this.bot.level_3||0,photos:this.bot.photos||[],amo:this.bot.amo||null},this.botForm.payment_provider_token&&(this.need_payments=!0)})},methods:{addTextTo(o={param:null,text:null}){this.botForm[o.param]=o.text},loadSlugsByBotTemplate(o){this.load=!0,this.$store.dispatch("loadBotSlugs",{botId:o}).then(t=>{this.botForm.slugs=t,this.$nextTick(()=>{this.load=!1})})},loadPagesByBotTemplate(o){this.$store.dispatch("loadBotPages",{botId:o}).then(t=>{this.botForm.pages=t})},loadBotTemplates(){this.$store.dispatch("loadTemplates").then(o=>{this.templates=o.data})},getPhoto(o){return{imageUrl:URL.createObjectURL(o)}},onChangePhotos(o){const t=o.target.files;this.botForm.image=null;for(let s=0;s<t.length;s++)this.botForm.photos.push(t[s])},addItem(o){this.botForm[o].push("")},addSocialLinks(){this.botForm.social_links.push({title:null,url:null})},removeItem(o,t){this.botForm[o].splice(t,1)},removePhoto(o){o?this.botForm.photos.splice(o,1):this.botForm.image=null},addBot(){let o=new FormData;Object.keys(this.botForm).forEach(t=>{const s=this.botForm[t]||"";typeof s=="object"?o.append(t,JSON.stringify(s)):o.append(t,s)}),this.company&&o.append("company_id",this.company.id);for(let t=0;t<this.botForm.photos.length;t++)o.append("images[]",this.botForm.photos[t]);o.delete("photos"),this.$store.dispatch(this.bot==null?"createBot":"updateBot",{botForm:o}).then(t=>{this.$emit("callback",t.data),this.$notify({title:"Конструктор ботов",text:this.bot==null?"Бот успешно создан!":"Бот успешно обновлен!",type:"success"}),this.bot==null&&(this.botForm={is_template:!1,auto_cashback_on_payments:!1,template_description:null,bot_domain:null,bot_token:null,bot_token_dev:null,order_channel:null,main_channel:null,balance:null,tax_per_day:null,image:null,description:null,info_link:null,social_links:[],maintenance_message:null,payment_provider_token:null,level_1:10,level_2:0,level_3:0,photos:[],selected_bot_template_id:null,pages:[]})}).catch(t=>{})},pageListCallback(o){this.loadPage=!0,this.page=o,this.$nextTick(()=>{this.loadPage=!1})},pageCallback(o){this.loadPageList=!0,this.$nextTick(()=>{this.loadPageList=!1})}}},td=Object.assign(ui,{__name:"BotForm",setup(o){return(t,s)=>{const i=S("Popper"),u=V("lazy");return n(),a(y,null,[o.company?(n(),a("div",As,[e("div",Ns,[e("h6",null,"Создаем бот к компании "+g(o.company.title||"Не установлен"),1)])])):d("",!0),o.editor?(n(),a("div",Ks,[e("div",Es,[e("div",xs,[e("button",{type:"button",class:$([{"btn-info text-white":t.step===0},"btn btn-outline-info"]),onClick:s[0]||(s[0]=l=>t.step=0)},[Js,r(" Информация о боте ")],2),e("button",{type:"button",disabled:t.botForm.selected_bot_template_id===null,class:$([{"btn-info text-white":t.step===4},"btn btn-outline-info"]),onClick:s[1]||(s[1]=l=>t.step=4)},[Qs,r(" Страницы ")],10,Hs),e("button",{type:"button",class:$([{"btn-info text-white":t.step===7},"btn btn-outline-info"]),onClick:s[2]||(s[2]=l=>t.step=7)},[Xs,r(" AMO CRM ")],2),e("button",{type:"button",class:$([{"btn-info text-white":t.step===8},"btn btn-outline-info"]),onClick:s[3]||(s[3]=l=>t.step=8)},[Ys,r(" Магазин ")],2),e("div",Ws,[e("button",{type:"button",disabled:t.botForm.selected_bot_template_id===null,class:"btn btn-outline-info dropdown-toggle custom-group-dropdown-btn",href:"#",role:"button",id:"dropdownMenuLink","data-bs-toggle":"dropdown","aria-expanded":"false"},tl,8,Zs),e("ul",ol,[e("li",null,[e("a",{class:"dropdown-item",href:"#bot-image-menu",onClick:s[4]||(s[4]=l=>t.step=5)},"Меню заведения")]),e("li",null,[e("a",{class:"dropdown-item",href:"#bot-menu-template",onClick:s[5]||(s[5]=l=>t.step=1)},"Шаблон клавитатур бота")]),e("li",null,[e("a",{class:"dropdown-item",href:"#bot-slugs",onClick:s[6]||(s[6]=l=>t.step=2)},"Скрипты")]),e("li",null,[e("a",{class:"dropdown-item",href:"#bot-dialogs",onClick:s[7]||(s[7]=l=>t.step=6)},"Диалоги")]),e("li",null,[e("a",{class:"dropdown-item",href:"#bot-users",onClick:s[8]||(s[8]=l=>t.step=3)},"Пользователи")])])])])])])):d("",!0),e("form",{class:"pb-5 mb-5",onSubmit:s[34]||(s[34]=w((...l)=>t.addBot&&t.addBot(...l),["prevent"]))},[t.step===0?(n(),a("div",sl,[t.templates.length>0&&o.bot==null?(n(),a("div",ll,[e("div",nl,[e("div",al,[e("div",il,[e("label",dl,[b(i,null,{content:_(()=>[cl]),default:_(()=>[rl]),_:1}),r(" Выберите шаблон! "),ul]),c(e("select",{class:"form-control","aria-label":"Шаблон бота","onUpdate:modelValue":s[9]||(s[9]=l=>t.botForm.selected_bot_template_id=l),"aria-describedby":"bot-level-2",required:""},[(n(!0),a(y,null,v(t.templates,(l,h)=>(n(),a("option",{value:l.id},g(l.template_description||l.bot_domain||"Не указано"),9,ml))),256))],512),[[L,t.botForm.selected_bot_template_id]])])])])])):d("",!0),e("div",_l,[e("div",hl,[e("div",pl,[c(e("input",{class:"form-check-input",type:"checkbox",value:t.botForm.is_template,"onUpdate:modelValue":s[10]||(s[10]=l=>t.botForm.is_template=l),id:"bot-is-template"},null,8,bl),[[k,t.botForm.is_template]]),gl])]),t.botForm.is_template?(n(),a("div",fl,[e("div",yl,[e("label",vl,[b(i,null,{content:_(()=>[$l]),default:_(()=>[kl]),_:1}),r(" Название шаблона бота "),Fl]),c(e("input",{type:"text",class:"form-control",placeholder:"Название \\ описание шаблона","aria-label":"Описание шаблона","onUpdate:modelValue":s[11]||(s[11]=l=>t.botForm.template_description=l),maxlength:"255","aria-describedby":"bot-template-description",required:""},null,512),[[p,t.botForm.template_description]])])])):d("",!0)]),e("div",wl,[Cl,e("div",Bl,[e("div",Pl,[e("label",Sl,[b(i,null,{content:_(()=>[jl]),default:_(()=>[Vl]),_:1}),r(" Доменное имя бота из BotFather "),Ul]),c(e("input",{type:"text",class:"form-control",placeholder:"Имя бота","aria-label":"Имя бота","onUpdate:modelValue":s[12]||(s[12]=l=>t.botForm.bot_domain=l),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[p,t.botForm.bot_domain]]),t.botForm.bot_domain?(n(),a("p",Tl,[r("Проверить работу бота "),e("a",{href:"https://t.me/"+t.botForm.bot_domain,target:"_blank"},"@"+g(t.botForm.bot_domain),9,Il)])):d("",!0)])]),e("div",Ol,[e("div",Ll,[e("label",ql,[e("div",null,[b(i,null,{content:_(()=>[Dl]),default:_(()=>[Ml]),_:1}),r(" Токен бота "),Rl]),Gl]),c(e("input",{type:"text",class:"form-control",placeholder:"Токен","aria-label":"Токен","onUpdate:modelValue":s[13]||(s[13]=l=>t.botForm.bot_token=l),maxlength:"255","aria-describedby":"bot-token",required:""},null,512),[[p,t.botForm.bot_token]])])]),e("div",zl,[e("div",Al,[Nl,c(e("input",{type:"text",class:"form-control",placeholder:"Токен","aria-label":"Токен","onUpdate:modelValue":s[14]||(s[14]=l=>t.botForm.bot_token_dev=l),maxlength:"255","aria-describedby":"bot-token-dev"},null,512),[[p,t.botForm.bot_token_dev]])])]),e("div",Kl,[e("div",El,[e("div",xl,[e("label",Jl,[e("div",null,[b(i,null,{content:_(()=>[Ql]),default:_(()=>[Hl]),_:1}),r(" Канал для заказов (id) "),Xl])]),b(I,{token:t.botForm.bot_token,param:"order_channel",onCallback:t.addTextTo},null,8,["token","onCallback"])]),c(e("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":s[15]||(s[15]=l=>t.botForm.order_channel=l),maxlength:"255","aria-describedby":"bot-order-channel"},null,512),[[p,t.botForm.order_channel]])])]),e("div",Yl,[e("div",Wl,[e("div",Zl,[en,b(I,{token:t.botForm.bot_token,param:"main_channel",onCallback:t.addTextTo},null,8,["token","onCallback"])]),c(e("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":s[16]||(s[16]=l=>t.botForm.main_channel=l),maxlength:"255","aria-describedby":"bot-main-channel"},null,512),[[p,t.botForm.main_channel]])])])]),t.botForm.bot_token?(n(),a("div",tn,[e("div",on,[e("div",sn,[e("div",ln,[e("label",nn,[b(i,null,{content:_(()=>[dn]),default:_(()=>[an]),_:1}),r(" Приветственное сообщение "),rn,t.botForm.welcome_message?(n(),a("small",cn," Длина текста "+g(t.botForm.welcome_message.length),1)):d("",!0)]),b(B,{param:"welcome_message",onCallback:t.addTextTo},null,8,["onCallback"])]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текстовое приветствие при запуске бота","aria-label":"Текстовое приветствие при запуске бота","onUpdate:modelValue":s[17]||(s[17]=l=>t.botForm.welcome_message=l),"aria-describedby":"bot-description",required:""},`
                    `,512),[[p,t.botForm.welcome_message]])])]),e("div",un,[e("div",mn,[e("div",_n,[e("label",hn,[b(i,null,{content:_(()=>[bn]),default:_(()=>[pn]),_:1}),r(" Описание бота "),gn,t.botForm.description?(n(),a("small",fn," Длина текста "+g(t.botForm.description.length),1)):d("",!0)]),b(B,{param:"description",onCallback:t.addTextTo},null,8,["onCallback"])]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текстовое описание бота","aria-label":"Текстовое описание бота","onUpdate:modelValue":s[18]||(s[18]=l=>t.botForm.description=l),"aria-describedby":"bot-description",required:""},`
                    `,512),[[p,t.botForm.description]])])]),e("div",yn,[e("div",vn,[e("div",kn,[e("label",$n,[r("Сообщение для режима тех. работ "),Fn,t.botForm.maintenance_message?(n(),a("small",wn," Длина текста "+g(t.botForm.maintenance_message.length),1)):d("",!0)]),b(B,{param:"maintenance_message",onCallback:t.addTextTo},null,8,["onCallback"])]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текстовое сообщение","aria-label":"Текстовое сообщение","onUpdate:modelValue":s[19]||(s[19]=l=>t.botForm.maintenance_message=l),maxlength:"255","aria-describedby":"bot-maintenance-message",required:""},`
                    `,512),[[p,t.botForm.maintenance_message]])])]),e("div",Cn,[e("div",Bn,[e("label",Pn,[b(i,null,{content:_(()=>[Vn]),default:_(()=>[Sn]),_:1}),r(" Баланс бота, руб "),jn]),c(e("input",{type:"number",class:"form-control",placeholder:"Баланс","aria-label":"Баланс","onUpdate:modelValue":s[20]||(s[20]=l=>t.botForm.balance=l),min:"0","aria-describedby":"bot-balance",required:""},null,512),[[p,t.botForm.balance]])])]),e("div",Un,[e("div",Tn,[e("label",In,[b(i,null,{content:_(()=>[Ln]),default:_(()=>[On]),_:1}),r(" Списание за сутки, руб "),qn]),c(e("input",{type:"number",class:"form-control",placeholder:"Списание","aria-label":"Списание","onUpdate:modelValue":s[21]||(s[21]=l=>t.botForm.tax_per_day=l),min:"0","aria-describedby":"bot-tax-per-day",required:""},null,512),[[p,t.botForm.tax_per_day]])])]),e("div",Mn,[e("div",Dn,[Rn,c(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень CashBack","onUpdate:modelValue":s[22]||(s[22]=l=>t.botForm.level_1=l),max:"50",min:"0","aria-describedby":"bot-level-1",required:""},null,512),[[p,t.botForm.level_1]])])]),e("div",Gn,[e("div",zn,[An,c(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень CashBack","onUpdate:modelValue":s[23]||(s[23]=l=>t.botForm.level_2=l),max:"50",min:"0","aria-describedby":"bot-level-2"},null,512),[[p,t.botForm.level_2]])])]),e("div",Nn,[e("div",Kn,[En,c(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень CashBack","onUpdate:modelValue":s[24]||(s[24]=l=>t.botForm.level_3=l),max:"50",min:"0","aria-describedby":"bot-level-3"},null,512),[[p,t.botForm.level_3]])])]),e("div",xn,[e("div",Jn,[c(e("input",{class:"form-check-input","onUpdate:modelValue":s[25]||(s[25]=l=>t.need_payments=l),type:"checkbox",id:"need-payments"},null,512),[[k,t.need_payments]]),Hn])]),t.need_payments?(n(),a("div",Qn,[e("div",Xn,[c(e("input",{class:"form-check-input",type:"checkbox",value:t.botForm.auto_cashback_on_payments,"onUpdate:modelValue":s[26]||(s[26]=l=>t.botForm.auto_cashback_on_payments=l),id:"bot-auto-cashback-on-payments"},null,8,Yn),[[k,t.botForm.auto_cashback_on_payments]]),Wn]),e("div",Zn,[b(i,null,{content:_(()=>[ta]),default:_(()=>[ea]),_:1}),oa,c(e("input",{type:"text",class:"form-control",placeholder:"Токен","aria-label":"уровень CashBack","onUpdate:modelValue":s[27]||(s[27]=l=>t.botForm.payment_provider_token=l),"aria-describedby":"bot-level-3"},null,512),[[p,t.botForm.payment_provider_token]])])])):d("",!0),e("div",sa,[e("div",la,[c(e("input",{class:"form-check-input","onUpdate:modelValue":s[28]||(s[28]=l=>t.need_shop=l),type:"checkbox",id:"need-shop"},null,512),[[k,t.need_shop]]),na])]),t.need_shop?(n(),a("div",aa,[e("div",ia,[b(i,null,{content:_(()=>[ra]),default:_(()=>[da]),_:1}),ca,c(e("input",{type:"url",class:"form-control",placeholder:"Ссылка на группу ВК","aria-label":"ссылка на группу ВК","onUpdate:modelValue":s[29]||(s[29]=l=>t.botForm.vk_shop_link=l),"aria-describedby":"vk_shop_link"},null,512),[[p,t.botForm.vk_shop_link]])])])):d("",!0),e("div",ua,[e("div",ma,[_a,e("div",ha,[pa,e("div",ba,[e("div",ga,[e("div",fa,[c(e("input",{type:"text",class:"form-control",placeholder:"Ссылка ресурс telegraph","aria-label":"Ссылка ресурс telegraph",maxlength:"255","onUpdate:modelValue":s[30]||(s[30]=l=>t.botForm.info_link=l),"aria-describedby":"bot-info-link"},null,512),[[p,t.botForm.info_link]])])])])])])]),e("div",ya,[e("div",va,[ka,e("div",$a,[Fa,(n(!0),a(y,null,v(t.botForm.social_links,(l,h)=>(n(),a("div",{class:"row",key:"social-link"+h},[e("div",wa,[e("div",Ca,[c(e("input",{type:"text",class:"form-control",placeholder:"Название ссылки","aria-label":"Название ссылки",maxlength:"255","onUpdate:modelValue":m=>t.botForm.social_links[h].title=m,"aria-describedby":"bot-social-link-"+h,required:""},null,8,Ba),[[p,t.botForm.social_links[h].title]])])]),e("div",Pa,[e("div",Sa,[c(e("input",{type:"text",class:"form-control",placeholder:"Ссылка на соц.сеть","aria-label":"Ссылка на соц.сеть",maxlength:"255","onUpdate:modelValue":m=>t.botForm.social_links[h].url=m,"aria-describedby":"bot-social-link-"+h,required:""},null,8,Va),[[p,t.botForm.social_links[h].url]])])]),e("div",ja,[e("button",{type:"button",onClick:m=>t.removeItem("social_links",h),class:"btn btn-outline-danger w-100"},Ia,8,Ua)])]))),128)),e("div",Oa,[e("div",La,[e("button",{type:"button",onClick:s[31]||(s[31]=l=>t.addSocialLinks()),class:"btn btn-outline-success w-100"},"Добавить еще ссылку ")])])])])]),e("div",qa,[Ma,e("div",Da,[e("label",Ra,[Ga,e("input",{type:"file",id:"bot-photos",multiple:"",accept:"image/*",onChange:s[32]||(s[32]=(...l)=>t.onChangePhotos&&t.onChangePhotos(...l)),style:{display:"none"}},null,32)]),t.botForm.photos?(n(!0),a(y,{key:0},v(t.botForm.photos,(l,h)=>(n(),a("div",za,[c(e("img",null,null,512),[[u,t.getPhoto(l).imageUrl]]),e("div",Aa,[e("a",{onClick:m=>t.removePhoto(h)},Ea,8,Na)])]))),256)):(n(),a("div",xa,[c(e("img",null,null,512),[[u,"/images-by-bot-id/"+o.bot.id+"/"+t.botForm.image]]),e("div",Ja,[e("a",{onClick:s[33]||(s[33]=l=>t.removePhoto())},Qa)])]))])])])):d("",!0),e("div",Xa,[e("div",Ya,[e("button",{disabled:!t.botForm.bot_token,type:"submit",class:"btn btn-success w-100 p-3"},[o.bot?(n(),a("span",ei,"Обновить бота")):(n(),a("span",Za,"Добавить бота"))],8,Wa)])])])):d("",!0),t.step===7?(n(),a("div",ti,[t.load?d("",!0):(n(),f(zs,{key:0,data:t.botForm.amo},null,8,["data"]))])):d("",!0),t.step===8?(n(),a("div",oi,[t.load?d("",!0):(n(),f(D,{key:0}))])):d("",!0),t.step===5?(n(),a("div",si,[t.load?d("",!0):(n(),f(bs,{key:0}))])):d("",!0),t.step===1?(n(),a("div",li,[t.load?d("",!0):(n(),f(P,{key:0,"select-mode":!1}))])):d("",!0),t.step===6?(n(),a("div",ni,[t.load?d("",!0):(n(),f(R,{key:0}))])):d("",!0),t.step===2?(n(),a("div",ai,[t.load?d("",!0):(n(),f(G,{key:0}))])):d("",!0),t.step===3?(n(),a("div",ii,[t.load?d("",!0):(n(),f(z,{key:0}))])):d("",!0),t.step===4?(n(),a("div",di,[t.load?d("",!0):(n(),a("div",ri,[t.loadPage?d("",!0):(n(),f(Fo,{key:0,page:t.page,onCallback:t.pageCallback},null,8,["page","onCallback"]))])),t.load?d("",!0):(n(),a("div",ci,[t.loadPageList?d("",!0):(n(),f(O,{key:0,editor:!0,onCallback:t.pageListCallback},null,8,["onCallback"]))]))])):d("",!0)],32)],64)}}}),mi={key:0},_i={class:"row"},hi={class:"col-md-12 d-flex flex-column"},pi={class:"d-flex"},bi={class:"dropdown mr-2"},gi=e("button",{class:"btn btn-outline-primary dropdown-toggle",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"}," Фильтры ",-1),fi={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},yi=["onClick"],vi={class:"input-group mb-3"},ki={key:0,class:"mt-2"},$i={class:"badge bg-info mr-1"},Fi=["onClick"],wi=e("i",{class:"fa-solid fa-xmark"},null,-1),Ci=[wi],Bi={key:0,class:"row"},Pi={class:"col-12 mb-3"},Si={class:"list-group w-100"},Vi=["onClick"],ji={key:0,class:"badge bg-info"},Ui=["onClick"],Ti=e("i",{class:"fa-regular fa-copy"},null,-1),Ii=[Ti],Oi=["onClick"],Li=e("i",{class:"fa-solid fa-boxes-packing"},null,-1),qi=[Li],Mi=["onClick"],Di=e("i",{class:"fa-solid fa-box-open"},null,-1),Ri=[Di],Gi=["onClick"],zi=e("i",{class:"fa-solid fa-trash-can text-white"},null,-1),Ai=[zi],Ni={class:"col-12"},Ki={key:1,class:"row"},Ei=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранной компании нет созданных ботов! ")],-1),xi=[Ei],Ji={props:["companyId","editor"],data(){return{filters:[{name:"Активные",icon:"fa-brands fa-telegram",slug:"active"},{name:"Архивные",icon:"fa-solid fa-box-archive",slug:"archive"}],selectedFilters:[],show:!0,loading:!0,bots:[],search:null,bots_paginate_object:null}},computed:{...F(["getBots","getBotsPaginateObject","getCurrentCompany"]),filteredBots(){if(!this.bots)return[];if(this.selectedFilters.length===0&&this.search==null)return this.bots;if(this.selectedFilters.length===0&&this.search!=null)return this.bots.filter(t=>(t.bot_domain||"").trim().toLowerCase().indexOf(this.search.trim().toLowerCase())!==-1);let o=[];return this.selectedFilters.forEach(t=>{switch(t.slug){case"active":this.bots.filter(s=>s.deleted_at==null).forEach(s=>{o.push(s)});break;case"archive":this.bots.filter(s=>s.deleted_at!=null).forEach(s=>{o.push(s)});break}}),this.search==null?o:o.filter(t=>(t.bot_domain||"").trim().toLowerCase().indexOf(this.search.trim().toLowerCase())!==-1)}},mounted(){this.loadBots(),this.selectFilter("active")},methods:{duplicate(o){if(!this.getCurrentCompany){this.$notify("У вас не выбран клиент!");return}this.$store.dispatch("duplicateBot",{dataObject:{bot_id:o,company_id:this.getCurrentCompany.id}}).then(t=>{let s=this.bots_paginate_object.meta.current_page||0;this.loadBots(s),this.$notify("Указанный бот успешно продублирован")})},addToArchive(o){this.$store.dispatch("removeBot",{botId:o}).then(t=>{let s=this.bots_paginate_object.meta.current_page||0;this.loadBots(s),this.$notify("Указанный бот успешно перемещен в архив")})},forceDelete(o){this.$store.dispatch("forceDeleteBot",{botId:o}).then(t=>{let s=this.bots_paginate_object.meta.current_page||0;this.loadBots(s),this.$notify("Указанный бот успешно перемещен из архива")})},extractFromArchive(o){this.$store.dispatch("restoreBot",{botId:o}).then(t=>{let s=this.bots_paginate_object.meta.current_page||0;this.loadBots(s),this.$notify("Указанный бот успешно перемещен из архива")})},selectFilter(o){let t=this.filters.find(s=>s.slug===o);t&&this.selectedFilters.filter(s=>s.slug===o).length===0&&this.selectedFilters.push(t)},removeSelectedFilter(o){let t=this.selectedFilters.findIndex(s=>s.slug===o);this.selectedFilters.splice(t,1)},selectBot(o){this.$emit("callback",o),this.show=!1,this.$notify("Вы выбрали бота из списка! Все остальные действия будут производится для этого бота.")},nextBots(o){this.loadBots(o)},loadBots(o=0){this.loading=!0,this.$store.dispatch("loadBots",{dataObject:{companyId:this.companyId||null,search:this.search},page:o}).then(t=>{this.loading=!1,this.bots=this.getBots,this.bots_paginate_object=this.getBotsPaginateObject}).catch(()=>{this.loading=!1})}}},od=Object.assign(Ji,{__name:"BotList",setup(o){return(t,s)=>t.show?(n(),a("div",mi,[e("div",_i,[e("div",hi,[e("div",pi,[e("div",bi,[gi,e("ul",fi,[(n(!0),a(y,null,v(t.filters,i=>(n(),a("li",null,[e("a",{class:"dropdown-item",onClick:u=>t.selectFilter(i.slug),href:"#filter"},[e("i",{class:$([i.icon,"mr-2"])},null,2),r(" "+g(i.name||"Не указано"),1)],8,yi)]))),256))])]),e("div",vi,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск бота","aria-label":"Поиск бота","onUpdate:modelValue":s[0]||(s[0]=i=>t.search=i),"aria-describedby":"button-addon2"},null,512),[[p,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:s[1]||(s[1]=(...i)=>t.loadBots&&t.loadBots(...i)),type:"button",id:"button-addon2"},"Найти ")])]),t.selectedFilters.length>0?(n(),a("p",ki,[(n(!0),a(y,null,v(t.selectedFilters,i=>(n(),a("span",$i,[r(g(i.name||"не указан")+" ",1),e("a",{onClick:u=>t.removeSelectedFilter(i.slug),class:"ml-1 text-white",href:"#filter"},Ci,8,Fi)]))),256))])):d("",!0)])]),t.bots.length>0?(n(),a("div",Bi,[e("div",Pi,[e("ul",Si,[o.editor?d("",!0):(n(),a("li",{key:0,class:"list-group-item active cursor-pointer btn btn-outline-info",onClick:s[2]||(s[2]=i=>t.selectBot(null))},"Создать нового бота ")),(n(!0),a(y,null,v(t.filteredBots,(i,u)=>(n(),a("li",{class:$(["list-group-item cursor-pointer btn mb-1 d-flex align-items-center justify-between",{"btn-outline-info":i.deleted_at==null,"btn-outline-secondary border-secondary":i.deleted_at!=null}])},[e("strong",{onClick:l=>t.selectBot(i),style:{"word-wrap":"break-word"}},[e("i",{class:$([{"text-danger":i.deleted_at!=null},"fa-solid fa-robot mr-2"])},null,2),r(g(i.bot_domain||"Не указано"),1)],8,Vi),i.is_template?(n(),a("span",ji,g(i.template_description||"Шаблон без названия"),1)):d("",!0),e("div",null,[e("button",{class:"btn btn-outline-info mr-2",type:"button",onClick:l=>t.duplicate(i.id),title:"Дублировать"},Ii,8,Ui),i.deleted_at==null?(n(),a("button",{key:0,class:"btn btn-outline-info",type:"button",onClick:l=>t.addToArchive(i.id),title:"В архив"},qi,8,Oi)):d("",!0),i.deleted_at!=null?(n(),a("button",{key:1,class:"btn btn-outline-info mr-2",onClick:l=>t.extractFromArchive(i.id),title:"Из архива"},Ri,8,Mi)):d("",!0),i.deleted_at!=null?(n(),a("button",{key:2,class:"btn btn-danger mr-2",onClick:l=>t.forceDelete(i.id),title:"Удалить на совсем"},Ai,8,Gi)):d("",!0)])],2))),256))])]),e("div",Ni,[t.bots_paginate_object?(n(),f(j,{key:0,onPagination_page:t.nextBots,pagination:t.bots_paginate_object},null,8,["onPagination_page","pagination"])):d("",!0)])])):(n(),a("div",Ki,xi))])):d("",!0)}});export{bs as I,td as _,od as a,O as b,Fo as c};
