import{o as l,q as i,t as e,F as b,B as f,x as m,C as h,z as r,N as S,D as c,U as j,v as F,H as v,G as p,O as k,A as $,a4 as K,W as U,J as T,M as y,K as L}from"./index.es-ce2063b4.js";import{_ as R,a as z,b as I}from"./GlobalSlugList-0190e6f2.js";import{P as V}from"./Pagination-e8ce4012.js";import{m as C}from"./index-490ab070.js";import{_ as P}from"./_plugin-vue_export-helper-c27b6911.js";import{T as B}from"./TelegramChannelHelper-03e7b968.js";import{B as O,_ as q}from"./Mail-3722ee69.js";/* empty css                                                               */const E={props:["param"],data(){return{expressions:[{expression:"{{userName}}",description:"Имя пользователя"},{expression:"{{telegramChatId}}",description:"Идентификатор чата"},{expression:"{{referralLink}}",description:"Реферальная ссылка"},{expression:"{{referralQr}}",description:"Реферальный QR-код"}]}},methods:{expressionsSelect(s){this.$emit("callback",{param:this.param,text:s.expression})}}},N={class:"dropdown"},Y=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-brands fa-hire-a-helper"})],-1),W={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},J=["onClick"];function H(s,t,o,n,d,a){return l(),i("div",N,[Y,e("div",W,[e("li",null,[(l(!0),i(b,null,f(d.expressions,_=>(l(),i("a",{class:"dropdown-item",onClick:u=>a.expressionsSelect(_)},m(_.description||"-"),9,J))),256))])])])}const Q=P(E,[["render",H]]);const X={class:"card-header d-flex justify-content-between"},Z={class:"dropdown"},x=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),ee={class:"dropdown-menu"},te=e("i",{class:"fa-solid fa-arrow-left mr-1"},null,-1),se=e("hr",null,null,-1),oe=["data-bs-target"],le=e("i",{class:"fa-regular fa-pen-to-square mr-1"},null,-1),ie=e("i",{class:"fa-solid fa-clone mr-1"},null,-1),ne=e("i",{class:"fa-regular fa-trash-can text-danger mr-1"},null,-1),ae={key:0,class:"fa-solid fa-arrow-up-short-wide"},de={key:1,class:"fa-solid fa-arrow-down-short-wide"},re={class:"card-body"},ce={class:"row"},ue={class:"col-12"},he={key:0},me={key:1,class:"list-group list-group-numbered"},_e={class:"list-group-item d-flex justify-content-between align-items-start"},pe={class:"ms-2 me-auto"},be=e("div",{class:"fw-bold"},"Идентификатор",-1),ge={class:"list-group-item d-flex justify-content-between align-items-start"},fe={class:"ms-2 me-auto"},ye=e("div",{class:"fw-bold"},"Команда",-1),$e={class:"list-group-item d-flex justify-content-between align-items-start"},ke={class:"ms-2 me-auto"},ve=e("div",{class:"fw-bold"},"Мнемоническое имя",-1),Fe={class:"list-group-item d-flex justify-content-between align-items-start"},we={class:"ms-2 me-auto"},Ce=e("div",{class:"fw-bold"},"Пояснение",-1),Se={key:0,class:"list-group-item d-flex justify-content-between align-items-start"},Ve={class:"ms-2 me-auto"},je=e("div",{class:"fw-bold"},"Набор параметров скрипта",-1),Pe={key:1,class:"list-group-item d-flex justify-content-between align-items-start"},Ue=e("div",{class:"ms-2 me-auto"},[e("div",{class:"fw-bold"},"Привязана страница")],-1),Be=[Ue],Oe={key:2,class:"list-group-item d-flex justify-content-between align-items-start"},Te=e("div",{class:"ms-2 me-auto"},[e("div",{class:"fw-bold"},"Глобальный скрипт")],-1),Ie=[Te],De={class:"list-group-item d-flex justify-content-between align-items-start"},qe={class:"ms-2 me-auto w-100"},Le=e("div",{class:"fw-bold"},"Перенести данные из:",-1),Re=e("option",{value:null},"Не выбрано",-1),Ge=["value"],Me=e("p",{class:"my-2"},[e("em",null,"Перенос данных затирает текущие данные в данном скрипте")],-1),Ae=["disabled"],Ke=["id"],ze={class:"modal-dialog modal-fullscreen"},Ee={class:"modal-content"},Ne={class:"modal-header"},Ye={class:"modal-title",id:"exampleModalLabel"},We=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Je={class:"modal-body"},He=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),Qe={props:["item","bot","selectMode"],data(){return{selected_slug_id:null,slugs:[],load:!1,simple:!0}},watch:{simple:function(){this.simple||this.loadAllSlugs()}},mounted(){},methods:{selectCard(){this.$emit("select",this.item)},slugFormCallback(){this.load=!0,this.$emit("callback"),this.$nextTick(()=>{this.load=!1})},editSlug(){this.load=!0,this.$nextTick(()=>{this.load=!1})},selectSlug(){this.load=!0,this.$emit("select",this.item),this.$nextTick(()=>{this.load=!1})},duplicateSlug(){this.load=!0,this.$store.dispatch("duplicateSlug",{dataObject:{slugId:this.item.id}}).then(s=>{this.$notify({title:"Конструктор команд",text:"Команда успешно продублирована",type:"success"}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}).catch(s=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})},submitRelocateData(){this.$store.dispatch("relocateSlugActionData",{slug_sender_id:this.selected_slug_id,slug_recipient_id:this.item.id,bot_id:this.bot.id}).then(s=>{this.$notify({title:"Конструктор команд",text:"Данные команды успешно перенесены",type:"success"})}).catch(s=>{this.$notify({title:"Конструктор команд",text:"Ошибка переноса данных",type:"error"})})},loadAllSlugs(){this.$store.dispatch("loadAllSlugs",{botId:this.bot.id}).then(s=>{this.slugs=s.data})},removeSlug(){this.load=!0,this.$store.dispatch("removeSlug",{dataObject:{slugId:this.item.id}}).then(s=>{this.$notify({title:"Конструктор команд",text:"Команда успешно удалена",type:"success"}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}).catch(s=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})})}}},Xe=Object.assign(Qe,{__name:"Slug",setup(s){return(t,o)=>(l(),i(b,null,[e("div",{class:F(["card",{"deprecated-slug":s.item.deprecated_at!=null,"global-slug":s.item.is_global}])},[e("div",X,[e("div",Z,[x,e("ul",ee,[e("li",null,[e("a",{onClick:o[0]||(o[0]=(...n)=>t.selectSlug&&t.selectSlug(...n)),title:"Выбрать команду",class:"dropdown-item cursor-pointer"},[te,h(" Выбрать команду ")])]),se,e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:o[1]||(o[1]=(...n)=>t.editSlug&&t.editSlug(...n)),"data-bs-toggle":"modal","data-bs-target":"#edit-slug-"+s.item.id},[le,h(" Редактировать")],8,oe)]),e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:o[2]||(o[2]=(...n)=>t.duplicateSlug&&t.duplicateSlug(...n))},[ie,h(" Дублировать")])]),e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:o[3]||(o[3]=(...n)=>t.removeSlug&&t.removeSlug(...n))},[ne,h(" Удалить")])])])]),e("button",{type:"button",onClick:o[4]||(o[4]=n=>t.simple=!t.simple),class:"btn btn-outline-primary ml-2"},[t.simple?(l(),i("i",ae)):(l(),i("i",de))])]),e("div",re,[e("div",ce,[e("div",ue,[t.simple?(l(),i("p",he,m(s.item.command||"Нет команды"),1)):(l(),i("ol",me,[e("li",_e,[e("div",pe,[be,h(" №"+m(s.item.id||"Нет идентификатора"),1)])]),e("li",ge,[e("div",fe,[ye,h(" "+m(s.item.command||"Нет команды"),1)])]),e("li",$e,[e("div",ke,[ve,h(" "+m(s.item.slug||"Slug"),1)])]),e("li",Fe,[e("div",we,[Ce,h(" "+m(s.item.comment||"Пояснение не указано"),1)])]),s.item.config?(l(),i("li",Se,[e("div",Ve,[je,s.item.config?(l(!0),i(b,{key:0},f(s.item.config,n=>(l(),i("p",null,[e("strong",null,m(n.key||"Ключ не найден")+":",1),h(m(n.value||"Не указано"),1)]))),256)):r("",!0)])])):r("",!0),s.item.page?(l(),i("li",Pe,Be)):r("",!0),s.item.is_global?(l(),i("li",Oe,Ie)):r("",!0),e("li",De,[e("div",qe,[e("form",{onSubmit:o[6]||(o[6]=S((...n)=>t.submitRelocateData&&t.submitRelocateData(...n),["prevent"]))},[Le,c(e("select",{class:"form-control w-100","onUpdate:modelValue":o[5]||(o[5]=n=>t.selected_slug_id=n),required:""},[Re,(l(!0),i(b,null,f(t.slugs,n=>(l(),i("option",{value:n.id},"#"+m(n.id)+" "+m(n.slug||"Не указан"),9,Ge))),256))],512),[[j,t.selected_slug_id]]),Me,e("button",{disabled:t.selected_slug_id==null,class:"btn btn-outline-warning w-100"}," Выполнить перенос ",8,Ae)],32)])])]))])])])],2),e("div",{class:"modal fade",id:"edit-slug-"+s.item.id,tabindex:"-1"},[e("div",ze,[e("div",Ee,[e("div",Ne,[e("h5",Ye,[h("Редактирование команды #"),e("span",null,m(s.item.id),1)]),We]),e("div",Je,[t.load?r("",!0):(l(),v(R,{key:0,item:s.item,onCallback:t.slugFormCallback},null,8,["item","onCallback"]))]),He])])],8,Ke)],64))}}),Ze={key:0,class:"row"},xe={class:"col-12 mb-2"},et={key:0},tt=e("i",{class:"fa-solid fa-scroll"},null,-1),st={key:1},ot=e("i",{class:"fa-regular fa-square-minus"},null,-1),lt={key:0,class:"col-12"},it={class:"col-12"},nt={class:"form-floating mb-3"},at=e("label",{for:"floatingInput"},"Быстрый поиск команды",-1),dt={class:"col-12 mb-2"},rt={class:"form-check"},ct={class:"form-check-label",for:"need_global"},ut={key:0},ht={key:1},mt={class:"form-check"},_t=e("label",{class:"form-check-label",for:"need_show_deleted"}," Удаленные ",-1),pt={key:1,class:"mb-3 col-12 col-sm-12"},bt={class:"table"},gt=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"Команда"),e("th",{scope:"col"},"Пояснение"),e("th",{scope:"col"},"Глобальный"),e("th",{scope:"col"},"Действия")])],-1),ft=["onClick"],yt={key:0},$t=e("i",{class:"fa-solid fa-check text-success"},null,-1),kt=[$t],vt={key:1},Ft=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),wt=[Ft],Ct={class:"dropdown"},St=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),Vt={class:"dropdown-menu"},jt={key:0},Pt=["onClick"],Ut=e("i",{class:"fa-solid fa-arrow-left mr-1"},null,-1),Bt={key:1},Ot=["onClick"],Tt=e("a",{class:"dropdown-item cursor-pointer","data-bs-toggle":"modal","data-bs-target":"#edit-table-slug"},[e("i",{class:"fa-regular fa-pen-to-square mr-1"}),h(" Редактировать")],-1),It=[Tt],Dt=["onClick"],qt=e("i",{class:"fa-solid fa-clone mr-1"},null,-1),Lt=["href"],Rt=e("i",{class:"fa-regular fa-file-excel mr-1"},null,-1),Gt={key:2},Mt=["onClick"],At=e("i",{class:"fa-regular fa-trash-can text-danger mr-1"},null,-1),Kt={key:3},zt=["onClick"],Et=e("i",{class:"fa-regular fa-trash-can text-danger mr-1"},null,-1),Nt={key:3,class:"mb-3 col-md-12"},Yt=e("div",{class:"alert alert-danger",role:"alert"}," У Вас еще нет добавленных скриптов! ",-1),Wt=[Yt],Jt={class:"modal fade",id:"edit-table-slug",tabindex:"-1"},Ht={class:"modal-dialog modal-fullscreen"},Qt={key:0,class:"modal-content"},Xt={class:"modal-header"},Zt={class:"modal-title",id:"exampleModalLabel"},xt=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),es={class:"modal-body"},ts={class:"row"},ss={class:"col-8"},os={class:"col-4"},ls={class:"list-group list-group-numbered"},is={key:0,class:"list-group-item d-flex justify-content-between align-items-start"},ns={class:"ms-2 me-auto"},as=e("div",{class:"fw-bold"},"Набор параметров скрипта",-1),ds={key:1},rs={key:1,class:"list-group-item d-flex justify-content-between align-items-start"},cs=e("div",{class:"ms-2 me-auto"},[e("div",{class:"fw-bold"},"Привязана страница")],-1),us=[cs],hs={key:2,class:"list-group-item d-flex justify-content-between align-items-start"},ms=e("div",{class:"ms-2 me-auto"},[e("div",{class:"fw-bold"},"Является глобальным скриптом")],-1),_s=[ms],ps={class:"list-group-item d-flex justify-content-between align-items-start"},bs={class:"ms-2 me-auto w-100"},gs=e("div",{class:"fw-bold"},"Перенести данные из:",-1),fs=e("option",{value:null},"Не выбрано",-1),ys=["value"],$s=e("p",{class:"my-2"},[e("em",null,"Перенос данных затирает текущие данные в данном скрипте")],-1),ks=["disabled"],vs=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),Fs={props:["command","canSelect"],data(){return{bot:null,relocated_slug_id:null,need_global:!0,need_show_deleted:!0,show:!1,load:!1,slugs:[],paginate:[],selectedSlug:null,ownSearch:null,slugForm:{command:null,comment:null,slug:null}}},watch:{ownSearch:function(s,t){this.loadSlugs()},need_global:function(s,t){this.loadSlugs()},need_show_deleted:function(s,t){this.loadSlugs()}},computed:{...C(["getCurrentBot","getSlugs","getSlugsPaginateObject"])},mounted(){this.loadCurrentBot().then(()=>{this.loadSlugs(),this.command&&this.$nextTick(()=>{this.slugForm.command=this.command})})},methods:{nextSlugs(s){this.loadSlugs(s)},loadSlugs(s=0){this.$store.dispatch("loadSlugs",{dataObject:{botId:this.bot.id,needGlobal:this.need_global,needDeleted:this.need_show_deleted,search:this.ownSearch},page:s}).then(t=>{this.slugs=this.getSlugs,this.paginate=this.getSlugsPaginateObject})},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},callbackSlugs(){this.loadSlugs()},selectSlug(s){this.load=!0,this.$nextTick(()=>{this.selectedSlug=s,this.load=!1}),this.$emit("select",s)},selectCard(){this.$emit("select",this.item)},slugFormCallback(){this.load=!0,this.$emit("callback"),this.$nextTick(()=>{this.load=!1})},editSlug(){this.load=!0,this.$nextTick(()=>{this.load=!1})},duplicateSlug(s){this.load=!0,this.$store.dispatch("duplicateSlug",{dataObject:{slugId:s.id}}).then(t=>{this.$notify({title:"Конструктор команд",text:"Команда успешно продублирована",type:"success"}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}).catch(t=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}),this.loadSlugs(),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})},submitRelocateData(){this.$store.dispatch("relocateSlugActionData",{slug_sender_id:this.relocated_slug_id,slug_recipient_id:this.item.id,bot_id:this.bot.id}).then(s=>{this.$notify({title:"Конструктор команд",text:"Данные команды успешно перенесены",type:"success"})}).catch(s=>{this.$notify({title:"Конструктор команд",text:"Ошибка переноса данных",type:"error"})})},restoreSlug(s){this.load=!0,this.$store.dispatch("restoreSlug",{dataObject:{slugId:s.id}}).then(t=>{this.$notify({title:"Конструктор команд",text:"Команда успешно восстановлена",type:"success"}),this.loadSlugs(),this.$nextTick(()=>{this.load=!1})}).catch(t=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})})},removeSlug(s){this.load=!0,this.$store.dispatch("removeSlug",{dataObject:{slugId:s.id}}).then(t=>{this.$notify({title:"Конструктор команд",text:"Команда успешно удалена",type:"success"}),this.loadSlugs()}).catch(t=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})})}}},_$=Object.assign(Fs,{__name:"BotSlugTableList",setup(s){return(t,o)=>(l(),i(b,null,[t.bot?(l(),i("div",Ze,[e("div",xe,[e("button",{type:"button",onClick:o[0]||(o[0]=n=>t.show=!t.show),class:"btn btn-outline-success p-3 w-100"},[t.show?(l(),i("span",st,[ot,h(" Свернуть форму добавления")])):(l(),i("span",et,[tt,h(" Добавить глобальный скрипт")]))])]),t.show?(l(),i("div",lt,[t.bot?(l(),v(z,{key:0,"can-add":!0,bot:t.bot,onCallback:t.loadSlugs},null,8,["bot","onCallback"])):r("",!0)])):r("",!0),e("div",it,[e("div",nt,[c(e("input",{type:"search","onUpdate:modelValue":o[1]||(o[1]=n=>t.ownSearch=n),class:"form-control",id:"floatingInput",placeholder:"name@example.com"},null,512),[[p,t.ownSearch]]),at])]),e("div",dt,[e("div",rt,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[2]||(o[2]=n=>t.need_global=n),type:"checkbox",id:"need_global"},null,512),[[k,t.need_global]]),e("label",ct,[t.need_global?(l(),i("span",ut,"Глобальные")):(l(),i("span",ht,"Локальные"))])]),e("div",mt,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[3]||(o[3]=n=>t.need_show_deleted=n),type:"checkbox",id:"need_show_deleted"},null,512),[[k,t.need_show_deleted]]),_t])]),t.slugs&&t.bot?(l(),i("div",pt,[e("table",bt,[gt,e("tbody",null,[(l(!0),i(b,null,f(t.slugs,(n,d)=>(l(),i("tr",{class:F({"border-info":n.deleted_at==null,"border-danger":n.deleted_at!=null})},[e("th",{scope:"row",class:F({"text-danger":n.deleted_at!=null})},m(n.id||"Нет идентификатора"),3),e("td",{onClick:a=>t.selectSlug(n),"data-bs-toggle":"modal","data-bs-target":"#edit-table-slug",class:F({"text-danger":n.deleted_at!=null})},m(n.command||"Нет команды"),11,ft),e("td",{class:F({"text-danger":n.deleted_at!=null})},m(n.comment||"Пояснение не указано"),3),e("td",null,[n.is_global?(l(),i("span",yt,kt)):(l(),i("span",vt,wt))]),e("td",null,[e("div",Ct,[St,e("ul",Vt,[s.canSelect?(l(),i("li",jt,[e("a",{onClick:a=>t.selectSlug(n),title:"Выбрать команду",class:"dropdown-item cursor-pointer"},[Ut,h(" Выбрать команду ")],8,Pt)])):r("",!0),s.canSelect?(l(),i("hr",Bt)):r("",!0),e("li",{onClick:a=>t.selectSlug(n)},It,8,Ot),e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:a=>t.duplicateSlug(n)},[qt,h(" Дублировать")],8,Dt)]),e("li",null,[e("a",{class:"dropdown-item cursor-pointer",target:"_blank",href:"/admin/slugs/action-data-export/"+n.id},[Rt,h(" Скачать данные участников")],8,Lt)]),n.deleted_at==null?(l(),i("li",Gt,[e("a",{class:"dropdown-item cursor-pointer",onClick:a=>t.removeSlug(n)},[At,h(" Удалить")],8,Mt)])):r("",!0),n.deleted_at!=null?(l(),i("li",Kt,[e("a",{class:"dropdown-item cursor-pointer",onClick:a=>t.restoreSlug(n)},[Et,h(" Восстановить")],8,zt)])):r("",!0)])])])],2))),256))])])])):r("",!0),t.paginate?(l(),v(V,{key:2,onPagination_page:t.nextSlugs,pagination:t.paginate},null,8,["onPagination_page","pagination"])):r("",!0),t.slugs.length===0?(l(),i("div",Nt,Wt)):r("",!0)])):r("",!0),e("div",Jt,[e("div",Ht,[t.selectedSlug&&!t.load?(l(),i("div",Qt,[e("div",Xt,[e("h5",Zt,[h("Редактирование команды #"),e("span",null,m(t.selectedSlug.id),1)]),xt]),e("div",es,[e("div",ts,[e("div",ss,[$(R,{item:t.selectedSlug,onCallback:t.slugFormCallback},null,8,["item","onCallback"])]),e("div",os,[e("ol",ls,[t.selectedSlug.config?(l(),i("li",is,[e("div",ns,[as,(t.selectedSlug.config||[]).length>0?(l(!0),i(b,{key:0},f(t.selectedSlug.config,n=>(l(),i("p",null,[e("strong",null,m(n.key||"Ключ не найден")+":",1),h(m(n.value||"Не указано"),1)]))),256)):(l(),i("p",ds,"Отсутствует"))])])):r("",!0),t.selectedSlug.page?(l(),i("li",rs,us)):r("",!0),t.selectedSlug.is_global?(l(),i("li",hs,_s)):r("",!0),e("li",ps,[e("div",bs,[e("form",{onSubmit:o[5]||(o[5]=S((...n)=>t.submitRelocateData&&t.submitRelocateData(...n),["prevent"]))},[gs,c(e("select",{class:"form-control w-100","onUpdate:modelValue":o[4]||(o[4]=n=>t.relocated_slug_id=n),required:""},[fs,(l(!0),i(b,null,f(t.slugs,n=>(l(),i("option",{value:n.id},"#"+m(n.id)+" "+m(n.slug||"Не указан"),9,ys))),256))],512),[[j,t.relocated_slug_id]]),$s,e("button",{disabled:t.relocated_slug_id==null,class:"btn btn-outline-warning w-100"}," Выполнить перенос ",8,ks)],32)])])])])])]),vs])):r("",!0)])])],64))}}),ws={class:"row"},Cs={class:"input-group mb-3"},Ss={key:0,class:"row"},Vs={class:"col-12 col-md-12 mb-3"},js={class:"table"},Ps=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"Ф.И.О. из телеграмма"),e("th",{scope:"col"},"Имя пользователя"),e("th",{scope:"col"},"Домен"),e("th",{scope:"col"},"Телефон"),e("th",{scope:"col"},"TG id"),e("th",{scope:"col"},"Админ"),e("th",{scope:"col"},"VIP"),e("th",{scope:"col"},"Доставщик"),e("th",{scope:"col"},"Менеджер"),e("th",{scope:"col"},"За работой")])],-1),Us={scope:"row"},Bs=["href"],Os={key:1},Ts=["onClick"],Is=e("i",{class:"fa-solid fa-check text-success"},null,-1),Ds=[Is],qs=["onClick"],Ls=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Rs=[Ls],Gs=["onClick"],Ms=e("i",{class:"fa-solid fa-check text-success"},null,-1),As=[Ms],Ks=["onClick"],zs=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Es=[zs],Ns=["onClick"],Ys=e("i",{class:"fa-solid fa-check text-success"},null,-1),Ws=[Ys],Js=["onClick"],Hs=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Qs=[Hs],Xs=["onClick"],Zs=e("i",{class:"fa-solid fa-check text-success"},null,-1),xs=[Zs],eo=["onClick"],to=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),so=[to],oo=["onClick"],lo=e("i",{class:"fa-solid fa-check text-success"},null,-1),io=[lo],no=["onClick"],ao=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),ro=[ao],co={class:"col-12"},uo={key:1,class:"row"},ho=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет пользователей ")],-1),mo=[ho],_o={data(){return{bot:null,loading:!0,bot_users:[],search:null,bot_users_paginate_object:null}},computed:{...C(["getBotUsers","getBotUsersPaginateObject","getCurrentBot"])},mounted(){this.loadCurrentBot().then(()=>{this.loadUsers()})},methods:{loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},changeUserStatus(s,t,o="is_admin"){this.bot_users[s][o]=t===1,this.$store.dispatch("changeUserStatus",{dataObject:{bot_user_id:this.bot_users[s].id,status:t,type:o}}).then(()=>{this.$notify({title:"Конструктор ботов",text:"Статус пользователя успешно изменен! Пользователь оповещен об изменении статуса!",type:"success"})}).catch(()=>{this.$notify({title:"Конструктор ботов",text:"Ошибка изменения статуса",type:"error"})})},nextUsers(s){this.loadUsers(s)},loadUsers(s=0){this.loading=!0,this.$store.dispatch("loadBotUsers",{dataObject:{botId:this.bot.id||null,search:this.search},size:100,page:s}).then(t=>{this.loading=!1,this.bot_users=this.getBotUsers,this.bot_users_paginate_object=this.getBotUsersPaginateObject}).catch(()=>{this.loading=!1})}}},p$=Object.assign(_o,{__name:"BotUserList",setup(s){return(t,o)=>(l(),i(b,null,[e("div",ws,[e("div",Cs,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск пользователя","aria-label":"Поиск пользователя",onKeydown:o[0]||(o[0]=K(n=>t.loadUsers(0),["enter"])),"onUpdate:modelValue":o[1]||(o[1]=n=>t.search=n)},null,544),[[p,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[2]||(o[2]=n=>t.loadUsers(0)),type:"button",id:"button-addon2"},"Найти ")])]),t.bot_users.length>0?(l(),i("div",Ss,[e("div",Vs,[e("table",js,[Ps,e("tbody",null,[(l(!0),i(b,null,f(t.bot_users,(n,d)=>(l(),i("tr",null,[e("th",Us,m(n.id),1),e("td",null,m(n.fio_from_telegram||"Не указано"),1),e("td",null,m(n.name||"Не указано"),1),e("td",null,[n.username?(l(),i("a",{key:0,href:"https://t.me/"+n.username,target:"_blank"},"@"+m(n.username),9,Bs)):(l(),i("span",Os,"Не указано"))]),e("td",null,m(n.phone||"Не указано"),1),e("td",null,m(n.telegram_chat_id||"Не указано"),1),e("td",null,[n.is_admin?(l(),i("span",{key:0,onClick:a=>t.changeUserStatus(d,0,"is_admin")},Ds,8,Ts)):(l(),i("span",{key:1,onClick:a=>t.changeUserStatus(d,1,"is_admin")},Rs,8,qs))]),e("td",null,[n.is_vip?(l(),i("span",{key:0,onClick:a=>t.changeUserStatus(d,0,"is_vip")},As,8,Gs)):(l(),i("span",{key:1,onClick:a=>t.changeUserStatus(d,1,"is_vip")},Es,8,Ks))]),e("td",null,[n.is_deliveryman?(l(),i("span",{key:0,onClick:a=>t.changeUserStatus(d,0,"is_deliveryman")},Ws,8,Ns)):(l(),i("span",{key:1,onClick:a=>t.changeUserStatus(d,1,"is_deliveryman")},Qs,8,Js))]),e("td",null,[n.is_manager?(l(),i("span",{key:0,onClick:a=>t.changeUserStatus(d,0,"is_manager")},xs,8,Xs)):(l(),i("span",{key:1,onClick:a=>t.changeUserStatus(d,1,"is_manager")},so,8,eo))]),e("td",null,[n.is_work?(l(),i("span",{key:0,onClick:a=>t.changeUserStatus(d,0,"is_work")},io,8,oo)):(l(),i("span",{key:1,onClick:a=>t.changeUserStatus(d,1,"is_work")},ro,8,no))])]))),256))])])]),e("div",co,[t.bot_users_paginate_object?(l(),v(V,{key:0,onPagination_page:t.nextUsers,pagination:t.bot_users_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",uo,mo))],64))}});const po={props:["param"],data(){return{search:null,descriptions:[]}},computed:{filteredDescription(){return this.search?this.descriptions.filter(s=>s.text.indexOf(this.search)!==-1):this.descriptions}},mounted(){this.loadDescription()},methods:{select(s){this.$emit("callback",{param:this.param,text:s})},loadDescription(){this.$store.dispatch("loadDescription").then(s=>{this.descriptions=s.data})}}},bo={class:"dropdown"},go=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-spell-check"})],-1),fo={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},yo=e("div",{class:"dropdown-divider"},null,-1),$o=["onClick"];function ko(s,t,o,n,d,a){return l(),i("div",bo,[go,e("div",fo,[c(e("input",{type:"search",class:"form-control",id:"search-description-text","onUpdate:modelValue":t[0]||(t[0]=_=>d.search=_),placeholder:"Введите текст для поиска"},null,512),[[p,d.search]]),yo,(l(!0),i(b,null,f(a.filteredDescription,(_,u)=>(l(),i("p",{class:"p-1 text-left w-100",onClick:g=>a.select(_.text)},m(_.text),9,$o))),256))])])}const D=P(po,[["render",ko]]);const vo={class:"row"},Fo={class:"col-md-12 col-12"},wo={class:"form-check mb-3"},Co=["value"],So=e("label",{class:"form-check-label",for:"bot-is-template"}," Сделать шаблоном ",-1),Vo={key:0,class:"col-md-12 col-12"},jo={class:"mb-3"},Po={class:"form-label",id:"bot-template-description"},Uo=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Bo=e("div",null,"Если Вы создаете шаблон, а не реального бота ",-1),Oo=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),To={class:"row"},Io=e("div",{class:"col-12"},[e("p",null,[h("Для создания бота в Телеграм воспользуйтесь "),e("a",{href:"https://telegra.ph/Sozdanie-telegram-bota-06-12",target:"_blank"},"инструкцией")])],-1),Do={class:"col-md-12 col-12"},qo={class:"mb-3"},Lo={class:"form-label d-flex justify-content-between",id:"bot-token"},Ro=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Go=e("div",null,"Взять из BotFather при создании бота! Длинная нечитаемая подсвеченная строка! ",-1),Mo=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Ao=e("a",{href:"https://t.me/botfather",target:"_blank"},"Создать нового бота в ТГ",-1),Ko={key:0,class:"col-12"},zo={class:"mb-3"},Eo={class:"form-label",id:"bot-domain"},No=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Yo=e("div",null,'Строго взять из BotFather! ТО что при создании с окончанием на "bot"',-1),Wo=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Jo={key:0},Ho=["href"],Qo={key:1,class:"col-12"},Xo={class:"card"},Zo={class:"card-body"},xo=e("h6",null,"Настройка параметров бота в BotFather",-1),el={class:"mb-3"},tl={class:"form-label d-flex justify-content-between align-items-center",id:"bot-title"},sl={key:0,class:"text-secondary"},ol={class:"mb-3"},ll={class:"form-label d-flex justify-content-between align-items-center",id:"bot-short-description"},il={key:0,class:"text-secondary"},nl={class:"mb-3"},al={class:"form-label d-flex justify-content-between align-items-center",id:"bot-long-description"},dl={key:0,class:"text-secondary"},rl={class:"col-5"},cl={class:"mb-3"},ul=["onUpdate:modelValue","aria-describedby"],hl={class:"col-5"},ml={class:"mb-3"},_l=["onUpdate:modelValue","aria-describedby"],pl={class:"col-2"},bl=["onClick"],gl=e("i",{class:"fa-regular fa-trash-can"},null,-1),fl=[gl],yl={class:"row"},$l={class:"col-12"},kl={key:2,class:"col-md-6 col-12"},vl={class:"mb-3"},Fl={class:"d-flex justify-content-between align-items-center"},wl={class:"form-label d-flex justify-content-between",id:"bot-order-channel"},Cl=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Sl=e("div",null,"Ввести адрес ссылки на канал в форму после добавления тоукена ",-1),Vl=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),jl={key:3,class:"col-md-6 col-12"},Pl={class:"mb-3"},Ul={class:"d-flex justify-content-between"},Bl=e("label",{class:"form-label",id:"bot-main-channel"},"Канал для постов (id,рекламный)",-1),Ol={key:4,class:"col-12 mb-2"},Tl={class:"form-check"},Il=e("label",{class:"form-check-label",for:"need-payments"}," Необходимо добавить рассылку по топикам для канала заказов (он же системный канал) ",-1),Dl={key:5,class:"col-12 mb-2"},ql={class:"d-flex justify-content-between align-items-center mb-2"},Ll=e("p",null,'Для того, чтоб узнать идентификатор топика в группе впишите в чат "Мой id"',-1),Rl=e("i",{class:"fa-solid fa-paperclip mr-2"},null,-1),Gl={class:"list-group"},Ml={class:"list-group-item"},Al={class:"mb-0"},Kl=["onUpdate:modelValue"],zl={key:0,class:"row"},El={class:"col-12"},Nl={class:"mb-3"},Yl={class:"d-flex justify-content-between"},Wl={class:"form-label",id:"bot-description"},Jl=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Hl=e("div",null,"Отобразится пользователю при первом запуске",-1),Ql=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Xl={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},Zl={class:"col-12"},xl={class:"mb-3"},ei={class:"d-flex justify-content-between"},ti={class:"form-label",id:"bot-description"},si=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),oi=e("div",null,'Для меню "О Боте"',-1),li=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),ii={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},ni={class:"col-12"},ai={class:"mb-3"},di={class:"d-flex justify-content-between"},ri={class:"form-label",id:"bot-maintenance-message"},ci=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),ui={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},hi={class:"col-md-6 col-12"},mi={class:"mb-3"},_i={class:"form-label",id:"bot-balance"},pi=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),bi=e("div",null,"Начальная сумма денег на счету у конкретного бота",-1),gi=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),fi={class:"col-md-6 col-12"},yi={class:"mb-3"},$i={class:"form-label",id:"bot-tax-per-day"},ki=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),vi=e("div",null,"Сумма списания денег за сутки работы бота (тариф)",-1),Fi=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),wi={class:"col-md-6 col-12"},Ci={class:"mb-3"},Si=e("label",{class:"form-label",id:"bot-level-1"},[h(" Уровень 1 CashBack, % "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),Vi={class:"col-md-6 col-12"},ji={class:"mb-3"},Pi=e("label",{class:"form-label",id:"bot-level-2"},"Уровень 2 CashBack, %",-1),Ui={class:"col-md-6 col-12"},Bi={class:"mb-3"},Oi=e("label",{class:"form-label",id:"bot-level-3"},"Уровень 3 CashBack, %",-1),Ti={class:"col-md-12 col-12"},Ii={class:"mb-3"},Di=e("label",{class:"form-label",id:"cashback-fired-period"},"Период сгорания CashBack",-1),qi=["value"],Li={key:0,class:"mb-3"},Ri=e("label",{class:"form-label",id:"cashback-fired-level"},"Уровень сгорания CashBack, %",-1),Gi={class:"mb-2"},Mi={class:"form-check"},Ai=e("label",{class:"form-check-label",for:"need-cashback-config"}," Необходимо настроить CashBack по категориям ",-1),Ki={key:0,class:"mb-2"},zi=e("h6",null,"Настройка категорий CashBack-а",-1),Ei={class:"d-flex justify-content-between align-items-center w-100"},Ni=e("small",null,"Название категории",-1),Yi=["onClick"],Wi=e("i",{class:"fa-regular fa-trash-can"},null,-1),Ji=[Wi],Hi=["onUpdate:modelValue","aria-describedby"],Qi=e("div",{class:"divider divider-small my-3 bg-highlight"},null,-1),Xi={class:"col-md-12 col-12 mb-2"},Zi={class:"card border-warning"},xi={class:"card-body"},en={class:"form-group"},tn=e("label",{class:"form-check-label",for:"warning-rules"},[e("i",{class:"fa-solid fa-triangle-exclamation text-danger"}),h(" Правила критических оповещений ")],-1),sn=e("option",{value:null},"Не выбрано",-1),on=["value"],ln={class:"card my-2 p-2"},nn={class:"row"},an={class:"col-md-4 d-flex align-items-center"},dn={class:"m-0"},rn={class:"col-md-2"},cn={class:"form-check"},un=["onUpdate:modelValue","id"],hn=["for"],mn={key:0},_n={key:1},pn={class:"col-md-5"},bn=["onUpdate:modelValue"],gn={class:"col-md-1 d-flex justify-content-center"},fn=["onClick"],yn=e("i",{class:"fa-solid fa-trash-can"},null,-1),$n=[yn],kn={class:"col-12 mb-2"},vn={class:"form-check"},Fn=e("label",{class:"form-check-label",for:"need-payments"}," Необходимо подключить платежную систему ",-1),wn={key:1,class:"col-md-12 col-12"},Cn={class:"form-check mb-3"},Sn=["value"],Vn=e("label",{class:"form-check-label",for:"bot-auto-cashback-on-payments"}," Начислять CashBack автоматически после успешной оплаты ",-1),jn={class:"mb-3"},Pn=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Un=e("div",null,"Если в боте планируется оплата, то необходимо через BotFather привязать нужную платежную систему и указать в данном поле полученный токен ",-1),Bn=e("label",{class:"form-label",id:"payment_provider_token"},[h("Токен платежной системы "),e("a",{href:"https://t.me/botfather",target:"_blank"},"Подключить")],-1),On={class:"col-12 mb-2"},Tn={class:"form-check"},In=e("label",{class:"form-check-label",for:"need-shop"}," Необходимо интегрировать магазин в бота ",-1),Dn={key:2,class:"col-md-12 col-12"},qn={class:"mb-3"},Ln=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Rn=e("div",null,"Ссылка на страницу ВК с товарами для вашего магазина в боте ",-1),Gn=e("label",{class:"form-label",id:"bot-vk_shop_link"},[h("Ссылка на группу ВК с товарами "),e("a",{href:"https://vk.com/groups?w=groups_create",target:"_blank"},"Создать")],-1),Mn={class:"col-md-12 col-12"},An={class:"mb-3"},Kn=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),zn=e("div",null,"Ссылка на внешний сервис обработки данных ",-1),En=e("label",{class:"form-label",id:"callback_link"},"Ссылка на внешний сервис обработки данных ",-1),Nn={class:"col-12"},Yn={class:"card mb-3"},Wn=e("div",{class:"card-header"},[e("h6",null,[h("Информационная ссылка: создайте контент в "),e("a",{target:"_blank",href:"https://telegra.ph"},"https://telegra.ph")])],-1),Jn={class:"card-body"},Hn=e("div",{class:"row"},[e("div",{class:"col-12"},[e("h6",null,"Ссылка")])],-1),Qn={class:"row"},Xn={class:"col-12"},Zn={class:"mb-3"},xn={class:"col-12"},ea={class:"card mb-3"},ta=e("div",{class:"card-header"},[e("h6",null,"Ссылки на соц. сети")],-1),sa={class:"card-body"},oa=e("div",{class:"row"},[e("div",{class:"col-12"},[e("h6",null,"Ссылка")])],-1),la={class:"col-5"},ia={class:"mb-3"},na=["onUpdate:modelValue","aria-describedby"],aa={class:"col-5"},da={class:"mb-3"},ra=["onUpdate:modelValue","aria-describedby"],ca={class:"col-2"},ua=["onClick"],ha=e("i",{class:"fa-regular fa-trash-can"},null,-1),ma=[ha],_a={class:"row"},pa={class:"col-12"},ba={class:"col-12 mb-3"},ga=e("h6",null,[h("Аватар для бота "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),fa={class:"photo-preview d-flex justify-content-start flex-wrap w-100"},ya={for:"bot-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},$a=e("span",null,"+",-1),ka={class:"mb-2 img-preview",style:{"margin-right":"10px"}},va={class:"remove"},Fa=["onClick"],wa=e("i",{class:"fa-regular fa-trash-can"},null,-1),Ca=[wa],Sa={key:1,class:"mb-2 img-preview",style:{"margin-right":"10px"}},Va={class:"remove"},ja=e("i",{class:"fa-regular fa-trash-can"},null,-1),Pa=[ja],Ua={class:"row"},Ba={class:"col-12"},Oa=["disabled"],Ta={key:0},Ia={key:1},Da={props:["company","bot"],data(){return{selected_warning:null,page:null,step:0,templates:[],load:!1,loadPage:!1,needPageListUpdate:!1,need_threads:!1,need_cashback_config:!1,need_payments:!1,need_shop:!1,command:null,warnings:[{title:"Сумма чека больше чем",key:"bill_sum_more_then"},{title:"Сумма начисления кэшбэка больше чем",key:"cashback_up_sum_more_then"},{title:"Сумма списания кэшбэка больше чем",key:"cashback_down_sum_more_then"}],cashback_fire_periods:[{title:"Не сгорает",value:0},{title:"7 дней",value:7},{title:"15 дней",value:15},{title:"30 дней",value:30},{title:"60 дней",value:60},{title:"60 дней",value:90},{title:"120 дней",value:120},{title:"180 дней",value:180},{title:"360 дней",value:360}],botForm:{title:"",short_description:"",long_description:"",is_template:!1,auto_cashback_on_payments:!1,template_description:null,bot_domain:null,bot_token:null,bot_token_dev:null,order_channel:null,message_threads:null,cashback_config:null,main_channel:null,vk_shop_link:null,callback_link:null,balance:null,tax_per_day:null,welcome_message:null,image:null,cashback_fire_percent:0,cashback_fire_period:0,description:null,info_link:null,social_links:[],maintenance_message:null,payment_provider_token:null,level_1:10,level_2:0,level_3:0,photos:[],commands:null,selected_bot_template_id:null,pages:[],amo:null,warnings:[]}}},watch:{"botForm.bot_token":{handler(s){this.botForm.bot_token&&this.getMe()},deep:!0},need_threads:function(s,t){let o=[{title:"Отзывы",key:"reviews",value:null},{title:"Начисление cashback",key:"cashback",value:null},{title:"Вопросы",key:"questions",value:null},{title:"Конкурсы",key:"actions",value:null},{title:"Заказы",key:"orders",value:null},{title:"Вывод средств",key:"ask-money",value:null}];this.need_threads&&!this.botForm.message_threads&&(this.botForm.message_threads=o),this.need_threads&&this.botForm.message_threads&&o.forEach(n=>{this.botForm.message_threads.findIndex(a=>a.key===n.key)===-1&&this.botForm.message_threads.push(n)})},need_payments:function(s,t){this.need_payments||(this.botForm.auto_cashback_on_payments=!1)}},computed:{...C(["getSlugs"]),filteredWarnings(){return this.botForm.warnings.length===0?this.warnings:this.warnings.filter(s=>!(this.botForm.warnings.findIndex(t=>t.rule_key===s.key)>=0))}},mounted(){this.bot&&this.$nextTick(()=>{this.botForm={id:this.bot.id||null,title:this.bot.title||"",short_description:this.bot.short_description||"",long_description:this.bot.long_description||"",is_template:this.bot.is_template||!1,auto_cashback_on_payments:this.bot.auto_cashback_on_payments||!1,template_description:this.bot.template_description||null,bot_domain:this.bot.bot_domain||null,bot_token:this.bot.bot_token||null,bot_token_dev:this.bot.bot_token_dev||null,order_channel:this.bot.order_channel||null,message_threads:this.bot.message_threads||null,cashback_config:this.bot.cashback_config||null,main_channel:this.bot.main_channel||null,balance:this.bot.balance||null,tax_per_day:this.bot.tax_per_day||null,vk_shop_link:this.bot.vk_shop_link||null,callback_link:this.bot.callback_link||null,cashback_fire_percent:this.bot.cashback_fire_percent||0,cashback_fire_period:this.bot.cashback_fire_period||0,image:this.bot.image||null,commands:this.bot.commands||null,description:this.bot.description||null,info_link:this.bot.info_link||null,social_links:this.bot.social_links||[],maintenance_message:this.bot.maintenance_message||null,welcome_message:this.bot.welcome_message||null,payment_provider_token:this.bot.payment_provider_token||null,level_1:this.bot.level_1,level_2:this.bot.level_2,level_3:this.bot.level_3,photos:this.bot.photos||[],warnings:this.bot.warnings||[],amo:this.bot.amo||null},this.botForm.commands==null&&(this.botForm.commands=[{command:"/start",description:"начни с этой команды"},{command:"/admins",description:"доступные администраторы в системе"},{command:"/help",description:"как использовать систему"},{command:"/about",description:"о CashMan"}]),this.botForm.message_threads&&(this.need_threads=!0),this.botForm.payment_provider_token&&(this.need_payments=!0),this.botForm.cashback_config&&(this.need_cashback_config=!0)})},methods:{createBotTopics(){this.$store.dispatch("createBotTopics",{dataObject:{topics:this.botForm.message_threads,bot_id:this.bot.id}}).then(s=>{this.botForm.message_threads=s.data})},getMe(){this.$store.dispatch("getMe",{bot_token:this.botForm.bot_token}).then(s=>{this.botForm.bot_domain=s.username||null,this.botForm.title=s.first_name||null})},getChatLink(s){this.$store.dispatch("loadChatInfo",{dataObject:{chat_id:s,bot_id:this.bot.id}}).then(t=>{console.log("chat info",t)})},addTextTo(s={param:null,text:null}){this.botForm[s.param]=s.text},removeCommands(s){this.botForm.commands.splice(s,1)},addCommands(){this.botForm.commands||(this.botForm.commands=[]),this.botForm.commands.push({command:null,description:null})},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},onChangePhotos(s){const t=s.target.files;this.botForm.image=null;for(let o=0;o<t.length;o++)this.botForm.photos.push(t[o])},addItem(s){this.botForm[s].push("")},addSocialLinks(){this.botForm.social_links.push({title:null,url:null})},removeItem(s,t){this.botForm[s].splice(t,1)},removePhoto(s){s?this.botForm.photos.splice(s,1):this.botForm.image=null},addBot(){let s=new FormData;Object.keys(this.botForm).forEach(t=>{const o=this.botForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.company&&s.append("company_id",this.company.id);for(let t=0;t<this.botForm.photos.length;t++)s.append("images[]",this.botForm.photos[t]);s.delete("photos"),this.$store.dispatch(this.bot==null?"createBot":"updateBot",{botForm:s}).then(t=>{let o=t.data;console.log("bot",o),this.$emit("callback",o),this.$notify({title:"Конструктор ботов",text:this.bot==null?"Бот успешно создан!":"Бот успешно обновлен!",type:"success"}),this.$store.dispatch("updateBotWebhook",{dataObject:{bot_id:o.id}}),this.bot==null&&(this.botForm={title:"",short_description:"",long_description:"",is_template:!1,auto_cashback_on_payments:!1,template_description:null,bot_domain:null,bot_token:null,bot_token_dev:null,order_channel:null,message_threads:null,main_channel:null,balance:null,tax_per_day:null,callback_link:null,cashback_fire_percent:0,cashback_fire_period:0,image:null,description:null,info_link:null,social_links:[],maintenance_message:null,payment_provider_token:null,level_1:10,level_2:0,level_3:0,photos:[],warnings:[],selected_bot_template_id:null,pages:[]})}).catch(t=>{this.$notify({title:"Конструктор ботов",text:"Ошибочка...",type:"error"})})},removeCashBackConfig(s){this.botForm.cashback_config.splice(s,1)},addCashBackConfig(){this.botForm.cashback_config=this.botForm.cashback_config==null?[]:this.botForm.cashback_config,this.botForm.cashback_config.push({title:null})},getWarning(s){let t=this.warnings.find(o=>o.key===s);return t||{title:"Не найдено"}},removeWarning(s){this.botForm.warnings.splice(s,1)},addWarning(){const s=this.selected_warning;this.botForm.warnings.push({rule_key:s.key,rule_value:0,is_active:!0}),this.selected_warning=null}}},b$=Object.assign(Da,{__name:"BotForm",setup(s){return(t,o)=>{const n=U("Popper"),d=T("lazy");return l(),i("form",{class:"pb-5 mb-5",onSubmit:o[38]||(o[38]=S((...a)=>t.addBot&&t.addBot(...a),["prevent"]))},[e("div",vo,[e("div",Fo,[e("div",wo,[c(e("input",{class:"form-check-input",type:"checkbox",value:t.botForm.is_template,"onUpdate:modelValue":o[0]||(o[0]=a=>t.botForm.is_template=a),id:"bot-is-template"},null,8,Co),[[k,t.botForm.is_template]]),So])]),t.botForm.is_template?(l(),i("div",Vo,[e("div",jo,[e("label",Po,[$(n,null,{content:y(()=>[Bo]),default:y(()=>[Uo]),_:1}),h(" Название шаблона бота "),Oo]),c(e("input",{type:"text",class:"form-control",placeholder:"Название \\ описание шаблона","aria-label":"Описание шаблона","onUpdate:modelValue":o[1]||(o[1]=a=>t.botForm.template_description=a),maxlength:"255","aria-describedby":"bot-template-description",required:""},null,512),[[p,t.botForm.template_description]])])])):r("",!0)]),e("div",To,[Io,e("div",Do,[e("div",qo,[e("label",Lo,[e("div",null,[$(n,null,{content:y(()=>[Go]),default:y(()=>[Ro]),_:1}),h(" Токен бота "),Mo]),Ao]),c(e("input",{type:"text",class:"form-control",placeholder:"Токен","aria-label":"Токен","onUpdate:modelValue":o[2]||(o[2]=a=>t.botForm.bot_token=a),maxlength:"255","aria-describedby":"bot-token",required:""},null,512),[[p,t.botForm.bot_token]])])]),t.botForm.bot_token?(l(),i("div",Ko,[e("div",zo,[e("label",Eo,[$(n,null,{content:y(()=>[Yo]),default:y(()=>[No]),_:1}),h(" Доменное имя бота (загружается автоматически) "),Wo]),c(e("input",{type:"text",class:"form-control",placeholder:"Имя бота","aria-label":"Имя бота","onUpdate:modelValue":o[3]||(o[3]=a=>t.botForm.bot_domain=a),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[p,t.botForm.bot_domain]]),t.botForm.bot_domain?(l(),i("p",Jo,[h("Проверить работу бота "),e("a",{href:"https://t.me/"+t.botForm.bot_domain,target:"_blank"},"@"+m(t.botForm.bot_domain),9,Ho)])):r("",!0)])])):r("",!0),t.botForm.bot_token?(l(),i("div",Qo,[e("div",Xo,[e("div",Zo,[xo,e("div",el,[e("label",tl,[e("span",null,[h(" Название бота "),t.botForm.title.length>0?(l(),i("small",sl,"Длина текста "+m(t.botForm.title.length)+"/64",1)):r("",!0)])]),c(e("input",{type:"text",class:"form-control",placeholder:"Текст названия","aria-label":"Текст названия","onUpdate:modelValue":o[4]||(o[4]=a=>t.botForm.title=a),maxlength:"64","aria-describedby":"bot-title"},null,512),[[p,t.botForm.title]])]),e("div",ol,[e("label",ll,[e("span",null,[h(" Короткое описание бота "),t.botForm.short_description.length>0?(l(),i("small",il,"Длина текста "+m(t.botForm.short_description.length)+"/120",1)):r("",!0)])]),c(e("textarea",{class:"form-control",placeholder:"Короткий текст описания бота","aria-label":"Короткий текст описания бота","onUpdate:modelValue":o[5]||(o[5]=a=>t.botForm.short_description=a),maxlength:"120","aria-describedby":"bot-short-description"},`
                                `,512),[[p,t.botForm.short_description]])]),e("div",nl,[e("label",al,[e("span",null,[h(" Длинное описание бота "),t.botForm.long_description.length>0?(l(),i("small",dl,"Длина текста "+m(t.botForm.long_description.length)+"/512",1)):r("",!0)])]),c(e("textarea",{class:"form-control",placeholder:"Длинный текст описания бота","aria-label":"Длинный текст описания бота","onUpdate:modelValue":o[6]||(o[6]=a=>t.botForm.long_description=a),maxlength:"512","aria-describedby":"bot-long-description"},`
                                `,512),[[p,t.botForm.long_description]])]),(l(!0),i(b,null,f(t.botForm.commands,(a,_)=>(l(),i("div",{class:"row",key:"commands-"+_},[e("div",rl,[e("div",cl,[c(e("input",{type:"text",class:"form-control",placeholder:"Название команды","aria-label":"Название команды",maxlength:"255","onUpdate:modelValue":u=>t.botForm.commands[_].command=u,"aria-describedby":"bot-command-"+_,required:""},null,8,ul),[[p,t.botForm.commands[_].command]])])]),e("div",hl,[e("div",ml,[c(e("input",{type:"text",class:"form-control",placeholder:"Описание команды","aria-label":"Описание команды",maxlength:"255","onUpdate:modelValue":u=>t.botForm.commands[_].description=u,"aria-describedby":"bot-command-description-"+_,required:""},null,8,_l),[[p,t.botForm.commands[_].description]])])]),e("div",pl,[e("button",{type:"button",onClick:u=>t.removeCommands(_),class:"btn btn-outline-danger w-100"},fl,8,bl)])]))),128)),e("div",yl,[e("div",$l,[e("button",{type:"button",onClick:o[7]||(o[7]=a=>t.addCommands()),class:"btn btn-outline-success w-100"},"Добавить еще команду ")])])])])])):r("",!0),t.botForm.bot_token?(l(),i("div",kl,[e("div",vl,[e("div",Fl,[e("label",wl,[e("div",null,[$(n,null,{content:y(()=>[Sl]),default:y(()=>[Cl]),_:1}),h(" Канал для заказов (id) "),Vl])]),$(B,{token:t.botForm.bot_token,param:"order_channel",onCallback:t.addTextTo},null,8,["token","onCallback"])]),c(e("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":o[8]||(o[8]=a=>t.botForm.order_channel=a),maxlength:"255","aria-describedby":"bot-order-channel"},null,512),[[p,t.botForm.order_channel]]),e("small",null,[e("a",{onClick:o[9]||(o[9]=a=>t.getChatLink(t.botForm.order_channel)),href:"javascript:void(0)"},"Узнать ссылку"),h("(будет отправлена в бота)")])])])):r("",!0),t.botForm.bot_token?(l(),i("div",jl,[e("div",Pl,[e("div",Ul,[Bl,$(B,{token:t.botForm.bot_token,param:"main_channel",onCallback:t.addTextTo},null,8,["token","onCallback"])]),c(e("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":o[10]||(o[10]=a=>t.botForm.main_channel=a),maxlength:"255","aria-describedby":"bot-main-channel"},null,512),[[p,t.botForm.main_channel]]),e("small",null,[e("a",{onClick:o[11]||(o[11]=a=>t.getChatLink(t.botForm.main_channel)),href:"javascript:void(0)"},"Узнать ссылку"),h("(будет отправлена в бота)")])])])):r("",!0),t.botForm.order_channel&&t.botForm.bot_token?(l(),i("div",Ol,[e("div",Tl,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[12]||(o[12]=a=>t.need_threads=a),type:"checkbox",id:"need-payments"},null,512),[[k,t.need_threads]]),Il])])):r("",!0),t.need_threads&&t.botForm.order_channel?(l(),i("div",Dl,[e("div",ql,[Ll,e("a",{class:"btn btn-outline-info",onClick:o[13]||(o[13]=(...a)=>t.createBotTopics&&t.createBotTopics(...a)),href:"javascript:void(0)"},[Rl,h("Создать топики автоматически ")])]),e("ul",Gl,[(l(!0),i(b,null,f(t.botForm.message_threads,(a,_)=>(l(),i("li",Ml,[e("p",Al,m(a.title)+" ("+m(a.key)+")",1),c(e("input",{type:"number",class:"form-control",min:"0",max:"10000",placeholder:"Идентификатор топика","onUpdate:modelValue":u=>t.botForm.message_threads[_].value=u},null,8,Kl),[[p,t.botForm.message_threads[_].value]])]))),256))])])):r("",!0)]),t.botForm.bot_token?(l(),i("div",zl,[e("div",El,[e("div",Nl,[e("div",Yl,[e("label",Wl,[$(n,null,{content:y(()=>[Hl]),default:y(()=>[Jl]),_:1}),h(" Приветственное сообщение "),Ql,t.botForm.welcome_message?(l(),i("small",Xl," Длина текста "+m(t.botForm.welcome_message.length),1)):r("",!0)]),$(D,{param:"welcome_message",onCallback:t.addTextTo},null,8,["onCallback"])]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текстовое приветствие при запуске бота","aria-label":"Текстовое приветствие при запуске бота","onUpdate:modelValue":o[14]||(o[14]=a=>t.botForm.welcome_message=a),"aria-describedby":"bot-description",required:""},`
                    `,512),[[p,t.botForm.welcome_message]])])]),e("div",Zl,[e("div",xl,[e("div",ei,[e("label",ti,[$(n,null,{content:y(()=>[oi]),default:y(()=>[si]),_:1}),h(" Описание бота "),li,t.botForm.description?(l(),i("small",ii," Длина текста "+m(t.botForm.description.length),1)):r("",!0)]),$(D,{param:"description",onCallback:t.addTextTo},null,8,["onCallback"])]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текстовое описание бота","aria-label":"Текстовое описание бота","onUpdate:modelValue":o[15]||(o[15]=a=>t.botForm.description=a),"aria-describedby":"bot-description",required:""},`
                    `,512),[[p,t.botForm.description]])])]),e("div",ni,[e("div",ai,[e("div",di,[e("label",ri,[h("Сообщение для режима тех. работ "),ci,t.botForm.maintenance_message?(l(),i("small",ui," Длина текста "+m(t.botForm.maintenance_message.length),1)):r("",!0)]),$(D,{param:"maintenance_message",onCallback:t.addTextTo},null,8,["onCallback"])]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текстовое сообщение","aria-label":"Текстовое сообщение","onUpdate:modelValue":o[16]||(o[16]=a=>t.botForm.maintenance_message=a),maxlength:"255","aria-describedby":"bot-maintenance-message",required:""},`
                    `,512),[[p,t.botForm.maintenance_message]])])]),e("div",hi,[e("div",mi,[e("label",_i,[$(n,null,{content:y(()=>[bi]),default:y(()=>[pi]),_:1}),h(" Баланс бота, руб "),gi]),c(e("input",{type:"number",class:"form-control",placeholder:"Баланс","aria-label":"Баланс","onUpdate:modelValue":o[17]||(o[17]=a=>t.botForm.balance=a),min:"0","aria-describedby":"bot-balance",required:""},null,512),[[p,t.botForm.balance]])])]),e("div",fi,[e("div",yi,[e("label",$i,[$(n,null,{content:y(()=>[vi]),default:y(()=>[ki]),_:1}),h(" Списание за сутки, руб "),Fi]),c(e("input",{type:"number",class:"form-control",placeholder:"Списание","aria-label":"Списание","onUpdate:modelValue":o[18]||(o[18]=a=>t.botForm.tax_per_day=a),min:"0","aria-describedby":"bot-tax-per-day",required:""},null,512),[[p,t.botForm.tax_per_day]])])]),e("div",wi,[e("div",Ci,[Si,c(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень CashBack","onUpdate:modelValue":o[19]||(o[19]=a=>t.botForm.level_1=a),min:"0","aria-describedby":"bot-level-1",required:""},null,512),[[p,t.botForm.level_1]])])]),e("div",Vi,[e("div",ji,[Pi,c(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень CashBack","onUpdate:modelValue":o[20]||(o[20]=a=>t.botForm.level_2=a),min:"0","aria-describedby":"bot-level-2"},null,512),[[p,t.botForm.level_2]])])]),e("div",Ui,[e("div",Bi,[Oi,c(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень CashBack","onUpdate:modelValue":o[21]||(o[21]=a=>t.botForm.level_3=a),min:"0","aria-describedby":"bot-level-3"},null,512),[[p,t.botForm.level_3]])])]),e("div",Ti,[e("div",Ii,[Di,c(e("select",{class:"form-control","onUpdate:modelValue":o[22]||(o[22]=a=>t.botForm.cashback_fire_period=a),id:"cashback-fired-period"},[(l(!0),i(b,null,f(t.cashback_fire_periods,a=>(l(),i("option",{value:a.value},m(a.title||"Не указано"),9,qi))),256))],512),[[j,t.botForm.cashback_fire_period]])]),t.botForm.cashback_fire_period>0?(l(),i("div",Li,[Ri,c(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень сгорания CashBack","onUpdate:modelValue":o[23]||(o[23]=a=>t.botForm.cashback_fire_percent=a),min:"0",max:"100","aria-describedby":"cashback-fired-level"},null,512),[[p,t.botForm.cashback_fire_percent]])])):r("",!0)]),e("div",Gi,[e("div",Mi,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[24]||(o[24]=a=>t.need_cashback_config=a),type:"checkbox",id:"need-cashback-config"},null,512),[[k,t.need_cashback_config]]),Ai])]),t.need_cashback_config?(l(),i("div",Ki,[zi,(l(!0),i(b,null,f(t.botForm.cashback_config,(a,_)=>(l(),i("div",{class:"d-flex justify-content-between mb-2 flex-wrap",key:"social-link"+_},[e("div",Ei,[Ni,e("button",{type:"button",onClick:u=>t.removeCashBackConfig(_),class:"btn btn-link text-danger"},Ji,8,Yi)]),c(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Название категории","aria-label":"Название категории",maxlength:"255","onUpdate:modelValue":u=>t.botForm.cashback_config[_].title=u,"aria-describedby":"bot-cashback-config-"+_,required:""},null,8,Hi),[[p,t.botForm.cashback_config[_].title]])]))),128)),e("button",{type:"button",onClick:o[25]||(o[25]=a=>t.addCashBackConfig()),class:"btn mb-2 rounded-sm text-uppercase btn-outline-info w-100"}," Добавить еще категорию "),Qi])):r("",!0),e("div",Xi,[e("div",Zi,[e("div",xi,[e("div",en,[tn,c(e("select",{class:"form-control","onUpdate:modelValue":o[26]||(o[26]=a=>t.selected_warning=a),onChange:o[27]||(o[27]=(...a)=>t.addWarning&&t.addWarning(...a)),id:"warning-rules"},[sn,(l(!0),i(b,null,f(t.filteredWarnings,a=>(l(),i("option",{value:a},m(a.title),9,on))),256))],544),[[j,t.selected_warning]])]),(l(!0),i(b,null,f(t.botForm.warnings,(a,_)=>(l(),i("div",ln,[e("div",nn,[e("div",an,[e("p",dn,m(t.getWarning(a.rule_key).title||"Не найдено"),1)]),e("div",rn,[e("div",cn,[c(e("input",{class:"form-check-input","onUpdate:modelValue":u=>t.botForm.warnings[_].is_active=u,type:"checkbox",id:"warning-is-active-"+_},null,8,un),[[k,t.botForm.warnings[_].is_active]]),e("label",{class:"form-check-label",for:"warning-is-active-"+_},[t.botForm.warnings[_].is_active?(l(),i("span",mn,"Вкл")):(l(),i("span",_n,"Выкл"))],8,hn)])]),e("div",pn,[c(e("input",{type:"number",class:"form-control",placeholder:"Значение","onUpdate:modelValue":u=>t.botForm.warnings[_].rule_value=u,min:"0","aria-describedby":"bot-level-3"},null,8,bn),[[p,t.botForm.warnings[_].rule_value]])]),e("div",gn,[e("button",{onClick:u=>t.removeWarning(_),type:"button",class:"btn btn-outline-danger"},$n,8,fn)])])]))),256))])])]),e("div",kn,[e("div",vn,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[28]||(o[28]=a=>t.need_payments=a),type:"checkbox",id:"need-payments"},null,512),[[k,t.need_payments]]),Fn])]),t.need_payments?(l(),i("div",wn,[e("div",Cn,[c(e("input",{class:"form-check-input",type:"checkbox",value:t.botForm.auto_cashback_on_payments,"onUpdate:modelValue":o[29]||(o[29]=a=>t.botForm.auto_cashback_on_payments=a),id:"bot-auto-cashback-on-payments"},null,8,Sn),[[k,t.botForm.auto_cashback_on_payments]]),Vn]),e("div",jn,[$(n,null,{content:y(()=>[Un]),default:y(()=>[Pn]),_:1}),Bn,c(e("input",{type:"text",class:"form-control",placeholder:"Токен","aria-label":"Токен","onUpdate:modelValue":o[30]||(o[30]=a=>t.botForm.payment_provider_token=a),"aria-describedby":"payment_provider_token"},null,512),[[p,t.botForm.payment_provider_token]])])])):r("",!0),e("div",On,[e("div",Tn,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[31]||(o[31]=a=>t.need_shop=a),type:"checkbox",id:"need-shop"},null,512),[[k,t.need_shop]]),In])]),t.need_shop?(l(),i("div",Dn,[e("div",qn,[$(n,null,{content:y(()=>[Rn]),default:y(()=>[Ln]),_:1}),Gn,c(e("input",{type:"url",class:"form-control",placeholder:"Ссылка на группу ВК","aria-label":"ссылка на группу ВК","onUpdate:modelValue":o[32]||(o[32]=a=>t.botForm.vk_shop_link=a),"aria-describedby":"vk_shop_link"},null,512),[[p,t.botForm.vk_shop_link]])])])):r("",!0),e("div",Mn,[e("div",An,[$(n,null,{content:y(()=>[zn]),default:y(()=>[Kn]),_:1}),En,c(e("input",{type:"url",class:"form-control",placeholder:"Ссылка на внешний сервис","aria-label":"ссылка на внешний сервис","onUpdate:modelValue":o[33]||(o[33]=a=>t.botForm.callback_link=a),"aria-describedby":"callback_link"},null,512),[[p,t.botForm.callback_link]])])]),e("div",Nn,[e("div",Yn,[Wn,e("div",Jn,[Hn,e("div",Qn,[e("div",Xn,[e("div",Zn,[c(e("input",{type:"text",class:"form-control",placeholder:"Ссылка ресурс telegraph","aria-label":"Ссылка ресурс telegraph",maxlength:"255","onUpdate:modelValue":o[34]||(o[34]=a=>t.botForm.info_link=a),"aria-describedby":"bot-info-link"},null,512),[[p,t.botForm.info_link]])])])])])])]),e("div",xn,[e("div",ea,[ta,e("div",sa,[oa,(l(!0),i(b,null,f(t.botForm.social_links,(a,_)=>(l(),i("div",{class:"row",key:"social-link"+_},[e("div",la,[e("div",ia,[c(e("input",{type:"text",class:"form-control",placeholder:"Название ссылки","aria-label":"Название ссылки",maxlength:"255","onUpdate:modelValue":u=>t.botForm.social_links[_].title=u,"aria-describedby":"bot-social-link-"+_,required:""},null,8,na),[[p,t.botForm.social_links[_].title]])])]),e("div",aa,[e("div",da,[c(e("input",{type:"text",class:"form-control",placeholder:"Ссылка на соц.сеть","aria-label":"Ссылка на соц.сеть",maxlength:"255","onUpdate:modelValue":u=>t.botForm.social_links[_].url=u,"aria-describedby":"bot-social-link-"+_,required:""},null,8,ra),[[p,t.botForm.social_links[_].url]])])]),e("div",ca,[e("button",{type:"button",onClick:u=>t.removeItem("social_links",_),class:"btn btn-outline-danger w-100"},ma,8,ua)])]))),128)),e("div",_a,[e("div",pa,[e("button",{type:"button",onClick:o[35]||(o[35]=a=>t.addSocialLinks()),class:"btn btn-outline-success w-100"},"Добавить еще ссылку ")])])])])]),e("div",ba,[ga,e("div",fa,[e("label",ya,[$a,e("input",{type:"file",id:"bot-photos",multiple:"",accept:"image/*",onChange:o[36]||(o[36]=(...a)=>t.onChangePhotos&&t.onChangePhotos(...a)),style:{display:"none"}},null,32)]),t.botForm.photos?(l(!0),i(b,{key:0},f(t.botForm.photos,(a,_)=>(l(),i("div",ka,[c(e("img",null,null,512),[[d,t.getPhoto(a).imageUrl]]),e("div",va,[e("a",{onClick:u=>t.removePhoto(_)},Ca,8,Fa)])]))),256)):(l(),i("div",Sa,[c(e("img",null,null,512),[[d,"/images-by-bot-id/"+s.bot.id+"/"+t.botForm.image]]),e("div",Va,[e("a",{onClick:o[37]||(o[37]=a=>t.removePhoto())},Pa)])]))])])])):r("",!0),e("div",Ua,[e("div",Ba,[e("button",{disabled:!t.botForm.bot_token,type:"submit",class:"btn btn-success w-100 p-3"},[s.bot?(l(),i("span",Ia,"Обновить бота")):(l(),i("span",Ta,"Добавить бота"))],8,Oa)])])],32)}}});const qa={class:"row"},La={class:"input-group mb-3"},Ra={class:"row"},Ga={class:"col-12"},Ma={class:"form-check"},Aa=e("label",{class:"form-check-label",for:"needDeleted"},"Отобразить удаленные",-1),Ka={key:0,class:"row"},za={key:0,class:"col-12"},Ea={class:"col-12 mb-3"},Na={class:"list-group w-100"},Ya={class:"d-flex justify-content-between"},Wa=["onClick"],Ja={key:0},Ha={key:1},Qa={key:2},Xa=e("i",{class:"fa-solid fa-lock"},null,-1),Za=[Xa],xa={key:0},ed={class:"dropdown"},td=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),sd={class:"dropdown-menu"},od={key:0},ld=["onClick"],id=e("i",{class:"fa-solid fa-copy mr-1"},null,-1),nd=["onClick"],ad=e("i",{class:"fa-solid fa-copy mr-1"},null,-1),dd={key:1},rd=["onClick"],cd=e("i",{class:"fa-solid fa-trash mr-1"},null,-1),ud={class:"col-12"},hd={key:1,class:"row"},md=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," Созданных страниц не найдено! ")],-1),_d=[md],pd={props:["editor","current"],data(){return{bot:null,current_page:0,need_deleted:!0,loading:!0,pages:[],search:null,pages_paginate_object:null,need_new_page:!1}},watch:{need_deleted:function(s,t){this.nextPages(0)},getPages:function(s,t){this.$nextTick(()=>{this.search||(this.pages=this.getPages)})},search:function(s,t){this.nextPages(0)}},computed:{...C(["getPages","getCurrentBot","getPagesPaginateObject"])},mounted(){this.loadCurrentBot().then(()=>{this.current_page=localStorage.getItem(`cashman_pagelist_${this.bot.id}_page_index`)||0,this.loadPages()})},methods:{loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},selectPage(s){this.$emit("callback",s),this.$notify("Вы выбрали страницу из списка! Все остальные действия будут производится для этой страницы")},nextPages(s){this.current_page=s,localStorage.setItem(`cashman_pagelist_${this.bot.id}_page_index`,this.current_page),this.loadPages()},duplicatePage(s){this.loading=!0,this.$store.dispatch("duplicatePage",{dataObject:{pageId:s}}).then(t=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},restorePage(s){this.loading=!0,this.$store.dispatch("restorePage",{dataObject:{pageId:s}}).then(t=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},removePage(s){this.loading=!0,this.$store.dispatch("removePage",{dataObject:{pageId:s}}).then(t=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},loadPages(){this.loading=!0,this.$store.dispatch("loadPages",{dataObject:{botId:this.bot.id||null,search:this.search||null,needDeleted:this.need_deleted},page:this.current_page||0}).then(s=>{this.loading=!1,this.pages=this.getPages,this.pages_paginate_object=this.getPagesPaginateObject,this.pages.length===0&&localStorage.setItem(`cashman_pagelist_${this.bot.id}_page_index`,0)}).catch(()=>{this.loading=!1})}}},G=Object.assign(pd,{__name:"PagesList",setup(s){return(t,o)=>(l(),i(b,null,[e("div",qa,[e("div",La,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск страницы","aria-label":"Поиск бота","onUpdate:modelValue":o[0]||(o[0]=n=>t.search=n),"aria-describedby":"button-addon2"},null,512),[[p,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=(...n)=>t.loadPages&&t.loadPages(...n)),type:"button",id:"button-addon2"},"Найти ")])]),e("div",Ra,[e("div",Ga,[e("div",Ma,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[2]||(o[2]=n=>t.need_deleted=n),type:"checkbox",id:"needDeleted"},null,512),[[k,t.need_deleted]]),Aa])])]),t.pages.length>0?(l(),i("div",Ka,[t.pages.length>7?(l(),i("div",za,[t.pages_paginate_object?(l(),v(V,{key:0,onPagination_page:t.nextPages,pagination:t.pages_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])):r("",!0),e("div",Ea,[e("ul",Na,[(l(!0),i(b,null,f(t.pages,(n,d)=>(l(),i("li",{class:F(["list-group-item cursor-pointer page-menu-item btn btn-outline-info mb-1",{"border border-warning":n.deleted_at!=null}])},[e("div",Ya,[e("strong",{onClick:a=>t.selectPage(n)},[h("#"+m(n.id||"Не указано")+" ",1),n.slug?(l(),i("span",Ja,m(n.slug.command||"Не указано"),1)):(l(),i("span",Ha,"Не привязано к команде")),s.current&&s.current===n.id?(l(),i("span",Qa,Za)):r("",!0)],8,Wa),s.editor?(l(),i("div",xa,[e("div",ed,[td,e("ul",sd,[n.deleted_at!=null?(l(),i("li",od,[e("a",{class:"dropdown-item",onClick:a=>t.restorePage(n.id)},[id,h("Восстановить")],8,ld)])):r("",!0),e("li",null,[e("a",{class:"dropdown-item",onClick:a=>t.duplicatePage(n.id)},[ad,h("Дублировать")],8,nd)]),n.deleted_at==null?(l(),i("li",dd,[e("a",{class:"dropdown-item",onClick:a=>t.removePage(n.id)},[cd,h("Удалить")],8,rd)])):r("",!0)])])])):r("",!0)])],2))),256))])]),e("div",ud,[t.pages_paginate_object?(l(),v(V,{key:0,onPagination_page:t.nextPages,pagination:t.pages_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",hd,_d))],64))}}),bd={class:"row"},gd={class:"col-12"},fd={class:"card-body"},yd=e("h6",null,"Добавление нового скрипта в бота",-1),$d={key:0,class:"row"},kd={class:"col-md-6 mb-2"},vd={key:1,class:"row"},Fd=e("div",{class:"col-12"},[e("div",{class:"alert alert-danger",role:"alert"},' У Вас еще нет добавленных скриптов! Воспользуйтесь разделом "Скрипты" для добавления. ')],-1),wd=[Fd],Cd={props:["bot","global"],data(){return{load:!1,search:null,slugs:[],paginate:[]}},computed:{...C(["getSlugs","getSlugsPaginateObject"]),filteredSlugs(){return this.slugs?this.slugs.length===0?[]:this.search==null?this.slugs:this.slugs.filter(s=>{let t=s.slug||"",o=s.command||"",n=s.comment||"";return o.toLowerCase().indexOf(this.search.toLowerCase())!==-1||n.toLowerCase().indexOf(this.search.toLowerCase())!==-1||t.toLowerCase().indexOf(this.search.toLowerCase())!==-1}):[]}},mounted(){this.loadSlugs()},methods:{nextSlugs(s){this.loadSlugs(s)},selectSlug(s){this.$emit("callback",{id:s.id||null,slug:s.slug,comment:s.comment,command:s.command}),this.$notify("Вы выбрали скрипт из списка!")},loadSlugs(s=0){this.$store.dispatch("loadSlugs",{dataObject:{botId:this.bot.id,search:this.search,needGlobal:this.global},page:s}).then(t=>{this.slugs=this.getSlugs,this.paginate=this.getSlugsPaginateObject})},callbackSlugs(){}}},Sd=Object.assign(Cd,{__name:"BotSlugListSimple",setup(s){return(t,o)=>(l(),i("div",bd,[e("div",gd,[e("div",fd,[yd,e("div",null,[c(e("input",{type:"text",class:"form-control mt-1 mb-1","onUpdate:modelValue":o[0]||(o[0]=n=>t.search=n),onKeyup:o[1]||(o[1]=(...n)=>t.loadSlugs&&t.loadSlugs(...n)),placeholder:"Поиск нужного скрипта по описанию"},null,544),[[p,t.search]])]),t.slugs.length>0?(l(),i("div",$d,[(l(!0),i(b,null,f(t.slugs,(n,d)=>(l(),i("div",kd,[$(Xe,{item:n,bot:s.bot,onCallback:t.callbackSlugs,onSelect:t.selectSlug},null,8,["item","bot","onCallback","onSelect"])]))),256)),t.paginate?(l(),v(V,{key:0,onPagination_page:t.nextSlugs,pagination:t.paginate},null,8,["onPagination_page","pagination"])):r("",!0)])):(l(),i("div",vd,wd))])])]))}});const Vd={props:["param"],data(){return{expressions:[{expression:null,description:"Нет проверки"},{expression:"/([a-z0-9]+)/i",description:"Проверка набора из латинских букв и цифр"},{expression:"/([а-яё0-9]+)/iu",description:"Проверка на кириллицу и цифры"},{expression:"/(?P<digit>\\d+)/",description:"Проверка на число"},{expression:"/^([a-z0-9_-]+.)*[a-z0-9_-]+@[a-z0-9_-]+(.[a-z0-9_-]+)*.[a-z]{2,6}$/",description:"Проверка Email"},{expression:"/^((8|+7)[- ]?)?((?d{3})?[- ]?)?[d- ]{7,10}$/",description:"Проверка номера телефона: +7(982)000-00-00"},{expression:"/^(0[1-9]|[12][0-9]|3[01])[.](0[1-9]|1[012])[.](19|20)dd$/",description:"Проверка даты по формату DD.MM.YYYY"},{expression:"/^[0-9]{4}-(0[1-9]|1[012])-(0[1-9]|1[0-9]|2[0-9]|3[01])$/",description:"Проверка даты по формату YYYY-MM-DD"},{expression:"/^(https?://)?([da-z.-]+).([a-z.]{2,6})([/w .-]*)*/?$/",description:"Проверка доменного имени"}]}},methods:{expressionsSelect(s){this.$emit("callback",{param:this.param,text:s.expression})}}},jd={class:"dropdown"},Pd=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-regular fa-registered"})],-1),Ud={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},Bd=["onClick"];function Od(s,t,o,n,d,a){return l(),i("div",jd,[Pd,e("div",Ud,[e("li",null,[(l(!0),i(b,null,f(d.expressions,_=>(l(),i("a",{class:"dropdown-item",onClick:u=>a.expressionsSelect(_)},m(_.description||"-"),9,Bd))),256))])])])}const Td=P(Vd,[["render",Od]]),Id={class:"form-floating mb-2"},Dd=["id"],qd=["for"],Ld={class:"form-check mb-2"},Rd=e("label",{class:"form-check-label",for:"need-empty-dialog"}," Диалог без ожидания ответа ",-1),Gd={key:0,class:"form-floating mb-2"},Md=["id"],Ad=["for"],Kd={key:1,class:"form-floating mb-2"},zd=["id"],Ed=["for"],Nd={key:2,class:"mb-2"},Yd={class:"d-flex justify-content-between"},Wd=["for"],Jd=["id"],Hd={class:"mb-2"},Qd={class:"d-flex justify-content-between"},Xd=["for"],Zd=["id"],xd={class:"mb-2"},er={class:"form-check"},tr=e("label",{class:"form-check-label",for:"need-dialog-image"}," В диалоге нужно изображение ",-1),sr={class:"form-check"},or=e("label",{class:"form-check-label",for:"need-dialog-menu-inline"}," В диалоге нужно меню тексту ",-1),lr={class:"form-check"},ir=e("label",{class:"form-check-label",for:"need-dialog-menu-reply"}," В диалоге нужно нижнее меню ",-1),nr={key:3,class:"card mb-2"},ar={class:"card-body"},dr=e("h6",null,"Фотографии к диалогу",-1),rr={class:"photo-preview d-flex justify-content-start flex-wrap w-100"},cr={for:"location-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},ur=e("span",null,"+",-1),hr={class:"mb-2 img-preview",style:{"margin-right":"10px"}},mr={class:"remove"},_r=["onClick"],pr={class:"mb-2 img-preview",style:{"margin-right":"10px"}},br={class:"remove"},gr=["onClick"],fr={key:4,class:"card mb-2"},yr=e("div",{class:"card-header"},[e("h6",null,"Кнопки к тексту вопроса")],-1),$r={class:"card-body"},kr={key:5,class:"card mb-2"},vr=e("div",{class:"card-header"},[e("h6",null,"Кнопки в виде нижнего меню")],-1),Fr={class:"card-body"},wr={class:"mb-2"},Cr=e("label",{class:"form-check-label",for:"need-empty-dialog"}," Сохранить в переменную ",-1),Sr=e("option",{selected:""},"Не выбрано",-1),Vr=["value"],jr={class:"form-check mb-2"},Pr=e("label",{class:"form-check-label",for:"need-set-flags"}," Установить флаги в соответствующее значение ",-1),Ur={key:6,class:"mb-2"},Br=e("p",null,"Выбрать флаги",-1),Or=["onClick"],Tr={class:"mb-2"},Ir={type:"submit",class:"btn btn-outline-primary p-3 w-100"},Dr={key:0},qr={key:1},Lr={props:["item","bot"],data(){return{need_images:!1,need_inline_keyboard:!1,need_reply_keyboard:!1,need_set_flags:!1,flags_variants:[{title:"Является VIP",key:"is_vip",value:null},{title:"Является Админом",key:"is_admin",value:null},{title:"За работой",key:"is_work",value:null},{title:"Является менеджером",key:"is_manager",value:null}],store_variants:[{title:"Имя",key:"name"},{title:"Почта",key:"email"},{title:"Возраст",key:"age"},{title:"Город",key:"city"},{title:"Страна",key:"country"},{title:"Адрес",key:"address"},{title:"Телефон",key:"phone"},{title:"День рождение",key:"birthday"}],commandForm:{id:null,slug:null,pre_text:null,post_text:null,error_text:null,bot_id:null,input_pattern:null,inline_keyboard_id:null,reply_keyboard_id:null,images:null,next_bot_dialog_command_id:null,bot_dialog_group_id:null,is_empty:!1,result_flags:[],store_to:null,result_channel:null,inline_keyboard:null,reply_keyboard:null},photos:[]}},mounted(){this.item&&this.$nextTick(()=>{this.commandForm={id:this.item.id||null,slug:this.item.slug||null,pre_text:this.item.pre_text||null,post_text:this.item.post_text||null,error_text:this.item.error_text||null,is_empty:this.item.is_empty||!1,input_pattern:this.item.input_pattern||null,inline_keyboard_id:this.item.inline_keyboard_id||null,reply_keyboard_id:this.item.reply_keyboard_id||null,images:this.item.images||[],next_bot_dialog_command_id:this.item.next_bot_dialog_command_id||null,bot_dialog_group_id:this.item.bot_dialog_group_id||null,result_channel:this.item.result_channel||null,inline_keyboard:this.item.inline_keyboard||null,reply_keyboard:this.item.reply_keyboard||null,result_flags:this.item.result_flags||[],store_to:this.item.store_to||null},this.bot&&(this.commandForm.bot_id=this.bot.id||null),this.commandForm.inline_keyboard_id!=null&&(this.need_inline_keyboard=!0),this.commandForm.reply_keyboard_id!=null&&(this.need_reply_keyboard=!0),this.commandForm.images.length>0&&(this.need_images=!0),this.commandForm.result_flags.length>0&&(this.need_set_flags=!0)}),this.bot&&this.$nextTick(()=>{this.commandForm.bot_id=this.bot.id})},methods:{submit(){this.loading=!0;let s=new FormData;if(Object.keys(this.commandForm).forEach(t=>{const o=this.commandForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.photos){for(let t=0;t<this.photos.length;t++)s.append("files[]",this.photos[t]);s.delete("photos")}this.$store.dispatch(this.commandForm.id?"updateDialogCommand":"createDialogCommand",{dialogCommandForm:s}).then(t=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Успешная обработка диалоговой команды",type:"success"}),this.commandForm.id==null&&(this.commandForm={id:null,slug:null,pre_text:null,post_text:null,error_text:null,input_pattern:null,inline_keyboard_id:null,images:null,next_bot_dialog_command_id:null,bot_dialog_group_id:null,result_channel:null,inline_keyboard:null,is_empty:!1,result_flags:[],store_to:null},this.photos=[]),this.$emit("callback")}).catch(t=>{this.loading=!1})},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removePhoto(s,t){this[s].splice(t,1)},onChangePhotos(s){const t=s.target.files;for(let o=0;o<t.length;o++)this.photos.push(t[o])},saveInlineKeyboard(s){this.commandForm.inline_keyboard=s},saveReplyKeyboard(s){this.commandForm.reply_keyboard=s},addTextTo(s={param:null,text:null}){this.commandForm[s.param]=s.text},selectFlag(s){(!this.commandForm.result_flags||!Array.isArray(this.commandForm.result_flags))&&(this.commandForm.result_flags=[]);let t=this.commandForm.result_flags.indexOf(s.key);t===-1?this.commandForm.result_flags.push(s.key):this.commandForm.result_flags.splice(t,1)}}},M=Object.assign(Lr,{__name:"BotDialogCommandForm",setup(s){return(t,o)=>{const n=T("lazy");return l(),i("form",{onSubmit:o[12]||(o[12]=S((...d)=>t.submit&&t.submit(...d),["prevent"]))},[e("div",Id,[c(e("input",{type:"text",class:"form-control",id:"commandForm-pre-text-"+t.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":o[0]||(o[0]=d=>t.commandForm.pre_text=d),required:""},null,8,Dd),[[p,t.commandForm.pre_text]]),e("label",{for:"commandForm-pre-text-"+t.commandForm.id},"Текст диалога",8,qd)]),e("div",Ld,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[1]||(o[1]=d=>t.commandForm.is_empty=d),id:"need-empty-dialog",checked:""},null,512),[[k,t.commandForm.is_empty]]),Rd]),t.commandForm.is_empty?r("",!0):(l(),i("div",Gd,[c(e("input",{type:"text",class:"form-control",id:"commandForm-post-text-"+t.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":o[2]||(o[2]=d=>t.commandForm.post_text=d),required:""},null,8,Md),[[p,t.commandForm.post_text]]),e("label",{for:"commandForm-post-text-"+t.commandForm.id},"Текст после успешного завершения диалога",8,Ad)])),t.commandForm.is_empty?r("",!0):(l(),i("div",Kd,[c(e("input",{type:"text",class:"form-control",id:"commandForm-error-text-"+t.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":o[3]||(o[3]=d=>t.commandForm.error_text=d),required:""},null,8,zd),[[p,t.commandForm.error_text]]),e("label",{for:"commandForm-error-text-"+t.commandForm.id},"Текст на случай ошибки корректности данных",8,Ed)])),t.commandForm.is_empty?r("",!0):(l(),i("div",Nd,[e("div",Yd,[e("label",{class:"form-label",for:"commandForm-result-channel-"+t.commandForm.id},"Регулярное выражение для валидации данных ",8,Wd),$(Td,{param:"input_pattern",onCallback:t.addTextTo},null,8,["onCallback"])]),c(e("input",{type:"text",class:"form-control",placeholder:"Регулярное выражение","aria-label":"Регулярное выражение","onUpdate:modelValue":o[4]||(o[4]=d=>t.commandForm.input_pattern=d),maxlength:"255",id:"commandForm-input-pattern-"+t.commandForm.id,"aria-describedby":"commandForm-input-pattern"},null,8,Jd),[[p,t.commandForm.input_pattern]])])),e("div",Hd,[e("div",Qd,[e("label",{class:"form-label",for:"commandForm-result-channel-"+t.commandForm.id},"Канал для отправки данных ",8,Xd),s.bot?(l(),v(B,{key:0,token:s.bot.bot_token,param:"result_channel",onCallback:t.addTextTo},null,8,["token","onCallback"])):r("",!0)]),c(e("input",{type:"number",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":o[5]||(o[5]=d=>t.commandForm.result_channel=d),id:"commandForm-result-channel-"+t.commandForm.id,"aria-describedby":"bot-order-channel"},null,8,Zd),[[p,t.commandForm.result_channel]])]),e("div",xd,[e("div",er,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[6]||(o[6]=d=>t.need_images=d),id:"need-dialog-image",checked:""},null,512),[[k,t.need_images]]),tr]),e("div",sr,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[7]||(o[7]=d=>t.need_inline_keyboard=d),id:"need-dialog-menu-inline",checked:""},null,512),[[k,t.need_inline_keyboard]]),or]),e("div",lr,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[8]||(o[8]=d=>t.need_reply_keyboard=d),id:"need-dialog-menu-reply",checked:""},null,512),[[k,t.need_reply_keyboard]]),ir])]),t.need_images?(l(),i("div",nr,[e("div",ar,[dr,e("div",rr,[e("label",cr,[ur,e("input",{type:"file",id:"location-photos",multiple:"",accept:"image/*",onChange:o[9]||(o[9]=(...d)=>t.onChangePhotos&&t.onChangePhotos(...d)),style:{display:"none"}},null,32)]),t.photos.length>0?(l(!0),i(b,{key:0},f(t.photos,(d,a)=>(l(),i("div",hr,[c(e("img",null,null,512),[[n,t.getPhoto(d).imageUrl]]),e("div",mr,[e("a",{onClick:_=>t.removePhoto("photos",a)},"Удалить",8,_r)])]))),256)):r("",!0),t.commandForm.images&&s.bot?(l(!0),i(b,{key:1},f(t.commandForm.images,(d,a)=>(l(),i("div",pr,[c(e("img",null,null,512),[[n,"/images-by-bot-id/"+s.bot.id+"/"+d]]),e("div",br,[e("a",{onClick:_=>t.removePhoto("images",a)},"Удалить",8,gr)])]))),256)):r("",!0)])])])):r("",!0),t.need_inline_keyboard?(l(),i("div",fr,[yr,e("div",$r,[$(O,{onSave:t.saveInlineKeyboard,"edited-keyboard":t.commandForm.inline_keyboard},null,8,["onSave","edited-keyboard"])])])):r("",!0),t.need_reply_keyboard?(l(),i("div",kr,[vr,e("div",Fr,[$(O,{onSave:t.saveReplyKeyboard,"edited-keyboard":t.commandForm.reply_keyboard},null,8,["onSave","edited-keyboard"])])])):r("",!0),e("div",wr,[Cr,c(e("select",{class:"form-control","onUpdate:modelValue":o[10]||(o[10]=d=>t.commandForm.store_to=d)},[Sr,(l(!0),i(b,null,f(t.store_variants,d=>(l(),i("option",{value:d.key},m(d.title||"Не указано"),9,Vr))),256))],512),[[j,t.commandForm.store_to]])]),e("div",jr,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[11]||(o[11]=d=>t.need_set_flags=d),id:"need-set-flags",checked:""},null,512),[[k,t.need_set_flags]]),Pr]),t.need_set_flags?(l(),i("div",Ur,[Br,(l(!0),i(b,null,f(t.flags_variants,d=>(l(),i("span",{class:F(["badge text-info mr-2",{"bg-info text-white":t.commandForm.result_flags.indexOf(d.key)!=-1}]),onClick:a=>t.selectFlag(d)},m(d.title),11,Or))),256))])):r("",!0),e("div",Tr,[e("button",Ir,[t.commandForm.id?(l(),i("span",Dr,"Обновить диалог")):(l(),i("span",qr,"Добавить диалог"))])])],32)}}});const Rr={class:"p-2 dialog-command-card"},Gr={class:"badge bg-success"},Mr=e("span",{class:"ml-1 mr-1"},[e("i",{class:"fa-solid fa-arrow-right"})],-1),Ar={key:0,class:"badge bg-primary"},Kr={key:1},zr=e("h6",null,"Текст диалога:",-1),Er={key:0,class:"w-100 d-flex justify-between"},Nr={class:"dropdown"},Yr=["disabled"],Wr=e("i",{class:"fa-solid fa-ellipsis"},null,-1),Jr=[Wr],Hr={class:"dropdown-menu"},Qr=e("i",{class:"fa-solid fa-arrow-left mr-1"},null,-1),Xr=e("hr",null,null,-1),Zr=["data-bs-target"],xr=e("i",{class:"fa-solid fa-sliders mr-1"},null,-1),ec=e("i",{class:"fa-solid fa-arrows-turn-to-dots mr-1"},null,-1),tc=e("i",{class:"fa-solid fa-arrows-up-down mr-1"},null,-1),sc=e("i",{class:"fa-solid fa-clone mr-1"},null,-1),oc=e("i",{class:"fa-solid fa-link-slash mr-1"},null,-1),lc=e("i",{class:"fa-solid fa-trash-can mr-1"},null,-1),ic=["id"],nc={class:"modal-dialog modal-fullscreen"},ac={class:"modal-content"},dc={class:"modal-header"},rc={class:"modal-title fs-5",id:"staticBackdropLabel"},cc={class:"badge bg-success"},uc=e("span",{class:"ml-1 mr-1"},[e("i",{class:"fa-solid fa-arrow-right"})],-1),hc={key:0,class:"badge bg-primary"},mc={key:1},_c=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),pc={class:"modal-body"},bc=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),gc={props:["item","simple","bot"],data(){return{loading:!1}},methods:{unlinkCommand(){this.loading=!0,this.$store.dispatch("unlinkDialogCommand",{dataObject:{dialogCommandId:this.item.id}}).then(s=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Диалоговая команда успешно продублирована!",type:"success"}),this.$emit("callback")}).catch(s=>{this.loading=!1})},removeCommand(){this.loading=!0,this.$store.dispatch("removeDialogCommand",{dataObject:{dialogCommandId:this.item.id}}).then(s=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Диалоговая команда успешно удалена!",type:"success"}),this.$emit("callback")}).catch(s=>{this.loading=!1})},selectDialog(){this.$emit("select",this.item)},duplicate(){this.loading=!0,this.$store.dispatch("duplicateDialogCommand",{dataObject:{dialogCommandId:this.item.id}}).then(s=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Диалоговая команда успешно продублирована!",type:"success"}),this.$emit("callback")}).catch(s=>{this.loading=!1})},changeGroup(){this.$emit("swap",{command_id:this.item.id,group_id:this.item.bot_dialog_group_id})},linkEvent(){this.$emit("link",{id:this.item.id,group_id:this.item.bot_dialog_group_id,current_next_id:this.item.next_bot_dialog_command_id})}}},A=Object.assign(gc,{__name:"DialogCommandCard",setup(s){return(t,o)=>(l(),i(b,null,[e("div",Rr,[e("p",null,[e("span",Gr,"#"+m(s.item.id),1),Mr,s.item.next_bot_dialog_command_id?(l(),i("span",Ar,"#"+m(s.item.next_bot_dialog_command_id||"-"),1)):(l(),i("span",Kr,"не связан"))]),zr,e("p",null,m(s.item.pre_text||"-"),1),s.simple?r("",!0):(l(),i("div",Er,[e("div",Nr,[e("button",{disabled:t.loading,class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Jr,8,Yr),e("ul",Hr,[e("li",null,[e("a",{onClick:o[0]||(o[0]=(...n)=>t.selectDialog&&t.selectDialog(...n)),title:"Выбрать диалог",class:"dropdown-item cursor-pointer"},[Qr,h(" Выбрать диалог ")])]),Xr,e("li",null,[e("a",{"data-bs-toggle":"modal","data-bs-target":"#dialog-command-modal-"+s.item.id,title:"Редактирование параметров карточки",class:"dropdown-item cursor-pointer"},[xr,h(" Настройка диалога ")],8,Zr)]),e("li",null,[e("a",{onClick:o[1]||(o[1]=(...n)=>t.linkEvent&&t.linkEvent(...n)),title:"Диалог связывания с другой командой",class:"dropdown-item cursor-pointer"},[ec,h(" Редактирование связей ")])]),e("li",null,[e("a",{onClick:o[2]||(o[2]=(...n)=>t.changeGroup&&t.changeGroup(...n)),title:"Диалог смены группы команды",class:"dropdown-item cursor-pointer"},[tc,h(" Смена диалоговой группы ")])]),e("li",null,[e("a",{title:"Дублирование команды",onClick:o[3]||(o[3]=(...n)=>t.duplicate&&t.duplicate(...n)),class:"dropdown-item cursor-pointer"},[sc,h(" Дублирование диалога ")])]),e("li",null,[e("a",{onClick:o[4]||(o[4]=(...n)=>t.unlinkCommand&&t.unlinkCommand(...n)),title:"Убирает связь команды с другой командой по цепочке",class:"dropdown-item cursor-pointer"},[oc,h(" Удаление связей диалога ")])]),e("li",null,[e("a",{onClick:o[5]||(o[5]=(...n)=>t.removeCommand&&t.removeCommand(...n)),title:"Удаление команды",class:"dropdown-item cursor-pointer"},[lc,h(" Удаление диалога ")])])])])]))]),e("div",{class:"modal fade",id:"dialog-command-modal-"+s.item.id,"data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true"},[e("div",nc,[e("div",ac,[e("div",dc,[e("h1",rc,[e("span",cc,"#"+m(s.item.id),1),uc,s.item.next_bot_dialog_command_id?(l(),i("span",hc,"#"+m(s.item.next_bot_dialog_command_id||"-"),1)):(l(),i("span",mc,"не связан"))]),_c]),e("div",pc,[$(M,{bot:s.bot,item:s.item},null,8,["bot","item"])]),bc])])],8,ic)],64))}});const fc={key:0,class:"row"},yc={class:"col-12 mb-3"},$c={class:"card mb-2"},kc={class:"card-header"},vc={class:"card-body"},Fc={key:0,class:"row"},wc={class:"col-md-6 col-lg-4 col-12 col-sm-6 mb-2"},Cc={key:1,class:"row"},Sc=e("div",{class:"col-12"},[e("p",null,"Диалоговых скриптов не найдено")],-1),Vc=[Sc],jc={class:"col-12"},Pc={key:1,class:"row"},Uc=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет созданных диалоговых групп ")],-1),Bc=[Uc],Oc={props:["bot"],data(){return{groupForm:{slug:null,title:null},loading:!0,dialog_groups:[],search:null,dialog_groups_paginate_object:null,link:null,selected_dialog_id:null,group:null}},computed:{...C(["getDialogGroups","getDialogGroupsPaginateObject"])},mounted(){this.loadGroups()},methods:{selectDialog(s){this.$emit("select-dialog",s),this.selected_dialog_id=s.id,this.$notify("Вы выбрали диалог из списка!")},nextGroups(s){this.loadGroups(s)},loadGroups(s=0){this.loading=!0,this.$store.dispatch("loadDialogGroups",{dataObject:{botId:this.bot.id||null,search:this.search},page:s}).then(t=>{this.loading=!1,this.dialog_groups=this.getDialogGroups,this.dialog_groups_paginate_object=this.getDialogGroupsPaginateObject}).catch(()=>{this.loading=!1})}}},Tc=Object.assign(Oc,{__name:"BotDialogGroupListSimple",setup(s){return(t,o)=>t.dialog_groups.length>0?(l(),i("div",fc,[e("div",yc,[(l(!0),i(b,null,f(t.dialog_groups,(n,d)=>(l(),i("div",$c,[e("div",kc,[e("h6",null," #"+m(n.id)+" - "+m(n.title||"Не указано ")+" ("+m(n.slug||"Не указано")+")",1)]),e("div",vc,[n.bot_dialog_commands.length>0?(l(),i("div",Fc,[(l(!0),i(b,null,f(n.bot_dialog_commands,(a,_)=>(l(),i("div",wc,[$(A,{bot:s.bot,onSelect:t.selectDialog,item:a},null,8,["bot","onSelect","item"])]))),256))])):(l(),i("div",Cc,Vc))])]))),256))]),e("div",jc,[t.dialog_groups_paginate_object?(l(),v(V,{key:0,onPagination_page:t.nextGroups,pagination:t.dialog_groups_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",Pc,Bc))}}),Ic=e("div",{class:"alert alert-success",role:"alert"},' Проверка правил идет по методу "И" - все правила должны выполняться для перехода на данную страницу, иначе будет вызвана страница из блока "иначе". Действия для "иначе" добавлять не обязательно. ',-1),Dc=e("h6",null,"Блок условий",-1),qc={key:0,class:"py-2"},Lc={class:"form-label",id:"bot-domain"},Rc=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Gc=e("div",null,"Напишите текст, который будет отображен пользователю вместе с основным контентом в случае если условие будет выполнено ",-1),Mc={class:"dropdown mb-2"},Ac=e("button",{class:"btn btn-outline-info dropdown-toggle w-100",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"}," Добавить условие ",-1),Kc={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},zc=["onClick"],Ec={key:1},Nc={key:2,class:"list-group"},Yc={key:0,class:"list-group-item d-flex justify-content-between align-items-center"},Wc={class:"form-check"},Jc={class:"form-check-label",for:"bot-user-is-vip"},Hc={key:0},Qc={key:1},Xc=e("i",{class:"fa-solid fa-trash-can"},null,-1),Zc=[Xc],xc={key:1,class:"list-group-item d-flex justify-content-between align-items-center"},eu={class:"form-check"},tu={class:"form-check-label",for:"bot-user-is-admin"},su={key:0},ou={key:1},lu=e("i",{class:"fa-solid fa-trash-can"},null,-1),iu=[lu],nu={key:2,class:"list-group-item d-flex justify-content-between align-items-center"},au={class:"form-check"},du={class:"form-check-label",for:"bot-user-is-deliveryman"},ru={key:0},cu={key:1},uu=e("i",{class:"fa-solid fa-trash-can"},null,-1),hu=[uu],mu={key:3,class:"list-group-item d-flex justify-content-between align-items-center"},_u={class:"form-check"},pu={class:"form-check-label",for:"bot-user-is-work"},bu={key:0},gu={key:1},fu=e("i",{class:"fa-solid fa-trash-can"},null,-1),yu=[fu],$u={key:4,class:"list-group-item d-flex justify-content-between align-items-center"},ku={class:"form-check"},vu={class:"form-check-label",for:"bot-user-in-location"},Fu={key:0},wu={key:1},Cu=e("i",{class:"fa-solid fa-trash-can"},null,-1),Su=[Cu],Vu={key:5,class:"list-group-item d-flex justify-content-between align-items-center"},ju=e("label",{class:"form-label",id:"bot-domain"}," Возраст от ",-1),Pu=e("i",{class:"fa-solid fa-trash-can"},null,-1),Uu=[Pu],Bu={key:6,class:"list-group-item d-flex justify-content-between align-items-center"},Ou=e("label",{class:"form-label",id:"bot-domain"}," Только для города ",-1),Tu=e("i",{class:"fa-solid fa-trash-can"},null,-1),Iu=[Tu],Du={key:7,class:"list-group-item d-flex justify-content-between align-items-center"},qu={class:"form-check"},Lu={class:"form-check-label",for:"bot-user-sex"},Ru={key:0},Gu={key:1},Mu=e("i",{class:"fa-solid fa-trash-can"},null,-1),Au=[Mu],Ku={key:8,class:"list-group-item"},zu={class:"mb-3"},Eu={class:"d-flex justify-content-between align-items-center"},Nu={class:"form-label d-flex w-100 align-items-center",id:"bot-order-channel"},Yu=["onClick"],Wu=e("i",{class:"fa-solid fa-trash-can"},null,-1),Ju=[Wu],Hu=["onUpdate:modelValue"],Qu={key:3,class:"mt-5"},Xu={key:4,class:"d-flex justify-content-between"},Zu={key:6,class:"py-2"},xu={class:"form-label",id:"bot-domain"},eh=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),th=e("div",null,'Напишите текст, который будет отображен пользователю вместе с основным контентом в случае если условие не будет выполнено и будет вызван блок "иначе" ',-1),sh={props:["bot","rulesForm"],data(){return{rules:[{id:1,title:"Является администратором",rules_block:"bot_user",rule:{is_admin:!0}},{id:2,title:"Является VIP-пользователем",rules_block:"bot_user",rule:{is_vip:!0}},{id:3,title:"Находится в заведении",rules_block:"bot_user",rule:{user_in_location:!0}},{id:4,title:"За работой",rules_block:"bot_user",rule:{is_work:!0}},{id:5,title:"Возраст от ...",rules_block:"bot_user",rule:{age:18}},{id:6,title:"Находится в городе ...",rules_block:"bot_user",rule:{city:"Краснодар"}},{id:7,title:"Пол",rules_block:"bot_user",rule:{sex:!0}},{id:8,title:"Состоит в канале",rules_block:"channels",rule:{channel:1}},{id:9,title:"Является Менеджером",rules_block:"bot_user",rule:{is_manager:!0}}]}},computed:{rulesForCustomFields(){let s=this.rules.filter(t=>t.key!=null);return console.log("filtered rules",s),s}},mounted(){},methods:{hasRuleKey(s){return this.rulesForm.rules_if==null?!1:(console.log("key=>",s||"-"),Object.keys(this.rulesForm.rules_if.bot_user).find(t=>t===s)!=null)},modifyChannel(s){this.rulesForm.rules_if.channels[s.param]=s.text},removeChannelFromRule(s){this.rulesForm.rules_if.channels.splice(s,1)},removeRule(s){delete this.rulesForm.rules_if.bot_user[s]},addRules(s){this.rulesForm.rules_if||(this.rulesForm.rules_if={bot_user:{},channels:[]}),s.rules_block==="bot_user"&&(this.rulesForm.rules_if.bot_user={...this.rulesForm.rules_if.bot_user,...s.rule}),s.rules_block==="channels"&&this.rulesForm.rules_if.channels.push(s.rule.channel)},loadCurrentBotFields(){return this.$store.dispatch("loadCurrentBotFields",{bot_id:this.bot.id}).then(s=>{(s.data||[]).forEach(o=>{o.is_active&&(this.rules.push({id:this.rules.length+1,title:o.label,key:o.key,type:o.type,rules_block:"bot_user",rule:{}}),o.type===0&&(this.rules[this.rules.length-1].rule[o.key]=""),o.type===1&&(this.rules[this.rules.length-1].rule[o.key]=0),o.type===2&&(this.rules[this.rules.length-1].rule[o.key]=!0))}),console.log("new rules=>",this.rules)})},attachPageToRule(s){s.id!=this.rulesForm.id?this.rulesForm.rules_else_page_id=s.id:this.$notify({title:"Конструктор страниц",text:"Вы не можете связать данную страницу с собой",type:"error"})}}},oh=Object.assign(sh,{__name:"PageRules",setup(s){return(t,o)=>{const n=U("Popper");return l(),i(b,null,[Ic,Dc,s.rulesForm.rules_if?(l(),i("div",qc,[e("label",Lc,[$(n,null,{content:y(()=>[Gc]),default:y(()=>[Rc]),_:1}),h(" Сообщение при успешном прохождении условий (не обязательно) ")]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст сообщения","aria-label":"Текст сообщения","onUpdate:modelValue":o[0]||(o[0]=d=>s.rulesForm.rules_if_message=d),maxlength:"255","aria-describedby":"rules-else-message"},`
            `,512),[[p,s.rulesForm.rules_if_message]])])):r("",!0),e("div",Mc,[Ac,e("ul",Kc,[(l(!0),i(b,null,f(t.rules,d=>(l(),i("li",null,[e("a",{onClick:a=>t.addRules(d),class:"dropdown-item",href:"javascript:void(0)"},m(d.title||"Не указан"),9,zc)]))),256))])]),s.rulesForm.rules_if?(l(),i("h6",Ec,"Выбранные условия")):r("",!0),s.rulesForm.rules_if?(l(),i("ul",Nc,[t.hasRuleKey("is_vip")?(l(),i("li",Yc,[e("div",Wc,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[1]||(o[1]=d=>s.rulesForm.rules_if.bot_user.is_vip=d),type:"checkbox",id:"bot-user-is-vip"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_vip]]),e("label",Jc,[s.rulesForm.rules_if.bot_user.is_vip?(l(),i("span",Hc,"Является VIP-пользователем")):(l(),i("span",Qc,"Не является VIP-пользователем"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[2]||(o[2]=d=>t.removeRule("is_vip"))},Zc)])):r("",!0),t.hasRuleKey("is_admin")?(l(),i("li",xc,[e("div",eu,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[3]||(o[3]=d=>s.rulesForm.rules_if.bot_user.is_admin=d),type:"checkbox",id:"bot-user-is-admin"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_admin]]),e("label",tu,[s.rulesForm.rules_if.bot_user.is_admin?(l(),i("span",su,"Является администратором")):(l(),i("span",ou,"Не является администратором"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[4]||(o[4]=d=>t.removeRule("is_admin"))},iu)])):r("",!0),t.hasRuleKey("is_deliveryman")?(l(),i("li",nu,[e("div",au,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[5]||(o[5]=d=>s.rulesForm.rules_if.bot_user.is_deliveryman=d),type:"checkbox",id:"bot-user-is-deliveryman"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_deliveryman]]),e("label",du,[s.rulesForm.rules_if.bot_user.is_deliveryman?(l(),i("span",ru,"Является доставщиком")):(l(),i("span",cu,"Не является доставщиком"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[6]||(o[6]=d=>t.removeRule("is_deliveryman"))},hu)])):r("",!0),t.hasRuleKey("is_work")?(l(),i("li",mu,[e("div",_u,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[7]||(o[7]=d=>s.rulesForm.rules_if.bot_user.is_work=d),type:"checkbox",id:"bot-user-is-work"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_work]]),e("label",pu,[s.rulesForm.rules_if.bot_user.is_work?(l(),i("span",bu,"За работой")):(l(),i("span",gu,"Не работает"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[8]||(o[8]=d=>t.removeRule("is_work"))},yu)])):r("",!0),t.hasRuleKey("user_in_location")?(l(),i("li",$u,[e("div",ku,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[9]||(o[9]=d=>s.rulesForm.rules_if.bot_user.user_in_location=d),type:"checkbox",id:"bot-user-in-location"},null,512),[[k,s.rulesForm.rules_if.bot_user.user_in_location]]),e("label",vu,[s.rulesForm.rules_if.bot_user.user_in_location?(l(),i("span",Fu,"Находится в заведении")):(l(),i("span",wu,"Не находится в заведении"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[10]||(o[10]=d=>t.removeRule("user_in_location"))},Su)])):r("",!0),t.hasRuleKey("age")?(l(),i("li",Vu,[e("div",null,[ju,c(e("input",{type:"text",class:"form-control",placeholder:"Возраст от","aria-label":"Возраст от","onUpdate:modelValue":o[11]||(o[11]=d=>s.rulesForm.rules_if.bot_user.age=d),maxlength:"255","aria-describedby":"bot-user-age"},null,512),[[p,s.rulesForm.rules_if.bot_user.age]])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[12]||(o[12]=d=>t.removeRule("age"))},Uu)])):r("",!0),t.hasRuleKey("city")?(l(),i("li",Bu,[e("div",null,[Ou,c(e("input",{type:"text",class:"form-control",placeholder:"Город","aria-label":"Город","onUpdate:modelValue":o[13]||(o[13]=d=>s.rulesForm.rules_if.bot_user.city=d),maxlength:"255","aria-describedby":"bot-user-city"},null,512),[[p,s.rulesForm.rules_if.bot_user.city]])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[14]||(o[14]=d=>t.removeRule("city"))},Iu)])):r("",!0),t.hasRuleKey("sex")?(l(),i("li",Du,[e("div",qu,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[15]||(o[15]=d=>s.rulesForm.rules_if.bot_user.sex=d),type:"checkbox",id:"bot-user-sex"},null,512),[[k,s.rulesForm.rules_if.bot_user.sex]]),e("label",Lu,[s.rulesForm.rules_if.bot_user.sex?(l(),i("span",Ru,"Только для мужчин")):(l(),i("span",Gu,"Только для женщин"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[16]||(o[16]=d=>t.removeRule("sex"))},Au)])):r("",!0),s.rulesForm.rules_if.channels.length>0?(l(),i("li",Ku,[h("Проверка нахождения в канале \\ группе: "),(l(!0),i(b,null,f(s.rulesForm.rules_if.channels,(d,a)=>(l(),i("div",zu,[e("div",Eu,[e("label",Nu,[$(B,{token:s.bot.bot_token,param:`${a}`,onCallback:t.modifyChannel},null,8,["token","param","onCallback"]),h(" Канал для проверки ")]),e("button",{type:"button",class:"btn btn-link text-danger",onClick:_=>t.removeChannelFromRule(a)},Ju,8,Yu)]),c(e("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":_=>s.rulesForm.rules_if.channels[a]=_,maxlength:"255","aria-describedby":"bot-order-channel"},null,8,Hu),[[p,s.rulesForm.rules_if.channels[a]]])]))),256))])):r("",!0)])):r("",!0),s.rulesForm.rules_if?(l(),i("h6",Qu,"Иначе")):r("",!0),s.rulesForm.rules_else_page_id?(l(),i("p",Xu,[h("Вы выбрали страницу #"+m(s.rulesForm.rules_else_page_id)+' в качестве условия "иначе" ',1),e("a",{href:"javascript:void(0)",onClick:o[17]||(o[17]=d=>s.rulesForm.rules_else_page_id=null)},"Очистить")])):r("",!0),s.rulesForm.rules_if?(l(),v(G,{key:5,current:s.rulesForm.id,onCallback:t.attachPageToRule,editor:!1},null,8,["current","onCallback"])):r("",!0),s.rulesForm.rules_if?(l(),i("div",Zu,[e("label",xu,[$(n,null,{content:y(()=>[th]),default:y(()=>[eh]),_:1}),h(" Сообщение в случае невыполнения условий (не обязательно) ")]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст сообщения","aria-label":"Текст сообщения","onUpdate:modelValue":o[18]||(o[18]=d=>s.rulesForm.rules_else_message=d),maxlength:"255","aria-describedby":"rules-else-message"},`
            `,512),[[p,s.rulesForm.rules_else_message]])])):r("",!0)],64)}}}),lh={class:"row"},ih={class:"col-12 mb-2"},nh={class:"d-flex justify-between"},ah={key:0,class:"col-12 mb-2"},dh={class:"form-check"},rh=e("label",{class:"form-check-label",for:"need-show-qr-and-link"}," Показать ссылку на страницу и QR-код ",-1),ch={key:1,class:"col-12 mb-2"},uh={class:"d-flex justify-content-center"},hh={style:{width:"200px",height:"200px"}},mh={class:"col-12 mb-2"},_h={class:"form-label",id:"bot-domain"},ph=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),bh=e("div",null,[h(" Команда должна начинаться с символва . и *"),e("br"),h(" Например: .*Меню"),e("br")],-1),gh=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),fh={class:"col-12 mb-2"},yh={class:"form-check"},$h=e("label",{class:"form-check-label",for:"is-external"}," Внешнее управление страницей ",-1),kh={class:"col-12 mb-2"},vh={class:"form-label",id:"bot-domain"},Fh=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),wh=e("div",null,"Напишите для себя пояснение для чего нужна данная страница. Это поможет другим менеджерам лучше понять Вас. ",-1),Ch=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Sh={key:0,class:"row"},Vh={class:"col-12 mb-2"},jh={class:"form-label d-flex justify-content-between align-items-center mb-0",id:"bot-domain"},Ph=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Uh=e("div",null,[h(" Текстовый редактор. Данный текст будет в таком"),e("br"),h(" же виде отображен в посте в телеграм. ")],-1),Bh=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Oh={class:"form-floating"},Th={for:"floatingTextarea2"},Ih={key:0},Dh={class:"col-12 mb-2"},qh={class:"form-check"},Lh=e("label",{class:"form-check-label",for:"need-page-images"}," Изображения на странице (максимум 10) ",-1),Rh={key:0,class:"col-12 mb-2"},Gh={class:"card mb-3"},Mh=e("div",{class:"card-header"},[e("h6",null,"Загрузите изображения с файловой системы")],-1),Ah={class:"card-body d-flex justify-content-start"},Kh={for:"photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},zh={class:"row"},Eh={key:0,class:"col-12 d-flex flex-wrap"},Nh={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Yh={class:"remove"},Wh=["onClick"],Jh={key:1},Hh={key:2,class:"col-12 d-flex flex-wrap"},Qh={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Xh={class:"remove"},Zh=["onClick"],xh={class:"col-12 mb-2"},em={class:"form-check"},tm=e("label",{class:"form-check-label",for:"need-page-video"}," Видео к странице ",-1),sm={key:1,class:"col-12 mb-2"},om=e("p",{class:"alert alert-danger"},[e("strong",null,"Внимание!"),h(" не больше 10 видео на 1й странице! ")],-1),lm={class:"col-12 mb-2"},im={class:"form-check"},nm=e("label",{class:"form-check-label",for:"need-page-audio"}," Звук к странице ",-1),am={key:2,class:"col-12 mb-2"},dm=e("p",{class:"alert alert-danger"},[e("strong",null,"Внимание!"),h(" не больше 10 аудио на 1й странице! ")],-1),rm={class:"col-12 mb-2"},cm={class:"form-check"},um=e("label",{class:"form-check-label",for:"need-page-document"}," Документ \\ презентацию к странице \\ картинку в оригинале ",-1),hm={key:3,class:"col-12 mb-2"},mm=e("p",{class:"alert alert-danger"},[e("strong",null,"Внимание!"),h(" не больше 10 документов на 1й странице! ")],-1),_m={class:"col-12 mb-2"},pm={class:"form-check"},bm=e("label",{class:"form-check-label",for:"need-reply-menu"}," Нижнее меню страницы ",-1),gm={key:4,class:"col-12 mb-2"},fm={class:"card"},ym={class:"card-header d-flex justify-between align-items-center"},$m=e("h6",null,"Конструктор нижнего меню",-1),km={key:0},vm={key:1},Fm={class:"card-body"},wm={class:"col-12 mb-2"},Cm={class:"form-label",id:"bot-domain"},Sm=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Vm=e("div",null," Заголовок для нижнего меню ",-1),jm={class:"col-12 mb-2"},Pm={class:"form-check"},Um=e("label",{class:"form-check-label",for:"need-inline-menu"}," Меню под текстом страницы ",-1),Bm={key:5,class:"col-12 mb-2"},Om={class:"card"},Tm={class:"card-header d-flex justify-between align-items-center"},Im=e("h6",null,"Конструктор меню в сообщении",-1),Dm={key:0},qm={key:1},Lm={class:"card-body"},Rm={class:"col-12 mb-2"},Gm={class:"form-check"},Mm=e("label",{class:"form-check-label",for:"need-page-attach"}," Связать с другой страницей ",-1),Am={key:6,class:"col-12 mb-2"},Km={key:0},zm={class:"col-12 mb-2"},Em={class:"form-check"},Nm=e("label",{class:"form-check-label",for:"need-slug-attach"}," Привязать скрипт ",-1),Ym={key:7,class:"col-12 mb-2"},Wm={key:0},Jm={class:"col-12 mb-2"},Hm={class:"form-check"},Qm=e("label",{class:"form-check-label",for:"need-dialog-attach"}," Привязать начало диалога ",-1),Xm={key:8,class:"col-12 mb-2"},Zm={key:0},xm={class:"row"},e_={class:"col-12 mb-2"},t_={class:"form-check"},s_=e("label",{class:"form-check-label",for:"need-rules"}," Нужны правила загрузки страницы ",-1),o_={key:0,class:"col-12 mb-2"},l_=e("div",{class:"row"},[e("div",{class:"col-12 mb-2"},[e("button",{class:"btn btn-outline-primary w-100 p-3"},"Сохранить страницу")])],-1),i_={props:["page"],data(){return{need_show_qr_and_link:!1,need_clean:!1,load:!1,photos:[],showReplyTemplateSelector:!1,showInlineTemplateSelector:!1,need_page_audios:!1,need_page_documents:!1,need_page_video:!1,need_page_images:!1,need_inline_menu:!1,need_reply_menu:!1,need_attach_page:!1,need_attach_dialog:!1,need_attach_slug:!1,need_rules:!1,bot:null,pageForm:{id:null,content:"",command:null,slug:null,comment:null,videos:[],images:[],audios:[],documents:[],reply_keyboard_title:null,reply_keyboard:null,inline_keyboard:null,is_external:!1,next_page_id:null,next_bot_dialog_command_id:null,next_bot_menu_slug_id:null,rules_if:null,rules_else_page_id:null,rules_if_message:null,rules_else_message:null}}},watch:{need_page_images:function(s,t){this.need_page_images||(this.photos=[],this.pageForm.images=[])},need_page_audios:function(s,t){this.need_page_audios||(this.pageForm.audios=[])},need_page_documents:function(s,t){this.need_page_documents||(this.pageForm.documents=[])},need_page_video:function(s,t){this.need_page_video||(this.pageForm.videos=[])},need_inline_menu:function(s,t){this.need_inline_menu||(this.pageForm.inline_keyboard=null,this.pageForm.inline_keyboard_id=null)},need_rules:function(s,t){this.need_rules||(this.pageForm.rules_if=null,this.pageForm.rules_else_page_id=null,this.pageForm.rules_if_message=null,this.pageForm.rules_else_message=null)},need_reply_menu:function(s,t){this.need_reply_menu||(this.pageForm.reply_keyboard=null,this.pageForm.reply_keyboard_id=null)},need_attach_page:function(s,t){this.need_attach_page||(this.pageForm.next_page_id=null)},need_attach_dialog:function(s,t){this.need_attach_dialog||(this.pageForm.next_bot_dialog_command_id=null)},need_attach_slug:function(s,t){this.need_attach_slug||(this.pageForm.next_bot_menu_slug_id=null)},pageForm:{handler:function(s){this.pageForm.reply_keyboard!=null&&(this.need_reply_menu=!0),this.pageForm.inline_keyboard!=null&&(this.need_inline_menu=!0),this.pageForm.images.length>0&&(this.need_page_images=!0),this.pageForm.next_bot_dialog_command_id!=null&&(this.need_attach_dialog=!0),this.pageForm.next_bot_menu_slug_id!=null&&(this.need_attach_slug=!0),this.pageForm.next_page_id!=null&&(this.need_attach_page=!0),this.pageForm.rules_if!=null&&(this.need_rules=!0),this.pageForm.videos.length>0&&(this.need_page_video=!0),this.pageForm.audios.length>0&&(this.need_page_audios=!0),this.pageForm.documents.length>0&&(this.need_page_documents=!0),this.need_clean=!0},deep:!0}},computed:{...C(["getCurrentBot"]),qr(){return"https://api.qrserver.com/v1/create-qr-code/?size=450x450&qzone=2&data="+this.link},pageLink(){if(!this.pageForm.id)return"Ссылка недоступна";let s="";for(let t=0;t<10-(""+this.pageForm.id).length;t++)s+="0";return s+=this.pageForm.id,"https://t.me/"+this.getCurrentBot.bot_domain+"?start="+btoa("004"+s)}},mounted(){if(this.page){let s=this.page;this.photos=[],this.pageForm={id:s.id,slug_id:s.slug?s.slug.id:null,content:s.content,command:s.slug?s.slug.command:null,slug:s.slug?s.slug.slug:null,comment:s.slug?s.slug.comment:null,images:s.images||[],reply_keyboard_title:s.reply_keyboard_title||null,reply_keyboard_id:s.reply_keyboard_id||null,inline_keyboard_id:s.inline_keyboard_id||null,reply_keyboard:s.replyKeyboard||null,inline_keyboard:s.inlineKeyboard||null,next_page_id:s.next_page_id||null,next_bot_dialog_command_id:s.next_bot_dialog_command_id||null,next_bot_menu_slug_id:s.next_bot_menu_slug_id||null,is_external:s.is_external||!1,rules_if:s.rules_if||null,rules_else_page_id:s.rules_else_page_id||null,audios:s.audios||[],documents:s.documents||[],videos:s.videos||[],rules_if_message:s.rules_if_message||null,rules_else_message:s.rules_else_message||null}}else this.clearForm();this.loadCurrentBot().then(()=>{})},methods:{copyToClipBoard(s){navigator.clipboard.writeText(s).then(()=>{this.$notify({title:"Копирование",text:"Ссылка скопирована в буфер"})}).catch(t=>{this.$notify({title:"Копирование",text:"Ошибка копирования",type:"error"})})},associateDialog(s){this.pageForm.next_bot_dialog_command_id=s.id},associateSlug(s){this.pageForm.next_bot_menu_slug_id=s.id},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},attachPage(s){s.id!=this.pageForm.id?this.pageForm.next_page_id=s.id:this.$notify({title:"Конструктор страниц",text:"Вы не можете связать данную страницу с собой",type:"error"})},injectContent(s){this.pageForm.content?this.pageForm.content+=s.text:this.pageForm.content=s.text},clearForm(){this.photos=[],this.pageForm={id:null,content:null,command:null,slug:null,comment:null,images:[],reply_keyboard:null,inline_keyboard:null,is_external:!1,videos:[],audios:[],documents:[],reply_keyboard_title:null,reply_keyboard_id:null,inline_keyboard_id:null,next_page_id:null,next_bot_dialog_command_id:null,next_bot_menu_slug_id:null,rules_if_message:null,rules_else_message:null},this.photos=[],this.showReplyTemplateSelector=!1,this.showInlineTemplateSelector=!1,this.need_page_images=!1,this.need_page_video=!1,this.need_inline_menu=!1,this.need_reply_menu=!1,this.need_attach_page=!1,this.need_attach_dialog=!1,this.need_attach_slug=!1,this.need_rules=!1,this.need_page_audios=!1,this.need_page_documents=!1,this.$nextTick(()=>{this.need_clean=!1})},submitPage(){let s=new FormData;if(Object.keys(this.pageForm).forEach(t=>{const o=this.pageForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.bot&&s.append("bot_id",this.bot.id),this.photos.length>0)for(let t=0;t<this.photos.length;t++)s.append("photos[]",this.photos[t]);this.$store.dispatch(this.pageForm.id==null?"createPage":"updatePage",{pageForm:s}).then(t=>{this.pageForm.id==null&&(this.load=!0,this.$nextTick(()=>{this.load=!1,this.clearForm()})),this.$emit("callback",t.data),this.$notify({title:"Конструктор ботов",text:this.pageForm.id==null?"Страница успешно создана!":"Страница успешно обновлена!",type:"success"}),this.pageForm.id!=null&&this.$store.dispatch("loadPages",{dataObject:{botId:this.bot.id},page:localStorage.getItem(`cashman_pagelist_${this.bot.id}_page_index`)||0})}).catch(t=>{})},saveInlineKeyboard(s){this.pageForm.inline_keyboard=s},selectReplyKeyboard(s){this.pageForm.reply_keyboard=s,this.showReplyTemplateSelector=!1},selectInlineKeyboard(s){this.pageForm.inline_keyboard=s,this.showInlineTemplateSelector=!1},saveReplyKeyboard(s){this.pageForm.reply_keyboard=s},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removePhoto(s){this.photos.splice(s,1)},removeImage(s){this.pageForm.images.splice(s,1)},onChangePhotos(s){const t=s.target.files;for(let o=0;o<t.length;o++)this.photos.push(t[o])},onChange(s){this.pageForm.content=s},selectPhoto(s){this.pageForm.images||(this.pageForm.images=[]);let t=this.pageForm.images.indexOf(s.file_id);t!==-1?this.pageForm.images.splice(t,1):this.pageForm.images.push(s.file_id)},selectVideo(s){this.pageForm.videos||(this.pageForm.videos=[]);let t=this.pageForm.videos.indexOf(s.file_id);t!==-1?this.pageForm.videos.splice(t,1):this.pageForm.videos.push(s.file_id)},selectAudio(s){this.pageForm.audios||(this.pageForm.audios=[]);let t=this.pageForm.audios.indexOf(s.file_id);if(s.type==="voice"){if(t!==-1){this.pageForm.audios.splice(t,1);return}this.pageForm.audios=[s.file_id];return}t!==-1?this.pageForm.audios.splice(t,1):this.pageForm.audios.push(s.file_id)},selectDocument(s){this.pageForm.documents||(this.pageForm.documents=[]);let t=this.pageForm.documents.indexOf(s.file_id);t!==-1?this.pageForm.documents.splice(t,1):this.pageForm.documents.push(s.file_id)}}},g$=Object.assign(i_,{__name:"Page",setup(s){return(t,o)=>{const n=U("Popper"),d=T("lazy");return t.bot?(l(),i("form",{key:0,onSubmit:o[24]||(o[24]=S((...a)=>t.submitPage&&t.submitPage(...a),["prevent"]))},[e("div",lh,[e("div",ih,[e("h6",nh,[e("span",null,"Вы создаете страницу для "+m(t.bot.bot_domain),1),t.pageForm.id||t.need_clean?(l(),i("a",{key:0,href:"#clear-form",onClick:o[0]||(o[0]=(...a)=>t.clearForm&&t.clearForm(...a))},"очистить форму")):r("",!0)])]),t.pageForm.id?(l(),i("div",ah,[e("div",dh,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[1]||(o[1]=a=>t.need_show_qr_and_link=a),type:"checkbox",id:"need-show-qr-and-link"},null,512),[[k,t.need_show_qr_and_link]]),rh])])):r("",!0),t.pageForm.id&&t.need_show_qr_and_link?(l(),i("div",ch,[e("p",null,[h("Ссылка на текущую страницу: "),e("span",{class:"bg-secondary font-bold cursor-pointer",onClick:o[2]||(o[2]=a=>t.copyToClipBoard(t.pageLink))},m(t.pageLink),1)]),e("div",uh,[c(e("img",hh,null,512),[[d,t.qr]])])])):r("",!0),e("div",mh,[e("label",_h,[$(n,null,{content:y(()=>[bh]),default:y(()=>[ph]),_:1}),h(" Команда "),gh]),c(e("input",{type:"text",class:"form-control",placeholder:"Команда","aria-label":"Команда","onUpdate:modelValue":o[3]||(o[3]=a=>t.pageForm.command=a),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[p,t.pageForm.command]])]),e("div",fh,[e("div",yh,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[4]||(o[4]=a=>t.pageForm.is_external=a),type:"checkbox",id:"is-external"},null,512),[[k,t.pageForm.is_external]]),$h])]),e("div",kh,[e("label",vh,[$(n,null,{content:y(()=>[wh]),default:y(()=>[Fh]),_:1}),h(" Описание страницы "),Ch]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Описание страницы","aria-label":"Описание страницы","onUpdate:modelValue":o[5]||(o[5]=a=>t.pageForm.comment=a),maxlength:"255","aria-describedby":"bot-domain",required:""},`
            `,512),[[p,t.pageForm.comment]])])]),t.pageForm.is_external?r("",!0):(l(),i("div",Sh,[e("div",Vh,[e("label",jh,[e("div",null,[$(n,null,{content:y(()=>[Uh]),default:y(()=>[Ph]),_:1}),h(" Текстовое содержимое страницы "),Bh]),$(Q,{param:"content",onCallback:t.injectContent},null,8,["onCallback"])]),e("div",Oh,[c(e("textarea",{class:"form-control","onUpdate:modelValue":o[6]||(o[6]=a=>t.pageForm.content=a),maxlength:"4096",placeholder:"Введите текст",id:"floatingTextarea2",style:{"min-height":"100px"}},null,512),[[p,t.pageForm.content]]),e("label",Th,[h("Содержимое страницы "),t.pageForm.content?(l(),i("span",Ih,m(t.pageForm.content.length)+"/4096 ",1)):r("",!0)])])]),e("div",Dh,[e("div",qh,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[7]||(o[7]=a=>t.need_page_images=a),type:"checkbox",id:"need-page-images"},null,512),[[k,t.need_page_images]]),Lh])]),t.need_page_images?(l(),i("div",Rh,[e("div",Gh,[Mh,e("div",Ah,[e("label",Kh,[h(" + "),e("input",{type:"file",id:"photos",multiple:"",accept:"image/*",onChange:o[8]||(o[8]=(...a)=>t.onChangePhotos&&t.onChangePhotos(...a)),style:{display:"none"}},null,32)]),e("div",zh,[t.photos.length>0?(l(),i("div",Eh,[(l(!0),i(b,null,f(t.photos,(a,_)=>(l(),i("div",Nh,[c(e("img",null,null,512),[[d,t.getPhoto(a).imageUrl]]),e("div",Yh,[e("a",{onClick:u=>t.removePhoto(_)},"Удалить",8,Wh)])]))),256))])):r("",!0),t.pageForm.images.length>0?(l(),i("h6",Jh,"Ранее загруженные фотографии")):r("",!0),t.pageForm.images.length>0?(l(),i("div",Hh,[(l(!0),i(b,null,f(t.pageForm.images,(a,_)=>(l(),i("div",Qh,[c(e("img",null,null,512),[[d,"/images-by-bot-id/"+t.bot.id+"/"+a]]),e("div",Xh,[e("a",{onClick:u=>t.removeImage(_)},"Удалить",8,Zh)])]))),256))])):r("",!0)])])])])):r("",!0),e("div",xh,[e("div",em,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[9]||(o[9]=a=>t.need_page_video=a),type:"checkbox",id:"need-page-video"},null,512),[[k,t.need_page_video]]),tm])]),t.need_page_video?(l(),i("div",sm,[om,$(I,{"need-video":!0,"need-video-note":!0,selected:t.pageForm.videos,onSelect:t.selectVideo},null,8,["selected","onSelect"])])):r("",!0),e("div",lm,[e("div",im,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[10]||(o[10]=a=>t.need_page_audios=a),type:"checkbox",id:"need-page-audio"},null,512),[[k,t.need_page_audios]]),nm])]),t.need_page_audios?(l(),i("div",am,[dm,$(I,{"need-audio":!0,selected:t.pageForm.audios,onSelect:t.selectAudio},null,8,["selected","onSelect"])])):r("",!0),e("div",rm,[e("div",cm,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[11]||(o[11]=a=>t.need_page_documents=a),type:"checkbox",id:"need-page-document"},null,512),[[k,t.need_page_documents]]),um])]),t.need_page_documents?(l(),i("div",hm,[mm,$(I,{"need-document":!0,selected:t.pageForm.documents,onSelect:t.selectDocument},null,8,["selected","onSelect"])])):r("",!0),e("div",_m,[e("div",pm,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[12]||(o[12]=a=>t.need_reply_menu=a),type:"checkbox",id:"need-reply-menu"},null,512),[[k,t.need_reply_menu]]),bm])]),t.need_reply_menu?(l(),i("div",gm,[e("div",fm,[e("div",ym,[$m,e("button",{class:F(["btn",{"btn-outline-primary":!t.showReplyTemplateSelector,"btn-primary":t.showReplyTemplateSelector}]),type:"button",onClick:o[13]||(o[13]=a=>t.showReplyTemplateSelector=!t.showReplyTemplateSelector)},[t.showReplyTemplateSelector?(l(),i("span",vm," Скрыть шаблоны меню")):(l(),i("span",km," Открыть шаблоны меню"))],2)]),e("div",Fm,[e("div",wm,[e("label",Cm,[$(n,null,{content:y(()=>[Vm]),default:y(()=>[Sm]),_:1}),h(" Заголовок ")]),c(e("input",{type:"text",class:"form-control",placeholder:"Заголовок меню","aria-label":"Заголовок меню","onUpdate:modelValue":o[14]||(o[14]=a=>t.pageForm.reply_keyboard_title=a),maxlength:"255","aria-describedby":"bot-domain"},null,512),[[p,t.pageForm.reply_keyboard_title]])]),t.showReplyTemplateSelector?(l(),v(q,{key:0,class:"mb-2",type:"reply",onSelect:t.selectReplyKeyboard,"select-mode":!0},null,8,["onSelect"])):(l(),v(O,{key:1,type:"reply",onSave:t.saveReplyKeyboard,"edited-keyboard":t.pageForm.reply_keyboard},null,8,["onSave","edited-keyboard"]))])])])):r("",!0),e("div",jm,[e("div",Pm,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[15]||(o[15]=a=>t.need_inline_menu=a),type:"checkbox",id:"need-inline-menu"},null,512),[[k,t.need_inline_menu]]),Um])]),t.need_inline_menu?(l(),i("div",Bm,[e("div",Om,[e("div",Tm,[Im,e("button",{class:F(["btn",{"btn-outline-primary":!t.showInlineTemplateSelector,"btn-primary":t.showInlineTemplateSelector}]),type:"button",onClick:o[16]||(o[16]=a=>t.showInlineTemplateSelector=!t.showInlineTemplateSelector)},[t.showInlineTemplateSelector?(l(),i("span",qm," Скрыть шаблоны меню")):(l(),i("span",Dm," Открыть шаблоны меню"))],2)]),e("div",Lm,[t.showInlineTemplateSelector?(l(),v(q,{key:0,class:"mb-2",type:"inline",onSelect:t.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(l(),v(O,{key:1,type:"inline",onSave:t.saveInlineKeyboard,"edited-keyboard":t.pageForm.inline_keyboard},null,8,["onSave","edited-keyboard"]))])])])):r("",!0),e("div",Rm,[e("div",Gm,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[17]||(o[17]=a=>t.need_attach_page=a),type:"checkbox",id:"need-page-attach"},null,512),[[k,t.need_attach_page]]),Mm])]),t.need_attach_page?(l(),i("div",Am,[t.pageForm.next_page_id?(l(),i("p",Km,[h("Связано со страницей #"+m(t.pageForm.next_page_id)+" ",1),e("a",{class:"btn btn-link",onClick:o[18]||(o[18]=a=>t.pageForm.next_page_id=null)},"Очистить")])):r("",!0),$(G,{current:t.pageForm.id,onCallback:t.attachPage,editor:!1},null,8,["current","onCallback"])])):r("",!0),e("div",zm,[e("div",Em,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[19]||(o[19]=a=>t.need_attach_slug=a),type:"checkbox",id:"need-slug-attach"},null,512),[[k,t.need_attach_slug]]),Nm])]),t.need_attach_slug?(l(),i("div",Ym,[t.pageForm.next_bot_menu_slug_id?(l(),i("p",Wm,[h("Связано со скриптом #"+m(t.pageForm.next_bot_menu_slug_id)+" ",1),e("a",{class:"btn btn-link",onClick:o[20]||(o[20]=a=>t.pageForm.next_bot_menu_slug_id=null)},"Очистить")])):r("",!0),t.bot?(l(),v(Sd,{key:1,global:!0,onCallback:t.associateSlug,bot:t.bot},null,8,["onCallback","bot"])):r("",!0)])):r("",!0),e("div",Jm,[e("div",Hm,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[21]||(o[21]=a=>t.need_attach_dialog=a),type:"checkbox",id:"need-dialog-attach"},null,512),[[k,t.need_attach_dialog]]),Qm])]),t.need_attach_dialog?(l(),i("div",Xm,[t.pageForm.next_bot_dialog_command_id?(l(),i("p",Zm,[h("Связано с диалогом #"+m(t.pageForm.next_bot_dialog_command_id)+" ",1),e("a",{class:"btn btn-link",onClick:o[22]||(o[22]=a=>t.pageForm.next_bot_dialog_command_id=null)},"Очистить")])):r("",!0),t.bot?(l(),v(Tc,{key:1,onSelectDialog:t.associateDialog,bot:t.bot},null,8,["onSelectDialog","bot"])):r("",!0)])):r("",!0)])),e("div",xm,[e("div",e_,[e("div",t_,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[23]||(o[23]=a=>t.need_rules=a),type:"checkbox",id:"need-rules"},null,512),[[k,t.need_rules]]),s_])]),t.need_rules?(l(),i("div",o_,[$(oh,{bot:t.bot,"rules-form":t.pageForm},null,8,["bot","rules-form"])])):r("",!0)]),l_],32)):r("",!0)}}}),n_={class:"row"},a_={class:"input-group mb-3"},d_=L('<div class="row"><div class="col-md-12 col-12"><button type="button" title="Создать новую группу" data-bs-toggle="modal" data-bs-target="#group-create-modal" class="btn btn-outline-success p-3 mb-2 mr-2"><i class="fa-solid fa-layer-group"></i></button><button type="button" data-bs-toggle="modal" data-bs-target="#dialog-create-modal" class="btn btn-outline-success p-3 mb-2"><i class="fa-regular fa-comment-dots" style="margin-right:10px;"></i>Создать новый диалоговый скрипт </button></div></div>',1),r_={key:0,class:"row"},c_={class:"col-12 mb-3"},u_={class:"card mb-2"},h_={class:"card-header"},m_=["onClick"],__=e("i",{class:"fa-solid fa-trash-can"},null,-1),p_=[__],b_={class:"card-body"},g_={key:0,class:"row"},f_={class:"col-md-12 col-lg-4 col-12 col-sm-12 mb-2"},y_={key:1,class:"row"},$_=e("div",{class:"col-12"},[e("p",null,"Диалоговых скриптов не найдено")],-1),k_=[$_],v_={class:"col-12"},F_={key:1,class:"row"},w_=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет созданных диалоговых групп ")],-1),C_=[w_],S_={class:"modal fade",id:"link-modal",tabindex:"-1"},V_={class:"modal-dialog modal-fullscreen"},j_={class:"modal-content"},P_=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"}," Диалог связывания "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),U_={key:0,class:"modal-body"},B_=e("h6",null,"Связать её с:",-1),O_={class:"row"},T_={class:"col-md-2 mb-1"},I_=["onClick"],D_=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),q_={class:"modal fade",id:"group-modal",tabindex:"-1"},L_={class:"modal-dialog modal-fullscreen"},R_={class:"modal-content"},G_=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"}," Диалог перемещения между группами "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),M_={key:0,class:"modal-body"},A_=e("h6",null,"Переместить её в группу",-1),K_={key:0,class:"row"},z_={class:"col-md-6 mb-1"},E_=["onClick"],N_={key:1,class:"row"},Y_=e("div",{class:"col-12"},[e("h6",null,"Перемещаем-с...")],-1),W_=[Y_],J_=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),H_={class:"modal fade",id:"group-create-modal",tabindex:"-1"},Q_={class:"modal-dialog modal-fullscreen"},X_={class:"modal-content"},Z_=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"}," Диалог создания группы "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),x_={class:"modal-body"},ep=e("div",{class:"alert alert-warning",role:"alert"}," Группировка имеет исключительно логическое значение! Группа помогает Вам ориентироваться в цепочках диалогов ",-1),tp={class:"form-floating mb-3"},sp=e("label",{for:"floatingInput"},"Мнемоническое имя (англ)",-1),op={class:"form-floating mb-3"},lp=e("label",{for:"floatingInput"},"Название группы",-1),ip=e("button",{type:"submit",class:"btn btn-outline-primary w-100 p-3"},"Создать",-1),np=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),ap={class:"modal fade",id:"dialog-create-modal",tabindex:"-1"},dp={class:"modal-dialog modal-fullscreen"},rp={class:"modal-content"},cp=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"}," Создание диалогового сообщения "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),up={class:"modal-body"},hp=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),mp={data(){return{bot:null,groupForm:{slug:null,title:null,bot_id:null},loading:!0,dialog_groups:[],search:null,dialog_groups_paginate_object:null,link:null,group:null}},computed:{...C(["getDialogGroups","getCurrentBot","getDialogGroupsPaginateObject"]),filteredCommands(){return this.link?this.dialog_groups.find(t=>t.id===this.link.group_id).bot_dialog_commands.filter(t=>t.id!=this.link.id):[]}},mounted(){this.loadCurrentBot().then(()=>{this.loadGroups()})},methods:{loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},removeGroup(s){this.loading=!0,this.$store.dispatch("removeDialogGroup",{dataObject:{dialogGroupId:s}}).then(t=>{this.loading=!1,this.$notify("Диалоговая группа успешно удалена"),this.loadGroups()}).catch(t=>{this.loading=!1})},addGroup(){this.loading=!0,this.groupForm.bot_id=this.bot.id;let s=new FormData;Object.keys(this.groupForm).forEach(t=>{const o=this.groupForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.$store.dispatch("createDialogGroup",{dialogGroupForm:s}).then(t=>{this.loading=!1,this.$notify("Диалоговая группа успешно создана"),this.groupForm={slug:null,title:null},this.loadGroups()}).catch(t=>{this.loading=!1})},doSwapGroup(s){this.loading=!0,this.$store.dispatch("swapDialogGroup",{swapForm:{dialogCommandId:this.group.command_id,dialogGroupId:s}}).then(t=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Диалоговая команда успешно перемещена в другую группу!",type:"success"}),this.loadGroups(),this.group.group_id=s}).catch(t=>{this.loading=!1})},doCommandLink(s){this.loading=!0,this.$store.dispatch("swapDialogCommand",{swapForm:{dialogCommandFromId:s,dialogCommandToId:this.link.id}}).then(t=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Диалоговая команда успешно слинкована!",type:"success"}),this.loadGroups(),this.link.current_next_id=s}).catch(t=>{this.loading=!1})},swapGroupInit(s){this.group=s,new bootstrap.Modal("#group-modal",{}).show()},tryLink(s){this.link=s,new bootstrap.Modal("#link-modal",{}).show()},selectDialog(s){this.$emit("select-dialog",s),this.$notify("Вы выбрали диалог из списка!")},selectGroup(s){this.$emit("select-group",s),this.$notify("Вы выбрали группу из списка!")},nextGroups(s){this.loadGroups(s)},loadGroups(s=0){this.loading=!0,this.$store.dispatch("loadDialogGroups",{dataObject:{botId:this.bot.id||null,search:this.search},page:s}).then(t=>{this.loading=!1,this.dialog_groups=this.getDialogGroups,this.dialog_groups_paginate_object=this.getDialogGroupsPaginateObject}).catch(()=>{this.loading=!1})}}},f$=Object.assign(mp,{__name:"BotDialogGroupList",setup(s){return(t,o)=>(l(),i(b,null,[e("div",n_,[e("div",a_,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск группы","aria-label":"Поиск группы","onUpdate:modelValue":o[0]||(o[0]=n=>t.search=n),"aria-describedby":"button-addon2"},null,512),[[p,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=(...n)=>t.loadGroups&&t.loadGroups(...n)),type:"button",id:"button-addon2"},"Найти ")])]),d_,t.dialog_groups.length>0?(l(),i("div",r_,[e("div",c_,[(l(!0),i(b,null,f(t.dialog_groups,(n,d)=>(l(),i("div",u_,[e("div",h_,[e("h6",null,[h(" #"+m(n.id)+" - "+m(n.title||"Не указано ")+" ",1),e("button",{onClick:a=>t.removeGroup(n.id),type:"button",class:"btn btn-outline-danger"},p_,8,m_)])]),e("div",b_,[n.bot_dialog_commands.length>0?(l(),i("div",g_,[(l(!0),i(b,null,f(n.bot_dialog_commands,(a,_)=>(l(),i("div",f_,[t.bot?(l(),v(A,{key:0,bot:t.bot,onCallback:t.loadGroups,onSelect:t.selectDialog,onSwap:t.swapGroupInit,onLink:t.tryLink,item:a},null,8,["bot","onCallback","onSelect","onSwap","onLink","item"])):r("",!0)]))),256))])):(l(),i("div",y_,k_))])]))),256))]),e("div",v_,[t.dialog_groups_paginate_object?(l(),v(V,{key:0,onPagination_page:t.nextGroups,pagination:t.dialog_groups_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",F_,C_)),e("div",S_,[e("div",V_,[e("div",j_,[P_,t.link?(l(),i("div",U_,[e("p",null,"Вы выбрали диалоговую команду #"+m(t.link.id),1),B_,e("div",O_,[(l(!0),i(b,null,f(t.filteredCommands,(n,d)=>(l(),i("div",T_,[e("button",{type:"button",onClick:a=>t.doCommandLink(n.id),class:F([{"btn-primary text-white":t.link.current_next_id==n.id},"btn btn-outline-primary w-100"])},"#"+m(n.id)+" "+m(n.pre_text||"Без текста"),11,I_)]))),256))])])):r("",!0),D_])])]),e("div",q_,[e("div",L_,[e("div",R_,[G_,t.group?(l(),i("div",M_,[e("p",null,"Вы выбрали диалоговую команду #"+m(t.group.command_id),1),A_,t.loading?(l(),i("div",N_,W_)):(l(),i("div",K_,[(l(!0),i(b,null,f(t.dialog_groups,(n,d)=>(l(),i("div",z_,[e("button",{type:"button",onClick:a=>t.doSwapGroup(n.id),class:F([{"btn-primary text-white":n.id==t.group.group_id},"btn btn-outline-primary w-100"])},"#"+m(n.id)+" "+m(n.title||"Без названия"),11,E_)]))),256))]))])):r("",!0),J_])])]),e("div",H_,[e("div",Q_,[e("div",X_,[Z_,e("div",x_,[ep,e("form",{onSubmit:o[4]||(o[4]=S((...n)=>t.addGroup&&t.addGroup(...n),["prevent"]))},[e("div",tp,[c(e("input",{type:"text",class:"form-control",id:"floatingInput",maxlength:"255",pattern:"[a-zA-Z0-9_]+","onUpdate:modelValue":o[2]||(o[2]=n=>t.groupForm.slug=n),required:""},null,512),[[p,t.groupForm.slug]]),sp]),e("div",op,[c(e("input",{type:"text",class:"form-control",id:"floatingInput",maxlength:"255","onUpdate:modelValue":o[3]||(o[3]=n=>t.groupForm.title=n),required:""},null,512),[[p,t.groupForm.title]]),lp]),ip],32)]),np])])]),e("div",ap,[e("div",dp,[e("div",rp,[cp,e("div",up,[t.bot?(l(),v(M,{key:0,onCallback:t.loadGroups,bot:t.bot},null,8,["onCallback","bot"])):r("",!0)]),hp])])])],64))}}),_p={props:["bot","item"],data(){return{sectionForm:{section:null},categoryForm:{label:null},tab:0,types:[{title:"Готовый продукт",value:1},{title:"Товар на вес",value:2},{title:"Конструктор товара",value:3}],productCategories:[],sections:["Общие характеристики","Дополнительная информация"],photos:[],categories:[],removed_options:[],productForm:{article:null,vk_product_id:null,title:null,description:null,images:[],type:1,old_price:null,current_price:null,variants:[],in_stop_list_at:null,bot_id:null,options:[],reviews:[],categories:[]}}},computed:{...C(["getProductCategories"]),filteredCategories(){return this.productCategories.length===0?this.categories:this.categories.filter(s=>this.productCategories.indexOf(s.value)===-1)}},mounted(){this.loadProductCategories(),this.item&&this.$nextTick(()=>{this.productForm={id:this.item.id||null,article:this.item.article||null,vk_product_id:this.item.vk_product_id||null,title:this.item.title||null,description:this.item.description||null,images:this.item.images||null,type:this.item.type||1,old_price:this.item.old_price||null,current_price:this.item.current_price||null,variants:this.item.variants||null,in_stop_list_at:this.item.in_stop_list_at||null,bot_id:this.item.bot_id||null,options:this.item.options||null,reviews:this.item.reviews||null},this.options=[],this.item.categories.forEach(s=>{this.productCategories.push(s.id)})})},methods:{prepareCategoryName(s){let t=this.categories.find(o=>o.value===s);return console.log(t),t?t.label:s},addCategory(){const s=this.categoryForm.label;this.productCategories.push(s),this.categoryForm.label=null},selectCategory(s){this.productCategories.push(s.value)},submit(){let s=new FormData;if(Object.keys(this.productForm).forEach(t=>{const o=this.productForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.bot&&s.append("bot_id",this.bot.id),this.photos.length>0)for(let t=0;t<this.photos.length;t++)s.append("photos[]",this.photos[t]);this.removed_options.length>0&&s.append("removed_options",JSON.stringify(this.removed_options)),this.productCategories.length>0&&s.append("categories",JSON.stringify(this.productCategories)),this.$store.dispatch("saveProduct",{productForm:s}).then(t=>{this.load=!0,this.$notify({title:"Конструктор ботов",text:"Продукт успешно сохранен!",type:"success"}),this.clearForm(),this.$emit("refresh")}).catch(t=>{})},onChangePhotos(s){const t=s.target.files;for(let o=0;o<t.length;o++)this.photos.push(t[o])},loadProductCategories(){this.$store.dispatch("loadProductCategories",{dataObject:{bot_id:this.bot.id}}).then(()=>{this.getProductCategories.forEach(t=>{this.categories.push({value:t.id,label:t.title})})})},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removeSection(s){this.sections.splice(s,1)},addSection(){this.sections.push(this.sectionForm.section),this.sectionForm.section=null},addOption(){this.productForm.options||(this.productForm.options=[]),this.productForm.options.push({id:null,key:null,value:null,title:null,section:null})},addVariant(){this.productForm.variants||(this.productForm.variants=[]),this.productForm.variants.push({key:null,value:null})},removeProductCategory(s){this.productCategories.splice(s,1)},removeVariant(s){this.productForm.variants.splice(s,1)},removeOption(s){this.productForm.options[s].id&&this.removed_options.push(this.productForm.options[s].id),this.productForm.options.splice(s,1)},removeImage(s){this.productForm.images.splice(s,1)},removePhoto(s){this.photos.splice(s,1)},clearForm(){const s={article:null,vk_product_id:null,title:null,description:null,images:[],type:1,old_price:null,current_price:null,variants:[],in_stop_list_at:null,bot_id:null,options:[],reviews:[],categories:[]};this.photos=[],this.removed_options=[],this.productCategories=[],this.productForm=s}}},pp={class:"nav nav-tabs"},bp={class:"nav-item"},gp={class:"nav-item"},fp={class:"nav-item"},yp={key:0},$p={class:"col-md-8 d-flex align-items-center"},kp={class:"form-check"},vp=e("label",{class:"form-check-label",for:"in-stop-list"}," Товар находится в стоп-листе ",-1),Fp={class:"col-md-4 d-flex justify-content-end"},wp={class:"col-md-12 mb-3"},Cp=["onClick"],Sp={class:"dropdown"},Vp=e("button",{type:"button",class:"btn btn-outline-info w-100","data-bs-toggle":"dropdown","data-bs-display":"static","aria-expanded":"false"},[e("p",{class:"mb-0"},"Выберите категорию")],-1),jp={class:"dropdown-menu w-100",style:{"overflow-y":"scroll",height:"300px"}},Pp={class:"p-3"},Up=e("label",{for:"exampleDropdownFormEmail1",class:"form-label"},"Новая категория",-1),Bp={class:"p-3"},Op=e("li",null,[e("hr",{class:"dropdown-divider"})],-1),Tp=["onClick"],Ip={class:"col-md-6"},Dp={class:"form-floating mb-3"},qp=e("label",{for:"article"},"Артикул товара",-1),Lp={class:"col-md-6"},Rp={class:"form-floating mb-3"},Gp=e("label",{for:"vk-product-id"},"Идентификатор товара VK",-1),Mp={class:"col-md-6"},Ap={class:"form-floating mb-3"},Kp=e("label",{for:"title"},"Названи товара",-1),zp={class:"col-md-6"},Ep={class:"form-floating mb-3"},Np=["value"],Yp=e("label",{for:"type"},"Тип товара",-1),Wp={class:"col-md-12"},Jp={class:"form-floating mb-3"},Hp=e("label",{for:"description"},"Описание товара",-1),Qp={class:"col-md-6"},Xp={class:"form-floating mb-3"},Zp=e("label",{for:"current-price"},"Актуальная цена",-1),xp={class:"col-md-6"},eb={class:"form-floating mb-3"},tb=e("label",{for:"old-price"},"Старая цена",-1),sb={class:"col-md-12 mb-3"},ob={class:"card"},lb={class:"card-header"},ib={key:0},nb={class:"card-body"},ab={class:"row"},db={class:"col-12 mb-3"},rb={class:"col-md-6 mb-3"},cb={class:"card w-100"},ub={class:"card-body"},hb={class:"form-floating mb-3"},mb=["onUpdate:modelValue","id"],_b=["for"],pb={class:"form-floating mb-3"},bb=["onUpdate:modelValue","id"],gb=["for"],fb={class:"card-footer"},yb=["onClick"],$b=e("i",{class:"fa-solid fa-trash-can"},null,-1),kb=[$b],vb={class:"col-md-12 mb-3"},Fb={class:"card"},wb=e("div",{class:"card-header"},[e("h6",null,"Характеристики товара")],-1),Cb={class:"card-body"},Sb={class:"row mb-3"},Vb={class:"col-12"},jb=e("button",{class:"btn btn-outline-info",type:"submit",id:"button-addon2"},"Добавить секцию ",-1),Pb={class:"badge bg-info mr-1"},Ub=["onClick"],Bb=e("i",{class:"fa-solid fa-xmark"},null,-1),Ob=[Bb],Tb={class:"row"},Ib={class:"col-md-4 mb-3"},Db={class:"card w-100"},qb={class:"card-body"},Lb={class:"form-floating mb-3"},Rb=["onUpdate:modelValue","id"],Gb=["for"],Mb={class:"form-floating mb-3"},Ab=["onUpdate:modelValue","id"],Kb=["for"],zb={class:"form-floating mb-3"},Eb=["onUpdate:modelValue","id"],Nb=e("option",{value:null},"Без секции",-1),Yb=["value"],Wb=["for"],Jb={class:"card-footer"},Hb=["onClick"],Qb=e("i",{class:"fa-solid fa-trash-can"},null,-1),Xb=[Qb],Zb={class:"row"},xb={class:"col-12"},eg={class:"col-md-12 mb-3"},tg=e("h6",null,"Фотографии товара",-1),sg={class:"photo-preview d-flex justify-content-start flex-wrap w-100"},og={for:"location-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},lg=e("span",null,"+",-1),ig={class:"mb-2 img-preview",style:{"margin-right":"10px"}},ng={class:"remove"},ag=["onClick"],dg={class:"mb-2 img-preview",style:{"margin-right":"10px"}},rg={class:"remove"},cg=["onClick"],ug=e("div",{class:"col-12"},[e("button",{type:"submit",class:"btn btn-outline-primary w-100 p-3"},"Сохранить ")],-1),hg={key:1};function mg(s,t,o,n,d,a){const _=T("lazy");return l(),i(b,null,[e("ul",pp,[e("li",bp,[e("a",{class:F(["nav-link",{active:d.tab===0}]),onClick:t[0]||(t[0]=u=>d.tab=0),"aria-current":"page",href:"#product-form-info"},"Информация о товаре",2)]),e("li",gp,[e("a",{class:F(["nav-link",{active:d.tab===1}]),onClick:t[1]||(t[1]=u=>d.tab=1),href:"#product-reviews"},"Комментарии",2)]),e("li",fp,[e("a",{class:F(["nav-link",{active:d.tab===2}]),onClick:t[2]||(t[2]=u=>d.tab=2),href:"#product-reviews"},"Заказы",2)])]),d.tab===0?(l(),i("div",yp,[e("form",{onSubmit:t[19]||(t[19]=S((...u)=>a.submit&&a.submit(...u),["prevent"])),class:"row"},[e("div",$p,[e("div",kp,[c(e("input",{class:"form-check-input","onUpdate:modelValue":t[3]||(t[3]=u=>d.productForm.in_stop_list_at=u),type:"checkbox",value:"false",id:"in-stop-list"},null,512),[[k,d.productForm.in_stop_list_at]]),vp])]),e("div",Fp,[e("a",{href:"#",class:"btn btn-link",onClick:t[4]||(t[4]=(...u)=>a.clearForm&&a.clearForm(...u))},"Новый товар")]),e("div",wp,[(l(!0),i(b,null,f(d.productCategories,(u,g)=>(l(),i("span",{class:"badge bg-info mr-1 mb-1 cursor-pointer",onClick:w=>a.removeProductCategory(g)},m(a.prepareCategoryName(u)),9,Cp))),256)),e("div",Sp,[Vp,e("ul",jp,[e("div",Pp,[Up,c(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[5]||(t[5]=u=>d.categoryForm.label=u),id:"exampleDropdownFormEmail1",placeholder:"Название категории"},null,512),[[p,d.categoryForm.label]])]),e("div",Bp,[e("button",{class:"btn btn-primary w-100",type:"button",onClick:t[6]||(t[6]=(...u)=>a.addCategory&&a.addCategory(...u))},"Добавить категорию ")]),Op,(l(!0),i(b,null,f(a.filteredCategories,u=>(l(),i("li",null,[e("button",{class:"dropdown-item",type:"button",onClick:g=>a.selectCategory(u)},m(u.label),9,Tp)]))),256))])])]),e("div",Ip,[e("div",Dp,[c(e("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=u=>d.productForm.article=u),class:"form-control",id:"article",placeholder:"name@example.com"},null,512),[[p,d.productForm.article]]),qp])]),e("div",Lp,[e("div",Rp,[c(e("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=u=>d.productForm.vk_product_id=u),disabled:!0,class:"form-control",id:"vk-product-id",placeholder:"name@example.com"},null,512),[[p,d.productForm.vk_product_id]]),Gp])]),e("div",Mp,[e("div",Ap,[c(e("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=u=>d.productForm.title=u),class:"form-control",id:"title",placeholder:"name@example.com"},null,512),[[p,d.productForm.title]]),Kp])]),e("div",zp,[e("div",Ep,[c(e("select",{class:"form-select","onUpdate:modelValue":t[10]||(t[10]=u=>d.productForm.type=u),id:"type","aria-label":"Floating label select example"},[(l(!0),i(b,null,f(d.types,(u,g)=>(l(),i("option",{value:u.value},m(u.title),9,Np))),256))],512),[[j,d.productForm.type]]),Yp])]),e("div",Wp,[e("div",Jp,[c(e("textarea",{class:"form-control","onUpdate:modelValue":t[11]||(t[11]=u=>d.productForm.description=u),placeholder:"Leave a comment here",id:"description"},null,512),[[p,d.productForm.description]]),Hp])]),e("div",Qp,[e("div",Xp,[c(e("input",{type:"number","onUpdate:modelValue":t[12]||(t[12]=u=>d.productForm.current_price=u),class:"form-control",id:"current-price",placeholder:"name@example.com"},null,512),[[p,d.productForm.current_price]]),Zp])]),e("div",xp,[e("div",eb,[c(e("input",{type:"number","onUpdate:modelValue":t[13]||(t[13]=u=>d.productForm.old_price=u),class:"form-control",id:"old-price",placeholder:"name@example.com"},null,512),[[p,d.productForm.old_price]]),tb])]),e("div",sb,[e("div",ob,[e("div",lb,[e("h6",null,[h("Варианты товара "),d.productForm.variants?(l(),i("span",ib,"("+m(d.productForm.variants.length)+")",1)):r("",!0)])]),e("div",nb,[e("div",ab,[e("div",db,[e("button",{type:"button",class:"btn btn-outline-info w-100",onClick:t[14]||(t[14]=(...u)=>a.addVariant&&a.addVariant(...u))},"Добавить вариант ")]),(l(!0),i(b,null,f(d.productForm.variants,(u,g)=>(l(),i("div",rb,[e("div",cb,[e("div",ub,[e("div",hb,[c(e("input",{type:"text","onUpdate:modelValue":w=>d.productForm.variants[g].key=w,class:"form-control",id:"variant-key-"+g,placeholder:"name@example.com",required:""},null,8,mb),[[p,d.productForm.variants[g].key]]),e("label",{for:"variant-key-"+g},"Ключ",8,_b)]),e("div",pb,[c(e("input",{type:"text","onUpdate:modelValue":w=>d.productForm.variants[g].value=w,class:"form-control",id:"variant-value-"+g,placeholder:"name@example.com",required:""},null,8,bb),[[p,d.productForm.variants[g].value]]),e("label",{for:"variant-value-"+g},"Значение",8,gb)])]),e("div",fb,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:w=>a.removeVariant(g)},kb,8,yb)])])]))),256))])])])]),e("div",vb,[e("div",Fb,[wb,e("div",Cb,[e("div",Sb,[e("div",Vb,[e("form",{onSubmit:t[16]||(t[16]=S((...u)=>a.addSection&&a.addSection(...u),["prevent"])),class:"input-group mb-3"},[c(e("input",{type:"text","onUpdate:modelValue":t[15]||(t[15]=u=>d.sectionForm.section=u),class:"form-control border-info",placeholder:"Название секции","aria-label":"Recipient's username","aria-describedby":"button-addon2",required:""},null,512),[[p,d.sectionForm.section]]),jb],32),(l(!0),i(b,null,f(d.sections,(u,g)=>(l(),i("span",Pb,[h(m(u)+" ",1),e("strong",{onClick:w=>a.removeSection(g)},Ob,8,Ub)]))),256))])]),e("div",Tb,[(l(!0),i(b,null,f(d.productForm.options,(u,g)=>(l(),i("div",Ib,[e("div",Db,[e("div",qb,[e("div",Lb,[c(e("input",{type:"text","onUpdate:modelValue":w=>d.productForm.options[g].title=w,class:"form-control",id:"option-title-"+g,placeholder:"name@example.com"},null,8,Rb),[[p,d.productForm.options[g].title]]),e("label",{for:"option-title-"+g},"Название характеристики",8,Gb)]),e("div",Mb,[c(e("input",{type:"text","onUpdate:modelValue":w=>d.productForm.options[g].value=w,class:"form-control",id:"option-value-"+g,placeholder:"name@example.com"},null,8,Ab),[[p,d.productForm.options[g].value]]),e("label",{for:"option-value-"+g},"Значение характеристики",8,Kb)]),e("div",zb,[c(e("select",{class:"form-select","onUpdate:modelValue":w=>d.productForm.options[g].section=w,id:"option-section-"+g,"aria-label":"Floating label select example"},[Nb,(l(!0),i(b,null,f(d.sections,w=>(l(),i("option",{value:w},m(w),9,Yb))),256))],8,Eb),[[j,d.productForm.options[g].section]]),e("label",{for:"option-section-"+g},"Секция товара",8,Wb)])]),e("div",Jb,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:w=>a.removeOption(g)},Xb,8,Hb)])])]))),256))]),e("div",Zb,[e("div",xb,[e("button",{type:"button",class:"btn btn-outline-info w-100",onClick:t[17]||(t[17]=(...u)=>a.addOption&&a.addOption(...u))},"Добавить характеристику ")])])])])]),e("div",eg,[tg,e("div",sg,[e("label",og,[lg,e("input",{type:"file",id:"location-photos",multiple:"",accept:"image/*",onChange:t[18]||(t[18]=(...u)=>a.onChangePhotos&&a.onChangePhotos(...u)),style:{display:"none"}},null,32)]),d.productForm.images?(l(!0),i(b,{key:0},f(d.productForm.images,(u,g)=>(l(),i("div",ig,[c(e("img",null,null,512),[[_,u]]),e("div",ng,[e("a",{onClick:w=>a.removeImage(g)},"Удалить",8,ag)])]))),256)):r("",!0),d.photos.length>0?(l(!0),i(b,{key:1},f(d.photos,(u,g)=>(l(),i("div",dg,[c(e("img",null,null,512),[[_,a.getPhoto(u).imageUrl]]),e("div",rg,[e("a",{onClick:w=>a.removePhoto(g)},"Удалить",8,cg)])]))),256)):r("",!0)])]),ug],32)])):r("",!0),d.tab===1?(l(),i("div",hg," Отзывы ")):r("",!0)],64)}const _g=P(_p,[["render",mg]]),pg={props:["item"],data(){return{bot:null}},methods:{preparedImgUrl(s){return s.toLocaleLowerCase().startsWith("https://")||s.toLocaleLowerCase().startsWith("http://")?s:"/images-by-bot-id/"+this.bot.id+"/"+s},removeProduct(){this.$store.dispatch("removeProduct",this.item.id).then(s=>{this.$notify({title:"Конструктор ботов",text:"Продукт успешно удален!",type:"success"})}).catch(s=>{})},duplicateProduct(){this.$store.dispatch("duplicateProduct",this.item.id).then(s=>{this.$notify({title:"Конструктор ботов",text:"Продукт успешно продублирован!",type:"success"})}).catch(s=>{})}},mounted(){this.bot=this.getCurrentBot},computed:{...C(["getCurrentBot"])}},bg={key:0,class:"card"},gg={class:"card-header"},fg={class:"card-body"},yg=["id"],$g={class:"carousel-inner"},kg=["src"],vg=["data-bs-target"],Fg=e("span",{class:"carousel-control-prev-icon","aria-hidden":"true"},null,-1),wg=e("span",{class:"visually-hidden"},"Previous",-1),Cg=[Fg,wg],Sg=["data-bs-target"],Vg=e("span",{class:"carousel-control-next-icon","aria-hidden":"true"},null,-1),jg=e("span",{class:"visually-hidden"},"Next",-1),Pg=[Vg,jg],Ug={class:"card-footer d-flex justify-content-between"},Bg=e("i",{class:"fa-regular fa-copy"},null,-1),Og=[Bg],Tg=e("i",{class:"fa-solid fa-trash-can"},null,-1),Ig=[Tg];function Dg(s,t,o,n,d,a){return d.bot?(l(),i("div",bg,[e("div",gg,[e("p",null,"#"+m(o.item.id),1)]),e("div",fg,[e("p",null,m(o.item.title),1),e("div",{id:"image-slider-"+o.item.id,class:"carousel slide","data-bs-ride":"carousel"},[e("div",$g,[(l(!0),i(b,null,f(o.item.images,(_,u)=>(l(),i("div",{class:F(["carousel-item",{active:u===0}]),style:{height:"300px"}},[e("img",{src:a.preparedImgUrl(_),class:"d-block w-100 object-fit-cover",alt:"..."},null,8,kg)],2))),256))]),e("button",{class:"carousel-control-prev",type:"button","data-bs-target":"#image-slider-"+o.item.id,"data-bs-slide":"prev"},Cg,8,vg),e("button",{class:"carousel-control-next",type:"button","data-bs-target":"#image-slider-"+o.item.id,"data-bs-slide":"next"},Pg,8,Sg)],8,yg)]),e("div",Ug,[e("button",{title:"Дублировать товар",onClick:t[0]||(t[0]=(..._)=>a.duplicateProduct&&a.duplicateProduct(..._)),class:"btn btn-outline-info mr-1"},Og),e("button",{title:"Удалить товар",onClick:t[1]||(t[1]=(..._)=>a.removeProduct&&a.removeProduct(..._)),class:"btn btn-outline-danger"},Ig)])])):r("",!0)}const qg=P(pg,[["render",Dg]]),Lg=e("button",{class:"btn btn-outline-info",type:"submit",id:"button-addon2"}," Найти ",-1),Rg={key:0},Gg={class:"row"},Mg={class:"col-4 mb-2"},Ag={props:["bot"],data(){return{search:null,products:[],paginate:null}},computed:{...C(["getProducts","getProductsPaginateObject"]),filteredProducts(){return this.search?this.products.filter(s=>s.title.toLowerCase().trim().indexOf(this.search.toLowerCase().trim())>=0):this.products}},mounted(){this.loadProducts()},methods:{selectProduct(s){this.$emit("select",s)},nextProducts(s){this.loadProducts(s)},loadProducts(s=0){return this.$store.dispatch("loadProducts",{dataObject:{bot_id:this.bot.id,search:this.search},page:s}).then(()=>{this.products=this.getProducts,this.paginate=this.getProductsPaginateObject})}}},Kg=Object.assign(Ag,{__name:"ProductList",setup(s){return(t,o)=>(l(),i(b,null,[e("form",{class:"input-group mb-3",onSubmit:o[1]||(o[1]=S(n=>t.loadProducts(0),["prevent"]))},[c(e("input",{type:"text",class:"form-control border-info",placeholder:"Поиск товара","aria-label":"Поиск товара","onUpdate:modelValue":o[0]||(o[0]=n=>t.search=n),"aria-describedby":"button-addon2",required:""},null,512),[[p,t.search]]),Lg],32),e("p",null,[h("Всего товаров: "),t.paginate?(l(),i("span",Rg,m(t.paginate.meta.total||0),1)):r("",!0)]),e("div",Gg,[(l(!0),i(b,null,f(t.filteredProducts,(n,d)=>(l(),i("div",Mg,[$(qg,{onClick:a=>t.selectProduct(n),item:n},null,8,["onClick","item"])]))),256))]),t.paginate?(l(),v(V,{key:0,onPagination_page:t.nextProducts,pagination:t.paginate},null,8,["onPagination_page","pagination"])):r("",!0)],64))}}),zg={class:"card mb-2"},Eg=e("div",{class:"card-header"},[e("h6",null,"Управление магазином")],-1),Ng={class:"card-body"},Yg={class:"row"},Wg={class:"col-12"},Jg={class:"form-label d-flex justify-content-between mt-2",id:"bot-level-3"},Hg=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Qg=e("div",null,"Ссылка на страницу ВК с товарами для вашего магазина в боте ",-1),Xg=e("a",{href:"https://vk.com/groups?w=groups_create",target:"_blank"},"Создать",-1),Zg=["disabled"],xg=e("i",{class:"fa-regular fa-floppy-disk mr-2"},null,-1),ef={class:"row mb-3"},tf={class:"col-md-3"},sf=["href"],of=L('<div class="col-md-3"><button class="btn btn-outline-info w-100">Экспорт в XLS</button></div><div class="col-md-3"><button class="btn btn-outline-info w-100">Импорт из XLS</button></div><div class="col-md-3"><button class="btn btn-outline-danger w-100">Удалить товары</button></div>',3),lf=e("div",{class:"row"},[e("div",{class:"col-md-3"},[e("button",{class:"btn btn-outline-info w-100"},"Экспортировать заказы")])],-1),nf={class:"card"},af=e("div",{class:"card-header"},[e("h6",null,"Работа с товаром")],-1),df={class:"card-body"},rf={class:"card mt-2"},cf={class:"card-body"},uf={data(){return{load:!1,tab:0,url:null,link:null,bot:null,selectedProduct:null,botForm:{vk_shop_link:null}}},computed:{...C(["getCurrentBot"])},mounted(){this.bot=this.getCurrentBot,this.botForm.vk_shop_link=this.bot.vk_shop_link||null,this.updateProducts()},methods:{updateShopLink(){this.load=!0,this.botForm.bot_id=this.bot.id,this.$store.dispatch("updateShopLink",{botForm:this.botForm}).then(s=>{this.load=!1,this.updateProducts(),this.$notify({title:"Менеджер магазина",text:"Ссылка на источник в ВК обновлена"})}).catch(()=>{this.load=!1})},refresh(){this.load=!0,this.selectedProduct=null,this.$nextTick(()=>{this.load=!1})},selectProduct(s){this.load=!0,this.$nextTick(()=>{this.selectedProduct=s,this.load=!1})},updateProducts(){this.load=!0,this.$store.dispatch("updateProductsFromVk",{dataObject:{botDomain:this.getCurrentBot.bot_domain}}).then(s=>{this.link=s.data.url,this.load=!1,this.url=null}).catch(()=>{this.load=!1})}}},y$=Object.assign(uf,{__name:"Shop",setup(s){return(t,o)=>{const n=U("Popper");return l(),i(b,null,[e("div",zg,[Eg,e("div",Ng,[e("div",Yg,[e("div",Wg,[e("form",{onSubmit:o[1]||(o[1]=S((...d)=>t.updateShopLink&&t.updateShopLink(...d),["prevent"])),class:"mb-2"},[e("label",Jg,[e("div",null,[$(n,null,{content:y(()=>[Qg]),default:y(()=>[Hg]),_:1}),h(" ВК-группа ")]),Xg]),c(e("input",{type:"url",class:"form-control",placeholder:"Ссылка на группу ВК","aria-label":"ссылка на группу ВК","onUpdate:modelValue":o[0]||(o[0]=d=>t.botForm.vk_shop_link=d),"aria-describedby":"vk_shop_link"},null,512),[[p,t.botForm.vk_shop_link]]),e("button",{disabled:t.load,class:"btn btn-outline-primary mt-2 mb-2 w-100"},[xg,h(" Сохранить ")],8,Zg)],32)])]),e("div",ef,[e("div",tf,[e("a",{target:"_blank",href:t.link,class:"btn btn-primary w-100"}," Обновить товар ",8,sf)]),of]),lf])]),e("div",nf,[af,e("div",df,[t.bot&&!t.load?(l(),v(_g,{key:0,bot:t.bot,item:t.selectedProduct,onRefresh:t.refresh},null,8,["bot","item","onRefresh"])):r("",!0)])]),e("div",rf,[e("div",cf,[t.bot&&!t.load?(l(),v(Kg,{key:0,bot:t.bot,onSelect:t.selectProduct},null,8,["bot","onSelect"])):r("",!0)])])],64)}}}),hf={props:["data"],data(){return{hasConnect:!1,bot:null,amoForm:{client_id:null,client_secret:null,auth_code:null,redirect_uri:null,subdomain:null,bot_id:null}}},computed:{...C(["getCurrentBot"])},mounted(){this.bot=this.getCurrentBot,this.data?this.$nextTick(()=>{this.amoForm.client_id=this.data.client_id||null,this.amoForm.client_secret=this.data.client_secret||null,this.amoForm.auth_code=this.data.auth_code||null,this.amoForm.redirect_uri=this.data.redirect_uri||null,this.amoForm.subdomain=this.data.subdomain||null,this.amoForm.bot_id=this.data.bot_id||this.bot.id||null}):this.amoForm.bot_id=this.bot.id||null},methods:{submitAmo(){let s=new FormData;Object.keys(this.amoForm).forEach(t=>{const o=this.amoForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.$store.dispatch("saveAmoCRM",{amoForm:s}).then(t=>{this.$notify("Данные CRM успешно сохранены")}).catch(t=>{})}}},mf=e("div",{class:"col-12"},[e("p",null,[e("a",{target:"_blank",href:"https://www.amocrm.ru/developers/content/oauth/step-by-step"},"Документация для разработчика "),h(" по шагам")])],-1),_f={class:"col-md-6 col-12 mb-2"},pf={class:"form-label",id:"client_id"},bf=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),gf=e("div",null,"ID интеграции",-1),ff=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),yf={class:"col-md-6 col-12 mb-2"},$f={class:"form-label",id:"client_secret"},kf=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),vf=e("div",null,"Секрет интеграции",-1),Ff=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),wf={class:"col-md-6 mb-2"},Cf={class:"form-label",id:"auth_code"},Sf=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Vf=e("div",null,"Полученный код авторизации",-1),jf=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Pf={class:"col-md-6 col-12 mb-2"},Uf={class:"form-label",id:"subdomain2"},Bf=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Of=e("div",null,"Ваш поддомен в системе AMO CRM",-1),Tf=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),If=e("div",{class:"col-md-12 col-12"},[e("button",{type:"submit",class:"btn btn-outline-primary p-3 w-100"},[e("i",{class:"fa-solid fa-cloud-arrow-down mr-1"}),h(" Сохранить настройку AMO ")])],-1);function Df(s,t,o,n,d,a){const _=U("Popper");return l(),i("form",{onSubmit:t[4]||(t[4]=S((...u)=>a.submitAmo&&a.submitAmo(...u),["prevent"])),class:"row"},[mf,e("div",_f,[e("label",pf,[$(_,null,{content:y(()=>[gf]),default:y(()=>[bf]),_:1}),h(" client_id "),ff]),c(e("input",{type:"text",class:"form-control",placeholder:"client_id","aria-label":"client_id","onUpdate:modelValue":t[0]||(t[0]=u=>d.amoForm.client_id=u),"aria-describedby":"client_id"},null,512),[[p,d.amoForm.client_id]])]),e("div",yf,[e("label",$f,[$(_,null,{content:y(()=>[vf]),default:y(()=>[kf]),_:1}),h(" client_secret "),Ff]),c(e("input",{type:"text",class:"form-control",placeholder:"client_secret","aria-label":"client_secret","onUpdate:modelValue":t[1]||(t[1]=u=>d.amoForm.client_secret=u),"aria-describedby":"client_secret"},null,512),[[p,d.amoForm.client_secret]])]),e("div",wf,[e("label",Cf,[$(_,null,{content:y(()=>[Vf]),default:y(()=>[Sf]),_:1}),h(" auth_code "),jf]),c(e("textarea",{class:"form-control",placeholder:"auth_code","aria-label":"auth_code","onUpdate:modelValue":t[2]||(t[2]=u=>d.amoForm.auth_code=u),"aria-describedby":"auth_code"},`
                                    `,512),[[p,d.amoForm.auth_code]])]),e("div",Pf,[e("label",Uf,[$(_,null,{content:y(()=>[Of]),default:y(()=>[Bf]),_:1}),h(" subdomain "),Tf]),c(e("input",{type:"text",class:"form-control",placeholder:"subdomain","aria-label":"subdomain","onUpdate:modelValue":t[3]||(t[3]=u=>d.amoForm.subdomain=u),"aria-describedby":"subdomain"},null,512),[[p,d.amoForm.subdomain]])]),If],32)}const $$=P(hf,[["render",Df]]),qf={props:["data"],data(){return{load:!1,bot:null,yClientsForm:{login:null,password:null,partner_token:null,company:null}}},computed:{...C(["getCurrentBot"])},mounted(){this.bot=this.getCurrentBot,this.data&&this.$nextTick(()=>{this.yClientsForm.login=this.data.login||null,this.yClientsForm.password=this.data.password||null,this.yClientsForm.partner_token=this.data.partner_token||null,this.yClientsForm.company=this.data.company||null})},methods:{submitYClients(){let s=new FormData;Object.keys(this.yClientsForm).forEach(t=>{const o=this.yClientsForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),s.append("bot_id",this.bot.id),this.$store.dispatch("saveYClients",{yClientsForm:s}).then(t=>{this.$notify({title:"Работа с YClients",text:"Данные YClients успешно сохранены",type:"success"})}).catch(t=>{this.$notify({title:"Работа с YClients",text:"Ошибка сохранения данных",type:"error"})})}}},Lf=e("h6",null,"Настройка YClients",-1),Rf={class:"row"},Gf={class:"col-md-12"},Mf={class:"mb-2"},Af=e("label",{class:"form-label d-flex justify-content-between mt-2",for:"login"},[h(" Логин "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),Kf={class:"mb-2"},zf=e("label",{class:"form-label d-flex justify-content-between mt-2",for:"password"},[h(" Пароль "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),Ef={class:"mb-2"},Nf=e("label",{class:"form-label d-flex justify-content-between mt-2",for:"partner_token"},[h(" Партнерский тоукен "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),Yf={class:"mb-2"},Wf=e("label",{class:"form-label d-flex justify-content-between mt-2",for:"partner_token"},[h(" ID компании, в которую записывать клиентов "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),Jf=e("button",{class:"btn btn-success w-100 r mb-3 text-uppercase font-900"}," Сохранить ",-1);function Hf(s,t,o,n,d,a){return l(),i(b,null,[Lf,e("form",{onSubmit:t[4]||(t[4]=S((..._)=>a.submitYClients&&a.submitYClients(..._),["prevent"]))},[e("div",Rf,[e("div",Gf,[e("div",Mf,[Af,c(e("input",{type:"text",id:"login",class:"form-control",placeholder:"Ваш логин","aria-label":"Ваш логин","onUpdate:modelValue":t[0]||(t[0]=_=>d.yClientsForm.login=_),"aria-describedby":"Ваш логин",required:""},null,512),[[p,d.yClientsForm.login]])]),e("div",Kf,[zf,c(e("input",{type:"text",id:"password",class:"form-control",placeholder:"Ваш пароль","aria-label":"Ваш пароль","onUpdate:modelValue":t[1]||(t[1]=_=>d.yClientsForm.password=_),"aria-describedby":"Ваш пароль",required:""},null,512),[[p,d.yClientsForm.password]])]),e("div",Ef,[Nf,c(e("input",{type:"text",id:"partner_token",class:"form-control",placeholder:"Ваш партнерский тоукен","aria-label":"Ваш партнерский тоукен","onUpdate:modelValue":t[2]||(t[2]=_=>d.yClientsForm.partner_token=_),"aria-describedby":"Ваш партнерский тоукен",required:""},null,512),[[p,d.yClientsForm.partner_token]])]),e("div",Yf,[Wf,c(e("input",{type:"number",id:"throttle",class:"form-control",placeholder:"ID компании","aria-label":"ID компании","onUpdate:modelValue":t[3]||(t[3]=_=>d.yClientsForm.company=_),"aria-describedby":"ID компании",required:""},null,512),[[p,d.yClientsForm.company]])])])]),Jf],32)],64)}const k$=P(qf,[["render",Hf]]),Qf={data(){return{load:!1,bot:null,fieldTypes:[{title:"Текст",value:0},{title:"Число",value:1},{title:"Логический",value:2},{title:"Дата и время",value:3}],fieldForm:{fields:[]}}},computed:{...C(["getCurrentBot"])},mounted(){this.loadCurrentBot().then(()=>{this.bot=this.getCurrentBot,this.$nextTick(()=>{this.fieldForm.fields=this.bot.field_settings||[]}),this.loadCurrentBotFields()})},methods:{loadCurrentBotFields(){return this.$store.dispatch("loadCurrentBotFields",{bot_id:this.bot.id}).then(s=>{this.fieldForm.fields=s.data||[]})},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},removeField(s){this.fieldForm.fields.splice(s,1)},submit(){let s=new FormData;Object.keys(this.fieldForm).forEach(t=>{const o=this.fieldForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),s.append("bot_id",this.bot.id),this.$store.dispatch("storeBotFields",{dataObject:s}).then(t=>{this.$notify({title:"Конструктор ботов",text:"Поля успешно обновлены",type:"success"}),this.fieldForm.fields=[],this.fieldForm.fields=t.data}).catch(t=>{this.$notify({title:"Конструктор ботов",text:"Ошибка обновления полей",type:"error"})})},addField(){if(this.fieldForm.fields||(this.fieldForm.fields=[]),this.fieldForm.fields.length>0&&this.fieldForm.fields.findIndex(t=>t.key==null)!==-1){this.$notify({title:"Настраиваемые поля",text:"У вас есть пустые ключевые поля!",type:"error"});return}this.fieldForm.fields.push({key:null,type:0,label:null,description:null,required:!1,validate_pattern:null})}}},Xf={class:"mb-2"},Zf={class:"d-flex justify-content-between"},xf=e("h6",null,"Настройка полей пользователя бота",-1),e1=e("i",{class:"fa-solid fa-plus mr-2"},null,-1),t1=e("p",null,[e("em",null,"Данные поля будут добавлены пользователю бота и будут автоматически учитываться в условиях страниц, скриптах (в формах заполнения данных), диалогах. Ключи должны быть уникальные для каждого бота. Если ключ дублируется, то будет использовано более позднее его значение. Если поле добавлено и сохранено, то удалить его уже нельзя, только скрыть. "),h(". "),e("br"),e("span",{class:"text-danger"},"*"),h(" - обязательное поле ")],-1),s1={class:"table"},o1=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},[h("Ключ"),e("span",{class:"text-danger"},"*")]),e("th",{scope:"col"},[h("Подпись поля"),e("span",{class:"text-danger"},"*")]),e("th",{scope:"col"},[h("Тип поля"),e("span",{class:"text-danger"},"*")]),e("th",{scope:"col"},"Паттерн"),e("th",{scope:"col"},"Обязательный"),e("th",{scope:"col"},[h("Вопрос для анкеты"),e("span",{class:"text-danger"},"*")]),e("th",{scope:"col"})])],-1),l1={scope:"row"},i1={scope:"col"},n1=["onUpdate:modelValue"],a1={scope:"col"},d1=["onUpdate:modelValue"],r1={scope:"col"},c1=["onUpdate:modelValue"],u1=["value"],h1={scope:"col"},m1=["disabled","onUpdate:modelValue"],_1={scope:"col"},p1={class:"form-check"},b1=["onUpdate:modelValue","id"],g1=["for"],f1={key:0},y1={key:1},$1={scope:"col"},k1=["onUpdate:modelValue"],v1={scope:"col"},F1=["onClick"],w1=e("i",{class:"fa-regular fa-trash-can"},null,-1),C1=[w1],S1={key:1,class:"form-check mt-2"},V1=["onUpdate:modelValue","id"],j1=["for"],P1={key:0},U1=e("i",{class:"fa-solid fa-eye text-success"},null,-1),B1=[U1],O1={key:1},T1=e("i",{class:"fa-solid fa-eye-slash text-danger"},null,-1),I1=[T1],D1=e("button",{type:"submit",class:"btn btn-success w-100 p-3"}," Сохранить поля ",-1);function q1(s,t,o,n,d,a){return l(),i("div",Xf,[e("div",Zf,[xf,e("button",{type:"button",onClick:t[0]||(t[0]=_=>a.addField()),class:"btn mb-2 rounded-sm btn-outline-info"},[e1,h(" Добавить параметр ")])]),t1,e("form",{onSubmit:t[1]||(t[1]=S((..._)=>a.submit&&a.submit(..._),["prevent"]))},[e("table",s1,[o1,e("tbody",null,[(l(!0),i(b,null,f(d.fieldForm.fields,(_,u)=>(l(),i("tr",null,[e("th",l1,m(u+1),1),e("th",i1,[c(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Ключ","aria-label":"Ключ",maxlength:"255","onUpdate:modelValue":g=>d.fieldForm.fields[u].key=g,required:""},null,8,n1),[[p,d.fieldForm.fields[u].key]])]),e("th",a1,[c(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Подпись поля","aria-label":"Название поля",maxlength:"255","onUpdate:modelValue":g=>d.fieldForm.fields[u].label=g,required:""},null,8,d1),[[p,d.fieldForm.fields[u].label]])]),e("th",r1,[c(e("select",{class:"form-select","onUpdate:modelValue":g=>d.fieldForm.fields[u].type=g},[(l(!0),i(b,null,f(d.fieldTypes,g=>(l(),i("option",{value:g.value},m(g.title||"Не указан"),9,u1))),256))],8,c1),[[j,d.fieldForm.fields[u].type]])]),e("th",h1,[c(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Паттерн","aria-label":"Паттерн",maxlength:"255",disabled:d.fieldForm.fields[u].type===2,"onUpdate:modelValue":g=>d.fieldForm.fields[u].validate_pattern=g},null,8,m1),[[p,d.fieldForm.fields[u].validate_pattern]])]),e("th",_1,[e("div",p1,[c(e("input",{class:"form-check-input","onUpdate:modelValue":g=>d.fieldForm.fields[u].required=g,type:"checkbox",value:"",id:"field-required"+u},null,8,b1),[[k,d.fieldForm.fields[u].required]]),e("label",{class:"form-check-label",for:"field-required"+u},[d.fieldForm.fields[u].required?(l(),i("span",f1,"Да")):r("",!0),d.fieldForm.fields[u].required?r("",!0):(l(),i("span",y1,"Нет"))],8,g1)])]),e("th",$1,[c(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Описание вопроса","aria-label":"Описание вопроса",maxlength:"255","onUpdate:modelValue":g=>d.fieldForm.fields[u].description=g,required:""},null,8,k1),[[p,d.fieldForm.fields[u].description]])]),e("th",v1,[d.fieldForm.fields[u].id?(l(),i("div",S1,[c(e("input",{class:"form-check-input d-none","onUpdate:modelValue":g=>d.fieldForm.fields[u].is_active=g,type:"checkbox",value:"",id:"field-is_active-"+u},null,8,V1),[[k,d.fieldForm.fields[u].is_active]]),e("label",{class:"form-check-label",for:"field-is_active-"+u},[d.fieldForm.fields[u].is_active?(l(),i("span",P1,B1)):r("",!0),d.fieldForm.fields[u].is_active?r("",!0):(l(),i("span",O1,I1))],8,j1)])):(l(),i("button",{key:0,type:"button",onClick:g=>a.removeField(u),class:"btn btn-link text-danger"},C1,8,F1))])]))),256))])]),D1],32)])}const v$=P(Qf,[["render",q1]]),L1={class:"row"},R1={class:"input-group mb-3"},G1={key:0,class:"row"},M1={class:"col-12 col-md-12 mb-3"},A1={class:"table"},K1=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"Тип"),e("th",{scope:"col"},"Подпись"),e("th",{scope:"col"},"File Id"),e("th",{scope:"col"},"Действия")])],-1),z1={scope:"row"},E1={class:"badge bg-info rounded-pill"},N1=["onClick"],Y1=["onClick"],W1={class:"col-12"},J1={key:1,class:"row"},H1=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет медиа-файлов ")],-1),Q1=[H1],X1={data(){return{bot:null,loading:!0,media:[],search:null,media_paginate_object:null}},computed:{...C(["getMedia","getMediaPaginateObject","getCurrentBot"])},mounted(){this.loadCurrentBot().then(()=>{this.loadMedia()})},methods:{selectMedia(s){this.$emit("select",s)},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},nextMedia(s){this.loadMedia(s)},remove(s){this.$store.dispatch("removeMedia",{dataObject:{mediaId:s}}).then(t=>{this.loadMedia(),this.$notify({title:"Удаление медиа-контента",text:"Медиа контент удален"})}).catch(()=>{})},showPreview(s){this.$store.dispatch("showMediaPreview",{dataObject:{mediaId:s}}).then(t=>{this.$notify({title:"Превью медиа-контента",text:"Отправлено в бота"})}).catch(()=>{})},loadMedia(s=0){this.loading=!0,this.$store.dispatch("loadMedia",{dataObject:{bot_id:this.bot.id||null,search:this.search,needVideo:!0,needVideoNote:!0,needPhoto:!0,needAudio:!0,needDocument:!0},page:s}).then(t=>{this.loading=!1,this.media=this.getMedia,this.media_paginate_object=this.getMediaPaginateObject}).catch(()=>{this.loading=!1})}}},F$=Object.assign(X1,{__name:"BotMediaTable",setup(s){return(t,o)=>(l(),i(b,null,[e("div",L1,[e("div",R1,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск файла","aria-label":"Поиск файла","onUpdate:modelValue":o[0]||(o[0]=n=>t.search=n)},null,512),[[p,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=n=>t.loadMedia(0)),type:"button",id:"button-addon2"},"Найти ")])]),t.media.length>0?(l(),i("div",G1,[e("div",M1,[e("table",A1,[K1,e("tbody",null,[(l(!0),i(b,null,f(t.media,(n,d)=>(l(),i("tr",null,[e("th",z1,m(n.id),1),e("td",null,[e("span",E1,m(n.type),1)]),e("td",null,m(n.caption??"Без подписи"),1),e("td",null,[e("a",{href:"#file",onClick:a=>t.showPreview(n.id)},m(n.file_id),9,N1)]),e("td",null,[e("a",{href:"javascript:void(0)",class:"btn btn-link p-0 my-2 text-danger",onClick:a=>t.remove(n.id)},"Удалить",8,Y1)])]))),256))])])]),e("div",W1,[t.media_paginate_object?(l(),v(V,{key:0,onPagination_page:t.nextMedia,pagination:t.media_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",J1,Q1))],64))}}),Z1={key:0},x1={class:"row"},ey={class:"col-md-12 d-flex flex-column"},ty={class:"d-flex"},sy={class:"dropdown mr-2"},oy=e("button",{class:"btn btn-outline-primary dropdown-toggle",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"}," Фильтры ",-1),ly={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},iy=["onClick"],ny={class:"input-group mb-3"},ay={key:0,class:"mt-2"},dy={class:"badge bg-info mr-1"},ry=["onClick"],cy=e("i",{class:"fa-solid fa-xmark"},null,-1),uy=[cy],hy={key:0,class:"row"},my={class:"col-12"},_y={class:"mb-0"},py={class:"mb-0"},by={key:1,class:"row"},gy={class:"col-12 mb-3"},fy={key:0,class:"col-12 mb-3"},yy={class:"table"},$y=e("th",{scope:"col"},"Действие",-1),ky={scope:"row"},vy=["onClick"],Fy=["onClick"],wy={key:0,class:"badge bg-primary"},Cy={key:1},Sy=["onClick"],Vy=e("i",{class:"fa-regular fa-copy"},null,-1),jy=[Vy],Py=["onClick"],Uy=e("i",{class:"fa-solid fa-boxes-packing"},null,-1),By=[Uy],Oy=["onClick"],Ty=e("i",{class:"fa-solid fa-box-open"},null,-1),Iy=[Ty],Dy=["onClick"],qy=e("i",{class:"fa-solid fa-trash-can text-white"},null,-1),Ly=[qy],Ry={class:"col-lg-4 col-12 mb-3"},Gy={class:"card-body"},My=["onClick"],Ay={key:0,class:"badge bg-info"},Ky={class:"card-footer d-flex"},zy=["onClick"],Ey=e("i",{class:"fa-regular fa-copy"},null,-1),Ny=[Ey],Yy=["onClick"],Wy=e("i",{class:"fa-solid fa-boxes-packing"},null,-1),Jy=[Wy],Hy=["onClick"],Qy=e("i",{class:"fa-solid fa-box-open"},null,-1),Xy=[Qy],Zy=["onClick"],xy=e("i",{class:"fa-solid fa-trash-can text-white"},null,-1),e$=[xy],t$={class:"col-12"},s$={key:2,class:"row"},o$=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранной компании нет созданных ботов! ")],-1),l$=[o$],i$={props:["companyId","editor"],data(){return{displayType:1,direction:"desc",order:"updated_at",filters:[{name:"Активные",icon:"fa-brands fa-telegram",slug:"active"},{name:"Архивные",icon:"fa-solid fa-box-archive",slug:"archive"}],selectedFilters:[],show:!0,loading:!0,bots:[],search:null,bots_paginate_object:null}},watch:{displayType:function(s,t){localStorage.setItem("cashman_set_botlist_display_type",this.displayType)}},computed:{...C(["getBots","getBotsPaginateObject","getCurrentCompany"]),filteredBots(){if(!this.bots)return[];if(this.selectedFilters.length===0&&this.search==null)return this.bots;if(this.selectedFilters.length===0&&this.search!=null)return this.bots.filter(t=>(t.bot_domain||"").trim().toLowerCase().indexOf(this.search.trim().toLowerCase())!==-1);let s=[];return this.selectedFilters.forEach(t=>{switch(t.slug){case"active":this.bots.filter(o=>o.deleted_at==null).forEach(o=>{s.push(o)});break;case"archive":this.bots.filter(o=>o.deleted_at!=null).forEach(o=>{s.push(o)});break}}),this.search==null?s:s.filter(t=>(t.bot_domain||"").trim().toLowerCase().indexOf(this.search.trim().toLowerCase())!==-1)}},mounted(){this.loadBots(),this.selectFilter("active"),this.displayType=parseInt(localStorage.getItem("cashman_set_botlist_display_type")||0)},methods:{duplicate(s){if(!this.getCurrentCompany){this.$notify("У Вас не выбран клиент!");return}this.$store.dispatch("duplicateBot",{dataObject:{bot_id:s,company_id:this.getCurrentCompany.id}}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно продублирован")})},addToArchive(s){this.$store.dispatch("removeBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен в архив")})},forceDelete(s){this.$store.dispatch("forceDeleteBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен из архива")})},extractFromArchive(s){this.$store.dispatch("restoreBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен из архива")})},selectFilter(s){let t=this.filters.find(o=>o.slug===s);t&&this.selectedFilters.filter(o=>o.slug===s).length===0&&this.selectedFilters.push(t)},removeSelectedFilter(s){let t=this.selectedFilters.findIndex(o=>o.slug===s);this.selectedFilters.splice(t,1)},selectBot(s){this.$emit("callback",s),this.show=!1,this.$notify("Вы выбрали бота из списка! Все остальные действия будут производится для этого бота.")},nextBots(s){this.loadBots(s)},loadAndOrder(s){this.order=s,this.direction=this.direction==="desc"?"asc":"desc",this.loadBots(0)},loadBots(s=0){this.loading=!0,this.$store.dispatch("loadBots",{dataObject:{companyId:this.companyId||null,search:this.search,order:this.order,direction:this.direction},page:s,size:100}).then(t=>{this.loading=!1,this.bots=this.getBots,this.bots_paginate_object=this.getBotsPaginateObject}).catch(()=>{this.loading=!1})}}},w$=Object.assign(i$,{__name:"BotList",setup(s){return(t,o)=>t.show?(l(),i("div",Z1,[e("div",x1,[e("div",ey,[e("div",ty,[e("div",sy,[oy,e("ul",ly,[(l(!0),i(b,null,f(t.filters,n=>(l(),i("li",null,[e("a",{class:"dropdown-item",onClick:d=>t.selectFilter(n.slug),href:"#filter"},[e("i",{class:F([n.icon,"mr-2"])},null,2),h(" "+m(n.name||"Не указано"),1)],8,iy)]))),256))])]),e("div",ny,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск бота","aria-label":"Поиск бота","onUpdate:modelValue":o[0]||(o[0]=n=>t.search=n),"aria-describedby":"button-addon2"},null,512),[[p,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=(...n)=>t.loadBots&&t.loadBots(...n)),type:"button",id:"button-addon2"},"Найти ")])]),t.selectedFilters.length>0?(l(),i("p",ay,[(l(!0),i(b,null,f(t.selectedFilters,n=>(l(),i("span",dy,[h(m(n.name||"не указан")+" ",1),e("a",{onClick:d=>t.removeSelectedFilter(n.slug),class:"ml-1 text-white",href:"#filter"},uy,8,ry)]))),256))])):r("",!0)])]),t.bots_paginate_object?(l(),i("div",hy,[e("div",my,[e("p",_y,"Количество найденных ботов "+m(t.bots_paginate_object.meta.total||0),1),e("p",py,"Количество результатов на странице "+m(t.filteredBots.length||0),1),e("p",null,[h(" Тип отображения списка: "),e("span",{onClick:o[2]||(o[2]=n=>t.displayType=0),class:F([{"bg-success":t.displayType===0,"bg-secondary":t.displayType!==0},"badge cursor-pointer mr-2"])},"Карточки",2),e("span",{class:F([{"bg-success":t.displayType===1,"bg-secondary":t.displayType!==1},"badge cursor-pointer mr-2"]),onClick:o[3]||(o[3]=n=>t.displayType=1)},"Таблица",2)])])])):r("",!0),t.bots.length>0?(l(),i("div",by,[e("div",gy,[s.editor?r("",!0):(l(),i("button",{key:0,type:"button",class:"btn btn-outline-info",onClick:o[4]||(o[4]=n=>t.selectBot(null))},"Создать нового бота "))]),t.displayType===1?(l(),i("div",fy,[e("table",yy,[e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"cursor-pointer",onClick:o[5]||(o[5]=n=>t.loadAndOrder("id"))},"#"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[6]||(o[6]=n=>t.loadAndOrder("bot_domain"))},"Домен"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[7]||(o[7]=n=>t.loadAndOrder("title"))},"Название"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[8]||(o[8]=n=>t.loadAndOrder("template_description"))},"Шаблон"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[9]||(o[9]=n=>t.loadAndOrder("updated_at"))},"Дата изменения"),$y])]),e("tbody",null,[(l(!0),i(b,null,f(t.filteredBots,(n,d)=>(l(),i("tr",{class:F({"border-info":n.deleted_at==null,"border-danger":n.deleted_at!=null})},[e("th",ky,m(n.id),1),e("td",{onClick:a=>t.selectBot(n)},[e("i",{class:F([{"text-danger":n.deleted_at!=null},"fa-solid fa-robot mr-2"])},null,2),h(" "+m(n.bot_domain||"Не указано"),1)],8,vy),e("td",{onClick:a=>t.selectBot(n)},m(n.title||"Не указано"),9,Fy),e("td",null,[n.is_template?(l(),i("span",wy,m(n.template_description||"Не указано"),1)):(l(),i("span",Cy,"Не является шаблоном"))]),e("td",null,m(t.$filters.current(n.updated_at)),1),e("td",null,[e("button",{class:"btn btn-outline-info mr-2",type:"button",onClick:a=>t.duplicate(n.id),title:"Дублировать"},jy,8,Sy),n.deleted_at==null?(l(),i("button",{key:0,class:"btn btn-outline-info",type:"button",onClick:a=>t.addToArchive(n.id),title:"В архив"},By,8,Py)):r("",!0),n.deleted_at!=null?(l(),i("button",{key:1,class:"btn btn-outline-info mr-2",onClick:a=>t.extractFromArchive(n.id),title:"Из архива"},Iy,8,Oy)):r("",!0),n.deleted_at!=null?(l(),i("button",{key:2,class:"btn btn-danger mr-2",onClick:a=>t.forceDelete(n.id),title:"Удалить на совсем"},Ly,8,Dy)):r("",!0)])],2))),256))])])])):r("",!0),t.displayType===0?(l(!0),i(b,{key:1},f(t.filteredBots,(n,d)=>(l(),i("div",Ry,[e("div",{class:F(["card w-100",{"border-info":n.deleted_at==null,"border-secondary":n.deleted_at!=null}])},[e("div",Gy,[e("p",{class:"d-flex justify-content-between",onClick:a=>t.selectBot(n),style:{"word-wrap":"break-word"}},[e("span",null,[e("i",{class:F([{"text-danger":n.deleted_at!=null},"fa-solid fa-robot mr-2"])},null,2),h(" "+m(n.bot_domain||"Не указано"),1)]),n.is_template?(l(),i("span",Ay,m(n.template_description||"Шаблон без названия"),1)):r("",!0)],8,My)]),e("div",Ky,[e("button",{class:"btn btn-outline-info mr-2",type:"button",onClick:a=>t.duplicate(n.id),title:"Дублировать"},Ny,8,zy),n.deleted_at==null?(l(),i("button",{key:0,class:"btn btn-outline-info",type:"button",onClick:a=>t.addToArchive(n.id),title:"В архив"},Jy,8,Yy)):r("",!0),n.deleted_at!=null?(l(),i("button",{key:1,class:"btn btn-outline-info mr-2",onClick:a=>t.extractFromArchive(n.id),title:"Из архива"},Xy,8,Hy)):r("",!0),n.deleted_at!=null?(l(),i("button",{key:2,class:"btn btn-danger mr-2",onClick:a=>t.forceDelete(n.id),title:"Удалить на совсем"},e$,8,Zy)):r("",!0)])],2)]))),256)):r("",!0),e("div",t$,[t.bots_paginate_object?(l(),v(V,{key:0,onPagination_page:t.nextBots,pagination:t.bots_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",s$,l$))])):r("",!0)}});export{$$ as A,v$ as B,k$ as Y,b$ as _,w$ as a,G as b,g$ as c,f$ as d,F$ as e,y$ as f,_$ as g,p$ as h};
