import{Y as S,q as n,t as r,v as t,A as h,H as u,Q as w,F as _,C as f,J as y,K as k,x as p,y as g,X as K,G as T,P as V,D as C,L as B,B as U}from"./index.es-77235f88.js";import{V as M,T as j}from"./TelegramChannelHelper-587b5dac.js";import{_ as q}from"./_plugin-vue_export-helper-c27b6911.js";import{v as F}from"./v4-a960c1f4.js";const O={props:["editedKeyboard","type"],components:{Vue3JsonEditor:M},computed:{uuid(){return F()}},watch:{keyboard:{handler:function(o){this.save()},deep:!0}},data(){return{editor:!1,showCode:!1,showAssign:!1,selectedRow:null,load:!1,rowCount:1,keyboard:[],select:{row:0,col:0,type:this.type||"reply"}}},mounted(){this.editedKeyboard&&this.$nextTick(()=>{this.keyboard=this.editedKeyboard.menu})},methods:{needRemoveField(o,e,s){Object.keys(this.keyboard[e][s]).forEach(i=>{i!=="text"&&i!==o&&delete this.keyboard[e][s][i]})},save(){this.$emit("save",this.keyboard)},onJsonChange(o){this.keyboard=o,this.save()},removeColFromRow(o){this.keyboard[o].length>1?this.keyboard[o].splice(this.keyboard[o].length-1,1):this.keyboard.splice(o,1),this.keyboard.length===0&&(this.selectedRow=null),this.save()},addRowAbove(){this.addRow(!0)},moveCol(o,e=0){o!==this.select.row&&(this.select.row=o,this.select.col=0,this.select.text=this.keyboard[this.select.row][this.select.col].text);let s=this.select.row,i=this.select.col,l=this.keyboard[s].length,c=e===0?i-1>=0?i-1:l-1:i<l-1?i+1:0,v=this.keyboard[s][i];this.keyboard[s][i]=this.keyboard[s][c],this.keyboard[s][c]=v,this.select.row=s,this.select.col=c,this.select.text=this.keyboard[s][c].text},moveRow(o=0){if(this.selectedRow==null)return;let e=this.keyboard.length,s=o===0?this.selectedRow-1>=0?this.selectedRow-1:e-1:this.selectedRow<e-1?this.selectedRow+1:0,i=this.keyboard[this.selectedRow];this.keyboard[this.selectedRow]=this.keyboard[s],this.keyboard[s]=i,this.selectedRow=s},addRowBelow(){this.addRow(!1)},addRow(o=!1){if(this.selectedRow==null)this.keyboard?this.keyboard.push([{text:"No Text"}]):this.keyboard=[[{text:"No Text"}]],this.selectedRow=null;else{let e=o?this.selectedRow:this.selectedRow+1;this.keyboard.splice(e,0,[{text:"No Text"}])}this.save()},addColToRow(o){this.keyboard[o].push({text:"No Text"}),this.save()},selectIndex(o,e){this.selectedRow=o,this.select.row=o,this.select.col=e,this.select.text=this.keyboard[o][e].text||"",this.load=!0,this.$nextTick(()=>{this.load=!1})},removeCol(o,e){this.keyboard[o].length>1?this.keyboard[o].splice(e,1):this.keyboard.splice(1,1),this.save()}}},J={key:0,class:"container"},N={class:"row"},D={class:"col-12 d-flex justify-content-between"},E=t("i",{class:"fa-solid fa-arrows-up-to-line"},null,-1),A=[E],L=t("i",{class:"fa-solid fa-arrows-down-to-line"},null,-1),P=[L],z=t("i",{class:"fa-solid fa-xmark"},null,-1),G=[z],H={class:"d-flex flex-column"},Y={class:"form-check"},Q=["id"],X=["for"],W={key:0,class:"col-12"},Z={class:"row"},I={class:"col-2 d-flex justify-content-around p-2"},x=["onClick"],ee=t("i",{class:"fa-solid fa-plus"},null,-1),te=[ee],oe=["onClick"],se=t("i",{class:"fa-solid fa-minus"},null,-1),le=[se],ie=["onClick"],ne=t("i",{class:"fa-solid fa-caret-left"},null,-1),ae=[ne],de=["onClick"],re=t("i",{class:"fa-solid fa-caret-right"},null,-1),ce=[re],he={class:"col-10 d-flex justify-content-center p-1"},be={class:"btn-group dropdown-center w-100 m-1"},ue=["onClick","onUpdate:modelValue"],me=["data-bs-target"],ye=t("i",{class:"fa-solid fa-bars"},null,-1),_e=[ye],pe=["id"],fe={class:"modal-dialog"},ke={class:"modal-content"},ve={class:"modal-body"},ge={class:"px-4 py-3"},$e=t("div",{class:"alert alert-danger",role:"alert"}," Возможно выбрать только 1 тип действия ",-1),Ce={class:"mb-3"},we=["for"],Fe=["id","onUpdate:modelValue"],Re=t("hr",null,null,-1),Ke={class:"mb-3"},Te=["for"],Ve=["onChange","onUpdate:modelValue","id"],Se={class:"mb-3"},Be=["for"],Ue=["onChange","onUpdate:modelValue","id"],Me={class:"mb-3"},je=["for"],qe=["onChange","onUpdate:modelValue","id"],Oe={class:"mb-3"},Je=["for"],Ne=["onChange","onUpdate:modelValue","id"],De={class:"form-check"},Ee=["onChange","id"],Ae=["for"],Le={class:"form-check"},Pe=["onChange","onClick","id"],ze=["for"],Ge={class:"form-check"},He=["onChange","onClick","id"],Ye=["for"],Qe={key:0,class:"row"},Xe={class:"col-12"},We=t("label",{class:"form-label",id:"bot-domain"},"JSON-код клавиатуры",-1);function Ze(o,e,s,i,l,c){const v=S("Vue3JsonEditor");return l.editor?h("",!0):(n(),r("div",J,[t("div",N,[t("div",D,[t("div",null,[l.selectedRow==null?(n(),r("button",{key:0,type:"button",class:"btn btn-primary mb-2",onClick:e[0]||(e[0]=(...m)=>c.addRow&&c.addRow(...m))},"Добавить строку ")):h("",!0),l.selectedRow!=null?(n(),r("button",{key:1,type:"button",class:"btn btn-primary mb-2",onClick:e[1]||(e[1]=(...m)=>c.addRowAbove&&c.addRowAbove(...m))},"Добавить строку выше ")):h("",!0),l.selectedRow!=null?(n(),r("button",{key:2,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:e[2]||(e[2]=(...m)=>c.addRowBelow&&c.addRowBelow(...m))},"Добавить строку ниже ")):h("",!0),l.selectedRow!=null?(n(),r("button",{key:3,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:e[3]||(e[3]=m=>c.moveRow(0))},A)):h("",!0),l.selectedRow!=null?(n(),r("button",{key:4,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:e[4]||(e[4]=m=>c.moveRow(1))},P)):h("",!0),l.selectedRow!=null?(n(),r("button",{key:5,type:"button",class:"btn btn-outline-danger mb-2 ml-2",onClick:e[5]||(e[5]=m=>l.selectedRow=null)},G)):h("",!0)]),t("div",H,[t("div",Y,[u(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=m=>l.showCode=m),id:"showCode"+c.uuid},null,8,Q),[[w,l.showCode]]),t("label",{class:"form-check-label",for:"showCode"+c.uuid}," Отобразить код ",8,X)])])]),l.keyboard.length>0?(n(),r("div",W,[(n(!0),r(_,null,f(l.keyboard,(m,a)=>(n(),r("div",Z,[t("div",I,[t("button",{type:"button",class:"btn btn-link w-100",onClick:$=>c.addColToRow(a)},te,8,x),t("button",{type:"button",class:"btn btn-link w-100",onClick:$=>c.removeColFromRow(a)},le,8,oe),t("button",{type:"button",class:"btn btn-link w-100",onClick:$=>c.moveCol(a,0)},ae,8,ie),t("button",{type:"button",class:"btn btn-link w-100",onClick:$=>c.moveCol(a,1)},ce,8,de)]),t("div",he,[(n(!0),r(_,null,f(m,($,d)=>(n(),r("div",be,[u(t("input",{type:"text",onClick:b=>c.selectIndex(a,d),class:"btn btn-outline-primary w-100","onUpdate:modelValue":b=>l.keyboard[a][d].text=b},null,8,ue),[[y,l.keyboard[a][d].text]]),t("button",{type:"button","data-bs-toggle":"modal","data-bs-target":"#button-menu-btn-row-"+a+"col-"+d,class:"btn btn-outline-primary","aria-expanded":"false","data-bs-reference":"parent"},_e,8,me),t("div",{class:"modal fade",id:"button-menu-btn-row-"+a+"col-"+d,tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[t("div",fe,[t("div",ke,[t("div",ve,[t("form",ge,[$e,t("div",Ce,[t("label",{for:"command-title-"+a+"-col-"+d,class:"form-label"},"Название кнопки",8,we),u(t("input",{type:"text",id:"command-title-"+a+"-col-"+d,class:"form-control w-100","onUpdate:modelValue":b=>l.keyboard[a][d].text=b},null,8,Fe),[[y,l.keyboard[a][d].text]])]),Re,t("div",Ke,[t("label",{for:"command-row-"+a+"-col-"+d,class:"form-label"},"Команда (для меню в сообщении)",8,Te),u(t("input",{type:"text",onChange:b=>c.needRemoveField("callback_data",a,d),"onUpdate:modelValue":b=>l.keyboard[a][d].callback_data=b,class:"form-control",id:"command-row-"+a+"-col-"+d,placeholder:"/start"},null,40,Ve),[[y,l.keyboard[a][d].callback_data]])]),t("div",Se,[t("label",{for:"switch-inline-query-row-"+a+"-col-"+d,class:"form-label"},"Ссылка на аккаунт в ТЕЛЕГРАММ",8,Be),u(t("input",{type:"text",class:"form-control",onChange:b=>c.needRemoveField("switch_inline_query",a,d),"onUpdate:modelValue":b=>l.keyboard[a][d].switch_inline_query=b,id:"switch-inline-query-row-"+a+"-col-"+d,placeholder:"@YourAccountLink"},null,40,Ue),[[y,l.keyboard[a][d].switch_inline_query]])]),t("div",Me,[t("label",{for:"url-row-"+a+"-col-"+d,class:"form-label"},"Внешняя URL-ссылка",8,je),u(t("input",{type:"text",class:"form-control",onChange:b=>c.needRemoveField("url",a,d),"onUpdate:modelValue":b=>l.keyboard[a][d].url=b,id:"url-row-"+a+"-col-"+d,placeholder:"https://t.me/example"},null,40,qe),[[y,l.keyboard[a][d].url]])]),t("div",Oe,[t("label",{for:"switch-inline-query-current-chat-row-"+a+"-col-"+d,class:"form-label"},"Команда всплывающего меню бота",8,Je),u(t("input",{type:"text",class:"form-control",onChange:b=>c.needRemoveField("switch_inline_query_current_chat",a,d),"onUpdate:modelValue":b=>l.keyboard[a][d].switch_inline_query_current_chat=b,id:"witch-inline-query-current-chat-row-"+a+"-col-"+d,placeholder:"команда"},null,40,Ne),[[y,l.keyboard[a][d].switch_inline_query_current_chat]])]),t("div",De,[t("input",{type:"radio",onChange:b=>c.needRemoveField(null,a,d),name:"request-radio",class:"form-check-input",id:"no-action-row-"+a+"-col-"+d},null,40,Ee),t("label",{class:"form-check-label",for:"no-action-row-"+a+"-col-"+d}," Без действий ",8,Ae)]),t("div",Le,[t("input",{type:"radio",onChange:b=>c.needRemoveField("request_contact",a,d),onClick:b=>l.keyboard[a][d].request_contact=!0,name:"request-radio",class:"form-check-input",id:"phone-row-"+a+"-col-"+d},null,40,Pe),t("label",{class:"form-check-label",for:"phone-row-"+a+"-col-"+d}," Запросить телефон (для нижнего меню) ",8,ze)]),t("div",Ge,[t("input",{type:"radio",name:"request-radio",onChange:b=>c.needRemoveField("request_location",a,d),onClick:b=>l.keyboard[a][d].request_location=!0,class:"form-check-input",id:"location-row-"+a+"-col-"+d},null,40,He),t("label",{class:"form-check-label",for:"location-row-"+a+"-col-"+d}," Запросить локацию (для нижнего меню) ",8,Ye)])])])])])],8,pe)]))),256))])]))),256))])):h("",!0)]),l.showCode?(n(),r("div",Qe,[t("div",Xe,[We,l.load?h("",!0):(n(),k(v,{key:0,mode:"code",modelValue:l.keyboard,"onUpdate:modelValue":e[7]||(e[7]=m=>l.keyboard=m),"show-btns":!1,expandedOnStart:!0,onJsonChange:c.onJsonChange},null,8,["modelValue","onJsonChange"]))])])):h("",!0)]))}const R=q(O,[["render",Ze]]);const Ie={key:0,class:"card"},xe={key:0,class:"card-header d-flex justify-content-between align-items-center"},et=["disabled"],tt=t("i",{class:"fa-solid fa-arrow-left"},null,-1),ot=[tt],st=["disabled"],lt=t("i",{class:"fa-regular fa-pen-to-square"},null,-1),it=[lt],nt=["disabled"],at=t("i",{class:"fa-regular fa-floppy-disk"},null,-1),dt=[at],rt={key:1,class:"card-header d-flex justify-content-between align-items-center"},ct={class:"mr-2"},ht=["disabled"],bt=t("i",{class:"fa-regular fa-pen-to-square"},null,-1),ut=[bt],mt=["disabled"],yt=t("i",{class:"fa-regular fa-clone"},null,-1),_t=[yt],pt=["disabled"],ft=t("i",{class:"fa-regular fa-floppy-disk"},null,-1),kt=[ft],vt=["disabled"],gt=t("i",{class:"fa-solid fa-trash-can"},null,-1),$t=[gt],Ct={class:"card-body"},wt={key:0,class:"row"},Ft={class:"col-md-6 col-12"},Rt={class:"mb-3"},Kt=t("label",{class:"form-label",id:"bot-domain"},"Тип",-1),Tt=t("option",{value:"reply"},"Нижняя клавиатура",-1),Vt=t("option",{value:"inline"},"Встроенная клавиатура",-1),St=[Tt,Vt],Bt={class:"col-md-6 col-12"},Ut={class:"mb-3"},Mt=t("label",{class:"form-label",id:"bot-domain"},"Мнемоническое имя",-1),jt={class:"row"},qt={class:"col-12"},Ot={class:"row"},Jt={class:"col-12"},Nt={class:"row"},Dt={class:"col"},Et={type:"button",class:"btn btn-outline-primary w-100 mb-2"},At={key:1,class:"card"},Lt={class:"card-header d-flex justify-content-between align-items-center"},Pt=["disabled"],zt=t("i",{class:"fa-regular fa-floppy-disk"},null,-1),Gt=[zt],Ht={class:"card-body"},Yt={props:["keyboard","selectMode"],data:()=>({is_edited:!1,load:!1,keyboardForm:null}),computed:{uuid(){return F()}},watch:{keyboardForm:{handler(o){this.is_edited=!0},deep:!0}},mounted(){const o=this.keyboard;this.keyboardForm=o,this.$nextTick(()=>{this.is_edited=!1})},methods:{removeKeyboard(){this.$store.dispatch("removeKeyboardTemplate",{templateId:this.keyboardForm.id}).then(o=>{this.load=!0,this.$nextTick(()=>{this.load=!1}),this.$emit("callback",this.keyboardForm.id)}).catch(()=>{this.$emit("callback",this.keyboardForm.id)})},saveKeyboard(o){this.keyboardForm.menu=o},selectCard(){this.$emit("select",this.keyboardForm)},duplicateKeyboard(){let o=new FormData;Object.keys(this.keyboardForm).forEach(e=>{const s=this.keyboardForm[e]||"";typeof s=="object"?o.append(e,JSON.stringify(s)):o.append(e,s)}),this.$store.dispatch("createKeyboardTemplate",{keyboardForm:o}).then(e=>{this.$notify({title:"Конструктор ботов",text:"Меню успешно продублировано!",type:"success"}),this.load=!0,this.$nextTick(()=>{this.load=!1}),this.$emit("reload")})},updateKeyboard(){let o=new FormData;Object.keys(this.keyboardForm).forEach(e=>{const s=this.keyboardForm[e]||"";typeof s=="object"?o.append(e,JSON.stringify(s)):o.append(e,s)}),this.$store.dispatch("editKeyboardTemplate",{keyboardForm:o}).then(e=>{this.load=!0,this.$nextTick(()=>{this.load=!1,this.is_edited=!1}),this.$emit("callback")}).catch(()=>{this.is_edited=!1,this.$emit("callback")})}}},Qt=Object.assign(Yt,{__name:"KeyboardCard",setup(o){return(e,s)=>(n(),r(_,null,[e.is_edited?h("",!0):(n(),r("div",Ie,[o.selectMode?(n(),r("div",xe,[t("div",null,[t("button",{onClick:s[0]||(s[0]=(...i)=>e.selectCard&&e.selectCard(...i)),disabled:e.load,type:"button",class:"btn btn-outline-success mr-2"},ot,8,et),t("button",{onClick:s[1]||(s[1]=i=>e.is_edited=!0),disabled:e.load,type:"button",title:"Редактировать клавиатуру",class:"btn btn-outline-success mr-2"},it,8,st),t("button",{onClick:s[2]||(s[2]=(...i)=>e.updateKeyboard&&e.updateKeyboard(...i)),type:"button",title:"Обновить клавиатуру",disabled:e.load||!e.is_edited,class:p(["btn btn-outline-primary mr-2",{"have-change":e.is_edited}])},dt,10,nt)])])):h("",!0),o.selectMode?h("",!0):(n(),r("div",rt,[t("div",null,[t("strong",ct,"#"+g(o.keyboard.id),1),t("button",{onClick:s[3]||(s[3]=i=>e.is_edited=!0),disabled:e.load,type:"button",title:"Редактировать клавиатуру",class:"btn btn-outline-success mr-2"},ut,8,ht),t("button",{onClick:s[4]||(s[4]=(...i)=>e.duplicateKeyboard&&e.duplicateKeyboard(...i)),type:"button",title:"Дублировать клавиатуру",disabled:e.load,class:"btn btn-outline-primary mr-2"},_t,8,mt),t("button",{onClick:s[5]||(s[5]=(...i)=>e.updateKeyboard&&e.updateKeyboard(...i)),type:"button",title:"Обновить клавиатуру",disabled:e.load||!e.is_edited,class:p(["btn btn-outline-primary mr-2",{"have-change":e.is_edited}])},kt,10,pt)]),t("button",{onClick:s[6]||(s[6]=(...i)=>e.removeKeyboard&&e.removeKeyboard(...i)),type:"button",disabled:e.load,title:"Удалить клавиатуру",class:"btn btn-outline-danger mr-2"},$t,8,vt)])),t("div",Ct,[o.selectMode?h("",!0):(n(),r("div",wt,[t("div",Ft,[t("div",Rt,[Kt,u(t("select",{disabled:!0,"onUpdate:modelValue":s[7]||(s[7]=i=>o.keyboard.type=i),class:"form-control"},St,512),[[K,o.keyboard.type]])])]),t("div",Bt,[t("div",Ut,[Mt,u(t("input",{type:"text",class:"form-control",placeholder:"Мнемоническое имя",disabled:!0,"aria-label":"Мнемоническое имя","onUpdate:modelValue":s[8]||(s[8]=i=>o.keyboard.slug=i),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[y,o.keyboard.slug]])])])])),t("div",jt,[t("div",qt,[t("div",Ot,[t("div",Jt,[(n(!0),r(_,null,f(o.keyboard.menu,(i,l)=>(n(),r("div",Nt,[(n(!0),r(_,null,f(i,(c,v)=>(n(),r("div",Dt,[t("button",Et,g(c.text),1)]))),256))]))),256))])])])])])])),e.is_edited?(n(),r("div",At,[t("div",Lt,[t("button",{onClick:s[9]||(s[9]=(...i)=>e.updateKeyboard&&e.updateKeyboard(...i)),type:"button",title:"Обновить клавиатуру",disabled:e.load||!e.is_edited,class:p(["btn btn-outline-primary mr-2",{"have-change":e.is_edited}])},Gt,10,Pt)]),t("div",Ht,[e.keyboardForm?(n(),k(R,{key:0,onSave:e.saveKeyboard,"edited-keyboard":e.keyboardForm},null,8,["onSave","edited-keyboard"])):h("",!0)])])):h("",!0)],64))}}),Xt={key:0,class:"row mb-2"},Wt={class:"col-12"},Zt={class:"card"},It=t("div",{class:"card-header"},[t("h6",null,"Форма создания шаблона клавиатуры")],-1),xt={class:"card-body"},eo={class:"col-md-6 col-12"},to={class:"mb-3"},oo=t("label",{class:"form-label",id:"bot-domain"},"Тип",-1),so=t("option",{value:"reply"},"Нижняя клавиатура",-1),lo=t("option",{value:"inline"},"Встроенная клавиатура",-1),io=[so,lo],no={class:"col-md-6 col-12"},ao={class:"mb-3"},ro={class:"form-label d-flex justify-content-between",id:"bot-domain"},co=t("span",null,"Мнемоническое имя",-1),ho=t("i",{class:"fa-solid fa-arrows-rotate"},null,-1),bo=[ho],uo={class:"col-12"},mo=t("div",{class:"col-12"},[t("button",{class:"btn btn-outline-success w-100 p-3"}," Добавить новый шаблон клавиатуры ")],-1),yo={class:"row"},_o={key:0,class:"col-12"},po={class:"badge bg-warning"},fo={class:"col-12 mb-3"},ko={key:1,class:"card"},vo={class:"card-body"},go={key:2,class:"col-12 mb-3"},$o=t("div",{class:"alert alert-warning",role:"alert"},[t("p",null,"Список шаблонов клавиатур пуст!")],-1),Co=[$o],wo={props:["selectMode","type"],data(){return{keyboards:[],load:!1,bot:null,editedKeyboard:null,selectMenuIndex:null,keyboardForm:{type:"reply",bot_id:null,slug:null,menu:[]}}},computed:{...T(["getCurrentBot"]),filteredKeyboard(){return this.type?this.keyboards.filter(o=>o.type==this.type):this.keyboards}},mounted(){this.loadCurrentBot().then(()=>{this.loadMenusByBotTemplate(),this.generateSlug()})},methods:{selectCard(o){this.$emit("select",o)},keyboardCallbackAction(o){let e=this.keyboards.find(s=>s.id===o);e.deleted_at=new Date,this.loadMenusByBotTemplate()},loadMenusByBotTemplate(){this.$store.dispatch("loadBotKeyboards",{botId:this.bot.id}).then(o=>{this.keyboards=o.data})},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},submitKeyboard(){this.keyboardForm.bot_id=this.bot.id;let o=new FormData;Object.keys(this.keyboardForm).forEach(e=>{const s=this.keyboardForm[e]||"";typeof s=="object"?o.append(e,JSON.stringify(s)):o.append(e,s)}),this.$store.dispatch("createKeyboardTemplate",{keyboardForm:o}).then(e=>{this.keyboardForm={type:"reply",bot_id:null,slug:null,menu:[]},this.load=!0,this.$nextTick(()=>{this.load=!1}),this.loadMenusByBotTemplate()})},generateSlug(){this.keyboardForm.slug=F()},changeKeyboardFormMenu(o){this.keyboardForm.menu=o}}},Fo=Object.assign(wo,{__name:"KeyboardList",setup(o){return(e,s)=>(n(),r(_,null,[o.selectMode?h("",!0):(n(),r("div",Xt,[t("div",Wt,[t("div",Zt,[It,t("div",xt,[t("form",{onSubmit:s[3]||(s[3]=V((...i)=>e.submitKeyboard&&e.submitKeyboard(...i),["prevent"])),class:"row"},[t("div",eo,[t("div",to,[oo,u(t("select",{"onUpdate:modelValue":s[0]||(s[0]=i=>e.keyboardForm.type=i),class:"form-control"},io,512),[[K,e.keyboardForm.type]])])]),t("div",no,[t("div",ao,[t("label",ro,[co,t("a",{onClick:s[1]||(s[1]=(...i)=>e.generateSlug&&e.generateSlug(...i)),href:"#generate"},bo)]),u(t("input",{type:"text",class:"form-control",placeholder:"Мнемоническое имя","aria-label":"Мнемоническое имя","onUpdate:modelValue":s[2]||(s[2]=i=>e.keyboardForm.slug=i),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[y,e.keyboardForm.slug]])])]),t("div",uo,[e.load?h("",!0):(n(),k(R,{key:0,onSave:e.changeKeyboardFormMenu,"edited-keyboard":e.keyboardForm},null,8,["onSave","edited-keyboard"]))]),mo],32)])])])])),t("div",yo,[e.keyboards&&e.bot?(n(),r("div",_o,[t("p",null,[C("В списке клавиатур "),t("span",po,g(e.filteredKeyboard.length)+" ед.",1)])])):h("",!0),e.keyboards&&e.bot?(n(!0),r(_,{key:1},f(e.filteredKeyboard,(i,l)=>(n(),r("div",fo,[i.deleted_at?(n(),r("div",ko,[t("div",vo,[t("p",null,"Удаленная клавиатура #"+g(i.id),1)])])):(n(),k(Qt,{key:0,"select-mode":o.selectMode,onSelect:e.selectCard,onReload:e.loadMenusByBotTemplate,onCallback:e.keyboardCallbackAction,keyboard:i},null,8,["select-mode","onSelect","onReload","onCallback","keyboard"]))]))),256)):h("",!0),e.filteredKeyboard.length===0?(n(),r("div",go,Co)):h("",!0)])],64))}}),Ro={class:"col-md-12 col-12"},Ko={class:"mb-3"},To=t("i",{class:"fa-solid fa-xmark"},null,-1),Vo=[To],So={class:"mb-3"},Bo={class:"d-flex justify-content-between flex-wrap al"},Uo=t("label",{class:"form-label",id:"bot-main-channel"},"Канал для постов (id,рекламный)",-1),Mo={class:"d-flex flex-wrap align-items-center"},jo=t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),qo={class:"col-12 mb-2"},Oo=t("label",{class:"form-label d-flex justify-content-between align-items-center mb-2",id:"bot-domain"},[C(" Текстовое содержимое страницы "),t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),Jo={class:"form-floating"},No={for:"floatingTextarea2"},Do={key:0},Eo={class:"col-12 mb-2"},Ao={class:"form-check"},Lo=t("label",{class:"form-check-label",for:"need-page-images"}," Изображения на странице (максимум 10) ",-1),Po={key:0,class:"col-12 mb-2"},zo={class:"card mb-3"},Go=t("div",{class:"card-header"},[t("h6",null,"Изображения на странице")],-1),Ho={class:"card-body d-flex justify-content-start"},Yo={for:"photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},Qo={class:"row"},Xo={key:0,class:"col-12 d-flex flex-wrap"},Wo={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Zo={class:"remove"},Io=["onClick"],xo={class:"col-12 mb-2"},es={class:"form-check"},ts=t("label",{class:"form-check-label",for:"need-inline-menu"}," Меню под текстом страницы ",-1),os={key:1,class:"col-12 mb-2"},ss={class:"card"},ls={class:"card-header d-flex justify-between align-items-center"},is=t("h6",null,"Конструктор меню в сообщении",-1),ns={key:0},as={key:1},ds={class:"card-body"},rs=t("div",{class:"col-12"},[t("button",{type:"submit",class:"btn btn-success w-100 p-3"}," Отправить сообщение в канал ")],-1),cs={data(){return{load:!1,photos:[],showInlineTemplateSelector:!1,need_page_images:!1,need_inline_menu:!1,bot:null,mailForm:{text:"",inline_keyboard:null,channel:null}}},computed:{...T(["getCurrentBot"])},mounted(){this.loadCurrentBot()},methods:{addTextTo(o={param:null,text:null}){this.mailForm.channel=o.text},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},submitMail(){let o=new FormData;if(Object.keys(this.mailForm).forEach(e=>{const s=this.mailForm[e]||"";typeof s=="object"?o.append(e,JSON.stringify(s)):o.append(e,s)}),this.bot&&o.append("bot_id",this.bot.id),this.photos.length>0)for(let e=0;e<this.photos.length;e++)o.append("photos[]",this.photos[e]);this.$store.dispatch("sendToChannel",{mailForm:o}).then(e=>{this.load=!0,this.photos=[],this.need_inline_menu=!1,this.need_page_images=!1,this.mailForm={text:"",channel:null,inline_keyboard:null},this.$notify({title:"Конструктор ботов",text:"Сообщение успещно отправлено!",type:"success"})}).catch(e=>{})},saveInlineKeyboard(o){this.mailForm.inline_keyboard=o},selectInlineKeyboard(o){this.mailForm.inline_keyboard=o,this.showInlineTemplateSelector=!1},getPhoto(o){return{imageUrl:URL.createObjectURL(o)}},removePhoto(o){this.photos.splice(o,1)},removeImage(o){this.mailForm.images.splice(o,1)},onChangePhotos(o){const e=o.target.files;for(let s=0;s<e.length;s++)this.photos.push(e[s])}}},ys=Object.assign(cs,{__name:"Mail",setup(o){return(e,s)=>{const i=B("lazy");return e.bot?(n(),r("form",{key:0,onSubmit:s[9]||(s[9]=V((...l)=>e.submitMail&&e.submitMail(...l),["prevent"]))},[t("div",Ro,[t("div",Ko,[e.mailForm.channel!=null?(n(),r("button",{key:0,type:"button",class:"btn btn-outline-info mr-2",onClick:s[0]||(s[0]=l=>e.mailForm.channel=null)},Vo)):h("",!0),t("button",{type:"button",class:p(["btn mr-2",{"btn-info":e.mailForm.channel===e.bot.main_channel,"btn-outline-info":e.mailForm.channel!==e.bot.main_channel}]),onClick:s[1]||(s[1]=l=>e.mailForm.channel=e.bot.main_channel)},"Главный канал ",2),t("button",{type:"button",class:p(["btn",{"btn-info":e.mailForm.channel===e.bot.order_channel,"btn-outline-info":e.mailForm.channel!==e.bot.order_channel}]),onClick:s[2]||(s[2]=l=>e.mailForm.channel=e.bot.order_channel)},"Канал заказов ",2)]),t("div",So,[t("div",Bo,[Uo,t("div",Mo,[U(j,{token:e.bot.bot_token,param:"channel",onCallback:e.addTextTo},null,8,["token","onCallback"]),jo])]),u(t("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":s[3]||(s[3]=l=>e.mailForm.channel=l),maxlength:"255","aria-describedby":"bot-main-channel",required:""},null,512),[[y,e.mailForm.channel]])])]),t("div",qo,[Oo,t("div",Jo,[u(t("textarea",{class:"form-control","onUpdate:modelValue":s[4]||(s[4]=l=>e.mailForm.text=l),maxlength:"4096",placeholder:"Введите текст",id:"floatingTextarea2",style:{"min-height":"100px"},required:""},null,512),[[y,e.mailForm.text]]),t("label",No,[C("Содержимое страницы "),e.mailForm.text?(n(),r("span",Do,g(e.mailForm.text.length)+"/4096 ",1)):h("",!0)])])]),t("div",Eo,[t("div",Ao,[u(t("input",{class:"form-check-input","onUpdate:modelValue":s[5]||(s[5]=l=>e.need_page_images=l),type:"checkbox",id:"need-page-images"},null,512),[[w,e.need_page_images]]),Lo])]),e.need_page_images?(n(),r("div",Po,[t("div",zo,[Go,t("div",Ho,[t("label",Yo,[C(" + "),t("input",{type:"file",id:"photos",multiple:"",accept:"image/*",onChange:s[6]||(s[6]=(...l)=>e.onChangePhotos&&e.onChangePhotos(...l)),style:{display:"none"}},null,32)]),t("div",Qo,[e.photos.length>0?(n(),r("div",Xo,[(n(!0),r(_,null,f(e.photos,(l,c)=>(n(),r("div",Wo,[u(t("img",null,null,512),[[i,e.getPhoto(l).imageUrl]]),t("div",Zo,[t("a",{onClick:v=>e.removePhoto(c)},"Удалить",8,Io)])]))),256))])):h("",!0)])])])])):h("",!0),t("div",xo,[t("div",es,[u(t("input",{class:"form-check-input","onUpdate:modelValue":s[7]||(s[7]=l=>e.need_inline_menu=l),type:"checkbox",id:"need-inline-menu"},null,512),[[w,e.need_inline_menu]]),ts])]),e.need_inline_menu?(n(),r("div",os,[t("div",ss,[t("div",ls,[is,t("button",{class:p(["btn",{"btn-outline-primary":!e.showInlineTemplateSelector,"btn-primary":e.showInlineTemplateSelector}]),type:"button",onClick:s[8]||(s[8]=l=>e.showInlineTemplateSelector=!e.showInlineTemplateSelector)},[e.showInlineTemplateSelector?(n(),r("span",as," Скрыть шаблоны меню")):(n(),r("span",ns," Открыть шаблоны меню"))],2)]),t("div",ds,[e.showInlineTemplateSelector?(n(),k(Fo,{key:0,class:"mb-2",type:"inline",onSelect:e.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(n(),k(R,{key:1,type:"inline",onSave:e.saveInlineKeyboard,"edited-keyboard":e.mailForm.inline_keyboard},null,8,["onSave","edited-keyboard"]))])])])):h("",!0),rs],32)):h("",!0)}}});export{R as B,Fo as _,ys as a};
