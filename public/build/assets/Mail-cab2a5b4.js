import{G as $,q as i,t as n,v as t,H as r,J as h,R as _,K as p,A as a,F as m,C as k,x as b,D as u,y as f,u as S,B as g,X as T,P as F,L as V}from"./index.es-71d37bd0.js";import{P as R}from"./Pagination-c0ff4992.js";import{V as v}from"./vue3-json-editor.esm.prod-61e9e0df.js";import{v as P}from"./v4-a960c1f4.js";import{T as j}from"./TelegramChannelHelper-864fe219.js";import{_ as B}from"./BotMediaList-53d8d6dc.js";const U={class:"row"},M={class:"input-group mb-3"},q={class:"row"},O={class:"col-12"},I={class:"form-check"},J=t("label",{class:"form-check-label",for:"need-new-first"},"Сперва новые",-1),D={class:"col-12"},L={class:"form-check"},N=t("label",{class:"form-check-label",for:"needDeleted"},"Отобразить удаленные",-1),A={key:0,class:"row"},E={key:0,class:"col-12"},z={class:"col-12 mb-3"},G={class:"list-group w-100"},H={class:"d-flex justify-content-between"},Q=["onClick"],X={key:0},Y={key:1},W={key:2,title:"Вы не можете выбрать данную страницу"},Z=t("i",{class:"fa-solid fa-lock ml-2 text-danger"},null,-1),x=[Z],ee={key:0},te={class:"dropdown"},oe=t("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"fa-solid fa-ellipsis"})],-1),se={class:"dropdown-menu"},le={key:0},ie=["onClick"],ne=t("i",{class:"fa-solid fa-copy mr-1"},null,-1),ae={key:1},de=["onClick"],re=t("i",{class:"fa-solid fa-ban mr-1"},null,-1),ce=["onClick"],he=t("i",{class:"fa-solid fa-copy mr-1"},null,-1),ue={key:2},me=["onClick"],be=t("i",{class:"fa-solid fa-trash mr-1"},null,-1),pe={key:0,class:"component-icons"},ye={key:0},_e=t("i",{class:"fa-regular fa-images"},null,-1),fe=[_e],ke={key:1},ge=t("i",{class:"fa-regular fa-note-sticky"},null,-1),$e=[ge],ve={key:2},we=t("i",{class:"fa-solid fa-photo-film"},null,-1),Ce=[we],Fe={key:3},Pe=t("i",{class:"fa-regular fa-file-audio"},null,-1),Re=[Pe],Se={key:4},Te=t("i",{class:"fa-regular fa-file-word"},null,-1),Ke=[Te],Ve={key:5},je=t("i",{class:"fa-solid fa-link"},null,-1),Be=[je],Ue={key:6},Me=t("i",{class:"fa-solid fa-scroll"},null,-1),qe=[Me],Oe={key:7},Ie=t("i",{class:"fa-regular fa-comment-dots"},null,-1),Je=[Ie],De={key:8},Le=t("i",{class:"fa-solid fa-scale-balanced"},null,-1),Ne=[Le],Ae={key:9},Ee=t("i",{class:"fa-regular fa-keyboard"},null,-1),ze=[Ee],Ge={key:10},He=t("i",{class:"fa-solid fa-ellipsis"},null,-1),Qe=[He],Xe={class:"col-12"},Ye={key:1,class:"row"},We=t("div",{class:"col-12"},[t("div",{class:"alert alert-warning",role:"alert"}," Созданных страниц не найдено! ")],-1),Ze=[We],xe={props:["editor","current","selected"],data(){return{bot:null,current_page:0,need_deleted:!1,need_new_first:!0,loading:!0,pages:[],search:null,pages_paginate_object:null,need_new_page:!1}},watch:{need_new_first:function(s,e){this.nextPages(0)},need_deleted:function(s,e){this.nextPages(0)},getPages:function(s,e){this.$nextTick(()=>{this.search||(this.pages=this.getPages)})},search:function(s,e){this.nextPages(0)}},computed:{...$(["getPages","getCurrentBot","getPagesPaginateObject"])},mounted(){this.loadCurrentBot().then(()=>{this.bot&&(this.current_page=localStorage.getItem(`cashman_pagelist_${this.bot.id}_page_index`)||0),this.loadPages()})},methods:{loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},selectPage(s){this.$emit("callback",s)},nextPages(s){this.current_page=s,this.bot&&localStorage.setItem(`cashman_pagelist_${this.bot.id}_page_index`,this.current_page),this.loadPages()},duplicatePage(s){this.loading=!0,this.$store.dispatch("duplicatePage",{dataObject:{pageId:s}}).then(e=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},forceRemovePage(s){this.loading=!0,this.$store.dispatch("forceRemovePage",{dataObject:{pageId:s}}).then(e=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},restorePage(s){this.loading=!0,this.$store.dispatch("restorePage",{dataObject:{pageId:s}}).then(e=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},removePage(s){this.loading=!0,this.$store.dispatch("removePage",{dataObject:{pageId:s}}).then(e=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},loadPages(){this.loading=!0,this.$store.dispatch("loadPages",{dataObject:{botId:this.bot.id||null,search:this.search||null,needDeleted:this.need_deleted,needNewFirst:this.need_new_first},page:this.current_page||0}).then(s=>{this.loading=!1,this.pages=this.getPages,this.pages_paginate_object=this.getPagesPaginateObject,this.pages.length===0&&localStorage.setItem(`cashman_pagelist_${this.bot.id}_page_index`,0)}).catch(()=>{this.loading=!1})}}},et=Object.assign(xe,{__name:"PagesList",setup(s){return(e,o)=>(i(),n(m,null,[t("div",U,[t("div",M,[r(t("input",{type:"search",class:"form-control",placeholder:"Поиск страницы","aria-label":"Поиск бота","onUpdate:modelValue":o[0]||(o[0]=l=>e.search=l),"aria-describedby":"button-addon2"},null,512),[[h,e.search]]),t("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=(...l)=>e.loadPages&&e.loadPages(...l)),type:"button",id:"button-addon2"},"Найти ")])]),t("div",q,[t("div",O,[t("div",I,[r(t("input",{class:"form-check-input","onUpdate:modelValue":o[2]||(o[2]=l=>e.need_new_first=l),type:"checkbox",id:"need-new-first"},null,512),[[_,e.need_new_first]]),J])]),t("div",D,[t("div",L,[r(t("input",{class:"form-check-input","onUpdate:modelValue":o[3]||(o[3]=l=>e.need_deleted=l),type:"checkbox",id:"needDeleted"},null,512),[[_,e.need_deleted]]),N])])]),e.pages.length>0?(i(),n("div",A,[e.pages.length>7?(i(),n("div",E,[e.pages_paginate_object?(i(),p(R,{key:0,onPagination_page:e.nextPages,pagination:e.pages_paginate_object},null,8,["onPagination_page","pagination"])):a("",!0)])):a("",!0),t("div",z,[t("ul",G,[(i(!0),n(m,null,k(e.pages,(l,d)=>(i(),n("li",{class:b(["list-group-item cursor-pointer page-menu-item btn btn-outline-info mb-1",{"border border-warning":l.deleted_at!=null}])},[t("div",H,[t("strong",{onClick:c=>e.selectPage(l)},[u("#"+f(l.id||"Не указано")+" ",1),l.slug?(i(),n("span",X,f(l.slug.command||"Не указано"),1)):(i(),n("span",Y,"Не привязано к команде")),s.current&&s.current==l.id||(s.selected||[]).indexOf(l.id)!=-1?(i(),n("span",W,x)):a("",!0)],8,Q),s.editor?(i(),n("div",ee,[t("div",te,[oe,t("ul",se,[l.deleted_at!=null?(i(),n("li",le,[t("a",{class:"dropdown-item",onClick:c=>e.restorePage(l.id)},[ne,u("Восстановить")],8,ie)])):a("",!0),l.deleted_at!=null?(i(),n("li",ae,[t("a",{class:"dropdown-item",onClick:c=>e.forceRemovePage(l.id)},[re,u("Удалить полностью")],8,de)])):a("",!0),t("li",null,[t("a",{class:"dropdown-item",onClick:c=>e.duplicatePage(l.id)},[he,u("Дублировать")],8,ce)]),l.deleted_at==null?(i(),n("li",ue,[t("a",{class:"dropdown-item",onClick:c=>e.removePage(l.id)},[be,u("Удалить")],8,me)])):a("",!0)])])])):a("",!0)]),l?(i(),n("ul",pe,[(l.images||[]).length>0?(i(),n("li",ye,fe)):a("",!0),l.sticker?(i(),n("li",ke,$e)):a("",!0),(l.videos||[]).length>0?(i(),n("li",ve,Ce)):a("",!0),(l.audios||[]).length>0?(i(),n("li",Fe,Re)):a("",!0),(l.documents||[]).length>0?(i(),n("li",Se,Ke)):a("",!0),l.next_page_id?(i(),n("li",Ve,Be)):a("",!0),l.next_bot_menu_slug_id?(i(),n("li",Ue,qe)):a("",!0),l.next_bot_dialog_command_id?(i(),n("li",Oe,Je)):a("",!0),l.rules_if?(i(),n("li",De,Ne)):a("",!0),l.reply_keyboard_id?(i(),n("li",Ae,ze)):a("",!0),l.inline_keyboard_id?(i(),n("li",Ge,Qe)):a("",!0)])):a("",!0)],2))),256))])]),t("div",Xe,[e.pages_paginate_object?(i(),p(R,{key:0,onPagination_page:e.nextPages,pagination:e.pages_paginate_object},null,8,["onPagination_page","pagination"])):a("",!0)])])):(i(),n("div",Ye,Ze))],64))}});const tt={key:0},ot={class:"row"},st={class:"col-12 d-flex justify-content-between"},lt=t("i",{class:"fa-solid fa-arrows-up-to-line"},null,-1),it=[lt],nt=t("i",{class:"fa-solid fa-arrows-down-to-line"},null,-1),at=[nt],dt=t("i",{class:"fa-solid fa-xmark"},null,-1),rt=[dt],ct={class:"d-flex flex-column"},ht={class:"form-check"},ut=["id"],mt=["for"],bt={key:0,class:"col-12"},pt={class:"row"},yt={class:"col-1 d-flex justify-content-around p-2"},_t={class:"dropdown"},ft=t("a",{class:"btn btn-link",href:"#",role:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"fa-solid fa-ellipsis-vertical"})],-1),kt={class:"dropdown-menu"},gt=["onClick"],$t=t("a",{class:"dropdown-item",href:"#"},[t("i",{class:"fa-solid fa-plus mr-2"}),u(" добавить кнопку ")],-1),vt=[$t],wt=["onClick"],Ct=t("a",{class:"dropdown-item",href:"#"},[t("i",{class:"fa-solid fa-minus mr-2"}),u(" удалить кнопку ")],-1),Ft=[Ct],Pt=["onClick"],Rt=t("a",{class:"dropdown-item",href:"#"},[t("i",{class:"fa-solid fa-caret-left mr-2"}),u(" переместить влево ")],-1),St=[Rt],Tt=["onClick"],Kt=t("a",{class:"dropdown-item",href:"#"},[t("i",{class:"fa-solid fa-caret-right mr-2"}),u(" переместить влево ")],-1),Vt=[Kt],jt={class:"col-11 d-flex justify-content-center p-1"},Bt=["onClick"],Ut=["onUpdate:modelValue"],Mt=t("i",{class:"fa-solid fa-bars"},null,-1),qt=[Mt],Ot={key:0,class:"row"},It={class:"col-12"},Jt=t("label",{class:"form-label",id:"bot-domain"},"JSON-код клавиатуры",-1),Dt={key:1},Lt={class:"row"},Nt={class:"col-12 mb-2"},At={class:"col-12"},Et=t("div",{class:"alert alert-danger",role:"alert"}," Возможно выбрать только 1 тип действия ",-1),zt={class:"mb-3"},Gt=["for"],Ht={class:"input-group"},Qt=["id"],Xt=t("i",{class:"fa-solid fa-bars"},null,-1),Yt=[Xt],Wt=t("hr",null,null,-1),Zt={key:0,class:"mb-3"},xt=["for"],eo=["id"],to={key:1,class:"mb-3"},oo=["for"],so=["id"],lo={key:2,class:"mb-3"},io=["for"],no=["id"],ao={key:3,class:"mb-3"},ro=["for"],co=["id"],ho={key:4,class:"mb-3"},uo={class:"form-check"},mo=t("label",{class:"form-check-label",for:"need-login-url"}," Добавить ссылку авторизации ",-1),bo={key:0,class:"mb-3"},po=["for"],yo=["id"],_o={key:1,class:"mb-3"},fo=["for"],ko=["id"],go={key:2,class:"mb-3"},$o=["for"],vo=["id"],wo={key:3,class:"form-check mb-3"},Co=t("label",{class:"form-check-label",for:"need-request_write_access"}," Запросить отправку сообщений ботом ",-1),Fo={key:5,class:"form-check"},Po=["id"],Ro=["for"],So={key:6,class:"form-check"},To=["checked","id"],Ko=["for"],Vo={key:7,class:"form-check"},jo=["checked","id"],Bo=["for"],Uo=["id"],Mo={class:"modal-dialog"},qo={class:"modal-content"},Oo={class:"modal-body"},Io={props:["editedKeyboard","type"],components:{Vue3JsonEditor:v},computed:{uuid(){return P()}},watch:{need_login_url:{handler:function(s){this.need_login_url?this.keyboard[this.select.row][this.select.col].login_url={url:null,forward_text:null,bot_username:null,request_write_access:!0}:delete this.keyboard[this.select.row][this.select.col].login_url},deep:!0},keyboard:{handler:function(s){this.save()},deep:!0}},data(){return{need_login_url:!1,pageModal:null,mode:0,editor:!1,showCode:!1,showAssign:!1,selectedRow:null,load:!1,rowCount:1,keyboard:[],select:{row:0,col:0,type:this.type||"reply"}}},mounted(){this.pageModal=new bootstrap.Modal(document.getElementById("page-list-in-keyboard-"+this.uuid),{}),this.editedKeyboard&&this.$nextTick(()=>{this.keyboard=this.editedKeyboard.menu})},methods:{openPageModal(){this.pageModal.show()},attachPage(s){let e=(s.slug.command||"Нет команды").replace(".*","");this.keyboard[this.select.row][this.select.col].text=e,this.$notify({title:"Конструктор страниц",text:"Вы успешно выбрали страницу",type:"success"}),this.type==="inline"&&(this.keyboard[this.select.row][this.select.col].callback_data=e)},reset(){this.selectedRow=null,this.select={row:-1,col:-1,type:this.type||"reply"}},needRemoveField(s,e,o){Object.keys(this.keyboard[e][o]).forEach(l=>{l!=="text"&&l!==s&&delete this.keyboard[e][o][l]})},save(){this.$emit("save",this.keyboard)},onJsonChange(s){this.keyboard=s,this.save()},removeColFromRow(s){this.keyboard[s].length>1?this.keyboard[s].splice(this.keyboard[s].length-1,1):this.keyboard.splice(s,1),this.keyboard.length===0&&(this.selectedRow=null),this.save()},addRowAbove(){this.addRow(!0)},moveCol(s,e=0){s!==this.select.row&&(this.select.row=s,this.select.col=0,this.select.text=this.keyboard[this.select.row][this.select.col].text);let o=this.select.row,l=this.select.col,d=this.keyboard[o].length,c=e===0?l-1>=0?l-1:d-1:l<d-1?l+1:0,y=this.keyboard[o][l];this.keyboard[o][l]=this.keyboard[o][c],this.keyboard[o][c]=y,this.select.row=o,this.select.col=c,this.select.text=this.keyboard[o][c].text},moveRow(s=0){if(this.selectedRow==null)return;let e=this.keyboard.length,o=s===0?this.selectedRow-1>=0?this.selectedRow-1:e-1:this.selectedRow<e-1?this.selectedRow+1:0,l=this.keyboard[this.selectedRow];this.keyboard[this.selectedRow]=this.keyboard[o],this.keyboard[o]=l,this.select.row=o,this.select.col=0,this.select.text=this.keyboard[o][0].text,this.selectedRow=o},addRowBelow(){this.addRow(!1)},addRow(s=!1){if(this.selectedRow==null)this.keyboard?this.keyboard.push([{text:"Нет команды"}]):this.keyboard=[[{text:"Нет команды"}]],this.selectedRow=null;else{let e=s?this.selectedRow:this.selectedRow+1;this.keyboard.splice(e,0,[{text:"Нет команды"}])}this.save()},addColToRow(s){this.keyboard[s].push({text:"Нет команды"}),this.save()},selectIndex(s,e){this.selectedRow=s,this.select.row=s,this.select.col=e,this.select.text=this.keyboard[s][e].text||"",this.load=!0,this.$nextTick(()=>{this.load=!1})},removeCol(s,e){this.keyboard[s].length>1?this.keyboard[s].splice(e,1):this.keyboard.splice(1,1),this.save()}}},w=Object.assign(Io,{__name:"KeyboardConstructor",setup(s){return(e,o)=>(i(),n(m,null,[!e.editor&&e.mode===0?(i(),n("div",tt,[t("div",ot,[t("div",st,[t("div",null,[e.selectedRow==null?(i(),n("button",{key:0,type:"button",class:"btn btn-primary mb-2",onClick:o[0]||(o[0]=(...l)=>e.addRow&&e.addRow(...l))},"Добавить строку ")):a("",!0),e.selectedRow!=null?(i(),n("button",{key:1,type:"button",class:"btn btn-primary mb-2",onClick:o[1]||(o[1]=(...l)=>e.addRowAbove&&e.addRowAbove(...l))},"Добавить строку выше ")):a("",!0),e.selectedRow!=null?(i(),n("button",{key:2,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:o[2]||(o[2]=(...l)=>e.addRowBelow&&e.addRowBelow(...l))},"Добавить строку ниже ")):a("",!0),e.selectedRow!=null?(i(),n("button",{key:3,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:o[3]||(o[3]=l=>e.moveRow(0))},it)):a("",!0),e.selectedRow!=null?(i(),n("button",{key:4,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:o[4]||(o[4]=l=>e.moveRow(1))},at)):a("",!0),e.selectedRow!=null?(i(),n("button",{key:5,type:"button",class:"btn btn-outline-danger mb-2 ml-2",onClick:o[5]||(o[5]=(...l)=>e.reset&&e.reset(...l))},rt)):a("",!0)]),t("div",ct,[t("div",ht,[r(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[6]||(o[6]=l=>e.showCode=l),id:"showCode"+e.uuid},null,8,ut),[[_,e.showCode]]),t("label",{class:"form-check-label",for:"showCode"+e.uuid}," Отобразить код ",8,mt)])])]),(e.keyboard||[]).length>0?(i(),n("div",bt,[(i(!0),n(m,null,k(e.keyboard,(l,d)=>(i(),n("div",pt,[t("div",yt,[t("div",_t,[ft,t("ul",kt,[t("li",{onClick:c=>e.addColToRow(d)},vt,8,gt),t("li",{onClick:c=>e.removeColFromRow(d)},Ft,8,wt),t("li",{onClick:c=>e.moveCol(d,0)},St,8,Pt),t("li",{onClick:c=>e.moveCol(d,1)},Vt,8,Tt)])])]),t("div",jt,[(i(!0),n(m,null,k(l,(c,y)=>(i(),n("div",{class:"btn-group dropdown-center w-100 m-1",onClick:C=>e.selectIndex(d,y)},[r(t("input",{type:"text",class:b([{"btn-outline-primary":e.select.row!=d||e.select.col!=y,"btn-primary":e.select.row==d&&e.select.col==y},"btn w-100"]),"onUpdate:modelValue":C=>e.keyboard[d][y].text=C},null,10,Ut),[[h,e.keyboard[d][y].text]]),t("button",{type:"button",onClick:o[7]||(o[7]=C=>e.mode=1),class:"btn btn-outline-primary","aria-expanded":"false"},qt)],8,Bt))),256))])]))),256))])):a("",!0)]),e.showCode?(i(),n("div",Ot,[t("div",It,[Jt,e.load?a("",!0):(i(),p(S(v),{key:0,mode:"code",modelValue:e.keyboard,"onUpdate:modelValue":o[8]||(o[8]=l=>e.keyboard=l),"show-btns":!1,expandedOnStart:!0,onJsonChange:e.onJsonChange},null,8,["modelValue","onJsonChange"]))])])):a("",!0)])):a("",!0),e.mode===1?(i(),n("div",Dt,[t("div",Lt,[t("div",Nt,[t("button",{type:"button",onClick:o[9]||(o[9]=l=>e.mode=0),class:"btn btn-outline-primary"},"Назад ")]),t("form",At,[Et,t("div",zt,[t("label",{for:"command-title-"+e.select.row+"-col-"+e.select.сol,class:"form-label"},"Название кнопки",8,Gt),t("div",Ht,[r(t("input",{type:"text",id:"command-title-"+e.select.row+"-col-"+e.select.col,class:"form-control","onUpdate:modelValue":o[10]||(o[10]=l=>e.keyboard[e.select.row][e.select.col].text=l)},null,8,Qt),[[h,e.keyboard[e.select.row][e.select.col].text]]),t("button",{type:"button",onClick:o[11]||(o[11]=(...l)=>e.openPageModal&&e.openPageModal(...l)),class:"btn btn-outline-primary","aria-expanded":"false"},Yt)])]),Wt,s.type==="inline"?(i(),n("div",Zt,[t("label",{for:"command-row-"+e.select.row+"-col-"+e.select.col,class:"form-label"},"Команда (для меню в сообщении)",8,xt),r(t("input",{type:"text",onChange:o[12]||(o[12]=l=>e.needRemoveField("callback_data",e.select.row,e.select.col)),"onUpdate:modelValue":o[13]||(o[13]=l=>e.keyboard[e.select.row][e.select.col].callback_data=l),class:"form-control",id:"command-row-"+e.select.row+"-col-"+e.select.col,placeholder:"/start"},null,40,eo),[[h,e.keyboard[e.select.row][e.select.col].callback_data]])])):a("",!0),s.type==="inline"?(i(),n("div",to,[t("label",{for:"switch-inline-query-row-"+e.select.row+"-col-"+e.select.col,class:"form-label"},"Ссылка на аккаунт в ТЕЛЕГРАММ",8,oo),r(t("input",{type:"text",class:"form-control",onChange:o[14]||(o[14]=l=>e.needRemoveField("switch_inline_query",e.select.row,e.select.col)),"onUpdate:modelValue":o[15]||(o[15]=l=>e.keyboard[e.select.row][e.select.col].switch_inline_query=l),id:"switch-inline-query-row-"+e.select.row+"-col-"+e.select.col,placeholder:"@YourAccountLink"},null,40,so),[[h,e.keyboard[e.select.row][e.select.col].switch_inline_query]])])):a("",!0),s.type==="inline"?(i(),n("div",lo,[t("label",{for:"url-row-"+e.select.row+"-col-"+e.select.col,class:"form-label"},"Внешняя URL-ссылка",8,io),r(t("input",{type:"text",class:"form-control",onChange:o[16]||(o[16]=l=>e.needRemoveField("url",e.select.row,e.select.col)),"onUpdate:modelValue":o[17]||(o[17]=l=>e.keyboard[e.select.row][e.select.col].url=l),id:"url-row-"+e.select.row+"-col-"+e.colIndex,placeholder:"https://t.me/example"},null,40,no),[[h,e.keyboard[e.select.row][e.select.col].url]])])):a("",!0),s.type==="inline"?(i(),n("div",ao,[t("label",{for:"switch-inline-query-current-chat-row-"+e.select.row+"-col-"+e.select.col,class:"form-label"},"Команда всплывающего меню бота",8,ro),r(t("input",{type:"text",class:"form-control",onChange:o[18]||(o[18]=l=>e.needRemoveField("switch_inline_query_current_chat",e.select.row,e.select.col)),"onUpdate:modelValue":o[19]||(o[19]=l=>e.keyboard[e.select.row][e.select.col].switch_inline_query_current_chat=l),id:"switch-inline-query-current-chat-row-"+e.select.row+"-col-"+e.select.col,placeholder:"команда"},null,40,co),[[h,e.keyboard[e.select.row][e.select.col].switch_inline_query_current_chat]])])):a("",!0),s.type==="inline"?(i(),n("div",ho,[t("div",uo,[r(t("input",{class:"form-check-input","onUpdate:modelValue":o[20]||(o[20]=l=>e.need_login_url=l),type:"checkbox",id:"need-login-url"},null,512),[[_,e.need_login_url]]),mo]),e.need_login_url?(i(),n("div",bo,[t("label",{for:"login-link-row-"+e.select.row+"-col-"+e.select.col,class:"form-label"},"Ссылка авторизации ",8,po),r(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o[21]||(o[21]=l=>e.keyboard[e.select.row][e.select.col].login_url.url=l),id:"login-link-row-"+e.select.row+"-col-"+e.select.col,placeholder:"Ссылка авторизации",required:""},null,8,yo),[[h,e.keyboard[e.select.row][e.select.col].login_url.url]])])):a("",!0),e.need_login_url?(i(),n("div",_o,[t("label",{for:"login-link-forward-text-row-"+e.select.row+"-col-"+e.select.col,class:"form-label"},"Новый текст кнопки в пересылаемых сообщениях ",8,fo),r(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o[22]||(o[22]=l=>e.keyboard[e.select.row][e.select.col].login_url.forward_text=l),id:"login-link-forward-text-row-"+e.select.row+"-col-"+e.select.col,placeholder:"Текст кнопки"},null,8,ko),[[h,e.keyboard[e.select.row][e.select.col].login_url.forward_text]])])):a("",!0),e.need_login_url?(i(),n("div",go,[t("label",{for:"login-link-bot-username-row-"+e.select.row+"-col-"+e.select.col,class:"form-label"},"Имя бота, которое будет использоваться для авторизации ",8,$o),r(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o[23]||(o[23]=l=>e.keyboard[e.select.row][e.select.col].login_url.bot_username=l),id:"login-link-bot-username-row-"+e.select.row+"-col-"+e.select.col,placeholder:"Имя бота"},null,8,vo),[[h,e.keyboard[e.select.row][e.select.col].login_url.bot_username]])])):a("",!0),e.need_login_url?(i(),n("div",wo,[r(t("input",{class:"form-check-input","onUpdate:modelValue":o[24]||(o[24]=l=>e.keyboard[e.select.row][e.select.col].login_url.request_write_access=l),type:"checkbox",id:"need-request_write_access"},null,512),[[_,e.keyboard[e.select.row][e.select.col].login_url.request_write_access]]),Co])):a("",!0)])):a("",!0),s.type==="reply"?(i(),n("div",Fo,[t("input",{type:"radio",onChange:o[25]||(o[25]=l=>e.needRemoveField(null,e.select.row,e.select.col)),name:"request-radio",class:"form-check-input",id:"no-action-row-"+e.select.row+"-col-"+e.select.col},null,40,Po),t("label",{class:"form-check-label",for:"no-action-row-"+e.select.row+"-col-"+e.select.col}," Без действий ",8,Ro)])):a("",!0),s.type==="reply"?(i(),n("div",So,[t("input",{type:"radio",onChange:o[26]||(o[26]=l=>e.needRemoveField("request_contact",e.select.row,e.select.col)),onClick:o[27]||(o[27]=l=>e.keyboard[e.select.row][e.select.col].request_contact=!0),name:"request-radio",checked:e.keyboard[e.select.row][e.select.col].request_contact,class:"form-check-input",id:"phone-row-"+e.select.row+"-col-"+e.select.col},null,40,To),t("label",{class:"form-check-label",for:"phone-row-"+e.select.row+"-col-"+e.select.col}," Запросить телефон ",8,Ko)])):a("",!0),s.type==="reply"?(i(),n("div",Vo,[t("input",{type:"radio",name:"request-radio",checked:e.keyboard[e.select.row][e.select.col].request_location,onChange:o[28]||(o[28]=l=>e.needRemoveField("request_location",e.select.row,e.select.col)),onClick:o[29]||(o[29]=l=>e.keyboard[e.select.row][e.select.col].request_location=!0),class:"form-check-input",id:"location-row-"+e.select.row+"-col-"+e.select.col},null,40,jo),t("label",{class:"form-check-label",for:"location-row-"+e.select.row+"-col-"+e.select.col}," Запросить локацию ",8,Bo)])):a("",!0)])])])):a("",!0),t("div",{class:"modal fade",id:"page-list-in-keyboard-"+e.uuid,tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[t("div",Mo,[t("div",qo,[t("div",Oo,[g(et,{onCallback:e.attachPage,editor:!1},null,8,["onCallback"])])])])],8,Uo)],64))}});const Jo={key:0,class:"card"},Do={key:0,class:"card-header"},Lo={key:0,class:"d-flex justify-content-start align-items-center"},No=["disabled"],Ao=t("i",{class:"fa-solid fa-arrow-left"},null,-1),Eo=[Ao],zo=["disabled"],Go=t("i",{class:"fa-regular fa-pen-to-square"},null,-1),Ho=[Go],Qo=["disabled"],Xo=t("i",{class:"fa-regular fa-floppy-disk"},null,-1),Yo=[Xo],Wo={key:1,class:"d-flex justify-content-between align-items-center"},Zo={class:"mr-2"},xo=["disabled"],es=t("i",{class:"fa-regular fa-pen-to-square"},null,-1),ts=[es],os=["disabled"],ss=t("i",{class:"fa-regular fa-clone"},null,-1),ls=[ss],is=["disabled"],ns=t("i",{class:"fa-regular fa-floppy-disk"},null,-1),as=[ns],ds=["disabled"],rs=t("i",{class:"fa-solid fa-trash-can"},null,-1),cs=[rs],hs={class:"card-body"},us={key:0,class:"row"},ms={class:"col-md-6 col-12"},bs={class:"mb-3"},ps=t("label",{class:"form-label",id:"bot-domain"},"Тип",-1),ys=t("option",{value:"reply"},"Нижняя клавиатура",-1),_s=t("option",{value:"inline"},"Встроенная клавиатура",-1),fs=[ys,_s],ks={class:"col-md-6 col-12"},gs={class:"mb-3"},$s=t("label",{class:"form-label",id:"bot-domain"},"Мнемоническое имя",-1),vs={class:"row"},ws={class:"col-12"},Cs={class:"row"},Fs={class:"col-12"},Ps={class:"row"},Rs={class:"col"},Ss={type:"button",class:"btn btn-outline-primary w-100 mb-2"},Ts={key:1,class:"card"},Ks={class:"card-header d-flex justify-content-between align-items-center"},Vs=["disabled"],js=t("i",{class:"fa-regular fa-floppy-disk"},null,-1),Bs=[js],Us={class:"card-body"},Ms={props:["keyboard","selectMode","simple"],data:()=>({is_edited:!1,load:!1,keyboardForm:null}),components:{Vue3JsonEditor:v},computed:{uuid(){return P()}},watch:{keyboardForm:{handler(s){this.is_edited=!0},deep:!0}},mounted(){const s=this.keyboard;this.keyboardForm=s,this.$nextTick(()=>{this.is_edited=!1,Array.isArray(s.menu)||this.updateKeyboard()})},methods:{onJsonChange(s){this.keyboardForm=s},removeKeyboard(){this.$store.dispatch("removeKeyboardTemplate",{templateId:this.keyboardForm.id}).then(s=>{this.load=!0,this.$nextTick(()=>{this.load=!1}),this.$emit("callback",this.keyboardForm.id)}).catch(()=>{this.$emit("callback",this.keyboardForm.id)})},saveKeyboard(s){this.keyboardForm.menu=s},selectCard(){this.$emit("select",this.keyboardForm)},duplicateKeyboard(){let s=new FormData;Object.keys(this.keyboardForm).forEach(e=>{const o=this.keyboardForm[e]||"";typeof o=="object"?s.append(e,JSON.stringify(o)):s.append(e,o)}),this.$store.dispatch("createKeyboardTemplate",{keyboardForm:s}).then(e=>{this.$notify({title:"Конструктор ботов",text:"Меню успешно продублировано!",type:"success"}),this.load=!0,this.$nextTick(()=>{this.load=!1}),this.$emit("reload")})},updateKeyboard(){let s=new FormData;Object.keys(this.keyboardForm).forEach(e=>{const o=this.keyboardForm[e]||"";typeof o=="object"?s.append(e,JSON.stringify(o)):s.append(e,o)}),this.$store.dispatch("editKeyboardTemplate",{keyboardForm:s}).then(e=>{this.load=!0,this.$nextTick(()=>{this.load=!1,this.is_edited=!1}),this.$emit("callback")}).catch(()=>{this.is_edited=!1,this.$emit("callback")})}}},qs=Object.assign(Ms,{__name:"KeyboardCard",setup(s){return(e,o)=>(i(),n(m,null,[e.is_edited?a("",!0):(i(),n("div",Jo,[s.simple?a("",!0):(i(),n("div",Do,[s.selectMode?(i(),n("div",Lo,[t("button",{onClick:o[0]||(o[0]=(...l)=>e.selectCard&&e.selectCard(...l)),disabled:e.load,type:"button",class:"btn btn-outline-success mr-2"},Eo,8,No),t("button",{onClick:o[1]||(o[1]=l=>e.is_edited=!0),disabled:e.load,type:"button",title:"Редактировать клавиатуру",class:"btn btn-outline-success mr-2"},Ho,8,zo),t("button",{onClick:o[2]||(o[2]=(...l)=>e.updateKeyboard&&e.updateKeyboard(...l)),type:"button",title:"Обновить клавиатуру",disabled:e.load||!e.is_edited,class:b(["btn btn-outline-primary mr-2",{"have-change":e.is_edited}])},Yo,10,Qo)])):a("",!0),s.selectMode?a("",!0):(i(),n("div",Wo,[t("div",null,[t("strong",Zo,"#"+f(s.keyboard.id),1),t("button",{onClick:o[3]||(o[3]=l=>e.is_edited=!0),disabled:e.load,type:"button",title:"Редактировать клавиатуру",class:"btn btn-outline-success mr-2"},ts,8,xo),t("button",{onClick:o[4]||(o[4]=(...l)=>e.duplicateKeyboard&&e.duplicateKeyboard(...l)),type:"button",title:"Дублировать клавиатуру",disabled:e.load,class:"btn btn-outline-primary mr-2"},ls,8,os),t("button",{onClick:o[5]||(o[5]=(...l)=>e.updateKeyboard&&e.updateKeyboard(...l)),type:"button",title:"Обновить клавиатуру",disabled:e.load||!e.is_edited,class:b(["btn btn-outline-primary mr-2",{"have-change":e.is_edited}])},as,10,is)]),t("button",{onClick:o[6]||(o[6]=(...l)=>e.removeKeyboard&&e.removeKeyboard(...l)),type:"button",disabled:e.load,title:"Удалить клавиатуру",class:"btn btn-outline-danger mr-2"},cs,8,ds)]))])),t("div",hs,[s.selectMode?a("",!0):(i(),n("div",us,[t("div",ms,[t("div",bs,[ps,r(t("select",{disabled:!0,"onUpdate:modelValue":o[7]||(o[7]=l=>s.keyboard.type=l),class:"form-control"},fs,512),[[T,s.keyboard.type]])])]),t("div",ks,[t("div",gs,[$s,r(t("input",{type:"text",class:"form-control",placeholder:"Мнемоническое имя",disabled:!0,"aria-label":"Мнемоническое имя","onUpdate:modelValue":o[8]||(o[8]=l=>s.keyboard.slug=l),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[h,s.keyboard.slug]])])])])),t("div",vs,[t("div",ws,[t("div",Cs,[t("div",Fs,[(i(!0),n(m,null,k(s.keyboard.menu,(l,d)=>(i(),n("div",Ps,[(i(!0),n(m,null,k(l,(c,y)=>(i(),n("div",Rs,[t("button",Ss,f(c.text),1)]))),256))]))),256))])])])])])])),e.is_edited?(i(),n("div",Ts,[t("div",Ks,[t("button",{onClick:o[9]||(o[9]=(...l)=>e.updateKeyboard&&e.updateKeyboard(...l)),type:"button",title:"Обновить клавиатуру",disabled:e.load||!e.is_edited,class:b(["btn btn-outline-primary mr-2",{"have-change":e.is_edited}])},Bs,10,Vs)]),t("div",Us,[e.keyboardForm?(i(),p(w,{key:0,onSave:e.saveKeyboard,"edited-keyboard":e.keyboardForm},null,8,["onSave","edited-keyboard"])):a("",!0),g(S(v),{mode:"code",modelValue:e.keyboardForm,"onUpdate:modelValue":o[10]||(o[10]=l=>e.keyboardForm=l),"show-btns":!1,expandedOnStart:!0,onJsonChange:e.onJsonChange},null,8,["modelValue","onJsonChange"])])])):a("",!0)],64))}}),Os={key:0,class:"row mb-2 py-3"},Is={class:"col-12"},Js={class:"card"},Ds=t("div",{class:"card-header"},[t("h6",null,"Форма создания шаблона клавиатуры")],-1),Ls={class:"card-body"},Ns={class:"col-md-6 col-12"},As={class:"mb-3"},Es=t("label",{class:"form-label",id:"bot-domain"},"Тип",-1),zs=t("option",{value:"reply"},"Нижняя клавиатура",-1),Gs=t("option",{value:"inline"},"Встроенная клавиатура",-1),Hs=[zs,Gs],Qs={class:"col-md-6 col-12"},Xs={class:"mb-3"},Ys={class:"form-label d-flex justify-content-between",id:"bot-domain"},Ws=t("span",null,"Мнемоническое имя",-1),Zs=t("i",{class:"fa-solid fa-arrows-rotate"},null,-1),xs=[Zs],el={class:"col-12"},tl=t("div",{class:"col-12"},[t("button",{class:"btn btn-outline-success w-100 p-3"}," Добавить новый шаблон клавиатуры ")],-1),ol={class:"row"},sl={key:0,class:"col-12"},ll={class:"badge bg-warning"},il={class:"col-12 mb-3"},nl={key:1,class:"card"},al={class:"card-body"},dl={key:2,class:"col-12 mb-3"},rl=t("div",{class:"alert alert-warning",role:"alert"},[t("p",null,"Список шаблонов клавиатур пуст!")],-1),cl=[rl],hl={props:["selectMode","type"],data(){return{keyboards:[],load:!1,bot:null,editedKeyboard:null,selectMenuIndex:null,keyboardForm:{type:"reply",bot_id:null,slug:null,menu:[]}}},computed:{...$(["getCurrentBot"]),filteredKeyboard(){return this.type?this.keyboards.filter(s=>s.type==this.type):this.keyboards}},mounted(){this.loadCurrentBot().then(()=>{this.loadMenusByBotTemplate(),this.generateSlug()})},methods:{selectCard(s){this.$emit("select",s)},keyboardCallbackAction(s){let e=this.keyboards.find(o=>o.id===s);e&&(e.deleted_at=new Date),this.loadMenusByBotTemplate()},loadMenusByBotTemplate(){this.$store.dispatch("loadBotKeyboards",{botId:this.bot.id}).then(s=>{this.keyboards=s.data})},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},submitKeyboard(){this.keyboardForm.bot_id=this.bot.id;let s=new FormData;Object.keys(this.keyboardForm).forEach(e=>{const o=this.keyboardForm[e]||"";typeof o=="object"?s.append(e,JSON.stringify(o)):s.append(e,o)}),this.$store.dispatch("createKeyboardTemplate",{keyboardForm:s}).then(e=>{this.keyboardForm={type:"reply",bot_id:null,slug:null,menu:[]},this.load=!0,this.$nextTick(()=>{this.load=!1}),this.loadMenusByBotTemplate()})},generateSlug(){this.keyboardForm.slug=P()},changeKeyboardFormMenu(s){this.keyboardForm.menu=s}}},K=Object.assign(hl,{__name:"KeyboardList",setup(s){return(e,o)=>(i(),n(m,null,[s.selectMode?a("",!0):(i(),n("div",Os,[t("div",Is,[t("div",Js,[Ds,t("div",Ls,[t("form",{onSubmit:o[3]||(o[3]=F((...l)=>e.submitKeyboard&&e.submitKeyboard(...l),["prevent"])),class:"row"},[t("div",Ns,[t("div",As,[Es,r(t("select",{"onUpdate:modelValue":o[0]||(o[0]=l=>e.keyboardForm.type=l),class:"form-control"},Hs,512),[[T,e.keyboardForm.type]])])]),t("div",Qs,[t("div",Xs,[t("label",Ys,[Ws,t("a",{onClick:o[1]||(o[1]=(...l)=>e.generateSlug&&e.generateSlug(...l)),href:"#generate"},xs)]),r(t("input",{type:"text",class:"form-control",placeholder:"Мнемоническое имя","aria-label":"Мнемоническое имя","onUpdate:modelValue":o[2]||(o[2]=l=>e.keyboardForm.slug=l),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[h,e.keyboardForm.slug]])])]),t("div",el,[e.load?a("",!0):(i(),p(w,{key:0,onSave:e.changeKeyboardFormMenu,"edited-keyboard":e.keyboardForm},null,8,["onSave","edited-keyboard"]))]),tl],32)])])])])),t("div",ol,[e.keyboards&&e.bot?(i(),n("div",sl,[t("p",null,[u("В списке клавиатур "),t("span",ll,f(e.filteredKeyboard.length)+" ед.",1)])])):a("",!0),e.keyboards&&e.bot?(i(!0),n(m,{key:1},k(e.filteredKeyboard,(l,d)=>(i(),n("div",il,[l.deleted_at?(i(),n("div",nl,[t("div",al,[t("p",null,"Удаленная клавиатура #"+f(l.id),1)])])):(i(),p(qs,{key:0,"select-mode":s.selectMode,onSelect:e.selectCard,onReload:e.loadMenusByBotTemplate,onCallback:e.keyboardCallbackAction,keyboard:l},null,8,["select-mode","onSelect","onReload","onCallback","keyboard"]))]))),256)):a("",!0),e.filteredKeyboard.length===0?(i(),n("div",dl,cl)):a("",!0)])],64))}}),ul={class:"col-md-12 col-12"},ml={class:"mb-3"},bl=t("i",{class:"fa-solid fa-xmark"},null,-1),pl=[bl],yl={class:"mb-3"},_l={class:"d-flex justify-content-between flex-wrap al"},fl=t("label",{class:"form-label",id:"bot-main-channel"},"Канал для постов (id,рекламный)",-1),kl={class:"d-flex flex-wrap align-items-center"},gl=t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),$l={class:"col-12 mb-2"},vl=t("label",{class:"form-label d-flex justify-content-between align-items-center mb-2",id:"bot-domain"},[u(" Текстовое содержимое страницы "),t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),wl={class:"form-floating"},Cl={for:"floatingTextarea2"},Fl={key:0},Pl={class:"col-12 mb-2"},Rl={class:"form-check"},Sl=t("label",{class:"form-check-label",for:"need-page-images"}," Изображения на странице (максимум 10) ",-1),Tl={key:0,class:"col-12 mb-2"},Kl={class:"card mb-3"},Vl=t("div",{class:"card-header"},[t("h6",null,"Изображения на странице")],-1),jl={class:"card-body d-flex justify-content-start"},Bl={for:"photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},Ul={class:"row"},Ml={key:0,class:"col-12 d-flex flex-wrap"},ql={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Ol={class:"remove"},Il=["onClick"],Jl={class:"col-12 mb-2"},Dl={class:"form-check"},Ll=t("label",{class:"form-check-label",for:"need-inline-menu"}," Меню под текстом страницы ",-1),Nl={key:1,class:"col-12 mb-2"},Al={class:"card"},El={class:"card-header d-flex justify-between align-items-center"},zl=t("h6",null,"Конструктор меню в сообщении",-1),Gl={key:0},Hl={key:1},Ql={class:"card-body"},Xl=t("div",{class:"col-12"},[t("button",{type:"submit",class:"btn btn-success w-100 p-3"}," Отправить сообщение в канал ")],-1),Yl={data(){return{load:!1,photos:[],showInlineTemplateSelector:!1,need_page_images:!1,need_inline_menu:!1,bot:null,mailForm:{text:"",inline_keyboard:null,channel:null}}},computed:{...$(["getCurrentBot"])},mounted(){this.loadCurrentBot()},methods:{addTextTo(s={param:null,text:null}){this.mailForm.channel=s.text},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},submitMail(){let s=new FormData;if(Object.keys(this.mailForm).forEach(e=>{const o=this.mailForm[e]||"";typeof o=="object"?s.append(e,JSON.stringify(o)):s.append(e,o)}),this.bot&&s.append("bot_id",this.bot.id),this.photos.length>0)for(let e=0;e<this.photos.length;e++)s.append("photos[]",this.photos[e]);this.$store.dispatch("sendToChannel",{mailForm:s}).then(e=>{this.load=!0,this.photos=[],this.need_inline_menu=!1,this.need_page_images=!1,this.mailForm={text:"",channel:null,inline_keyboard:null},this.$notify({title:"Конструктор ботов",text:"Сообщение успещно отправлено!",type:"success"})}).catch(e=>{})},saveInlineKeyboard(s){this.mailForm.inline_keyboard=s},selectInlineKeyboard(s){this.mailForm.inline_keyboard=s,this.showInlineTemplateSelector=!1},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removePhoto(s){this.photos.splice(s,1)},removeImage(s){this.mailForm.images.splice(s,1)},onChangePhotos(s){const e=s.target.files;for(let o=0;o<e.length;o++)this.photos.push(e[o])}}},Wl=Object.assign(Yl,{__name:"ChannelMailForm",setup(s){return(e,o)=>{const l=V("lazy");return e.bot?(i(),n("form",{key:0,onSubmit:o[9]||(o[9]=F((...d)=>e.submitMail&&e.submitMail(...d),["prevent"]))},[t("div",ul,[t("div",ml,[e.mailForm.channel!=null?(i(),n("button",{key:0,type:"button",class:"btn btn-outline-info mr-2",onClick:o[0]||(o[0]=d=>e.mailForm.channel=null)},pl)):a("",!0),t("button",{type:"button",class:b(["btn mr-2",{"btn-info":e.mailForm.channel===e.bot.main_channel,"btn-outline-info":e.mailForm.channel!==e.bot.main_channel}]),onClick:o[1]||(o[1]=d=>e.mailForm.channel=e.bot.main_channel)},"Главный канал ",2),t("button",{type:"button",class:b(["btn",{"btn-info":e.mailForm.channel===e.bot.order_channel,"btn-outline-info":e.mailForm.channel!==e.bot.order_channel}]),onClick:o[2]||(o[2]=d=>e.mailForm.channel=e.bot.order_channel)},"Канал заказов ",2)]),t("div",yl,[t("div",_l,[fl,t("div",kl,[g(j,{token:e.bot.bot_token,param:"channel",onCallback:e.addTextTo},null,8,["token","onCallback"]),gl])]),r(t("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":o[3]||(o[3]=d=>e.mailForm.channel=d),maxlength:"255","aria-describedby":"bot-main-channel",required:""},null,512),[[h,e.mailForm.channel]])])]),t("div",$l,[vl,t("div",wl,[r(t("textarea",{class:"form-control","onUpdate:modelValue":o[4]||(o[4]=d=>e.mailForm.text=d),maxlength:"4096",placeholder:"Введите текст",id:"floatingTextarea2",style:{"min-height":"100px"},required:""},null,512),[[h,e.mailForm.text]]),t("label",Cl,[u("Содержимое страницы "),e.mailForm.text?(i(),n("span",Fl,f(e.mailForm.text.length)+"/4096 ",1)):a("",!0)])])]),t("div",Pl,[t("div",Rl,[r(t("input",{class:"form-check-input","onUpdate:modelValue":o[5]||(o[5]=d=>e.need_page_images=d),type:"checkbox",id:"need-page-images"},null,512),[[_,e.need_page_images]]),Sl])]),e.need_page_images?(i(),n("div",Tl,[t("div",Kl,[Vl,t("div",jl,[t("label",Bl,[u(" + "),t("input",{type:"file",id:"photos",multiple:"",accept:"image/*",onChange:o[6]||(o[6]=(...d)=>e.onChangePhotos&&e.onChangePhotos(...d)),style:{display:"none"}},null,32)]),t("div",Ul,[e.photos.length>0?(i(),n("div",Ml,[(i(!0),n(m,null,k(e.photos,(d,c)=>(i(),n("div",ql,[r(t("img",null,null,512),[[l,e.getPhoto(d).imageUrl]]),t("div",Ol,[t("a",{onClick:y=>e.removePhoto(c)},"Удалить",8,Il)])]))),256))])):a("",!0)])])])])):a("",!0),t("div",Jl,[t("div",Dl,[r(t("input",{class:"form-check-input","onUpdate:modelValue":o[7]||(o[7]=d=>e.need_inline_menu=d),type:"checkbox",id:"need-inline-menu"},null,512),[[_,e.need_inline_menu]]),Ll])]),e.need_inline_menu?(i(),n("div",Nl,[t("div",Al,[t("div",El,[zl,t("button",{class:b(["btn",{"btn-outline-primary":!e.showInlineTemplateSelector,"btn-primary":e.showInlineTemplateSelector}]),type:"button",onClick:o[8]||(o[8]=d=>e.showInlineTemplateSelector=!e.showInlineTemplateSelector)},[e.showInlineTemplateSelector?(i(),n("span",Hl," Скрыть шаблоны меню")):(i(),n("span",Gl," Открыть шаблоны меню"))],2)]),t("div",Ql,[e.showInlineTemplateSelector?(i(),p(K,{key:0,class:"mb-2",type:"inline",onSelect:e.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(i(),p(w,{key:1,type:"inline",onSave:e.saveInlineKeyboard,"edited-keyboard":e.mailForm.inline_keyboard},null,8,["onSave","edited-keyboard"]))])])])):a("",!0),Xl],32)):a("",!0)}}}),Zl={class:"col-12 mb-2"},xl=t("label",{class:"form-label d-flex justify-content-between align-items-center mb-2",id:"bot-domain"},[u(" Текстовое содержимое рассылки "),t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),ei={class:"form-floating"},ti={for:"floatingTextarea2"},oi={key:0},si={class:"col-12 mb-2"},li={class:"form-check"},ii=t("label",{class:"form-check-label",for:"need-page-images"}," Изображения в рассылке (максимум 10) ",-1),ni={key:0,class:"col-12 mb-2"},ai={class:"card mb-3"},di=t("div",{class:"card-header"},[t("h6",null,"Изображения в рассылке")],-1),ri={class:"card-body"},ci={class:"col-12 mb-2"},hi={class:"form-check"},ui=t("label",{class:"form-check-label",for:"need-inline-menu"}," Меню под текстом рассылки ",-1),mi={key:1,class:"col-12 mb-2"},bi={class:"card"},pi={class:"card-header d-flex justify-between align-items-center"},yi=t("h6",null,"Конструктор меню в сообщении",-1),_i={key:0},fi={key:1},ki={class:"card-body"},gi=t("div",{class:"col-12"},[t("button",{type:"submit",class:"btn btn-success w-100 p-3"}," Поставить сообщение в очередь ")],-1),$i={data(){return{load:!1,showInlineTemplateSelector:!1,need_page_images:!1,need_inline_menu:!1,bot:null,mailForm:{message:"",inline_keyboard:null,images:[]}}},computed:{...$(["getCurrentBot"])},mounted(){this.loadCurrentBot()},methods:{selectImages(s){this.mailForm.images||(this.mailForm.images=[]);let e=this.mailForm.images.indexOf(s.file_id);e!==-1?this.mailForm.images.splice(e,1):this.mailForm.images.push(s.file_id)},addTextTo(s={param:null,text:null}){this.mailForm.channel=s.text},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},submitMail(){let s=new FormData;Object.keys(this.mailForm).forEach(e=>{const o=this.mailForm[e]||"";typeof o=="object"?s.append(e,JSON.stringify(o)):s.append(e,o)}),this.bot&&s.append("bot_id",this.bot.id),this.$store.dispatch("sendToQueue",{mailForm:s}).then(e=>{this.load=!0,this.need_inline_menu=!1,this.need_page_images=!1,this.mailForm={message:"",images:null,inline_keyboard:null},this.$notify({title:"Рассылка",text:"Сообщение успешно поставлено в очередь!",type:"success"})}).catch(e=>{})},saveInlineKeyboard(s){this.mailForm.inline_keyboard=s},selectInlineKeyboard(s){this.mailForm.inline_keyboard=s,this.showInlineTemplateSelector=!1},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removePhoto(s){this.photos.splice(s,1)},removeImage(s){this.mailForm.images.splice(s,1)},onChangePhotos(s){const e=s.target.files;for(let o=0;o<e.length;o++)this.photos.push(e[o])}}},vi=Object.assign($i,{__name:"PersonalMailForm",setup(s){return(e,o)=>e.bot?(i(),n("form",{key:0,onSubmit:o[4]||(o[4]=F((...l)=>e.submitMail&&e.submitMail(...l),["prevent"]))},[t("div",Zl,[xl,t("div",ei,[r(t("textarea",{class:"form-control","onUpdate:modelValue":o[0]||(o[0]=l=>e.mailForm.message=l),maxlength:"4096",placeholder:"Введите текст",id:"floatingTextarea2",style:{"min-height":"100px"},required:""},null,512),[[h,e.mailForm.message]]),t("label",ti,[u("Содержимое страницы "),e.mailForm.message?(i(),n("span",oi,f(e.mailForm.message.length)+"/4096 ",1)):a("",!0)])])]),t("div",si,[t("div",li,[r(t("input",{class:"form-check-input","onUpdate:modelValue":o[1]||(o[1]=l=>e.need_page_images=l),type:"checkbox",id:"need-page-images"},null,512),[[_,e.need_page_images]]),ii])]),e.need_page_images?(i(),n("div",ni,[t("div",ai,[di,t("div",ri,[g(B,{"need-photo":!0,selected:e.mailForm.images,onSelect:e.selectImages},null,8,["selected","onSelect"])])])])):a("",!0),t("div",ci,[t("div",hi,[r(t("input",{class:"form-check-input","onUpdate:modelValue":o[2]||(o[2]=l=>e.need_inline_menu=l),type:"checkbox",id:"need-inline-menu"},null,512),[[_,e.need_inline_menu]]),ui])]),e.need_inline_menu?(i(),n("div",mi,[t("div",bi,[t("div",pi,[yi,t("button",{class:b(["btn",{"btn-outline-primary":!e.showInlineTemplateSelector,"btn-primary":e.showInlineTemplateSelector}]),type:"button",onClick:o[3]||(o[3]=l=>e.showInlineTemplateSelector=!e.showInlineTemplateSelector)},[e.showInlineTemplateSelector?(i(),n("span",fi," Скрыть шаблоны меню")):(i(),n("span",_i," Открыть шаблоны меню"))],2)]),t("div",ki,[e.showInlineTemplateSelector?(i(),p(K,{key:0,class:"mb-2",type:"inline",onSelect:e.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(i(),p(w,{key:1,type:"inline",onSave:e.saveInlineKeyboard,"edited-keyboard":e.mailForm.inline_keyboard},null,8,["onSave","edited-keyboard"]))])])])):a("",!0),gi],32)):a("",!0)}}),wi={class:"py-2"},Ci={class:"nav nav-tabs"},Fi={class:"nav-item"},Pi={class:"nav-item"},Ri={key:0,class:"row"},Si={class:"col-12 py-2"},Ti={key:1,class:"row"},Ki={class:"col-12 py-2"},Vi={data(){return{tab:1,load:!1}},computed:{...$(["getCurrentBot"])},mounted(){},methods:{}},Ii=Object.assign(Vi,{__name:"Mail",setup(s){return(e,o)=>(i(),n("div",wi,[t("ul",Ci,[t("li",Fi,[t("a",{class:b(["nav-link",{active:e.tab===0}]),onClick:o[0]||(o[0]=l=>e.tab=0),"aria-current":"page",href:"#"},"Рассылка в канал",2)]),t("li",Pi,[t("a",{class:b(["nav-link",{active:e.tab===1}]),onClick:o[1]||(o[1]=l=>e.tab=1),href:"#"},"Рассылка в бота",2)])]),e.tab===0?(i(),n("div",Ri,[t("div",Si,[g(Wl)])])):a("",!0),e.tab===1?(i(),n("div",Ti,[t("div",Ki,[g(vi)])])):a("",!0)]))}});export{et as _,w as a,qs as b,K as c,Ii as d};
