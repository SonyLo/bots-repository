import{G as y,L as $,q as i,t as a,v as t,H as r,J as u,F as h,C as p,y as m,D as f,x as v,K as C,A as c,T as S,B as b,u as w,z as V,P as F,R as U,O as _}from"./index.es-f98e90e3.js";import{V as k,T as j}from"./TelegramChannelHelper-ed863637.js";import{_ as O}from"./BotMediaList-30372b72.js";import{P as I}from"./Pagination-8d87cf85.js";const T={class:"form-floating mb-3"},M=t("label",{for:"floatingInput"},"Команда",-1),A={class:"form-floating mb-3"},B=t("label",{for:"floatingInput"},"Мнемоническое имя",-1),P={class:"form-floating mb-3"},G=t("label",{for:"floatingInput"},"Описание скрипта",-1),J=t("h6",null," Параметры скрипта ",-1),N=t("div",{class:"alert alert-info",role:"alert"}," Данные параметры используются для настройки скриптов на стороне сервера ",-1),D={class:"dropdown"},q=t("button",{class:"btn btn-outline-info w-100 dropdown-toggle mb-2",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," Добавить ",-1),E={class:"dropdown-menu w-100"},L=["onClick"],H={class:"row"},z={class:"col-12"},K=["onClick"],R={key:0,class:"row"},Q={class:"col-md-6 mb-1"},W={class:"card"},X={class:"card-header d-flex justify-content-between align-items-center"},Y=["onClick"],Z=t("i",{class:"fa-solid fa-trash-can"},null,-1),x=[Z],ee=["onClick"],te=t("i",{class:"fa-solid fa-caret-left"},null,-1),oe=[te],le=["onClick"],se=t("i",{class:"fa-solid fa-caret-right"},null,-1),ie=[se],ne={class:"dropdown"},ae={class:"btn btn-outline-info dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},de={class:"dropdown-menu"},re=["onClick"],ue={class:"card-body"},ce={class:"form-floating mb-1"},me=["onUpdate:modelValue","id"],ge=["for"],fe={class:"form-floating mb-1"},he=["innerHTML"],pe={key:1,class:"mb-0 font-10"},be={key:0,class:"form-floating mb-1"},_e=["id","onUpdate:modelValue"],ye=["for"],ve={key:1,class:"form-check mb-1 mt-2"},Ce=["onUpdate:modelValue","id"],Fe=["for"],ke={key:2,class:"form-floating mb-1 mt-2"},$e=["onUpdate:modelValue","id"],Se=["for"],we={key:3,class:"form-floating mb-1 mt-2"},Ve=["onUpdate:modelValue","id"],Ue=["for"],je={key:4,class:"form-floating mb-1 mt-2"},Oe=["onUpdate:modelValue","id"],Ie=["for"],Te={key:5,class:"form-floating mb-1 mt-2"},Me=t("label",{class:"form-label",id:"bot-domain"},"JSON-код",-1),Ae={key:6,class:"form-check mb-1 mt-2"},Be=["onUpdate:modelValue","id"],Pe=["for"],Ge={key:7,class:"form-floating mb-3"},Je=["id","onUpdate:modelValue"],Ne=["for"],De={key:8,class:"form-floating mb-3"},qe=["id","onUpdate:modelValue"],Ee=["for"],Le={key:1,class:"row"},He=t("div",{class:"col-12"},[t("p",null,"Параметры скрипта еще не добавлены")],-1),ze=[He],Ke={class:"btn btn-primary text-white w-100 mt-2 p-3"},Re={key:0},Qe={key:1},We={props:["item"],components:{Vue3JsonEditor:k},data(){return{filters:[],simple:!0,configTypes:[{title:"Текстовый или числовой параметр",type:"text"},{title:"Большое текстовое поле",type:"large-text"},{title:"Канал обратной связи",type:"channel"},{title:"Логический оператор",type:"boolean"},{title:"Ссылка на изображение",type:"image"},{title:"Цвет",type:"color"},{title:"Geo",type:"geo"},{title:"Номер телефона",type:"phone"},{title:"ID скрипта",type:"script"},{title:"JSON",type:"json"}],bot:null,photos:[],slugForm:{bot_id:null,id:null,command:null,comment:null,slug:null,config:[],is_global:!0}}},computed:{...y(["getCurrentBot"]),filteredConfigs(){return this.filters.length==0?this.slugForm.config:this.slugForm.config.filter(l=>this.filters.indexOf(l.type)>=0)}},mounted(){this.loadCurrentBot(),this.item&&(this.slugForm.id=this.item.id||null,this.slugForm.command=this.item.command,this.slugForm.comment=this.item.comment,this.slugForm.bot_id=this.item.bot_id,this.slugForm.slug=this.item.slug,this.slugForm.config=this.item.config||[],this.slugForm.is_global=this.item.is_global||!1)},methods:{toggleFilter(l){let e=this.filters.indexOf(l);e>=0?this.filters.splice(e,1):this.filters.push(l)},addTextTo(l,e={text:null}){this.slugForm.config[l].value=e.text},loadCurrentBot(l=null){return this.$store.dispatch("updateCurrentBot",{bot:l}).then(()=>{this.bot=this.getCurrentBot})},submit(){let l=new FormData;Object.keys(this.slugForm).forEach(e=>{const d=this.slugForm[e]||"";typeof d=="object"?l.append(e,JSON.stringify(d)):l.append(e,d)}),this.$store.dispatch(this.slugForm.id===null?"createSlug":"updateSlug",{slugForm:l}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно обновлена",type:"success"}),this.slugForm.id===null&&(this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0),this.$emit("callback")}).catch(e=>{})},onJsonChange(l,e){this.filteredConfigs[e].value=l},addConfig(l){this.slugForm.config.splice(0,0,{key:null,value:null,type:l||"text"})},move(l,e=0){let d=this.slugForm.config[l],g=this.slugForm.config.length||0,n=e===0?l-1>=0?l-1:g-1:l<g-1?l+1:0;this.slugForm.config[l]=this.slugForm.config[n],this.slugForm.config[n]=d},removeConfigItem(l){try{this.slugForm.config.splice(l,1)}catch{this.slugForm.config=[]}},selectPhoto(l,e){this.filteredConfigs[e].value=l.file_id}}},Vt=Object.assign(We,{__name:"SlugForm",setup(l){return(e,d)=>{const g=$("mask");return i(),a("form",{onSubmit:d[3]||(d[3]=F((...n)=>e.submit&&e.submit(...n),["prevent"]))},[t("div",T,[r(t("input",{type:"text","onUpdate:modelValue":d[0]||(d[0]=n=>e.slugForm.command=n),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[u,e.slugForm.command]]),M]),t("div",A,[r(t("input",{type:"text","onUpdate:modelValue":d[1]||(d[1]=n=>e.slugForm.slug=n),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[u,e.slugForm.slug]]),B]),t("div",P,[r(t("input",{type:"text","onUpdate:modelValue":d[2]||(d[2]=n=>e.slugForm.comment=n),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[u,e.slugForm.comment]]),G]),J,N,t("div",D,[q,t("ul",E,[(i(!0),a(h,null,p(e.configTypes,(n,o)=>(i(),a("li",null,[t("a",{class:"dropdown-item",onClick:s=>e.addConfig(n.type)},m(n.title||"Не установлен"),9,L)]))),256))])]),t("div",H,[t("div",z,[t("p",null,[f("Фильтры: "),(i(!0),a(h,null,p(e.configTypes,(n,o)=>(i(),a("span",{class:v(["badge mb-1 bg-gray-100 cursor-pointer mr-1",{"bg-info":e.filters.indexOf(n.type)>=0}]),onClick:s=>e.toggleFilter(n.type)},m(n.type),11,K))),256))])])]),e.filteredConfigs.length>0?(i(),a("div",R,[(i(!0),a(h,null,p(e.filteredConfigs,(n,o)=>(i(),a("div",Q,[t("div",W,[t("div",X,[t("div",null,[t("button",{onClick:s=>e.removeConfigItem(o),class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},x,8,Y),t("button",{onClick:s=>e.move(o,0),style:{"margin-left":"5px"},class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},oe,8,ee),t("button",{onClick:s=>e.move(o,1),style:{"margin-left":"5px"},class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},ie,8,le)]),e.bot&&e.filteredConfigs[o].type==="channel"?(i(),C(j,{key:0,token:e.bot.bot_token,onCallback:s=>e.addTextTo(o,s)},null,8,["token","onCallback"])):c("",!0),t("div",null,[t("div",ne,[t("button",ae,m(e.filteredConfigs[o].type),1),t("ul",de,[(i(!0),a(h,null,p(e.configTypes,s=>(i(),a("li",null,[t("a",{class:"dropdown-item",onClick:Ft=>e.filteredConfigs[o].type=s.type},m(s.title||n.type),9,re)]))),256))])])])]),t("div",ue,[t("div",ce,[r(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s=>e.filteredConfigs[o].key=s,id:"field-input-key-"+o,placeholder:"name@example.com"},null,8,me),[[u,e.filteredConfigs[o].key]]),t("label",{for:"field-input-key-"+o},"Ключ",8,ge)]),t("div",fe,[e.filteredConfigs[o].description?(i(),a("p",{key:0,class:"mb-0 font-italic font-10",innerHTML:e.filteredConfigs[o].description},null,8,he)):(i(),a("p",pe,"без описания"))]),e.filteredConfigs[o].type==="text"||e.filteredConfigs[o].type==="channel"?(i(),a("div",be,[r(t("input",{type:"text",class:"form-control",id:"field-input-"+o,"onUpdate:modelValue":s=>e.filteredConfigs[o].value=s,placeholder:"name@example.com"},null,8,_e),[[u,e.filteredConfigs[o].value]]),t("label",{for:"field-input-"+o},"Значение",8,ye)])):c("",!0),e.filteredConfigs[o].type==="boolean"?(i(),a("div",ve,[r(t("input",{class:"form-check-input","onUpdate:modelValue":s=>e.filteredConfigs[o].value=s,type:"checkbox",value:"false",id:"filtered-config-"+o+"-checkbox"},null,8,Ce),[[S,e.filteredConfigs[o].value]]),t("label",{class:"form-check-label",for:"filtered-config-"+o+"-checkbox"},m(e.filteredConfigs[o].value?"Истина":"Ложь"),9,Fe)])):c("",!0),e.filteredConfigs[o].type==="geo"?(i(),a("div",ke,[r(t("input",{class:"form-control",placeholder:"##.######,##.######","onUpdate:modelValue":s=>e.filteredConfigs[o].value=s,type:"text",id:"filtered-config-"+o+"-geo"},null,8,$e),[[g,"##.######,##.######"],[u,e.filteredConfigs[o].value]]),t("label",{for:"filtered-config-"+o+"-geo"},"Значение",8,Se)])):c("",!0),e.filteredConfigs[o].type==="script"?(i(),a("div",we,[r(t("input",{class:"form-control","onUpdate:modelValue":s=>e.filteredConfigs[o].value=s,type:"text",id:"filtered-config-"+o+"-script"},null,8,Ve),[[u,e.filteredConfigs[o].value]]),t("label",{for:"filtered-config-"+o+"-script"},"Значение",8,Ue)])):c("",!0),e.filteredConfigs[o].type==="phone"?(i(),a("div",je,[r(t("input",{class:"form-control",placeholder:"+7(###)###-##-##","onUpdate:modelValue":s=>e.filteredConfigs[o].value=s,type:"text",id:"filtered-config-"+o+"-phone"},null,8,Oe),[[g,"+7(###)###-##-##"],[u,e.filteredConfigs[o].value]]),t("label",{for:"filtered-config-"+o+"-phone"},"Значение",8,Ie)])):c("",!0),e.filteredConfigs[o].type==="json"?(i(),a("div",Te,[Me,b(w(k),{mode:"form",modelValue:e.filteredConfigs[o].value,"onUpdate:modelValue":s=>e.filteredConfigs[o].value=s,"show-btns":!1,expandedOnStart:!0,onJsonChange:s=>e.onJsonChange(s,o)},null,8,["modelValue","onUpdate:modelValue","onJsonChange"])])):c("",!0),e.filteredConfigs[o].type==="color"?(i(),a("div",Ae,[r(t("input",{class:"form-control","onUpdate:modelValue":s=>e.filteredConfigs[o].value=s,type:"color",id:"filtered-config-"+o+"-color"},null,8,Be),[[u,e.filteredConfigs[o].value]]),t("label",{for:"filtered-config-"+o+"-color"},[t("p",{style:V({color:e.filteredConfigs[o].value})},"Цвет: "+m(e.filteredConfigs[o].value),5)],8,Pe)])):c("",!0),e.filteredConfigs[o].type==="large-text"?(i(),a("div",Ge,[r(t("textarea",{class:"form-control",id:"field-input-"+o,"onUpdate:modelValue":s=>e.filteredConfigs[o].value=s,placeholder:"name@example.com"},`
                            `,8,Je),[[u,e.filteredConfigs[o].value]]),t("label",{for:"field-input-"+o},"Значение",8,Ne)])):c("",!0),e.filteredConfigs[o].type==="image"?(i(),a("div",De,[r(t("input",{class:"form-control mb-2",id:"field-input-"+o,type:"text",disabled:"true","onUpdate:modelValue":s=>e.filteredConfigs[o].value=s,placeholder:"name@example.com"},null,8,qe),[[u,e.filteredConfigs[o].value]]),t("label",{for:"field-input-"+o},"FileId ссылка на изображение",8,Ee),b(O,{"need-video":!1,"need-photo":!0,selected:[e.filteredConfigs[o].value],onSelect:s=>e.selectPhoto(s,o)},null,8,["selected","onSelect"])])):c("",!0)])])]))),256))])):(i(),a("div",Le,ze)),t("button",Ke,[e.slugForm.id==null?(i(),a("span",Re," Сохранить команду ")):(i(),a("span",Qe," Обновить команду "))])],32)}}}),Xe={class:"row"},Ye={class:"col-12"},Ze={class:"form-floating mb-3"},xe=t("label",{for:"floatingInput"},"Быстрый поиск команды",-1),et={key:0,class:"row"},tt={class:"col-lg-3 col-md-6 col-12 mb-3"},ot=["onClick"],lt={class:"card-body"},st={style:{"word-wrap":"break-word"},class:"mb-0"},it=t("i",{class:"fa-solid fa-scroll"},null,-1),nt={class:"mb-2"},at={class:"col-12"},dt={key:2},rt={key:3,class:"modal fade",id:"add-slug-to-bot",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},ut={class:"modal-dialog"},ct={class:"modal-content"},mt={class:"modal-body"},gt={class:"mb-3"},ft={class:"form-label",id:"bot-domain"},ht=t("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),pt=t("div",null,[f("Измените только текст команды,"),t("br"),f(" если хотите чтоб скрипт вызывался по кнопке из меню. "),t("br"),f(" Или оставьте как есть. "),t("br"),f(" Текст скрипта нужно также указать в качестве пункта меню. ")],-1),bt=t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),_t=t("div",{class:"alert alert-info",role:"alert"}," При добавлении вы можете указать любое имя, которое вам нравится. Не обязательно использовать стандартное. ",-1),yt=["disabled"],vt=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Не добавлять")],-1),Ct={props:["canAdd","bot","hideAddModal"],data(){return{search:null,slugs:[],slugs_paginate_object:null,addSlugModal:null,slugForm:{command:null,comment:null,slug:null,config:[],is_global:!0,bot_id:null}}},computed:{...y(["getGlobalSlugs","getGlobalSlugsPaginateObject"])},watch:{search:function(l,e){this.loadAllSlugs()}},mounted(){this.loadAllSlugs(),this.addSlugModal=new bootstrap.Modal(document.getElementById("add-slug-to-bot"),{})},methods:{loadAllSlugs(l=0){this.$store.dispatch("loadGlobalSlugs",{dataObject:{needGlobal:!0,search:this.search},page:l}).then(e=>{this.slugs=this.getGlobalSlugs,this.slugs_paginate_object=this.getGlobalSlugsPaginateObject})},removeSlug(l){this.$store.dispatch("removeSlug",{dataObject:{slugId:l.id}}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно удалена",type:"success"}),this.loadAllSlugs()}).catch(e=>{this.loadAllSlugs()})},nextSlugs(l){this.loadAllSlugs(l)},selectSlug(l){this.slugForm.id=l.id||null,this.slugForm.slug=l.slug,this.slugForm.comment=l.comment,this.slugForm.command=this.command||l.command,this.slugForm.config=l.config||[],this.slugForm.is_global=l.is_global||!1,this.$emit("select",l),this.hideAddModal||this.addSlugModal.show()},addSlug(){let l=new FormData;Object.keys(this.slugForm).forEach(e=>{const d=this.slugForm[e]||"";typeof d=="object"?l.append(e,JSON.stringify(d)):l.append(e,d)}),this.bot&&l.append("bot_id",this.bot.id),this.$store.dispatch("createSlug",{slugForm:l}).then(e=>{this.$notify({title:"Скрипты",text:"Скрипт успешно добавлен",type:"success"}),this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0,this.$emit("callback"),this.addSlugModal.hide()}).catch(e=>{})}}},Ut=Object.assign(Ct,{__name:"GlobalSlugList",setup(l){return(e,d)=>{const g=U("Popper");return i(),a(h,null,[t("div",Xe,[t("div",Ye,[t("div",Ze,[r(t("input",{type:"search","onUpdate:modelValue":d[0]||(d[0]=n=>e.search=n),class:"form-control",id:"floatingInput",placeholder:"Название команды"},null,512),[[u,e.search]]),xe])])]),e.slugs.length>0?(i(),a("div",et,[(i(!0),a(h,null,p(e.slugs,(n,o)=>(i(),a("div",tt,[t("div",{class:v(["card",{"btn-outline-info":n.deleted_at==null,"btn-outline-danger border-danger":n.deleted_at!=null}]),style:{"min-height":"160px"},onClick:s=>e.selectSlug(n)},[t("div",lt,[t("p",st,[it,f(" "+m(n.command),1)]),t("p",nt,[t("small",null,[t("strong",null,[t("em",null,m(n.slug),1)])])]),t("p",null,m(n.comment||"Пояснение не указано"),1)])],10,ot)]))),256)),t("div",at,[e.slugs_paginate_object?(i(),C(I,{key:0,onPagination_page:e.nextSlugs,pagination:e.slugs_paginate_object},null,8,["onPagination_page","pagination"])):c("",!0)])])):(i(),a("p",dt,"Глобальных скриптов не обнаружено")),l.canAdd?(i(),a("div",rt,[t("div",ut,[t("div",ct,[t("div",mt,[l.canAdd&&e.slugs.length>0?(i(),a("form",{key:0,onSubmit:d[2]||(d[2]=F((...n)=>e.addSlug&&e.addSlug(...n),["prevent"]))},[t("p",null,"Идентификатор скрипта #"+m(e.slugForm.id||"Не указан"),1),t("div",gt,[t("label",ft,[b(g,null,{content:_(()=>[pt]),default:_(()=>[ht]),_:1}),f(" Команда "),bt]),r(t("input",{type:"text",class:"form-control",placeholder:"Команда","aria-label":"Команда","onUpdate:modelValue":d[1]||(d[1]=n=>e.slugForm.command=n),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[u,e.slugForm.command]])]),t("p",null,[t("small",null,[t("em",null,m(e.slugForm.comment||"Не указан"),1)])]),_t,t("button",{disabled:e.slugForm.slug==null,class:"btn btn-success mt-2 mb-2 w-100 p-3"},"Добавить скрипт в бота ",8,yt)],32)):c("",!0)]),vt])])])):c("",!0)],64)}}});export{Ut as _,Vt as a};
