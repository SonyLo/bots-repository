import{T as F,o as n,q as a,t,F as h,B as p,v as b,C as f,x as m,z as c,H as y,N as v,A as k,M as _,D as d,G as u,J as w,O as $,y as S}from"./index.es-485b8c94.js";import{P as V}from"./Pagination-19ddab76.js";import{m as C}from"./index-ec071723.js";import{T as U}from"./TelegramChannelHelper-7b7c8721.js";const O={key:0,class:"row"},j={class:"col-12 mb-3"},T={class:"list-group w-100"},A=["onClick"],B={key:0,class:"badge bg-info"},G=["onClick"],I=t("i",{class:"fa-solid fa-trash-can"},null,-1),L=[I],P={class:"col-12"},N={key:2},q={class:"card-body"},D={class:"mb-3"},E={class:"form-label",id:"bot-domain"},M=t("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),z=t("div",null,[f("Измените только текст команды,"),t("br"),f(" если хотите чтоб скрипт вызывался по кнопке из меню. "),t("br"),f(" Или оставьте как есть. "),t("br"),f(" Текст скрипта нужно также указать в качестве пункта меню. ")],-1),J=t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),H=["disabled"],R={props:["canAdd","bot"],data(){return{search:null,slugs:[],slugs_paginate_object:null,slugForm:{command:null,comment:null,slug:null,config:[],is_global:!0,bot_id:null}}},computed:{...C(["getGlobalSlugs","getGlobalSlugsPaginateObject"]),filteredAllSlugs(){return this.slugs.length===0?[]:this.search==null?this.slugs:this.slugs.filter(l=>{let e=l.slug||"",r=l.command||"",g=l.comment||"";return r.toLowerCase().indexOf(this.search.toLowerCase())!==-1||g.toLowerCase().indexOf(this.search.toLowerCase())!==-1||e.toLowerCase().indexOf(this.search.toLowerCase())!==-1})}},mounted(){this.loadAllSlugs()},methods:{loadAllSlugs(l=0){this.$store.dispatch("loadGlobalSlugs",{dataObject:{needGlobal:!0},page:l}).then(e=>{this.slugs=this.getGlobalSlugs,this.slugs_paginate_object=this.getGlobalSlugsPaginateObject})},removeSlug(l){this.$store.dispatch("removeSlug",{dataObject:{slugId:l.id}}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно удалена",type:"success"}),this.loadAllSlugs()}).catch(e=>{this.loadAllSlugs()})},nextSlugs(l){this.loadAllSlugs(l)},selectSlug(l){this.slugForm.id=l.id||null,this.slugForm.slug=l.slug,this.slugForm.comment=l.comment,this.slugForm.command=this.command||l.command,this.slugForm.config=l.config||[],this.slugForm.is_global=l.is_global||!1,this.$emit("select",l)},addSlug(){let l=new FormData;Object.keys(this.slugForm).forEach(e=>{const r=this.slugForm[e]||"";typeof r=="object"?l.append(e,JSON.stringify(r)):l.append(e,r)}),this.bot&&l.append("bot_id",this.bot.id),this.$store.dispatch("createSlug",{slugForm:l}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно обновлена",type:"success"}),this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0,this.$emit("callback")}).catch(e=>{})}}},rt=Object.assign(R,{__name:"GlobalSlugList",setup(l){return(e,r)=>{const g=F("Popper");return n(),a(h,null,[e.filteredAllSlugs.length>0?(n(),a("div",O,[t("div",j,[t("ul",T,[(n(!0),a(h,null,p(e.filteredAllSlugs,(s,o)=>(n(),a("li",{class:b(["list-group-item cursor-pointer btn mb-1 d-flex align-items-center justify-between",{"btn-outline-info":s.deleted_at==null,"btn-outline-danger border-danger":s.deleted_at!=null}])},[t("strong",{onClick:i=>e.selectSlug(s),style:{"word-wrap":"break-word"}},[t("i",{class:b([{"text-danger":s.deleted_at!=null},"fa-solid fa-scroll"])},null,2),f(" "+m(s.command)+" (",1),t("span",null,m(s.slug),1),f(") ")],8,A),s.comment?(n(),a("span",B,m(s.comment||"Пояснение не указано"),1)):c("",!0),t("button",{class:"btn btn-outline-danger",onClick:i=>e.removeSlug(s),type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},L,8,G)],2))),256))])]),t("div",P,[e.slugs_paginate_object?(n(),y(V,{key:0,onPagination_page:e.nextSlugs,pagination:e.slugs_paginate_object},null,8,["onPagination_page","pagination"])):c("",!0)])])):(n(),a("p",N,"Глобальных скриптов не обноружено")),l.canAdd&&e.filteredAllSlugs.length>0?(n(),a("form",{key:3,onSubmit:r[1]||(r[1]=v((...s)=>e.addSlug&&e.addSlug(...s),["prevent"])),class:"card mb-3"},[t("div",q,[t("div",D,[t("label",E,[k(g,null,{content:_(()=>[z]),default:_(()=>[M]),_:1}),f(" Команда "),J]),d(t("input",{type:"text",class:"form-control",placeholder:"Команда","aria-label":"Команда","onUpdate:modelValue":r[0]||(r[0]=s=>e.slugForm.command=s),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[u,e.slugForm.command]])]),t("button",{disabled:e.slugForm.slug==null,class:"btn btn-outline-success mt-2 mb-2 w-100 p-3"},"Добавить скрипт в бота ",8,H)])],32)):c("",!0)],64)}}}),K={class:"form-floating mb-3"},Q=t("label",{for:"floatingInput"},"Команда",-1),W={class:"form-floating mb-3"},X=t("label",{for:"floatingInput"},"Мнемоническое имя",-1),Y={class:"form-floating mb-3"},Z=t("label",{for:"floatingInput"},"Описание скрипта",-1),x=t("h6",null," Параметры скрипта ",-1),ee=t("div",{class:"alert alert-info",role:"alert"}," Данные параметры используются для настройки скриптов на стороне сервера ",-1),te={class:"dropdown"},oe=t("button",{class:"btn btn-outline-info w-100 dropdown-toggle mb-2",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," Добавить ",-1),le={class:"dropdown-menu w-100"},se=["onClick"],ne={class:"row"},ie={class:"col-12"},ae=["onClick"],re={key:0,class:"row"},de={class:"col-md-6 mb-1"},ue={class:"card"},ce={class:"card-header d-flex justify-content-between align-items-center"},ge=["onClick"],me=t("i",{class:"fa-solid fa-trash-can"},null,-1),fe=[me],he=["onClick"],pe=t("i",{class:"fa-solid fa-caret-left"},null,-1),be=[pe],_e=["onClick"],ye=t("i",{class:"fa-solid fa-caret-right"},null,-1),ve=[ye],Ce={class:"dropdown"},Fe={class:"btn btn-outline-info dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},ke={class:"dropdown-menu"},we=["onClick"],$e={class:"card-body"},Se={class:"form-floating mb-1"},Ve=["onUpdate:modelValue","id"],Ue=["for"],Oe={key:0,class:"form-floating mb-1"},je=["id","onUpdate:modelValue"],Te=["for"],Ae={key:1,class:"form-check mb-1 mt-2"},Be=["onUpdate:modelValue","id"],Ge=["for"],Ie={key:2,class:"form-floating mb-1 mt-2"},Le=["onUpdate:modelValue","id"],Pe=["for"],Ne={key:3,class:"form-floating mb-1 mt-2"},qe=["onUpdate:modelValue","id"],De=["for"],Ee={key:4,class:"form-check mb-1 mt-2"},Me=["onUpdate:modelValue","id"],ze=["for"],Je={key:5,class:"form-floating mb-3"},He=["id","onUpdate:modelValue"],Re=["for"],Ke={key:6,class:"form-floating mb-3"},Qe=["id","onUpdate:modelValue"],We=["for"],Xe={key:1,class:"row"},Ye=t("div",{class:"col-12"},[t("p",null,"Параметры скрипта еще не добавлены")],-1),Ze=[Ye],xe={class:"btn btn-outline-primary w-100 mt-2 p-3"},et={key:0},tt={key:1},ot={props:["item"],data(){return{filters:[],simple:!0,configTypes:[{title:"Текстовый или числовой параметр",type:"text"},{title:"Большое текстовое поле",type:"large-text"},{title:"Канал обратной связи",type:"channel"},{title:"Логический оператор",type:"boolean"},{title:"Ссылка на изображение",type:"image"},{title:"Цвет",type:"color"},{title:"Geo",type:"geo"},{title:"Номер телефона",type:"phone"}],bot:null,photos:[],slugForm:{bot_id:null,id:null,command:null,comment:null,slug:null,config:[],is_global:!0}}},computed:{...C(["getCurrentBot"]),filteredConfigs(){return this.filters.length==0?this.slugForm.config:this.slugForm.config.filter(l=>this.filters.indexOf(l.type)>=0)}},mounted(){this.loadCurrentBot(),this.item&&(this.slugForm.id=this.item.id||null,this.slugForm.command=this.item.command,this.slugForm.comment=this.item.comment,this.slugForm.bot_id=this.item.bot_id,this.slugForm.slug=this.item.slug,this.slugForm.config=this.item.config||[],this.slugForm.is_global=this.item.is_global||!1)},methods:{toggleFilter(l){let e=this.filters.indexOf(l);e>=0?this.filters.splice(e,1):this.filters.push(l)},addTextTo(l,e={text:null}){this.slugForm.config[l].value=e.text},loadCurrentBot(l=null){return this.$store.dispatch("updateCurrentBot",{bot:l}).then(()=>{this.bot=this.getCurrentBot})},submit(){let l=new FormData;Object.keys(this.slugForm).forEach(e=>{const r=this.slugForm[e]||"";typeof r=="object"?l.append(e,JSON.stringify(r)):l.append(e,r)}),this.$store.dispatch(this.slugForm.id===null?"createSlug":"updateSlug",{slugForm:l}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно обновлена",type:"success"}),this.slugForm.id===null&&(this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0),this.$emit("callback")}).catch(e=>{})},addConfig(l){this.slugForm.config.splice(0,0,{key:null,value:null,type:l||"text"})},move(l,e=0){let r=this.slugForm.config[l],g=this.slugForm.config.length||0,s=e===0?l-1>=0?l-1:g-1:l<g-1?l+1:0;this.slugForm.config[l]=this.slugForm.config[s],this.slugForm.config[s]=r},removeConfigItem(l){try{this.slugForm.config.splice(l,1)}catch{this.slugForm.config=[]}}}},dt=Object.assign(ot,{__name:"SlugForm",setup(l){return(e,r)=>{const g=w("mask");return n(),a("form",{onSubmit:r[3]||(r[3]=v((...s)=>e.submit&&e.submit(...s),["prevent"]))},[t("div",K,[d(t("input",{type:"text","onUpdate:modelValue":r[0]||(r[0]=s=>e.slugForm.command=s),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[u,e.slugForm.command]]),Q]),t("div",W,[d(t("input",{type:"text","onUpdate:modelValue":r[1]||(r[1]=s=>e.slugForm.slug=s),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[u,e.slugForm.slug]]),X]),t("div",Y,[d(t("input",{type:"text","onUpdate:modelValue":r[2]||(r[2]=s=>e.slugForm.comment=s),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[u,e.slugForm.comment]]),Z]),x,ee,t("div",te,[oe,t("ul",le,[(n(!0),a(h,null,p(e.configTypes,(s,o)=>(n(),a("li",null,[t("a",{class:"dropdown-item",onClick:i=>e.addConfig(s.type)},m(s.title||"Не установлен"),9,se)]))),256))])]),t("div",ne,[t("div",ie,[t("p",null,[f("Фильтры: "),(n(!0),a(h,null,p(e.configTypes,(s,o)=>(n(),a("span",{class:b(["badge mb-1 bg-gray-100 cursor-pointer mr-1",{"bg-info":e.filters.indexOf(s.type)>=0}]),onClick:i=>e.toggleFilter(s.type)},m(s.type),11,ae))),256))])])]),e.filteredConfigs.length>0?(n(),a("div",re,[(n(!0),a(h,null,p(e.filteredConfigs,(s,o)=>(n(),a("div",de,[t("div",ue,[t("div",ce,[t("div",null,[t("button",{onClick:i=>e.removeConfigItem(o),class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},fe,8,ge),t("button",{onClick:i=>e.move(o,0),style:{"margin-left":"5px"},class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},be,8,he),t("button",{onClick:i=>e.move(o,1),style:{"margin-left":"5px"},class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},ve,8,_e)]),e.bot&&e.filteredConfigs[o].type==="channel"?(n(),y(U,{key:0,token:e.bot.bot_token,onCallback:i=>e.addTextTo(o,i)},null,8,["token","onCallback"])):c("",!0),t("div",null,[t("div",Ce,[t("button",Fe,m(e.filteredConfigs[o].type),1),t("ul",ke,[(n(!0),a(h,null,p(e.configTypes,i=>(n(),a("li",null,[t("a",{class:"dropdown-item",onClick:lt=>e.filteredConfigs[o].type=i.type},m(i.title||s.type),9,we)]))),256))])])])]),t("div",$e,[t("div",Se,[d(t("input",{type:"text",class:"form-control","onUpdate:modelValue":i=>e.filteredConfigs[o].key=i,id:"field-input-key-"+o,placeholder:"name@example.com"},null,8,Ve),[[u,e.filteredConfigs[o].key]]),t("label",{for:"field-input-key-"+o},"Ключ",8,Ue)]),e.filteredConfigs[o].type==="text"||e.filteredConfigs[o].type==="channel"?(n(),a("div",Oe,[d(t("input",{type:"text",class:"form-control",id:"field-input-"+o,"onUpdate:modelValue":i=>e.filteredConfigs[o].value=i,placeholder:"name@example.com"},null,8,je),[[u,e.filteredConfigs[o].value]]),t("label",{for:"field-input-"+o},"Значение",8,Te)])):c("",!0),e.filteredConfigs[o].type==="boolean"?(n(),a("div",Ae,[d(t("input",{class:"form-check-input","onUpdate:modelValue":i=>e.filteredConfigs[o].value=i,type:"checkbox",value:"false",id:"filtered-config-"+o+"-checkbox"},null,8,Be),[[$,e.filteredConfigs[o].value]]),t("label",{class:"form-check-label",for:"filtered-config-"+o+"-checkbox"},m(e.filteredConfigs[o].value?"Истина":"Ложь"),9,Ge)])):c("",!0),e.filteredConfigs[o].type==="geo"?(n(),a("div",Ie,[d(t("input",{class:"form-control",placeholder:"##.######,##.######","onUpdate:modelValue":i=>e.filteredConfigs[o].value=i,type:"text",id:"filtered-config-"+o+"-geo"},null,8,Le),[[g,"##.######,##.######"],[u,e.filteredConfigs[o].value]]),t("label",{for:"filtered-config-"+o+"-geo"},"Значение",8,Pe)])):c("",!0),e.filteredConfigs[o].type==="phone"?(n(),a("div",Ne,[d(t("input",{class:"form-control",placeholder:"+7(###)###-##-##","onUpdate:modelValue":i=>e.filteredConfigs[o].value=i,type:"text",id:"filtered-config-"+o+"-phone"},null,8,qe),[[g,"+7(###)###-##-##"],[u,e.filteredConfigs[o].value]]),t("label",{for:"filtered-config-"+o+"-phone"},"Значение",8,De)])):c("",!0),e.filteredConfigs[o].type==="color"?(n(),a("div",Ee,[d(t("input",{class:"form-control","onUpdate:modelValue":i=>e.filteredConfigs[o].value=i,type:"color",id:"filtered-config-"+o+"-color"},null,8,Me),[[u,e.filteredConfigs[o].value]]),t("label",{for:"filtered-config-"+o+"-color"},[t("p",{style:S({color:e.filteredConfigs[o].value})},"Цвет: "+m(e.filteredConfigs[o].value),5)],8,ze)])):c("",!0),e.filteredConfigs[o].type==="large-text"?(n(),a("div",Je,[d(t("textarea",{class:"form-control",id:"field-input-"+o,"onUpdate:modelValue":i=>e.filteredConfigs[o].value=i,placeholder:"name@example.com"},`
                            `,8,He),[[u,e.filteredConfigs[o].value]]),t("label",{for:"field-input-"+o},"Значение",8,Re)])):c("",!0),e.filteredConfigs[o].type==="image"?(n(),a("div",Ke,[d(t("input",{class:"form-control",id:"field-input-"+o,type:"url",pattern:"^(http(s)?:\\/\\/)+[\\w\\-\\._~:\\/?#[\\]@!\\$&'\\(\\)\\*\\+,;=.]+$","onUpdate:modelValue":i=>e.filteredConfigs[o].value=i,placeholder:"name@example.com"},null,8,Qe),[[u,e.filteredConfigs[o].value]]),t("label",{for:"field-input-"+o},"URL ссылка на изображение",8,We)])):c("",!0)])])]))),256))])):(n(),a("div",Xe,Ze)),t("button",xe,[e.slugForm.id==null?(n(),a("span",et," Сохранить команду ")):(n(),a("span",tt," Обновить команду "))])],32)}}});export{dt as _,rt as a};
