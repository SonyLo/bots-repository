import{q as l,t as i,v as e,F as f,C as $,y as h,D as u,A as r,P as j,H as c,X as V,x as b,K as F,G as w,J as p,Q as k,B as v,a5 as M,Y as U,L as q,O as g,a3 as O,M as A}from"./index.es-77235f88.js";import{_ as x,a as E,b as B}from"./GlobalSlugList-c8d86e2b.js";import{P as S}from"./Pagination-df5e6be2.js";import{_ as z}from"./CompanyList-6b051f66.js";import{_ as P}from"./_plugin-vue_export-helper-c27b6911.js";import{T}from"./TelegramChannelHelper-587b5dac.js";import{B as I,_ as L}from"./Mail-e1f52f7d.js";/* empty css                                                               */const K={props:["param"],data(){return{expressions:[{expression:"{{userName}}",description:"Имя пользователя"},{expression:"{{telegramChatId}}",description:"Идентификатор чата"},{expression:"{{referralLink}}",description:"Реферальная ссылка"},{expression:"{{referralQr}}",description:"Реферальный QR-код"}]}},methods:{expressionsSelect(s){this.$emit("callback",{param:this.param,text:s.expression})}}},N={class:"dropdown"},Y=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-brands fa-hire-a-helper"})],-1),J={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},W=["onClick"];function H(s,t,o,a,d,n){return l(),i("div",N,[Y,e("div",J,[e("li",null,[(l(!0),i(f,null,$(d.expressions,m=>(l(),i("a",{class:"dropdown-item",onClick:_=>n.expressionsSelect(m)},h(m.description||"-"),9,W))),256))])])])}const G=P(K,[["render",H]]);const Q={class:"card-header d-flex justify-content-between"},X={class:"dropdown"},Z=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),ee={class:"dropdown-menu"},te=e("i",{class:"fa-solid fa-arrow-left mr-1"},null,-1),se=e("hr",null,null,-1),oe=["data-bs-target"],le=e("i",{class:"fa-regular fa-pen-to-square mr-1"},null,-1),ie=e("i",{class:"fa-solid fa-clone mr-1"},null,-1),ne=e("i",{class:"fa-regular fa-trash-can text-danger mr-1"},null,-1),ae={key:0,class:"fa-solid fa-arrow-up-short-wide"},de={key:1,class:"fa-solid fa-arrow-down-short-wide"},re={class:"card-body"},ce={class:"row"},ue={class:"col-12"},_e={key:0},he={key:1,class:"list-group list-group-numbered"},me={class:"list-group-item d-flex justify-content-between align-items-start"},pe={class:"ms-2 me-auto"},be=e("div",{class:"fw-bold"},"Идентификатор",-1),ge={class:"list-group-item d-flex justify-content-between align-items-start"},fe={class:"ms-2 me-auto"},ve=e("div",{class:"fw-bold"},"Команда",-1),ye={class:"list-group-item d-flex justify-content-between align-items-start"},$e={class:"ms-2 me-auto"},ke=e("div",{class:"fw-bold"},"Мнемоническое имя",-1),Fe={class:"list-group-item d-flex justify-content-between align-items-start"},Ce={class:"ms-2 me-auto"},we=e("div",{class:"fw-bold"},"Пояснение",-1),je={key:0,class:"list-group-item d-flex justify-content-between align-items-start"},Se={class:"ms-2 me-auto"},Ve=e("div",{class:"fw-bold"},"Набор параметров скрипта",-1),Pe={key:1,class:"list-group-item d-flex justify-content-between align-items-start"},Ue=e("div",{class:"ms-2 me-auto"},[e("div",{class:"fw-bold"},"Привязана страница")],-1),Be=[Ue],Oe={key:2,class:"list-group-item d-flex justify-content-between align-items-start"},Te=e("div",{class:"ms-2 me-auto"},[e("div",{class:"fw-bold"},"Глобальный скрипт")],-1),Ie=[Te],qe={class:"list-group-item d-flex justify-content-between align-items-start"},De={class:"ms-2 me-auto w-100"},Re=e("div",{class:"fw-bold"},"Перенести данные из:",-1),Le=e("option",{value:null},"Не выбрано",-1),xe=["value"],Me=e("p",{class:"my-2"},[e("em",null,"Перенос данных затирает текущие данные в данном скрипте")],-1),Ae=["disabled"],Ee=["id"],ze={class:"modal-dialog modal-fullscreen"},Ke={class:"modal-content"},Ne={class:"modal-header"},Ye={class:"modal-title",id:"exampleModalLabel"},Je=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),We={class:"modal-body"},He=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),Ge={props:["item","bot","selectMode"],data(){return{selected_slug_id:null,slugs:[],load:!1,simple:!0}},watch:{simple:function(){this.simple||this.loadAllSlugs()}},mounted(){},methods:{selectCard(){this.$emit("select",this.item)},slugFormCallback(){this.load=!0,this.$emit("callback"),this.$nextTick(()=>{this.load=!1})},editSlug(){this.load=!0,this.$nextTick(()=>{this.load=!1})},selectSlug(){this.load=!0,this.$emit("select",this.item),this.$nextTick(()=>{this.load=!1})},duplicateSlug(){this.load=!0,this.$store.dispatch("duplicateSlug",{dataObject:{slugId:this.item.id}}).then(s=>{this.$notify({title:"Конструктор команд",text:"Команда успешно продублирована",type:"success"}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}).catch(s=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})},submitRelocateData(){this.$store.dispatch("relocateSlugActionData",{slug_sender_id:this.selected_slug_id,slug_recipient_id:this.item.id,bot_id:this.bot.id}).then(s=>{this.$notify({title:"Конструктор команд",text:"Данные команды успешно перенесены",type:"success"})}).catch(s=>{this.$notify({title:"Конструктор команд",text:"Ошибка переноса данных",type:"error"})})},loadAllSlugs(){this.$store.dispatch("loadAllSlugs",{botId:this.bot.id}).then(s=>{this.slugs=s.data})},removeSlug(){this.load=!0,this.$store.dispatch("removeSlug",{dataObject:{slugId:this.item.id}}).then(s=>{this.$notify({title:"Конструктор команд",text:"Команда успешно удалена",type:"success"}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}).catch(s=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})})}}},Qe=Object.assign(Ge,{__name:"Slug",setup(s){return(t,o)=>(l(),i(f,null,[e("div",{class:b(["card",{"deprecated-slug":s.item.deprecated_at!=null,"global-slug":s.item.is_global}])},[e("div",Q,[e("div",X,[Z,e("ul",ee,[e("li",null,[e("a",{onClick:o[0]||(o[0]=(...a)=>t.selectSlug&&t.selectSlug(...a)),title:"Выбрать команду",class:"dropdown-item cursor-pointer"},[te,u(" Выбрать команду ")])]),se,e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:o[1]||(o[1]=(...a)=>t.editSlug&&t.editSlug(...a)),"data-bs-toggle":"modal","data-bs-target":"#edit-slug-"+s.item.id},[le,u(" Редактировать")],8,oe)]),e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:o[2]||(o[2]=(...a)=>t.duplicateSlug&&t.duplicateSlug(...a))},[ie,u(" Дублировать")])]),e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:o[3]||(o[3]=(...a)=>t.removeSlug&&t.removeSlug(...a))},[ne,u(" Удалить")])])])]),e("button",{type:"button",onClick:o[4]||(o[4]=a=>t.simple=!t.simple),class:"btn btn-outline-primary ml-2"},[t.simple?(l(),i("i",ae)):(l(),i("i",de))])]),e("div",re,[e("div",ce,[e("div",ue,[t.simple?(l(),i("p",_e,h(s.item.command||"Нет команды"),1)):(l(),i("ol",he,[e("li",me,[e("div",pe,[be,u(" №"+h(s.item.id||"Нет идентификатора"),1)])]),e("li",ge,[e("div",fe,[ve,u(" "+h(s.item.command||"Нет команды"),1)])]),e("li",ye,[e("div",$e,[ke,u(" "+h(s.item.slug||"Slug"),1)])]),e("li",Fe,[e("div",Ce,[we,u(" "+h(s.item.comment||"Пояснение не указано"),1)])]),s.item.config?(l(),i("li",je,[e("div",Se,[Ve,s.item.config?(l(!0),i(f,{key:0},$(s.item.config,a=>(l(),i("p",null,[e("strong",null,h(a.key||"Ключ не найден")+":",1),u(h(a.value||"Не указано"),1)]))),256)):r("",!0)])])):r("",!0),s.item.page?(l(),i("li",Pe,Be)):r("",!0),s.item.is_global?(l(),i("li",Oe,Ie)):r("",!0),e("li",qe,[e("div",De,[e("form",{onSubmit:o[6]||(o[6]=j((...a)=>t.submitRelocateData&&t.submitRelocateData(...a),["prevent"]))},[Re,c(e("select",{class:"form-control w-100","onUpdate:modelValue":o[5]||(o[5]=a=>t.selected_slug_id=a),required:""},[Le,(l(!0),i(f,null,$(t.slugs,a=>(l(),i("option",{value:a.id},"#"+h(a.id)+" "+h(a.slug||"Не указан"),9,xe))),256))],512),[[V,t.selected_slug_id]]),Me,e("button",{disabled:t.selected_slug_id==null,class:"btn btn-outline-warning w-100"}," Выполнить перенос ",8,Ae)],32)])])]))])])])],2),e("div",{class:"modal fade",id:"edit-slug-"+s.item.id,tabindex:"-1"},[e("div",ze,[e("div",Ke,[e("div",Ne,[e("h5",Ye,[u("Редактирование команды #"),e("span",null,h(s.item.id),1)]),Je]),e("div",We,[t.load?r("",!0):(l(),F(x,{key:0,item:s.item,onCallback:t.slugFormCallback},null,8,["item","onCallback"]))]),He])])],8,Ee)],64))}}),Xe={key:0,class:"row"},Ze={class:"col-12 mb-2"},et={key:0},tt=e("i",{class:"fa-solid fa-scroll"},null,-1),st={key:1},ot=e("i",{class:"fa-regular fa-square-minus"},null,-1),lt={key:0,class:"col-12"},it={class:"col-12"},nt={class:"form-floating mb-3"},at=e("label",{for:"floatingInput"},"Быстрый поиск команды",-1),dt={class:"col-12 mb-2"},rt={class:"form-check"},ct={class:"form-check-label",for:"need_global"},ut={key:0},_t={key:1},ht={class:"form-check"},mt=e("label",{class:"form-check-label",for:"need_show_deleted"}," Удаленные ",-1),pt={key:1,class:"mb-3 col-12 col-sm-12"},bt={class:"table"},gt=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"Команда"),e("th",{scope:"col"},"Пояснение"),e("th",{scope:"col"},"Глобальный"),e("th",{scope:"col"},"Действия")])],-1),ft=["onClick"],vt={key:0},yt=e("i",{class:"fa-solid fa-check text-success"},null,-1),$t=[yt],kt={key:1},Ft=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Ct=[Ft],wt={class:"dropdown"},jt=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),St={class:"dropdown-menu"},Vt={key:0},Pt=["onClick"],Ut=e("i",{class:"fa-solid fa-arrow-left mr-1"},null,-1),Bt={key:1},Ot=["onClick"],Tt=e("a",{class:"dropdown-item cursor-pointer","data-bs-toggle":"modal","data-bs-target":"#edit-table-slug"},[e("i",{class:"fa-regular fa-pen-to-square mr-1"}),u(" Редактировать")],-1),It=[Tt],qt=["onClick"],Dt=e("i",{class:"fa-solid fa-clone mr-1"},null,-1),Rt=["href"],Lt=e("i",{class:"fa-regular fa-file-excel mr-1"},null,-1),xt={key:2},Mt=["onClick"],At=e("i",{class:"fa-regular fa-trash-can text-danger mr-1"},null,-1),Et={key:3},zt=["onClick"],Kt=e("i",{class:"fa-regular fa-trash-can text-danger mr-1"},null,-1),Nt={key:3,class:"mb-3 col-md-12"},Yt=e("div",{class:"alert alert-danger",role:"alert"}," У Вас еще нет добавленных скриптов! ",-1),Jt=[Yt],Wt={class:"modal fade",id:"edit-table-slug",tabindex:"-1"},Ht={class:"modal-dialog modal-fullscreen"},Gt={key:0,class:"modal-content"},Qt={class:"modal-header"},Xt={class:"modal-title",id:"exampleModalLabel"},Zt=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),es={class:"modal-body"},ts={class:"row"},ss={class:"col-8"},os={class:"col-4"},ls={class:"list-group list-group-numbered"},is={key:0,class:"list-group-item d-flex justify-content-between align-items-start"},ns={class:"ms-2 me-auto"},as=e("div",{class:"fw-bold"},"Набор параметров скрипта",-1),ds={key:1},rs={key:1,class:"list-group-item d-flex justify-content-between align-items-start"},cs=e("div",{class:"ms-2 me-auto"},[e("div",{class:"fw-bold"},"Привязана страница")],-1),us=[cs],_s={key:2,class:"list-group-item d-flex justify-content-between align-items-start"},hs=e("div",{class:"ms-2 me-auto"},[e("div",{class:"fw-bold"},"Является глобальным скриптом")],-1),ms=[hs],ps={class:"list-group-item d-flex justify-content-between align-items-start"},bs={class:"ms-2 me-auto w-100"},gs=e("div",{class:"fw-bold"},"Перенести данные из:",-1),fs=e("option",{value:null},"Не выбрано",-1),vs=["value"],ys=e("p",{class:"my-2"},[e("em",null,"Перенос данных затирает текущие данные в данном скрипте")],-1),$s=["disabled"],ks=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),Fs={props:["command","canSelect"],data(){return{bot:null,relocated_slug_id:null,need_global:!0,need_show_deleted:!0,show:!1,load:!1,slugs:[],paginate:[],selectedSlug:null,ownSearch:null,slugForm:{command:null,comment:null,slug:null}}},watch:{ownSearch:function(s,t){this.loadSlugs()},need_global:function(s,t){this.loadSlugs()},need_show_deleted:function(s,t){this.loadSlugs()}},computed:{...w(["getCurrentBot","getSlugs","getSlugsPaginateObject"])},mounted(){this.loadCurrentBot().then(()=>{this.loadSlugs(),this.command&&this.$nextTick(()=>{this.slugForm.command=this.command})})},methods:{nextSlugs(s){this.loadSlugs(s)},loadSlugs(s=0){return this.$store.dispatch("loadSlugs",{dataObject:{botId:this.bot.id,needGlobal:this.need_global,needDeleted:this.need_show_deleted,search:this.ownSearch},page:s}).then(t=>{this.slugs=this.getSlugs,this.paginate=this.getSlugsPaginateObject})},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},callbackSlugs(){this.loadSlugs()},selectSlug(s){this.load=!0,this.$nextTick(()=>{this.selectedSlug=s,this.load=!1}),this.$emit("select",s)},selectCard(){this.$emit("select",this.item)},slugFormCallback(){this.load=!0;const s=this.selectedSlug;this.loadSlugs().then(()=>{let t=this.slugs.find(o=>o.id===s.id);this.selectSlug(t||null)}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})},editSlug(){this.load=!0,this.$nextTick(()=>{this.load=!1})},duplicateSlug(s){this.load=!0,this.$store.dispatch("duplicateSlug",{dataObject:{slugId:s.id}}).then(t=>{this.$notify({title:"Конструктор команд",text:"Команда успешно продублирована",type:"success"}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}).catch(t=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}),this.loadSlugs(),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})},submitRelocateData(){this.$store.dispatch("relocateSlugActionData",{slug_sender_id:this.relocated_slug_id,slug_recipient_id:this.item.id,bot_id:this.bot.id}).then(s=>{this.$notify({title:"Конструктор команд",text:"Данные команды успешно перенесены",type:"success"})}).catch(s=>{this.$notify({title:"Конструктор команд",text:"Ошибка переноса данных",type:"error"})})},restoreSlug(s){this.load=!0,this.$store.dispatch("restoreSlug",{dataObject:{slugId:s.id}}).then(t=>{this.$notify({title:"Конструктор команд",text:"Команда успешно восстановлена",type:"success"}),this.loadSlugs(),this.$nextTick(()=>{this.load=!1})}).catch(t=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})})},removeSlug(s){this.load=!0,this.$store.dispatch("removeSlug",{dataObject:{slugId:s.id}}).then(t=>{this.$notify({title:"Конструктор команд",text:"Команда успешно удалена",type:"success"}),this.loadSlugs()}).catch(t=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})})}}},jF=Object.assign(Fs,{__name:"BotSlugTableList",setup(s){return(t,o)=>(l(),i(f,null,[t.bot?(l(),i("div",Xe,[e("div",Ze,[e("button",{type:"button",onClick:o[0]||(o[0]=a=>t.show=!t.show),class:"btn btn-outline-success p-3 w-100"},[t.show?(l(),i("span",st,[ot,u(" Свернуть форму добавления")])):(l(),i("span",et,[tt,u(" Добавить глобальный скрипт")]))])]),t.show?(l(),i("div",lt,[t.bot?(l(),F(E,{key:0,"can-add":!0,bot:t.bot,onCallback:t.loadSlugs},null,8,["bot","onCallback"])):r("",!0)])):r("",!0),e("div",it,[e("div",nt,[c(e("input",{type:"search","onUpdate:modelValue":o[1]||(o[1]=a=>t.ownSearch=a),class:"form-control",id:"floatingInput",placeholder:"name@example.com"},null,512),[[p,t.ownSearch]]),at])]),e("div",dt,[e("div",rt,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[2]||(o[2]=a=>t.need_global=a),type:"checkbox",id:"need_global"},null,512),[[k,t.need_global]]),e("label",ct,[t.need_global?(l(),i("span",ut,"Глобальные")):(l(),i("span",_t,"Локальные"))])]),e("div",ht,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[3]||(o[3]=a=>t.need_show_deleted=a),type:"checkbox",id:"need_show_deleted"},null,512),[[k,t.need_show_deleted]]),mt])]),t.slugs&&t.bot?(l(),i("div",pt,[e("table",bt,[gt,e("tbody",null,[(l(!0),i(f,null,$(t.slugs,(a,d)=>(l(),i("tr",{class:b({"border-info":a.deleted_at==null,"border-danger":a.deleted_at!=null})},[e("th",{scope:"row",class:b({"text-danger":a.deleted_at!=null})},h(a.id||"Нет идентификатора"),3),e("td",{onClick:n=>t.selectSlug(a),"data-bs-toggle":"modal","data-bs-target":"#edit-table-slug",class:b({"text-danger":a.deleted_at!=null})},h(a.command||"Нет команды"),11,ft),e("td",{class:b({"text-danger":a.deleted_at!=null})},h(a.comment||"Пояснение не указано"),3),e("td",null,[a.is_global?(l(),i("span",vt,$t)):(l(),i("span",kt,Ct))]),e("td",null,[e("div",wt,[jt,e("ul",St,[s.canSelect?(l(),i("li",Vt,[e("a",{onClick:n=>t.selectSlug(a),title:"Выбрать команду",class:"dropdown-item cursor-pointer"},[Ut,u(" Выбрать команду ")],8,Pt)])):r("",!0),s.canSelect?(l(),i("hr",Bt)):r("",!0),e("li",{onClick:n=>t.selectSlug(a)},It,8,Ot),e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:n=>t.duplicateSlug(a)},[Dt,u(" Дублировать")],8,qt)]),e("li",null,[e("a",{class:"dropdown-item cursor-pointer",target:"_blank",href:"/admin/slugs/action-data-export/"+a.id},[Lt,u(" Скачать данные участников")],8,Rt)]),a.deleted_at==null?(l(),i("li",xt,[e("a",{class:"dropdown-item cursor-pointer",onClick:n=>t.removeSlug(a)},[At,u(" Удалить")],8,Mt)])):r("",!0),a.deleted_at!=null?(l(),i("li",Et,[e("a",{class:"dropdown-item cursor-pointer",onClick:n=>t.restoreSlug(a)},[Kt,u(" Восстановить")],8,zt)])):r("",!0)])])])],2))),256))])])])):r("",!0),t.paginate?(l(),F(S,{key:2,onPagination_page:t.nextSlugs,pagination:t.paginate},null,8,["onPagination_page","pagination"])):r("",!0),t.slugs.length===0?(l(),i("div",Nt,Jt)):r("",!0)])):r("",!0),e("div",Wt,[e("div",Ht,[t.selectedSlug&&!t.load?(l(),i("div",Gt,[e("div",Qt,[e("h5",Xt,[u("Редактирование команды #"),e("span",null,h(t.selectedSlug.id),1)]),Zt]),e("div",es,[e("div",ts,[e("div",ss,[v(x,{item:t.selectedSlug,onCallback:t.slugFormCallback},null,8,["item","onCallback"])]),e("div",os,[e("ol",ls,[t.selectedSlug.config?(l(),i("li",is,[e("div",ns,[as,(t.selectedSlug.config||[]).length>0?(l(!0),i(f,{key:0},$(t.selectedSlug.config,a=>(l(),i("p",null,[e("strong",null,h(a.key||"Ключ не найден")+":",1),u(h(a.value||"Не указано"),1)]))),256)):(l(),i("p",ds,"Отсутствует"))])])):r("",!0),t.selectedSlug.page?(l(),i("li",rs,us)):r("",!0),t.selectedSlug.is_global?(l(),i("li",_s,ms)):r("",!0),e("li",ps,[e("div",bs,[e("form",{onSubmit:o[5]||(o[5]=j((...a)=>t.submitRelocateData&&t.submitRelocateData(...a),["prevent"]))},[gs,c(e("select",{class:"form-control w-100","onUpdate:modelValue":o[4]||(o[4]=a=>t.relocated_slug_id=a),required:""},[fs,(l(!0),i(f,null,$(t.slugs,a=>(l(),i("option",{value:a.id},"#"+h(a.id)+" "+h(a.slug||"Не указан"),9,vs))),256))],512),[[V,t.relocated_slug_id]]),ys,e("button",{disabled:t.relocated_slug_id==null,class:"btn btn-outline-warning w-100"}," Выполнить перенос ",8,$s)],32)])])])])])]),ks])):r("",!0)])])],64))}}),Cs={class:"row mt-2"},ws={class:"input-group mb-3"},js={key:0,class:"row"},Ss={class:"col-12 col-md-12 mb-3"},Vs={class:"table"},Ps=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"Ф.И.О. из телеграмма"),e("th",{scope:"col"},"Имя пользователя"),e("th",{scope:"col"},"Домен"),e("th",{scope:"col"},"Телефон"),e("th",{scope:"col"},"TG id"),e("th",{scope:"col"},"Админ"),e("th",{scope:"col"},"VIP"),e("th",{scope:"col"},"Доставщик"),e("th",{scope:"col"},"Менеджер"),e("th",{scope:"col"},"За работой")])],-1),Us={scope:"row"},Bs=["href"],Os={key:1},Ts=["onClick"],Is=e("i",{class:"fa-solid fa-check text-success"},null,-1),qs=[Is],Ds=["onClick"],Rs=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Ls=[Rs],xs=["onClick"],Ms=e("i",{class:"fa-solid fa-check text-success"},null,-1),As=[Ms],Es=["onClick"],zs=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Ks=[zs],Ns=["onClick"],Ys=e("i",{class:"fa-solid fa-check text-success"},null,-1),Js=[Ys],Ws=["onClick"],Hs=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Gs=[Hs],Qs=["onClick"],Xs=e("i",{class:"fa-solid fa-check text-success"},null,-1),Zs=[Xs],eo=["onClick"],to=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),so=[to],oo=["onClick"],lo=e("i",{class:"fa-solid fa-check text-success"},null,-1),io=[lo],no=["onClick"],ao=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),ro=[ao],co={class:"col-12"},uo={key:1,class:"row"},_o=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет пользователей ")],-1),ho=[_o],mo={data(){return{bot:null,loading:!0,bot_users:[],search:null,bot_users_paginate_object:null}},computed:{...w(["getBotUsers","getBotUsersPaginateObject","getCurrentBot"])},mounted(){this.loadCurrentBot().then(()=>{this.loadUsers()})},methods:{loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},changeUserStatus(s,t,o="is_admin"){this.bot_users[s][o]=t===1,this.$store.dispatch("changeUserStatus",{dataObject:{bot_user_id:this.bot_users[s].id,status:t,type:o}}).then(()=>{this.$notify({title:"Конструктор ботов",text:"Статус пользователя успешно изменен! Пользователь оповещен об изменении статуса!",type:"success"})}).catch(()=>{this.$notify({title:"Конструктор ботов",text:"Ошибка изменения статуса",type:"error"})})},nextUsers(s){this.loadUsers(s)},loadUsers(s=0){this.loading=!0,this.$store.dispatch("loadBotUsers",{dataObject:{botId:this.bot.id||null,search:this.search},size:100,page:s}).then(t=>{this.loading=!1,this.bot_users=this.getBotUsers,this.bot_users_paginate_object=this.getBotUsersPaginateObject}).catch(()=>{this.loading=!1})}}},SF=Object.assign(mo,{__name:"BotUserList",setup(s){return(t,o)=>(l(),i(f,null,[e("div",Cs,[e("div",ws,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск пользователя","aria-label":"Поиск пользователя",onKeydown:o[0]||(o[0]=M(a=>t.loadUsers(0),["enter"])),"onUpdate:modelValue":o[1]||(o[1]=a=>t.search=a)},null,544),[[p,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[2]||(o[2]=a=>t.loadUsers(0)),type:"button",id:"button-addon2"},"Найти ")])]),t.bot_users.length>0?(l(),i("div",js,[e("div",Ss,[e("table",Vs,[Ps,e("tbody",null,[(l(!0),i(f,null,$(t.bot_users,(a,d)=>(l(),i("tr",null,[e("th",Us,h(a.id),1),e("td",null,h(a.fio_from_telegram||"Не указано"),1),e("td",null,h(a.name||"Не указано"),1),e("td",null,[a.username?(l(),i("a",{key:0,href:"https://t.me/"+a.username,target:"_blank"},"@"+h(a.username),9,Bs)):(l(),i("span",Os,"Не указано"))]),e("td",null,h(a.phone||"Не указано"),1),e("td",null,h(a.telegram_chat_id||"Не указано"),1),e("td",null,[a.is_admin?(l(),i("span",{key:0,onClick:n=>t.changeUserStatus(d,0,"is_admin")},qs,8,Ts)):(l(),i("span",{key:1,onClick:n=>t.changeUserStatus(d,1,"is_admin")},Ls,8,Ds))]),e("td",null,[a.is_vip?(l(),i("span",{key:0,onClick:n=>t.changeUserStatus(d,0,"is_vip")},As,8,xs)):(l(),i("span",{key:1,onClick:n=>t.changeUserStatus(d,1,"is_vip")},Ks,8,Es))]),e("td",null,[a.is_deliveryman?(l(),i("span",{key:0,onClick:n=>t.changeUserStatus(d,0,"is_deliveryman")},Js,8,Ns)):(l(),i("span",{key:1,onClick:n=>t.changeUserStatus(d,1,"is_deliveryman")},Gs,8,Ws))]),e("td",null,[a.is_manager?(l(),i("span",{key:0,onClick:n=>t.changeUserStatus(d,0,"is_manager")},Zs,8,Qs)):(l(),i("span",{key:1,onClick:n=>t.changeUserStatus(d,1,"is_manager")},so,8,eo))]),e("td",null,[a.is_work?(l(),i("span",{key:0,onClick:n=>t.changeUserStatus(d,0,"is_work")},io,8,oo)):(l(),i("span",{key:1,onClick:n=>t.changeUserStatus(d,1,"is_work")},ro,8,no))])]))),256))])])]),e("div",co,[t.bot_users_paginate_object?(l(),F(S,{key:0,onPagination_page:t.nextUsers,pagination:t.bot_users_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",uo,ho))],64))}});const po={props:["param"],data(){return{search:null,descriptions:[]}},computed:{filteredDescription(){return this.search?this.descriptions.filter(s=>s.text.indexOf(this.search)!==-1):this.descriptions}},mounted(){this.loadDescription()},methods:{select(s){this.$emit("callback",{param:this.param,text:s})},loadDescription(){this.$store.dispatch("loadDescription").then(s=>{this.descriptions=s.data})}}},bo={class:"dropdown"},go=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-spell-check"})],-1),fo={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},vo=e("div",{class:"dropdown-divider"},null,-1),yo=["onClick"];function $o(s,t,o,a,d,n){return l(),i("div",bo,[go,e("div",fo,[c(e("input",{type:"search",class:"form-control",id:"search-description-text","onUpdate:modelValue":t[0]||(t[0]=m=>d.search=m),placeholder:"Введите текст для поиска"},null,512),[[p,d.search]]),vo,(l(!0),i(f,null,$(n.filteredDescription,(m,_)=>(l(),i("p",{class:"p-1 text-left w-100",onClick:y=>n.select(m.text)},h(m.text),9,yo))),256))])])}const D=P(po,[["render",$o]]);const ko={class:"row"},Fo={class:"col-md-12 col-12"},Co={key:0,class:"alert alert-danger"},wo={class:"form-check mb-3"},jo=["value"],So=e("label",{class:"form-check-label",for:"bot-is-template"}," Отобразить список клиентов (выбор клиента для бота) ",-1),Vo={key:0,class:"col-md-12 col-12"},Po={key:1,class:"col-md-12 col-12"},Uo={class:"card alert alert-success"},Bo={class:"col-md-12 col-12"},Oo={class:"form-check mb-3"},To=["value"],Io=e("label",{class:"form-check-label",for:"bot-is-template"}," Сделать шаблоном ",-1),qo={key:2,class:"col-md-12 col-12"},Do={class:"mb-3"},Ro={class:"form-label",id:"bot-template-description"},Lo=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),xo=e("div",null,"Если Вы создаете шаблон, а не реального бота ",-1),Mo=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Ao={class:"row"},Eo=e("div",{class:"col-12"},[e("p",null,[u("Для создания бота в Телеграм воспользуйтесь "),e("a",{href:"https://telegra.ph/Sozdanie-telegram-bota-06-12",target:"_blank"},"инструкцией")])],-1),zo={class:"col-md-12 col-12"},Ko={class:"mb-3"},No={class:"form-label d-flex justify-content-between",id:"bot-token"},Yo=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Jo=e("div",null,"Взять из BotFather при создании бота! Длинная нечитаемая подсвеченная строка! ",-1),Wo=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Ho=e("a",{href:"https://t.me/botfather",target:"_blank"},"Создать нового бота в ТГ",-1),Go={key:0,class:"row"},Qo={class:"col-12 mb-3"},Xo=e("h6",null,[u("Аватар для бота "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),Zo={class:"photo-preview d-flex justify-content-center flex-wrap w-100"},el={key:0,for:"bot-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},tl=e("span",null,"+",-1),sl={class:"mb-2 img-preview",style:{"margin-right":"10px"}},ol={class:"remove"},ll=e("i",{class:"fa-regular fa-trash-can"},null,-1),il=[ll],nl={key:2,class:"mb-2 img-preview",style:{"margin-right":"10px"}},al={class:"remove"},dl=e("i",{class:"fa-regular fa-trash-can"},null,-1),rl=[dl],cl={key:1,class:"row"},ul={class:"col-12"},_l={class:"nav nav-tabs justify-content-center"},hl={class:"row py-3"},ml={class:"col-md-12 col-12"},pl={class:"mb-3"},bl={class:"form-label",id:"bot-domain"},gl=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),fl=e("div",null,'Строго взять из BotFather! ТО что при создании с окончанием на "bot"',-1),vl=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),yl={key:0},$l=["href"],kl={class:"col-md-12 col-12"},Fl={class:"card"},Cl={class:"card-body"},wl=e("h6",null,"Настройка параметров бота в BotFather",-1),jl={class:"mb-3"},Sl={class:"form-label d-flex justify-content-between align-items-center",id:"bot-title"},Vl={key:0},Pl={key:0,class:"text-secondary"},Ul={class:"mb-3"},Bl={class:"form-label d-flex justify-content-between align-items-center",id:"bot-short-description"},Ol={key:0,class:"text-secondary"},Tl={class:"mb-3"},Il={class:"form-label d-flex justify-content-between align-items-center",id:"bot-long-description"},ql={key:0,class:"text-secondary"},Dl={class:"col-5"},Rl={class:"mb-3"},Ll=["onUpdate:modelValue","aria-describedby"],xl={class:"col-5"},Ml={class:"mb-3"},Al=["onUpdate:modelValue","aria-describedby"],El={class:"col-2"},zl=["onClick"],Kl=e("i",{class:"fa-regular fa-trash-can"},null,-1),Nl=[Kl],Yl={class:"row"},Jl={class:"col-12"},Wl={class:"col-md-12 col-12"},Hl={class:"mb-3"},Gl=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Ql=e("div",null,"Ссылка на внешний сервис обработки данных ",-1),Xl=e("label",{class:"form-label",id:"callback_link"},"Ссылка на внешний сервис обработки данных ",-1),Zl={class:"row py-3"},ei={class:"col-md-6 col-12"},ti={class:"mb-3"},si={class:"form-label",id:"bot-balance"},oi=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),li=e("div",null,"Начальная сумма денег на счету у конкретного бота",-1),ii=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),ni={class:"col-md-6 col-12"},ai={class:"mb-3"},di={class:"form-label",id:"bot-tax-per-day"},ri=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),ci=e("div",null,"Сумма списания денег за сутки работы бота (тариф)",-1),ui=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),_i={class:"col-md-6 col-12"},hi={class:"mb-3"},mi=e("label",{class:"form-label",id:"bot-level-1"},[u(" Уровень 1 CashBack, % "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),pi={class:"col-md-6 col-12"},bi={class:"mb-3"},gi=e("label",{class:"form-label",id:"bot-level-2"},"Уровень 2 CashBack, %",-1),fi={class:"col-md-6 col-12"},vi={class:"mb-3"},yi=e("label",{class:"form-label",id:"bot-level-3"},"Уровень 3 CashBack, %",-1),$i={class:"col-md-12 col-12"},ki={class:"mb-3"},Fi=e("label",{class:"form-label",id:"cashback-fired-period"},"Период сгорания CashBack",-1),Ci=["value"],wi={key:0,class:"mb-3"},ji=e("label",{class:"form-label",id:"cashback-fired-level"},"Уровень сгорания CashBack, %",-1),Si={class:"mb-2"},Vi={class:"form-check"},Pi=e("label",{class:"form-check-label",for:"need-cashback-config"}," Необходимо настроить CashBack по категориям ",-1),Ui={class:"col-12 mb-2"},Bi={class:"form-check"},Oi=e("label",{class:"form-check-label",for:"need-payments"}," Необходимо подключить платежную систему ",-1),Ti={key:0,class:"col-md-12 col-12"},Ii={class:"form-check mb-3"},qi=["value"],Di=e("label",{class:"form-check-label",for:"bot-auto-cashback-on-payments"}," Начислять CashBack автоматически после успешной оплаты ",-1),Ri={class:"mb-3"},Li=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),xi=e("div",null,"Если в боте планируется оплата, то необходимо через BotFather привязать нужную платежную систему и указать в данном поле полученный токен ",-1),Mi=e("label",{class:"form-label",id:"payment_provider_token"},[u("Токен платежной системы "),e("a",{href:"https://t.me/botfather",target:"_blank"},"Подключить")],-1),Ai={class:"col-12 mb-2"},Ei={class:"form-check"},zi=e("label",{class:"form-check-label",for:"need-shop"}," Необходимо интегрировать магазин в бота ",-1),Ki={key:1,class:"col-md-12 col-12"},Ni={class:"mb-3"},Yi=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Ji=e("div",null,"Ссылка на страницу ВК с товарами для вашего магазина в боте ",-1),Wi=e("label",{class:"form-label",id:"bot-vk_shop_link"},[u("Ссылка на группу ВК с товарами "),e("a",{href:"https://vk.com/groups?w=groups_create",target:"_blank"},"Создать")],-1),Hi={key:2,class:"mb-2"},Gi=e("h6",null,"Настройка категорий CashBack-а",-1),Qi={class:"d-flex justify-content-between align-items-center w-100"},Xi=e("small",null,"Название категории",-1),Zi=["onClick"],en=e("i",{class:"fa-regular fa-trash-can"},null,-1),tn=[en],sn=["onUpdate:modelValue","aria-describedby"],on=e("div",{class:"divider divider-small my-3 bg-highlight"},null,-1),ln={class:"row py-3"},nn={class:"col-md-6 col-12"},an={class:"mb-3"},dn={class:"d-flex justify-content-between align-items-center"},rn={class:"form-label d-flex justify-content-between",id:"bot-order-channel"},cn=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),un=e("div",null,"Ввести адрес ссылки на канал в форму после добавления тоукена ",-1),_n=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),hn={class:"col-md-6 col-12"},mn={class:"mb-3"},pn={class:"d-flex justify-content-between"},bn=e("label",{class:"form-label",id:"bot-main-channel"},"Канал для постов (id,рекламный)",-1),gn={key:0,class:"col-12 mb-2"},fn={class:"form-check"},vn=e("label",{class:"form-check-label",for:"need-payments"}," Необходимо добавить рассылку по топикам для канала заказов (он же системный канал) ",-1),yn={key:1,class:"col-12 mb-2"},$n={class:"d-flex justify-content-between align-items-center mb-2"},kn=e("p",null,'Для того, чтоб узнать идентификатор топика в группе впишите в чат "Мой id"',-1),Fn=e("i",{class:"fa-solid fa-paperclip mr-2"},null,-1),Cn={class:"list-group"},wn={class:"list-group-item"},jn={class:"mb-0"},Sn=["onUpdate:modelValue"],Vn={class:"col-md-12 col-12 mb-2"},Pn={class:"card border-warning"},Un={class:"card-body"},Bn={class:"form-group"},On=e("label",{class:"form-check-label",for:"warning-rules"},[e("i",{class:"fa-solid fa-triangle-exclamation text-danger"}),u(" Правила критических оповещений ")],-1),Tn=e("option",{value:null},"Не выбрано",-1),In=["value"],qn={class:"card my-2 p-2"},Dn={class:"row"},Rn={class:"col-md-4 d-flex align-items-center"},Ln={class:"m-0"},xn={class:"col-md-2"},Mn={class:"form-check"},An=["onUpdate:modelValue","id"],En=["for"],zn={key:0},Kn={key:1},Nn={class:"col-md-5"},Yn=["onUpdate:modelValue"],Jn={class:"col-md-1 d-flex justify-content-center"},Wn=["onClick"],Hn=e("i",{class:"fa-solid fa-trash-can"},null,-1),Gn=[Hn],Qn={class:"row py-3"},Xn={class:"col-12"},Zn={class:"mb-3"},ea={class:"d-flex justify-content-between"},ta={class:"form-label",id:"bot-description"},sa=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),oa=e("div",null,"Отобразится пользователю при первом запуске",-1),la=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),ia={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},na={class:"col-12"},aa={class:"mb-3"},da={class:"d-flex justify-content-between"},ra={class:"form-label",id:"bot-description"},ca=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),ua=e("div",null,'Для меню "О Боте"',-1),_a=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),ha={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},ma={class:"col-12"},pa={class:"mb-3"},ba={class:"d-flex justify-content-between"},ga={class:"form-label",id:"bot-maintenance-message"},fa=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),va={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},ya={class:"row py-3"},$a={class:"col-12"},ka={class:"card mb-3"},Fa=e("div",{class:"card-header"},[e("h6",null,[u("Информационная ссылка: создайте контент в "),e("a",{target:"_blank",href:"https://telegra.ph"},"https://telegra.ph")])],-1),Ca={class:"card-body"},wa=e("div",{class:"row"},[e("div",{class:"col-12"},[e("h6",null,"Ссылка")])],-1),ja={class:"row"},Sa={class:"col-12"},Va={class:"mb-3"},Pa={class:"col-12"},Ua={class:"card mb-3"},Ba=e("div",{class:"card-header"},[e("h6",null,"Ссылки на соц. сети")],-1),Oa={class:"card-body"},Ta=e("div",{class:"row"},[e("div",{class:"col-12"},[e("h6",null,"Ссылка")])],-1),Ia={class:"col-5"},qa={class:"mb-3"},Da=["onUpdate:modelValue","aria-describedby"],Ra={class:"col-5"},La={class:"mb-3"},xa=["onUpdate:modelValue","aria-describedby"],Ma={class:"col-2"},Aa=["onClick"],Ea=e("i",{class:"fa-regular fa-trash-can"},null,-1),za=[Ea],Ka={class:"row"},Na={class:"col-12"},Ya={class:"row"},Ja={class:"col-12"},Wa={class:"alert alert-danger alert-dismissible fade show",role:"alert"},Ha=e("strong",null,"Внимание!",-1),Ga=["onClick"],Qa={class:"col-12"},Xa=["disabled"],Za={key:0},ed={key:1},td={props:["bot"],data(){return{tab:0,messages:[],need_company_select:!1,selected_warning:null,page:null,step:0,templates:[],load:!1,loadPage:!1,needPageListUpdate:!1,need_threads:!1,need_company:!1,need_cashback_config:!1,need_payments:!1,need_shop:!1,command:null,company:null,warnings:[{title:"Сумма чека больше чем",key:"bill_sum_more_then"},{title:"Сумма начисления кэшбэка больше чем",key:"cashback_up_sum_more_then"},{title:"Сумма списания кэшбэка больше чем",key:"cashback_down_sum_more_then"}],cashback_fire_periods:[{title:"Не сгорает",value:0},{title:"7 дней",value:7},{title:"15 дней",value:15},{title:"30 дней",value:30},{title:"60 дней",value:60},{title:"60 дней",value:90},{title:"120 дней",value:120},{title:"180 дней",value:180},{title:"360 дней",value:360}],botForm:{title:"",short_description:"",long_description:"",is_template:!1,auto_cashback_on_payments:!1,template_description:null,bot_domain:null,bot_token:null,company_id:null,bot_token_dev:null,order_channel:null,message_threads:null,cashback_config:null,main_channel:null,vk_shop_link:null,callback_link:null,balance:null,tax_per_day:null,welcome_message:null,image:null,cashback_fire_percent:0,cashback_fire_period:0,description:null,info_link:null,social_links:[],maintenance_message:null,payment_provider_token:null,level_1:10,level_2:0,level_3:0,photos:[],commands:null,selected_bot_template_id:null,pages:[],amo:null,warnings:[]}}},watch:{"botForm.bot_token":{handler(s){this.botForm.bot_token&&this.getMe()},deep:!0},need_threads:function(s,t){let o=[{title:"Отзывы",key:"reviews",value:null},{title:"Начисление cashback",key:"cashback",value:null},{title:"Вопросы",key:"questions",value:null},{title:"Конкурсы",key:"actions",value:null},{title:"Заказы",key:"orders",value:null},{title:"Вывод средств",key:"ask-money",value:null}];this.need_threads&&!this.botForm.message_threads&&(this.botForm.message_threads=o),this.need_threads&&this.botForm.message_threads&&o.forEach(a=>{this.botForm.message_threads.findIndex(n=>n.key===a.key)===-1&&this.botForm.message_threads.push(a)})},need_payments:function(s,t){this.need_payments||(this.botForm.auto_cashback_on_payments=!1)}},computed:{...w(["getSlugs","getCurrentCompany"]),filteredWarnings(){return this.botForm.warnings.length===0?this.warnings:this.warnings.filter(s=>!(this.botForm.warnings.findIndex(t=>t.rule_key===s.key)>=0))}},mounted(){window.addEventListener("store_current_company-change-event",s=>{this.company=this.getCurrentCompany}),this.bot&&this.$nextTick(()=>{this.botForm={id:this.bot.id||null,title:this.bot.title||"",short_description:this.bot.short_description||"",long_description:this.bot.long_description||"",is_template:this.bot.is_template||!1,auto_cashback_on_payments:this.bot.auto_cashback_on_payments||!1,template_description:this.bot.template_description||null,bot_domain:this.bot.bot_domain||null,bot_token:this.bot.bot_token||null,bot_token_dev:this.bot.bot_token_dev||null,order_channel:this.bot.order_channel||null,message_threads:this.bot.message_threads||null,cashback_config:this.bot.cashback_config||null,main_channel:this.bot.main_channel||null,balance:this.bot.balance||null,tax_per_day:this.bot.tax_per_day||null,vk_shop_link:this.bot.vk_shop_link||null,callback_link:this.bot.callback_link||null,cashback_fire_percent:this.bot.cashback_fire_percent||0,cashback_fire_period:this.bot.cashback_fire_period||0,image:this.bot.image||null,commands:this.bot.commands||null,description:this.bot.description||null,info_link:this.bot.info_link||null,social_links:this.bot.social_links||[],maintenance_message:this.bot.maintenance_message||null,welcome_message:this.bot.welcome_message||null,payment_provider_token:this.bot.payment_provider_token||null,level_1:this.bot.level_1,level_2:this.bot.level_2,level_3:this.bot.level_3,company_id:this.bot.company_id,photos:this.bot.photos||[],warnings:this.bot.warnings||[],amo:this.bot.amo||null},this.botForm.commands==null&&(this.botForm.commands=[{command:"/start",description:"начни с этой команды"},{command:"/admins",description:"доступные администраторы в системе"},{command:"/help",description:"как использовать систему"},{command:"/about",description:"о CashMan"}]),this.botForm.message_threads&&(this.need_threads=!0),this.botForm.payment_provider_token&&(this.need_payments=!0),this.botForm.cashback_config&&(this.need_cashback_config=!0),this.bot.company&&(this.company=this.bot.company)})},methods:{alert(s,t=null){t!=null&&(this.tab=t),this.messages.push(s)},removeMessage(s){this.messages.splice(s,1)},createBotTopics(){this.$store.dispatch("createBotTopics",{dataObject:{topics:this.botForm.message_threads,bot_id:this.bot.id}}).then(s=>{this.botForm.message_threads=s.data})},getMe(){this.$store.dispatch("getMe",{bot_token:this.botForm.bot_token}).then(s=>{this.botForm.bot_domain=s.username||null,this.botForm.title=s.first_name||null})},getChatLink(s){this.$store.dispatch("loadChatInfo",{dataObject:{chat_id:s,bot_id:this.bot.id}}).then(t=>{console.log("chat info",t)})},addTextTo(s={param:null,text:null}){this.botForm[s.param]=s.text},removeCommands(s){this.botForm.commands.splice(s,1)},addCommands(){this.botForm.commands||(this.botForm.commands=[]),this.botForm.commands.push({command:null,description:null})},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},onChangePhotos(s){const t=s.target.files;this.botForm.image=null;for(let o=0;o<t.length;o++)this.botForm.photos=[t[o]]},addItem(s){this.botForm[s].push("")},addSocialLinks(){this.botForm.social_links.push({title:null,url:null})},removeItem(s,t){this.botForm[s].splice(t,1)},removePhoto(){this.botForm.photos=[],this.botForm.image=null},addBot(){let s=new FormData;Object.keys(this.botForm).forEach(t=>{const o=this.botForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.company&&s.append("company_id",this.company.id);for(let t=0;t<this.botForm.photos.length;t++)s.append("images[]",this.botForm.photos[t]);s.delete("photos"),this.$store.dispatch(this.bot==null?"createBot":"updateBot",{botForm:s}).then(t=>{let o=t.data;this.$emit("callback",o),this.$notify({title:"Конструктор ботов",text:this.bot==null?"Бот успешно создан!":"Бот успешно обновлен!",type:"success"}),this.$store.dispatch("updateBotWebhook",{dataObject:{bot_id:o.id}}),this.bot==null&&(this.botForm={title:"",short_description:"",long_description:"",is_template:!1,auto_cashback_on_payments:!1,template_description:null,bot_domain:null,bot_token:null,bot_token_dev:null,order_channel:null,message_threads:null,main_channel:null,balance:null,tax_per_day:null,callback_link:null,cashback_fire_percent:0,cashback_fire_period:0,image:null,description:null,info_link:null,social_links:[],maintenance_message:null,payment_provider_token:null,level_1:10,level_2:0,level_3:0,photos:[],warnings:[],selected_bot_template_id:null,pages:[]})}).catch(t=>{this.$notify({title:"Конструктор ботов",text:"Ошибочка...",type:"error"})})},removeCashBackConfig(s){this.botForm.cashback_config.splice(s,1)},addCashBackConfig(){this.botForm.cashback_config=this.botForm.cashback_config==null?[]:this.botForm.cashback_config,this.botForm.cashback_config.push({title:null})},getWarning(s){let t=this.warnings.find(o=>o.key===s);return t||{title:"Не найдено"}},removeWarning(s){this.botForm.warnings.splice(s,1)},companyListCallback(s){this.load=!0,this.botForm.company_id=s.id,this.need_company_select=!1,this.$nextTick(()=>{this.load=!1})},addWarning(){const s=this.selected_warning;this.botForm.warnings.push({rule_key:s.key,rule_value:0,is_active:!0}),this.selected_warning=null}}},VF=Object.assign(td,{__name:"BotForm",setup(s){return(t,o)=>{const a=U("Popper"),d=q("lazy");return l(),i("form",{class:"py-3 mb-5",onSubmit:o[59]||(o[59]=j((...n)=>t.addBot&&t.addBot(...n),["prevent"]))},[e("div",ko,[e("div",Fo,[t.botForm.company_id==null?(l(),i("p",Co,"Внимание! Вы не выбрали клиента!")):r("",!0),e("div",wo,[c(e("input",{class:"form-check-input",type:"checkbox",value:t.need_company_select,"onUpdate:modelValue":o[0]||(o[0]=n=>t.need_company_select=n),id:"bot-is-template"},null,8,jo),[[k,t.need_company_select]]),So])]),t.need_company_select?(l(),i("div",Vo,[t.load?r("",!0):(l(),F(z,{key:0,selected:t.botForm.company_id,onCallback:t.companyListCallback},null,8,["selected","onCallback"]))])):r("",!0),t.company?(l(),i("div",Po,[e("div",Uo," Выбранный клиент #"+h(t.company.id)+" "+h(t.company.title),1)])):r("",!0),e("div",Bo,[e("div",Oo,[c(e("input",{class:"form-check-input",type:"checkbox",value:t.botForm.is_template,"onUpdate:modelValue":o[1]||(o[1]=n=>t.botForm.is_template=n),id:"bot-is-template"},null,8,To),[[k,t.botForm.is_template]]),Io])]),t.botForm.is_template?(l(),i("div",qo,[e("div",Do,[e("label",Ro,[v(a,null,{content:g(()=>[xo]),default:g(()=>[Lo]),_:1}),u(" Название шаблона бота "),Mo]),c(e("input",{type:"text",class:"form-control",placeholder:"Название \\ описание шаблона","aria-label":"Описание шаблона","onUpdate:modelValue":o[2]||(o[2]=n=>t.botForm.template_description=n),maxlength:"255",onInvalid:o[3]||(o[3]=n=>t.alert("Вы не ввели название шаблона!")),"aria-describedby":"bot-template-description",required:""},null,544),[[p,t.botForm.template_description]])])])):r("",!0)]),e("div",Ao,[Eo,e("div",zo,[e("div",Ko,[e("label",No,[e("div",null,[v(a,null,{content:g(()=>[Jo]),default:g(()=>[Yo]),_:1}),u(" Токен бота "),Wo]),Ho]),c(e("input",{type:"text",class:"form-control",placeholder:"Токен","aria-label":"Токен","onUpdate:modelValue":o[4]||(o[4]=n=>t.botForm.bot_token=n),maxlength:"255",onInvalid:o[5]||(o[5]=n=>t.alert("Вы не ввели токен бота!")),"aria-describedby":"bot-token",required:""},null,544),[[p,t.botForm.bot_token]])])])]),t.botForm.bot_token?(l(),i("div",Go,[e("div",Qo,[Xo,e("div",Zo,[t.botForm.photos?(l(),i("label",el,[tl,e("input",{type:"file",id:"bot-photos",accept:"image/*",onChange:o[6]||(o[6]=(...n)=>t.onChangePhotos&&t.onChangePhotos(...n)),style:{display:"none"}},null,32)])):r("",!0),t.botForm.photos?(l(!0),i(f,{key:1},$(t.botForm.photos,(n,m)=>(l(),i("div",sl,[c(e("img",null,null,512),[[d,t.getPhoto(n).imageUrl]]),e("div",ol,[e("a",{onClick:o[7]||(o[7]=_=>t.removePhoto())},il)])]))),256)):(l(),i("div",nl,[c(e("img",null,null,512),[[d,"/images-by-bot-id/"+s.bot.id+"/"+t.botForm.image]]),e("div",al,[e("a",{onClick:o[8]||(o[8]=n=>t.removePhoto())},rl)])]))])])])):r("",!0),t.botForm.bot_token?(l(),i("div",cl,[e("div",ul,[e("ul",_l,[e("li",{class:"nav-item",onClick:o[9]||(o[9]=n=>t.tab=0)},[e("a",{class:b(["nav-link",{active:t.tab===0}]),href:"javascript:void(0)"},"Базовые настройки",2)]),e("li",{class:"nav-item",onClick:o[10]||(o[10]=n=>t.tab=1)},[e("a",{class:b(["nav-link",{active:t.tab===1}]),href:"javascript:void(0)"},"Оплата и Кэшбэк",2)]),e("li",{class:"nav-item",onClick:o[11]||(o[11]=n=>t.tab=2)},[e("a",{class:b(["nav-link",{active:t.tab===2}]),href:"javascript:void(0)"},"Обратная связь",2)]),e("li",{class:"nav-item",onClick:o[12]||(o[12]=n=>t.tab=3)},[e("a",{class:b(["nav-link",{active:t.tab===3}]),href:"javascript:void(0)"},"Сообщения",2)]),e("li",{class:"nav-item",onClick:o[13]||(o[13]=n=>t.tab=4)},[e("a",{class:b(["nav-link",{active:t.tab===4}]),href:"javascript:void(0)"},"Другие настройки",2)])])])])):r("",!0),c(e("div",hl,[e("div",ml,[e("div",pl,[e("label",bl,[v(a,null,{content:g(()=>[fl]),default:g(()=>[gl]),_:1}),u(" Доменное имя бота (загружается автоматически) "),vl]),c(e("input",{type:"text",class:"form-control",placeholder:"Имя бота","aria-label":"Имя бота",name:"bot_domain",onInvalid:o[14]||(o[14]=n=>t.alert("Вы не ввели доменное имя бота!",0)),"onUpdate:modelValue":o[15]||(o[15]=n=>t.botForm.bot_domain=n),maxlength:"255","aria-describedby":"bot-domain",required:""},null,544),[[p,t.botForm.bot_domain]]),t.botForm.bot_domain?(l(),i("p",yl,[u("Проверить работу бота "),e("a",{href:"https://t.me/"+t.botForm.bot_domain,target:"_blank"},"@"+h(t.botForm.bot_domain),9,$l)])):r("",!0)])]),e("div",kl,[e("div",Fl,[e("div",Cl,[wl,e("div",jl,[e("label",Sl,[t.botForm.title?(l(),i("span",Vl,[u(" Название бота "),t.botForm.title.length>0?(l(),i("small",Pl,"Длина текста "+h(t.botForm.title.length)+"/64",1)):r("",!0)])):r("",!0)]),c(e("input",{type:"text",class:"form-control",placeholder:"Текст названия","aria-label":"Текст названия","onUpdate:modelValue":o[16]||(o[16]=n=>t.botForm.title=n),maxlength:"64","aria-describedby":"bot-title"},null,512),[[p,t.botForm.title]])]),e("div",Ul,[e("label",Bl,[e("span",null,[u(" Короткое описание бота "),t.botForm.short_description.length>0?(l(),i("small",Ol,"Длина текста "+h(t.botForm.short_description.length)+"/120",1)):r("",!0)])]),c(e("textarea",{class:"form-control",placeholder:"Короткий текст описания бота","aria-label":"Короткий текст описания бота","onUpdate:modelValue":o[17]||(o[17]=n=>t.botForm.short_description=n),maxlength:"120","aria-describedby":"bot-short-description"},`
                                `,512),[[p,t.botForm.short_description]])]),e("div",Tl,[e("label",Il,[e("span",null,[u(" Длинное описание бота "),t.botForm.long_description.length>0?(l(),i("small",ql,"Длина текста "+h(t.botForm.long_description.length)+"/512",1)):r("",!0)])]),c(e("textarea",{class:"form-control",placeholder:"Длинный текст описания бота","aria-label":"Длинный текст описания бота","onUpdate:modelValue":o[18]||(o[18]=n=>t.botForm.long_description=n),maxlength:"512","aria-describedby":"bot-long-description"},`
                                `,512),[[p,t.botForm.long_description]])]),(l(!0),i(f,null,$(t.botForm.commands,(n,m)=>(l(),i("div",{class:"row",key:"commands-"+m},[e("div",Dl,[e("div",Rl,[c(e("input",{type:"text",class:"form-control",placeholder:"Название команды","aria-label":"Название команды",maxlength:"255",onInvalid:o[19]||(o[19]=_=>t.alert("Вы не ввели название команды",0)),"onUpdate:modelValue":_=>t.botForm.commands[m].command=_,"aria-describedby":"bot-command-"+m,required:""},null,40,Ll),[[p,t.botForm.commands[m].command]])])]),e("div",xl,[e("div",Ml,[c(e("input",{type:"text",class:"form-control",placeholder:"Описание команды","aria-label":"Описание команды",maxlength:"255",onInvalid:o[20]||(o[20]=_=>t.alert("Вы не ввели описание команды!",0)),"onUpdate:modelValue":_=>t.botForm.commands[m].description=_,"aria-describedby":"bot-command-description-"+m,required:""},null,40,Al),[[p,t.botForm.commands[m].description]])])]),e("div",El,[e("button",{type:"button",onClick:_=>t.removeCommands(m),class:"btn btn-outline-danger w-100"},Nl,8,zl)])]))),128)),e("div",Yl,[e("div",Jl,[e("button",{type:"button",onClick:o[21]||(o[21]=n=>t.addCommands()),class:"btn btn-outline-success w-100"},"Добавить еще команду ")])])])])]),e("div",Wl,[e("div",Hl,[v(a,null,{content:g(()=>[Ql]),default:g(()=>[Gl]),_:1}),Xl,c(e("input",{type:"url",class:"form-control",placeholder:"Ссылка на внешний сервис","aria-label":"ссылка на внешний сервис","onUpdate:modelValue":o[22]||(o[22]=n=>t.botForm.callback_link=n),"aria-describedby":"callback_link"},null,512),[[p,t.botForm.callback_link]])])])],512),[[O,t.tab===0&&t.botForm.bot_token]]),c(e("div",Zl,[e("div",ei,[e("div",ti,[e("label",si,[v(a,null,{content:g(()=>[li]),default:g(()=>[oi]),_:1}),u(" Баланс бота, руб "),ii]),c(e("input",{type:"number",class:"form-control",placeholder:"Баланс","aria-label":"Баланс","onUpdate:modelValue":o[23]||(o[23]=n=>t.botForm.balance=n),min:"0",onInvalid:o[24]||(o[24]=n=>t.alert("Вы не ввели сумму баланса бота!",1)),"aria-describedby":"bot-balance",required:""},null,544),[[p,t.botForm.balance]])])]),e("div",ni,[e("div",ai,[e("label",di,[v(a,null,{content:g(()=>[ci]),default:g(()=>[ri]),_:1}),u(" Списание за сутки, руб "),ui]),c(e("input",{type:"number",class:"form-control",placeholder:"Списание","aria-label":"Списание","onUpdate:modelValue":o[25]||(o[25]=n=>t.botForm.tax_per_day=n),min:"0",onInvalid:o[26]||(o[26]=n=>t.alert("Вы не ввели сумму списания бота!",1)),"aria-describedby":"bot-tax-per-day",required:""},null,544),[[p,t.botForm.tax_per_day]])])]),e("div",_i,[e("div",hi,[mi,c(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень CashBack","onUpdate:modelValue":o[27]||(o[27]=n=>t.botForm.level_1=n),min:"0",onInvalid:o[28]||(o[28]=n=>t.alert("Вы не ввели значение кэшбэка 1 уровня бота!",1)),"aria-describedby":"bot-level-1",required:""},null,544),[[p,t.botForm.level_1]])])]),e("div",pi,[e("div",bi,[gi,c(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень CashBack","onUpdate:modelValue":o[29]||(o[29]=n=>t.botForm.level_2=n),min:"0","aria-describedby":"bot-level-2"},null,512),[[p,t.botForm.level_2]])])]),e("div",fi,[e("div",vi,[yi,c(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень CashBack","onUpdate:modelValue":o[30]||(o[30]=n=>t.botForm.level_3=n),min:"0","aria-describedby":"bot-level-3"},null,512),[[p,t.botForm.level_3]])])]),e("div",$i,[e("div",ki,[Fi,c(e("select",{class:"form-control","onUpdate:modelValue":o[31]||(o[31]=n=>t.botForm.cashback_fire_period=n),id:"cashback-fired-period"},[(l(!0),i(f,null,$(t.cashback_fire_periods,n=>(l(),i("option",{value:n.value},h(n.title||"Не указано"),9,Ci))),256))],512),[[V,t.botForm.cashback_fire_period]])]),t.botForm.cashback_fire_period>0?(l(),i("div",wi,[ji,c(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень сгорания CashBack","onUpdate:modelValue":o[32]||(o[32]=n=>t.botForm.cashback_fire_percent=n),min:"0",max:"100","aria-describedby":"cashback-fired-level"},null,512),[[p,t.botForm.cashback_fire_percent]])])):r("",!0)]),e("div",Si,[e("div",Vi,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[33]||(o[33]=n=>t.need_cashback_config=n),type:"checkbox",id:"need-cashback-config"},null,512),[[k,t.need_cashback_config]]),Pi])]),e("div",Ui,[e("div",Bi,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[34]||(o[34]=n=>t.need_payments=n),type:"checkbox",id:"need-payments"},null,512),[[k,t.need_payments]]),Oi])]),t.need_payments?(l(),i("div",Ti,[e("div",Ii,[c(e("input",{class:"form-check-input",type:"checkbox",value:t.botForm.auto_cashback_on_payments,"onUpdate:modelValue":o[35]||(o[35]=n=>t.botForm.auto_cashback_on_payments=n),id:"bot-auto-cashback-on-payments"},null,8,qi),[[k,t.botForm.auto_cashback_on_payments]]),Di]),e("div",Ri,[v(a,null,{content:g(()=>[xi]),default:g(()=>[Li]),_:1}),Mi,c(e("input",{type:"text",class:"form-control",placeholder:"Токен","aria-label":"Токен","onUpdate:modelValue":o[36]||(o[36]=n=>t.botForm.payment_provider_token=n),"aria-describedby":"payment_provider_token"},null,512),[[p,t.botForm.payment_provider_token]])])])):r("",!0),e("div",Ai,[e("div",Ei,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[37]||(o[37]=n=>t.need_shop=n),type:"checkbox",id:"need-shop"},null,512),[[k,t.need_shop]]),zi])]),t.need_shop?(l(),i("div",Ki,[e("div",Ni,[v(a,null,{content:g(()=>[Ji]),default:g(()=>[Yi]),_:1}),Wi,c(e("input",{type:"url",class:"form-control",placeholder:"Ссылка на группу ВК","aria-label":"ссылка на группу ВК","onUpdate:modelValue":o[38]||(o[38]=n=>t.botForm.vk_shop_link=n),"aria-describedby":"vk_shop_link"},null,512),[[p,t.botForm.vk_shop_link]])])])):r("",!0),t.need_cashback_config?(l(),i("div",Hi,[Gi,(l(!0),i(f,null,$(t.botForm.cashback_config,(n,m)=>(l(),i("div",{class:"d-flex justify-content-between mb-2 flex-wrap",key:"social-link"+m},[e("div",Qi,[Xi,e("button",{type:"button",onClick:_=>t.removeCashBackConfig(m),class:"btn btn-link text-danger"},tn,8,Zi)]),c(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Название категории","aria-label":"Название категории",maxlength:"255",onInvalid:o[39]||(o[39]=_=>t.alert("Вы не ввели название категории!",1)),"onUpdate:modelValue":_=>t.botForm.cashback_config[m].title=_,"aria-describedby":"bot-cashback-config-"+m,required:""},null,40,sn),[[p,t.botForm.cashback_config[m].title]])]))),128)),e("button",{type:"button",onClick:o[40]||(o[40]=n=>t.addCashBackConfig()),class:"btn mb-2 rounded-sm text-uppercase btn-outline-info w-100"}," Добавить еще категорию "),on])):r("",!0)],512),[[O,t.tab===1&&t.botForm.bot_token]]),c(e("div",ln,[e("div",nn,[e("div",an,[e("div",dn,[e("label",rn,[e("div",null,[v(a,null,{content:g(()=>[un]),default:g(()=>[cn]),_:1}),u(" Канал для заказов (id) "),_n])]),v(T,{token:t.botForm.bot_token,param:"order_channel",onCallback:t.addTextTo},null,8,["token","onCallback"])]),c(e("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":o[41]||(o[41]=n=>t.botForm.order_channel=n),maxlength:"255","aria-describedby":"bot-order-channel"},null,512),[[p,t.botForm.order_channel]]),e("small",null,[e("a",{onClick:o[42]||(o[42]=n=>t.getChatLink(t.botForm.order_channel)),href:"javascript:void(0)"},"Узнать ссылку"),u("(будет отправлена в бота)")])])]),e("div",hn,[e("div",mn,[e("div",pn,[bn,v(T,{token:t.botForm.bot_token,param:"main_channel",onCallback:t.addTextTo},null,8,["token","onCallback"])]),c(e("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":o[43]||(o[43]=n=>t.botForm.main_channel=n),maxlength:"255","aria-describedby":"bot-main-channel"},null,512),[[p,t.botForm.main_channel]]),e("small",null,[e("a",{onClick:o[44]||(o[44]=n=>t.getChatLink(t.botForm.main_channel)),href:"javascript:void(0)"},"Узнать ссылку"),u("(будет отправлена в бота)")])])]),t.botForm.order_channel?(l(),i("div",gn,[e("div",fn,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[45]||(o[45]=n=>t.need_threads=n),type:"checkbox",id:"need-payments"},null,512),[[k,t.need_threads]]),vn])])):r("",!0),t.need_threads&&t.botForm.order_channel?(l(),i("div",yn,[e("div",$n,[kn,e("a",{class:"btn btn-outline-info",onClick:o[46]||(o[46]=(...n)=>t.createBotTopics&&t.createBotTopics(...n)),href:"javascript:void(0)"},[Fn,u("Создать топики автоматически ")])]),e("ul",Cn,[(l(!0),i(f,null,$(t.botForm.message_threads,(n,m)=>(l(),i("li",wn,[e("p",jn,h(n.title)+" ("+h(n.key)+")",1),c(e("input",{type:"number",class:"form-control",min:"0",max:"10000",placeholder:"Идентификатор топика","onUpdate:modelValue":_=>t.botForm.message_threads[m].value=_},null,8,Sn),[[p,t.botForm.message_threads[m].value]])]))),256))])])):r("",!0),e("div",Vn,[e("div",Pn,[e("div",Un,[e("div",Bn,[On,c(e("select",{class:"form-control","onUpdate:modelValue":o[47]||(o[47]=n=>t.selected_warning=n),onChange:o[48]||(o[48]=(...n)=>t.addWarning&&t.addWarning(...n)),id:"warning-rules"},[Tn,(l(!0),i(f,null,$(t.filteredWarnings,n=>(l(),i("option",{value:n},h(n.title),9,In))),256))],544),[[V,t.selected_warning]])]),(l(!0),i(f,null,$(t.botForm.warnings,(n,m)=>(l(),i("div",qn,[e("div",Dn,[e("div",Rn,[e("p",Ln,h(t.getWarning(n.rule_key).title||"Не найдено"),1)]),e("div",xn,[e("div",Mn,[c(e("input",{class:"form-check-input","onUpdate:modelValue":_=>t.botForm.warnings[m].is_active=_,type:"checkbox",id:"warning-is-active-"+m},null,8,An),[[k,t.botForm.warnings[m].is_active]]),e("label",{class:"form-check-label",for:"warning-is-active-"+m},[t.botForm.warnings[m].is_active?(l(),i("span",zn,"Вкл")):(l(),i("span",Kn,"Выкл"))],8,En)])]),e("div",Nn,[c(e("input",{type:"number",class:"form-control",placeholder:"Значение","onUpdate:modelValue":_=>t.botForm.warnings[m].rule_value=_,min:"0","aria-describedby":"bot-level-3"},null,8,Yn),[[p,t.botForm.warnings[m].rule_value]])]),e("div",Jn,[e("button",{onClick:_=>t.removeWarning(m),type:"button",class:"btn btn-outline-danger"},Gn,8,Wn)])])]))),256))])])])],512),[[O,t.tab===2&&t.botForm.bot_token]]),c(e("div",Qn,[e("div",Xn,[e("div",Zn,[e("div",ea,[e("label",ta,[v(a,null,{content:g(()=>[oa]),default:g(()=>[sa]),_:1}),u(" Приветственное сообщение "),la,t.botForm.welcome_message?(l(),i("small",ia," Длина текста "+h(t.botForm.welcome_message.length),1)):r("",!0)]),v(D,{param:"welcome_message",onCallback:t.addTextTo},null,8,["onCallback"])]),c(e("textarea",{type:"text",class:"form-control",style:{"min-height":"400px"},placeholder:"Текстовое приветствие при запуске бота","aria-label":"Текстовое приветствие при запуске бота","onUpdate:modelValue":o[49]||(o[49]=n=>t.botForm.welcome_message=n),onInvalid:o[50]||(o[50]=n=>t.alert("Вы не ввели приветственное сообщение!",3)),"aria-describedby":"bot-description",required:""},`
                    `,544),[[p,t.botForm.welcome_message]])])]),e("div",na,[e("div",aa,[e("div",da,[e("label",ra,[v(a,null,{content:g(()=>[ua]),default:g(()=>[ca]),_:1}),u(" Описание бота "),_a,t.botForm.description?(l(),i("small",ha," Длина текста "+h(t.botForm.description.length),1)):r("",!0)]),v(D,{param:"description",onCallback:t.addTextTo},null,8,["onCallback"])]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текстовое описание бота","aria-label":"Текстовое описание бота","onUpdate:modelValue":o[51]||(o[51]=n=>t.botForm.description=n),onInvalid:o[52]||(o[52]=n=>t.alert("Вы не ввели описание бота!",3)),"aria-describedby":"bot-description",required:""},`
                    `,544),[[p,t.botForm.description]])])]),e("div",ma,[e("div",pa,[e("div",ba,[e("label",ga,[u("Сообщение для режима тех. работ "),fa,t.botForm.maintenance_message?(l(),i("small",va," Длина текста "+h(t.botForm.maintenance_message.length),1)):r("",!0)]),v(D,{param:"maintenance_message",onCallback:t.addTextTo},null,8,["onCallback"])]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текстовое сообщение","aria-label":"Текстовое сообщение","onUpdate:modelValue":o[53]||(o[53]=n=>t.botForm.maintenance_message=n),maxlength:"255",onInvalid:o[54]||(o[54]=n=>t.alert("Вы не ввели сообщение для технических работ бота!",3)),"aria-describedby":"bot-maintenance-message",required:""},`
                    `,544),[[p,t.botForm.maintenance_message]])])])],512),[[O,t.tab===3&&t.botForm.bot_token]]),c(e("div",ya,[e("div",$a,[e("div",ka,[Fa,e("div",Ca,[wa,e("div",ja,[e("div",Sa,[e("div",Va,[c(e("input",{type:"text",class:"form-control",placeholder:"Ссылка ресурс telegraph","aria-label":"Ссылка ресурс telegraph",maxlength:"255","onUpdate:modelValue":o[55]||(o[55]=n=>t.botForm.info_link=n),"aria-describedby":"bot-info-link"},null,512),[[p,t.botForm.info_link]])])])])])])]),e("div",Pa,[e("div",Ua,[Ba,e("div",Oa,[Ta,(l(!0),i(f,null,$(t.botForm.social_links,(n,m)=>(l(),i("div",{class:"row",key:"social-link"+m},[e("div",Ia,[e("div",qa,[c(e("input",{type:"text",class:"form-control",placeholder:"Название ссылки","aria-label":"Название ссылки",maxlength:"255",onInvalid:o[56]||(o[56]=_=>t.alert("Вы не ввели название ссылки на соц. сеть!",4)),"onUpdate:modelValue":_=>t.botForm.social_links[m].title=_,"aria-describedby":"bot-social-link-"+m,required:""},null,40,Da),[[p,t.botForm.social_links[m].title]])])]),e("div",Ra,[e("div",La,[c(e("input",{type:"text",class:"form-control",placeholder:"Ссылка на соц.сеть","aria-label":"Ссылка на соц.сеть",maxlength:"255",onInvalid:o[57]||(o[57]=_=>t.alert("Вы не ввели ссылку на соц. сеть!",4)),"onUpdate:modelValue":_=>t.botForm.social_links[m].url=_,"aria-describedby":"bot-social-link-"+m,required:""},null,40,xa),[[p,t.botForm.social_links[m].url]])])]),e("div",Ma,[e("button",{type:"button",onClick:_=>t.removeItem("social_links",m),class:"btn btn-outline-danger w-100"},za,8,Aa)])]))),128)),e("div",Ka,[e("div",Na,[e("button",{type:"button",onClick:o[58]||(o[58]=n=>t.addSocialLinks()),class:"btn btn-outline-success w-100"},"Добавить еще ссылку ")])])])])])],512),[[O,t.tab===4&&t.botForm.bot_token]]),e("div",Ya,[e("div",Ja,[t.messages.length>0?(l(!0),i(f,{key:0},$(t.messages,(n,m)=>(l(),i("div",Wa,[Ha,u(" "+h(n||"Ошибка")+" ",1),e("button",{type:"button",class:"btn-close",onClick:_=>t.removeMessage(m)},null,8,Ga)]))),256)):r("",!0)]),e("div",Qa,[e("button",{type:"submit",disabled:!t.botForm.bot_token,title:"Сохранение бота",class:"btn btn-primary min-menu-btn w-100"},[s.bot?(l(),i("span",ed,"Обновить бота")):(l(),i("span",Za,"Добавить бота"))],8,Xa)])])],32)}}});const sd={class:"row"},od={class:"input-group mb-3"},ld={class:"row"},id={class:"col-12"},nd={class:"form-check"},ad=e("label",{class:"form-check-label",for:"needDeleted"},"Отобразить удаленные",-1),dd={key:0,class:"row"},rd={key:0,class:"col-12"},cd={class:"col-12 mb-3"},ud={class:"list-group w-100"},_d={class:"d-flex justify-content-between"},hd=["onClick"],md={key:0},pd={key:1},bd={key:2},gd=e("i",{class:"fa-solid fa-lock"},null,-1),fd=[gd],vd={key:0},yd={class:"dropdown"},$d=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),kd={class:"dropdown-menu"},Fd={key:0},Cd=["onClick"],wd=e("i",{class:"fa-solid fa-copy mr-1"},null,-1),jd={key:1},Sd=["onClick"],Vd=e("i",{class:"fa-solid fa-ban mr-1"},null,-1),Pd=["onClick"],Ud=e("i",{class:"fa-solid fa-copy mr-1"},null,-1),Bd={key:2},Od=["onClick"],Td=e("i",{class:"fa-solid fa-trash mr-1"},null,-1),Id={key:0,class:"component-icons"},qd={key:0},Dd=e("i",{class:"fa-regular fa-images"},null,-1),Rd=[Dd],Ld={key:1},xd=e("i",{class:"fa-regular fa-note-sticky"},null,-1),Md=[xd],Ad={key:2},Ed=e("i",{class:"fa-solid fa-photo-film"},null,-1),zd=[Ed],Kd={key:3},Nd=e("i",{class:"fa-regular fa-file-audio"},null,-1),Yd=[Nd],Jd={key:4},Wd=e("i",{class:"fa-regular fa-file-word"},null,-1),Hd=[Wd],Gd={key:5},Qd=e("i",{class:"fa-solid fa-link"},null,-1),Xd=[Qd],Zd={key:6},er=e("i",{class:"fa-solid fa-scroll"},null,-1),tr=[er],sr={key:7},or=e("i",{class:"fa-regular fa-comment-dots"},null,-1),lr=[or],ir={key:8},nr=e("i",{class:"fa-solid fa-scale-balanced"},null,-1),ar=[nr],dr={key:9},rr=e("i",{class:"fa-regular fa-keyboard"},null,-1),cr=[rr],ur={key:10},_r=e("i",{class:"fa-solid fa-ellipsis"},null,-1),hr=[_r],mr={class:"col-12"},pr={key:1,class:"row"},br=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," Созданных страниц не найдено! ")],-1),gr=[br],fr={props:["editor","current"],data(){return{bot:null,current_page:0,need_deleted:!1,loading:!0,pages:[],search:null,pages_paginate_object:null,need_new_page:!1}},watch:{need_deleted:function(s,t){this.nextPages(0)},getPages:function(s,t){this.$nextTick(()=>{this.search||(this.pages=this.getPages)})},search:function(s,t){this.nextPages(0)}},computed:{...w(["getPages","getCurrentBot","getPagesPaginateObject"])},mounted(){this.loadCurrentBot().then(()=>{this.current_page=localStorage.getItem(`cashman_pagelist_${this.bot.id}_page_index`)||0,this.loadPages()})},methods:{loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},selectPage(s){this.$emit("callback",s),this.$notify("Вы выбрали страницу из списка! Все остальные действия будут производится для этой страницы")},nextPages(s){this.current_page=s,localStorage.setItem(`cashman_pagelist_${this.bot.id}_page_index`,this.current_page),this.loadPages()},duplicatePage(s){this.loading=!0,this.$store.dispatch("duplicatePage",{dataObject:{pageId:s}}).then(t=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},forceRemovePage(s){this.loading=!0,this.$store.dispatch("forceRemovePage",{dataObject:{pageId:s}}).then(t=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},restorePage(s){this.loading=!0,this.$store.dispatch("restorePage",{dataObject:{pageId:s}}).then(t=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},removePage(s){this.loading=!0,this.$store.dispatch("removePage",{dataObject:{pageId:s}}).then(t=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},loadPages(){this.loading=!0,this.$store.dispatch("loadPages",{dataObject:{botId:this.bot.id||null,search:this.search||null,needDeleted:this.need_deleted},page:this.current_page||0}).then(s=>{this.loading=!1,this.pages=this.getPages,this.pages_paginate_object=this.getPagesPaginateObject,this.pages.length===0&&localStorage.setItem(`cashman_pagelist_${this.bot.id}_page_index`,0)}).catch(()=>{this.loading=!1})}}},R=Object.assign(fr,{__name:"PagesList",setup(s){return(t,o)=>(l(),i(f,null,[e("div",sd,[e("div",od,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск страницы","aria-label":"Поиск бота","onUpdate:modelValue":o[0]||(o[0]=a=>t.search=a),"aria-describedby":"button-addon2"},null,512),[[p,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=(...a)=>t.loadPages&&t.loadPages(...a)),type:"button",id:"button-addon2"},"Найти ")])]),e("div",ld,[e("div",id,[e("div",nd,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[2]||(o[2]=a=>t.need_deleted=a),type:"checkbox",id:"needDeleted"},null,512),[[k,t.need_deleted]]),ad])])]),t.pages.length>0?(l(),i("div",dd,[t.pages.length>7?(l(),i("div",rd,[t.pages_paginate_object?(l(),F(S,{key:0,onPagination_page:t.nextPages,pagination:t.pages_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])):r("",!0),e("div",cd,[e("ul",ud,[(l(!0),i(f,null,$(t.pages,(a,d)=>(l(),i("li",{class:b(["list-group-item cursor-pointer page-menu-item btn btn-outline-info mb-1",{"border border-warning":a.deleted_at!=null}])},[e("div",_d,[e("strong",{onClick:n=>t.selectPage(a)},[u("#"+h(a.id||"Не указано")+" ",1),a.slug?(l(),i("span",md,h(a.slug.command||"Не указано"),1)):(l(),i("span",pd,"Не привязано к команде")),s.current&&s.current==a.id?(l(),i("span",bd,fd)):r("",!0)],8,hd),s.editor?(l(),i("div",vd,[e("div",yd,[$d,e("ul",kd,[a.deleted_at!=null?(l(),i("li",Fd,[e("a",{class:"dropdown-item",onClick:n=>t.restorePage(a.id)},[wd,u("Восстановить")],8,Cd)])):r("",!0),a.deleted_at!=null?(l(),i("li",jd,[e("a",{class:"dropdown-item",onClick:n=>t.forceRemovePage(a.id)},[Vd,u("Удалить полностью")],8,Sd)])):r("",!0),e("li",null,[e("a",{class:"dropdown-item",onClick:n=>t.duplicatePage(a.id)},[Ud,u("Дублировать")],8,Pd)]),a.deleted_at==null?(l(),i("li",Bd,[e("a",{class:"dropdown-item",onClick:n=>t.removePage(a.id)},[Td,u("Удалить")],8,Od)])):r("",!0)])])])):r("",!0)]),a?(l(),i("ul",Id,[(a.images||[]).length>0?(l(),i("li",qd,Rd)):r("",!0),a.sticker?(l(),i("li",Ld,Md)):r("",!0),(a.videos||[]).length>0?(l(),i("li",Ad,zd)):r("",!0),(a.audios||[]).length>0?(l(),i("li",Kd,Yd)):r("",!0),(a.documents||[]).length>0?(l(),i("li",Jd,Hd)):r("",!0),a.next_page_id?(l(),i("li",Gd,Xd)):r("",!0),a.next_bot_menu_slug_id?(l(),i("li",Zd,tr)):r("",!0),a.next_bot_dialog_command_id?(l(),i("li",sr,lr)):r("",!0),a.rules_if?(l(),i("li",ir,ar)):r("",!0),a.reply_keyboard_id?(l(),i("li",dr,cr)):r("",!0),a.inline_keyboard_id?(l(),i("li",ur,hr)):r("",!0)])):r("",!0)],2))),256))])]),e("div",mr,[t.pages_paginate_object?(l(),F(S,{key:0,onPagination_page:t.nextPages,pagination:t.pages_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",pr,gr))],64))}}),vr={class:"row"},yr={class:"col-12"},$r={class:"card-body"},kr=e("h6",null,"Добавление нового скрипта в бота",-1),Fr={key:0,class:"row"},Cr={class:"col-md-4 mb-2"},wr={key:1,class:"row"},jr=e("div",{class:"col-12"},[e("div",{class:"alert alert-danger",role:"alert"},' У Вас еще нет добавленных скриптов! Воспользуйтесь разделом "Скрипты" для добавления. ')],-1),Sr=[jr],Vr={props:["bot","global"],data(){return{load:!1,search:null,slugs:[],paginate:[]}},computed:{...w(["getSlugs","getSlugsPaginateObject"]),filteredSlugs(){return this.slugs?this.slugs.length===0?[]:this.search==null?this.slugs:this.slugs.filter(s=>{let t=s.slug||"",o=s.command||"",a=s.comment||"";return o.toLowerCase().indexOf(this.search.toLowerCase())!==-1||a.toLowerCase().indexOf(this.search.toLowerCase())!==-1||t.toLowerCase().indexOf(this.search.toLowerCase())!==-1}):[]}},mounted(){this.loadSlugs()},methods:{nextSlugs(s){this.loadSlugs(s)},selectSlug(s){this.$emit("callback",{id:s.id||null,slug:s.slug,comment:s.comment,command:s.command}),this.$notify("Вы выбрали скрипт из списка!")},loadSlugs(s=0){this.$store.dispatch("loadSlugs",{dataObject:{botId:this.bot.id,search:this.search,needGlobal:this.global},page:s}).then(t=>{this.slugs=this.getSlugs,this.paginate=this.getSlugsPaginateObject})},callbackSlugs(){}}},Pr=Object.assign(Vr,{__name:"BotSlugListSimple",setup(s){return(t,o)=>(l(),i("div",vr,[e("div",yr,[e("div",$r,[kr,e("div",null,[c(e("input",{type:"text",class:"form-control mt-1 mb-1","onUpdate:modelValue":o[0]||(o[0]=a=>t.search=a),onKeyup:o[1]||(o[1]=(...a)=>t.loadSlugs&&t.loadSlugs(...a)),placeholder:"Поиск нужного скрипта по описанию"},null,544),[[p,t.search]])]),t.slugs.length>0?(l(),i("div",Fr,[(l(!0),i(f,null,$(t.slugs,(a,d)=>(l(),i("div",Cr,[v(Qe,{item:a,bot:s.bot,onCallback:t.callbackSlugs,onSelect:t.selectSlug},null,8,["item","bot","onCallback","onSelect"])]))),256)),t.paginate?(l(),F(S,{key:0,onPagination_page:t.nextSlugs,pagination:t.paginate},null,8,["onPagination_page","pagination"])):r("",!0)])):(l(),i("div",wr,Sr))])])]))}});const Ur={props:["param"],data(){return{expressions:[{expression:null,description:"Нет проверки"},{expression:"/([a-z0-9]+)/i",description:"Проверка набора из латинских букв и цифр"},{expression:"/([а-яё0-9]+)/iu",description:"Проверка на кириллицу и цифры"},{expression:"/(?P<digit>\\d+)/",description:"Проверка на число"},{expression:"/^([a-z0-9_-]+.)*[a-z0-9_-]+@[a-z0-9_-]+(.[a-z0-9_-]+)*.[a-z]{2,6}$/",description:"Проверка Email"},{expression:"/^((8|+7)[- ]?)?((?d{3})?[- ]?)?[d- ]{7,10}$/",description:"Проверка номера телефона: +7(982)000-00-00"},{expression:"/^(0[1-9]|[12][0-9]|3[01])[.](0[1-9]|1[012])[.](19|20)dd$/",description:"Проверка даты по формату DD.MM.YYYY"},{expression:"/^[0-9]{4}-(0[1-9]|1[012])-(0[1-9]|1[0-9]|2[0-9]|3[01])$/",description:"Проверка даты по формату YYYY-MM-DD"},{expression:"/^(https?://)?([da-z.-]+).([a-z.]{2,6})([/w .-]*)*/?$/",description:"Проверка доменного имени"}]}},methods:{expressionsSelect(s){this.$emit("callback",{param:this.param,text:s.expression})}}},Br={class:"dropdown"},Or=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-regular fa-registered"})],-1),Tr={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},Ir=["onClick"];function qr(s,t,o,a,d,n){return l(),i("div",Br,[Or,e("div",Tr,[e("li",null,[(l(!0),i(f,null,$(d.expressions,m=>(l(),i("a",{class:"dropdown-item",onClick:_=>n.expressionsSelect(m)},h(m.description||"-"),9,Ir))),256))])])])}const Dr=P(Ur,[["render",qr]]),Rr={key:0,class:"mb-2 d-flex justify-content-start flex-wrap"},Lr=e("p",null,"Связь цепочек: ",-1),xr=["onClick"],Mr={key:0,class:"fa-solid fa-arrow-right font-12"},Ar={class:"form-floating mb-2"},Er=["id"],zr=["for"],Kr={class:"form-check mb-2"},Nr=e("label",{class:"form-check-label",for:"need-empty-dialog"}," Диалог без ожидания ответа ",-1),Yr={key:1,class:"form-floating mb-2"},Jr=["id"],Wr=["for"],Hr={key:2,class:"form-floating mb-2"},Gr=["id"],Qr=["for"],Xr={key:3,class:"mb-2"},Zr={class:"d-flex justify-content-between"},ec=["for"],tc=["id"],sc={class:"mb-2"},oc={class:"d-flex justify-content-between"},lc=["for"],ic=["id"],nc={class:"mb-2"},ac={class:"form-check"},dc=e("label",{class:"form-check-label",for:"need-dialog-image"}," В диалоге нужно изображение ",-1),rc={class:"form-check"},cc=e("label",{class:"form-check-label",for:"need-dialog-menu-inline"}," В диалоге нужно меню тексту ",-1),uc={class:"form-check"},_c=e("label",{class:"form-check-label",for:"need-dialog-menu-reply"}," В диалоге нужно нижнее меню ",-1),hc={key:4,class:"card mb-2"},mc={class:"card-body"},pc=e("h6",null,"Фотографии к диалогу",-1),bc={class:"photo-preview d-flex justify-content-start flex-wrap w-100"},gc={for:"location-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},fc=e("span",null,"+",-1),vc={class:"mb-2 img-preview",style:{"margin-right":"10px"}},yc={class:"remove"},$c=["onClick"],kc={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Fc={class:"remove"},Cc=["onClick"],wc={key:5,class:"card mb-2"},jc=e("div",{class:"card-header"},[e("h6",null,"Кнопки к тексту вопроса")],-1),Sc={class:"card-body"},Vc={key:6,class:"card mb-2"},Pc=e("div",{class:"card-header"},[e("h6",null,"Кнопки в виде нижнего меню")],-1),Uc={class:"card-body"},Bc={class:"mb-2"},Oc=e("label",{class:"form-check-label",for:"need-empty-dialog"}," Сохранить в переменную ",-1),Tc=e("option",{selected:""},"Не выбрано",-1),Ic=["value"],qc={class:"form-check mb-2"},Dc=e("label",{class:"form-check-label",for:"need-set-flags"}," Установить флаги в соответствующее значение ",-1),Rc={key:7,class:"mb-2"},Lc=e("p",null,"Выбрать флаги",-1),xc=["onClick"],Mc={key:8,class:"mb-2"},Ac={key:0,class:"row"},Ec=e("div",{class:"col-12"},[e("p",null,"Доступные для связывания диалоги:")],-1),zc={class:"col-md-12 mb-1"},Kc={type:"button",class:"btn btn-outline-primary w-100 d-flex justify-content-between align-items-center",style:{"text-align":"left"}},Nc=["onClick"],Yc={key:0,class:"fa-solid fa-link mr-2 text-success"},Jc={key:1,class:"row"},Wc=e("div",{class:"col-12"},[e("div",{class:"alert alert-danger",role:"alert"}," Диалогов для связывания нет ")],-1),Hc=[Wc],Gc=e("hr",null,null,-1),Qc={class:"mb-2"},Xc={type:"submit",class:"btn btn-outline-success p-3 w-100"},Zc={key:0},eu={key:1},tu={props:["item","bot"],data(){return{loading:!0,dialog_commands:[],dialog_commands_paginate_object:null,need_images:!1,need_inline_keyboard:!1,need_reply_keyboard:!1,need_set_flags:!1,flags_variants:[{title:"Является VIP",key:"is_vip",value:null},{title:"Является Админом",key:"is_admin",value:null},{title:"За работой",key:"is_work",value:null},{title:"Является менеджером",key:"is_manager",value:null}],store_variants:[{title:"Имя",key:"name"},{title:"Почта",key:"email"},{title:"Возраст",key:"age"},{title:"Город",key:"city"},{title:"Страна",key:"country"},{title:"Адрес",key:"address"},{title:"Телефон",key:"phone"},{title:"День рождение",key:"birthday"}],commandForm:{id:null,slug:null,pre_text:null,post_text:null,error_text:null,bot_id:null,input_pattern:null,inline_keyboard_id:null,reply_keyboard_id:null,images:null,next_bot_dialog_command_id:null,bot_dialog_group_id:null,is_empty:!1,result_flags:[],store_to:null,result_channel:null,inline_keyboard:null,reply_keyboard:null},photos:[]}},computed:{...w(["getDialogCommands","getDialogCommandsPaginateObject"]),filteredCommands(){return this.dialog_commands?this.dialog_commands.filter(s=>s.id!=this.commandForm.id):[]}},mounted(){this.item&&this.$nextTick(()=>{this.commandForm={id:this.item.id||null,slug:this.item.slug||null,pre_text:this.item.pre_text||null,post_text:this.item.post_text||null,error_text:this.item.error_text||null,is_empty:this.item.is_empty||!1,input_pattern:this.item.input_pattern||null,inline_keyboard_id:this.item.inline_keyboard_id||null,reply_keyboard_id:this.item.reply_keyboard_id||null,images:this.item.images||[],next_bot_dialog_command_id:this.item.next_bot_dialog_command_id||null,bot_dialog_group_id:this.item.bot_dialog_group_id||null,result_channel:this.item.result_channel||null,inline_keyboard:this.item.inline_keyboard||null,reply_keyboard:this.item.reply_keyboard||null,result_flags:this.item.result_flags||[],store_to:this.item.store_to||null},this.bot&&(this.commandForm.bot_id=this.bot.id||null),this.commandForm.inline_keyboard_id!=null&&(this.need_inline_keyboard=!0),this.commandForm.reply_keyboard_id!=null&&(this.need_reply_keyboard=!0),this.commandForm.images.length>0&&(this.need_images=!0),this.commandForm.result_flags.length>0&&(this.need_set_flags=!0)}),this.bot&&this.$nextTick(()=>{this.commandForm.bot_id=this.bot.id}),this.item&&(this.dialog_commands=this.getDialogCommands,this.dialog_commands_paginate_object=this.getDialogCommandsPaginateObject)},methods:{nextDialogs(s){this.loadDialogs(s)},loadDialogs(s=0){this.loading=!0,this.$store.dispatch("loadDialogCommands",{dataObject:{botId:this.bot.id||null,search:this.search},page:s}).then(t=>{this.loading=!1,this.dialog_commands=this.getDialogCommands,this.dialog_commands_paginate_object=this.getDialogCommandsPaginateObject}).catch(()=>{this.loading=!1})},doCommandLink(s){this.loading=!0,this.commandForm.next_bot_dialog_command_id=s},submit(){this.loading=!0;let s=new FormData;if(Object.keys(this.commandForm).forEach(t=>{const o=this.commandForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.photos){for(let t=0;t<this.photos.length;t++)s.append("files[]",this.photos[t]);s.delete("photos")}this.$store.dispatch(this.commandForm.id?"updateDialogCommand":"createDialogCommand",{dialogCommandForm:s}).then(t=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Успешная обработка диалоговой команды",type:"success"}),this.commandForm.id==null&&(this.commandForm={id:null,slug:null,pre_text:null,post_text:null,error_text:null,input_pattern:null,inline_keyboard_id:null,images:null,next_bot_dialog_command_id:null,bot_dialog_group_id:null,result_channel:null,inline_keyboard:null,is_empty:!1,result_flags:[],store_to:null},this.photos=[]),this.$emit("callback")}).catch(t=>{this.loading=!1})},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removePhoto(s,t){this[s].splice(t,1)},onChangePhotos(s){const t=s.target.files;for(let o=0;o<t.length;o++)this.photos.push(t[o])},saveInlineKeyboard(s){this.commandForm.inline_keyboard=s},saveReplyKeyboard(s){this.commandForm.reply_keyboard=s},addTextTo(s={param:null,text:null}){this.commandForm[s.param]=s.text},selectElementById(s){this.$emit("select-element",s)},selectFlag(s){(!this.commandForm.result_flags||!Array.isArray(this.commandForm.result_flags))&&(this.commandForm.result_flags=[]);let t=this.commandForm.result_flags.indexOf(s.key);t===-1?this.commandForm.result_flags.push(s.key):this.commandForm.result_flags.splice(t,1)}}},su=Object.assign(tu,{__name:"BotDialogCommandForm",setup(s){return(t,o)=>{const a=q("lazy");return l(),i("form",{onSubmit:o[13]||(o[13]=j((...d)=>t.submit&&t.submit(...d),["prevent"]))},[t.commandForm.next_bot_dialog_command_id?(l(),i("div",Rr,[Lr,(l(!0),i(f,null,$(s.item.chain,(d,n)=>(l(),i("div",null,[e("span",{class:b(["badge cursor-pointer",{"bg-success":t.commandForm.id==d,"bg-primary":t.commandForm.id!=d}]),onClick:m=>t.selectElementById(d)},h(d),11,xr),n<s.item.chain.length-1?(l(),i("i",Mr)):r("",!0)]))),256))])):r("",!0),e("div",Ar,[c(e("input",{type:"text",class:"form-control",id:"commandForm-pre-text-"+t.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":o[0]||(o[0]=d=>t.commandForm.pre_text=d),required:""},null,8,Er),[[p,t.commandForm.pre_text]]),e("label",{for:"commandForm-pre-text-"+t.commandForm.id},"Текст диалога",8,zr)]),e("div",Kr,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[1]||(o[1]=d=>t.commandForm.is_empty=d),id:"need-empty-dialog",checked:""},null,512),[[k,t.commandForm.is_empty]]),Nr]),t.commandForm.is_empty?r("",!0):(l(),i("div",Yr,[c(e("input",{type:"text",class:"form-control",id:"commandForm-post-text-"+t.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":o[2]||(o[2]=d=>t.commandForm.post_text=d),required:""},null,8,Jr),[[p,t.commandForm.post_text]]),e("label",{for:"commandForm-post-text-"+t.commandForm.id},"Текст после успешного завершения диалога",8,Wr)])),t.commandForm.is_empty?r("",!0):(l(),i("div",Hr,[c(e("input",{type:"text",class:"form-control",id:"commandForm-error-text-"+t.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":o[3]||(o[3]=d=>t.commandForm.error_text=d),required:""},null,8,Gr),[[p,t.commandForm.error_text]]),e("label",{for:"commandForm-error-text-"+t.commandForm.id},"Текст на случай ошибки корректности данных",8,Qr)])),t.commandForm.is_empty?r("",!0):(l(),i("div",Xr,[e("div",Zr,[e("label",{class:"form-label",for:"commandForm-result-channel-"+t.commandForm.id},"Регулярное выражение для валидации данных ",8,ec),v(Dr,{param:"input_pattern",onCallback:t.addTextTo},null,8,["onCallback"])]),c(e("input",{type:"text",class:"form-control",placeholder:"Регулярное выражение","aria-label":"Регулярное выражение","onUpdate:modelValue":o[4]||(o[4]=d=>t.commandForm.input_pattern=d),maxlength:"255",id:"commandForm-input-pattern-"+t.commandForm.id,"aria-describedby":"commandForm-input-pattern"},null,8,tc),[[p,t.commandForm.input_pattern]])])),e("div",sc,[e("div",oc,[e("label",{class:"form-label",for:"commandForm-result-channel-"+t.commandForm.id},"Канал для отправки данных ",8,lc),s.bot?(l(),F(T,{key:0,token:s.bot.bot_token,param:"result_channel",onCallback:t.addTextTo},null,8,["token","onCallback"])):r("",!0)]),c(e("input",{type:"number",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":o[5]||(o[5]=d=>t.commandForm.result_channel=d),id:"commandForm-result-channel-"+t.commandForm.id,"aria-describedby":"bot-order-channel"},null,8,ic),[[p,t.commandForm.result_channel]])]),e("div",nc,[e("div",ac,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[6]||(o[6]=d=>t.need_images=d),id:"need-dialog-image",checked:""},null,512),[[k,t.need_images]]),dc]),e("div",rc,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[7]||(o[7]=d=>t.need_inline_keyboard=d),id:"need-dialog-menu-inline",checked:""},null,512),[[k,t.need_inline_keyboard]]),cc]),e("div",uc,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[8]||(o[8]=d=>t.need_reply_keyboard=d),id:"need-dialog-menu-reply",checked:""},null,512),[[k,t.need_reply_keyboard]]),_c])]),t.need_images?(l(),i("div",hc,[e("div",mc,[pc,e("div",bc,[e("label",gc,[fc,e("input",{type:"file",id:"location-photos",multiple:"",accept:"image/*",onChange:o[9]||(o[9]=(...d)=>t.onChangePhotos&&t.onChangePhotos(...d)),style:{display:"none"}},null,32)]),t.photos.length>0?(l(!0),i(f,{key:0},$(t.photos,(d,n)=>(l(),i("div",vc,[c(e("img",null,null,512),[[a,t.getPhoto(d).imageUrl]]),e("div",yc,[e("a",{onClick:m=>t.removePhoto("photos",n)},"Удалить",8,$c)])]))),256)):r("",!0),t.commandForm.images&&s.bot?(l(!0),i(f,{key:1},$(t.commandForm.images,(d,n)=>(l(),i("div",kc,[c(e("img",null,null,512),[[a,"/images-by-bot-id/"+s.bot.id+"/"+d]]),e("div",Fc,[e("a",{onClick:m=>t.removePhoto("images",n)},"Удалить",8,Cc)])]))),256)):r("",!0)])])])):r("",!0),t.need_inline_keyboard?(l(),i("div",wc,[jc,e("div",Sc,[v(I,{onSave:t.saveInlineKeyboard,"edited-keyboard":t.commandForm.inline_keyboard},null,8,["onSave","edited-keyboard"])])])):r("",!0),t.need_reply_keyboard?(l(),i("div",Vc,[Pc,e("div",Uc,[v(I,{onSave:t.saveReplyKeyboard,"edited-keyboard":t.commandForm.reply_keyboard},null,8,["onSave","edited-keyboard"])])])):r("",!0),e("div",Bc,[Oc,c(e("select",{class:"form-control","onUpdate:modelValue":o[10]||(o[10]=d=>t.commandForm.store_to=d)},[Tc,(l(!0),i(f,null,$(t.store_variants,d=>(l(),i("option",{value:d.key},h(d.title||"Не указано"),9,Ic))),256))],512),[[V,t.commandForm.store_to]])]),e("div",qc,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[11]||(o[11]=d=>t.need_set_flags=d),id:"need-set-flags",checked:""},null,512),[[k,t.need_set_flags]]),Dc]),t.need_set_flags?(l(),i("div",Rc,[Lc,(l(!0),i(f,null,$(t.flags_variants,d=>(l(),i("span",{class:b(["badge text-info mr-2",{"bg-info text-white":t.commandForm.result_flags.indexOf(d.key)!=-1}]),onClick:n=>t.selectFlag(d)},h(d.title),11,xc))),256))])):r("",!0),t.commandForm.id?(l(),i("div",Mc,[t.filteredCommands.length>0?(l(),i("div",Ac,[Ec,(l(!0),i(f,null,$(t.filteredCommands,(d,n)=>(l(),i("div",zc,[e("button",Kc,[e("span",{onClick:m=>t.doCommandLink(d.id)},[t.commandForm.next_bot_dialog_command_id==d.id?(l(),i("i",Yc)):r("",!0),u(" #"+h(d.id)+" "+h(d.pre_text||"Без текста"),1)],8,Nc),t.commandForm.next_bot_dialog_command_id==d.id?(l(),i("i",{key:0,class:"fa-solid fa-unlink text-danger",onClick:o[12]||(o[12]=m=>t.doCommandLink(null))})):r("",!0)])]))),256)),t.dialog_commands_paginate_object?(l(),F(S,{key:0,onPagination_page:t.nextDialogs,pagination:t.dialog_commands_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])):(l(),i("div",Jc,Hc))])):r("",!0),Gc,e("div",Qc,[e("button",Xc,[t.commandForm.id?(l(),i("span",Zc,"Обновить диалог")):(l(),i("span",eu,"Добавить диалог"))])])],32)}}});const ou={class:"row"},lu={class:"col-md-2 col-12"},iu=e("i",{class:"fa-regular fa-comment-dots",style:{"margin-right":"10px"}},null,-1),nu={class:"col-md-10 col-12"},au={class:"input-group mb-3"},du={key:0,class:"row"},ru={class:"col-md-12"},cu={class:"table"},uu=e("thead",null,[e("tr",null,[e("th",{class:"text-center",scope:"col"},"#"),e("th",{class:"text-center",scope:"col"},"Текст диалога"),e("th",{class:"text-center",scope:"col"},"Цепочки"),e("th",{class:"text-center",scope:"col"},"Текст успеха"),e("th",{class:"text-center",scope:"col"},"Текст ошибки"),e("th",{class:"text-center",scope:"col"},"Канал результата"),e("th",{class:"text-center",scope:"col"},"Флаги"),e("th",{class:"text-center",scope:"col"},"Сохранить в"),e("th",{class:"text-center",scope:"col"},"Есть изображения"),e("th",{class:"text-center",scope:"col"},"Есть паттерны"),e("th",{class:"text-center",scope:"col"},"Пустой"),e("th",{class:"text-center",scope:"col"},"Есть кнопки"),e("th",{class:"text-center",scope:"col"},"Есть меню"),e("th",{class:"text-center",scope:"col"},"Команды")])],-1),_u={scope:"row"},hu={class:"text-center"},mu=["onClick"],pu={class:"text-center"},bu={key:0,class:"badge bg-primary"},gu={key:1},fu=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),vu=[fu],yu={class:"text-center"},$u={key:0},ku={key:1},Fu=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Cu=[Fu],wu={class:"text-center"},ju={key:0},Su={key:1},Vu=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Pu=[Vu],Uu={class:"text-center"},Bu={key:0},Ou={key:1},Tu=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Iu=[Tu],qu={class:"text-center"},Du={key:0},Ru={class:"badge bg-primary"},Lu={key:1},xu=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Mu=[xu],Au={class:"text-center"},Eu={key:0},zu={key:1},Ku=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Nu=[Ku],Yu={class:"text-center"},Ju={key:0,class:"fa-solid fa-check text-success"},Wu={key:1,class:"fa-solid fa-xmark text-danger"},Hu={class:"text-center"},Gu={key:0},Qu={key:1},Xu=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Zu=[Xu],e_={class:"text-center"},t_={key:0,class:"fa-solid fa-check text-success"},s_={key:1,class:"fa-solid fa-xmark text-danger"},o_={class:"text-center"},l_={key:0,class:"fa-solid fa-check text-success"},i_={key:1,class:"fa-solid fa-xmark text-danger"},n_={class:"text-center"},a_={key:0,class:"fa-solid fa-check text-success"},d_={key:1,class:"fa-solid fa-xmark text-danger"},r_={class:"text-center"},c_={class:"dropdown"},u_=["disabled"],__=e("i",{class:"fa-solid fa-ellipsis"},null,-1),h_=[__],m_={class:"dropdown-menu"},p_=["onClick"],b_=e("i",{class:"fa-solid fa-arrow-left mr-1"},null,-1),g_=e("hr",null,null,-1),f_=["onClick"],v_=e("i",{class:"fa-solid fa-clone mr-1"},null,-1),y_=["onClick"],$_=e("i",{class:"fa-solid fa-trash-can mr-1"},null,-1),k_={key:1,class:"row"},F_=e("div",{class:"col-12"},[e("div",{class:"alert alert-danger",role:"alert"}," Не найдено ни одного диалога! ")],-1),C_=[F_],w_={class:"modal fade",id:"dialog-command-modal-editor",tabindex:"-1"},j_={class:"modal-dialog modal-fullscreen"},S_={class:"modal-content"},V_=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"}," Создание диалогового сообщения "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),P_={class:"modal-body"},U_=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),B_={data(){return{bot:null,selected:null,loading:!0,dialog_commands:[],search:null,dialog_commands_paginate_object:null}},computed:{...w(["getDialogCommands","getCurrentBot","getDialogCommandsPaginateObject"])},mounted(){this.loadCurrentBot().then(()=>{this.loadDialogs()})},methods:{openEditor(s){this.loading=!0,this.$nextTick(()=>{this.selected=s,this.loading=!1})},removeCommand(s){this.loading=!0,this.$store.dispatch("removeDialogCommand",{dataObject:{dialogCommandId:s}}).then(t=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Диалоговая команда успешно удалена!",type:"success"}),this.loadDialogs(),this.$emit("callback")}).catch(t=>{this.loading=!1})},duplicate(s){this.loading=!0,this.$store.dispatch("duplicateDialogCommand",{dataObject:{dialogCommandId:s}}).then(t=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Диалоговая команда успешно продублирована!",type:"success"}),this.loadDialogs(),this.$emit("callback")}).catch(t=>{this.loading=!1})},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},selectDialog(s){this.$emit("select-dialog",s),this.$notify("Вы выбрали диалог из списка!")},nextDialogs(s){this.loadDialogs(s)},selectElement(s){this.loading=!0,this.$nextTick(()=>{this.selected=this.dialog_commands.find(t=>t.id===s)||null,this.loading=!1})},loadDialogs(s=0){this.$store.dispatch("loadDialogCommands",{dataObject:{botId:this.bot.id||null,search:this.search},page:s}).then(t=>{const o=this.selected;this.dialog_commands=this.getDialogCommands,this.dialog_commands_paginate_object=this.getDialogCommandsPaginateObject,this.loading=!0,this.$nextTick(()=>{o&&(this.selected=this.dialog_commands.find(a=>a.id===o.id)||null),this.loading=!1})}).catch(()=>{this.loading=!1})}}},O_=Object.assign(B_,{__name:"BotDialogGroupList",setup(s){return(t,o)=>(l(),i(f,null,[e("div",ou,[e("div",lu,[e("button",{type:"button",onClick:o[0]||(o[0]=a=>t.openEditor(null)),"data-bs-toggle":"modal","data-bs-target":"#dialog-command-modal-editor",class:"btn btn-outline-success mb-2 w-100"},[iu,u("Новый диалог ")])]),e("div",nu,[e("div",au,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск диалога","aria-label":"Поиск диалога","onUpdate:modelValue":o[1]||(o[1]=a=>t.search=a),"aria-describedby":"button-addon2"},null,512),[[p,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[2]||(o[2]=a=>t.loadDialogs(0)),type:"button",id:"button-addon2"},"Найти ")])])]),t.dialog_commands.length>0?(l(),i("div",du,[e("div",ru,[e("table",cu,[uu,e("tbody",null,[(l(!0),i(f,null,$(t.dialog_commands,(a,d)=>(l(),i("tr",null,[e("th",_u,h(a.id),1),e("td",hu,[e("a",{"data-bs-toggle":"modal",onClick:n=>t.openEditor(a),"data-bs-target":"#dialog-command-modal-editor",href:"javascript:void(0)"},h(a.pre_text||"-"),9,mu)]),e("td",pu,[a.next_bot_dialog_command_id?(l(),i("span",bu,"#"+h(a.next_bot_dialog_command_id||"-")+" ("+h(a.chain.length||0)+")",1)):(l(),i("span",gu,vu))]),e("td",yu,[a.post_text?(l(),i("p",$u,h(a.post_text),1)):(l(),i("p",ku,Cu))]),e("td",wu,[a.error_text?(l(),i("p",ju,h(a.error_text),1)):(l(),i("p",Su,Pu))]),e("td",Uu,[a.result_channel?(l(),i("p",Bu,h(a.result_channel),1)):(l(),i("p",Ou,Iu))]),e("td",qu,[a.result_flags.length>0?(l(),i("p",Du,[(l(!0),i(f,null,$(a.result_flags,n=>(l(),i("span",Ru,h(n||"-"),1))),256))])):(l(),i("p",Lu,Mu))]),e("td",Au,[a.store_to?(l(),i("p",Eu,h(a.store_to),1)):(l(),i("p",zu,Nu))]),e("td",Yu,[a.images.length>0?(l(),i("i",Ju)):(l(),i("i",Wu))]),e("td",Hu,[a.input_pattern?(l(),i("p",Gu,h(a.input_pattern),1)):(l(),i("p",Qu,Zu))]),e("td",e_,[a.is_empty?(l(),i("i",t_)):(l(),i("i",s_))]),e("td",o_,[a.inline_keyboard_id!=null?(l(),i("i",l_)):(l(),i("i",i_))]),e("td",n_,[a.reply_keyboard_id!=null?(l(),i("i",a_)):(l(),i("i",d_))]),e("td",r_,[e("div",c_,[e("button",{disabled:t.loading,class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},h_,8,u_),e("ul",m_,[e("li",null,[e("a",{onClick:n=>t.selectDialog(a),title:"Выбрать диалог",class:"dropdown-item cursor-pointer"},[b_,u(" Выбрать диалог ")],8,p_)]),g_,e("li",null,[e("a",{title:"Дублирование команды",onClick:n=>t.duplicate(a.id),class:"dropdown-item cursor-pointer"},[v_,u(" Дублирование диалога ")],8,f_)]),e("li",null,[e("a",{onClick:n=>t.removeCommand(a.id),title:"Удаление команды",class:"dropdown-item cursor-pointer"},[$_,u(" Удаление диалога ")],8,y_)])])])])]))),256))])]),t.dialog_commands_paginate_object?(l(),F(S,{key:0,onPagination_page:t.nextDialogs,pagination:t.dialog_commands_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",k_,C_)),e("div",w_,[e("div",j_,[e("div",S_,[V_,e("div",P_,[t.bot&&!t.loading?(l(),F(su,{key:0,item:t.selected,onCallback:t.loadDialogs,onSelectElement:t.selectElement,bot:t.bot},null,8,["item","onCallback","onSelectElement","bot"])):r("",!0)]),U_])])])],64))}}),T_=e("div",{class:"alert alert-success",role:"alert"},' Проверка правил идет по методу "И" - все правила должны выполняться для перехода на данную страницу, иначе будет вызвана страница из блока "иначе". Действия для "иначе" добавлять не обязательно. ',-1),I_=e("h6",null,"Блок условий",-1),q_={key:0,class:"py-2"},D_={class:"form-label",id:"bot-domain"},R_=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),L_=e("div",null,"Напишите текст, который будет отображен пользователю вместе с основным контентом в случае если условие будет выполнено ",-1),x_={class:"dropdown mb-2"},M_=e("button",{class:"btn btn-outline-info dropdown-toggle w-100",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"}," Добавить условие ",-1),A_={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},E_=["onClick"],z_={key:1},K_={key:2,class:"list-group"},N_={key:0,class:"list-group-item d-flex justify-content-between align-items-center"},Y_={class:"form-check"},J_={class:"form-check-label",for:"bot-user-is-vip"},W_={key:0},H_={key:1},G_=e("i",{class:"fa-solid fa-trash-can"},null,-1),Q_=[G_],X_={key:1,class:"list-group-item d-flex justify-content-between align-items-center"},Z_={class:"form-check"},eh={class:"form-check-label",for:"bot-user-is-admin"},th={key:0},sh={key:1},oh=e("i",{class:"fa-solid fa-trash-can"},null,-1),lh=[oh],ih={key:2,class:"list-group-item d-flex justify-content-between align-items-center"},nh={class:"form-check"},ah={class:"form-check-label",for:"bot-user-is-deliveryman"},dh={key:0},rh={key:1},ch=e("i",{class:"fa-solid fa-trash-can"},null,-1),uh=[ch],_h={key:3,class:"list-group-item d-flex justify-content-between align-items-center"},hh={class:"form-check"},mh={class:"form-check-label",for:"bot-user-is-work"},ph={key:0},bh={key:1},gh=e("i",{class:"fa-solid fa-trash-can"},null,-1),fh=[gh],vh={key:4,class:"list-group-item d-flex justify-content-between align-items-center"},yh={class:"form-check"},$h={class:"form-check-label",for:"bot-user-in-location"},kh={key:0},Fh={key:1},Ch=e("i",{class:"fa-solid fa-trash-can"},null,-1),wh=[Ch],jh={key:5,class:"list-group-item d-flex justify-content-between align-items-center"},Sh=e("label",{class:"form-label",id:"bot-domain"}," Возраст от ",-1),Vh=e("i",{class:"fa-solid fa-trash-can"},null,-1),Ph=[Vh],Uh={key:6,class:"list-group-item d-flex justify-content-between align-items-center"},Bh=e("label",{class:"form-label",id:"bot-domain"}," Только для города ",-1),Oh=e("i",{class:"fa-solid fa-trash-can"},null,-1),Th=[Oh],Ih={key:7,class:"list-group-item d-flex justify-content-between align-items-center"},qh={class:"form-check"},Dh={class:"form-check-label",for:"bot-user-sex"},Rh={key:0},Lh={key:1},xh=e("i",{class:"fa-solid fa-trash-can"},null,-1),Mh=[xh],Ah={key:8,class:"list-group-item"},Eh={class:"mb-3"},zh={class:"d-flex justify-content-between align-items-center"},Kh={class:"form-label d-flex w-100 align-items-center",id:"bot-order-channel"},Nh=["onClick"],Yh=e("i",{class:"fa-solid fa-trash-can"},null,-1),Jh=[Yh],Wh=["onUpdate:modelValue"],Hh={key:3,class:"mt-5"},Gh={key:4,class:"d-flex justify-content-between"},Qh={key:6,class:"py-2"},Xh={class:"form-label",id:"bot-domain"},Zh=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),em=e("div",null,'Напишите текст, который будет отображен пользователю вместе с основным контентом в случае если условие не будет выполнено и будет вызван блок "иначе" ',-1),tm={props:["bot","rulesForm"],data(){return{rules:[{id:1,title:"Является администратором",rules_block:"bot_user",rule:{is_admin:!0}},{id:2,title:"Является VIP-пользователем",rules_block:"bot_user",rule:{is_vip:!0}},{id:3,title:"Находится в заведении",rules_block:"bot_user",rule:{user_in_location:!0}},{id:4,title:"За работой",rules_block:"bot_user",rule:{is_work:!0}},{id:5,title:"Возраст от ...",rules_block:"bot_user",rule:{age:18}},{id:6,title:"Находится в городе ...",rules_block:"bot_user",rule:{city:"Краснодар"}},{id:7,title:"Пол",rules_block:"bot_user",rule:{sex:!0}},{id:8,title:"Состоит в канале",rules_block:"channels",rule:{channel:1}},{id:9,title:"Является Менеджером",rules_block:"bot_user",rule:{is_manager:!0}}]}},computed:{rulesForCustomFields(){let s=this.rules.filter(t=>t.key!=null);return console.log("filtered rules",s),s}},mounted(){},methods:{hasRuleKey(s){return this.rulesForm.rules_if==null?!1:(console.log("key=>",s||"-"),Object.keys(this.rulesForm.rules_if.bot_user).find(t=>t===s)!=null)},modifyChannel(s){this.rulesForm.rules_if.channels[s.param]=s.text},removeChannelFromRule(s){this.rulesForm.rules_if.channels.splice(s,1)},removeRule(s){delete this.rulesForm.rules_if.bot_user[s]},addRules(s){this.rulesForm.rules_if||(this.rulesForm.rules_if={bot_user:{},channels:[]}),s.rules_block==="bot_user"&&(this.rulesForm.rules_if.bot_user={...this.rulesForm.rules_if.bot_user,...s.rule}),s.rules_block==="channels"&&this.rulesForm.rules_if.channels.push(s.rule.channel)},loadCurrentBotFields(){return this.$store.dispatch("loadCurrentBotFields",{bot_id:this.bot.id}).then(s=>{(s.data||[]).forEach(o=>{o.is_active&&(this.rules.push({id:this.rules.length+1,title:o.label,key:o.key,type:o.type,rules_block:"bot_user",rule:{}}),o.type===0&&(this.rules[this.rules.length-1].rule[o.key]=""),o.type===1&&(this.rules[this.rules.length-1].rule[o.key]=0),o.type===2&&(this.rules[this.rules.length-1].rule[o.key]=!0))}),console.log("new rules=>",this.rules)})},attachPageToRule(s){s.id!=this.rulesForm.id?this.rulesForm.rules_else_page_id=s.id:this.$notify({title:"Конструктор страниц",text:"Вы не можете связать данную страницу с собой",type:"error"})}}},sm=Object.assign(tm,{__name:"PageRules",setup(s){return(t,o)=>{const a=U("Popper");return l(),i(f,null,[T_,I_,s.rulesForm.rules_if?(l(),i("div",q_,[e("label",D_,[v(a,null,{content:g(()=>[L_]),default:g(()=>[R_]),_:1}),u(" Сообщение при успешном прохождении условий (не обязательно) ")]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст сообщения","aria-label":"Текст сообщения","onUpdate:modelValue":o[0]||(o[0]=d=>s.rulesForm.rules_if_message=d),maxlength:"255","aria-describedby":"rules-else-message"},`
            `,512),[[p,s.rulesForm.rules_if_message]])])):r("",!0),e("div",x_,[M_,e("ul",A_,[(l(!0),i(f,null,$(t.rules,d=>(l(),i("li",null,[e("a",{onClick:n=>t.addRules(d),class:"dropdown-item",href:"javascript:void(0)"},h(d.title||"Не указан"),9,E_)]))),256))])]),s.rulesForm.rules_if?(l(),i("h6",z_,"Выбранные условия")):r("",!0),s.rulesForm.rules_if?(l(),i("ul",K_,[t.hasRuleKey("is_vip")?(l(),i("li",N_,[e("div",Y_,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[1]||(o[1]=d=>s.rulesForm.rules_if.bot_user.is_vip=d),type:"checkbox",id:"bot-user-is-vip"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_vip]]),e("label",J_,[s.rulesForm.rules_if.bot_user.is_vip?(l(),i("span",W_,"Является VIP-пользователем")):(l(),i("span",H_,"Не является VIP-пользователем"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[2]||(o[2]=d=>t.removeRule("is_vip"))},Q_)])):r("",!0),t.hasRuleKey("is_admin")?(l(),i("li",X_,[e("div",Z_,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[3]||(o[3]=d=>s.rulesForm.rules_if.bot_user.is_admin=d),type:"checkbox",id:"bot-user-is-admin"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_admin]]),e("label",eh,[s.rulesForm.rules_if.bot_user.is_admin?(l(),i("span",th,"Является администратором")):(l(),i("span",sh,"Не является администратором"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[4]||(o[4]=d=>t.removeRule("is_admin"))},lh)])):r("",!0),t.hasRuleKey("is_deliveryman")?(l(),i("li",ih,[e("div",nh,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[5]||(o[5]=d=>s.rulesForm.rules_if.bot_user.is_deliveryman=d),type:"checkbox",id:"bot-user-is-deliveryman"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_deliveryman]]),e("label",ah,[s.rulesForm.rules_if.bot_user.is_deliveryman?(l(),i("span",dh,"Является доставщиком")):(l(),i("span",rh,"Не является доставщиком"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[6]||(o[6]=d=>t.removeRule("is_deliveryman"))},uh)])):r("",!0),t.hasRuleKey("is_work")?(l(),i("li",_h,[e("div",hh,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[7]||(o[7]=d=>s.rulesForm.rules_if.bot_user.is_work=d),type:"checkbox",id:"bot-user-is-work"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_work]]),e("label",mh,[s.rulesForm.rules_if.bot_user.is_work?(l(),i("span",ph,"За работой")):(l(),i("span",bh,"Не работает"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[8]||(o[8]=d=>t.removeRule("is_work"))},fh)])):r("",!0),t.hasRuleKey("user_in_location")?(l(),i("li",vh,[e("div",yh,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[9]||(o[9]=d=>s.rulesForm.rules_if.bot_user.user_in_location=d),type:"checkbox",id:"bot-user-in-location"},null,512),[[k,s.rulesForm.rules_if.bot_user.user_in_location]]),e("label",$h,[s.rulesForm.rules_if.bot_user.user_in_location?(l(),i("span",kh,"Находится в заведении")):(l(),i("span",Fh,"Не находится в заведении"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[10]||(o[10]=d=>t.removeRule("user_in_location"))},wh)])):r("",!0),t.hasRuleKey("age")?(l(),i("li",jh,[e("div",null,[Sh,c(e("input",{type:"text",class:"form-control",placeholder:"Возраст от","aria-label":"Возраст от","onUpdate:modelValue":o[11]||(o[11]=d=>s.rulesForm.rules_if.bot_user.age=d),maxlength:"255","aria-describedby":"bot-user-age"},null,512),[[p,s.rulesForm.rules_if.bot_user.age]])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[12]||(o[12]=d=>t.removeRule("age"))},Ph)])):r("",!0),t.hasRuleKey("city")?(l(),i("li",Uh,[e("div",null,[Bh,c(e("input",{type:"text",class:"form-control",placeholder:"Город","aria-label":"Город","onUpdate:modelValue":o[13]||(o[13]=d=>s.rulesForm.rules_if.bot_user.city=d),maxlength:"255","aria-describedby":"bot-user-city"},null,512),[[p,s.rulesForm.rules_if.bot_user.city]])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[14]||(o[14]=d=>t.removeRule("city"))},Th)])):r("",!0),t.hasRuleKey("sex")?(l(),i("li",Ih,[e("div",qh,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[15]||(o[15]=d=>s.rulesForm.rules_if.bot_user.sex=d),type:"checkbox",id:"bot-user-sex"},null,512),[[k,s.rulesForm.rules_if.bot_user.sex]]),e("label",Dh,[s.rulesForm.rules_if.bot_user.sex?(l(),i("span",Rh,"Только для мужчин")):(l(),i("span",Lh,"Только для женщин"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[16]||(o[16]=d=>t.removeRule("sex"))},Mh)])):r("",!0),s.rulesForm.rules_if.channels.length>0?(l(),i("li",Ah,[u("Проверка нахождения в канале \\ группе: "),(l(!0),i(f,null,$(s.rulesForm.rules_if.channels,(d,n)=>(l(),i("div",Eh,[e("div",zh,[e("label",Kh,[v(T,{token:s.bot.bot_token,param:`${n}`,onCallback:t.modifyChannel},null,8,["token","param","onCallback"]),u(" Канал для проверки ")]),e("button",{type:"button",class:"btn btn-link text-danger",onClick:m=>t.removeChannelFromRule(n)},Jh,8,Nh)]),c(e("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":m=>s.rulesForm.rules_if.channels[n]=m,maxlength:"255","aria-describedby":"bot-order-channel"},null,8,Wh),[[p,s.rulesForm.rules_if.channels[n]]])]))),256))])):r("",!0)])):r("",!0),s.rulesForm.rules_if?(l(),i("h6",Hh,"Иначе")):r("",!0),s.rulesForm.rules_else_page_id?(l(),i("p",Gh,[u("Вы выбрали страницу #"+h(s.rulesForm.rules_else_page_id)+' в качестве условия "иначе" ',1),e("a",{href:"javascript:void(0)",onClick:o[17]||(o[17]=d=>s.rulesForm.rules_else_page_id=null)},"Очистить")])):r("",!0),s.rulesForm.rules_if?(l(),F(R,{key:5,current:s.rulesForm.id,onCallback:t.attachPageToRule,editor:!1},null,8,["current","onCallback"])):r("",!0),s.rulesForm.rules_if?(l(),i("div",Qh,[e("label",Xh,[v(a,null,{content:g(()=>[em]),default:g(()=>[Zh]),_:1}),u(" Сообщение в случае невыполнения условий (не обязательно) ")]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст сообщения","aria-label":"Текст сообщения","onUpdate:modelValue":o[18]||(o[18]=d=>s.rulesForm.rules_else_message=d),maxlength:"255","aria-describedby":"rules-else-message"},`
            `,512),[[p,s.rulesForm.rules_else_message]])])):r("",!0)],64)}}});const om={key:0,class:"row"},lm={class:"col-12 mb-2"},im=e("h6",null,"На странице выбраны следующие разделы",-1),nm={class:"mini-pics justify-content-start d-inline-flex"},am=e("i",{class:"fa-regular fa-images"},null,-1),dm=[am],rm=e("i",{class:"fa-regular fa-note-sticky"},null,-1),cm=[rm],um=e("i",{class:"fa-solid fa-photo-film"},null,-1),_m=[um],hm=e("i",{class:"fa-regular fa-file-audio"},null,-1),mm=[hm],pm=e("i",{class:"fa-regular fa-file-word"},null,-1),bm=[pm],gm=e("i",{class:"fa-solid fa-link"},null,-1),fm=[gm],vm=e("i",{class:"fa-solid fa-scroll"},null,-1),ym=[vm],$m=e("i",{class:"fa-regular fa-comment-dots"},null,-1),km=[$m],Fm=e("i",{class:"fa-solid fa-scale-balanced"},null,-1),Cm=[Fm],wm=e("i",{class:"fa-regular fa-keyboard"},null,-1),jm=[wm],Sm=e("i",{class:"fa-solid fa-ellipsis"},null,-1),Vm=[Sm],Pm={class:"row"},Um={class:"col-8 mb-2"},Bm={class:"form-label",id:"bot-domain"},Om=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Tm=e("div",null,[u(" Команда должна начинаться с символа . и *"),e("br"),u(" Например: .*Меню"),e("br")],-1),Im=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),qm={class:"col-4 mb-2 d-flex justify-content-end align-items-end"},Dm={class:"btn-group",style:{background:"white"},role:"group","aria-label":"Basic example"},Rm={key:0,type:"submit",title:"Сохранить страницу",class:"btn btn-primary min-menu-btn"},Lm=e("i",{class:"fa-regular fa-floppy-disk"},null,-1),xm=[Lm],Mm=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Am=[Mm],Em=e("button",{type:"button",title:"Список страниц","data-bs-toggle":"modal","data-bs-target":"#pages-modal",class:"btn btn-outline-primary min-menu-btn"},[e("i",{class:"fa-solid fa-list-ol"})],-1),zm={class:"col-12 mb-2"},Km={class:"form-check"},Nm=e("label",{class:"form-check-label",for:"is-external"}," Внешнее управление страницей ",-1),Ym={key:1,class:"row"},Jm={class:"col-12 mb-2"},Wm={class:"form-label d-flex justify-content-between align-items-center mb-0",id:"bot-domain"},Hm=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Gm=e("div",null,[u(" Текстовый редактор. Данный текст будет в таком"),e("br"),u(" же виде отображен в посте в телеграм. ")],-1),Qm=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Xm={class:"form-floating"},Zm={for:"floatingTextarea2"},ep={key:0},tp={class:"col-12 mb-2"},sp={class:"nav nav-tabs justify-content-center"},op=e("i",{class:"fa-regular fa-keyboard"},null,-1),lp=e("span",null,"Нижнее меню",-1),ip=[op,lp],np=e("i",{class:"fa-solid fa-ellipsis"},null,-1),ap=e("span",null,"Меню под текстом",-1),dp=[np,ap],rp=e("i",{class:"fa-regular fa-images"},null,-1),cp=e("span",null,"Изображения",-1),up=[rp,cp],_p=e("i",{class:"fa-solid fa-photo-film"},null,-1),hp=e("span",null,"Видео",-1),mp=[_p,hp],pp=e("i",{class:"fa-regular fa-note-sticky"},null,-1),bp=e("span",null,"Стикеры",-1),gp=[pp,bp],fp=e("i",{class:"fa-regular fa-file-audio"},null,-1),vp=e("span",null,"Аудио",-1),yp=[fp,vp],$p=e("i",{class:"fa-regular fa-file-word"},null,-1),kp=e("span",null,"Документы",-1),Fp=[$p,kp],Cp=e("i",{class:"fa-solid fa-link"},null,-1),wp=e("span",null,"Другая страница",-1),jp=[Cp,wp],Sp=e("i",{class:"fa-solid fa-scroll"},null,-1),Vp=e("span",null,"Скрипт",-1),Pp=[Sp,Vp],Up=e("i",{class:"fa-regular fa-comment-dots"},null,-1),Bp=e("span",null,"Начало диалога",-1),Op=[Up,Bp],Tp=e("i",{class:"fa-solid fa-scale-balanced"},null,-1),Ip=e("span",null,"Правила",-1),qp=[Tp,Ip],Dp={key:0},Rp={key:0,class:"col-12 mb-2"},Lp={class:"form-check"},xp=e("label",{class:"form-check-label",for:"need-reply-menu"}," Нижнее меню страницы ",-1),Mp={key:1,class:"col-12 mb-2"},Ap={class:"card"},Ep={class:"card-header d-flex justify-between align-items-center"},zp=e("h6",null,"Конструктор нижнего меню",-1),Kp={key:0},Np={key:1},Yp={class:"card-body"},Jp={class:"row"},Wp={class:"col-12 mb-2"},Hp={class:"form-label",id:"bot-domain"},Gp=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Qp=e("div",null," Заголовок для нижнего меню ",-1),Xp={key:2,class:"col-12 mb-2"},Zp={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},eb={class:"d-flex justify-content-center mb-3"},tb={alt:"",width:"100",height:"100"},sb=e("h1",{class:"text-body-emphasis"},"Нижнее меню",-1),ob=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"}," Создание и настройка нижнего меню страницы бота. Добавление и редактирование функций кнопок бота на странице. Данное меню отображается пользователю всегда. ",-1),lb={class:"d-inline-flex gap-2 mb-5"},ib=["disabled"],nb=e("a",{href:"https://telegra.ph/Nizhnee-menyu-bota-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),ab={key:1},db={key:0,class:"col-12 mb-2"},rb={class:"form-check"},cb=e("label",{class:"form-check-label",for:"need-inline-menu"}," Меню под текстом страницы ",-1),ub={key:1,class:"col-12 mb-2"},_b={class:"card"},hb={class:"card-header d-flex justify-between align-items-center"},mb=e("h6",null,"Конструктор меню в сообщении",-1),pb={key:0},bb={key:1},gb={class:"card-body"},fb={key:2,class:"col-12 mb-2"},vb={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},yb={class:"d-flex justify-content-center mb-3"},$b={alt:"",width:"100",height:"100"},kb=e("h1",{class:"text-body-emphasis"},"Меню под текстом",-1),Fb=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"}," В отличии от нижнего меню, которое отображается всегда, меню под текстом показывается под контентом только в момент отображения этого контента. ",-1),Cb={class:"d-inline-flex gap-2 mb-5"},wb=["disabled"],jb=e("a",{href:"https://telegra.ph/Menyu-k-tekstu-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),Sb={key:2},Vb={key:0,class:"col-12 mb-2"},Pb={class:"form-check"},Ub=e("label",{class:"form-check-label",for:"need-page-images"}," Изображения на странице (максимум 10) ",-1),Bb={key:1,class:"col-12 mb-2"},Ob={class:"card mb-3"},Tb=e("div",{class:"card-header"},[e("h6",null,"Загрузите изображения с файловой системы")],-1),Ib={class:"card-body d-flex justify-content-start"},qb={for:"photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},Db={class:"row"},Rb={key:0,class:"col-12 d-flex flex-wrap"},Lb={class:"mb-2 img-preview",style:{"margin-right":"10px"}},xb={class:"remove"},Mb=["onClick"],Ab={key:1},Eb={key:2,class:"col-12 d-flex flex-wrap"},zb={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Kb={class:"remove"},Nb=["onClick"],Yb={key:2,class:"col-12 mb-2"},Jb={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},Wb={class:"d-flex justify-content-center mb-3"},Hb={alt:"",width:"100",height:"100"},Gb=e("h1",{class:"text-body-emphasis"},"Изображения",-1),Qb=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"},[u(" Вы можете добавить к одной странице от "),e("b",null,"1"),u(" до "),e("b",null,"10"),u(" изображений. Изображения (от 2х) будут собраны в группу и показаны под текстовым содержимым страницы. Если изображение одно, то текст будет отображен под ним. ")],-1),Xb={class:"d-inline-flex gap-2 mb-5"},Zb=["disabled"],e1=e("a",{href:"https://telegra.ph/Dobavlenie-izobrazhenij-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),t1={key:3},s1={key:0,class:"col-12 mb-2"},o1={class:"form-check"},l1=e("label",{class:"form-check-label",for:"need-page-video"}," Видео к странице ",-1),i1={key:1,class:"col-12 mb-2"},n1={key:2,class:"col-12 mb-2"},a1={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},d1={class:"d-flex justify-content-center mb-3"},r1={alt:"",width:"100",height:"100"},c1=e("h1",{class:"text-body-emphasis"},"Видео",-1),u1=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"},[u(" Вы можете добавить к одной странице от "),e("b",null,"1"),u(" до "),e("b",null,"10"),u(" видео. Ролики (от 2х) будут собраны в группу и показаны под текстовым содержимым страницы. ")],-1),_1={class:"d-inline-flex gap-2 mb-5"},h1=["disabled"],m1=e("a",{href:"https://telegra.ph/Dobavlenie-video-na-stranicu-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),p1={key:4},b1={key:0,class:"col-12 mb-2"},g1={class:"form-check"},f1=e("label",{class:"form-check-label",for:"need-page-sticker"}," Стикер к странице ",-1),v1={key:1,class:"col-12 mb-2"},y1={key:2,class:"col-12 mb-2"},$1={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},k1={class:"d-flex justify-content-center mb-3"},F1={alt:"",width:"100",height:"100"},C1=e("h1",{class:"text-body-emphasis"},"Стикеры",-1),w1=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"}," Вы можете переслать любой стикер в бота (от лица администратора) и затем этот стикер использовать для взаимодействия с пользователем. ",-1),j1={class:"d-inline-flex gap-2 mb-5"},S1=["disabled"],V1=e("a",{href:"https://telegra.ph/Dobavlenie-stikera-na-stranicu-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),P1={key:5},U1={key:0,class:"col-12 mb-2"},B1={class:"form-check"},O1=e("label",{class:"form-check-label",for:"need-page-audio"}," Звук к странице ",-1),T1={key:1,class:"col-12 mb-2"},I1={key:2,class:"col-12 mb-2"},q1={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},D1={class:"d-flex justify-content-center mb-3"},R1={alt:"",width:"100",height:"100"},L1=e("h1",{class:"text-body-emphasis"},"Аудио",-1),x1=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"},[u(" Вы можете добавить к одной странице от "),e("b",null,"1"),u(" до "),e("b",null,"10"),u(" аудио. Музыка (от 2х) будет собрана в группу и показана под текстовым содержимым страницы. Если вы хотите использовать "),e("b",{class:"text-danger"},"голосовое"),u(", то можно использовать максимум "),e("b",{class:"text-danger"},"одну запись"),u(". Или же, вы можете конвертировать её в mp3 и залить как музыкальный файл в бота. ")],-1),M1={class:"d-inline-flex gap-2 mb-5"},A1=["disabled"],E1=e("a",{href:"https://telegra.ph/Dobavlenie-audio-na-stranicu-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),z1={key:6},K1={key:0,class:"col-12 mb-2"},N1={class:"form-check"},Y1=e("label",{class:"form-check-label",for:"need-page-document"}," Документ \\ презентацию к странице \\ картинку в оригинале ",-1),J1={key:1,class:"col-12 mb-2"},W1={key:2,class:"col-12 mb-2"},H1={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},G1={class:"d-flex justify-content-center mb-3"},Q1={alt:"",width:"100",height:"100"},X1=e("h1",{class:"text-body-emphasis"},"Документы",-1),Z1=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"},[u(" Вы можете добавить к одной странице от "),e("b",null,"1"),u(" до "),e("b",null,"10"),u(" документов. Документы (от 2х) будут собраны в группу и показана под текстовым содержимым страницы. В качестве файлов вы можете использовать текстовые документы, презентации, файлы-pdf, изображения в оригинальном размере. ")],-1),eg={class:"d-inline-flex gap-2 mb-5"},tg=["disabled"],sg=e("a",{href:"https://telegra.ph/Dobavlenie-dokumenta-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),og={key:7},lg={key:0,class:"col-12 mb-2"},ig={class:"form-check"},ng=e("label",{class:"form-check-label",for:"need-page-attach"}," Связать с другой страницей ",-1),ag={key:1,class:"col-12 mb-2"},dg={key:0},rg={key:2,class:"col-12 mb-2"},cg={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},ug={class:"d-flex justify-content-center mb-3"},_g={alt:"",width:"100",height:"100"},hg=e("h1",{class:"text-body-emphasis"},"Связь со страницей",-1),mg=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"}," Вы можете привязать вызов другой страницы непосредственно после вызова текущей. Это позволит выводить контент по цепочке для пользователя. ",-1),pg={class:"d-inline-flex gap-2 mb-5"},bg=["disabled"],gg=e("a",{href:"https://telegra.ph/Svyazyvanie-so-stranicej-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),fg={key:8},vg={key:0,class:"col-12 mb-2"},yg={class:"form-check"},$g=e("label",{class:"form-check-label",for:"need-slug-attach"}," Привязать скрипт ",-1),kg={key:1,class:"col-12 mb-2"},Fg={key:0},Cg={key:2,class:"col-12 mb-2"},wg={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},jg={class:"d-flex justify-content-center mb-3"},Sg={alt:"",width:"100",height:"100"},Vg=e("h1",{class:"text-body-emphasis"},"Скрипты",-1),Pg=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"}," Скрипты содержат основной функционал системы. Вы можете к каждой странице привязать один скрипт, который будет вызван после вывода основного содержимого страницы. ",-1),Ug={class:"d-inline-flex gap-2 mb-5"},Bg=["disabled"],Og=e("a",{href:"https://telegra.ph/Svyazyvanie-so-skriptom-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),Tg={key:9},Ig={key:0,class:"col-12 mb-2"},qg={class:"form-check"},Dg=e("label",{class:"form-check-label",for:"need-dialog-attach"}," Привязать начало диалога ",-1),Rg={key:1,class:"col-12 mb-2"},Lg={key:0},xg={key:2,class:"col-12 mb-2"},Mg={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},Ag={class:"d-flex justify-content-center mb-3"},Eg={alt:"",width:"100",height:"100"},zg=e("h1",{class:"text-body-emphasis"},"Диалоги",-1),Kg=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"}," Диалоги страницы - это инструмент запроса данных от пользователя. Вы можете привязать начало диалога к странице, а сам диалог будет вызван по цепочке. ",-1),Ng={class:"d-inline-flex gap-2 mb-5"},Yg=["disabled"],Jg=e("a",{href:"https://telegra.ph/Dobavlenie-dialoga-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),Wg={key:10},Hg={key:0,class:"col-12 mb-2"},Gg={class:"form-check"},Qg=e("label",{class:"form-check-label",for:"need-rules"}," Нужны правила загрузки страницы ",-1),Xg={key:1,class:"col-12 mb-2"},Zg={key:2,class:"col-12 mb-2"},ef={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},tf={class:"d-flex justify-content-center mb-3"},sf={alt:"",width:"100",height:"100"},of=e("h1",{class:"text-body-emphasis"},"Правила отображения страницы",-1),lf=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"}," Вы можете создать правила, согласно которым будет отображена та или иная страница. Вы можете перенаправить пользователя с одной страницы на другую, в случае если ваше условие не выполнено. ",-1),nf={class:"d-inline-flex gap-2 mb-5"},af=["disabled"],df=e("a",{href:"https://telegra.ph/Pravila-na-stranice-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),rf={class:"modal fade",id:"save-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},cf={class:"modal-dialog"},uf={class:"modal-content"},_f=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"Сохранение страницы"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),hf={class:"modal-body"},mf={key:0,class:"row"},pf={class:"col-12 mb-2"},bf={class:"d-flex justify-between"},gf={class:"col-12 mb-2"},ff=e("h6",null,"На странице выбраны следующие разделы",-1),vf={class:"mini-pics"},yf=e("i",{class:"fa-regular fa-images"},null,-1),$f=[yf],kf=e("i",{class:"fa-regular fa-note-sticky"},null,-1),Ff=[kf],Cf=e("i",{class:"fa-solid fa-photo-film"},null,-1),wf=[Cf],jf=e("i",{class:"fa-regular fa-file-audio"},null,-1),Sf=[jf],Vf=e("i",{class:"fa-regular fa-file-word"},null,-1),Pf=[Vf],Uf=e("i",{class:"fa-solid fa-link"},null,-1),Bf=[Uf],Of=e("i",{class:"fa-solid fa-scroll"},null,-1),Tf=[Of],If=e("i",{class:"fa-regular fa-comment-dots"},null,-1),qf=[If],Df=e("i",{class:"fa-solid fa-scale-balanced"},null,-1),Rf=[Df],Lf=e("i",{class:"fa-regular fa-keyboard"},null,-1),xf=[Lf],Mf=e("i",{class:"fa-solid fa-ellipsis"},null,-1),Af=[Mf],Ef={key:0,class:"col-12 mb-2"},zf={class:"form-check"},Kf=e("label",{class:"form-check-label",for:"need-show-qr-and-link"}," Показать ссылку на страницу и QR-код ",-1),Nf={key:1,class:"col-12 mb-2"},Yf={class:"d-flex justify-content-center"},Jf={style:{width:"200px",height:"200px"}},Wf={class:"col-12 mb-2"},Hf={class:"form-label",id:"bot-domain"},Gf=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Qf=e("div",null,"Напишите для себя пояснение для чего нужна данная страница. Это поможет другим менеджерам лучше понять Вас. ",-1),Xf=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Zf=e("div",{class:"col-12"},[e("button",{type:"submit",class:"btn btn-primary w-100 p-3"},"Сохранить ")],-1),ev=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Не сохранять")],-1),tv={class:"modal fade",id:"pages-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},sv={class:"modal-dialog"},ov={class:"modal-content"},lv={class:"modal-body"},iv={data(){return{tab:0,saveModal:null,page:null,need_show_qr_and_link:!1,need_clean:!1,load:!1,photos:[],showReplyTemplateSelector:!1,showInlineTemplateSelector:!1,showMenu:!1,need_page_sticker:!1,need_page_audios:!1,need_page_documents:!1,need_page_video:!1,need_page_images:!1,need_inline_menu:!1,need_reply_menu:!1,need_attach_page:!1,need_attach_dialog:!1,need_attach_slug:!1,need_rules:!1,bot:null,pageForm:{id:null,content:"",command:null,slug:null,comment:null,videos:[],images:[],audios:[],documents:[],sticker:null,reply_keyboard_title:null,reply_keyboard:null,inline_keyboard:null,is_external:!1,next_page_id:null,next_bot_dialog_command_id:null,next_bot_menu_slug_id:null,rules_if:null,rules_else_page_id:null,rules_if_message:null,rules_else_message:null}}},watch:{need_page_images:function(s,t){this.need_page_images||(this.photos=[],this.pageForm.images=[])},need_page_audios:function(s,t){this.need_page_audios||(this.pageForm.audios=[])},need_page_documents:function(s,t){this.need_page_documents||(this.pageForm.documents=[])},need_page_sticker:function(s,t){this.need_page_sticker||(this.pageForm.sticker=null)},need_page_video:function(s,t){this.need_page_video||(this.pageForm.videos=[])},need_inline_menu:function(s,t){this.need_inline_menu||(this.pageForm.inline_keyboard=null,this.pageForm.inline_keyboard_id=null)},need_rules:function(s,t){this.need_rules||(this.pageForm.rules_if=null,this.pageForm.rules_else_page_id=null,this.pageForm.rules_if_message=null,this.pageForm.rules_else_message=null)},need_reply_menu:function(s,t){this.need_reply_menu||(this.pageForm.reply_keyboard=null,this.pageForm.reply_keyboard_id=null)},need_attach_page:function(s,t){this.need_attach_page||(this.pageForm.next_page_id=null)},need_attach_dialog:function(s,t){this.need_attach_dialog||(this.pageForm.next_bot_dialog_command_id=null)},need_attach_slug:function(s,t){this.need_attach_slug||(this.pageForm.next_bot_menu_slug_id=null)},pageForm:{handler:function(s){this.pageForm.reply_keyboard!=null&&(this.need_reply_menu=!0),this.pageForm.inline_keyboard!=null&&(this.need_inline_menu=!0),this.pageForm.images.length>0&&(this.need_page_images=!0),this.pageForm.next_bot_dialog_command_id!=null&&(this.need_attach_dialog=!0),this.pageForm.next_bot_menu_slug_id!=null&&(this.need_attach_slug=!0),this.pageForm.next_page_id!=null&&(this.need_attach_page=!0),this.pageForm.rules_if!=null&&(this.need_rules=!0),this.pageForm.videos.length>0&&(this.need_page_video=!0),this.pageForm.audios.length>0&&(this.need_page_audios=!0),this.pageForm.documents.length>0&&(this.need_page_documents=!0),this.pageForm.sticker&&(this.need_page_sticker=!0),this.need_clean=!0},deep:!0}},computed:{...w(["getCurrentBot"]),qr(){return"https://api.qrserver.com/v1/create-qr-code/?size=450x450&qzone=2&data="+this.link},hasParts(){return this.need_page_sticker||this.need_page_audios||this.need_page_documents||this.need_page_video||this.need_page_images||this.need_inline_menu||this.need_reply_menu||this.need_attach_page||this.need_attach_dialog||this.need_attach_slug||this.need_rules},pageLink(){if(!this.pageForm.id)return"Ссылка недоступна";let s="";for(let t=0;t<10-(""+this.pageForm.id).length;t++)s+="0";return s+=this.pageForm.id,"https://t.me/"+this.getCurrentBot.bot_domain+"?start="+btoa("004"+s)}},mounted(){this.page?this.preparePageForm():this.clearForm(),this.loadCurrentBot().then(()=>{this.saveModal=new bootstrap.Modal(document.getElementById("save-modal"),{})})},methods:{preparePageForm(){let s=this.page;this.photos=[],this.pageForm={id:s.id,slug_id:s.slug?s.slug.id:null,content:s.content,command:s.slug?s.slug.command:null,slug:s.slug?s.slug.slug:null,comment:s.slug?s.slug.comment:null,images:s.images||[],sticker:s.sticker||null,reply_keyboard_title:s.reply_keyboard_title||null,reply_keyboard_id:s.reply_keyboard_id||null,inline_keyboard_id:s.inline_keyboard_id||null,reply_keyboard:s.replyKeyboard||null,inline_keyboard:s.inlineKeyboard||null,next_page_id:s.next_page_id||null,next_bot_dialog_command_id:s.next_bot_dialog_command_id||null,next_bot_menu_slug_id:s.next_bot_menu_slug_id||null,is_external:s.is_external||!1,rules_if:s.rules_if||null,rules_else_page_id:s.rules_else_page_id||null,audios:s.audios||[],documents:s.documents||[],videos:s.videos||[],rules_if_message:s.rules_if_message||null,rules_else_message:s.rules_else_message||null}},copyToClipBoard(s){navigator.clipboard.writeText(s).then(()=>{this.$notify({title:"Копирование",text:"Ссылка скопирована в буфер"})}).catch(t=>{this.$notify({title:"Копирование",text:"Ошибка копирования",type:"error"})})},associateDialog(s){this.pageForm.next_bot_dialog_command_id=s.id},associateSlug(s){this.pageForm.next_bot_menu_slug_id=s.id},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},attachPage(s){s.id!=this.pageForm.id?this.pageForm.next_page_id=s.id:this.$notify({title:"Конструктор страниц",text:"Вы не можете связать данную страницу с собой",type:"error"})},injectContent(s){this.pageForm.content?this.pageForm.content+=s.text:this.pageForm.content=s.text},clearForm(){this.photos=[],this.pageForm={id:null,content:null,command:null,slug:null,comment:null,sticker:null,images:[],reply_keyboard:null,inline_keyboard:null,is_external:!1,videos:[],audios:[],documents:[],reply_keyboard_title:null,reply_keyboard_id:null,inline_keyboard_id:null,next_page_id:null,next_bot_dialog_command_id:null,next_bot_menu_slug_id:null,rules_if_message:null,rules_else_message:null},this.photos=[],this.showReplyTemplateSelector=!1,this.showInlineTemplateSelector=!1,this.need_page_images=!1,this.need_page_video=!1,this.need_inline_menu=!1,this.need_reply_menu=!1,this.need_attach_page=!1,this.need_attach_dialog=!1,this.need_attach_slug=!1,this.need_rules=!1,this.need_page_audios=!1,this.need_page_documents=!1,this.need_page_sticker=!1,this.$nextTick(()=>{this.need_clean=!1})},openSaveModal(){this.saveModal.show()},submitPage(){let s=new FormData;if(Object.keys(this.pageForm).forEach(t=>{const o=this.pageForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.bot&&s.append("bot_id",this.bot.id),this.photos.length>0)for(let t=0;t<this.photos.length;t++)s.append("photos[]",this.photos[t]);this.$store.dispatch(this.pageForm.id==null?"createPage":"updatePage",{pageForm:s}).then(t=>{this.pageForm.id==null&&(this.load=!0,this.$nextTick(()=>{this.load=!1,this.clearForm()})),this.saveModal.hide(),this.$emit("callback",t.data),this.$notify({title:"Конструктор ботов",text:this.pageForm.id==null?"Страница успешно создана!":"Страница успешно обновлена!",type:"success"}),this.pageForm.id!=null&&this.$store.dispatch("loadPages",{dataObject:{botId:this.bot.id},page:localStorage.getItem(`cashman_pagelist_${this.bot.id}_page_index`)||0})}).catch(t=>{})},saveInlineKeyboard(s){this.pageForm.inline_keyboard=s},selectReplyKeyboard(s){this.pageForm.reply_keyboard=s,this.showReplyTemplateSelector=!1},selectInlineKeyboard(s){this.pageForm.inline_keyboard=s,this.showInlineTemplateSelector=!1},saveReplyKeyboard(s){this.pageForm.reply_keyboard=s},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removePhoto(s){this.photos.splice(s,1)},removeImage(s){this.pageForm.images.splice(s,1)},onChangePhotos(s){const t=s.target.files;for(let o=0;o<t.length;o++)this.photos.push(t[o])},onChange(s){this.pageForm.content=s},selectPhoto(s){this.pageForm.images||(this.pageForm.images=[]);let t=this.pageForm.images.indexOf(s.file_id);t!==-1?this.pageForm.images.splice(t,1):this.pageForm.images.push(s.file_id)},selectSticker(s){this.pageForm.sticker=s.file_id},selectVideo(s){this.pageForm.videos||(this.pageForm.videos=[]);let t=this.pageForm.videos.indexOf(s.file_id);t!==-1?this.pageForm.videos.splice(t,1):this.pageForm.videos.push(s.file_id)},selectAudio(s){this.pageForm.audios||(this.pageForm.audios=[]);let t=this.pageForm.audios.indexOf(s.file_id);if(s.type==="voice"){if(t!==-1){this.pageForm.audios.splice(t,1);return}this.pageForm.audios=[s.file_id];return}t!==-1?this.pageForm.audios.splice(t,1):this.pageForm.audios.push(s.file_id)},selectDocument(s){this.pageForm.documents||(this.pageForm.documents=[]);let t=this.pageForm.documents.indexOf(s.file_id);t!==-1?this.pageForm.documents.splice(t,1):this.pageForm.documents.push(s.file_id)},pageListCallback(s){this.load=!0,this.page=s,this.preparePageForm(),this.$nextTick(()=>{this.load=!1})}}},PF=Object.assign(iv,{__name:"Page",setup(s){return(t,o)=>{const a=U("Popper"),d=q("lazy");return l(),i(f,null,[t.bot?(l(),i("form",{key:0,id:"page-construct",onSubmit:o[44]||(o[44]=j((...n)=>t.openSaveModal&&t.openSaveModal(...n),["prevent"]))},[t.hasParts?(l(),i("div",om,[e("div",lm,[im,e("ul",nm,[e("li",{title:"Изображения",class:b({active:t.need_page_images})},dm,2),e("li",{title:"Стикеры",class:b({active:t.need_page_sticker})},cm,2),e("li",{title:"Видео",class:b({active:t.need_page_video})},_m,2),e("li",{title:"Аудио",class:b({active:t.need_page_audios})},mm,2),e("li",{title:"Документы",class:b({active:t.need_page_documents})},bm,2),e("li",{title:"Страницы",class:b({active:t.need_attach_page})},fm,2),e("li",{title:"Скрипты",class:b({active:t.need_attach_slug})},ym,2),e("li",{title:"Диалоги",class:b({active:t.need_attach_dialog})},km,2),e("li",{title:"Правила",class:b({active:t.need_rules})},Cm,2),e("li",{title:"Нижнее меню",class:b({active:t.need_reply_menu})},jm,2),e("li",{title:"Текстовое меню",class:b({active:t.need_inline_menu})},Vm,2)])])])):r("",!0),e("div",Pm,[e("div",Um,[e("label",Bm,[v(a,null,{content:g(()=>[Tm]),default:g(()=>[Om]),_:1}),u(" Команда "),Im]),c(e("input",{type:"text",class:"form-control",placeholder:"Команда","aria-label":"Команда","onUpdate:modelValue":o[0]||(o[0]=n=>t.pageForm.command=n),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[p,t.pageForm.command]])]),e("div",qm,[e("div",Dm,[t.pageForm.id||t.need_clean?(l(),i("button",Rm,xm)):r("",!0),t.pageForm.id||t.need_clean?(l(),i("button",{key:1,type:"button",onClick:o[1]||(o[1]=(...n)=>t.clearForm&&t.clearForm(...n)),title:"Очистить \\ Новая страница",class:"btn btn-outline-primary min-menu-btn"},Am)):r("",!0),Em])]),e("div",zm,[e("div",Km,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[2]||(o[2]=n=>t.pageForm.is_external=n),type:"checkbox",id:"is-external"},null,512),[[k,t.pageForm.is_external]]),Nm])])]),t.pageForm.is_external?r("",!0):(l(),i("div",Ym,[e("div",Jm,[e("label",Wm,[e("div",null,[v(a,null,{content:g(()=>[Gm]),default:g(()=>[Hm]),_:1}),u(" Текстовое содержимое страницы "),Qm]),v(G,{param:"content",onCallback:t.injectContent},null,8,["onCallback"])]),e("div",Xm,[c(e("textarea",{class:"form-control","onUpdate:modelValue":o[3]||(o[3]=n=>t.pageForm.content=n),maxlength:"4096",placeholder:"Введите текст",id:"floatingTextarea2",style:{"min-height":"300px"}},null,512),[[p,t.pageForm.content]]),e("label",Zm,[u("Содержимое страницы "),t.pageForm.content?(l(),i("span",ep,h(t.pageForm.content.length)+"/4096 ",1)):r("",!0)])])]),e("div",tp,[e("ul",sp,[e("li",{class:"nav-item",onClick:o[4]||(o[4]=n=>t.tab=0)},[e("a",{class:b([{active:t.tab===0},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},ip,2)]),e("li",{class:"nav-item",onClick:o[5]||(o[5]=n=>t.tab=1)},[e("a",{class:b([{active:t.tab===1},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},dp,2)]),e("li",{class:"nav-item",onClick:o[6]||(o[6]=n=>t.tab=2)},[e("a",{class:b([{active:t.tab===2},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},up,2)]),e("li",{class:"nav-item",onClick:o[7]||(o[7]=n=>t.tab=3)},[e("a",{class:b([{active:t.tab===3},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},mp,2)]),e("li",{class:"nav-item",onClick:o[8]||(o[8]=n=>t.tab=4)},[e("a",{class:b([{active:t.tab===4},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},gp,2)]),e("li",{class:"nav-item",onClick:o[9]||(o[9]=n=>t.tab=5)},[e("a",{class:b([{active:t.tab===5},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},yp,2)]),e("li",{class:"nav-item",onClick:o[10]||(o[10]=n=>t.tab=6)},[e("a",{class:b([{active:t.tab===6},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},Fp,2)]),e("li",{class:"nav-item",onClick:o[11]||(o[11]=n=>t.tab=7)},[e("a",{class:b([{active:t.tab===7},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},jp,2)]),e("li",{class:"nav-item",onClick:o[12]||(o[12]=n=>t.tab=8)},[e("a",{class:b([{active:t.tab===8},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},Pp,2)]),e("li",{class:"nav-item",onClick:o[13]||(o[13]=n=>t.tab=9)},[e("a",{class:b([{active:t.tab===9},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},Op,2)]),e("li",{class:"nav-item",onClick:o[14]||(o[14]=n=>t.tab=10)},[e("a",{class:b([{active:t.tab===10},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},qp,2)])])]),t.tab===0?(l(),i("div",Dp,[t.need_reply_menu?(l(),i("div",Rp,[e("div",Lp,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[15]||(o[15]=n=>t.need_reply_menu=n),type:"checkbox",id:"need-reply-menu"},null,512),[[k,t.need_reply_menu]]),xp])])):r("",!0),t.need_reply_menu?(l(),i("div",Mp,[e("div",Ap,[e("div",Ep,[zp,e("button",{class:b(["btn",{"btn-outline-primary":!t.showReplyTemplateSelector,"btn-primary":t.showReplyTemplateSelector}]),type:"button",onClick:o[16]||(o[16]=n=>t.showReplyTemplateSelector=!t.showReplyTemplateSelector)},[t.showReplyTemplateSelector?(l(),i("span",Np," Скрыть шаблоны меню")):(l(),i("span",Kp," Открыть шаблоны меню"))],2)]),e("div",Yp,[e("div",Jp,[e("div",Wp,[e("label",Hp,[v(a,null,{content:g(()=>[Qp]),default:g(()=>[Gp]),_:1}),u(" Заголовок ")]),c(e("input",{type:"text",class:"form-control",placeholder:"Заголовок меню","aria-label":"Заголовок меню","onUpdate:modelValue":o[17]||(o[17]=n=>t.pageForm.reply_keyboard_title=n),maxlength:"255","aria-describedby":"bot-domain"},null,512),[[p,t.pageForm.reply_keyboard_title]])])]),t.showReplyTemplateSelector?(l(),F(L,{key:0,class:"mb-2",type:"reply",onSelect:t.selectReplyKeyboard,"select-mode":!0},null,8,["onSelect"])):(l(),F(I,{key:1,type:"reply",onSave:t.saveReplyKeyboard,"edited-keyboard":t.pageForm.reply_keyboard},null,8,["onSave","edited-keyboard"]))])])])):(l(),i("div",Xp,[e("div",Zp,[e("div",eb,[c(e("img",tb,null,512),[[d,"../images/icon.png"]])]),sb,ob,e("div",lb,[e("button",{disabled:t.need_reply_menu,onClick:o[18]||(o[18]=n=>t.need_reply_menu=!0),class:b([{"btn-primary":!t.need_reply_menu,"btn-outline-secondary":t.need_reply_menu},"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill"]),type:"button"}," Добавить ",10,ib),nb])])]))])):r("",!0),t.tab===1?(l(),i("div",ab,[t.need_inline_menu?(l(),i("div",db,[e("div",rb,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[19]||(o[19]=n=>t.need_inline_menu=n),type:"checkbox",id:"need-inline-menu"},null,512),[[k,t.need_inline_menu]]),cb])])):r("",!0),t.need_inline_menu?(l(),i("div",ub,[e("div",_b,[e("div",hb,[mb,e("button",{class:b(["btn",{"btn-outline-primary":!t.showInlineTemplateSelector,"btn-primary":t.showInlineTemplateSelector}]),type:"button",onClick:o[20]||(o[20]=n=>t.showInlineTemplateSelector=!t.showInlineTemplateSelector)},[t.showInlineTemplateSelector?(l(),i("span",bb," Скрыть шаблоны меню")):(l(),i("span",pb," Открыть шаблоны меню"))],2)]),e("div",gb,[t.showInlineTemplateSelector?(l(),F(L,{key:0,class:"mb-2",type:"inline",onSelect:t.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(l(),F(I,{key:1,type:"inline",onSave:t.saveInlineKeyboard,"edited-keyboard":t.pageForm.inline_keyboard},null,8,["onSave","edited-keyboard"]))])])])):(l(),i("div",fb,[e("div",vb,[e("div",yb,[c(e("img",$b,null,512),[[d,"../images/icon.png"]])]),kb,Fb,e("div",Cb,[e("button",{disabled:t.need_inline_menu,onClick:o[21]||(o[21]=n=>t.need_inline_menu=!0),class:b([{"btn-primary":!t.need_inline_menu,"btn-outline-secondary":t.need_inline_menu},"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill"]),type:"button"}," Добавить ",10,wb),jb])])]))])):r("",!0),t.tab===2?(l(),i("div",Sb,[t.need_page_images?(l(),i("div",Vb,[e("div",Pb,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[22]||(o[22]=n=>t.need_page_images=n),type:"checkbox",id:"need-page-images"},null,512),[[k,t.need_page_images]]),Ub])])):r("",!0),t.need_page_images?(l(),i("div",Bb,[e("div",Ob,[Tb,e("div",Ib,[e("label",qb,[u(" + "),e("input",{type:"file",id:"photos",multiple:"",accept:"image/*",onChange:o[23]||(o[23]=(...n)=>t.onChangePhotos&&t.onChangePhotos(...n)),style:{display:"none"}},null,32)]),e("div",Db,[t.photos.length>0?(l(),i("div",Rb,[(l(!0),i(f,null,$(t.photos,(n,m)=>(l(),i("div",Lb,[c(e("img",null,null,512),[[d,t.getPhoto(n).imageUrl]]),e("div",xb,[e("a",{onClick:_=>t.removePhoto(m)},"Удалить",8,Mb)])]))),256))])):r("",!0),t.pageForm.images.length>0?(l(),i("h6",Ab,"Ранее загруженные фотографии")):r("",!0),t.pageForm.images.length>0?(l(),i("div",Eb,[(l(!0),i(f,null,$(t.pageForm.images,(n,m)=>(l(),i("div",zb,[c(e("img",null,null,512),[[d,"/images-by-bot-id/"+t.bot.id+"/"+n]]),e("div",Kb,[e("a",{onClick:_=>t.removeImage(m)},"Удалить",8,Nb)])]))),256))])):r("",!0)])])])])):(l(),i("div",Yb,[e("div",Jb,[e("div",Wb,[c(e("img",Hb,null,512),[[d,"../images/icon.png"]])]),Gb,Qb,e("div",Xb,[e("button",{disabled:t.need_page_images,onClick:o[24]||(o[24]=n=>t.need_page_images=!0),class:b([{"btn-primary":!t.need_page_images,"btn-outline-secondary":t.need_page_images},"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill"]),type:"button"}," Добавить ",10,Zb),e1])])]))])):r("",!0),t.tab===3?(l(),i("div",t1,[t.need_page_video?(l(),i("div",s1,[e("div",o1,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[25]||(o[25]=n=>t.need_page_video=n),type:"checkbox",id:"need-page-video"},null,512),[[k,t.need_page_video]]),l1])])):r("",!0),t.need_page_video?(l(),i("div",i1,[v(B,{"need-video":!0,"need-video-note":!0,selected:t.pageForm.videos,onSelect:t.selectVideo},null,8,["selected","onSelect"])])):(l(),i("div",n1,[e("div",a1,[e("div",d1,[c(e("img",r1,null,512),[[d,"../images/icon.png"]])]),c1,u1,e("div",_1,[e("button",{disabled:t.need_page_video,onClick:o[26]||(o[26]=n=>t.need_page_video=!0),class:b([{"btn-primary":!t.need_page_video,"btn-outline-secondary":t.need_page_video},"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill"]),type:"button"}," Добавить ",10,h1),m1])])]))])):r("",!0),t.tab===4?(l(),i("div",p1,[t.need_page_sticker?(l(),i("div",b1,[e("div",g1,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[27]||(o[27]=n=>t.need_page_sticker=n),type:"checkbox",id:"need-page-sticker"},null,512),[[k,t.need_page_sticker]]),f1])])):r("",!0),t.need_page_sticker?(l(),i("div",v1,[v(B,{"need-sticker":!0,selected:[t.pageForm.sticker],onSelect:t.selectSticker},null,8,["selected","onSelect"])])):(l(),i("div",y1,[e("div",$1,[e("div",k1,[c(e("img",F1,null,512),[[d,"../images/icon.png"]])]),C1,w1,e("div",j1,[e("button",{disabled:t.need_page_sticker,onClick:o[28]||(o[28]=n=>t.need_page_sticker=!0),class:b([{"btn-primary":!t.need_page_sticker,"btn-outline-secondary":t.need_page_sticker},"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill"]),type:"button"}," Добавить ",10,S1),V1])])]))])):r("",!0),t.tab===5?(l(),i("div",P1,[t.need_page_audios?(l(),i("div",U1,[e("div",B1,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[29]||(o[29]=n=>t.need_page_audios=n),type:"checkbox",id:"need-page-audio"},null,512),[[k,t.need_page_audios]]),O1])])):r("",!0),t.need_page_audios?(l(),i("div",T1,[v(B,{"need-audio":!0,selected:t.pageForm.audios,onSelect:t.selectAudio},null,8,["selected","onSelect"])])):(l(),i("div",I1,[e("div",q1,[e("div",D1,[c(e("img",R1,null,512),[[d,"../images/icon.png"]])]),L1,x1,e("div",M1,[e("button",{disabled:t.need_page_audios,onClick:o[30]||(o[30]=n=>t.need_page_audios=!0),class:b([{"btn-primary":!t.need_page_audios,"btn-outline-secondary":t.need_page_audios},"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill"]),type:"button"}," Добавить ",10,A1),E1])])]))])):r("",!0),t.tab===6?(l(),i("div",z1,[t.need_page_documents?(l(),i("div",K1,[e("div",N1,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[31]||(o[31]=n=>t.need_page_documents=n),type:"checkbox",id:"need-page-document"},null,512),[[k,t.need_page_documents]]),Y1])])):r("",!0),t.need_page_documents?(l(),i("div",J1,[v(B,{"need-document":!0,selected:t.pageForm.documents,onSelect:t.selectDocument},null,8,["selected","onSelect"])])):(l(),i("div",W1,[e("div",H1,[e("div",G1,[c(e("img",Q1,null,512),[[d,"../images/icon.png"]])]),X1,Z1,e("div",eg,[e("button",{disabled:t.need_page_documents,onClick:o[32]||(o[32]=n=>t.need_page_documents=!0),class:b([{"btn-primary":!t.need_page_documents,"btn-outline-secondary":t.need_page_documents},"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill"]),type:"button"}," Добавить ",10,tg),sg])])]))])):r("",!0),t.tab===7?(l(),i("div",og,[t.need_attach_page?(l(),i("div",lg,[e("div",ig,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[33]||(o[33]=n=>t.need_attach_page=n),type:"checkbox",id:"need-page-attach"},null,512),[[k,t.need_attach_page]]),ng])])):r("",!0),t.need_attach_page?(l(),i("div",ag,[t.pageForm.next_page_id?(l(),i("p",dg,[u("Связано со страницей #"+h(t.pageForm.next_page_id)+" ",1),e("a",{class:"btn btn-link",onClick:o[34]||(o[34]=n=>t.pageForm.next_page_id=null)},"Очистить")])):r("",!0),v(R,{current:t.pageForm.id,onCallback:t.attachPage,editor:!1},null,8,["current","onCallback"])])):(l(),i("div",rg,[e("div",cg,[e("div",ug,[c(e("img",_g,null,512),[[d,"../images/icon.png"]])]),hg,mg,e("div",pg,[e("button",{disabled:t.need_attach_page,onClick:o[35]||(o[35]=n=>t.need_attach_page=!0),class:b([{"btn-primary":!t.need_attach_page,"btn-outline-secondary":t.need_attach_page},"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill"]),type:"button"}," Добавить ",10,bg),gg])])]))])):r("",!0),t.tab===8?(l(),i("div",fg,[t.need_attach_slug?(l(),i("div",vg,[e("div",yg,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[36]||(o[36]=n=>t.need_attach_slug=n),type:"checkbox",id:"need-slug-attach"},null,512),[[k,t.need_attach_slug]]),$g])])):r("",!0),t.need_attach_slug?(l(),i("div",kg,[t.pageForm.next_bot_menu_slug_id?(l(),i("p",Fg,[u("Связано со скриптом #"+h(t.pageForm.next_bot_menu_slug_id)+" ",1),e("a",{class:"btn btn-link",onClick:o[37]||(o[37]=n=>t.pageForm.next_bot_menu_slug_id=null)},"Очистить")])):r("",!0),t.bot?(l(),F(Pr,{key:1,global:!0,onCallback:t.associateSlug,bot:t.bot},null,8,["onCallback","bot"])):r("",!0)])):(l(),i("div",Cg,[e("div",wg,[e("div",jg,[c(e("img",Sg,null,512),[[d,"../images/icon.png"]])]),Vg,Pg,e("div",Ug,[e("button",{disabled:t.need_attach_slug,onClick:o[38]||(o[38]=n=>t.need_attach_slug=!0),class:b([{"btn-primary":!t.need_attach_slug,"btn-outline-secondary":t.need_attach_slug},"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill"]),type:"button"}," Добавить ",10,Bg),Og])])]))])):r("",!0),t.tab===9?(l(),i("div",Tg,[t.need_attach_dialog?(l(),i("div",Ig,[e("div",qg,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[39]||(o[39]=n=>t.need_attach_dialog=n),type:"checkbox",id:"need-dialog-attach"},null,512),[[k,t.need_attach_dialog]]),Dg])])):r("",!0),t.need_attach_dialog?(l(),i("div",Rg,[t.pageForm.next_bot_dialog_command_id?(l(),i("p",Lg,[u("Связано с диалогом #"+h(t.pageForm.next_bot_dialog_command_id)+" ",1),e("a",{class:"btn btn-link",onClick:o[40]||(o[40]=n=>t.pageForm.next_bot_dialog_command_id=null)},"Очистить")])):r("",!0),t.bot?(l(),F(O_,{key:1,onSelectDialog:t.associateDialog,bot:t.bot},null,8,["onSelectDialog","bot"])):r("",!0)])):(l(),i("div",xg,[e("div",Mg,[e("div",Ag,[c(e("img",Eg,null,512),[[d,"../images/icon.png"]])]),zg,Kg,e("div",Ng,[e("button",{disabled:t.need_attach_dialog,onClick:o[41]||(o[41]=n=>t.need_attach_dialog=!0),class:b([{"btn-primary":!t.need_attach_dialog,"btn-outline-secondary":t.need_attach_dialog},"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill"]),type:"button"}," Добавить ",10,Yg),Jg])])]))])):r("",!0),t.tab===10?(l(),i("div",Wg,[t.need_rules?(l(),i("div",Hg,[e("div",Gg,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[42]||(o[42]=n=>t.need_rules=n),type:"checkbox",id:"need-rules"},null,512),[[k,t.need_rules]]),Qg])])):r("",!0),t.need_rules?(l(),i("div",Xg,[v(sm,{bot:t.bot,"rules-form":t.pageForm},null,8,["bot","rules-form"])])):(l(),i("div",Zg,[e("div",ef,[e("div",tf,[c(e("img",sf,null,512),[[d,"../images/icon.png"]])]),of,lf,e("div",nf,[e("button",{disabled:t.need_rules,onClick:o[43]||(o[43]=n=>t.need_rules=!0),class:b([{"btn-primary":!t.need_rules,"btn-outline-secondary":t.need_rules},"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill"]),type:"button"}," Добавить ",10,af),df])])]))])):r("",!0)]))],32)):r("",!0),e("div",rf,[e("div",cf,[e("div",uf,[_f,e("div",hf,[t.bot?(l(),i("div",mf,[e("div",pf,[e("h6",bf,[e("span",null,"Вы создаете страницу для "+h(t.bot.bot_domain),1)])])])):r("",!0),e("form",{onSubmit:o[48]||(o[48]=j((...n)=>t.submitPage&&t.submitPage(...n),["prevent"])),class:"row"},[e("div",gf,[ff,e("ul",vf,[e("li",{class:b({active:t.need_page_images})},$f,2),e("li",{class:b({active:t.need_page_sticker})},Ff,2),e("li",{class:b({active:t.need_page_video})},wf,2),e("li",{class:b({active:t.need_page_audios})},Sf,2),e("li",{class:b({active:t.need_page_documents})},Pf,2),e("li",{class:b({active:t.need_attach_page})},Bf,2),e("li",{class:b({active:t.need_attach_slug})},Tf,2),e("li",{class:b({active:t.need_attach_dialog})},qf,2),e("li",{class:b({active:t.need_rules})},Rf,2),e("li",{class:b({active:t.need_reply_menu})},xf,2),e("li",{class:b({active:t.need_inline_menu})},Af,2)])]),t.pageForm.id?(l(),i("div",Ef,[e("div",zf,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[45]||(o[45]=n=>t.need_show_qr_and_link=n),type:"checkbox",id:"need-show-qr-and-link"},null,512),[[k,t.need_show_qr_and_link]]),Kf])])):r("",!0),t.pageForm.id&&t.need_show_qr_and_link?(l(),i("div",Nf,[e("p",null,[u("Ссылка на текущую страницу: "),e("span",{class:"bg-secondary font-bold cursor-pointer",onClick:o[46]||(o[46]=n=>t.copyToClipBoard(t.pageLink))},h(t.pageLink),1)]),e("div",Yf,[c(e("img",Jf,null,512),[[d,t.qr]])])])):r("",!0),e("div",Wf,[e("label",Hf,[v(a,null,{content:g(()=>[Qf]),default:g(()=>[Gf]),_:1}),u(" Описание страницы "),Xf]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Описание страницы","aria-label":"Описание страницы","onUpdate:modelValue":o[47]||(o[47]=n=>t.pageForm.comment=n),maxlength:"255","aria-describedby":"bot-domain",required:""},`
            `,512),[[p,t.pageForm.comment]])]),Zf],32)]),ev])])]),e("div",tv,[e("div",sv,[e("div",ov,[e("div",lv,[v(R,{editor:!0,current:t.page,onCallback:t.pageListCallback},null,8,["current","onCallback"])])])])])],64)}}}),nv={props:["bot","item"],data(){return{sectionForm:{section:null},categoryForm:{label:null},tab:0,types:[{title:"Готовый продукт",value:1},{title:"Товар на вес",value:2},{title:"Конструктор товара",value:3}],productCategories:[],sections:["Общие характеристики","Дополнительная информация"],photos:[],categories:[],removed_options:[],productForm:{article:null,vk_product_id:null,title:null,description:null,images:[],type:1,old_price:null,current_price:null,variants:[],in_stop_list_at:null,bot_id:null,options:[],reviews:[],categories:[]}}},computed:{...w(["getProductCategories"]),filteredCategories(){return this.productCategories.length===0?this.categories:this.categories.filter(s=>this.productCategories.indexOf(s.value)===-1)}},mounted(){this.loadProductCategories(),this.item&&this.$nextTick(()=>{this.productForm={id:this.item.id||null,article:this.item.article||null,vk_product_id:this.item.vk_product_id||null,title:this.item.title||null,description:this.item.description||null,images:this.item.images||null,type:this.item.type||1,old_price:this.item.old_price||null,current_price:this.item.current_price||null,variants:this.item.variants||null,in_stop_list_at:this.item.in_stop_list_at||null,bot_id:this.item.bot_id||null,options:this.item.options||null,reviews:this.item.reviews||null},this.options=[],this.item.categories.forEach(s=>{this.productCategories.push(s.id)})})},methods:{prepareCategoryName(s){let t=this.categories.find(o=>o.value===s);return console.log(t),t?t.label:s},addCategory(){const s=this.categoryForm.label;this.productCategories.push(s),this.categoryForm.label=null},selectCategory(s){this.productCategories.push(s.value)},submit(){let s=new FormData;if(Object.keys(this.productForm).forEach(t=>{const o=this.productForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.bot&&s.append("bot_id",this.bot.id),this.photos.length>0)for(let t=0;t<this.photos.length;t++)s.append("photos[]",this.photos[t]);this.removed_options.length>0&&s.append("removed_options",JSON.stringify(this.removed_options)),this.productCategories.length>0&&s.append("categories",JSON.stringify(this.productCategories)),this.$store.dispatch("saveProduct",{productForm:s}).then(t=>{this.load=!0,this.$notify({title:"Конструктор ботов",text:"Продукт успешно сохранен!",type:"success"}),this.clearForm(),this.$emit("refresh")}).catch(t=>{})},onChangePhotos(s){const t=s.target.files;for(let o=0;o<t.length;o++)this.photos.push(t[o])},loadProductCategories(){this.$store.dispatch("loadProductCategories",{dataObject:{bot_id:this.bot.id}}).then(()=>{this.getProductCategories.forEach(t=>{this.categories.push({value:t.id,label:t.title})})})},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removeSection(s){this.sections.splice(s,1)},addSection(){this.sections.push(this.sectionForm.section),this.sectionForm.section=null},addOption(){this.productForm.options||(this.productForm.options=[]),this.productForm.options.push({id:null,key:null,value:null,title:null,section:null})},addVariant(){this.productForm.variants||(this.productForm.variants=[]),this.productForm.variants.push({key:null,value:null})},removeProductCategory(s){this.productCategories.splice(s,1)},removeVariant(s){this.productForm.variants.splice(s,1)},removeOption(s){this.productForm.options[s].id&&this.removed_options.push(this.productForm.options[s].id),this.productForm.options.splice(s,1)},removeImage(s){this.productForm.images.splice(s,1)},removePhoto(s){this.photos.splice(s,1)},clearForm(){const s={article:null,vk_product_id:null,title:null,description:null,images:[],type:1,old_price:null,current_price:null,variants:[],in_stop_list_at:null,bot_id:null,options:[],reviews:[],categories:[]};this.photos=[],this.removed_options=[],this.productCategories=[],this.productForm=s}}},av={class:"nav nav-tabs"},dv={class:"nav-item"},rv={class:"nav-item"},cv={class:"nav-item"},uv={key:0},_v={class:"col-md-8 d-flex align-items-center"},hv={class:"form-check"},mv=e("label",{class:"form-check-label",for:"in-stop-list"}," Товар находится в стоп-листе ",-1),pv={class:"col-md-4 d-flex justify-content-end"},bv={class:"col-md-12 mb-3"},gv=["onClick"],fv={class:"dropdown"},vv=e("button",{type:"button",class:"btn btn-outline-info w-100","data-bs-toggle":"dropdown","data-bs-display":"static","aria-expanded":"false"},[e("p",{class:"mb-0"},"Выберите категорию")],-1),yv={class:"dropdown-menu w-100",style:{"overflow-y":"scroll",height:"300px"}},$v={class:"p-3"},kv=e("label",{for:"exampleDropdownFormEmail1",class:"form-label"},"Новая категория",-1),Fv={class:"p-3"},Cv=e("li",null,[e("hr",{class:"dropdown-divider"})],-1),wv=["onClick"],jv={class:"col-md-6"},Sv={class:"form-floating mb-3"},Vv=e("label",{for:"article"},"Артикул товара",-1),Pv={class:"col-md-6"},Uv={class:"form-floating mb-3"},Bv=e("label",{for:"vk-product-id"},"Идентификатор товара VK",-1),Ov={class:"col-md-6"},Tv={class:"form-floating mb-3"},Iv=e("label",{for:"title"},"Названи товара",-1),qv={class:"col-md-6"},Dv={class:"form-floating mb-3"},Rv=["value"],Lv=e("label",{for:"type"},"Тип товара",-1),xv={class:"col-md-12"},Mv={class:"form-floating mb-3"},Av=e("label",{for:"description"},"Описание товара",-1),Ev={class:"col-md-6"},zv={class:"form-floating mb-3"},Kv=e("label",{for:"current-price"},"Актуальная цена",-1),Nv={class:"col-md-6"},Yv={class:"form-floating mb-3"},Jv=e("label",{for:"old-price"},"Старая цена",-1),Wv={class:"col-md-12 mb-3"},Hv={class:"card"},Gv={class:"card-header"},Qv={key:0},Xv={class:"card-body"},Zv={class:"row"},ey={class:"col-12 mb-3"},ty={class:"col-md-6 mb-3"},sy={class:"card w-100"},oy={class:"card-body"},ly={class:"form-floating mb-3"},iy=["onUpdate:modelValue","id"],ny=["for"],ay={class:"form-floating mb-3"},dy=["onUpdate:modelValue","id"],ry=["for"],cy={class:"card-footer"},uy=["onClick"],_y=e("i",{class:"fa-solid fa-trash-can"},null,-1),hy=[_y],my={class:"col-md-12 mb-3"},py={class:"card"},by=e("div",{class:"card-header"},[e("h6",null,"Характеристики товара")],-1),gy={class:"card-body"},fy={class:"row mb-3"},vy={class:"col-12"},yy=e("button",{class:"btn btn-outline-info",type:"submit",id:"button-addon2"},"Добавить секцию ",-1),$y={class:"badge bg-info mr-1"},ky=["onClick"],Fy=e("i",{class:"fa-solid fa-xmark"},null,-1),Cy=[Fy],wy={class:"row"},jy={class:"col-md-4 mb-3"},Sy={class:"card w-100"},Vy={class:"card-body"},Py={class:"form-floating mb-3"},Uy=["onUpdate:modelValue","id"],By=["for"],Oy={class:"form-floating mb-3"},Ty=["onUpdate:modelValue","id"],Iy=["for"],qy={class:"form-floating mb-3"},Dy=["onUpdate:modelValue","id"],Ry=e("option",{value:null},"Без секции",-1),Ly=["value"],xy=["for"],My={class:"card-footer"},Ay=["onClick"],Ey=e("i",{class:"fa-solid fa-trash-can"},null,-1),zy=[Ey],Ky={class:"row"},Ny={class:"col-12"},Yy={class:"col-md-12 mb-3"},Jy=e("h6",null,"Фотографии товара",-1),Wy={class:"photo-preview d-flex justify-content-start flex-wrap w-100"},Hy={for:"location-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},Gy=e("span",null,"+",-1),Qy={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Xy={class:"remove"},Zy=["onClick"],e$={class:"mb-2 img-preview",style:{"margin-right":"10px"}},t$={class:"remove"},s$=["onClick"],o$=e("div",{class:"col-12"},[e("button",{type:"submit",class:"btn btn-outline-primary w-100 p-3"},"Сохранить ")],-1),l$={key:1};function i$(s,t,o,a,d,n){const m=q("lazy");return l(),i(f,null,[e("ul",av,[e("li",dv,[e("a",{class:b(["nav-link",{active:d.tab===0}]),onClick:t[0]||(t[0]=_=>d.tab=0),"aria-current":"page",href:"#product-form-info"},"Информация о товаре",2)]),e("li",rv,[e("a",{class:b(["nav-link",{active:d.tab===1}]),onClick:t[1]||(t[1]=_=>d.tab=1),href:"#product-reviews"},"Комментарии",2)]),e("li",cv,[e("a",{class:b(["nav-link",{active:d.tab===2}]),onClick:t[2]||(t[2]=_=>d.tab=2),href:"#product-reviews"},"Заказы",2)])]),d.tab===0?(l(),i("div",uv,[e("form",{onSubmit:t[19]||(t[19]=j((..._)=>n.submit&&n.submit(..._),["prevent"])),class:"row"},[e("div",_v,[e("div",hv,[c(e("input",{class:"form-check-input","onUpdate:modelValue":t[3]||(t[3]=_=>d.productForm.in_stop_list_at=_),type:"checkbox",value:"false",id:"in-stop-list"},null,512),[[k,d.productForm.in_stop_list_at]]),mv])]),e("div",pv,[e("a",{href:"#",class:"btn btn-link",onClick:t[4]||(t[4]=(..._)=>n.clearForm&&n.clearForm(..._))},"Новый товар")]),e("div",bv,[(l(!0),i(f,null,$(d.productCategories,(_,y)=>(l(),i("span",{class:"badge bg-info mr-1 mb-1 cursor-pointer",onClick:C=>n.removeProductCategory(y)},h(n.prepareCategoryName(_)),9,gv))),256)),e("div",fv,[vv,e("ul",yv,[e("div",$v,[kv,c(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[5]||(t[5]=_=>d.categoryForm.label=_),id:"exampleDropdownFormEmail1",placeholder:"Название категории"},null,512),[[p,d.categoryForm.label]])]),e("div",Fv,[e("button",{class:"btn btn-primary w-100",type:"button",onClick:t[6]||(t[6]=(..._)=>n.addCategory&&n.addCategory(..._))},"Добавить категорию ")]),Cv,(l(!0),i(f,null,$(n.filteredCategories,_=>(l(),i("li",null,[e("button",{class:"dropdown-item",type:"button",onClick:y=>n.selectCategory(_)},h(_.label),9,wv)]))),256))])])]),e("div",jv,[e("div",Sv,[c(e("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=_=>d.productForm.article=_),class:"form-control",id:"article",placeholder:"name@example.com"},null,512),[[p,d.productForm.article]]),Vv])]),e("div",Pv,[e("div",Uv,[c(e("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=_=>d.productForm.vk_product_id=_),disabled:!0,class:"form-control",id:"vk-product-id",placeholder:"name@example.com"},null,512),[[p,d.productForm.vk_product_id]]),Bv])]),e("div",Ov,[e("div",Tv,[c(e("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=_=>d.productForm.title=_),class:"form-control",id:"title",placeholder:"name@example.com"},null,512),[[p,d.productForm.title]]),Iv])]),e("div",qv,[e("div",Dv,[c(e("select",{class:"form-select","onUpdate:modelValue":t[10]||(t[10]=_=>d.productForm.type=_),id:"type","aria-label":"Floating label select example"},[(l(!0),i(f,null,$(d.types,(_,y)=>(l(),i("option",{value:_.value},h(_.title),9,Rv))),256))],512),[[V,d.productForm.type]]),Lv])]),e("div",xv,[e("div",Mv,[c(e("textarea",{class:"form-control","onUpdate:modelValue":t[11]||(t[11]=_=>d.productForm.description=_),placeholder:"Leave a comment here",id:"description"},null,512),[[p,d.productForm.description]]),Av])]),e("div",Ev,[e("div",zv,[c(e("input",{type:"number","onUpdate:modelValue":t[12]||(t[12]=_=>d.productForm.current_price=_),class:"form-control",id:"current-price",placeholder:"name@example.com"},null,512),[[p,d.productForm.current_price]]),Kv])]),e("div",Nv,[e("div",Yv,[c(e("input",{type:"number","onUpdate:modelValue":t[13]||(t[13]=_=>d.productForm.old_price=_),class:"form-control",id:"old-price",placeholder:"name@example.com"},null,512),[[p,d.productForm.old_price]]),Jv])]),e("div",Wv,[e("div",Hv,[e("div",Gv,[e("h6",null,[u("Варианты товара "),d.productForm.variants?(l(),i("span",Qv,"("+h(d.productForm.variants.length)+")",1)):r("",!0)])]),e("div",Xv,[e("div",Zv,[e("div",ey,[e("button",{type:"button",class:"btn btn-outline-info w-100",onClick:t[14]||(t[14]=(..._)=>n.addVariant&&n.addVariant(..._))},"Добавить вариант ")]),(l(!0),i(f,null,$(d.productForm.variants,(_,y)=>(l(),i("div",ty,[e("div",sy,[e("div",oy,[e("div",ly,[c(e("input",{type:"text","onUpdate:modelValue":C=>d.productForm.variants[y].key=C,class:"form-control",id:"variant-key-"+y,placeholder:"name@example.com",required:""},null,8,iy),[[p,d.productForm.variants[y].key]]),e("label",{for:"variant-key-"+y},"Ключ",8,ny)]),e("div",ay,[c(e("input",{type:"text","onUpdate:modelValue":C=>d.productForm.variants[y].value=C,class:"form-control",id:"variant-value-"+y,placeholder:"name@example.com",required:""},null,8,dy),[[p,d.productForm.variants[y].value]]),e("label",{for:"variant-value-"+y},"Значение",8,ry)])]),e("div",cy,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:C=>n.removeVariant(y)},hy,8,uy)])])]))),256))])])])]),e("div",my,[e("div",py,[by,e("div",gy,[e("div",fy,[e("div",vy,[e("form",{onSubmit:t[16]||(t[16]=j((..._)=>n.addSection&&n.addSection(..._),["prevent"])),class:"input-group mb-3"},[c(e("input",{type:"text","onUpdate:modelValue":t[15]||(t[15]=_=>d.sectionForm.section=_),class:"form-control border-info",placeholder:"Название секции","aria-label":"Recipient's username","aria-describedby":"button-addon2",required:""},null,512),[[p,d.sectionForm.section]]),yy],32),(l(!0),i(f,null,$(d.sections,(_,y)=>(l(),i("span",$y,[u(h(_)+" ",1),e("strong",{onClick:C=>n.removeSection(y)},Cy,8,ky)]))),256))])]),e("div",wy,[(l(!0),i(f,null,$(d.productForm.options,(_,y)=>(l(),i("div",jy,[e("div",Sy,[e("div",Vy,[e("div",Py,[c(e("input",{type:"text","onUpdate:modelValue":C=>d.productForm.options[y].title=C,class:"form-control",id:"option-title-"+y,placeholder:"name@example.com"},null,8,Uy),[[p,d.productForm.options[y].title]]),e("label",{for:"option-title-"+y},"Название характеристики",8,By)]),e("div",Oy,[c(e("input",{type:"text","onUpdate:modelValue":C=>d.productForm.options[y].value=C,class:"form-control",id:"option-value-"+y,placeholder:"name@example.com"},null,8,Ty),[[p,d.productForm.options[y].value]]),e("label",{for:"option-value-"+y},"Значение характеристики",8,Iy)]),e("div",qy,[c(e("select",{class:"form-select","onUpdate:modelValue":C=>d.productForm.options[y].section=C,id:"option-section-"+y,"aria-label":"Floating label select example"},[Ry,(l(!0),i(f,null,$(d.sections,C=>(l(),i("option",{value:C},h(C),9,Ly))),256))],8,Dy),[[V,d.productForm.options[y].section]]),e("label",{for:"option-section-"+y},"Секция товара",8,xy)])]),e("div",My,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:C=>n.removeOption(y)},zy,8,Ay)])])]))),256))]),e("div",Ky,[e("div",Ny,[e("button",{type:"button",class:"btn btn-outline-info w-100",onClick:t[17]||(t[17]=(..._)=>n.addOption&&n.addOption(..._))},"Добавить характеристику ")])])])])]),e("div",Yy,[Jy,e("div",Wy,[e("label",Hy,[Gy,e("input",{type:"file",id:"location-photos",multiple:"",accept:"image/*",onChange:t[18]||(t[18]=(..._)=>n.onChangePhotos&&n.onChangePhotos(..._)),style:{display:"none"}},null,32)]),d.productForm.images?(l(!0),i(f,{key:0},$(d.productForm.images,(_,y)=>(l(),i("div",Qy,[c(e("img",null,null,512),[[m,_]]),e("div",Xy,[e("a",{onClick:C=>n.removeImage(y)},"Удалить",8,Zy)])]))),256)):r("",!0),d.photos.length>0?(l(!0),i(f,{key:1},$(d.photos,(_,y)=>(l(),i("div",e$,[c(e("img",null,null,512),[[m,n.getPhoto(_).imageUrl]]),e("div",t$,[e("a",{onClick:C=>n.removePhoto(y)},"Удалить",8,s$)])]))),256)):r("",!0)])]),o$],32)])):r("",!0),d.tab===1?(l(),i("div",l$," Отзывы ")):r("",!0)],64)}const n$=P(nv,[["render",i$]]),a$={props:["item"],data(){return{bot:null}},methods:{preparedImgUrl(s){return s.toLocaleLowerCase().startsWith("https://")||s.toLocaleLowerCase().startsWith("http://")?s:"/images-by-bot-id/"+this.bot.id+"/"+s},removeProduct(){this.$store.dispatch("removeProduct",this.item.id).then(s=>{this.$notify({title:"Конструктор ботов",text:"Продукт успешно удален!",type:"success"})}).catch(s=>{})},duplicateProduct(){this.$store.dispatch("duplicateProduct",this.item.id).then(s=>{this.$notify({title:"Конструктор ботов",text:"Продукт успешно продублирован!",type:"success"})}).catch(s=>{})}},mounted(){this.bot=this.getCurrentBot},computed:{...w(["getCurrentBot"])}},d$={key:0,class:"card"},r$={class:"card-header"},c$={class:"card-body"},u$=["id"],_$={class:"carousel-inner"},h$=["src"],m$=["data-bs-target"],p$=e("span",{class:"carousel-control-prev-icon","aria-hidden":"true"},null,-1),b$=e("span",{class:"visually-hidden"},"Previous",-1),g$=[p$,b$],f$=["data-bs-target"],v$=e("span",{class:"carousel-control-next-icon","aria-hidden":"true"},null,-1),y$=e("span",{class:"visually-hidden"},"Next",-1),$$=[v$,y$],k$={class:"card-footer d-flex justify-content-between"},F$=e("i",{class:"fa-regular fa-copy"},null,-1),C$=[F$],w$=e("i",{class:"fa-solid fa-trash-can"},null,-1),j$=[w$];function S$(s,t,o,a,d,n){return d.bot?(l(),i("div",d$,[e("div",r$,[e("p",null,"#"+h(o.item.id),1)]),e("div",c$,[e("p",null,h(o.item.title),1),e("div",{id:"image-slider-"+o.item.id,class:"carousel slide","data-bs-ride":"carousel"},[e("div",_$,[(l(!0),i(f,null,$(o.item.images,(m,_)=>(l(),i("div",{class:b(["carousel-item",{active:_===0}]),style:{height:"300px"}},[e("img",{src:n.preparedImgUrl(m),class:"d-block w-100 object-fit-cover",alt:"..."},null,8,h$)],2))),256))]),e("button",{class:"carousel-control-prev",type:"button","data-bs-target":"#image-slider-"+o.item.id,"data-bs-slide":"prev"},g$,8,m$),e("button",{class:"carousel-control-next",type:"button","data-bs-target":"#image-slider-"+o.item.id,"data-bs-slide":"next"},$$,8,f$)],8,u$)]),e("div",k$,[e("button",{title:"Дублировать товар",onClick:t[0]||(t[0]=(...m)=>n.duplicateProduct&&n.duplicateProduct(...m)),class:"btn btn-outline-info mr-1"},C$),e("button",{title:"Удалить товар",onClick:t[1]||(t[1]=(...m)=>n.removeProduct&&n.removeProduct(...m)),class:"btn btn-outline-danger"},j$)])])):r("",!0)}const V$=P(a$,[["render",S$]]),P$=e("button",{class:"btn btn-outline-info",type:"submit",id:"button-addon2"}," Найти ",-1),U$={key:0},B$={class:"row"},O$={class:"col-4 mb-2"},T$={props:["bot"],data(){return{search:null,products:[],paginate:null}},computed:{...w(["getProducts","getProductsPaginateObject"]),filteredProducts(){return this.search?this.products.filter(s=>s.title.toLowerCase().trim().indexOf(this.search.toLowerCase().trim())>=0):this.products}},mounted(){this.loadProducts()},methods:{selectProduct(s){this.$emit("select",s)},nextProducts(s){this.loadProducts(s)},loadProducts(s=0){return this.$store.dispatch("loadProducts",{dataObject:{bot_id:this.bot.id,search:this.search},page:s}).then(()=>{this.products=this.getProducts,this.paginate=this.getProductsPaginateObject})}}},I$=Object.assign(T$,{__name:"ProductList",setup(s){return(t,o)=>(l(),i(f,null,[e("form",{class:"input-group mb-3",onSubmit:o[1]||(o[1]=j(a=>t.loadProducts(0),["prevent"]))},[c(e("input",{type:"text",class:"form-control border-info",placeholder:"Поиск товара","aria-label":"Поиск товара","onUpdate:modelValue":o[0]||(o[0]=a=>t.search=a),"aria-describedby":"button-addon2",required:""},null,512),[[p,t.search]]),P$],32),e("p",null,[u("Всего товаров: "),t.paginate?(l(),i("span",U$,h(t.paginate.meta.total||0),1)):r("",!0)]),e("div",B$,[(l(!0),i(f,null,$(t.filteredProducts,(a,d)=>(l(),i("div",O$,[v(V$,{onClick:n=>t.selectProduct(a),item:a},null,8,["onClick","item"])]))),256))]),t.paginate?(l(),F(S,{key:0,onPagination_page:t.nextProducts,pagination:t.paginate},null,8,["onPagination_page","pagination"])):r("",!0)],64))}}),q$={class:"card mb-2"},D$=e("div",{class:"card-header"},[e("h6",null,"Управление магазином")],-1),R$={class:"card-body"},L$={class:"row"},x$={class:"col-12"},M$={class:"form-label d-flex justify-content-between mt-2",id:"bot-level-3"},A$=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),E$=e("div",null,"Ссылка на страницу ВК с товарами для вашего магазина в боте ",-1),z$=e("a",{href:"https://vk.com/groups?w=groups_create",target:"_blank"},"Создать",-1),K$=["disabled"],N$=e("i",{class:"fa-regular fa-floppy-disk mr-2"},null,-1),Y$={class:"row mb-3"},J$={class:"col-md-3"},W$=["href"],H$=A('<div class="col-md-3"><button class="btn btn-outline-info w-100">Экспорт в XLS</button></div><div class="col-md-3"><button class="btn btn-outline-info w-100">Импорт из XLS</button></div><div class="col-md-3"><button class="btn btn-outline-danger w-100">Удалить товары</button></div>',3),G$=e("div",{class:"row"},[e("div",{class:"col-md-3"},[e("button",{class:"btn btn-outline-info w-100"},"Экспортировать заказы")])],-1),Q$={class:"card"},X$=e("div",{class:"card-header"},[e("h6",null,"Работа с товаром")],-1),Z$={class:"card-body"},e2={class:"card mt-2"},t2={class:"card-body"},s2={data(){return{load:!1,tab:0,url:null,link:null,bot:null,selectedProduct:null,botForm:{vk_shop_link:null}}},computed:{...w(["getCurrentBot"])},mounted(){this.bot=this.getCurrentBot,this.botForm.vk_shop_link=this.bot.vk_shop_link||null,this.updateProducts()},methods:{updateShopLink(){this.load=!0,this.botForm.bot_id=this.bot.id,this.$store.dispatch("updateShopLink",{botForm:this.botForm}).then(s=>{this.load=!1,this.updateProducts(),this.$notify({title:"Менеджер магазина",text:"Ссылка на источник в ВК обновлена"})}).catch(()=>{this.load=!1})},refresh(){this.load=!0,this.selectedProduct=null,this.$nextTick(()=>{this.load=!1})},selectProduct(s){this.load=!0,this.$nextTick(()=>{this.selectedProduct=s,this.load=!1})},updateProducts(){this.load=!0,this.$store.dispatch("updateProductsFromVk",{dataObject:{bot_domain:this.getCurrentBot.bot_domain}}).then(s=>{this.link=s.data.url,this.load=!1,this.url=null}).catch(()=>{this.load=!1})}}},UF=Object.assign(s2,{__name:"Shop",setup(s){return(t,o)=>{const a=U("Popper");return l(),i(f,null,[e("div",q$,[D$,e("div",R$,[e("div",L$,[e("div",x$,[e("form",{onSubmit:o[1]||(o[1]=j((...d)=>t.updateShopLink&&t.updateShopLink(...d),["prevent"])),class:"mb-2"},[e("label",M$,[e("div",null,[v(a,null,{content:g(()=>[E$]),default:g(()=>[A$]),_:1}),u(" ВК-группа ")]),z$]),c(e("input",{type:"url",class:"form-control",placeholder:"Ссылка на группу ВК","aria-label":"ссылка на группу ВК","onUpdate:modelValue":o[0]||(o[0]=d=>t.botForm.vk_shop_link=d),"aria-describedby":"vk_shop_link"},null,512),[[p,t.botForm.vk_shop_link]]),e("button",{disabled:t.load,class:"btn btn-outline-primary mt-2 mb-2 w-100"},[N$,u(" Сохранить ")],8,K$)],32)])]),e("div",Y$,[e("div",J$,[e("a",{target:"_blank",href:t.link,class:"btn btn-primary w-100"}," Обновить товар ",8,W$)]),H$]),G$])]),e("div",Q$,[X$,e("div",Z$,[t.bot&&!t.load?(l(),F(n$,{key:0,bot:t.bot,item:t.selectedProduct,onRefresh:t.refresh},null,8,["bot","item","onRefresh"])):r("",!0)])]),e("div",e2,[e("div",t2,[t.bot&&!t.load?(l(),F(I$,{key:0,bot:t.bot,onSelect:t.selectProduct},null,8,["bot","onSelect"])):r("",!0)])])],64)}}}),o2={props:["data"],data(){return{hasConnect:!1,bot:null,amoForm:{client_id:null,client_secret:null,auth_code:null,redirect_uri:null,subdomain:null,bot_id:null}}},computed:{...w(["getCurrentBot"])},mounted(){this.bot=this.getCurrentBot,this.data?this.$nextTick(()=>{this.amoForm.client_id=this.data.client_id||null,this.amoForm.client_secret=this.data.client_secret||null,this.amoForm.auth_code=this.data.auth_code||null,this.amoForm.redirect_uri=this.data.redirect_uri||null,this.amoForm.subdomain=this.data.subdomain||null,this.amoForm.bot_id=this.data.bot_id||this.bot.id||null}):this.amoForm.bot_id=this.bot.id||null},methods:{submitAmo(){let s=new FormData;Object.keys(this.amoForm).forEach(t=>{const o=this.amoForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.$store.dispatch("saveAmoCRM",{amoForm:s}).then(t=>{this.$notify("Данные CRM успешно сохранены")}).catch(t=>{})}}},l2=e("div",{class:"col-12"},[e("p",null,[e("a",{target:"_blank",href:"https://www.amocrm.ru/developers/content/oauth/step-by-step"},"Документация для разработчика "),u(" по шагам")])],-1),i2={class:"col-md-6 col-12 mb-2"},n2={class:"form-label",id:"client_id"},a2=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),d2=e("div",null,"ID интеграции",-1),r2=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),c2={class:"col-md-6 col-12 mb-2"},u2={class:"form-label",id:"client_secret"},_2=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),h2=e("div",null,"Секрет интеграции",-1),m2=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),p2={class:"col-md-6 mb-2"},b2={class:"form-label",id:"auth_code"},g2=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),f2=e("div",null,"Полученный код авторизации",-1),v2=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),y2={class:"col-md-6 col-12 mb-2"},$2={class:"form-label",id:"subdomain2"},k2=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),F2=e("div",null,"Ваш поддомен в системе AMO CRM",-1),C2=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),w2=e("div",{class:"col-md-12 col-12"},[e("button",{type:"submit",class:"btn btn-outline-primary p-3 w-100"},[e("i",{class:"fa-solid fa-cloud-arrow-down mr-1"}),u(" Сохранить настройку AMO ")])],-1);function j2(s,t,o,a,d,n){const m=U("Popper");return l(),i("form",{onSubmit:t[4]||(t[4]=j((..._)=>n.submitAmo&&n.submitAmo(..._),["prevent"])),class:"row"},[l2,e("div",i2,[e("label",n2,[v(m,null,{content:g(()=>[d2]),default:g(()=>[a2]),_:1}),u(" client_id "),r2]),c(e("input",{type:"text",class:"form-control",placeholder:"client_id","aria-label":"client_id","onUpdate:modelValue":t[0]||(t[0]=_=>d.amoForm.client_id=_),"aria-describedby":"client_id"},null,512),[[p,d.amoForm.client_id]])]),e("div",c2,[e("label",u2,[v(m,null,{content:g(()=>[h2]),default:g(()=>[_2]),_:1}),u(" client_secret "),m2]),c(e("input",{type:"text",class:"form-control",placeholder:"client_secret","aria-label":"client_secret","onUpdate:modelValue":t[1]||(t[1]=_=>d.amoForm.client_secret=_),"aria-describedby":"client_secret"},null,512),[[p,d.amoForm.client_secret]])]),e("div",p2,[e("label",b2,[v(m,null,{content:g(()=>[f2]),default:g(()=>[g2]),_:1}),u(" auth_code "),v2]),c(e("textarea",{class:"form-control",placeholder:"auth_code","aria-label":"auth_code","onUpdate:modelValue":t[2]||(t[2]=_=>d.amoForm.auth_code=_),"aria-describedby":"auth_code"},`
                                    `,512),[[p,d.amoForm.auth_code]])]),e("div",y2,[e("label",$2,[v(m,null,{content:g(()=>[F2]),default:g(()=>[k2]),_:1}),u(" subdomain "),C2]),c(e("input",{type:"text",class:"form-control",placeholder:"subdomain","aria-label":"subdomain","onUpdate:modelValue":t[3]||(t[3]=_=>d.amoForm.subdomain=_),"aria-describedby":"subdomain"},null,512),[[p,d.amoForm.subdomain]])]),w2],32)}const BF=P(o2,[["render",j2]]),S2={props:["data"],data(){return{load:!1,bot:null,yClientsForm:{login:null,password:null,partner_token:null,company:null}}},computed:{...w(["getCurrentBot"])},mounted(){this.bot=this.getCurrentBot,this.data&&this.$nextTick(()=>{this.yClientsForm.login=this.data.login||null,this.yClientsForm.password=this.data.password||null,this.yClientsForm.partner_token=this.data.partner_token||null,this.yClientsForm.company=this.data.company||null})},methods:{submitYClients(){let s=new FormData;Object.keys(this.yClientsForm).forEach(t=>{const o=this.yClientsForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),s.append("bot_id",this.bot.id),this.$store.dispatch("saveYClients",{yClientsForm:s}).then(t=>{this.$notify({title:"Работа с YClients",text:"Данные YClients успешно сохранены",type:"success"})}).catch(t=>{this.$notify({title:"Работа с YClients",text:"Ошибка сохранения данных",type:"error"})})}}},V2=e("h6",null,"Настройка YClients",-1),P2={class:"row"},U2={class:"col-md-12"},B2={class:"mb-2"},O2=e("label",{class:"form-label d-flex justify-content-between mt-2",for:"login"},[u(" Логин "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),T2={class:"mb-2"},I2=e("label",{class:"form-label d-flex justify-content-between mt-2",for:"password"},[u(" Пароль "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),q2={class:"mb-2"},D2=e("label",{class:"form-label d-flex justify-content-between mt-2",for:"partner_token"},[u(" Партнерский тоукен "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),R2={class:"mb-2"},L2=e("label",{class:"form-label d-flex justify-content-between mt-2",for:"partner_token"},[u(" ID компании, в которую записывать клиентов "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),x2=e("button",{class:"btn btn-success w-100 r mb-3 text-uppercase font-900"}," Сохранить ",-1);function M2(s,t,o,a,d,n){return l(),i(f,null,[V2,e("form",{onSubmit:t[4]||(t[4]=j((...m)=>n.submitYClients&&n.submitYClients(...m),["prevent"]))},[e("div",P2,[e("div",U2,[e("div",B2,[O2,c(e("input",{type:"text",id:"login",class:"form-control",placeholder:"Ваш логин","aria-label":"Ваш логин","onUpdate:modelValue":t[0]||(t[0]=m=>d.yClientsForm.login=m),"aria-describedby":"Ваш логин",required:""},null,512),[[p,d.yClientsForm.login]])]),e("div",T2,[I2,c(e("input",{type:"text",id:"password",class:"form-control",placeholder:"Ваш пароль","aria-label":"Ваш пароль","onUpdate:modelValue":t[1]||(t[1]=m=>d.yClientsForm.password=m),"aria-describedby":"Ваш пароль",required:""},null,512),[[p,d.yClientsForm.password]])]),e("div",q2,[D2,c(e("input",{type:"text",id:"partner_token",class:"form-control",placeholder:"Ваш партнерский тоукен","aria-label":"Ваш партнерский тоукен","onUpdate:modelValue":t[2]||(t[2]=m=>d.yClientsForm.partner_token=m),"aria-describedby":"Ваш партнерский тоукен",required:""},null,512),[[p,d.yClientsForm.partner_token]])]),e("div",R2,[L2,c(e("input",{type:"number",id:"throttle",class:"form-control",placeholder:"ID компании","aria-label":"ID компании","onUpdate:modelValue":t[3]||(t[3]=m=>d.yClientsForm.company=m),"aria-describedby":"ID компании",required:""},null,512),[[p,d.yClientsForm.company]])])])]),x2],32)],64)}const OF=P(S2,[["render",M2]]),A2={data(){return{load:!1,bot:null,fieldTypes:[{title:"Текст",value:0},{title:"Число",value:1},{title:"Логический",value:2},{title:"Дата и время",value:3}],fieldForm:{fields:[]}}},computed:{...w(["getCurrentBot"])},mounted(){this.loadCurrentBot().then(()=>{this.bot=this.getCurrentBot,this.$nextTick(()=>{this.fieldForm.fields=this.bot.field_settings||[]}),this.loadCurrentBotFields()})},methods:{loadCurrentBotFields(){return this.$store.dispatch("loadCurrentBotFields",{bot_id:this.bot.id}).then(s=>{this.fieldForm.fields=s.data||[]})},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},removeField(s){this.fieldForm.fields.splice(s,1)},submit(){let s=new FormData;Object.keys(this.fieldForm).forEach(t=>{const o=this.fieldForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),s.append("bot_id",this.bot.id),this.$store.dispatch("storeBotFields",{dataObject:s}).then(t=>{this.$notify({title:"Конструктор ботов",text:"Поля успешно обновлены",type:"success"}),this.fieldForm.fields=[],this.fieldForm.fields=t.data}).catch(t=>{this.$notify({title:"Конструктор ботов",text:"Ошибка обновления полей",type:"error"})})},addField(){if(this.fieldForm.fields||(this.fieldForm.fields=[]),this.fieldForm.fields.length>0&&this.fieldForm.fields.findIndex(t=>t.key==null)!==-1){this.$notify({title:"Настраиваемые поля",text:"У вас есть пустые ключевые поля!",type:"error"});return}this.fieldForm.fields.push({key:null,type:0,label:null,description:null,required:!1,validate_pattern:null})}}},E2={class:"mb-2"},z2={class:"d-flex justify-content-between"},K2=e("h6",null,"Настройка полей пользователя бота",-1),N2=e("i",{class:"fa-solid fa-plus mr-2"},null,-1),Y2=e("p",null,[e("em",null,"Данные поля будут добавлены пользователю бота и будут автоматически учитываться в условиях страниц, скриптах (в формах заполнения данных), диалогах. Ключи должны быть уникальные для каждого бота. Если ключ дублируется, то будет использовано более позднее его значение. Если поле добавлено и сохранено, то удалить его уже нельзя, только скрыть. "),u(". "),e("br"),e("span",{class:"text-danger"},"*"),u(" - обязательное поле ")],-1),J2={class:"table"},W2=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},[u("Ключ"),e("span",{class:"text-danger"},"*")]),e("th",{scope:"col"},[u("Подпись поля"),e("span",{class:"text-danger"},"*")]),e("th",{scope:"col"},[u("Тип поля"),e("span",{class:"text-danger"},"*")]),e("th",{scope:"col"},"Паттерн"),e("th",{scope:"col"},"Обязательный"),e("th",{scope:"col"},[u("Вопрос для анкеты"),e("span",{class:"text-danger"},"*")]),e("th",{scope:"col"})])],-1),H2={scope:"row"},G2={scope:"col"},Q2=["onUpdate:modelValue"],X2={scope:"col"},Z2=["onUpdate:modelValue"],ek={scope:"col"},tk=["onUpdate:modelValue"],sk=["value"],ok={scope:"col"},lk=["disabled","onUpdate:modelValue"],ik={scope:"col"},nk={class:"form-check"},ak=["onUpdate:modelValue","id"],dk=["for"],rk={key:0},ck={key:1},uk={scope:"col"},_k=["onUpdate:modelValue"],hk={scope:"col"},mk=["onClick"],pk=e("i",{class:"fa-regular fa-trash-can"},null,-1),bk=[pk],gk={key:1,class:"form-check mt-2"},fk=["onUpdate:modelValue","id"],vk=["for"],yk={key:0},$k=e("i",{class:"fa-solid fa-eye text-success"},null,-1),kk=[$k],Fk={key:1},Ck=e("i",{class:"fa-solid fa-eye-slash text-danger"},null,-1),wk=[Ck],jk=e("button",{type:"submit",class:"btn btn-success w-100 p-3"}," Сохранить поля ",-1);function Sk(s,t,o,a,d,n){return l(),i("div",E2,[e("div",z2,[K2,e("button",{type:"button",onClick:t[0]||(t[0]=m=>n.addField()),class:"btn mb-2 rounded-sm btn-outline-info"},[N2,u(" Добавить параметр ")])]),Y2,e("form",{onSubmit:t[1]||(t[1]=j((...m)=>n.submit&&n.submit(...m),["prevent"]))},[e("table",J2,[W2,e("tbody",null,[(l(!0),i(f,null,$(d.fieldForm.fields,(m,_)=>(l(),i("tr",null,[e("th",H2,h(_+1),1),e("th",G2,[c(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Ключ","aria-label":"Ключ",maxlength:"255","onUpdate:modelValue":y=>d.fieldForm.fields[_].key=y,required:""},null,8,Q2),[[p,d.fieldForm.fields[_].key]])]),e("th",X2,[c(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Подпись поля","aria-label":"Название поля",maxlength:"255","onUpdate:modelValue":y=>d.fieldForm.fields[_].label=y,required:""},null,8,Z2),[[p,d.fieldForm.fields[_].label]])]),e("th",ek,[c(e("select",{class:"form-select","onUpdate:modelValue":y=>d.fieldForm.fields[_].type=y},[(l(!0),i(f,null,$(d.fieldTypes,y=>(l(),i("option",{value:y.value},h(y.title||"Не указан"),9,sk))),256))],8,tk),[[V,d.fieldForm.fields[_].type]])]),e("th",ok,[c(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Паттерн","aria-label":"Паттерн",maxlength:"255",disabled:d.fieldForm.fields[_].type===2,"onUpdate:modelValue":y=>d.fieldForm.fields[_].validate_pattern=y},null,8,lk),[[p,d.fieldForm.fields[_].validate_pattern]])]),e("th",ik,[e("div",nk,[c(e("input",{class:"form-check-input","onUpdate:modelValue":y=>d.fieldForm.fields[_].required=y,type:"checkbox",value:"",id:"field-required"+_},null,8,ak),[[k,d.fieldForm.fields[_].required]]),e("label",{class:"form-check-label",for:"field-required"+_},[d.fieldForm.fields[_].required?(l(),i("span",rk,"Да")):r("",!0),d.fieldForm.fields[_].required?r("",!0):(l(),i("span",ck,"Нет"))],8,dk)])]),e("th",uk,[c(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Описание вопроса","aria-label":"Описание вопроса",maxlength:"255","onUpdate:modelValue":y=>d.fieldForm.fields[_].description=y,required:""},null,8,_k),[[p,d.fieldForm.fields[_].description]])]),e("th",hk,[d.fieldForm.fields[_].id?(l(),i("div",gk,[c(e("input",{class:"form-check-input d-none","onUpdate:modelValue":y=>d.fieldForm.fields[_].is_active=y,type:"checkbox",value:"",id:"field-is_active-"+_},null,8,fk),[[k,d.fieldForm.fields[_].is_active]]),e("label",{class:"form-check-label",for:"field-is_active-"+_},[d.fieldForm.fields[_].is_active?(l(),i("span",yk,kk)):r("",!0),d.fieldForm.fields[_].is_active?r("",!0):(l(),i("span",Fk,wk))],8,vk)])):(l(),i("button",{key:0,type:"button",onClick:y=>n.removeField(_),class:"btn btn-link text-danger"},bk,8,mk))])]))),256))])]),jk],32)])}const TF=P(A2,[["render",Sk]]),Vk={class:"row"},Pk={class:"input-group mb-3"},Uk={key:0,class:"row"},Bk={class:"col-12 col-md-12 mb-3"},Ok={class:"table"},Tk=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"Тип"),e("th",{scope:"col"},"Подпись"),e("th",{scope:"col"},"File Id"),e("th",{scope:"col"},"Действия")])],-1),Ik={scope:"row"},qk={class:"badge bg-info rounded-pill"},Dk=["onClick"],Rk=["onClick"],Lk={class:"col-12"},xk={key:1,class:"row"},Mk=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет медиа-файлов ")],-1),Ak=[Mk],Ek={data(){return{bot:null,loading:!0,media:[],search:null,media_paginate_object:null}},computed:{...w(["getMedia","getMediaPaginateObject","getCurrentBot"])},mounted(){this.loadCurrentBot().then(()=>{this.loadMedia()})},methods:{selectMedia(s){this.$emit("select",s)},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},nextMedia(s){this.loadMedia(s)},remove(s){this.$store.dispatch("removeMedia",{dataObject:{mediaId:s}}).then(t=>{this.loadMedia(),this.$notify({title:"Удаление медиа-контента",text:"Медиа контент удален"})}).catch(()=>{})},showPreview(s){this.$store.dispatch("showMediaPreview",{dataObject:{mediaId:s}}).then(t=>{this.$notify({title:"Превью медиа-контента",text:"Отправлено в бота"})}).catch(()=>{})},loadMedia(s=0){this.loading=!0,this.$store.dispatch("loadMedia",{dataObject:{bot_id:this.bot.id||null,search:this.search,needVideo:!0,needVideoNote:!0,needPhoto:!0,needAudio:!0,needDocument:!0,needSticker:!0},page:s}).then(t=>{this.loading=!1,this.media=this.getMedia,this.media_paginate_object=this.getMediaPaginateObject}).catch(()=>{this.loading=!1})}}},IF=Object.assign(Ek,{__name:"BotMediaTable",setup(s){return(t,o)=>(l(),i(f,null,[e("div",Vk,[e("div",Pk,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск файла","aria-label":"Поиск файла","onUpdate:modelValue":o[0]||(o[0]=a=>t.search=a)},null,512),[[p,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=a=>t.loadMedia(0)),type:"button",id:"button-addon2"},"Найти ")])]),t.media.length>0?(l(),i("div",Uk,[e("div",Bk,[e("table",Ok,[Tk,e("tbody",null,[(l(!0),i(f,null,$(t.media,(a,d)=>(l(),i("tr",null,[e("th",Ik,h(a.id),1),e("td",null,[e("span",qk,h(a.type),1)]),e("td",null,h(a.caption??"Без подписи"),1),e("td",null,[e("a",{href:"#file",onClick:n=>t.showPreview(a.id)},h(a.file_id),9,Dk)]),e("td",null,[e("a",{href:"javascript:void(0)",class:"btn btn-link p-0 my-2 text-danger",onClick:n=>t.remove(a.id)},"Удалить",8,Rk)])]))),256))])])]),e("div",Lk,[t.media_paginate_object?(l(),F(S,{key:0,onPagination_page:t.nextMedia,pagination:t.media_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",xk,Ak))],64))}}),zk={class:"row"},Kk={class:"col-12 mb-3"},Nk={class:"form-label",id:"service-title"},Yk=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Jk=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Wk={class:"col-12 mb-3"},Hk={key:0},Gk=["onClick"],Qk={class:"form-label",id:"service-category"},Xk=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Zk=e("div",null,"Категория услуги (используется для группировки) ",-1),e0=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),t0={class:"col-12 mb-3"},s0={class:"form-label",id:"service-description"},o0=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),l0=e("div",null," Краткая информация об оказываемой услуге ",-1),i0=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),n0={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},a0={class:"col-12 mb-3"},d0={class:"form-label",id:"service-images"},r0=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),c0=e("div",null," Изображение, которое видит пользователь при выборе услуги ",-1),u0=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),_0={class:"col-12 mb-3"},h0={class:"form-check"},m0=e("label",{class:"form-check-label",for:"need_prepayment"}," Необходима предоплата ",-1),p0={class:"row"},b0={class:"col-12"},g0={type:"submit",class:"btn btn-outline-success w-100 p-3"},f0={key:0},v0={key:1},y0={props:["service","bot"],data(){return{load:!1,need_reset:!1,event_services:[],serviceForm:{title:null,appointment_event_id:null,description:null,category:null,images:[],need_prepayment:!1,price:0,discount_price:0}}},computed:{categories(){return this.event_services.length==0?[]:this.event_services.map(function(s){return s.category})}},watch:{serviceForm:{handler(s){this.need_reset=!0},deep:!0}},mounted(){this.service&&this.$nextTick(()=>{this.serviceForm={id:this.service.id||null,appointment_event_id:this.service.appointment_event_id||null,title:this.service.title||null,category:this.service.category||null,description:this.service.description||null,images:this.service.images||[],need_prepayment:this.service.need_prepayment||!1,price:this.service.price||0,discount_price:this.service.discount_price||0}})},methods:{selectPhotos(s){this.serviceForm.images||(this.serviceForm.images=[]);let t=this.serviceForm.images.indexOf(s.file_id);t!==-1?this.serviceForm.images.splice(t,1):this.serviceForm.images.push(s.file_id)},resetForm(){},submitForm(){let s=new FormData;Object.keys(this.serviceForm).forEach(t=>{const o=this.serviceForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),s.append("bot_id",this.bot.id),this.$store.dispatch(this.serviceForm.id===null?"addAppointmentService":"updateAppointmentService",{appointmentServiceForm:s}).then(t=>{this.$emit("callback",t.data),this.$notify("Услуги успешно создано")}).catch(t=>{this.$notify("Услуги создания события")})}}},$0=Object.assign(y0,{__name:"AppointmentServiceForm",setup(s){return(t,o)=>{const a=U("Popper");return l(),i("form",{onSubmit:o[4]||(o[4]=j((...d)=>t.submitForm&&t.submitForm(...d),["prevent"]))},[e("div",zk,[e("div",Kk,[e("label",Nk,[v(a,{content:"Название оказываемой услуги"},{default:g(()=>[Yk]),_:1}),u(" Название услуги "),Jk]),c(e("input",{type:"text",class:"form-control",placeholder:"Название","aria-label":"Название","onUpdate:modelValue":o[0]||(o[0]=d=>t.serviceForm.title=d),maxlength:"255","aria-describedby":"service-title",required:""},null,512),[[p,t.serviceForm.title]])]),e("div",Wk,[t.categories?(l(),i("p",Hk,[u(" Ранее созданные категории: "),(l(!0),i(f,null,$(t.categories,d=>(l(),i("span",{onClick:n=>t.serviceForm.category=d,class:"badge bg-primary"},h(d),9,Gk))),256))])):r("",!0),e("label",Qk,[v(a,null,{content:g(()=>[Zk]),default:g(()=>[Xk]),_:1}),u(" Категория услуги "),e0]),c(e("input",{type:"text",class:"form-control",placeholder:"Категория услуги","aria-label":"Категория услуги","onUpdate:modelValue":o[1]||(o[1]=d=>t.serviceForm.category=d),maxlength:"255","aria-describedby":"service-category",required:""},null,512),[[p,t.serviceForm.category]])]),e("div",t0,[e("label",s0,[v(a,null,{content:g(()=>[l0]),default:g(()=>[o0]),_:1}),u(" Описание услуги "),i0,t.serviceForm.description?(l(),i("small",n0," Длина текста "+h(t.serviceForm.description.length),1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Описание услуги","aria-label":"Описание услуги","onUpdate:modelValue":o[2]||(o[2]=d=>t.serviceForm.description=d),"aria-describedby":"service-description",required:""},`
                    `,512),[[p,t.serviceForm.description]])]),e("div",a0,[e("label",d0,[v(a,null,{content:g(()=>[c0]),default:g(()=>[r0]),_:1}),u(" Изображение к услуге "),u0]),v(B,{"need-photo":!0,selected:t.serviceForm.images,onSelect:t.selectPhotos},null,8,["selected","onSelect"])]),e("div",_0,[e("div",h0,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[3]||(o[3]=d=>t.serviceForm.need_prepayment=d),type:"checkbox",id:"need_prepayment"},null,512),[[k,t.serviceForm.need_prepayment]]),m0])])]),e("div",p0,[e("div",b0,[e("button",g0,[t.serviceForm.id===null?(l(),i("span",f0,"Создать услугу")):(l(),i("span",v0,"Обновить услугу"))])])])],32)}}}),k0={class:"row"},F0={class:"col-12 mb-3"},C0={class:"form-label",id:"event-title"},w0=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),j0=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),S0={class:"col-12 mb-3"},V0={class:"form-label",id:"event-subtitle"},P0=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),U0=e("div",null,"Подзаголовок события или доп. инфа под названием события ",-1),B0=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),O0={class:"col-12 mb-3"},T0={class:"form-label",id:"event-description"},I0=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),q0=e("div",null," Краткая информация о происходящем мероприятии ",-1),D0=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),R0={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},L0={class:"col-12 mb-3"},x0={class:"form-label",id:"event-on_start_appointment"},M0=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),A0=e("div",null," Текст, который будет отображен клиенту, когда тот записался ",-1),E0=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),z0={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},K0={class:"col-12 mb-3"},N0={class:"form-label",id:"event-on_cancel_appointment"},Y0=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),J0=e("div",null," Текст, который будет отображен клиенту, когда тот отменил запись ",-1),W0=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),H0={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},G0={class:"col-12 mb-3"},Q0={class:"form-label",id:"event-on_after_appointment"},X0=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Z0=e("div",null," Текст, который будет отображен клиенту, когда тот прошел событие успешно ",-1),e3=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),t3={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},s3={class:"col-12 mb-3"},o3={class:"form-label",id:"event-on_repeat_appointment"},l3=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),i3=e("div",null," Текст, который будет отображен клиенту, когда тот записывается 2й и более раз ",-1),n3=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),a3={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},d3={class:"col-12 mb-3"},r3={class:"form-label",id:"event-images"},c3=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),u3=e("div",null," Изображение, которое видит пользователь при выборе события ",-1),_3=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),h3={class:"col-12 mb-3"},m3={class:"form-check"},p3=e("label",{class:"form-check-label",for:"is-group"}," Является групповым мероприятием ",-1),b3={key:0,class:"col-md-6 col-12 mb-3"},g3={class:"form-label",id:"event-min_people"},f3=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),v3=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),y3={key:1,class:"col-md-6 col-12 mb-3"},$3={class:"form-label",id:"event-max_people"},k3=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),F3=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),C3={class:"row"},w3={class:"col-12 mb-3"},j3={class:"form-check"},S3=e("label",{class:"form-check-label",for:"need-services"}," Нужно добавить сервисы ",-1),V3={key:0,class:"col-12 mb-3"},P3={class:"row"},U3={class:"col-12"},B3={type:"submit",class:"btn btn-outline-success w-100 p-3"},O3={key:0},T3={key:1},I3={props:["event","bot"],data(){return{step:0,load:!1,need_reset:!1,need_services:!1,eventForm:{id:null,title:null,subtitle:null,description:null,images:[],services:[],times:[],is_group:!1,max_people:0,min_people:0,on_start_appointment:null,on_cancel_appointment:null,on_after_appointment:null,on_repeat_appointment:null}}},watch:{eventForm:{handler(s){this.need_reset=!0},deep:!0}},mounted(){this.event&&this.$nextTick(()=>{this.eventForm={id:this.event.id||null,title:this.event.title||null,subtitle:this.event.subtitle||null,description:this.event.description||null,images:this.event.images||[],is_group:this.event.is_group||!1,max_people:this.event.max_people||0,min_people:this.event.min_people||0,on_start_appointment:this.event.on_start_appointment||null,on_cancel_appointment:this.event.on_cancel_appointment||null,on_after_appointment:this.event.on_after_appointment||null,on_repeat_appointment:this.event.on_repeat_appointment||null}})},methods:{selectPhotos(s){this.eventForm.images||(this.eventForm.images=[]);let t=this.eventForm.images.indexOf(s.file_id);t!==-1?this.eventForm.images.splice(t,1):this.eventForm.images.push(s.file_id)},resetForm(){},submitForm(){let s=new FormData;Object.keys(this.eventForm).forEach(t=>{const o=this.eventForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),s.append("bot_id",this.bot.id),this.$store.dispatch(this.eventForm.id===null?"addAppointmentEvent":"updateAppointmentEvent",{appointmentEventForm:s}).then(t=>{this.$emit("callback",t.data),this.$notify("Событие успешно создано")}).catch(t=>{this.$notify("Ошибка создания события")})}}},q3=Object.assign(I3,{__name:"AppointmentEventForm",setup(s){return(t,o)=>{const a=U("Popper");return l(),i("form",{onSubmit:o[11]||(o[11]=j((...d)=>t.submitForm&&t.submitForm(...d),["prevent"]))},[e("div",k0,[e("div",F0,[e("label",C0,[v(a,{content:"Название вашего события (или специалиста), на которое планируется осуществить запись"},{default:g(()=>[w0]),_:1}),u(" Название события "),j0]),c(e("input",{type:"text",class:"form-control",placeholder:"Название","aria-label":"Название","onUpdate:modelValue":o[0]||(o[0]=d=>t.eventForm.title=d),maxlength:"255","aria-describedby":"event-title",required:""},null,512),[[p,t.eventForm.title]])]),e("div",S0,[e("label",V0,[v(a,null,{content:g(()=>[U0]),default:g(()=>[P0]),_:1}),u(" Подзаголовок события "),B0]),c(e("input",{type:"text",class:"form-control",placeholder:"Подзаголовок","aria-label":"Подзаголовок","onUpdate:modelValue":o[1]||(o[1]=d=>t.eventForm.subtitle=d),maxlength:"255","aria-describedby":"event-subtitle",required:""},null,512),[[p,t.eventForm.subtitle]])]),e("div",O0,[e("label",T0,[v(a,null,{content:g(()=>[q0]),default:g(()=>[I0]),_:1}),u(" Описание события "),D0,t.eventForm.description?(l(),i("small",R0," Длина текста "+h(t.eventForm.description.length),1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Описание мероприятия","aria-label":"Описание мероприятия","onUpdate:modelValue":o[2]||(o[2]=d=>t.eventForm.description=d),"aria-describedby":"event-description",required:""},`
                    `,512),[[p,t.eventForm.description]])]),e("div",L0,[e("label",x0,[v(a,null,{content:g(()=>[A0]),default:g(()=>[M0]),_:1}),u(" Текст при записи на событие "),E0,t.eventForm.on_start_appointment?(l(),i("small",z0," Длина текста "+h(t.eventForm.on_start_appointment.length),1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст при записи на событие","aria-label":"Текст при записи на событие","onUpdate:modelValue":o[3]||(o[3]=d=>t.eventForm.on_start_appointment=d),"aria-describedby":"event-on_start_appointment",required:""},`
                    `,512),[[p,t.eventForm.on_start_appointment]])]),e("div",K0,[e("label",N0,[v(a,null,{content:g(()=>[J0]),default:g(()=>[Y0]),_:1}),u(" Текст при отмене записи на событие "),W0,t.eventForm.on_cancel_appointment?(l(),i("small",H0," Длина текста "+h(t.eventForm.on_cancel_appointment.length),1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст при отмене записи на событие","aria-label":"Текст при отмене записи на событие","onUpdate:modelValue":o[4]||(o[4]=d=>t.eventForm.on_cancel_appointment=d),"aria-describedby":"event-on_cancel_appointment",required:""},`
                    `,512),[[p,t.eventForm.on_cancel_appointment]])]),e("div",G0,[e("label",Q0,[v(a,null,{content:g(()=>[Z0]),default:g(()=>[X0]),_:1}),u(" Текст после прохождения события "),e3,t.eventForm.on_after_appointment?(l(),i("small",t3," Длина текста "+h(t.eventForm.on_after_appointment.length),1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст после прохождения события","aria-label":"Текст после прохождения события","onUpdate:modelValue":o[5]||(o[5]=d=>t.eventForm.on_after_appointment=d),"aria-describedby":"event-on_after_appointment",required:""},`
                    `,512),[[p,t.eventForm.on_after_appointment]])]),e("div",s3,[e("label",o3,[v(a,null,{content:g(()=>[i3]),default:g(()=>[l3]),_:1}),u(" Текст при повторной записи на событие "),n3,t.eventForm.on_repeat_appointment?(l(),i("small",a3," Длина текста "+h(t.eventForm.on_repeat_appointment.length),1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:" Текст при повторной записи на событие","aria-label":" Текст при повторной записи на событие","onUpdate:modelValue":o[6]||(o[6]=d=>t.eventForm.on_repeat_appointment=d),"aria-describedby":"event-on_repeat_appointment",required:""},`
                    `,512),[[p,t.eventForm.on_repeat_appointment]])]),e("div",d3,[e("label",r3,[v(a,null,{content:g(()=>[u3]),default:g(()=>[c3]),_:1}),u(" Изображение к событию "),_3]),v(B,{"need-photo":!0,selected:t.eventForm.images,onSelect:t.selectPhotos},null,8,["selected","onSelect"])]),e("div",h3,[e("div",m3,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[7]||(o[7]=d=>t.eventForm.is_group=d),type:"checkbox",id:"is-group"},null,512),[[k,t.eventForm.is_group]]),p3])]),t.eventForm.is_group?(l(),i("div",b3,[e("label",g3,[v(a,{content:"Минимально необходимое число людей, для начала 1 мероприятия"},{default:g(()=>[f3]),_:1}),u(" Минимальное число посетителей в группе "),v3]),c(e("input",{type:"number",class:"form-control",placeholder:"Минимальное число посетителей","aria-label":"Название","onUpdate:modelValue":o[8]||(o[8]=d=>t.eventForm.min_people=d),"aria-describedby":"event-min_people",required:""},null,512),[[p,t.eventForm.min_people]])])):r("",!0),t.eventForm.is_group?(l(),i("div",y3,[e("label",$3,[v(a,{content:"Количество людей, которые могут посетить мероприятие за 1 сеанс"},{default:g(()=>[k3]),_:1}),u(" Максимальное число посетителей в группе "),F3]),c(e("input",{type:"number",class:"form-control",placeholder:"Максимальное число посетителей","aria-label":"Название","onUpdate:modelValue":o[9]||(o[9]=d=>t.eventForm.max_people=d),"aria-describedby":"event-max_people",required:""},null,512),[[p,t.eventForm.max_people]])])):r("",!0)]),e("div",C3,[e("div",w3,[e("div",j3,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[10]||(o[10]=d=>t.need_services=d),type:"checkbox",id:"need-services"},null,512),[[k,t.need_services]]),S3])]),t.need_services?(l(),i("div",V3,[v($0,{bot:s.bot},null,8,["bot"])])):r("",!0)]),e("div",P3,[e("div",U3,[e("button",B3,[t.eventForm.id==null?(l(),i("span",O3,"Создать событие")):(l(),i("span",T3,"Обновить событие"))])])])],32)}}}),D3={props:["bot"],data(){return{direction:"desc",order:"updated_at",show:!0,is_group:!1,loading:!0,events:[],search:null,paginate_object:null}},computed:{...w(["getAppointmentEvents","getAppointmentEventsPaginateObject"])},mounted(){this.loadAppointmentEvents()},methods:{duplicate(s){if(!this.getCurrentCompany){this.$notify("У Вас не выбран клиент!");return}this.$store.dispatch("duplicateBot",{dataObject:{bot_id:s,company_id:this.getCurrentCompany.id}}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно продублирован")})},addToArchive(s){this.$store.dispatch("removeBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен в архив")})},forceDelete(s){this.$store.dispatch("forceDeleteBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен из архива")})},extractFromArchive(s){this.$store.dispatch("restoreBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен из архива")})},nextAppointmentEvents(s){this.loadAppointmentEvents(s)},loadAndOrder(s){this.order=s,this.direction=this.direction==="desc"?"asc":"desc",this.loadBots(0)},loadAppointmentEvents(s=0){this.loading=!0,this.$store.dispatch("loadAppointmentEvents",{dataObject:{bot_id:this.bot.id||null,search:this.search,is_group:this.is_group,order:this.order,direction:this.direction},page:s,size:100}).then(t=>{this.loading=!1,this.events=this.getAppointmentEvents,this.paginate_object=this.getAppointmentEventsPaginateObject}).catch(()=>{this.loading=!1})}}},qF=Object.assign(D3,{__name:"AppointmentEventTable",setup(s){return(t,o)=>(l(),F(q3,{bot:s.bot},null,8,["bot"]))}});const R3={key:0},L3={key:0,class:"row"},x3={class:"col-md-12"},M3=e("h4",null,"Боты в работе",-1),A3={class:"mb-0"},E3={class:"table mb-5"},z3=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"Домен"),e("th",{scope:"col"},"Название"),e("th",{scope:"col"},"Шаблон"),e("th",{scope:"col"},"Дата изменения"),e("th",{scope:"col"},"Действие")])],-1),K3={scope:"row"},N3=["onClick"],Y3=["onClick"],J3={key:0,class:"badge bg-primary"},W3={key:1},H3={class:"d-flex"},G3=["onClick"],Q3=e("i",{class:"fa-regular fa-star"},null,-1),X3=[Q3],Z3=["onClick"],e5=e("i",{class:"fa-solid fa-chevron-down"},null,-1),t5=[e5],s5=["onClick"],o5=e("i",{class:"fa-solid fa-chevron-up"},null,-1),l5=[o5],i5=e("hr",null,null,-1),n5={class:"row"},a5={class:"col-md-12 d-flex flex-column"},d5={class:"d-flex"},r5={class:"dropdown mr-2"},c5=e("button",{class:"btn btn-outline-primary dropdown-toggle",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"}," Фильтры ",-1),u5={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},_5=["onClick"],h5={class:"input-group mb-3"},m5={key:0,class:"mt-2"},p5={class:"badge bg-primary mr-1"},b5=["onClick"],g5=e("i",{class:"fa-solid fa-xmark"},null,-1),f5=[g5],v5={key:1,class:"row"},y5={class:"col-12"},$5=e("h4",null,"Все боты",-1),k5={class:"mb-0"},F5={class:"mb-0"},C5={key:2,class:"row"},w5={class:"col-12 mb-3"},j5={key:0,class:"col-12 mb-3"},S5={class:"table"},V5=e("th",{scope:"col"},"Действие",-1),P5={scope:"row"},U5=["onClick"],B5=["onClick"],O5={key:0,class:"badge bg-primary"},T5={key:1},I5={class:"d-flex"},q5=["onClick"],D5=e("i",{class:"fa-regular fa-star"},null,-1),R5=[D5],L5=["onClick"],x5=e("i",{class:"fa-regular fa-copy"},null,-1),M5=[x5],A5=["onClick"],E5=e("i",{class:"fa-solid fa-boxes-packing"},null,-1),z5=[E5],K5=["onClick"],N5=e("i",{class:"fa-solid fa-box-open"},null,-1),Y5=[N5],J5=["onClick"],W5=e("i",{class:"fa-solid fa-trash-can text-white"},null,-1),H5=[W5],G5={class:"col-lg-4 col-12 mb-3"},Q5={class:"card-body"},X5=["onClick"],Z5={key:0,class:"badge bg-info"},eF={class:"card-footer d-flex"},tF=["onClick"],sF=e("i",{class:"fa-regular fa-copy"},null,-1),oF=[sF],lF=["onClick"],iF=e("i",{class:"fa-solid fa-boxes-packing"},null,-1),nF=[iF],aF=["onClick"],dF=e("i",{class:"fa-solid fa-box-open"},null,-1),rF=[dF],cF=["onClick"],uF=e("i",{class:"fa-solid fa-trash-can text-white"},null,-1),_F=[uF],hF={class:"col-12"},mF={key:3,class:"row"},pF=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранной компании нет созданных ботов! ")],-1),bF=[pF],gF={props:["companyId","editor"],data(){return{displayType:1,direction:"desc",order:"updated_at",filters:[{name:"Активные",icon:"fa-brands fa-telegram",slug:"active"},{name:"Архивные",icon:"fa-solid fa-box-archive",slug:"archive"}],selectedFilters:[],show:!0,loading:!0,bots:[],favorites:[],search:null,bots_paginate_object:null}},watch:{displayType:function(s,t){localStorage.setItem("cashman_set_botlist_display_type",this.displayType)}},computed:{...w(["getBots","getBotsPaginateObject","getCurrentCompany","getBotFavorites","inBotFav"]),filteredBots(){if(!this.bots)return[];if(this.selectedFilters.length===0&&this.search==null)return this.bots;if(this.selectedFilters.length===0&&this.search!=null)return this.bots.filter(t=>(t.bot_domain||"").trim().toLowerCase().indexOf(this.search.trim().toLowerCase())!==-1);let s=[];return this.selectedFilters.forEach(t=>{switch(t.slug){case"active":this.bots.filter(o=>o.deleted_at==null).forEach(o=>{s.push(o)});break;case"archive":this.bots.filter(o=>o.deleted_at!=null).forEach(o=>{s.push(o)});break}}),this.search==null?s:s.filter(t=>(t.bot_domain||"").trim().toLowerCase().indexOf(this.search.trim().toLowerCase())!==-1)}},mounted(){this.loadBots(),this.selectFilter("active"),this.displayType=parseInt(localStorage.getItem("cashman_set_botlist_display_type")||0)},methods:{loadBotsByIds(){if(this.getBotFavorites.length==0){this.favorites=[];return}this.loading=!0,this.$store.dispatch("loadBotsByIds",{ids:this.getBotFavorites}).then(s=>{this.loading=!1,this.favorites=s}).catch(()=>{this.loading=!1})},prepareFavorites(){this.$store.dispatch("loadBotFavs").then(s=>{this.loadBotsByIds()})},moveOrderFavBot(s,t){this.$store.dispatch("swapBotInFav",{id:s,direction:t}).then(o=>{this.loadBotsByIds()})},addToFavorite(s){if(this.inBotFav(s)){this.$store.dispatch("removeFromBotFavorites",s).then(t=>{this.$notify("Указанный бот успешно удален из избранного"),this.loadBotsByIds()});return}this.$store.dispatch("addBotToFavorites",s).then(t=>{this.$notify("Указанный бот успешно добавлен в избранное"),this.loadBotsByIds()})},duplicate(s){if(!this.getCurrentCompany){this.$notify("У Вас не выбран клиент!");return}this.$store.dispatch("duplicateBot",{dataObject:{bot_id:s,company_id:this.getCurrentCompany.id}}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно продублирован")})},addToArchive(s){this.$store.dispatch("removeBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен в архив")})},forceDelete(s){this.$store.dispatch("forceDeleteBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен из архива")})},extractFromArchive(s){this.$store.dispatch("restoreBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен из архива")})},selectFilter(s){let t=this.filters.find(o=>o.slug===s);t&&this.selectedFilters.filter(o=>o.slug===s).length===0&&this.selectedFilters.push(t)},removeSelectedFilter(s){let t=this.selectedFilters.findIndex(o=>o.slug===s);this.selectedFilters.splice(t,1)},selectBot(s){this.$emit("callback",s),this.show=!1,this.$notify("Вы выбрали бота из списка! Все остальные действия будут производится для этого бота.")},nextBots(s){this.loadBots(s)},loadAndOrder(s){this.order=s,this.direction=this.direction==="desc"?"asc":"desc",this.loadBots(0)},loadBots(s=0){this.loading=!0,this.$store.dispatch("loadBots",{dataObject:{companyId:this.companyId||null,search:this.search,order:this.order,direction:this.direction},page:s,size:100}).then(t=>{this.loading=!1,this.bots=this.getBots,this.bots_paginate_object=this.getBotsPaginateObject,this.prepareFavorites()}).catch(()=>{this.loading=!1})}}},DF=Object.assign(gF,{__name:"BotList",setup(s){return(t,o)=>t.show?(l(),i("div",R3,[t.favorites.length>0?(l(),i("div",L3,[e("div",x3,[M3,e("p",A3,"Количество ботов в работе "+h(t.favorites.length||0),1),e("table",E3,[z3,e("tbody",null,[(l(!0),i(f,null,$(t.favorites,(a,d)=>(l(),i("tr",{class:b({"border-info":a.deleted_at==null,"border-danger":a.deleted_at!=null})},[e("th",K3,h(a.id),1),e("td",{onClick:n=>t.selectBot(a)},[e("i",{class:b([{"text-danger":a.deleted_at!=null},"fa-solid fa-robot mr-2"])},null,2),u(" "+h(a.bot_domain||"Не указано"),1)],8,N3),e("td",{onClick:n=>t.selectBot(a)},h(a.title||"Не указано"),9,Y3),e("td",null,[a.is_template?(l(),i("span",J3,h(a.template_description||"Не указано"),1)):(l(),i("span",W3,"Не является шаблоном"))]),e("td",null,h(t.$filters.current(a.updated_at)),1),e("td",null,[e("div",H3,[e("button",{class:b(["btn btn-outline-danger mr-2",{"btn-danger text-white":t.inBotFav(a.id)}]),type:"button",onClick:n=>t.addToFavorite(a.id),title:"Добавить в избранное"},X3,10,G3),t.favorites.length>1?(l(),i("button",{key:0,class:"btn btn-outline-primary mr-2",type:"button",onClick:n=>t.moveOrderFavBot(a.id,1),title:"Переместить вниз"},t5,8,Z3)):r("",!0),t.favorites.length>1?(l(),i("button",{key:1,class:"btn btn-outline-primary mr-2",type:"button",onClick:n=>t.moveOrderFavBot(a.id,0),title:"Переместить вверх"},l5,8,s5)):r("",!0)])])],2))),256))])]),i5])])):r("",!0),e("div",n5,[e("div",a5,[e("div",d5,[e("div",r5,[c5,e("ul",u5,[(l(!0),i(f,null,$(t.filters,a=>(l(),i("li",null,[e("a",{class:"dropdown-item",onClick:d=>t.selectFilter(a.slug),href:"#filter"},[e("i",{class:b([a.icon,"mr-2"])},null,2),u(" "+h(a.name||"Не указано"),1)],8,_5)]))),256))])]),e("div",h5,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск бота","aria-label":"Поиск бота","onUpdate:modelValue":o[0]||(o[0]=a=>t.search=a),"aria-describedby":"button-addon2"},null,512),[[p,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=(...a)=>t.loadBots&&t.loadBots(...a)),type:"button",id:"button-addon2"},"Найти ")])]),t.selectedFilters.length>0?(l(),i("p",m5,[(l(!0),i(f,null,$(t.selectedFilters,a=>(l(),i("span",p5,[u(h(a.name||"не указан")+" ",1),e("a",{onClick:d=>t.removeSelectedFilter(a.slug),class:"ml-1 text-white",href:"#filter"},f5,8,b5)]))),256))])):r("",!0)])]),t.bots_paginate_object?(l(),i("div",v5,[e("div",y5,[$5,e("p",k5,"Количество найденных ботов "+h(t.bots_paginate_object.meta.total||0),1),e("p",F5,"Количество результатов на странице "+h(t.filteredBots.length||0),1),e("p",null,[u(" Тип отображения списка: "),e("span",{onClick:o[2]||(o[2]=a=>t.displayType=0),class:b([{"bg-primary":t.displayType===0,"bg-secondary":t.displayType!==0},"badge cursor-pointer mr-2"])},"Карточки",2),e("span",{class:b([{"bg-primary":t.displayType===1,"bg-secondary":t.displayType!==1},"badge cursor-pointer mr-2"]),onClick:o[3]||(o[3]=a=>t.displayType=1)},"Таблица",2)])])])):r("",!0),t.bots.length>0?(l(),i("div",C5,[e("div",w5,[s.editor?r("",!0):(l(),i("button",{key:0,type:"button",class:"btn btn-outline-info",onClick:o[4]||(o[4]=a=>t.selectBot(null))},"Создать нового бота "))]),t.displayType===1?(l(),i("div",j5,[e("table",S5,[e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"cursor-pointer",onClick:o[5]||(o[5]=a=>t.loadAndOrder("id"))},"#"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[6]||(o[6]=a=>t.loadAndOrder("bot_domain"))},"Домен"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[7]||(o[7]=a=>t.loadAndOrder("title"))},"Название"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[8]||(o[8]=a=>t.loadAndOrder("template_description"))},"Шаблон"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[9]||(o[9]=a=>t.loadAndOrder("updated_at"))},"Дата изменения"),V5])]),e("tbody",null,[(l(!0),i(f,null,$(t.filteredBots,(a,d)=>(l(),i("tr",{class:b({"border-info":a.deleted_at==null,"border-danger":a.deleted_at!=null})},[e("th",P5,h(a.id),1),e("td",{onClick:n=>t.selectBot(a)},[e("i",{class:b([{"text-danger":a.deleted_at!=null},"fa-solid fa-robot mr-2"])},null,2),u(" "+h(a.bot_domain||"Не указано"),1)],8,U5),e("td",{onClick:n=>t.selectBot(a)},h(a.title||"Не указано"),9,B5),e("td",null,[a.is_template?(l(),i("span",O5,h(a.template_description||"Не указано"),1)):(l(),i("span",T5,"Не является шаблоном"))]),e("td",null,h(t.$filters.current(a.updated_at)),1),e("td",null,[e("div",I5,[e("button",{class:b(["btn btn-outline-danger mr-2",{"btn-danger text-white":t.inBotFav(a.id)}]),type:"button",onClick:n=>t.addToFavorite(a.id),title:"Добавить в избранное"},R5,10,q5),e("button",{class:"btn btn-outline-info mr-2",type:"button",onClick:n=>t.duplicate(a.id),title:"Дублировать"},M5,8,L5),a.deleted_at==null?(l(),i("button",{key:0,class:"btn btn-outline-info",type:"button",onClick:n=>t.addToArchive(a.id),title:"В архив"},z5,8,A5)):r("",!0),a.deleted_at!=null?(l(),i("button",{key:1,class:"btn btn-outline-info mr-2",onClick:n=>t.extractFromArchive(a.id),title:"Из архива"},Y5,8,K5)):r("",!0),a.deleted_at!=null?(l(),i("button",{key:2,class:"btn btn-danger mr-2",onClick:n=>t.forceDelete(a.id),title:"Удалить на совсем"},H5,8,J5)):r("",!0)])])],2))),256))])])])):r("",!0),t.displayType===0?(l(!0),i(f,{key:1},$(t.filteredBots,(a,d)=>(l(),i("div",G5,[e("div",{class:b(["card w-100",{"border-info":a.deleted_at==null,"border-secondary":a.deleted_at!=null}])},[e("div",Q5,[e("p",{class:"d-flex justify-content-between",onClick:n=>t.selectBot(a),style:{"word-wrap":"break-word"}},[e("span",null,[e("i",{class:b([{"text-danger":a.deleted_at!=null},"fa-solid fa-robot mr-2"])},null,2),u(" "+h(a.bot_domain||"Не указано"),1)]),a.is_template?(l(),i("span",Z5,h(a.template_description||"Шаблон без названия"),1)):r("",!0)],8,X5)]),e("div",eF,[e("button",{class:"btn btn-outline-info mr-2",type:"button",onClick:n=>t.duplicate(a.id),title:"Дублировать"},oF,8,tF),a.deleted_at==null?(l(),i("button",{key:0,class:"btn btn-outline-info",type:"button",onClick:n=>t.addToArchive(a.id),title:"В архив"},nF,8,lF)):r("",!0),a.deleted_at!=null?(l(),i("button",{key:1,class:"btn btn-outline-info mr-2",onClick:n=>t.extractFromArchive(a.id),title:"Из архива"},rF,8,aF)):r("",!0),a.deleted_at!=null?(l(),i("button",{key:2,class:"btn btn-danger mr-2",onClick:n=>t.forceDelete(a.id),title:"Удалить на совсем"},_F,8,cF)):r("",!0)])],2)]))),256)):r("",!0),e("div",hF,[t.bots_paginate_object?(l(),F(S,{key:0,onPagination_page:t.nextBots,pagination:t.bots_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",mF,bF))])):r("",!0)}});export{BF as A,TF as B,OF as Y,VF as _,DF as a,R as b,PF as c,O_ as d,qF as e,IF as f,UF as g,jF as h,SF as i};
