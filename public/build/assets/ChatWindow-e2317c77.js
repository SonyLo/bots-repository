import{o as t,c as e,a as s,b,l as f,F as u,r as _,d as a,t as m,w as k,v,g,z as x}from"./app-9ce796e2.js";import{_ as w}from"./_plugin-vue_export-helper-c27b6911.js";const C={props:["domain"],watch:{messages:function(o){this.$nextTick(function(){var l=this.$el.querySelector("#scroll-area");l.scrollTop=l.scrollHeight+120})}},data(){return{is_active:!0,is_keyboard:!0,text:"/start",messages:[],buttons:[],dataForm:{message:null,query:null,user:{id:484698703,first_name:"Test",last_name:"test",username:"eessdsdsd"}}}},methods:{buttonSend(o){this.dataForm.message=null,this.dataForm.query=o.text||o||null,this.send()},send(){axios.post("/web/"+this.domain,this.dataForm).then(o=>{console.log("data",o),o.data.forEach(r=>{r.text&&this.messages.push({text:r.text,result:!0,type:0,keyboard:null,photo:null}),r.photo&&this.messages.push({text:r.caption,result:!0,type:1,photo:r.photo});let d=JSON.parse(r.reply_markup);r.reply_markup&&(d.keyboard&&(this.buttons=d.keyboard,this.is_keyboard=!0),d.inline_keyboard&&(console.log(d.inline_keyboard),this.messages.push({result:!0,type:2,keyboard:d.inline_keyboard})))})})}}},T=s("h3",null,"Заголовок чата",-1),F=s("i",{class:"fa fa-times","aria-hidden":"true"},null,-1),S=[F],L={key:0},M={key:0,class:"incoming"},H=["innerHTML"],O={key:1,class:"outcoming"},V=["innerHTML"],j={key:1},N={class:"incoming"},U=["src"],$=["innerHTML"],q={key:2},B={class:"incoming"},D={class:"row"},E={class:"btn-wrapper"},J=["onClick"],P=["href"],W=s("div",{class:"mini-btn"},[s("button",{type:"submit"}," Отправть ")],-1),z={key:0,class:"buttons"},A={class:"row"},R={class:"col-12 d-flex justify-content-center"},G=["onClick"];function I(o,l,r,d,c,h){const y=x("perfect-scrollbar");return t(),e(u,null,[T,s("a",{onClick:l[0]||(l[0]=n=>o.close())},S),b(y,{class:"scroll-area"},{default:f(()=>[s("ul",null,[(t(!0),e(u,null,_(c.messages,n=>(t(),e("li",null,[n.type===0?(t(),e("div",L,[n.result?(t(),e("div",M,[s("p",{innerHTML:n.text},null,8,H)])):(t(),e("div",O,[s("p",{innerHTML:n.text},null,8,V)]))])):a("",!0),n.type===1?(t(),e("div",j,[s("div",N,[s("img",{src:n.photo,alt:""},null,8,U),s("p",{innerHTML:n.text},null,8,$)])])):a("",!0),n.type===2?(t(),e("div",q,[s("div",B,[s("ul",null,[(t(!0),e(u,null,_(n.keyboard,p=>(t(),e("li",D,[(t(!0),e(u,null,_(p,i=>(t(),e("div",E,[i.callback_data?(t(),e("button",{key:0,onClick:tt=>h.buttonSend(i.callback_data)},m(i.text),9,J)):a("",!0),i.url?(t(),e("a",{key:1,href:i.url,target:"_blank"},m(i.text),9,P)):a("",!0)]))),256))]))),256))])])])):a("",!0)]))),256))])]),_:1}),s("form",{onSubmit:l[2]||(l[2]=g((...n)=>h.send&&h.send(...n),["prevent"])),class:"message"},[k(s("input",{type:"text",placeholder:"text","onUpdate:modelValue":l[1]||(l[1]=n=>c.dataForm.message=n)},null,512),[[v,c.dataForm.message]]),W],32),c.buttons.length>0&&c.is_keyboard?(t(),e("div",z,[s("ul",null,[(t(!0),e(u,null,_(c.buttons,n=>(t(),e("li",A,[s("div",R,[(t(!0),e(u,null,_(n,p=>(t(),e("button",{class:"btn btn-outline-primary w-100 m-1",onClick:i=>h.buttonSend(p)},m(p.text),9,G))),256))])]))),256))])])):a("",!0)],64)}const K=w(C,[["render",I]]),Q={key:0,class:"container-fluid pt-3 pb-3"},X={class:"row"},Y={class:"col-12"},Z={data(){return{load:!1,confirm:!1,vipForm:{name:null,phone:null,email:null,birthday:null,city:null,country:null,address:null,sex:!0}}},computed:{tg(){return window.Telegram.WebApp},tgUser(){const o=new URLSearchParams(this.tg.initData);return JSON.parse(o.get("user"))}},methods:{submit(){this.loading=!0,this.$store.dispatch("saveVip",{dataObject:{bot_id:this.bot.id,tg:this.tgUser,form:this.vipForm}}).then(o=>{this.loading=!1,window.location.reload()}).catch(()=>{this.loading=!1})}}},nt=Object.assign(Z,{__name:"ChatWindow",props:{bot:{type:Object},botUser:{type:Object}},setup(o){return(l,r)=>o.bot?(t(),e("div",Q,[s("div",X,[s("div",Y,[b(K,{domain:o.bot.bot_domain},null,8,["domain"])])])])):a("",!0)}});export{nt as default};
