import{G as _,q as o,t as a,v as n,F as d,C as c,x as h,D as m,y as r,H as g,J as f,A as l,K as b}from"./index.es-1f9fc4ae.js";import{P as C}from"./Pagination-4e33d9e6.js";const v={key:0},k={class:"row"},w={class:"d-flex"},F={class:"dropdown mr-2"},y=n("button",{class:"btn btn-outline-primary dropdown-toggle",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"}," Фильтры ",-1),$={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},j=["onClick"],P={class:"input-group mb-3"},B={key:0,class:"mt-2"},L={class:"badge bg-info mr-1"},O=["onClick"],x=n("i",{class:"fa-solid fa-xmark"},null,-1),A=[x],E={key:0,class:"row"},T={class:"col-12 mb-3"},V={class:"list-group w-100"},D=["onClick"],I=["onClick"],M=n("i",{class:"fa-solid fa-boxes-packing"},null,-1),N=[M],S=["onClick"],G=n("i",{class:"fa-solid fa-box-open"},null,-1),q=[G],z={class:"col-12"},H={props:["selected"],data(){return{show:!0,loading:!0,companies:[],search:null,filters:[{name:"Активные",icon:"fa-brands fa-telegram",slug:"active"},{name:"Архивные",icon:"fa-solid fa-box-archive",slug:"archive"}],selectedFilters:[],companies_paginate_object:null}},computed:{..._(["getCompanies","getCompaniesPaginateObject"]),filteredCompanies(){if(!this.companies)return[];if(this.selectedFilters.length===0&&this.search==null)return this.companies;if(this.selectedFilters.length===0&&this.search!=null)return this.companies.filter(e=>(e.title||"").trim().toLowerCase().indexOf(this.search.trim().toLowerCase())!==-1);let t=[];return this.selectedFilters.forEach(e=>{switch(e.slug){case"active":this.companies.filter(s=>s.deleted_at==null).forEach(s=>{t.push(s)});break;case"archive":this.companies.filter(s=>s.deleted_at!=null).forEach(s=>{t.push(s)});break}}),this.search==null?t:t.filter(e=>(e.title||"").trim().toLowerCase().indexOf(this.search.trim().toLowerCase())!==-1)}},mounted(){this.loadCompanies(),this.selectFilter("active")},methods:{addToArchive(t){this.$store.dispatch("removeCompany",{companyId:t}).then(e=>{let s=this.companies_paginate_object.meta.current_page||0;this.loadCompanies(s),this.$notify("Указанный клиент успешно перемещен в архив")})},extractFromArchive(t){this.$store.dispatch("restoreCompany",{companyId:t}).then(e=>{let s=this.companies_paginate_object.meta.current_page||0;this.loadCompanies(s),this.$notify("Указанный клиент успешно перемещен из архива")})},selectFilter(t){let e=this.filters.find(s=>s.slug===t);e&&this.selectedFilters.filter(s=>s.slug===t).length===0&&this.selectedFilters.push(e)},removeSelectedFilter(t){let e=this.selectedFilters.findIndex(s=>s.slug===t);this.selectedFilters.splice(e,1)},selectCompany(t){this.$store.dispatch("updateCurrentCompany",{company:t}),this.$emit("callback",t),this.show=!1,this.$notify("Вы выбрали клиента из списка! Все остальные действия будут производится для этой компании.")},nextCompanies(t){this.loadCompanies(t)},loadCompanies(t=0){this.loading=!0,this.$store.dispatch("loadCompanies",{dataObject:{search:this.search},page:t}).then(e=>{this.loading=!1,this.companies=this.getCompanies,this.companies_paginate_object=this.getCompaniesPaginateObject}).catch(()=>{this.loading=!1})}}},U=Object.assign(H,{__name:"CompanyList",setup(t){return(e,s)=>e.show?(o(),a("div",v,[n("div",k,[n("div",w,[n("div",F,[y,n("ul",$,[(o(!0),a(d,null,c(e.filters,i=>(o(),a("li",null,[n("a",{class:"dropdown-item",onClick:u=>e.selectFilter(i.slug),href:"#filter"},[n("i",{class:h([i.icon,"mr-2"])},null,2),m(" "+r(i.name||"Не указано"),1)],8,j)]))),256))])]),n("div",P,[g(n("input",{type:"search",class:"form-control",placeholder:"Поиск компании","aria-label":"Поиск компании","onUpdate:modelValue":s[0]||(s[0]=i=>e.search=i),"aria-describedby":"button-addon2"},null,512),[[f,e.search]]),n("button",{class:"btn btn-outline-secondary",onClick:s[1]||(s[1]=(...i)=>e.loadCompanies&&e.loadCompanies(...i)),type:"button",id:"button-addon2"},"Найти ")])]),e.selectedFilters.length>0?(o(),a("p",B,[(o(!0),a(d,null,c(e.selectedFilters,i=>(o(),a("span",L,[m(r(i.name||"не указан")+" ",1),n("a",{onClick:u=>e.removeSelectedFilter(i.slug),class:"ml-1 text-white",href:"#filter"},A,8,O)]))),256))])):l("",!0)]),e.companies.length>0?(o(),a("div",E,[n("div",T,[n("ul",V,[(o(!0),a(d,null,c(e.filteredCompanies,(i,u)=>(o(),a("li",{class:h(["list-group-item btn mb-1 d-flex justify-between",{"btn-outline-info":i.deleted_at==null,"btn-outline-danger border-danger":i.deleted_at!=null,"bg-success":t.selected==i.id}])},[n("span",{onClick:p=>e.selectCompany(i),class:h({"text-danger":i.deleted_at!=null})},r(i.title||"Не указано")+" ("+r(i.slug||"Не указано")+") ",11,D),i.deleted_at==null?(o(),a("button",{key:0,class:"btn btn-outline-info",type:"button",onClick:p=>e.addToArchive(i.id),title:"В архив"},N,8,I)):l("",!0),i.deleted_at!=null?(o(),a("button",{key:1,class:"btn btn-outline-info",type:"button",onClick:p=>e.extractFromArchive(i.id),title:"Из архива"},q,8,S)):l("",!0)],2))),256))])]),n("div",z,[e.companies_paginate_object?(o(),b(C,{key:0,onPagination_page:e.nextCompanies,pagination:e.companies_paginate_object},null,8,["onPagination_page","pagination"])):l("",!0)])])):l("",!0)])):l("",!0)}});export{U as _};
