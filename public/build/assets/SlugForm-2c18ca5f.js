import{Y as v,o as s,q as n,t,F as f,B as p,v as b,C as h,x as m,z as c,J as k,H as _,A as F,N as y,D as d,G as u,O as w,y as $}from"./index.es-3f23c3ba.js";import{P as S}from"./Pagination-7feb7ae2.js";import{m as C}from"./index-2a9de1d3.js";import{_ as V}from"./_plugin-vue_export-helper-c27b6911.js";const L={key:0,class:"row"},O={class:"col-12 mb-3"},U={class:"list-group w-100"},j=["onClick"],T={key:0,class:"badge bg-info"},q=["onClick"],I=t("i",{class:"fa-solid fa-trash-can"},null,-1),A=[I],B={class:"col-12"},P={key:2},N={class:"card-body"},D={class:"mb-3"},G={class:"form-label",id:"bot-domain"},z=t("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),E=t("div",null,[h("Измените только текст команды,"),t("br"),h(" если хотите чтоб скрипт вызывался по кнопке из меню. "),t("br"),h(" Или оставьте как есть. "),t("br"),h(" Текст скрипта нужно также указать в качестве пункта меню. ")],-1),H=t("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),J=["disabled"],M={props:["canAdd","bot"],data(){return{search:null,slugs:[],slugs_paginate_object:null,slugForm:{command:null,comment:null,slug:null,config:[],is_global:!0,bot_id:null}}},computed:{...C(["getSlugs","getSlugsPaginateObject"]),filteredAllSlugs(){return this.slugs.length===0?[]:this.search==null?this.slugs:this.slugs.filter(o=>{let e=o.slug||"",i=o.command||"",r=o.comment||"";return i.toLowerCase().indexOf(this.search.toLowerCase())!==-1||r.toLowerCase().indexOf(this.search.toLowerCase())!==-1||e.toLowerCase().indexOf(this.search.toLowerCase())!==-1})}},mounted(){this.loadAllSlugs()},methods:{loadAllSlugs(o=0){this.$store.dispatch("loadSlugs",{dataObject:{needGlobal:!0},page:o}).then(e=>{this.slugs=this.getSlugs,this.slugs_paginate_object=this.getSlugsPaginateObject})},removeSlug(o){this.$store.dispatch("removeSlug",{dataObject:{slugId:o.id}}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно удалена",type:"success"}),this.loadAllSlugs()}).catch(e=>{this.loadAllSlugs()})},nextSlugs(o){this.loadAllSlugs(o)},selectSlug(o){this.slugForm.id=o.id||null,this.slugForm.slug=o.slug,this.slugForm.comment=o.comment,this.slugForm.command=this.command||o.command,this.slugForm.config=o.config||[],this.slugForm.is_global=o.is_global||!1,this.$emit("select",o)},addSlug(){let o=new FormData;Object.keys(this.slugForm).forEach(e=>{const i=this.slugForm[e]||"";typeof i=="object"?o.append(e,JSON.stringify(i)):o.append(e,i)}),this.bot&&o.append("bot_id",this.bot.id),this.$store.dispatch("createSlug",{slugForm:o}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно обновлена",type:"success"}),this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0,this.$emit("callback")}).catch(e=>{})}}},lt=Object.assign(M,{__name:"GlobalSlugList",setup(o){return(e,i)=>{const r=v("Popper");return s(),n(f,null,[e.filteredAllSlugs.length>0?(s(),n("div",L,[t("div",O,[t("ul",U,[(s(!0),n(f,null,p(e.filteredAllSlugs,(l,a)=>(s(),n("li",{class:b(["list-group-item cursor-pointer btn mb-1 d-flex align-items-center justify-between",{"btn-outline-info":l.deleted_at==null,"btn-outline-danger border-danger":l.deleted_at!=null}])},[t("strong",{onClick:g=>e.selectSlug(l),style:{"word-wrap":"break-word"}},[t("i",{class:b([{"text-danger":l.deleted_at!=null},"fa-solid fa-scroll"])},null,2),h(" "+m(l.command)+" (",1),t("span",null,m(l.slug),1),h(") ")],8,j),l.comment?(s(),n("span",T,m(l.comment||"Пояснение не указано"),1)):c("",!0),t("button",{class:"btn btn-outline-danger",onClick:g=>e.removeSlug(l),type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},A,8,q)],2))),256))])]),t("div",B,[e.slugs_paginate_object?(s(),k(S,{key:0,onPagination_page:e.nextSlugs,pagination:e.slugs_paginate_object},null,8,["onPagination_page","pagination"])):c("",!0)])])):(s(),n("p",P,"Глобальных скриптов не обноружено")),o.canAdd&&e.filteredAllSlugs.length>0?(s(),n("form",{key:3,onSubmit:i[1]||(i[1]=_((...l)=>e.addSlug&&e.addSlug(...l),["prevent"])),class:"card mb-3"},[t("div",N,[t("div",D,[t("label",G,[F(r,null,{content:y(()=>[E]),default:y(()=>[z]),_:1}),h(" Команда "),H]),d(t("input",{type:"text",class:"form-control",placeholder:"Команда","aria-label":"Команда","onUpdate:modelValue":i[0]||(i[0]=l=>e.slugForm.command=l),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[u,e.slugForm.command]])]),t("button",{disabled:e.slugForm.slug==null,class:"btn btn-outline-success mt-2 mb-2 w-100 p-3"},"Добавить скрипт в бота ",8,J)])],32)):c("",!0)],64)}}});const R={props:["token","param"],data(){return{channelLink:null}},mounted(){},methods:{checkLink(){this.channelLink.indexOf("https://t.me/")!==-1&&(this.channelLink="@"+(this.channelLink.split("https://t.me/")[1]||this.channelLink))},requestTelegramChannelId(){this.$store.dispatch("requestTelegramChannelId",{dataObject:{token:this.token,channel:this.channelLink}}).then(o=>{o.ok&&this.$emit("callback",{param:this.param||null,text:o.result.chat.id}),o.ok||(this.$notify({title:"Конструктор ботов",text:o.description,type:"error"}),this.$emit("callback",{param:this.param||null,text:null}))}).catch(()=>{})}}},Y={class:"dropdown"},K=t("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"fa-brands fa-telegram"})],-1),Q={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},W={key:0,class:"alert alert-danger mb-2",role:"alert"},X=["disabled"];function Z(o,e,i,r,l,a){return s(),n("div",Y,[K,t("div",Q,[t("form",{onSubmit:e[2]||(e[2]=_((...g)=>a.requestTelegramChannelId&&a.requestTelegramChannelId(...g),["prevent"]))},[d(t("input",{type:"text",class:"form-control mb-2",id:"search-description-text","onUpdate:modelValue":e[0]||(e[0]=g=>l.channelLink=g),onChange:e[1]||(e[1]=(...g)=>a.checkLink&&a.checkLink(...g)),placeholder:"@telegram_channel",required:""},null,544),[[u,l.channelLink]]),i.token?c("",!0):(s(),n("div",W," Вам необходимо указать тоукен бота! ")),t("button",{disabled:!i.token,class:"btn btn-outline-primary w-100"},"Узнать id канала ",8,X)],32)])])}const x=V(R,[["render",Z]]),ee={class:"form-floating mb-3"},te=t("label",{for:"floatingInput"},"Команда",-1),le={class:"form-floating mb-3"},oe=t("label",{for:"floatingInput"},"Мнемоническое имя",-1),se={class:"form-floating mb-3"},ne=t("label",{for:"floatingInput"},"Описание скрипта",-1),ie=t("h6",null," Параметры скрипта ",-1),ae=t("div",{class:"alert alert-info",role:"alert"}," Данные параметры используются для настройки скриптов на стороне сервера ",-1),re={class:"dropdown"},de=t("button",{class:"btn btn-outline-info w-100 dropdown-toggle mb-2",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," Добавить ",-1),ue={class:"dropdown-menu w-100"},ce=["onClick"],me={class:"row"},ge={class:"col-12"},he=["onClick"],fe={key:0,class:"row"},pe={class:"col-md-6 mb-1"},be={class:"card"},_e={class:"card-header d-flex justify-content-between align-items-center"},ye=["onClick"],ke=t("i",{class:"fa-solid fa-trash-can"},null,-1),Ce=[ke],ve={class:"dropdown"},Fe={class:"btn btn-outline-info dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},we={class:"dropdown-menu"},$e=["onClick"],Se={class:"card-body"},Ve={class:"form-floating mb-1"},Le=["onUpdate:modelValue","id"],Oe=["for"],Ue={key:0,class:"form-floating mb-1"},je=["id","onUpdate:modelValue"],Te=["for"],qe={key:1,class:"form-check mb-1 mt-2"},Ie=["onUpdate:modelValue","id"],Ae=["for"],Be={key:2,class:"form-check mb-1 mt-2"},Pe=["onUpdate:modelValue","id"],Ne=["for"],De={key:3,class:"form-floating mb-3"},Ge=["id","onUpdate:modelValue"],ze=["for"],Ee={key:4,class:"form-floating mb-3"},He=["id","onUpdate:modelValue"],Je=["for"],Me={key:1,class:"row"},Re=t("div",{class:"col-12"},[t("p",null,"Параметры скрипта еще не добавлены")],-1),Ye=[Re],Ke={class:"btn btn-outline-primary w-100 mt-2 p-3"},Qe={key:0},We={key:1},Xe={props:["item"],data(){return{filters:[],simple:!0,configTypes:[{title:"Текстовый или числовой параметр",type:"text"},{title:"Большое текстовое поле",type:"large-text"},{title:"Канал обратной связи",type:"channel"},{title:"Логический оператор",type:"boolean"},{title:"Ссылка на изображение",type:"image"},{title:"Цвет",type:"color"}],bot:null,photos:[],slugForm:{bot_id:null,id:null,command:null,comment:null,slug:null,config:[],is_global:!0}}},computed:{...C(["getCurrentBot"]),filteredConfigs(){return this.filters.length==0?this.slugForm.config:this.slugForm.config.filter(o=>this.filters.indexOf(o.type)>=0)}},mounted(){this.loadCurrentBot(),this.item&&(this.slugForm.id=this.item.id||null,this.slugForm.command=this.item.command,this.slugForm.comment=this.item.comment,this.slugForm.bot_id=this.item.bot_id,this.slugForm.slug=this.item.slug,this.slugForm.config=this.item.config||[],this.slugForm.is_global=this.item.is_global||!1)},methods:{toggleFilter(o){let e=this.filters.indexOf(o);e>=0?this.filters.splice(e,1):this.filters.push(o)},addTextTo(o,e={text:null}){this.slugForm.config[o].value=e.text},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},submit(){let o=new FormData;Object.keys(this.slugForm).forEach(e=>{const i=this.slugForm[e]||"";typeof i=="object"?o.append(e,JSON.stringify(i)):o.append(e,i)}),this.$store.dispatch(this.slugForm.id===null?"createSlug":"updateSlug",{slugForm:o}).then(e=>{this.$notify({title:"Конструктор команд",text:"Команда успешно обновлена",type:"success"}),this.slugForm.id===null&&(this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0),this.$emit("callback")}).catch(e=>{})},addConfig(o){this.slugForm.config.splice(0,0,{key:null,value:null,type:o||"text"})},removeConfigItem(o){try{this.slugForm.config.splice(o,1)}catch{this.slugForm.config=[]}}}},ot=Object.assign(Xe,{__name:"SlugForm",setup(o){return(e,i)=>(s(),n("form",{onSubmit:i[3]||(i[3]=_((...r)=>e.submit&&e.submit(...r),["prevent"]))},[t("div",ee,[d(t("input",{type:"text","onUpdate:modelValue":i[0]||(i[0]=r=>e.slugForm.command=r),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[u,e.slugForm.command]]),te]),t("div",le,[d(t("input",{type:"text","onUpdate:modelValue":i[1]||(i[1]=r=>e.slugForm.slug=r),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[u,e.slugForm.slug]]),oe]),t("div",se,[d(t("input",{type:"text","onUpdate:modelValue":i[2]||(i[2]=r=>e.slugForm.comment=r),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[u,e.slugForm.comment]]),ne]),ie,ae,t("div",re,[de,t("ul",ue,[(s(!0),n(f,null,p(e.configTypes,(r,l)=>(s(),n("li",null,[t("a",{class:"dropdown-item",onClick:a=>e.addConfig(r.type)},m(r.title||"Не установлен"),9,ce)]))),256))])]),t("div",me,[t("div",ge,[t("p",null,[h("Фильтры: "),(s(!0),n(f,null,p(e.configTypes,(r,l)=>(s(),n("span",{class:b(["badge mb-1 bg-gray-100 cursor-pointer mr-1",{"bg-info":e.filters.indexOf(r.type)>=0}]),onClick:a=>e.toggleFilter(r.type)},m(r.type),11,he))),256))])])]),e.filteredConfigs.length>0?(s(),n("div",fe,[(s(!0),n(f,null,p(e.filteredConfigs,(r,l)=>(s(),n("div",pe,[t("div",be,[t("div",_e,[t("button",{onClick:a=>e.removeConfigItem(l),class:"btn btn-outline-info",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Ce,8,ye),e.bot&&e.filteredConfigs[l].type==="channel"?(s(),k(x,{key:0,token:e.bot.bot_token,onCallback:a=>e.addTextTo(l,a)},null,8,["token","onCallback"])):c("",!0),t("div",null,[t("div",ve,[t("button",Fe,m(e.filteredConfigs[l].type),1),t("ul",we,[(s(!0),n(f,null,p(e.configTypes,a=>(s(),n("li",null,[t("a",{class:"dropdown-item",onClick:g=>e.filteredConfigs[l].type=a.type},m(a.title||r.type),9,$e)]))),256))])])])]),t("div",Se,[t("div",Ve,[d(t("input",{type:"text",class:"form-control","onUpdate:modelValue":a=>e.filteredConfigs[l].key=a,id:"field-input-key-"+l,placeholder:"name@example.com",required:""},null,8,Le),[[u,e.filteredConfigs[l].key]]),t("label",{for:"field-input-key-"+l},"Ключ",8,Oe)]),e.filteredConfigs[l].type==="text"||e.filteredConfigs[l].type==="channel"?(s(),n("div",Ue,[d(t("input",{type:"text",class:"form-control",id:"field-input-"+l,"onUpdate:modelValue":a=>e.filteredConfigs[l].value=a,placeholder:"name@example.com",required:""},null,8,je),[[u,e.filteredConfigs[l].value]]),t("label",{for:"field-input-"+l},"Значение",8,Te)])):c("",!0),e.filteredConfigs[l].type==="boolean"?(s(),n("div",qe,[d(t("input",{class:"form-check-input","onUpdate:modelValue":a=>e.filteredConfigs[l].value=a,type:"checkbox",value:"false",id:"filtered-config-"+l+"-checkbox"},null,8,Ie),[[w,e.filteredConfigs[l].value]]),t("label",{class:"form-check-label",for:"filtered-config-"+l+"-checkbox"},m(e.filteredConfigs[l].value?"Истина":"Ложь"),9,Ae)])):c("",!0),e.filteredConfigs[l].type==="color"?(s(),n("div",Be,[d(t("input",{class:"form-check-input","onUpdate:modelValue":a=>e.filteredConfigs[l].value=a,type:"color",id:"filtered-config-"+l+"-color"},null,8,Pe),[[u,e.filteredConfigs[l].value]]),t("label",{class:"form-check-label",for:"filtered-config-"+l+"-color"},[t("p",{style:$({color:e.filteredConfigs[l].value})},"Цвет: "+m(e.filteredConfigs[l].value),5)],8,Ne)])):c("",!0),e.filteredConfigs[l].type==="large-text"?(s(),n("div",De,[d(t("textarea",{class:"form-control",id:"field-input-"+l,"onUpdate:modelValue":a=>e.filteredConfigs[l].value=a,placeholder:"name@example.com",required:""},`
                            `,8,Ge),[[u,e.filteredConfigs[l].value]]),t("label",{for:"field-input-"+l},"Значение",8,ze)])):c("",!0),e.filteredConfigs[l].type==="image"?(s(),n("div",Ee,[d(t("input",{class:"form-control",id:"field-input-"+l,type:"url",pattern:"^(http(s)?:\\/\\/)+[\\w\\-\\._~:\\/?#[\\]@!\\$&'\\(\\)\\*\\+,;=.]+$","onUpdate:modelValue":a=>e.filteredConfigs[l].value=a,placeholder:"name@example.com",required:""},null,8,He),[[u,e.filteredConfigs[l].value]]),t("label",{for:"field-input-"+l},"URL ссылка на изображение",8,Je)])):c("",!0)])])]))),256))])):(s(),n("div",Me,Ye)),t("button",Ke,[e.slugForm.id==null?(s(),n("span",Qe," Сохранить команду ")):(s(),n("span",We," Обновить команду "))])],32))}});export{x as T,ot as _,lt as a};
