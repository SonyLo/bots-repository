import{o as l,q as i,t as e,F as b,B as f,x as h,C as m,z as c,N as S,D as u,U as V,v as w,H as $,G as p,O as k,A as v,a4 as z,J as j,W as B,M as y,K as D}from"./index.es-ce2063b4.js";import{B as O,_ as q,a as K}from"./Mail-300e71de.js";import{_ as E,a as N,b as A}from"./SlugForm-de430f5a.js";import{P}from"./Pagination-e8ce4012.js";import{m as C}from"./index-490ab070.js";import{_ as U}from"./_plugin-vue_export-helper-c27b6911.js";import{T as I}from"./TelegramChannelHelper-b0e0d611.js";/* empty css                                                               */const J={props:["param"],data(){return{expressions:[{expression:"{{userName}}",description:"Имя пользователя"},{expression:"{{telegramChatId}}",description:"Идентификатор чата"},{expression:"{{referralLink}}",description:"Реферальная ссылка"},{expression:"{{referralQr}}",description:"Реферальный QR-код"}]}},methods:{expressionsSelect(s){this.$emit("callback",{param:this.param,text:s.expression})}}},W={class:"dropdown"},Y=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-brands fa-hire-a-helper"})],-1),H={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},Q=["onClick"];function X(s,t,o,d,a,n){return l(),i("div",W,[Y,e("div",H,[e("li",null,[(l(!0),i(b,null,f(a.expressions,_=>(l(),i("a",{class:"dropdown-item",onClick:r=>n.expressionsSelect(_)},h(_.description||"-"),9,Q))),256))])])])}const Z=U(J,[["render",X]]);const x={class:"card-header d-flex justify-content-between"},ee={class:"dropdown"},te=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),se={class:"dropdown-menu"},oe=e("i",{class:"fa-solid fa-arrow-left mr-1"},null,-1),le=e("hr",null,null,-1),ie=["data-bs-target"],ne=e("i",{class:"fa-regular fa-pen-to-square mr-1"},null,-1),ae=e("i",{class:"fa-solid fa-clone mr-1"},null,-1),de=e("i",{class:"fa-regular fa-trash-can text-danger mr-1"},null,-1),re={key:0,class:"fa-solid fa-arrow-up-short-wide"},ce={key:1,class:"fa-solid fa-arrow-down-short-wide"},ue={class:"card-body"},me={class:"row"},he={class:"col-12"},_e={key:0},pe={key:1,class:"list-group list-group-numbered"},be={class:"list-group-item d-flex justify-content-between align-items-start"},ge={class:"ms-2 me-auto"},fe=e("div",{class:"fw-bold"},"Идентификатор",-1),ye={class:"list-group-item d-flex justify-content-between align-items-start"},ve={class:"ms-2 me-auto"},ke=e("div",{class:"fw-bold"},"Команда",-1),$e={class:"list-group-item d-flex justify-content-between align-items-start"},Fe={class:"ms-2 me-auto"},we=e("div",{class:"fw-bold"},"Мнемоническое имя",-1),Ce={class:"list-group-item d-flex justify-content-between align-items-start"},Se={class:"ms-2 me-auto"},Pe=e("div",{class:"fw-bold"},"Пояснение",-1),Ve={key:0,class:"list-group-item d-flex justify-content-between align-items-start"},Ue={class:"ms-2 me-auto"},je=e("div",{class:"fw-bold"},"Набор параметров скрипта",-1),Be={key:1,class:"list-group-item d-flex justify-content-between align-items-start"},Oe=e("div",{class:"ms-2 me-auto"},[e("div",{class:"fw-bold"},"Привязана страница")],-1),Ie=[Oe],Te={key:2,class:"list-group-item d-flex justify-content-between align-items-start"},qe=e("div",{class:"ms-2 me-auto"},[e("div",{class:"fw-bold"},"Глобальный скрипт")],-1),Le=[qe],De={class:"list-group-item d-flex justify-content-between align-items-start"},Re={class:"ms-2 me-auto w-100"},Ge=e("div",{class:"fw-bold"},"Перенести данные из:",-1),Me=e("option",{value:null},"Не выбрано",-1),ze=["value"],Ke=e("p",{class:"my-2"},[e("em",null,"Перенос данных затирает текущие данные в данном скрипте")],-1),Ee=["disabled"],Ne=["id"],Ae={class:"modal-dialog modal-lg"},Je={class:"modal-content"},We={class:"modal-header"},Ye={class:"modal-title",id:"exampleModalLabel"},He=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Qe={class:"modal-body"},Xe=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),Ze={props:["item","bot","selectMode"],data(){return{selected_slug_id:null,slugs:[],load:!1,simple:!0}},watch:{simple:function(){this.simple||this.loadAllSlugs()}},mounted(){},methods:{selectCard(){this.$emit("select",this.item)},slugFormCallback(){this.load=!0,this.$emit("callback"),this.$nextTick(()=>{this.load=!1})},editSlug(){this.load=!0,this.$nextTick(()=>{this.load=!1})},selectSlug(){this.load=!0,this.$emit("select",this.item),this.$nextTick(()=>{this.load=!1})},duplicateSlug(){this.load=!0,this.$store.dispatch("duplicateSlug",{dataObject:{slugId:this.item.id}}).then(s=>{this.$notify({title:"Конструктор команд",text:"Команда успешно продублирована",type:"success"}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}).catch(s=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})},submitRelocateData(){this.$store.dispatch("relocateSlugActionData",{slug_sender_id:this.selected_slug_id,slug_recipient_id:this.item.id,bot_id:this.bot.id}).then(s=>{this.$notify({title:"Конструктор команд",text:"Данные команды успешно перенесены",type:"success"})}).catch(s=>{this.$notify({title:"Конструктор команд",text:"Ошибка переноса данных",type:"error"})})},loadAllSlugs(){this.$store.dispatch("loadAllSlugs",{botId:this.bot.id}).then(s=>{this.slugs=s.data})},removeSlug(){this.load=!0,this.$store.dispatch("removeSlug",{dataObject:{slugId:this.item.id}}).then(s=>{this.$notify({title:"Конструктор команд",text:"Команда успешно удалена",type:"success"}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}).catch(s=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})})}}},R=Object.assign(Ze,{__name:"Slug",setup(s){return(t,o)=>(l(),i(b,null,[e("div",{class:w(["card",{"deprecated-slug":s.item.deprecated_at!=null,"global-slug":s.item.is_global}])},[e("div",x,[e("div",ee,[te,e("ul",se,[e("li",null,[e("a",{onClick:o[0]||(o[0]=(...d)=>t.selectSlug&&t.selectSlug(...d)),title:"Выбрать команду",class:"dropdown-item cursor-pointer"},[oe,m(" Выбрать команду ")])]),le,e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:o[1]||(o[1]=(...d)=>t.editSlug&&t.editSlug(...d)),"data-bs-toggle":"modal","data-bs-target":"#edit-slug-"+s.item.id},[ne,m(" Редактировать")],8,ie)]),e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:o[2]||(o[2]=(...d)=>t.duplicateSlug&&t.duplicateSlug(...d))},[ae,m(" Дублировать")])]),e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:o[3]||(o[3]=(...d)=>t.removeSlug&&t.removeSlug(...d))},[de,m(" Удалить")])])])]),e("button",{type:"button",onClick:o[4]||(o[4]=d=>t.simple=!t.simple),class:"btn btn-outline-primary ml-2"},[t.simple?(l(),i("i",re)):(l(),i("i",ce))])]),e("div",ue,[e("div",me,[e("div",he,[t.simple?(l(),i("p",_e,h(s.item.command||"Нет команды"),1)):(l(),i("ol",pe,[e("li",be,[e("div",ge,[fe,m(" №"+h(s.item.id||"Нет идентификатора"),1)])]),e("li",ye,[e("div",ve,[ke,m(" "+h(s.item.command||"Нет команды"),1)])]),e("li",$e,[e("div",Fe,[we,m(" "+h(s.item.slug||"Slug"),1)])]),e("li",Ce,[e("div",Se,[Pe,m(" "+h(s.item.comment||"Пояснение не указано"),1)])]),s.item.config?(l(),i("li",Ve,[e("div",Ue,[je,s.item.config?(l(!0),i(b,{key:0},f(s.item.config,d=>(l(),i("p",null,[e("strong",null,h(d.key||"Ключ не найден")+":",1),m(h(d.value||"Не указано"),1)]))),256)):c("",!0)])])):c("",!0),s.item.page?(l(),i("li",Be,Ie)):c("",!0),s.item.is_global?(l(),i("li",Te,Le)):c("",!0),e("li",De,[e("div",Re,[e("form",{onSubmit:o[6]||(o[6]=S((...d)=>t.submitRelocateData&&t.submitRelocateData(...d),["prevent"]))},[Ge,u(e("select",{class:"form-control w-100","onUpdate:modelValue":o[5]||(o[5]=d=>t.selected_slug_id=d),required:""},[Me,(l(!0),i(b,null,f(t.slugs,d=>(l(),i("option",{value:d.id},"#"+h(d.id)+" "+h(d.slug||"Не указан"),9,ze))),256))],512),[[V,t.selected_slug_id]]),Ke,e("button",{disabled:t.selected_slug_id==null,class:"btn btn-outline-warning w-100"}," Выполнить перенос ",8,Ee)],32)])])]))])])])],2),e("div",{class:"modal fade",id:"edit-slug-"+s.item.id,tabindex:"-1"},[e("div",Ae,[e("div",Je,[e("div",We,[e("h5",Ye,[m("Редактирование команды #"),e("span",null,h(s.item.id),1)]),He]),e("div",Qe,[t.load?c("",!0):(l(),$(E,{key:0,item:s.item,onCallback:t.slugFormCallback},null,8,["item","onCallback"]))]),Xe])])],8,Ne)],64))}}),xe={key:0,class:"row"},et={class:"col-12 mb-2"},tt={key:0},st=e("i",{class:"fa-solid fa-scroll"},null,-1),ot={key:1},lt=e("i",{class:"fa-regular fa-square-minus"},null,-1),it={key:0,class:"col-12"},nt={class:"col-12"},at={class:"form-floating mb-3"},dt=e("label",{for:"floatingInput"},"Быстрый поиск команды",-1),rt={class:"col-12 mb-2"},ct={class:"form-check"},ut={class:"form-check-label",for:"need_global"},mt={key:0},ht={key:1},_t={class:"mb-3 col-12 col-lg-4 col-md-6 col-sm-12"},pt={key:3,class:"mb-3 col-md-12"},bt=e("div",{class:"alert alert-danger",role:"alert"}," У Вас еще нет добавленных скриптов! ",-1),gt=[bt],ft={props:["command"],data(){return{bot:null,need_global:!0,show:!1,slugs:[],paginate:[],ownSearch:null,slugForm:{command:null,comment:null,slug:null}}},watch:{need_global:function(s,t){this.loadSlugs()}},computed:{...C(["getCurrentBot","getSlugs","getSlugsPaginateObject"]),filteredSlugs(){return this.slugs.length===0?[]:this.ownSearch==null?this.slugs:this.slugs.filter(s=>{let t=s.slug||"",o=s.command||"",d=s.comment||"";return o.toLowerCase().indexOf(this.ownSearch.toLowerCase())!==-1||d.toLowerCase().indexOf(this.ownSearch.toLowerCase())!==-1||t.toLowerCase().indexOf(this.ownSearch.toLowerCase())!==-1})}},mounted(){this.loadCurrentBot().then(()=>{this.loadSlugs(),this.command&&this.$nextTick(()=>{this.slugForm.command=this.command})})},methods:{nextSlugs(s){this.loadSlugs(s)},loadSlugs(s=0){this.$store.dispatch("loadSlugs",{dataObject:{botId:this.bot.id,needGlobal:this.need_global},page:s}).then(t=>{this.slugs=this.getSlugs,this.paginate=this.getSlugsPaginateObject})},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},callbackSlugs(){this.loadSlugs()},selectSlug(s){this.$emit("select",s)}}},yt=Object.assign(ft,{__name:"BotSlugList",setup(s){return(t,o)=>t.bot?(l(),i("div",xe,[e("div",et,[e("button",{type:"button",onClick:o[0]||(o[0]=d=>t.show=!t.show),class:"btn btn-outline-success p-3 w-100"},[t.show?(l(),i("span",ot,[lt,m(" Свернуть форму добавления")])):(l(),i("span",tt,[st,m(" Добавить глобальный скрипт")]))])]),t.show?(l(),i("div",it,[t.bot?(l(),$(N,{key:0,"can-add":!0,bot:t.bot,onCallback:t.loadSlugs},null,8,["bot","onCallback"])):c("",!0)])):c("",!0),e("div",nt,[e("div",at,[u(e("input",{type:"search","onUpdate:modelValue":o[1]||(o[1]=d=>t.ownSearch=d),class:"form-control",id:"floatingInput",placeholder:"name@example.com"},null,512),[[p,t.ownSearch]]),dt])]),e("div",rt,[e("div",ct,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[2]||(o[2]=d=>t.need_global=d),type:"checkbox",id:"need_global"},null,512),[[k,t.need_global]]),e("label",ut,[t.need_global?(l(),i("span",mt,"Глобальные")):(l(),i("span",ht,"Локальные"))])])]),t.slugs&&t.bot?(l(!0),i(b,{key:1},f(t.filteredSlugs,(d,a)=>(l(),i("div",_t,[v(R,{item:d,bot:t.bot,onCallback:t.callbackSlugs,onSelect:t.selectSlug},null,8,["item","bot","onCallback","onSelect"])]))),256)):c("",!0),t.paginate?(l(),$(P,{key:2,onPagination_page:t.nextSlugs,pagination:t.paginate},null,8,["onPagination_page","pagination"])):c("",!0),t.filteredSlugs.length===0?(l(),i("div",pt,gt)):c("",!0)])):c("",!0)}}),vt={class:"row"},kt={class:"input-group mb-3"},$t={key:0,class:"row"},Ft={class:"col-12 col-md-12 mb-3"},wt={class:"table"},Ct=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"Ф.И.О. из телеграмма"),e("th",{scope:"col"},"Имя пользователя"),e("th",{scope:"col"},"Домен"),e("th",{scope:"col"},"Телефон"),e("th",{scope:"col"},"TG id"),e("th",{scope:"col"},"Админ"),e("th",{scope:"col"},"VIP"),e("th",{scope:"col"},"Доставщик"),e("th",{scope:"col"},"Менеджер"),e("th",{scope:"col"},"За работой")])],-1),St={scope:"row"},Pt=["href"],Vt={key:1},Ut=["onClick"],jt=e("i",{class:"fa-solid fa-check text-success"},null,-1),Bt=[jt],Ot=["onClick"],It=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Tt=[It],qt=["onClick"],Lt=e("i",{class:"fa-solid fa-check text-success"},null,-1),Dt=[Lt],Rt=["onClick"],Gt=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Mt=[Gt],zt=["onClick"],Kt=e("i",{class:"fa-solid fa-check text-success"},null,-1),Et=[Kt],Nt=["onClick"],At=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Jt=[At],Wt=["onClick"],Yt=e("i",{class:"fa-solid fa-check text-success"},null,-1),Ht=[Yt],Qt=["onClick"],Xt=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Zt=[Xt],xt=["onClick"],es=e("i",{class:"fa-solid fa-check text-success"},null,-1),ts=[es],ss=["onClick"],os=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),ls=[os],is={class:"col-12"},ns={key:1,class:"row"},as=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет пользователей ")],-1),ds=[as],rs={data(){return{bot:null,loading:!0,bot_users:[],search:null,bot_users_paginate_object:null}},computed:{...C(["getBotUsers","getBotUsersPaginateObject","getCurrentBot"])},mounted(){this.loadCurrentBot().then(()=>{this.loadUsers()})},methods:{loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},changeUserStatus(s,t,o="is_admin"){this.bot_users[s][o]=t===1,this.$store.dispatch("changeUserStatus",{dataObject:{bot_user_id:this.bot_users[s].id,status:t,type:o}}).then(()=>{this.$notify({title:"Конструктор ботов",text:"Статус пользователя успешно изменен! Пользователь оповещен об изменении статуса!",type:"success"})}).catch(()=>{this.$notify({title:"Конструктор ботов",text:"Ошибка изменения статуса",type:"error"})})},nextUsers(s){this.loadUsers(s)},loadUsers(s=0){this.loading=!0,this.$store.dispatch("loadBotUsers",{dataObject:{botId:this.bot.id||null,search:this.search},size:100,page:s}).then(t=>{this.loading=!1,this.bot_users=this.getBotUsers,this.bot_users_paginate_object=this.getBotUsersPaginateObject}).catch(()=>{this.loading=!1})}}},cs=Object.assign(rs,{__name:"BotUserList",setup(s){return(t,o)=>(l(),i(b,null,[e("div",vt,[e("div",kt,[u(e("input",{type:"search",class:"form-control",placeholder:"Поиск пользователя","aria-label":"Поиск пользователя",onKeydown:o[0]||(o[0]=z(d=>t.loadUsers(0),["enter"])),"onUpdate:modelValue":o[1]||(o[1]=d=>t.search=d)},null,544),[[p,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[2]||(o[2]=d=>t.loadUsers(0)),type:"button",id:"button-addon2"},"Найти ")])]),t.bot_users.length>0?(l(),i("div",$t,[e("div",Ft,[e("table",wt,[Ct,e("tbody",null,[(l(!0),i(b,null,f(t.bot_users,(d,a)=>(l(),i("tr",null,[e("th",St,h(d.id),1),e("td",null,h(d.fio_from_telegram||"Не указано"),1),e("td",null,h(d.name||"Не указано"),1),e("td",null,[d.username?(l(),i("a",{key:0,href:"https://t.me/"+d.username,target:"_blank"},"@"+h(d.username),9,Pt)):(l(),i("span",Vt,"Не указано"))]),e("td",null,h(d.phone||"Не указано"),1),e("td",null,h(d.telegram_chat_id||"Не указано"),1),e("td",null,[d.is_admin?(l(),i("span",{key:0,onClick:n=>t.changeUserStatus(a,0,"is_admin")},Bt,8,Ut)):(l(),i("span",{key:1,onClick:n=>t.changeUserStatus(a,1,"is_admin")},Tt,8,Ot))]),e("td",null,[d.is_vip?(l(),i("span",{key:0,onClick:n=>t.changeUserStatus(a,0,"is_vip")},Dt,8,qt)):(l(),i("span",{key:1,onClick:n=>t.changeUserStatus(a,1,"is_vip")},Mt,8,Rt))]),e("td",null,[d.is_deliveryman?(l(),i("span",{key:0,onClick:n=>t.changeUserStatus(a,0,"is_deliveryman")},Et,8,zt)):(l(),i("span",{key:1,onClick:n=>t.changeUserStatus(a,1,"is_deliveryman")},Jt,8,Nt))]),e("td",null,[d.is_manager?(l(),i("span",{key:0,onClick:n=>t.changeUserStatus(a,0,"is_manager")},Ht,8,Wt)):(l(),i("span",{key:1,onClick:n=>t.changeUserStatus(a,1,"is_manager")},Zt,8,Qt))]),e("td",null,[d.is_work?(l(),i("span",{key:0,onClick:n=>t.changeUserStatus(a,0,"is_work")},ts,8,xt)):(l(),i("span",{key:1,onClick:n=>t.changeUserStatus(a,1,"is_work")},ls,8,ss))])]))),256))])])]),e("div",is,[t.bot_users_paginate_object?(l(),$(P,{key:0,onPagination_page:t.nextUsers,pagination:t.bot_users_paginate_object},null,8,["onPagination_page","pagination"])):c("",!0)])])):(l(),i("div",ns,ds))],64))}});const us={props:["param"],data(){return{search:null,descriptions:[]}},computed:{filteredDescription(){return this.search?this.descriptions.filter(s=>s.text.indexOf(this.search)!==-1):this.descriptions}},mounted(){this.loadDescription()},methods:{select(s){this.$emit("callback",{param:this.param,text:s})},loadDescription(){this.$store.dispatch("loadDescription").then(s=>{this.descriptions=s.data})}}},ms={class:"dropdown"},hs=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-spell-check"})],-1),_s={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},ps=e("div",{class:"dropdown-divider"},null,-1),bs=["onClick"];function gs(s,t,o,d,a,n){return l(),i("div",ms,[hs,e("div",_s,[u(e("input",{type:"search",class:"form-control",id:"search-description-text","onUpdate:modelValue":t[0]||(t[0]=_=>a.search=_),placeholder:"Введите текст для поиска"},null,512),[[p,a.search]]),ps,(l(!0),i(b,null,f(n.filteredDescription,(_,r)=>(l(),i("p",{class:"p-1 text-left w-100",onClick:g=>n.select(_.text)},h(_.text),9,bs))),256))])])}const T=U(us,[["render",gs]]);const fs={class:"row"},ys={class:"input-group mb-3"},vs={key:0,class:"row"},ks={key:0,class:"col-12"},$s={class:"col-12 mb-3"},Fs={class:"list-group w-100"},ws={class:"list-group-item cursor-pointer page-menu-item btn btn-outline-info mb-1"},Cs={class:"d-flex justify-content-between"},Ss=["onClick"],Ps={key:0},Vs={key:1},Us={key:2},js=e("i",{class:"fa-solid fa-lock"},null,-1),Bs=[js],Os={key:0},Is={class:"dropdown"},Ts=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),qs={class:"dropdown-menu"},Ls=["onClick"],Ds=e("i",{class:"fa-solid fa-copy mr-1"},null,-1),Rs=["onClick"],Gs=e("i",{class:"fa-solid fa-trash mr-1"},null,-1),Ms={class:"col-12"},zs={key:1,class:"row"},Ks=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," Созданных страниц не найдено! ")],-1),Es=[Ks],Ns={props:["editor","current"],data(){return{bot:null,current_page:0,loading:!0,pages:[],search:null,pages_paginate_object:null,need_new_page:!1}},watch:{getPages:function(s,t){this.$nextTick(()=>{this.search||(this.pages=this.getPages)})},search:function(s,t){this.nextPages(0)}},computed:{...C(["getPages","getCurrentBot","getPagesPaginateObject"])},mounted(){this.loadCurrentBot().then(()=>{this.current_page=localStorage.getItem(`cashman_pagelist_${this.bot.id}_page_index`)||0,this.loadPages()})},methods:{loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},selectPage(s){this.$emit("callback",s),this.$notify("Вы выбрали страницу из списка! Все остальные действия будут производится для этой страницы")},nextPages(s){this.current_page=s,localStorage.setItem(`cashman_pagelist_${this.bot.id}_page_index`,this.current_page),this.loadPages()},duplicatePage(s){this.loading=!0,this.$store.dispatch("duplicatePage",{dataObject:{pageId:s}}).then(t=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},removePage(s){this.loading=!0,this.$store.dispatch("removePage",{dataObject:{pageId:s}}).then(t=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},loadPages(){this.loading=!0,this.$store.dispatch("loadPages",{dataObject:{botId:this.bot.id||null,search:this.search||null},page:this.current_page||0}).then(s=>{this.loading=!1,this.pages=this.getPages,this.pages_paginate_object=this.getPagesPaginateObject,this.pages.length===0&&localStorage.setItem(`cashman_pagelist_${this.bot.id}_page_index`,0)}).catch(()=>{this.loading=!1})}}},L=Object.assign(Ns,{__name:"PagesList",setup(s){return(t,o)=>(l(),i(b,null,[e("div",fs,[e("div",ys,[u(e("input",{type:"search",class:"form-control",placeholder:"Поиск страницы","aria-label":"Поиск бота","onUpdate:modelValue":o[0]||(o[0]=d=>t.search=d),"aria-describedby":"button-addon2"},null,512),[[p,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=(...d)=>t.loadPages&&t.loadPages(...d)),type:"button",id:"button-addon2"},"Найти ")])]),t.pages.length>0?(l(),i("div",vs,[t.pages.length>7?(l(),i("div",ks,[t.pages_paginate_object?(l(),$(P,{key:0,onPagination_page:t.nextPages,pagination:t.pages_paginate_object},null,8,["onPagination_page","pagination"])):c("",!0)])):c("",!0),e("div",$s,[e("ul",Fs,[(l(!0),i(b,null,f(t.pages,(d,a)=>(l(),i("li",ws,[e("div",Cs,[e("strong",{onClick:n=>t.selectPage(d)},[m("#"+h(d.id||"Не указано")+" ",1),d.slug?(l(),i("span",Ps,h(d.slug.command||"Не указано"),1)):(l(),i("span",Vs,"Не привязано к команде")),s.current&&s.current===d.id?(l(),i("span",Us,Bs)):c("",!0)],8,Ss),s.editor?(l(),i("div",Os,[e("div",Is,[Ts,e("ul",qs,[e("li",null,[e("a",{class:"dropdown-item",onClick:n=>t.duplicatePage(d.id)},[Ds,m("Дублировать")],8,Ls)]),e("li",null,[e("a",{class:"dropdown-item",onClick:n=>t.removePage(d.id)},[Gs,m("Удалить")],8,Rs)])])])])):c("",!0)])]))),256))])]),e("div",Ms,[t.pages_paginate_object?(l(),$(P,{key:0,onPagination_page:t.nextPages,pagination:t.pages_paginate_object},null,8,["onPagination_page","pagination"])):c("",!0)])])):(l(),i("div",zs,Es))],64))}}),As={class:"row"},Js={class:"col-12"},Ws={class:"card-body"},Ys=e("h6",null,"Добавление нового скрипта в бота",-1),Hs={key:0,class:"row"},Qs={class:"col-md-6 mb-2"},Xs={key:1,class:"row"},Zs=e("div",{class:"col-12"},[e("div",{class:"alert alert-danger",role:"alert"},' У Вас еще нет добавленных скриптов! Воспользуйтесь разделом "Скрипты" для добавления. ')],-1),xs=[Zs],eo={props:["bot","global"],data(){return{load:!1,search:null,slugs:[],paginate:[]}},computed:{...C(["getSlugs","getSlugsPaginateObject"]),filteredSlugs(){return this.slugs?this.slugs.length===0?[]:this.search==null?this.slugs:this.slugs.filter(s=>{let t=s.slug||"",o=s.command||"",d=s.comment||"";return o.toLowerCase().indexOf(this.search.toLowerCase())!==-1||d.toLowerCase().indexOf(this.search.toLowerCase())!==-1||t.toLowerCase().indexOf(this.search.toLowerCase())!==-1}):[]}},mounted(){this.loadSlugs()},methods:{nextSlugs(s){this.loadSlugs(s)},selectSlug(s){this.$emit("callback",{id:s.id||null,slug:s.slug,comment:s.comment,command:s.command}),this.$notify("Вы выбрали скрипт из списка!")},loadSlugs(s=0){this.$store.dispatch("loadSlugs",{dataObject:{botId:this.bot.id,needGlobal:this.global},page:s}).then(t=>{this.slugs=this.getSlugs,this.paginate=this.getSlugsPaginateObject})},callbackSlugs(){}}},to=Object.assign(eo,{__name:"BotSlugListSimple",setup(s){return(t,o)=>(l(),i("div",As,[e("div",Js,[e("div",Ws,[Ys,e("div",null,[u(e("input",{type:"text",class:"form-control mt-1 mb-1","onUpdate:modelValue":o[0]||(o[0]=d=>t.search=d),placeholder:"Поиск нужного скрипта по описанию"},null,512),[[p,t.search]])]),t.filteredSlugs.length>0?(l(),i("div",Hs,[(l(!0),i(b,null,f(t.filteredSlugs,(d,a)=>(l(),i("div",Qs,[v(R,{item:d,bot:s.bot,onCallback:t.callbackSlugs,onSelect:t.selectSlug},null,8,["item","bot","onCallback","onSelect"])]))),256)),t.paginate?(l(),$(P,{key:0,onPagination_page:t.nextSlugs,pagination:t.paginate},null,8,["onPagination_page","pagination"])):c("",!0)])):(l(),i("div",Xs,xs))])])]))}});const so={props:["param"],data(){return{expressions:[{expression:null,description:"Нет проверки"},{expression:"/([a-z0-9]+)/i",description:"Проверка набора из латинских букв и цифр"},{expression:"/([а-яё0-9]+)/iu",description:"Проверка на кириллицу и цифры"},{expression:"/(?P<digit>\\d+)/",description:"Проверка на число"},{expression:"/^([a-z0-9_-]+.)*[a-z0-9_-]+@[a-z0-9_-]+(.[a-z0-9_-]+)*.[a-z]{2,6}$/",description:"Проверка Email"},{expression:"/^((8|+7)[- ]?)?((?d{3})?[- ]?)?[d- ]{7,10}$/",description:"Проверка номера телефона: +7(982)000-00-00"},{expression:"/^(0[1-9]|[12][0-9]|3[01])[.](0[1-9]|1[012])[.](19|20)dd$/",description:"Проверка даты по формату DD.MM.YYYY"},{expression:"/^[0-9]{4}-(0[1-9]|1[012])-(0[1-9]|1[0-9]|2[0-9]|3[01])$/",description:"Проверка даты по формату YYYY-MM-DD"},{expression:"/^(https?://)?([da-z.-]+).([a-z.]{2,6})([/w .-]*)*/?$/",description:"Проверка доменного имени"}]}},methods:{expressionsSelect(s){this.$emit("callback",{param:this.param,text:s.expression})}}},oo={class:"dropdown"},lo=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-regular fa-registered"})],-1),io={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},no=["onClick"];function ao(s,t,o,d,a,n){return l(),i("div",oo,[lo,e("div",io,[e("li",null,[(l(!0),i(b,null,f(a.expressions,_=>(l(),i("a",{class:"dropdown-item",onClick:r=>n.expressionsSelect(_)},h(_.description||"-"),9,no))),256))])])])}const ro=U(so,[["render",ao]]),co={class:"form-floating mb-2"},uo=["id"],mo=["for"],ho={class:"form-check mb-2"},_o=e("label",{class:"form-check-label",for:"need-empty-dialog"}," Диалог без ожидания ответа ",-1),po={key:0,class:"form-floating mb-2"},bo=["id"],go=["for"],fo={key:1,class:"form-floating mb-2"},yo=["id"],vo=["for"],ko={key:2,class:"mb-2"},$o={class:"d-flex justify-content-between"},Fo=["for"],wo=["id"],Co={class:"mb-2"},So={class:"d-flex justify-content-between"},Po=["for"],Vo=["id"],Uo={class:"mb-2"},jo={class:"form-check"},Bo=e("label",{class:"form-check-label",for:"need-dialog-image"}," В диалоге нужно изображение ",-1),Oo={class:"form-check"},Io=e("label",{class:"form-check-label",for:"need-dialog-menu-inline"}," В диалоге нужно меню тексту ",-1),To={class:"form-check"},qo=e("label",{class:"form-check-label",for:"need-dialog-menu-reply"}," В диалоге нужно нижнее меню ",-1),Lo={key:3,class:"card mb-2"},Do={class:"card-body"},Ro=e("h6",null,"Фотографии к диалогу",-1),Go={class:"photo-preview d-flex justify-content-start flex-wrap w-100"},Mo={for:"location-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},zo=e("span",null,"+",-1),Ko={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Eo={class:"remove"},No=["onClick"],Ao={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Jo={class:"remove"},Wo=["onClick"],Yo={key:4,class:"card mb-2"},Ho=e("div",{class:"card-header"},[e("h6",null,"Кнопки к тексту вопроса")],-1),Qo={class:"card-body"},Xo={key:5,class:"card mb-2"},Zo=e("div",{class:"card-header"},[e("h6",null,"Кнопки в виде нижнего меню")],-1),xo={class:"card-body"},el={class:"mb-2"},tl=e("label",{class:"form-check-label",for:"need-empty-dialog"}," Сохранить в переменную ",-1),sl=e("option",{selected:""},"Не выбрано",-1),ol=["value"],ll={class:"form-check mb-2"},il=e("label",{class:"form-check-label",for:"need-set-flags"}," Установить флаги в соответствующее значение ",-1),nl={key:6,class:"mb-2"},al=e("p",null,"Выбрать флаги",-1),dl=["onClick"],rl={class:"mb-2"},cl={type:"submit",class:"btn btn-outline-primary p-3 w-100"},ul={key:0},ml={key:1},hl={props:["item","bot"],data(){return{need_images:!1,need_inline_keyboard:!1,need_reply_keyboard:!1,need_set_flags:!1,flags_variants:[{title:"Является VIP",key:"is_vip",value:null},{title:"Является Админом",key:"is_admin",value:null},{title:"За работой",key:"is_work",value:null},{title:"Является менеджером",key:"is_manager",value:null}],store_variants:[{title:"Имя",key:"name"},{title:"Почта",key:"email"},{title:"Возраст",key:"age"},{title:"Город",key:"city"},{title:"Страна",key:"country"},{title:"Адрес",key:"address"},{title:"Телефон",key:"phone"},{title:"День рождение",key:"birthday"}],commandForm:{id:null,slug:null,pre_text:null,post_text:null,error_text:null,bot_id:null,input_pattern:null,inline_keyboard_id:null,reply_keyboard_id:null,images:null,next_bot_dialog_command_id:null,bot_dialog_group_id:null,is_empty:!1,result_flags:[],store_to:null,result_channel:null,inline_keyboard:null,reply_keyboard:null},photos:[]}},mounted(){this.item&&this.$nextTick(()=>{this.commandForm={id:this.item.id||null,slug:this.item.slug||null,pre_text:this.item.pre_text||null,post_text:this.item.post_text||null,error_text:this.item.error_text||null,is_empty:this.item.is_empty||!1,input_pattern:this.item.input_pattern||null,inline_keyboard_id:this.item.inline_keyboard_id||null,reply_keyboard_id:this.item.reply_keyboard_id||null,images:this.item.images||[],next_bot_dialog_command_id:this.item.next_bot_dialog_command_id||null,bot_dialog_group_id:this.item.bot_dialog_group_id||null,result_channel:this.item.result_channel||null,inline_keyboard:this.item.inline_keyboard||null,reply_keyboard:this.item.reply_keyboard||null,result_flags:this.item.result_flags||[],store_to:this.item.store_to||null},this.bot&&(this.commandForm.bot_id=this.bot.id||null),this.commandForm.inline_keyboard_id!=null&&(this.need_inline_keyboard=!0),this.commandForm.reply_keyboard_id!=null&&(this.need_reply_keyboard=!0),this.commandForm.images.length>0&&(this.need_images=!0),this.commandForm.result_flags.length>0&&(this.need_set_flags=!0)}),this.bot&&this.$nextTick(()=>{this.commandForm.bot_id=this.bot.id})},methods:{submit(){this.loading=!0;let s=new FormData;if(Object.keys(this.commandForm).forEach(t=>{const o=this.commandForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.photos){for(let t=0;t<this.photos.length;t++)s.append("files[]",this.photos[t]);s.delete("photos")}this.$store.dispatch(this.commandForm.id?"updateDialogCommand":"createDialogCommand",{dialogCommandForm:s}).then(t=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Успешная обработка диалоговой команды",type:"success"}),this.commandForm.id==null&&(this.commandForm={id:null,slug:null,pre_text:null,post_text:null,error_text:null,input_pattern:null,inline_keyboard_id:null,images:null,next_bot_dialog_command_id:null,bot_dialog_group_id:null,result_channel:null,inline_keyboard:null,is_empty:!1,result_flags:[],store_to:null},this.photos=[]),this.$emit("callback")}).catch(t=>{this.loading=!1})},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removePhoto(s,t){this[s].splice(t,1)},onChangePhotos(s){const t=s.target.files;for(let o=0;o<t.length;o++)this.photos.push(t[o])},saveInlineKeyboard(s){this.commandForm.inline_keyboard=s},saveReplyKeyboard(s){this.commandForm.reply_keyboard=s},addTextTo(s={param:null,text:null}){this.commandForm[s.param]=s.text},selectFlag(s){(!this.commandForm.result_flags||!Array.isArray(this.commandForm.result_flags))&&(this.commandForm.result_flags=[]);let t=this.commandForm.result_flags.indexOf(s.key);t===-1?this.commandForm.result_flags.push(s.key):this.commandForm.result_flags.splice(t,1)}}},G=Object.assign(hl,{__name:"BotDialogCommandForm",setup(s){return(t,o)=>{const d=j("lazy");return l(),i("form",{onSubmit:o[12]||(o[12]=S((...a)=>t.submit&&t.submit(...a),["prevent"]))},[e("div",co,[u(e("input",{type:"text",class:"form-control",id:"commandForm-pre-text-"+t.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":o[0]||(o[0]=a=>t.commandForm.pre_text=a),required:""},null,8,uo),[[p,t.commandForm.pre_text]]),e("label",{for:"commandForm-pre-text-"+t.commandForm.id},"Текст диалога",8,mo)]),e("div",ho,[u(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[1]||(o[1]=a=>t.commandForm.is_empty=a),id:"need-empty-dialog",checked:""},null,512),[[k,t.commandForm.is_empty]]),_o]),t.commandForm.is_empty?c("",!0):(l(),i("div",po,[u(e("input",{type:"text",class:"form-control",id:"commandForm-post-text-"+t.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":o[2]||(o[2]=a=>t.commandForm.post_text=a),required:""},null,8,bo),[[p,t.commandForm.post_text]]),e("label",{for:"commandForm-post-text-"+t.commandForm.id},"Текст после успешного завершения диалога",8,go)])),t.commandForm.is_empty?c("",!0):(l(),i("div",fo,[u(e("input",{type:"text",class:"form-control",id:"commandForm-error-text-"+t.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":o[3]||(o[3]=a=>t.commandForm.error_text=a),required:""},null,8,yo),[[p,t.commandForm.error_text]]),e("label",{for:"commandForm-error-text-"+t.commandForm.id},"Текст на случай ошибки корректности данных",8,vo)])),t.commandForm.is_empty?c("",!0):(l(),i("div",ko,[e("div",$o,[e("label",{class:"form-label",for:"commandForm-result-channel-"+t.commandForm.id},"Регулярное выражение для валидации данных ",8,Fo),v(ro,{param:"input_pattern",onCallback:t.addTextTo},null,8,["onCallback"])]),u(e("input",{type:"text",class:"form-control",placeholder:"Регулярное выражение","aria-label":"Регулярное выражение","onUpdate:modelValue":o[4]||(o[4]=a=>t.commandForm.input_pattern=a),maxlength:"255",id:"commandForm-input-pattern-"+t.commandForm.id,"aria-describedby":"commandForm-input-pattern"},null,8,wo),[[p,t.commandForm.input_pattern]])])),e("div",Co,[e("div",So,[e("label",{class:"form-label",for:"commandForm-result-channel-"+t.commandForm.id},"Канал для отправки данных ",8,Po),s.bot?(l(),$(I,{key:0,token:s.bot.bot_token,param:"result_channel",onCallback:t.addTextTo},null,8,["token","onCallback"])):c("",!0)]),u(e("input",{type:"number",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":o[5]||(o[5]=a=>t.commandForm.result_channel=a),id:"commandForm-result-channel-"+t.commandForm.id,"aria-describedby":"bot-order-channel"},null,8,Vo),[[p,t.commandForm.result_channel]])]),e("div",Uo,[e("div",jo,[u(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[6]||(o[6]=a=>t.need_images=a),id:"need-dialog-image",checked:""},null,512),[[k,t.need_images]]),Bo]),e("div",Oo,[u(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[7]||(o[7]=a=>t.need_inline_keyboard=a),id:"need-dialog-menu-inline",checked:""},null,512),[[k,t.need_inline_keyboard]]),Io]),e("div",To,[u(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[8]||(o[8]=a=>t.need_reply_keyboard=a),id:"need-dialog-menu-reply",checked:""},null,512),[[k,t.need_reply_keyboard]]),qo])]),t.need_images?(l(),i("div",Lo,[e("div",Do,[Ro,e("div",Go,[e("label",Mo,[zo,e("input",{type:"file",id:"location-photos",multiple:"",accept:"image/*",onChange:o[9]||(o[9]=(...a)=>t.onChangePhotos&&t.onChangePhotos(...a)),style:{display:"none"}},null,32)]),t.photos.length>0?(l(!0),i(b,{key:0},f(t.photos,(a,n)=>(l(),i("div",Ko,[u(e("img",null,null,512),[[d,t.getPhoto(a).imageUrl]]),e("div",Eo,[e("a",{onClick:_=>t.removePhoto("photos",n)},"Удалить",8,No)])]))),256)):c("",!0),t.commandForm.images&&s.bot?(l(!0),i(b,{key:1},f(t.commandForm.images,(a,n)=>(l(),i("div",Ao,[u(e("img",null,null,512),[[d,"/images-by-bot-id/"+s.bot.id+"/"+a]]),e("div",Jo,[e("a",{onClick:_=>t.removePhoto("images",n)},"Удалить",8,Wo)])]))),256)):c("",!0)])])])):c("",!0),t.need_inline_keyboard?(l(),i("div",Yo,[Ho,e("div",Qo,[v(O,{onSave:t.saveInlineKeyboard,"edited-keyboard":t.commandForm.inline_keyboard},null,8,["onSave","edited-keyboard"])])])):c("",!0),t.need_reply_keyboard?(l(),i("div",Xo,[Zo,e("div",xo,[v(O,{onSave:t.saveReplyKeyboard,"edited-keyboard":t.commandForm.reply_keyboard},null,8,["onSave","edited-keyboard"])])])):c("",!0),e("div",el,[tl,u(e("select",{class:"form-control","onUpdate:modelValue":o[10]||(o[10]=a=>t.commandForm.store_to=a)},[sl,(l(!0),i(b,null,f(t.store_variants,a=>(l(),i("option",{value:a.key},h(a.title||"Не указано"),9,ol))),256))],512),[[V,t.commandForm.store_to]])]),e("div",ll,[u(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[11]||(o[11]=a=>t.need_set_flags=a),id:"need-set-flags",checked:""},null,512),[[k,t.need_set_flags]]),il]),t.need_set_flags?(l(),i("div",nl,[al,(l(!0),i(b,null,f(t.flags_variants,a=>(l(),i("span",{class:w(["badge text-info mr-2",{"bg-info text-white":t.commandForm.result_flags.indexOf(a.key)!=-1}]),onClick:n=>t.selectFlag(a)},h(a.title),11,dl))),256))])):c("",!0),e("div",rl,[e("button",cl,[t.commandForm.id?(l(),i("span",ul,"Обновить диалог")):(l(),i("span",ml,"Добавить диалог"))])])],32)}}});const _l={class:"p-2 dialog-command-card"},pl={class:"badge bg-success"},bl=e("span",{class:"ml-1 mr-1"},[e("i",{class:"fa-solid fa-arrow-right"})],-1),gl={key:0,class:"badge bg-primary"},fl={key:1},yl=e("h6",null,"Текст диалога:",-1),vl={key:0,class:"w-100 d-flex justify-between"},kl={class:"dropdown"},$l=["disabled"],Fl=e("i",{class:"fa-solid fa-ellipsis"},null,-1),wl=[Fl],Cl={class:"dropdown-menu"},Sl=e("i",{class:"fa-solid fa-arrow-left mr-1"},null,-1),Pl=e("hr",null,null,-1),Vl=["data-bs-target"],Ul=e("i",{class:"fa-solid fa-sliders mr-1"},null,-1),jl=e("i",{class:"fa-solid fa-arrows-turn-to-dots mr-1"},null,-1),Bl=e("i",{class:"fa-solid fa-arrows-up-down mr-1"},null,-1),Ol=e("i",{class:"fa-solid fa-clone mr-1"},null,-1),Il=e("i",{class:"fa-solid fa-link-slash mr-1"},null,-1),Tl=e("i",{class:"fa-solid fa-trash-can mr-1"},null,-1),ql=["id"],Ll={class:"modal-dialog"},Dl={class:"modal-content"},Rl={class:"modal-header"},Gl={class:"modal-title fs-5",id:"staticBackdropLabel"},Ml={class:"badge bg-success"},zl=e("span",{class:"ml-1 mr-1"},[e("i",{class:"fa-solid fa-arrow-right"})],-1),Kl={key:0,class:"badge bg-primary"},El={key:1},Nl=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Al={class:"modal-body"},Jl=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),Wl={props:["item","simple","bot"],data(){return{loading:!1}},methods:{unlinkCommand(){this.loading=!0,this.$store.dispatch("unlinkDialogCommand",{dataObject:{dialogCommandId:this.item.id}}).then(s=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Диалоговая команда успешно продублирована!",type:"success"}),this.$emit("callback")}).catch(s=>{this.loading=!1})},removeCommand(){this.loading=!0,this.$store.dispatch("removeDialogCommand",{dataObject:{dialogCommandId:this.item.id}}).then(s=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Диалоговая команда успешно удалена!",type:"success"}),this.$emit("callback")}).catch(s=>{this.loading=!1})},selectDialog(){this.$emit("select",this.item)},duplicate(){this.loading=!0,this.$store.dispatch("duplicateDialogCommand",{dataObject:{dialogCommandId:this.item.id}}).then(s=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Диалоговая команда успешно продублирована!",type:"success"}),this.$emit("callback")}).catch(s=>{this.loading=!1})},changeGroup(){this.$emit("swap",{command_id:this.item.id,group_id:this.item.bot_dialog_group_id})},linkEvent(){this.$emit("link",{id:this.item.id,group_id:this.item.bot_dialog_group_id,current_next_id:this.item.next_bot_dialog_command_id})}}},M=Object.assign(Wl,{__name:"DialogCommandCard",setup(s){return(t,o)=>(l(),i(b,null,[e("div",_l,[e("p",null,[e("span",pl,"#"+h(s.item.id),1),bl,s.item.next_bot_dialog_command_id?(l(),i("span",gl,"#"+h(s.item.next_bot_dialog_command_id||"-"),1)):(l(),i("span",fl,"не связан"))]),yl,e("p",null,h(s.item.pre_text||"-"),1),s.simple?c("",!0):(l(),i("div",vl,[e("div",kl,[e("button",{disabled:t.loading,class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},wl,8,$l),e("ul",Cl,[e("li",null,[e("a",{onClick:o[0]||(o[0]=(...d)=>t.selectDialog&&t.selectDialog(...d)),title:"Выбрать диалог",class:"dropdown-item cursor-pointer"},[Sl,m(" Выбрать диалог ")])]),Pl,e("li",null,[e("a",{"data-bs-toggle":"modal","data-bs-target":"#dialog-command-modal-"+s.item.id,title:"Редактирование параметров карточки",class:"dropdown-item cursor-pointer"},[Ul,m(" Настройка диалога ")],8,Vl)]),e("li",null,[e("a",{onClick:o[1]||(o[1]=(...d)=>t.linkEvent&&t.linkEvent(...d)),title:"Диалог связывания с другой командой",class:"dropdown-item cursor-pointer"},[jl,m(" Редактирование связей ")])]),e("li",null,[e("a",{onClick:o[2]||(o[2]=(...d)=>t.changeGroup&&t.changeGroup(...d)),title:"Диалог смены группы команды",class:"dropdown-item cursor-pointer"},[Bl,m(" Смена диалоговой группы ")])]),e("li",null,[e("a",{title:"Дублирование команды",onClick:o[3]||(o[3]=(...d)=>t.duplicate&&t.duplicate(...d)),class:"dropdown-item cursor-pointer"},[Ol,m(" Дублирование диалога ")])]),e("li",null,[e("a",{onClick:o[4]||(o[4]=(...d)=>t.unlinkCommand&&t.unlinkCommand(...d)),title:"Убирает связь команды с другой командой по цепочке",class:"dropdown-item cursor-pointer"},[Il,m(" Удаление связей диалога ")])]),e("li",null,[e("a",{onClick:o[5]||(o[5]=(...d)=>t.removeCommand&&t.removeCommand(...d)),title:"Удаление команды",class:"dropdown-item cursor-pointer"},[Tl,m(" Удаление диалога ")])])])])]))]),e("div",{class:"modal fade",id:"dialog-command-modal-"+s.item.id,"data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true"},[e("div",Ll,[e("div",Dl,[e("div",Rl,[e("h1",Gl,[e("span",Ml,"#"+h(s.item.id),1),zl,s.item.next_bot_dialog_command_id?(l(),i("span",Kl,"#"+h(s.item.next_bot_dialog_command_id||"-"),1)):(l(),i("span",El,"не связан"))]),Nl]),e("div",Al,[v(G,{bot:s.bot,item:s.item},null,8,["bot","item"])]),Jl])])],8,ql)],64))}});const Yl={key:0,class:"row"},Hl={class:"col-12 mb-3"},Ql={class:"card mb-2"},Xl={class:"card-header"},Zl={class:"card-body"},xl={key:0,class:"row"},ei={class:"col-md-6 col-lg-4 col-12 col-sm-6 mb-2"},ti={key:1,class:"row"},si=e("div",{class:"col-12"},[e("p",null,"Диалоговых скриптов не найдено")],-1),oi=[si],li={class:"col-12"},ii={key:1,class:"row"},ni=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет созданных диалоговых групп ")],-1),ai=[ni],di={props:["bot"],data(){return{groupForm:{slug:null,title:null},loading:!0,dialog_groups:[],search:null,dialog_groups_paginate_object:null,link:null,selected_dialog_id:null,group:null}},computed:{...C(["getDialogGroups","getDialogGroupsPaginateObject"])},mounted(){this.loadGroups()},methods:{selectDialog(s){this.$emit("select-dialog",s),this.selected_dialog_id=s.id,this.$notify("Вы выбрали диалог из списка!")},nextGroups(s){this.loadGroups(s)},loadGroups(s=0){this.loading=!0,this.$store.dispatch("loadDialogGroups",{dataObject:{botId:this.bot.id||null,search:this.search},page:s}).then(t=>{this.loading=!1,this.dialog_groups=this.getDialogGroups,this.dialog_groups_paginate_object=this.getDialogGroupsPaginateObject}).catch(()=>{this.loading=!1})}}},ri=Object.assign(di,{__name:"BotDialogGroupListSimple",setup(s){return(t,o)=>t.dialog_groups.length>0?(l(),i("div",Yl,[e("div",Hl,[(l(!0),i(b,null,f(t.dialog_groups,(d,a)=>(l(),i("div",Ql,[e("div",Xl,[e("h6",null," #"+h(d.id)+" - "+h(d.title||"Не указано ")+" ("+h(d.slug||"Не указано")+")",1)]),e("div",Zl,[d.bot_dialog_commands.length>0?(l(),i("div",xl,[(l(!0),i(b,null,f(d.bot_dialog_commands,(n,_)=>(l(),i("div",ei,[v(M,{bot:s.bot,onSelect:t.selectDialog,item:n},null,8,["bot","onSelect","item"])]))),256))])):(l(),i("div",ti,oi))])]))),256))]),e("div",li,[t.dialog_groups_paginate_object?(l(),$(P,{key:0,onPagination_page:t.nextGroups,pagination:t.dialog_groups_paginate_object},null,8,["onPagination_page","pagination"])):c("",!0)])])):(l(),i("div",ii,ai))}}),ci=e("div",{class:"alert alert-success",role:"alert"},' Проверка правил идет по методу "И" - все правила должны выполняться для перехода на данную страницу, иначе будет вызвана страница из блока "иначе". Действия для "иначе" добавлять не обязательно. ',-1),ui=e("h6",null,"Блок условий",-1),mi={key:0,class:"py-2"},hi={class:"form-label",id:"bot-domain"},_i=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),pi=e("div",null,"Напишите текст, который будет отображен пользователю вместе с основным контентом в случае если условие будет выполнено ",-1),bi={class:"dropdown mb-2"},gi=e("button",{class:"btn btn-outline-info dropdown-toggle w-100",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"}," Добавить условие ",-1),fi={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},yi=["onClick"],vi={key:1},ki={key:2,class:"list-group"},$i={key:0,class:"list-group-item d-flex justify-content-between align-items-center"},Fi={class:"form-check"},wi={class:"form-check-label",for:"bot-user-is-vip"},Ci={key:0},Si={key:1},Pi=e("i",{class:"fa-solid fa-trash-can"},null,-1),Vi=[Pi],Ui={key:1,class:"list-group-item d-flex justify-content-between align-items-center"},ji={class:"form-check"},Bi={class:"form-check-label",for:"bot-user-is-admin"},Oi={key:0},Ii={key:1},Ti=e("i",{class:"fa-solid fa-trash-can"},null,-1),qi=[Ti],Li={key:2,class:"list-group-item d-flex justify-content-between align-items-center"},Di={class:"form-check"},Ri={class:"form-check-label",for:"bot-user-is-deliveryman"},Gi={key:0},Mi={key:1},zi=e("i",{class:"fa-solid fa-trash-can"},null,-1),Ki=[zi],Ei={key:3,class:"list-group-item d-flex justify-content-between align-items-center"},Ni={class:"form-check"},Ai={class:"form-check-label",for:"bot-user-is-work"},Ji={key:0},Wi={key:1},Yi=e("i",{class:"fa-solid fa-trash-can"},null,-1),Hi=[Yi],Qi={key:4,class:"list-group-item d-flex justify-content-between align-items-center"},Xi={class:"form-check"},Zi={class:"form-check-label",for:"bot-user-in-location"},xi={key:0},en={key:1},tn=e("i",{class:"fa-solid fa-trash-can"},null,-1),sn=[tn],on={key:5,class:"list-group-item d-flex justify-content-between align-items-center"},ln=e("label",{class:"form-label",id:"bot-domain"}," Возраст от ",-1),nn=e("i",{class:"fa-solid fa-trash-can"},null,-1),an=[nn],dn={key:6,class:"list-group-item d-flex justify-content-between align-items-center"},rn=e("label",{class:"form-label",id:"bot-domain"}," Только для города ",-1),cn=e("i",{class:"fa-solid fa-trash-can"},null,-1),un=[cn],mn={key:7,class:"list-group-item d-flex justify-content-between align-items-center"},hn={class:"form-check"},_n={class:"form-check-label",for:"bot-user-sex"},pn={key:0},bn={key:1},gn=e("i",{class:"fa-solid fa-trash-can"},null,-1),fn=[gn],yn={key:8,class:"list-group-item"},vn={class:"mb-3"},kn={class:"d-flex justify-content-between align-items-center"},$n={class:"form-label d-flex w-100 align-items-center",id:"bot-order-channel"},Fn=["onClick"],wn=e("i",{class:"fa-solid fa-trash-can"},null,-1),Cn=[wn],Sn=["onUpdate:modelValue"],Pn={key:3,class:"mt-5"},Vn={key:4,class:"d-flex justify-content-between"},Un={key:6,class:"py-2"},jn={class:"form-label",id:"bot-domain"},Bn=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),On=e("div",null,'Напишите текст, который будет отображен пользователю вместе с основным контентом в случае если условие не будет выполнено и будет вызван блок "иначе" ',-1),In={props:["bot","rulesForm"],data(){return{rules:[{id:1,title:"Является администратором",rules_block:"bot_user",rule:{is_admin:!0}},{id:2,title:"Является VIP-пользователем",rules_block:"bot_user",rule:{is_vip:!0}},{id:3,title:"Находится в заведении",rules_block:"bot_user",rule:{user_in_location:!0}},{id:4,title:"За работой",rules_block:"bot_user",rule:{is_work:!0}},{id:5,title:"Возраст от ...",rules_block:"bot_user",rule:{age:18}},{id:6,title:"Находится в городе ...",rules_block:"bot_user",rule:{city:"Краснодар"}},{id:7,title:"Пол",rules_block:"bot_user",rule:{sex:!0}},{id:8,title:"Состоит в канале",rules_block:"channels",rule:{channel:1}},{id:9,title:"Является Менеджером",rules_block:"bot_user",rule:{is_manager:!0}}]}},computed:{rulesForCustomFields(){let s=this.rules.filter(t=>t.key!=null);return console.log("filtered rules",s),s}},mounted(){},methods:{hasRuleKey(s){return this.rulesForm.rules_if==null?!1:(console.log("key=>",s||"-"),Object.keys(this.rulesForm.rules_if.bot_user).find(t=>t===s)!=null)},modifyChannel(s){this.rulesForm.rules_if.channels[s.param]=s.text},removeChannelFromRule(s){this.rulesForm.rules_if.channels.splice(s,1)},removeRule(s){delete this.rulesForm.rules_if.bot_user[s]},addRules(s){this.rulesForm.rules_if||(this.rulesForm.rules_if={bot_user:{},channels:[]}),s.rules_block==="bot_user"&&(this.rulesForm.rules_if.bot_user={...this.rulesForm.rules_if.bot_user,...s.rule}),s.rules_block==="channels"&&this.rulesForm.rules_if.channels.push(s.rule.channel)},loadCurrentBotFields(){return this.$store.dispatch("loadCurrentBotFields",{bot_id:this.bot.id}).then(s=>{(s.data||[]).forEach(o=>{o.is_active&&(this.rules.push({id:this.rules.length+1,title:o.label,key:o.key,type:o.type,rules_block:"bot_user",rule:{}}),o.type===0&&(this.rules[this.rules.length-1].rule[o.key]=""),o.type===1&&(this.rules[this.rules.length-1].rule[o.key]=0),o.type===2&&(this.rules[this.rules.length-1].rule[o.key]=!0))}),console.log("new rules=>",this.rules)})},attachPageToRule(s){s.id!=this.rulesForm.id?this.rulesForm.rules_else_page_id=s.id:this.$notify({title:"Конструктор страниц",text:"Вы не можете связать данную страницу с собой",type:"error"})}}},Tn=Object.assign(In,{__name:"PageRules",setup(s){return(t,o)=>{const d=B("Popper");return l(),i(b,null,[ci,ui,s.rulesForm.rules_if?(l(),i("div",mi,[e("label",hi,[v(d,null,{content:y(()=>[pi]),default:y(()=>[_i]),_:1}),m(" Сообщение при успешном прохождении условий (не обязательно) ")]),u(e("textarea",{type:"text",class:"form-control",placeholder:"Текст сообщения","aria-label":"Текст сообщения","onUpdate:modelValue":o[0]||(o[0]=a=>s.rulesForm.rules_if_message=a),maxlength:"255","aria-describedby":"rules-else-message"},`
            `,512),[[p,s.rulesForm.rules_if_message]])])):c("",!0),e("div",bi,[gi,e("ul",fi,[(l(!0),i(b,null,f(t.rules,a=>(l(),i("li",null,[e("a",{onClick:n=>t.addRules(a),class:"dropdown-item",href:"javascript:void(0)"},h(a.title||"Не указан"),9,yi)]))),256))])]),s.rulesForm.rules_if?(l(),i("h6",vi,"Выбранные условия")):c("",!0),s.rulesForm.rules_if?(l(),i("ul",ki,[t.hasRuleKey("is_vip")?(l(),i("li",$i,[e("div",Fi,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[1]||(o[1]=a=>s.rulesForm.rules_if.bot_user.is_vip=a),type:"checkbox",id:"bot-user-is-vip"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_vip]]),e("label",wi,[s.rulesForm.rules_if.bot_user.is_vip?(l(),i("span",Ci,"Является VIP-пользователем")):(l(),i("span",Si,"Не является VIP-пользователем"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[2]||(o[2]=a=>t.removeRule("is_vip"))},Vi)])):c("",!0),t.hasRuleKey("is_admin")?(l(),i("li",Ui,[e("div",ji,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[3]||(o[3]=a=>s.rulesForm.rules_if.bot_user.is_admin=a),type:"checkbox",id:"bot-user-is-admin"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_admin]]),e("label",Bi,[s.rulesForm.rules_if.bot_user.is_admin?(l(),i("span",Oi,"Является администратором")):(l(),i("span",Ii,"Не является администратором"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[4]||(o[4]=a=>t.removeRule("is_admin"))},qi)])):c("",!0),t.hasRuleKey("is_deliveryman")?(l(),i("li",Li,[e("div",Di,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[5]||(o[5]=a=>s.rulesForm.rules_if.bot_user.is_deliveryman=a),type:"checkbox",id:"bot-user-is-deliveryman"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_deliveryman]]),e("label",Ri,[s.rulesForm.rules_if.bot_user.is_deliveryman?(l(),i("span",Gi,"Является доставщиком")):(l(),i("span",Mi,"Не является доставщиком"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[6]||(o[6]=a=>t.removeRule("is_deliveryman"))},Ki)])):c("",!0),t.hasRuleKey("is_work")?(l(),i("li",Ei,[e("div",Ni,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[7]||(o[7]=a=>s.rulesForm.rules_if.bot_user.is_work=a),type:"checkbox",id:"bot-user-is-work"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_work]]),e("label",Ai,[s.rulesForm.rules_if.bot_user.is_work?(l(),i("span",Ji,"За работой")):(l(),i("span",Wi,"Не работает"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[8]||(o[8]=a=>t.removeRule("is_work"))},Hi)])):c("",!0),t.hasRuleKey("user_in_location")?(l(),i("li",Qi,[e("div",Xi,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[9]||(o[9]=a=>s.rulesForm.rules_if.bot_user.user_in_location=a),type:"checkbox",id:"bot-user-in-location"},null,512),[[k,s.rulesForm.rules_if.bot_user.user_in_location]]),e("label",Zi,[s.rulesForm.rules_if.bot_user.user_in_location?(l(),i("span",xi,"Находится в заведении")):(l(),i("span",en,"Не находится в заведении"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[10]||(o[10]=a=>t.removeRule("user_in_location"))},sn)])):c("",!0),t.hasRuleKey("age")?(l(),i("li",on,[e("div",null,[ln,u(e("input",{type:"text",class:"form-control",placeholder:"Возраст от","aria-label":"Возраст от","onUpdate:modelValue":o[11]||(o[11]=a=>s.rulesForm.rules_if.bot_user.age=a),maxlength:"255","aria-describedby":"bot-user-age"},null,512),[[p,s.rulesForm.rules_if.bot_user.age]])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[12]||(o[12]=a=>t.removeRule("age"))},an)])):c("",!0),t.hasRuleKey("city")?(l(),i("li",dn,[e("div",null,[rn,u(e("input",{type:"text",class:"form-control",placeholder:"Город","aria-label":"Город","onUpdate:modelValue":o[13]||(o[13]=a=>s.rulesForm.rules_if.bot_user.city=a),maxlength:"255","aria-describedby":"bot-user-city"},null,512),[[p,s.rulesForm.rules_if.bot_user.city]])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[14]||(o[14]=a=>t.removeRule("city"))},un)])):c("",!0),t.hasRuleKey("sex")?(l(),i("li",mn,[e("div",hn,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[15]||(o[15]=a=>s.rulesForm.rules_if.bot_user.sex=a),type:"checkbox",id:"bot-user-sex"},null,512),[[k,s.rulesForm.rules_if.bot_user.sex]]),e("label",_n,[s.rulesForm.rules_if.bot_user.sex?(l(),i("span",pn,"Только для мужчин")):(l(),i("span",bn,"Только для женщин"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[16]||(o[16]=a=>t.removeRule("sex"))},fn)])):c("",!0),s.rulesForm.rules_if.channels.length>0?(l(),i("li",yn,[m("Проверка нахождения в канале \\ группе: "),(l(!0),i(b,null,f(s.rulesForm.rules_if.channels,(a,n)=>(l(),i("div",vn,[e("div",kn,[e("label",$n,[v(I,{token:s.bot.bot_token,param:`${n}`,onCallback:t.modifyChannel},null,8,["token","param","onCallback"]),m(" Канал для проверки ")]),e("button",{type:"button",class:"btn btn-link text-danger",onClick:_=>t.removeChannelFromRule(n)},Cn,8,Fn)]),u(e("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":_=>s.rulesForm.rules_if.channels[n]=_,maxlength:"255","aria-describedby":"bot-order-channel"},null,8,Sn),[[p,s.rulesForm.rules_if.channels[n]]])]))),256))])):c("",!0)])):c("",!0),s.rulesForm.rules_if?(l(),i("h6",Pn,"Иначе")):c("",!0),s.rulesForm.rules_else_page_id?(l(),i("p",Vn,[m("Вы выбрали страницу #"+h(s.rulesForm.rules_else_page_id)+' в качестве условия "иначе" ',1),e("a",{href:"javascript:void(0)",onClick:o[17]||(o[17]=a=>s.rulesForm.rules_else_page_id=null)},"Очистить")])):c("",!0),s.rulesForm.rules_if?(l(),$(L,{key:5,current:s.rulesForm.id,onCallback:t.attachPageToRule,editor:!1},null,8,["current","onCallback"])):c("",!0),s.rulesForm.rules_if?(l(),i("div",Un,[e("label",jn,[v(d,null,{content:y(()=>[On]),default:y(()=>[Bn]),_:1}),m(" Сообщение в случае невыполнения условий (не обязательно) ")]),u(e("textarea",{type:"text",class:"form-control",placeholder:"Текст сообщения","aria-label":"Текст сообщения","onUpdate:modelValue":o[18]||(o[18]=a=>s.rulesForm.rules_else_message=a),maxlength:"255","aria-describedby":"rules-else-message"},`
            `,512),[[p,s.rulesForm.rules_else_message]])])):c("",!0)],64)}}}),qn={class:"row"},Ln={class:"col-12 mb-2"},Dn={class:"d-flex justify-between"},Rn={key:0,class:"col-12 mb-2"},Gn={class:"form-check"},Mn=e("label",{class:"form-check-label",for:"need-show-qr-and-link"}," Показать ссылку на страницу и QR-код ",-1),zn={key:1,class:"col-12 mb-2"},Kn={class:"d-flex justify-content-center"},En={style:{width:"200px",height:"200px"}},Nn={class:"col-12 mb-2"},An={class:"form-label",id:"bot-domain"},Jn=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Wn=e("div",null,[m(" Команда должна начинаться с символва . и *"),e("br"),m(" Например: .*Меню"),e("br")],-1),Yn=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Hn={class:"col-12 mb-2"},Qn={class:"form-check"},Xn=e("label",{class:"form-check-label",for:"is-external"}," Внешнее управление страницей ",-1),Zn={class:"col-12 mb-2"},xn={class:"form-label",id:"bot-domain"},ea=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),ta=e("div",null,"Напишите для себя пояснение для чего нужна данная страница. Это поможет другим менеджерам лучше понять Вас. ",-1),sa=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),oa={key:0,class:"row"},la={class:"col-12 mb-2"},ia={class:"form-label d-flex justify-content-between align-items-center mb-0",id:"bot-domain"},na=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),aa=e("div",null,[m(" Текстовый редактор. Данный текст будет в таком"),e("br"),m(" же виде отображен в посте в телеграм. ")],-1),da=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),ra={class:"form-floating"},ca={for:"floatingTextarea2"},ua={key:0},ma={class:"col-12 mb-2"},ha={class:"form-check"},_a=e("label",{class:"form-check-label",for:"need-page-images"}," Изображения на странице (максимум 10) ",-1),pa={key:0,class:"col-12 mb-2"},ba={class:"card mb-3"},ga=e("div",{class:"card-header"},[e("h6",null,"Загрузите изображения с файловой системы")],-1),fa={class:"card-body d-flex justify-content-start"},ya={for:"photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},va={class:"row"},ka={key:0,class:"col-12 d-flex flex-wrap"},$a={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Fa={class:"remove"},wa=["onClick"],Ca={key:1},Sa={key:2,class:"col-12 d-flex flex-wrap"},Pa={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Va={class:"remove"},Ua=["onClick"],ja={class:"col-12 mb-2"},Ba={class:"form-check"},Oa=e("label",{class:"form-check-label",for:"need-page-video"}," Видео к странице ",-1),Ia={key:1,class:"col-12 mb-2"},Ta=e("p",{class:"alert alert-danger"},[e("strong",null,"Внимание!"),m(" не больше 10 видео на 1й странице! ")],-1),qa={class:"col-12 mb-2"},La={class:"form-check"},Da=e("label",{class:"form-check-label",for:"need-reply-menu"}," Нижнее меню страницы ",-1),Ra={key:2,class:"col-12 mb-2"},Ga={class:"card"},Ma={class:"card-header d-flex justify-between align-items-center"},za=e("h6",null,"Конструктор нижнего меню",-1),Ka={key:0},Ea={key:1},Na={class:"card-body"},Aa={class:"col-12 mb-2"},Ja={class:"form-label",id:"bot-domain"},Wa=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Ya=e("div",null," Заголовок для нижнего меню ",-1),Ha={class:"col-12 mb-2"},Qa={class:"form-check"},Xa=e("label",{class:"form-check-label",for:"need-inline-menu"}," Меню под текстом страницы ",-1),Za={key:3,class:"col-12 mb-2"},xa={class:"card"},ed={class:"card-header d-flex justify-between align-items-center"},td=e("h6",null,"Конструктор меню в сообщении",-1),sd={key:0},od={key:1},ld={class:"card-body"},id={class:"col-12 mb-2"},nd={class:"form-check"},ad=e("label",{class:"form-check-label",for:"need-page-attach"}," Связать с другой страницей ",-1),dd={key:4,class:"col-12 mb-2"},rd={key:0},cd={class:"col-12 mb-2"},ud={class:"form-check"},md=e("label",{class:"form-check-label",for:"need-slug-attach"}," Привязать скрипт ",-1),hd={key:5,class:"col-12 mb-2"},_d={key:0},pd={class:"col-12 mb-2"},bd={class:"form-check"},gd=e("label",{class:"form-check-label",for:"need-dialog-attach"}," Привязать начало диалога ",-1),fd={key:6,class:"col-12 mb-2"},yd={key:0},vd={class:"row"},kd={class:"col-12 mb-2"},$d={class:"form-check"},Fd=e("label",{class:"form-check-label",for:"need-rules"}," Нужны правила загрузки страницы ",-1),wd={key:0,class:"col-12 mb-2"},Cd=e("div",{class:"row"},[e("div",{class:"col-12 mb-2"},[e("button",{class:"btn btn-outline-primary w-100 p-3"},"Сохранить страницу")])],-1),Sd={props:["page"],data(){return{need_show_qr_and_link:!1,need_clean:!1,load:!1,photos:[],showReplyTemplateSelector:!1,showInlineTemplateSelector:!1,need_page_video:!1,need_page_images:!1,need_inline_menu:!1,need_reply_menu:!1,need_attach_page:!1,need_attach_dialog:!1,need_attach_slug:!1,need_rules:!1,bot:null,pageForm:{id:null,content:"",command:null,slug:null,comment:null,videos:[],images:[],reply_keyboard_title:null,reply_keyboard:null,inline_keyboard:null,is_external:!1,next_page_id:null,next_bot_dialog_command_id:null,next_bot_menu_slug_id:null,rules_if:null,rules_else_page_id:null,rules_if_message:null,rules_else_message:null}}},watch:{need_page_images:function(s,t){this.need_page_images||(this.photos=[],this.pageForm.images=[])},need_page_video:function(s,t){this.need_page_video||(this.pageForm.videos=[])},need_inline_menu:function(s,t){this.need_inline_menu||(this.pageForm.inline_keyboard=null,this.pageForm.inline_keyboard_id=null)},need_rules:function(s,t){this.need_rules||(this.pageForm.rules_if=null,this.pageForm.rules_else_page_id=null,this.pageForm.rules_if_message=null,this.pageForm.rules_else_message=null)},need_reply_menu:function(s,t){this.need_reply_menu||(this.pageForm.reply_keyboard=null,this.pageForm.reply_keyboard_id=null)},need_attach_page:function(s,t){this.need_attach_page||(this.pageForm.next_page_id=null)},need_attach_dialog:function(s,t){this.need_attach_dialog||(this.pageForm.next_bot_dialog_command_id=null)},need_attach_slug:function(s,t){this.need_attach_slug||(this.pageForm.next_bot_menu_slug_id=null)},pageForm:{handler:function(s){this.pageForm.reply_keyboard!=null&&(this.need_reply_menu=!0),this.pageForm.inline_keyboard!=null&&(this.need_inline_menu=!0),this.pageForm.images.length>0&&(this.need_page_images=!0),this.pageForm.next_bot_dialog_command_id!=null&&(this.need_attach_dialog=!0),this.pageForm.next_bot_menu_slug_id!=null&&(this.need_attach_slug=!0),this.pageForm.next_page_id!=null&&(this.need_attach_page=!0),this.pageForm.rules_if!=null&&(this.need_rules=!0),this.pageForm.videos.length>0&&(this.need_page_video=!0),this.need_clean=!0},deep:!0}},computed:{...C(["getCurrentBot"]),qr(){return"https://api.qrserver.com/v1/create-qr-code/?size=450x450&qzone=2&data="+this.link},pageLink(){if(!this.pageForm.id)return"Ссылка недоступна";let s="";for(let t=0;t<10-(""+this.pageForm.id).length;t++)s+="0";return s+=this.pageForm.id,"https://t.me/"+this.getCurrentBot.bot_domain+"?start="+btoa("004"+s)}},mounted(){if(this.page){let s=this.page;this.photos=[],this.pageForm={id:s.id,slug_id:s.slug?s.slug.id:null,content:s.content,command:s.slug?s.slug.command:null,slug:s.slug?s.slug.slug:null,comment:s.slug?s.slug.comment:null,images:s.images||[],reply_keyboard_title:s.reply_keyboard_title||null,reply_keyboard_id:s.reply_keyboard_id||null,inline_keyboard_id:s.inline_keyboard_id||null,reply_keyboard:s.replyKeyboard||null,inline_keyboard:s.inlineKeyboard||null,next_page_id:s.next_page_id||null,next_bot_dialog_command_id:s.next_bot_dialog_command_id||null,next_bot_menu_slug_id:s.next_bot_menu_slug_id||null,is_external:s.is_external||!1,rules_if:s.rules_if||null,rules_else_page_id:s.rules_else_page_id||null,videos:s.videos||[],rules_if_message:s.rules_if_message||null,rules_else_message:s.rules_else_message||null}}else this.clearForm();this.loadCurrentBot().then(()=>{})},methods:{copyToClipBoard(s){navigator.clipboard.writeText(s).then(()=>{this.$notify({title:"Копирование",text:"Ссылка скопирована в буфер"})}).catch(t=>{this.$notify({title:"Копирование",text:"Ошибка копирования",type:"error"})})},associateDialog(s){this.pageForm.next_bot_dialog_command_id=s.id},associateSlug(s){this.pageForm.next_bot_menu_slug_id=s.id},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},attachPage(s){s.id!=this.pageForm.id?this.pageForm.next_page_id=s.id:this.$notify({title:"Конструктор страниц",text:"Вы не можете связать данную страницу с собой",type:"error"})},injectContent(s){this.pageForm.content?this.pageForm.content+=s.text:this.pageForm.content=s.text},clearForm(){this.photos=[],this.pageForm={id:null,content:null,command:null,slug:null,comment:null,images:[],reply_keyboard:null,inline_keyboard:null,is_external:!1,videos:[],reply_keyboard_title:null,reply_keyboard_id:null,inline_keyboard_id:null,next_page_id:null,next_bot_dialog_command_id:null,next_bot_menu_slug_id:null,rules_if_message:null,rules_else_message:null},this.photos=[],this.showReplyTemplateSelector=!1,this.showInlineTemplateSelector=!1,this.need_page_images=!1,this.need_page_video=!1,this.need_inline_menu=!1,this.need_reply_menu=!1,this.need_attach_page=!1,this.need_attach_dialog=!1,this.need_attach_slug=!1,this.need_rules=!1,this.$nextTick(()=>{this.need_clean=!1})},submitPage(){let s=new FormData;if(Object.keys(this.pageForm).forEach(t=>{const o=this.pageForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.bot&&s.append("bot_id",this.bot.id),this.photos.length>0)for(let t=0;t<this.photos.length;t++)s.append("photos[]",this.photos[t]);this.$store.dispatch(this.pageForm.id==null?"createPage":"updatePage",{pageForm:s}).then(t=>{this.pageForm.id==null&&(this.load=!0,this.$nextTick(()=>{this.load=!1,this.clearForm()})),this.$emit("callback",t.data),this.$notify({title:"Конструктор ботов",text:this.pageForm.id==null?"Страница успешно создана!":"Страница успешно обновлена!",type:"success"}),this.pageForm.id!=null&&this.$store.dispatch("loadPages",{dataObject:{botId:this.bot.id},page:localStorage.getItem(`cashman_pagelist_${this.bot.id}_page_index`)||0})}).catch(t=>{})},saveInlineKeyboard(s){this.pageForm.inline_keyboard=s},selectReplyKeyboard(s){this.pageForm.reply_keyboard=s,this.showReplyTemplateSelector=!1},selectInlineKeyboard(s){this.pageForm.inline_keyboard=s,this.showInlineTemplateSelector=!1},saveReplyKeyboard(s){this.pageForm.reply_keyboard=s},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removePhoto(s){this.photos.splice(s,1)},removeImage(s){this.pageForm.images.splice(s,1)},onChangePhotos(s){const t=s.target.files;for(let o=0;o<t.length;o++)this.photos.push(t[o])},onChange(s){this.pageForm.content=s},selectPhoto(s){this.pageForm.images||(this.pageForm.images=[]);let t=this.pageForm.images.indexOf(s.file_id);t!==-1?this.pageForm.images.splice(t,1):this.pageForm.images.push(s.file_id)},selectVideo(s){this.pageForm.videos||(this.pageForm.videos=[]);let t=this.pageForm.videos.indexOf(s.file_id);t!==-1?this.pageForm.videos.splice(t,1):this.pageForm.videos.push(s.file_id)}}},Pd=Object.assign(Sd,{__name:"Page",setup(s){return(t,o)=>{const d=B("Popper"),a=j("lazy");return t.bot?(l(),i("form",{key:0,onSubmit:o[22]||(o[22]=S((...n)=>t.submitPage&&t.submitPage(...n),["prevent"]))},[e("div",qn,[e("div",Ln,[e("h6",Dn,[e("span",null,"Вы создаете страницу для "+h(t.bot.bot_domain),1),t.pageForm.id||t.need_clean?(l(),i("a",{key:0,href:"#clear-form",onClick:o[0]||(o[0]=(...n)=>t.clearForm&&t.clearForm(...n))},"очистить форму")):c("",!0)])]),t.pageForm.id?(l(),i("div",Rn,[e("div",Gn,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[1]||(o[1]=n=>t.need_show_qr_and_link=n),type:"checkbox",id:"need-show-qr-and-link"},null,512),[[k,t.need_show_qr_and_link]]),Mn])])):c("",!0),t.pageForm.id&&t.need_show_qr_and_link?(l(),i("div",zn,[e("p",null,[m("Ссылка на текущую страницу: "),e("span",{class:"bg-secondary font-bold cursor-pointer",onClick:o[2]||(o[2]=n=>t.copyToClipBoard(t.pageLink))},h(t.pageLink),1)]),e("div",Kn,[u(e("img",En,null,512),[[a,t.qr]])])])):c("",!0),e("div",Nn,[e("label",An,[v(d,null,{content:y(()=>[Wn]),default:y(()=>[Jn]),_:1}),m(" Команда "),Yn]),u(e("input",{type:"text",class:"form-control",placeholder:"Команда","aria-label":"Команда","onUpdate:modelValue":o[3]||(o[3]=n=>t.pageForm.command=n),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[p,t.pageForm.command]])]),e("div",Hn,[e("div",Qn,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[4]||(o[4]=n=>t.pageForm.is_external=n),type:"checkbox",id:"is-external"},null,512),[[k,t.pageForm.is_external]]),Xn])]),e("div",Zn,[e("label",xn,[v(d,null,{content:y(()=>[ta]),default:y(()=>[ea]),_:1}),m(" Описание страницы "),sa]),u(e("textarea",{type:"text",class:"form-control",placeholder:"Описание страницы","aria-label":"Описание страницы","onUpdate:modelValue":o[5]||(o[5]=n=>t.pageForm.comment=n),maxlength:"255","aria-describedby":"bot-domain",required:""},`
            `,512),[[p,t.pageForm.comment]])])]),t.pageForm.is_external?c("",!0):(l(),i("div",oa,[e("div",la,[e("label",ia,[e("div",null,[v(d,null,{content:y(()=>[aa]),default:y(()=>[na]),_:1}),m(" Текстовое содержимое страницы "),da]),v(Z,{param:"content",onCallback:t.injectContent},null,8,["onCallback"])]),e("div",ra,[u(e("textarea",{class:"form-control","onUpdate:modelValue":o[6]||(o[6]=n=>t.pageForm.content=n),maxlength:"4096",placeholder:"Введите текст",id:"floatingTextarea2",style:{"min-height":"100px"}},null,512),[[p,t.pageForm.content]]),e("label",ca,[m("Содержимое страницы "),t.pageForm.content?(l(),i("span",ua,h(t.pageForm.content.length)+"/4096 ",1)):c("",!0)])])]),e("div",ma,[e("div",ha,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[7]||(o[7]=n=>t.need_page_images=n),type:"checkbox",id:"need-page-images"},null,512),[[k,t.need_page_images]]),_a])]),t.need_page_images?(l(),i("div",pa,[e("div",ba,[ga,e("div",fa,[e("label",ya,[m(" + "),e("input",{type:"file",id:"photos",multiple:"",accept:"image/*",onChange:o[8]||(o[8]=(...n)=>t.onChangePhotos&&t.onChangePhotos(...n)),style:{display:"none"}},null,32)]),e("div",va,[t.photos.length>0?(l(),i("div",ka,[(l(!0),i(b,null,f(t.photos,(n,_)=>(l(),i("div",$a,[u(e("img",null,null,512),[[a,t.getPhoto(n).imageUrl]]),e("div",Fa,[e("a",{onClick:r=>t.removePhoto(_)},"Удалить",8,wa)])]))),256))])):c("",!0),t.pageForm.images.length>0?(l(),i("h6",Ca,"Ранее загруженные фотографии")):c("",!0),t.pageForm.images.length>0?(l(),i("div",Sa,[(l(!0),i(b,null,f(t.pageForm.images,(n,_)=>(l(),i("div",Pa,[u(e("img",null,null,512),[[a,"/images-by-bot-id/"+t.bot.id+"/"+n]]),e("div",Va,[e("a",{onClick:r=>t.removeImage(_)},"Удалить",8,Ua)])]))),256))])):c("",!0)])])])])):c("",!0),e("div",ja,[e("div",Ba,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[9]||(o[9]=n=>t.need_page_video=n),type:"checkbox",id:"need-page-video"},null,512),[[k,t.need_page_video]]),Oa])]),t.need_page_video?(l(),i("div",Ia,[Ta,v(A,{"need-video":!0,"need-video-note":!0,selected:t.pageForm.videos,onSelect:t.selectVideo},null,8,["selected","onSelect"])])):c("",!0),e("div",qa,[e("div",La,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[10]||(o[10]=n=>t.need_reply_menu=n),type:"checkbox",id:"need-reply-menu"},null,512),[[k,t.need_reply_menu]]),Da])]),t.need_reply_menu?(l(),i("div",Ra,[e("div",Ga,[e("div",Ma,[za,e("button",{class:w(["btn",{"btn-outline-primary":!t.showReplyTemplateSelector,"btn-primary":t.showReplyTemplateSelector}]),type:"button",onClick:o[11]||(o[11]=n=>t.showReplyTemplateSelector=!t.showReplyTemplateSelector)},[t.showReplyTemplateSelector?(l(),i("span",Ea," Скрыть шаблоны меню")):(l(),i("span",Ka," Открыть шаблоны меню"))],2)]),e("div",Na,[e("div",Aa,[e("label",Ja,[v(d,null,{content:y(()=>[Ya]),default:y(()=>[Wa]),_:1}),m(" Заголовок ")]),u(e("input",{type:"text",class:"form-control",placeholder:"Заголовок меню","aria-label":"Заголовок меню","onUpdate:modelValue":o[12]||(o[12]=n=>t.pageForm.reply_keyboard_title=n),maxlength:"255","aria-describedby":"bot-domain"},null,512),[[p,t.pageForm.reply_keyboard_title]])]),t.showReplyTemplateSelector?(l(),$(q,{key:0,class:"mb-2",type:"reply",onSelect:t.selectReplyKeyboard,"select-mode":!0},null,8,["onSelect"])):(l(),$(O,{key:1,type:"reply",onSave:t.saveReplyKeyboard,"edited-keyboard":t.pageForm.reply_keyboard},null,8,["onSave","edited-keyboard"]))])])])):c("",!0),e("div",Ha,[e("div",Qa,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[13]||(o[13]=n=>t.need_inline_menu=n),type:"checkbox",id:"need-inline-menu"},null,512),[[k,t.need_inline_menu]]),Xa])]),t.need_inline_menu?(l(),i("div",Za,[e("div",xa,[e("div",ed,[td,e("button",{class:w(["btn",{"btn-outline-primary":!t.showInlineTemplateSelector,"btn-primary":t.showInlineTemplateSelector}]),type:"button",onClick:o[14]||(o[14]=n=>t.showInlineTemplateSelector=!t.showInlineTemplateSelector)},[t.showInlineTemplateSelector?(l(),i("span",od," Скрыть шаблоны меню")):(l(),i("span",sd," Открыть шаблоны меню"))],2)]),e("div",ld,[t.showInlineTemplateSelector?(l(),$(q,{key:0,class:"mb-2",type:"inline",onSelect:t.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(l(),$(O,{key:1,type:"inline",onSave:t.saveInlineKeyboard,"edited-keyboard":t.pageForm.inline_keyboard},null,8,["onSave","edited-keyboard"]))])])])):c("",!0),e("div",id,[e("div",nd,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[15]||(o[15]=n=>t.need_attach_page=n),type:"checkbox",id:"need-page-attach"},null,512),[[k,t.need_attach_page]]),ad])]),t.need_attach_page?(l(),i("div",dd,[t.pageForm.next_page_id?(l(),i("p",rd,[m("Связано со страницей #"+h(t.pageForm.next_page_id)+" ",1),e("a",{class:"btn btn-link",onClick:o[16]||(o[16]=n=>t.pageForm.next_page_id=null)},"Очистить")])):c("",!0),v(L,{current:t.pageForm.id,onCallback:t.attachPage,editor:!1},null,8,["current","onCallback"])])):c("",!0),e("div",cd,[e("div",ud,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[17]||(o[17]=n=>t.need_attach_slug=n),type:"checkbox",id:"need-slug-attach"},null,512),[[k,t.need_attach_slug]]),md])]),t.need_attach_slug?(l(),i("div",hd,[t.pageForm.next_bot_menu_slug_id?(l(),i("p",_d,[m("Связано со скриптом #"+h(t.pageForm.next_bot_menu_slug_id)+" ",1),e("a",{class:"btn btn-link",onClick:o[18]||(o[18]=n=>t.pageForm.next_bot_menu_slug_id=null)},"Очистить")])):c("",!0),t.bot?(l(),$(to,{key:1,global:!0,onCallback:t.associateSlug,bot:t.bot},null,8,["onCallback","bot"])):c("",!0)])):c("",!0),e("div",pd,[e("div",bd,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[19]||(o[19]=n=>t.need_attach_dialog=n),type:"checkbox",id:"need-dialog-attach"},null,512),[[k,t.need_attach_dialog]]),gd])]),t.need_attach_dialog?(l(),i("div",fd,[t.pageForm.next_bot_dialog_command_id?(l(),i("p",yd,[m("Связано с диалогом #"+h(t.pageForm.next_bot_dialog_command_id)+" ",1),e("a",{class:"btn btn-link",onClick:o[20]||(o[20]=n=>t.pageForm.next_bot_dialog_command_id=null)},"Очистить")])):c("",!0),t.bot?(l(),$(ri,{key:1,onSelectDialog:t.associateDialog,bot:t.bot},null,8,["onSelectDialog","bot"])):c("",!0)])):c("",!0)])),e("div",vd,[e("div",kd,[e("div",$d,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[21]||(o[21]=n=>t.need_rules=n),type:"checkbox",id:"need-rules"},null,512),[[k,t.need_rules]]),Fd])]),t.need_rules?(l(),i("div",wd,[v(Tn,{bot:t.bot,"rules-form":t.pageForm},null,8,["bot","rules-form"])])):c("",!0)]),Cd],32)):c("",!0)}}}),Vd={data(){return{bot:null,menus:[],deletedMenus:[],menuForm:{title:null,description:null,image:null,info_link:null,bot_id:null}}},computed:{...C(["getCurrentBot"])},mounted(){this.loadCurrentBot().then(()=>{this.loadMenuByBotId()})},methods:{loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},loadMenuByBotId(){this.$store.dispatch("loadMenuByBotId",{botId:this.bot.id}).then(s=>{this.menus=s}).catch(()=>{})},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removePhoto(){this.menuForm.image=null},removeItem(s){this.menus[s].id&&this.deletedMenus.push(this.menus[s].id),this.menus.splice(s,1)},submitMenus(){this.menus.forEach(s=>{let t=new FormData;Object.keys(s).forEach(o=>{const d=s[o]||"";typeof d=="object"?t.append(o,JSON.stringify(d)):t.append(o,d)}),this.deletedMenus.length>0&&t.append("deleted_menus",JSON.stringify(this.deletedMenus)),typeof s.image!="string"&&(t.append("preview",s.image),t.delete("image")),this.$store.dispatch("createImageMenu",{menuForm:t}).then(o=>{this.$emit("callback",o.data),this.$notify("Меню успешно создано и сохранено")}).catch(o=>{})})},addImageMenu(){this.menuForm.bot_id=this.bot.id,this.menus.push(this.menuForm),this.$notify("Меню успешно добавлено в список"),this.menuForm={title:null,description:null,image:null,info_link:null,bot_id:null}},onChangePhotos(s){const t=s.target.files[0];this.menuForm.image=t}}},Ud={key:0,class:"card"},jd={class:"card-body"},Bd={class:"row"},Od={class:"col-md-8"},Id={class:"row"},Td={class:"col-12"},qd={class:"mb-3"},Ld=e("label",{class:"form-label",id:"menu-address"},[m(" Заголовок меню "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),Dd={class:"row"},Rd={class:"col-12"},Gd={class:"mb-3"},Md={class:"form-label",id:"menu-description"},zd=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Kd={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},Ed={class:"row"},Nd={class:"col-12"},Ad={class:"mb-3"},Jd=e("label",{class:"form-label",id:"menu-address"},[m("Ссылка на страницу в "),e("a",{target:"_blank",href:"https://telegra.ph"},"telegra.ph")],-1),Wd={class:"row"},Yd={class:"col-12 mb-3"},Hd=e("h5",null,"Картинка меню с позициями",-1),Qd={class:"photo-preview d-flex justify-content-start flex-wrap w-100"},Xd={for:"menu-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},Zd=e("span",null,"+",-1),xd={key:0,class:"mb-2 img-preview",style:{"margin-right":"10px"}},er={class:"remove"},tr=e("div",{class:"row"},[e("div",{class:"col-12"},[e("button",{class:"btn btn-outline-success w-100",type:"submit"},"Добавить меню ")])],-1),sr={class:"col-md-4"},or={class:"row"},lr={class:"col-12 mt-3"},ir={class:"card"},nr={class:"card-header d-flex justify-content-between"},ar=["onClick"],dr={class:"card-body"},rr={class:"w-100 d-flex"},cr={key:0,class:"mb-2 img-preview",style:{"margin-right":"10px"}},ur={key:0},mr={key:1},hr={key:1,class:"col-12 mt-3"},_r=e("p",null,"На текущий момент у заведения нет ни 1 созданного меню",-1),pr=[_r],br={class:"row mt-3"},gr={class:"col-12"},fr=["disabled"];function yr(s,t,o,d,a,n){const _=j("lazy");return a.bot?(l(),i("div",Ud,[e("div",jd,[e("div",Bd,[e("div",Od,[e("form",{onSubmit:t[5]||(t[5]=S((...r)=>n.addImageMenu&&n.addImageMenu(...r),["prevent"]))},[e("h6",null,"Графическое Меню к боту #"+h(a.bot.id||"Не установлен"),1),e("div",Id,[e("div",Td,[e("div",qd,[Ld,u(e("input",{type:"text",class:"form-control",placeholder:"Название меню","aria-label":"Название меню",maxlength:"255","onUpdate:modelValue":t[0]||(t[0]=r=>a.menuForm.title=r),"aria-describedby":"menu-address",required:""},null,512),[[p,a.menuForm.title]])])])]),e("div",Dd,[e("div",Rd,[e("div",Gd,[e("label",Md,[m(" Описание меню "),zd,a.menuForm.description?(l(),i("small",Kd," Длина текста "+h(a.menuForm.description.length),1)):c("",!0)]),u(e("textarea",{type:"text",class:"form-control",placeholder:"Описание меню","aria-label":"Описание меню",maxlength:"255","onUpdate:modelValue":t[1]||(t[1]=r=>a.menuForm.description=r),"aria-describedby":"menu-description"},`
                    `,512),[[p,a.menuForm.description]])])])]),e("div",Ed,[e("div",Nd,[e("div",Ad,[Jd,m(" с вашим меню "),u(e("input",{type:"text",class:"form-control",placeholder:"Информационная ссылка","aria-label":"Информационная ссылка",maxlength:"255","onUpdate:modelValue":t[2]||(t[2]=r=>a.menuForm.info_link=r),"aria-describedby":"menu-info-link"},null,512),[[p,a.menuForm.info_link]])])])]),e("div",Wd,[e("div",Yd,[Hd,e("div",Qd,[e("label",Xd,[Zd,e("input",{type:"file",id:"menu-photos",accept:"image/*",onChange:t[3]||(t[3]=(...r)=>n.onChangePhotos&&n.onChangePhotos(...r)),style:{display:"none"}},null,32)]),a.menuForm.image?(l(),i("div",xd,[u(e("img",null,null,512),[[_,n.getPhoto(a.menuForm.image).imageUrl]]),e("div",er,[e("a",{onClick:t[4]||(t[4]=r=>n.removePhoto())},"Удалить")])])):c("",!0)])])]),tr],32)]),e("div",sr,[e("div",or,[a.menus.length>0?(l(!0),i(b,{key:0},f(a.menus,(r,g)=>(l(),i("div",lr,[e("div",ir,[e("div",nr,[e("h6",null,[m("Название "),e("strong",null,h(r.title||"Не указано"),1)]),e("a",{class:"cursor-pointer",onClick:F=>n.removeItem(g)},"Удалить",8,ar)]),e("div",dr,[e("p",null,h(r.description||"Не указано"),1),e("p",null," ссылка на меню из telegra.ph "+h(r.info_link||"Не указано"),1),e("div",rr,[r.image?(l(),i("div",cr,[typeof r.image=="string"?u((l(),i("img",ur,null,512)),[[_,"/images-by-bot-id/"+a.bot.id+"/"+r.image]]):u((l(),i("img",mr,null,512)),[[_,n.getPhoto(r.image).imageUrl]])])):c("",!0)])])])]))),256)):(l(),i("div",hr,pr))])])]),e("div",br,[e("div",gr,[e("button",{onClick:t[6]||(t[6]=(...r)=>n.submitMenus&&n.submitMenus(...r)),disabled:a.menus.length===0,class:"btn btn-outline-primary p-3 w-100"},"Сохранить меню для заведения ",8,fr)])])])])):c("",!0)}const Gy=U(Vd,[["render",yr]]),vr={class:"row"},kr={class:"input-group mb-3"},$r=D('<div class="row"><div class="col-md-12 col-12"><button type="button" title="Создать новую группу" data-bs-toggle="modal" data-bs-target="#group-create-modal" class="btn btn-outline-success p-3 mb-2 mr-2"><i class="fa-solid fa-layer-group"></i></button><button type="button" data-bs-toggle="modal" data-bs-target="#dialog-create-modal" class="btn btn-outline-success p-3 mb-2"><i class="fa-regular fa-comment-dots" style="margin-right:10px;"></i>Создать новый диалоговый скрипт </button></div></div>',1),Fr={key:0,class:"row"},wr={class:"col-12 mb-3"},Cr={class:"card mb-2"},Sr={class:"card-header"},Pr=["onClick"],Vr=e("i",{class:"fa-solid fa-trash-can"},null,-1),Ur=[Vr],jr={class:"card-body"},Br={key:0,class:"row"},Or={class:"col-md-12 col-lg-4 col-12 col-sm-12 mb-2"},Ir={key:1,class:"row"},Tr=e("div",{class:"col-12"},[e("p",null,"Диалоговых скриптов не найдено")],-1),qr=[Tr],Lr={class:"col-12"},Dr={key:1,class:"row"},Rr=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет созданных диалоговых групп ")],-1),Gr=[Rr],Mr={class:"modal fade",id:"link-modal",tabindex:"-1"},zr={class:"modal-dialog modal-fullscreen"},Kr={class:"modal-content"},Er=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"}," Диалог связывания "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Nr={key:0,class:"modal-body"},Ar=e("h6",null,"Связать её с:",-1),Jr={class:"row"},Wr={class:"col-md-2 mb-1"},Yr=["onClick"],Hr=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),Qr={class:"modal fade",id:"group-modal",tabindex:"-1"},Xr={class:"modal-dialog modal-fullscreen"},Zr={class:"modal-content"},xr=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"}," Диалог перемещения между группами "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ec={key:0,class:"modal-body"},tc=e("h6",null,"Переместить её в группу",-1),sc={key:0,class:"row"},oc={class:"col-md-6 mb-1"},lc=["onClick"],ic={key:1,class:"row"},nc=e("div",{class:"col-12"},[e("h6",null,"Перемещаем-с...")],-1),ac=[nc],dc=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),rc={class:"modal fade",id:"group-create-modal",tabindex:"-1"},cc={class:"modal-dialog modal-fullscreen"},uc={class:"modal-content"},mc=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"}," Диалог создания группы "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),hc={class:"modal-body"},_c=e("div",{class:"alert alert-warning",role:"alert"}," Группировка имеет исключительно логическое значение! Группа помогает Вам ориентироваться в цепочках диалогов ",-1),pc={class:"form-floating mb-3"},bc=e("label",{for:"floatingInput"},"Мнемоническое имя (англ)",-1),gc={class:"form-floating mb-3"},fc=e("label",{for:"floatingInput"},"Название группы",-1),yc=e("button",{type:"submit",class:"btn btn-outline-primary w-100 p-3"},"Создать",-1),vc=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),kc={class:"modal fade",id:"dialog-create-modal",tabindex:"-1"},$c={class:"modal-dialog modal-fullscreen"},Fc={class:"modal-content"},wc=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"}," Создание диалогового сообщения "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Cc={class:"modal-body"},Sc=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),Pc={data(){return{bot:null,groupForm:{slug:null,title:null,bot_id:null},loading:!0,dialog_groups:[],search:null,dialog_groups_paginate_object:null,link:null,group:null}},computed:{...C(["getDialogGroups","getCurrentBot","getDialogGroupsPaginateObject"]),filteredCommands(){return this.link?this.dialog_groups.find(t=>t.id===this.link.group_id).bot_dialog_commands.filter(t=>t.id!=this.link.id):[]}},mounted(){this.loadCurrentBot().then(()=>{this.loadGroups()})},methods:{loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},removeGroup(s){this.loading=!0,this.$store.dispatch("removeDialogGroup",{dataObject:{dialogGroupId:s}}).then(t=>{this.loading=!1,this.$notify("Диалоговая группа успешно удалена"),this.loadGroups()}).catch(t=>{this.loading=!1})},addGroup(){this.loading=!0,this.groupForm.bot_id=this.bot.id;let s=new FormData;Object.keys(this.groupForm).forEach(t=>{const o=this.groupForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.$store.dispatch("createDialogGroup",{dialogGroupForm:s}).then(t=>{this.loading=!1,this.$notify("Диалоговая группа успешно создана"),this.groupForm={slug:null,title:null},this.loadGroups()}).catch(t=>{this.loading=!1})},doSwapGroup(s){this.loading=!0,this.$store.dispatch("swapDialogGroup",{swapForm:{dialogCommandId:this.group.command_id,dialogGroupId:s}}).then(t=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Диалоговая команда успешно перемещена в другую группу!",type:"success"}),this.loadGroups(),this.group.group_id=s}).catch(t=>{this.loading=!1})},doCommandLink(s){this.loading=!0,this.$store.dispatch("swapDialogCommand",{swapForm:{dialogCommandFromId:s,dialogCommandToId:this.link.id}}).then(t=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Диалоговая команда успешно слинкована!",type:"success"}),this.loadGroups(),this.link.current_next_id=s}).catch(t=>{this.loading=!1})},swapGroupInit(s){this.group=s,new bootstrap.Modal("#group-modal",{}).show()},tryLink(s){this.link=s,new bootstrap.Modal("#link-modal",{}).show()},selectDialog(s){this.$emit("select-dialog",s),this.$notify("Вы выбрали диалог из списка!")},selectGroup(s){this.$emit("select-group",s),this.$notify("Вы выбрали группу из списка!")},nextGroups(s){this.loadGroups(s)},loadGroups(s=0){this.loading=!0,this.$store.dispatch("loadDialogGroups",{dataObject:{botId:this.bot.id||null,search:this.search},page:s}).then(t=>{this.loading=!1,this.dialog_groups=this.getDialogGroups,this.dialog_groups_paginate_object=this.getDialogGroupsPaginateObject}).catch(()=>{this.loading=!1})}}},Vc=Object.assign(Pc,{__name:"BotDialogGroupList",setup(s){return(t,o)=>(l(),i(b,null,[e("div",vr,[e("div",kr,[u(e("input",{type:"search",class:"form-control",placeholder:"Поиск группы","aria-label":"Поиск группы","onUpdate:modelValue":o[0]||(o[0]=d=>t.search=d),"aria-describedby":"button-addon2"},null,512),[[p,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=(...d)=>t.loadGroups&&t.loadGroups(...d)),type:"button",id:"button-addon2"},"Найти ")])]),$r,t.dialog_groups.length>0?(l(),i("div",Fr,[e("div",wr,[(l(!0),i(b,null,f(t.dialog_groups,(d,a)=>(l(),i("div",Cr,[e("div",Sr,[e("h6",null,[m(" #"+h(d.id)+" - "+h(d.title||"Не указано ")+" ",1),e("button",{onClick:n=>t.removeGroup(d.id),type:"button",class:"btn btn-outline-danger"},Ur,8,Pr)])]),e("div",jr,[d.bot_dialog_commands.length>0?(l(),i("div",Br,[(l(!0),i(b,null,f(d.bot_dialog_commands,(n,_)=>(l(),i("div",Or,[t.bot?(l(),$(M,{key:0,bot:t.bot,onCallback:t.loadGroups,onSelect:t.selectDialog,onSwap:t.swapGroupInit,onLink:t.tryLink,item:n},null,8,["bot","onCallback","onSelect","onSwap","onLink","item"])):c("",!0)]))),256))])):(l(),i("div",Ir,qr))])]))),256))]),e("div",Lr,[t.dialog_groups_paginate_object?(l(),$(P,{key:0,onPagination_page:t.nextGroups,pagination:t.dialog_groups_paginate_object},null,8,["onPagination_page","pagination"])):c("",!0)])])):(l(),i("div",Dr,Gr)),e("div",Mr,[e("div",zr,[e("div",Kr,[Er,t.link?(l(),i("div",Nr,[e("p",null,"Вы выбрали диалоговую команду #"+h(t.link.id),1),Ar,e("div",Jr,[(l(!0),i(b,null,f(t.filteredCommands,(d,a)=>(l(),i("div",Wr,[e("button",{type:"button",onClick:n=>t.doCommandLink(d.id),class:w([{"btn-primary text-white":t.link.current_next_id==d.id},"btn btn-outline-primary w-100"])},"#"+h(d.id)+" "+h(d.pre_text||"Без текста"),11,Yr)]))),256))])])):c("",!0),Hr])])]),e("div",Qr,[e("div",Xr,[e("div",Zr,[xr,t.group?(l(),i("div",ec,[e("p",null,"Вы выбрали диалоговую команду #"+h(t.group.command_id),1),tc,t.loading?(l(),i("div",ic,ac)):(l(),i("div",sc,[(l(!0),i(b,null,f(t.dialog_groups,(d,a)=>(l(),i("div",oc,[e("button",{type:"button",onClick:n=>t.doSwapGroup(d.id),class:w([{"btn-primary text-white":d.id==t.group.group_id},"btn btn-outline-primary w-100"])},"#"+h(d.id)+" "+h(d.title||"Без названия"),11,lc)]))),256))]))])):c("",!0),dc])])]),e("div",rc,[e("div",cc,[e("div",uc,[mc,e("div",hc,[_c,e("form",{onSubmit:o[4]||(o[4]=S((...d)=>t.addGroup&&t.addGroup(...d),["prevent"]))},[e("div",pc,[u(e("input",{type:"text",class:"form-control",id:"floatingInput",maxlength:"255",pattern:"[a-zA-Z0-9_]+","onUpdate:modelValue":o[2]||(o[2]=d=>t.groupForm.slug=d),required:""},null,512),[[p,t.groupForm.slug]]),bc]),e("div",gc,[u(e("input",{type:"text",class:"form-control",id:"floatingInput",maxlength:"255","onUpdate:modelValue":o[3]||(o[3]=d=>t.groupForm.title=d),required:""},null,512),[[p,t.groupForm.title]]),fc]),yc],32)]),vc])])]),e("div",kc,[e("div",$c,[e("div",Fc,[wc,e("div",Cc,[t.bot?(l(),$(G,{key:0,onCallback:t.loadGroups,bot:t.bot},null,8,["onCallback","bot"])):c("",!0)]),Sc])])])],64))}}),Uc={props:["bot","item"],data(){return{sectionForm:{section:null},categoryForm:{label:null},tab:0,types:[{title:"Готовый продукт",value:1},{title:"Товар на вес",value:2},{title:"Конструктор товара",value:3}],productCategories:[],sections:["Общие характеристики","Дополнительная информация"],photos:[],categories:[],removed_options:[],productForm:{article:null,vk_product_id:null,title:null,description:null,images:[],type:1,old_price:null,current_price:null,variants:[],in_stop_list_at:null,bot_id:null,options:[],reviews:[],categories:[]}}},computed:{...C(["getProductCategories"]),filteredCategories(){return this.productCategories.length===0?this.categories:this.categories.filter(s=>this.productCategories.indexOf(s.value)===-1)}},mounted(){this.loadProductCategories(),this.item&&this.$nextTick(()=>{this.productForm={id:this.item.id||null,article:this.item.article||null,vk_product_id:this.item.vk_product_id||null,title:this.item.title||null,description:this.item.description||null,images:this.item.images||null,type:this.item.type||1,old_price:this.item.old_price||null,current_price:this.item.current_price||null,variants:this.item.variants||null,in_stop_list_at:this.item.in_stop_list_at||null,bot_id:this.item.bot_id||null,options:this.item.options||null,reviews:this.item.reviews||null},this.options=[],this.item.categories.forEach(s=>{this.productCategories.push(s.id)})})},methods:{prepareCategoryName(s){let t=this.categories.find(o=>o.value===s);return console.log(t),t?t.label:s},addCategory(){const s=this.categoryForm.label;this.productCategories.push(s),this.categoryForm.label=null},selectCategory(s){this.productCategories.push(s.value)},submit(){let s=new FormData;if(Object.keys(this.productForm).forEach(t=>{const o=this.productForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.bot&&s.append("bot_id",this.bot.id),this.photos.length>0)for(let t=0;t<this.photos.length;t++)s.append("photos[]",this.photos[t]);this.removed_options.length>0&&s.append("removed_options",JSON.stringify(this.removed_options)),this.productCategories.length>0&&s.append("categories",JSON.stringify(this.productCategories)),this.$store.dispatch("saveProduct",{productForm:s}).then(t=>{this.load=!0,this.$notify({title:"Конструктор ботов",text:"Продукт успешно сохранен!",type:"success"}),this.clearForm(),this.$emit("refresh")}).catch(t=>{})},onChangePhotos(s){const t=s.target.files;for(let o=0;o<t.length;o++)this.photos.push(t[o])},loadProductCategories(){this.$store.dispatch("loadProductCategories",{dataObject:{bot_id:this.bot.id}}).then(()=>{this.getProductCategories.forEach(t=>{this.categories.push({value:t.id,label:t.title})})})},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removeSection(s){this.sections.splice(s,1)},addSection(){this.sections.push(this.sectionForm.section),this.sectionForm.section=null},addOption(){this.productForm.options||(this.productForm.options=[]),this.productForm.options.push({id:null,key:null,value:null,title:null,section:null})},addVariant(){this.productForm.variants||(this.productForm.variants=[]),this.productForm.variants.push({key:null,value:null})},removeProductCategory(s){this.productCategories.splice(s,1)},removeVariant(s){this.productForm.variants.splice(s,1)},removeOption(s){this.productForm.options[s].id&&this.removed_options.push(this.productForm.options[s].id),this.productForm.options.splice(s,1)},removeImage(s){this.productForm.images.splice(s,1)},removePhoto(s){this.photos.splice(s,1)},clearForm(){const s={article:null,vk_product_id:null,title:null,description:null,images:[],type:1,old_price:null,current_price:null,variants:[],in_stop_list_at:null,bot_id:null,options:[],reviews:[],categories:[]};this.photos=[],this.removed_options=[],this.productCategories=[],this.productForm=s}}},jc={class:"nav nav-tabs"},Bc={class:"nav-item"},Oc={class:"nav-item"},Ic={class:"nav-item"},Tc={key:0},qc={class:"col-md-8 d-flex align-items-center"},Lc={class:"form-check"},Dc=e("label",{class:"form-check-label",for:"in-stop-list"}," Товар находится в стоп-листе ",-1),Rc={class:"col-md-4 d-flex justify-content-end"},Gc={class:"col-md-12 mb-3"},Mc=["onClick"],zc={class:"dropdown"},Kc=e("button",{type:"button",class:"btn btn-outline-info w-100","data-bs-toggle":"dropdown","data-bs-display":"static","aria-expanded":"false"},[e("p",{class:"mb-0"},"Выберите категорию")],-1),Ec={class:"dropdown-menu w-100",style:{"overflow-y":"scroll",height:"300px"}},Nc={class:"p-3"},Ac=e("label",{for:"exampleDropdownFormEmail1",class:"form-label"},"Новая категория",-1),Jc={class:"p-3"},Wc=e("li",null,[e("hr",{class:"dropdown-divider"})],-1),Yc=["onClick"],Hc={class:"col-md-6"},Qc={class:"form-floating mb-3"},Xc=e("label",{for:"article"},"Артикул товара",-1),Zc={class:"col-md-6"},xc={class:"form-floating mb-3"},eu=e("label",{for:"vk-product-id"},"Идентификатор товара VK",-1),tu={class:"col-md-6"},su={class:"form-floating mb-3"},ou=e("label",{for:"title"},"Названи товара",-1),lu={class:"col-md-6"},iu={class:"form-floating mb-3"},nu=["value"],au=e("label",{for:"type"},"Тип товара",-1),du={class:"col-md-12"},ru={class:"form-floating mb-3"},cu=e("label",{for:"description"},"Описание товара",-1),uu={class:"col-md-6"},mu={class:"form-floating mb-3"},hu=e("label",{for:"current-price"},"Актуальная цена",-1),_u={class:"col-md-6"},pu={class:"form-floating mb-3"},bu=e("label",{for:"old-price"},"Старая цена",-1),gu={class:"col-md-12 mb-3"},fu={class:"card"},yu={class:"card-header"},vu={key:0},ku={class:"card-body"},$u={class:"row"},Fu={class:"col-12 mb-3"},wu={class:"col-md-6 mb-3"},Cu={class:"card w-100"},Su={class:"card-body"},Pu={class:"form-floating mb-3"},Vu=["onUpdate:modelValue","id"],Uu=["for"],ju={class:"form-floating mb-3"},Bu=["onUpdate:modelValue","id"],Ou=["for"],Iu={class:"card-footer"},Tu=["onClick"],qu=e("i",{class:"fa-solid fa-trash-can"},null,-1),Lu=[qu],Du={class:"col-md-12 mb-3"},Ru={class:"card"},Gu=e("div",{class:"card-header"},[e("h6",null,"Характеристики товара")],-1),Mu={class:"card-body"},zu={class:"row mb-3"},Ku={class:"col-12"},Eu=e("button",{class:"btn btn-outline-info",type:"submit",id:"button-addon2"},"Добавить секцию ",-1),Nu={class:"badge bg-info mr-1"},Au=["onClick"],Ju=e("i",{class:"fa-solid fa-xmark"},null,-1),Wu=[Ju],Yu={class:"row"},Hu={class:"col-md-4 mb-3"},Qu={class:"card w-100"},Xu={class:"card-body"},Zu={class:"form-floating mb-3"},xu=["onUpdate:modelValue","id"],em=["for"],tm={class:"form-floating mb-3"},sm=["onUpdate:modelValue","id"],om=["for"],lm={class:"form-floating mb-3"},im=["onUpdate:modelValue","id"],nm=e("option",{value:null},"Без секции",-1),am=["value"],dm=["for"],rm={class:"card-footer"},cm=["onClick"],um=e("i",{class:"fa-solid fa-trash-can"},null,-1),mm=[um],hm={class:"row"},_m={class:"col-12"},pm={class:"col-md-12 mb-3"},bm=e("h6",null,"Фотографии товара",-1),gm={class:"photo-preview d-flex justify-content-start flex-wrap w-100"},fm={for:"location-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},ym=e("span",null,"+",-1),vm={class:"mb-2 img-preview",style:{"margin-right":"10px"}},km={class:"remove"},$m=["onClick"],Fm={class:"mb-2 img-preview",style:{"margin-right":"10px"}},wm={class:"remove"},Cm=["onClick"],Sm=e("div",{class:"col-12"},[e("button",{type:"submit",class:"btn btn-outline-primary w-100 p-3"},"Сохранить ")],-1),Pm={key:1};function Vm(s,t,o,d,a,n){const _=j("lazy");return l(),i(b,null,[e("ul",jc,[e("li",Bc,[e("a",{class:w(["nav-link",{active:a.tab===0}]),onClick:t[0]||(t[0]=r=>a.tab=0),"aria-current":"page",href:"#product-form-info"},"Информация о товаре",2)]),e("li",Oc,[e("a",{class:w(["nav-link",{active:a.tab===1}]),onClick:t[1]||(t[1]=r=>a.tab=1),href:"#product-reviews"},"Комментарии",2)]),e("li",Ic,[e("a",{class:w(["nav-link",{active:a.tab===2}]),onClick:t[2]||(t[2]=r=>a.tab=2),href:"#product-reviews"},"Заказы",2)])]),a.tab===0?(l(),i("div",Tc,[e("form",{onSubmit:t[19]||(t[19]=S((...r)=>n.submit&&n.submit(...r),["prevent"])),class:"row"},[e("div",qc,[e("div",Lc,[u(e("input",{class:"form-check-input","onUpdate:modelValue":t[3]||(t[3]=r=>a.productForm.in_stop_list_at=r),type:"checkbox",value:"false",id:"in-stop-list"},null,512),[[k,a.productForm.in_stop_list_at]]),Dc])]),e("div",Rc,[e("a",{href:"#",class:"btn btn-link",onClick:t[4]||(t[4]=(...r)=>n.clearForm&&n.clearForm(...r))},"Новый товар")]),e("div",Gc,[(l(!0),i(b,null,f(a.productCategories,(r,g)=>(l(),i("span",{class:"badge bg-info mr-1 mb-1 cursor-pointer",onClick:F=>n.removeProductCategory(g)},h(n.prepareCategoryName(r)),9,Mc))),256)),e("div",zc,[Kc,e("ul",Ec,[e("div",Nc,[Ac,u(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[5]||(t[5]=r=>a.categoryForm.label=r),id:"exampleDropdownFormEmail1",placeholder:"Название категории"},null,512),[[p,a.categoryForm.label]])]),e("div",Jc,[e("button",{class:"btn btn-primary w-100",type:"button",onClick:t[6]||(t[6]=(...r)=>n.addCategory&&n.addCategory(...r))},"Добавить категорию ")]),Wc,(l(!0),i(b,null,f(n.filteredCategories,r=>(l(),i("li",null,[e("button",{class:"dropdown-item",type:"button",onClick:g=>n.selectCategory(r)},h(r.label),9,Yc)]))),256))])])]),e("div",Hc,[e("div",Qc,[u(e("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=r=>a.productForm.article=r),class:"form-control",id:"article",placeholder:"name@example.com"},null,512),[[p,a.productForm.article]]),Xc])]),e("div",Zc,[e("div",xc,[u(e("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=r=>a.productForm.vk_product_id=r),disabled:!0,class:"form-control",id:"vk-product-id",placeholder:"name@example.com"},null,512),[[p,a.productForm.vk_product_id]]),eu])]),e("div",tu,[e("div",su,[u(e("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=r=>a.productForm.title=r),class:"form-control",id:"title",placeholder:"name@example.com"},null,512),[[p,a.productForm.title]]),ou])]),e("div",lu,[e("div",iu,[u(e("select",{class:"form-select","onUpdate:modelValue":t[10]||(t[10]=r=>a.productForm.type=r),id:"type","aria-label":"Floating label select example"},[(l(!0),i(b,null,f(a.types,(r,g)=>(l(),i("option",{value:r.value},h(r.title),9,nu))),256))],512),[[V,a.productForm.type]]),au])]),e("div",du,[e("div",ru,[u(e("textarea",{class:"form-control","onUpdate:modelValue":t[11]||(t[11]=r=>a.productForm.description=r),placeholder:"Leave a comment here",id:"description"},null,512),[[p,a.productForm.description]]),cu])]),e("div",uu,[e("div",mu,[u(e("input",{type:"number","onUpdate:modelValue":t[12]||(t[12]=r=>a.productForm.current_price=r),class:"form-control",id:"current-price",placeholder:"name@example.com"},null,512),[[p,a.productForm.current_price]]),hu])]),e("div",_u,[e("div",pu,[u(e("input",{type:"number","onUpdate:modelValue":t[13]||(t[13]=r=>a.productForm.old_price=r),class:"form-control",id:"old-price",placeholder:"name@example.com"},null,512),[[p,a.productForm.old_price]]),bu])]),e("div",gu,[e("div",fu,[e("div",yu,[e("h6",null,[m("Варианты товара "),a.productForm.variants?(l(),i("span",vu,"("+h(a.productForm.variants.length)+")",1)):c("",!0)])]),e("div",ku,[e("div",$u,[e("div",Fu,[e("button",{type:"button",class:"btn btn-outline-info w-100",onClick:t[14]||(t[14]=(...r)=>n.addVariant&&n.addVariant(...r))},"Добавить вариант ")]),(l(!0),i(b,null,f(a.productForm.variants,(r,g)=>(l(),i("div",wu,[e("div",Cu,[e("div",Su,[e("div",Pu,[u(e("input",{type:"text","onUpdate:modelValue":F=>a.productForm.variants[g].key=F,class:"form-control",id:"variant-key-"+g,placeholder:"name@example.com",required:""},null,8,Vu),[[p,a.productForm.variants[g].key]]),e("label",{for:"variant-key-"+g},"Ключ",8,Uu)]),e("div",ju,[u(e("input",{type:"text","onUpdate:modelValue":F=>a.productForm.variants[g].value=F,class:"form-control",id:"variant-value-"+g,placeholder:"name@example.com",required:""},null,8,Bu),[[p,a.productForm.variants[g].value]]),e("label",{for:"variant-value-"+g},"Значение",8,Ou)])]),e("div",Iu,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:F=>n.removeVariant(g)},Lu,8,Tu)])])]))),256))])])])]),e("div",Du,[e("div",Ru,[Gu,e("div",Mu,[e("div",zu,[e("div",Ku,[e("form",{onSubmit:t[16]||(t[16]=S((...r)=>n.addSection&&n.addSection(...r),["prevent"])),class:"input-group mb-3"},[u(e("input",{type:"text","onUpdate:modelValue":t[15]||(t[15]=r=>a.sectionForm.section=r),class:"form-control border-info",placeholder:"Название секции","aria-label":"Recipient's username","aria-describedby":"button-addon2",required:""},null,512),[[p,a.sectionForm.section]]),Eu],32),(l(!0),i(b,null,f(a.sections,(r,g)=>(l(),i("span",Nu,[m(h(r)+" ",1),e("strong",{onClick:F=>n.removeSection(g)},Wu,8,Au)]))),256))])]),e("div",Yu,[(l(!0),i(b,null,f(a.productForm.options,(r,g)=>(l(),i("div",Hu,[e("div",Qu,[e("div",Xu,[e("div",Zu,[u(e("input",{type:"text","onUpdate:modelValue":F=>a.productForm.options[g].title=F,class:"form-control",id:"option-title-"+g,placeholder:"name@example.com"},null,8,xu),[[p,a.productForm.options[g].title]]),e("label",{for:"option-title-"+g},"Название характеристики",8,em)]),e("div",tm,[u(e("input",{type:"text","onUpdate:modelValue":F=>a.productForm.options[g].value=F,class:"form-control",id:"option-value-"+g,placeholder:"name@example.com"},null,8,sm),[[p,a.productForm.options[g].value]]),e("label",{for:"option-value-"+g},"Значение характеристики",8,om)]),e("div",lm,[u(e("select",{class:"form-select","onUpdate:modelValue":F=>a.productForm.options[g].section=F,id:"option-section-"+g,"aria-label":"Floating label select example"},[nm,(l(!0),i(b,null,f(a.sections,F=>(l(),i("option",{value:F},h(F),9,am))),256))],8,im),[[V,a.productForm.options[g].section]]),e("label",{for:"option-section-"+g},"Секция товара",8,dm)])]),e("div",rm,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:F=>n.removeOption(g)},mm,8,cm)])])]))),256))]),e("div",hm,[e("div",_m,[e("button",{type:"button",class:"btn btn-outline-info w-100",onClick:t[17]||(t[17]=(...r)=>n.addOption&&n.addOption(...r))},"Добавить характеристику ")])])])])]),e("div",pm,[bm,e("div",gm,[e("label",fm,[ym,e("input",{type:"file",id:"location-photos",multiple:"",accept:"image/*",onChange:t[18]||(t[18]=(...r)=>n.onChangePhotos&&n.onChangePhotos(...r)),style:{display:"none"}},null,32)]),a.productForm.images?(l(!0),i(b,{key:0},f(a.productForm.images,(r,g)=>(l(),i("div",vm,[u(e("img",null,null,512),[[_,r]]),e("div",km,[e("a",{onClick:F=>n.removeImage(g)},"Удалить",8,$m)])]))),256)):c("",!0),a.photos.length>0?(l(!0),i(b,{key:1},f(a.photos,(r,g)=>(l(),i("div",Fm,[u(e("img",null,null,512),[[_,n.getPhoto(r).imageUrl]]),e("div",wm,[e("a",{onClick:F=>n.removePhoto(g)},"Удалить",8,Cm)])]))),256)):c("",!0)])]),Sm],32)])):c("",!0),a.tab===1?(l(),i("div",Pm," Отзывы ")):c("",!0)],64)}const Um=U(Uc,[["render",Vm]]),jm={props:["item"],data(){return{bot:null}},methods:{preparedImgUrl(s){return s.toLocaleLowerCase().startsWith("https://")||s.toLocaleLowerCase().startsWith("http://")?s:"/images-by-bot-id/"+this.bot.id+"/"+s},removeProduct(){this.$store.dispatch("removeProduct",this.item.id).then(s=>{this.$notify({title:"Конструктор ботов",text:"Продукт успешно удален!",type:"success"})}).catch(s=>{})},duplicateProduct(){this.$store.dispatch("duplicateProduct",this.item.id).then(s=>{this.$notify({title:"Конструктор ботов",text:"Продукт успешно продублирован!",type:"success"})}).catch(s=>{})}},mounted(){this.bot=this.getCurrentBot},computed:{...C(["getCurrentBot"])}},Bm={key:0,class:"card"},Om={class:"card-header"},Im={class:"card-body"},Tm=["id"],qm={class:"carousel-inner"},Lm=["src"],Dm=["data-bs-target"],Rm=e("span",{class:"carousel-control-prev-icon","aria-hidden":"true"},null,-1),Gm=e("span",{class:"visually-hidden"},"Previous",-1),Mm=[Rm,Gm],zm=["data-bs-target"],Km=e("span",{class:"carousel-control-next-icon","aria-hidden":"true"},null,-1),Em=e("span",{class:"visually-hidden"},"Next",-1),Nm=[Km,Em],Am={class:"card-footer d-flex justify-content-between"},Jm=e("i",{class:"fa-regular fa-copy"},null,-1),Wm=[Jm],Ym=e("i",{class:"fa-solid fa-trash-can"},null,-1),Hm=[Ym];function Qm(s,t,o,d,a,n){return a.bot?(l(),i("div",Bm,[e("div",Om,[e("p",null,"#"+h(o.item.id),1)]),e("div",Im,[e("p",null,h(o.item.title),1),e("div",{id:"image-slider-"+o.item.id,class:"carousel slide","data-bs-ride":"carousel"},[e("div",qm,[(l(!0),i(b,null,f(o.item.images,(_,r)=>(l(),i("div",{class:w(["carousel-item",{active:r===0}]),style:{height:"300px"}},[e("img",{src:n.preparedImgUrl(_),class:"d-block w-100 object-fit-cover",alt:"..."},null,8,Lm)],2))),256))]),e("button",{class:"carousel-control-prev",type:"button","data-bs-target":"#image-slider-"+o.item.id,"data-bs-slide":"prev"},Mm,8,Dm),e("button",{class:"carousel-control-next",type:"button","data-bs-target":"#image-slider-"+o.item.id,"data-bs-slide":"next"},Nm,8,zm)],8,Tm)]),e("div",Am,[e("button",{title:"Дублировать товар",onClick:t[0]||(t[0]=(..._)=>n.duplicateProduct&&n.duplicateProduct(..._)),class:"btn btn-outline-info mr-1"},Wm),e("button",{title:"Удалить товар",onClick:t[1]||(t[1]=(..._)=>n.removeProduct&&n.removeProduct(..._)),class:"btn btn-outline-danger"},Hm)])])):c("",!0)}const Xm=U(jm,[["render",Qm]]),Zm=e("button",{class:"btn btn-outline-info",type:"submit",id:"button-addon2"}," Найти ",-1),xm={key:0},eh={class:"row"},th={class:"col-4 mb-2"},sh={props:["bot"],data(){return{search:null,products:[],paginate:null}},computed:{...C(["getProducts","getProductsPaginateObject"]),filteredProducts(){return this.search?this.products.filter(s=>s.title.toLowerCase().trim().indexOf(this.search.toLowerCase().trim())>=0):this.products}},mounted(){this.loadProducts()},methods:{selectProduct(s){this.$emit("select",s)},nextProducts(s){this.loadProducts(s)},loadProducts(s=0){return this.$store.dispatch("loadProducts",{dataObject:{bot_id:this.bot.id,search:this.search},page:s}).then(()=>{this.products=this.getProducts,this.paginate=this.getProductsPaginateObject})}}},oh=Object.assign(sh,{__name:"ProductList",setup(s){return(t,o)=>(l(),i(b,null,[e("form",{class:"input-group mb-3",onSubmit:o[1]||(o[1]=S(d=>t.loadProducts(0),["prevent"]))},[u(e("input",{type:"text",class:"form-control border-info",placeholder:"Поиск товара","aria-label":"Поиск товара","onUpdate:modelValue":o[0]||(o[0]=d=>t.search=d),"aria-describedby":"button-addon2",required:""},null,512),[[p,t.search]]),Zm],32),e("p",null,[m("Всего товаров: "),t.paginate?(l(),i("span",xm,h(t.paginate.meta.total||0),1)):c("",!0)]),e("div",eh,[(l(!0),i(b,null,f(t.filteredProducts,(d,a)=>(l(),i("div",th,[v(Xm,{onClick:n=>t.selectProduct(d),item:d},null,8,["onClick","item"])]))),256))]),t.paginate?(l(),$(P,{key:0,onPagination_page:t.nextProducts,pagination:t.paginate},null,8,["onPagination_page","pagination"])):c("",!0)],64))}}),lh={class:"card mb-2"},ih=e("div",{class:"card-header"},[e("h6",null,"Управление магазином")],-1),nh={class:"card-body"},ah={class:"row"},dh={class:"col-12"},rh={class:"form-label d-flex justify-content-between mt-2",id:"bot-level-3"},ch=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),uh=e("div",null,"Ссылка на страницу ВК с товарами для вашего магазина в боте ",-1),mh=e("a",{href:"https://vk.com/groups?w=groups_create",target:"_blank"},"Создать",-1),hh=["disabled"],_h=e("i",{class:"fa-regular fa-floppy-disk mr-2"},null,-1),ph={class:"row mb-3"},bh={class:"col-md-3"},gh=["href"],fh=D('<div class="col-md-3"><button class="btn btn-outline-info w-100">Экспорт в XLS</button></div><div class="col-md-3"><button class="btn btn-outline-info w-100">Импорт из XLS</button></div><div class="col-md-3"><button class="btn btn-outline-danger w-100">Удалить товары</button></div>',3),yh=e("div",{class:"row"},[e("div",{class:"col-md-3"},[e("button",{class:"btn btn-outline-info w-100"},"Экспортировать заказы")])],-1),vh={class:"card"},kh=e("div",{class:"card-header"},[e("h6",null,"Работа с товаром")],-1),$h={class:"card-body"},Fh={class:"card mt-2"},wh={class:"card-body"},Ch={data(){return{load:!1,tab:0,url:null,link:null,bot:null,selectedProduct:null,botForm:{vk_shop_link:null}}},computed:{...C(["getCurrentBot"])},mounted(){this.bot=this.getCurrentBot,this.botForm.vk_shop_link=this.bot.vk_shop_link||null,this.updateProducts()},methods:{updateShopLink(){this.load=!0,this.botForm.bot_id=this.bot.id,this.$store.dispatch("updateShopLink",{botForm:this.botForm}).then(s=>{this.load=!1,this.updateProducts(),this.$notify({title:"Менеджер магазина",text:"Ссылка на источник в ВК обновлена"})}).catch(()=>{this.load=!1})},refresh(){this.load=!0,this.selectedProduct=null,this.$nextTick(()=>{this.load=!1})},selectProduct(s){this.load=!0,this.$nextTick(()=>{this.selectedProduct=s,this.load=!1})},updateProducts(){this.load=!0,this.$store.dispatch("updateProductsFromVk",{dataObject:{botDomain:this.getCurrentBot.bot_domain}}).then(s=>{this.link=s.data.url,this.load=!1,this.url=null}).catch(()=>{this.load=!1})}}},Sh=Object.assign(Ch,{__name:"Shop",setup(s){return(t,o)=>{const d=B("Popper");return l(),i(b,null,[e("div",lh,[ih,e("div",nh,[e("div",ah,[e("div",dh,[e("form",{onSubmit:o[1]||(o[1]=S((...a)=>t.updateShopLink&&t.updateShopLink(...a),["prevent"])),class:"mb-2"},[e("label",rh,[e("div",null,[v(d,null,{content:y(()=>[uh]),default:y(()=>[ch]),_:1}),m(" ВК-группа ")]),mh]),u(e("input",{type:"url",class:"form-control",placeholder:"Ссылка на группу ВК","aria-label":"ссылка на группу ВК","onUpdate:modelValue":o[0]||(o[0]=a=>t.botForm.vk_shop_link=a),"aria-describedby":"vk_shop_link"},null,512),[[p,t.botForm.vk_shop_link]]),e("button",{disabled:t.load,class:"btn btn-outline-primary mt-2 mb-2 w-100"},[_h,m(" Сохранить ")],8,hh)],32)])]),e("div",ph,[e("div",bh,[e("a",{target:"_blank",href:t.link,class:"btn btn-primary w-100"}," Обновить товар ",8,gh)]),fh]),yh])]),e("div",vh,[kh,e("div",$h,[t.bot&&!t.load?(l(),$(Um,{key:0,bot:t.bot,item:t.selectedProduct,onRefresh:t.refresh},null,8,["bot","item","onRefresh"])):c("",!0)])]),e("div",Fh,[e("div",wh,[t.bot&&!t.load?(l(),$(oh,{key:0,bot:t.bot,onSelect:t.selectProduct},null,8,["bot","onSelect"])):c("",!0)])])],64)}}}),Ph={props:["data"],data(){return{hasConnect:!1,bot:null,amoForm:{client_id:null,client_secret:null,auth_code:null,redirect_uri:null,subdomain:null,bot_id:null}}},computed:{...C(["getCurrentBot"])},mounted(){this.bot=this.getCurrentBot,this.data?this.$nextTick(()=>{this.amoForm.client_id=this.data.client_id||null,this.amoForm.client_secret=this.data.client_secret||null,this.amoForm.auth_code=this.data.auth_code||null,this.amoForm.redirect_uri=this.data.redirect_uri||null,this.amoForm.subdomain=this.data.subdomain||null,this.amoForm.bot_id=this.data.bot_id||this.bot.id||null}):this.amoForm.bot_id=this.bot.id||null},methods:{submitAmo(){let s=new FormData;Object.keys(this.amoForm).forEach(t=>{const o=this.amoForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.$store.dispatch("saveAmoCRM",{amoForm:s}).then(t=>{this.$notify("Данные CRM успешно сохранены")}).catch(t=>{})}}},Vh=e("div",{class:"col-12"},[e("p",null,[e("a",{target:"_blank",href:"https://www.amocrm.ru/developers/content/oauth/step-by-step"},"Документация для разработчика "),m(" по шагам")])],-1),Uh={class:"col-md-6 col-12 mb-2"},jh={class:"form-label",id:"client_id"},Bh=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Oh=e("div",null,"ID интеграции",-1),Ih=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Th={class:"col-md-6 col-12 mb-2"},qh={class:"form-label",id:"client_secret"},Lh=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Dh=e("div",null,"Секрет интеграции",-1),Rh=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Gh={class:"col-md-6 mb-2"},Mh={class:"form-label",id:"auth_code"},zh=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Kh=e("div",null,"Полученный код авторизации",-1),Eh=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Nh={class:"col-md-6 col-12 mb-2"},Ah={class:"form-label",id:"subdomain2"},Jh=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Wh=e("div",null,"Ваш поддомен в системе AMO CRM",-1),Yh=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Hh=e("div",{class:"col-md-12 col-12"},[e("button",{type:"submit",class:"btn btn-outline-primary p-3 w-100"},[e("i",{class:"fa-solid fa-cloud-arrow-down mr-1"}),m(" Сохранить настройку AMO ")])],-1);function Qh(s,t,o,d,a,n){const _=B("Popper");return l(),i("form",{onSubmit:t[4]||(t[4]=S((...r)=>n.submitAmo&&n.submitAmo(...r),["prevent"])),class:"row"},[Vh,e("div",Uh,[e("label",jh,[v(_,null,{content:y(()=>[Oh]),default:y(()=>[Bh]),_:1}),m(" client_id "),Ih]),u(e("input",{type:"text",class:"form-control",placeholder:"client_id","aria-label":"client_id","onUpdate:modelValue":t[0]||(t[0]=r=>a.amoForm.client_id=r),"aria-describedby":"client_id"},null,512),[[p,a.amoForm.client_id]])]),e("div",Th,[e("label",qh,[v(_,null,{content:y(()=>[Dh]),default:y(()=>[Lh]),_:1}),m(" client_secret "),Rh]),u(e("input",{type:"text",class:"form-control",placeholder:"client_secret","aria-label":"client_secret","onUpdate:modelValue":t[1]||(t[1]=r=>a.amoForm.client_secret=r),"aria-describedby":"client_secret"},null,512),[[p,a.amoForm.client_secret]])]),e("div",Gh,[e("label",Mh,[v(_,null,{content:y(()=>[Kh]),default:y(()=>[zh]),_:1}),m(" auth_code "),Eh]),u(e("textarea",{class:"form-control",placeholder:"auth_code","aria-label":"auth_code","onUpdate:modelValue":t[2]||(t[2]=r=>a.amoForm.auth_code=r),"aria-describedby":"auth_code"},`
                                    `,512),[[p,a.amoForm.auth_code]])]),e("div",Nh,[e("label",Ah,[v(_,null,{content:y(()=>[Wh]),default:y(()=>[Jh]),_:1}),m(" subdomain "),Yh]),u(e("input",{type:"text",class:"form-control",placeholder:"subdomain","aria-label":"subdomain","onUpdate:modelValue":t[3]||(t[3]=r=>a.amoForm.subdomain=r),"aria-describedby":"subdomain"},null,512),[[p,a.amoForm.subdomain]])]),Hh],32)}const Xh=U(Ph,[["render",Qh]]),Zh={data(){return{load:!1,bot:null,fieldTypes:[{title:"Текст",value:0},{title:"Число",value:1},{title:"Логический",value:2},{title:"Дата и время",value:3}],fieldForm:{fields:[]}}},computed:{...C(["getCurrentBot"])},mounted(){this.loadCurrentBot().then(()=>{this.bot=this.getCurrentBot,this.$nextTick(()=>{this.fieldForm.fields=this.bot.field_settings||[]}),this.loadCurrentBotFields()})},methods:{loadCurrentBotFields(){return this.$store.dispatch("loadCurrentBotFields",{bot_id:this.bot.id}).then(s=>{this.fieldForm.fields=s.data||[]})},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},removeField(s){this.fieldForm.fields.splice(s,1)},submit(){let s=new FormData;Object.keys(this.fieldForm).forEach(t=>{const o=this.fieldForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),s.append("bot_id",this.bot.id),this.$store.dispatch("storeBotFields",{dataObject:s}).then(t=>{this.$notify({title:"Конструктор ботов",text:"Поля успешно обновлены",type:"success"}),this.fieldForm.fields=[],this.fieldForm.fields=t.data}).catch(t=>{this.$notify({title:"Конструктор ботов",text:"Ошибка обновления полей",type:"error"})})},addField(){if(this.fieldForm.fields||(this.fieldForm.fields=[]),this.fieldForm.fields.length>0&&this.fieldForm.fields.findIndex(t=>t.key==null)!==-1){this.$notify({title:"Настраиваемые поля",text:"У вас есть пустые ключевые поля!",type:"error"});return}this.fieldForm.fields.push({key:null,type:0,label:null,description:null,required:!1,validate_pattern:null})}}},xh={class:"mb-2"},e_={class:"d-flex justify-content-between"},t_=e("h6",null,"Настройка полей пользователя бота",-1),s_=e("i",{class:"fa-solid fa-plus mr-2"},null,-1),o_=e("p",null,[e("em",null,"Данные поля будут добавлены пользователю бота и будут автоматически учитываться в условиях страниц, скриптах (в формах заполнения данных), диалогах. Ключи должны быть уникальные для каждого бота. Если ключ дублируется, то будет использовано более позднее его значение. Если поле добавлено и сохранено, то удалить его уже нельзя, только скрыть. "),m(". "),e("br"),e("span",{class:"text-danger"},"*"),m(" - обязательное поле ")],-1),l_={class:"table"},i_=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},[m("Ключ"),e("span",{class:"text-danger"},"*")]),e("th",{scope:"col"},[m("Подпись поля"),e("span",{class:"text-danger"},"*")]),e("th",{scope:"col"},[m("Тип поля"),e("span",{class:"text-danger"},"*")]),e("th",{scope:"col"},"Паттерн"),e("th",{scope:"col"},"Обязательный"),e("th",{scope:"col"},[m("Вопрос для анкеты"),e("span",{class:"text-danger"},"*")]),e("th",{scope:"col"})])],-1),n_={scope:"row"},a_={scope:"col"},d_=["onUpdate:modelValue"],r_={scope:"col"},c_=["onUpdate:modelValue"],u_={scope:"col"},m_=["onUpdate:modelValue"],h_=["value"],__={scope:"col"},p_=["disabled","onUpdate:modelValue"],b_={scope:"col"},g_={class:"form-check"},f_=["onUpdate:modelValue","id"],y_=["for"],v_={key:0},k_={key:1},$_={scope:"col"},F_=["onUpdate:modelValue"],w_={scope:"col"},C_=["onClick"],S_=e("i",{class:"fa-regular fa-trash-can"},null,-1),P_=[S_],V_={key:1,class:"form-check mt-2"},U_=["onUpdate:modelValue","id"],j_=["for"],B_={key:0},O_=e("i",{class:"fa-solid fa-eye text-success"},null,-1),I_=[O_],T_={key:1},q_=e("i",{class:"fa-solid fa-eye-slash text-danger"},null,-1),L_=[q_],D_=e("button",{type:"submit",class:"btn btn-success w-100 p-3"}," Сохранить поля ",-1);function R_(s,t,o,d,a,n){return l(),i("div",xh,[e("div",e_,[t_,e("button",{type:"button",onClick:t[0]||(t[0]=_=>n.addField()),class:"btn mb-2 rounded-sm btn-outline-info"},[s_,m(" Добавить параметр ")])]),o_,e("form",{onSubmit:t[1]||(t[1]=S((..._)=>n.submit&&n.submit(..._),["prevent"]))},[e("table",l_,[i_,e("tbody",null,[(l(!0),i(b,null,f(a.fieldForm.fields,(_,r)=>(l(),i("tr",null,[e("th",n_,h(r+1),1),e("th",a_,[u(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Ключ","aria-label":"Ключ",maxlength:"255","onUpdate:modelValue":g=>a.fieldForm.fields[r].key=g,required:""},null,8,d_),[[p,a.fieldForm.fields[r].key]])]),e("th",r_,[u(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Подпись поля","aria-label":"Название поля",maxlength:"255","onUpdate:modelValue":g=>a.fieldForm.fields[r].label=g,required:""},null,8,c_),[[p,a.fieldForm.fields[r].label]])]),e("th",u_,[u(e("select",{class:"form-select","onUpdate:modelValue":g=>a.fieldForm.fields[r].type=g},[(l(!0),i(b,null,f(a.fieldTypes,g=>(l(),i("option",{value:g.value},h(g.title||"Не указан"),9,h_))),256))],8,m_),[[V,a.fieldForm.fields[r].type]])]),e("th",__,[u(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Паттерн","aria-label":"Паттерн",maxlength:"255",disabled:a.fieldForm.fields[r].type===2,"onUpdate:modelValue":g=>a.fieldForm.fields[r].validate_pattern=g},null,8,p_),[[p,a.fieldForm.fields[r].validate_pattern]])]),e("th",b_,[e("div",g_,[u(e("input",{class:"form-check-input","onUpdate:modelValue":g=>a.fieldForm.fields[r].required=g,type:"checkbox",value:"",id:"field-required"+r},null,8,f_),[[k,a.fieldForm.fields[r].required]]),e("label",{class:"form-check-label",for:"field-required"+r},[a.fieldForm.fields[r].required?(l(),i("span",v_,"Да")):c("",!0),a.fieldForm.fields[r].required?c("",!0):(l(),i("span",k_,"Нет"))],8,y_)])]),e("th",$_,[u(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Описание вопроса","aria-label":"Описание вопроса",maxlength:"255","onUpdate:modelValue":g=>a.fieldForm.fields[r].description=g,required:""},null,8,F_),[[p,a.fieldForm.fields[r].description]])]),e("th",w_,[a.fieldForm.fields[r].id?(l(),i("div",V_,[u(e("input",{class:"form-check-input d-none","onUpdate:modelValue":g=>a.fieldForm.fields[r].is_active=g,type:"checkbox",value:"",id:"field-is_active-"+r},null,8,U_),[[k,a.fieldForm.fields[r].is_active]]),e("label",{class:"form-check-label",for:"field-is_active-"+r},[a.fieldForm.fields[r].is_active?(l(),i("span",B_,I_)):c("",!0),a.fieldForm.fields[r].is_active?c("",!0):(l(),i("span",T_,L_))],8,j_)])):(l(),i("button",{key:0,type:"button",onClick:g=>n.removeField(r),class:"btn btn-link text-danger"},P_,8,C_))])]))),256))])]),D_],32)])}const G_=U(Zh,[["render",R_]]);const M_={key:0,class:"row"},z_={class:"col-12"},K_={key:1,class:"row mb-3 bot-sub-menu",style:{background:"transparent"}},E_={class:"col-12"},N_={class:"btn-group",role:"group","aria-label":"Basic outlined example",style:{background:"white"}},A_=e("i",{class:"fa-solid fa-info mr-1"},null,-1),J_=["disabled"],W_=e("i",{class:"fa-solid fa-file mr-2"},null,-1),Y_=["disabled"],H_=e("i",{class:"fa-solid fa-code mr-2"},null,-1),Q_={class:"dropdown"},X_=["disabled"],Z_=e("i",{class:"fa-solid fa-bars"},null,-1),x_=[Z_],ep={class:"dropdown-menu","aria-labelledby":"dropdownMenuLink"},tp=e("i",{class:"fa-solid fa-keyboard mr-2"},null,-1),sp=e("i",{class:"fa-solid fa-scroll mr-2"},null,-1),op=e("i",{class:"fa-solid fa-comment-dots mr-2"},null,-1),lp=e("i",{class:"fa-solid fa-users mr-2"},null,-1),ip=e("i",{class:"fa-regular fa-newspaper mr-2"},null,-1),np=e("i",{class:"fa-solid fa-list-check mr-2"},null,-1),ap=e("i",{class:"fa-brands fa-shopify mr-2"},null,-1),dp={key:0,class:"row"},rp={class:"col-12"},cp={class:"card border-success mb-3 mt-3"},up={class:"card-body"},mp={class:"form-label",id:"bot-level-2"},hp=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),_p=e("div",null,[m("Ваш бот будет 1 в 1 как в шаблоне!"),e("br"),m("Потом можно исправить названия кнопок в меню. ")],-1),pp=e("span",{class:"badge rounded-pill text-bg-warning m-0"},"желательно",-1),bp=["value"],gp={class:"row"},fp={class:"col-md-12 col-12"},yp={class:"form-check mb-3"},vp=["value"],kp=e("label",{class:"form-check-label",for:"bot-is-template"}," Сделать шаблоном ",-1),$p={key:0,class:"col-md-12 col-12"},Fp={class:"mb-3"},wp={class:"form-label",id:"bot-template-description"},Cp=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Sp=e("div",null,"Если Вы создаете шаблон, а не реального бота ",-1),Pp=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Vp={class:"row"},Up=e("div",{class:"col-12"},[e("p",null,[m("Для создания бота в Телеграм воспользуйтесь "),e("a",{href:"https://telegra.ph/Sozdanie-telegram-bota-06-12",target:"_blank"},"инструкцией")])],-1),jp={class:"col-12"},Bp={class:"mb-3"},Op={class:"form-label",id:"bot-domain"},Ip=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Tp=e("div",null,'Строго взять из BotFather! ТО что при создании с окончанием на "bot"',-1),qp=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Lp={key:0},Dp=["href"],Rp={class:"col-md-6 col-12"},Gp={class:"mb-3"},Mp={class:"form-label d-flex justify-content-between",id:"bot-token"},zp=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Kp=e("div",null,"Взять из BotFater при создании бота! Длинная нечитаемая подсвеченная строка! ",-1),Ep=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Np=e("a",{href:"https://t.me/botfather",target:"_blank"},"Создать нового бота в ТГ",-1),Ap={class:"col-md-6 col-12"},Jp={class:"mb-3"},Wp=e("label",{class:"form-label",id:"bot-token-dev"},"Токен бота (для тестирования)",-1),Yp={class:"col-12"},Hp={class:"card"},Qp={class:"card-body"},Xp=e("h6",null,"Настройка параметров бота в BotFather",-1),Zp={class:"mb-3"},xp={class:"form-label d-flex justify-content-between align-items-center",id:"bot-title"},eb={key:0,class:"text-secondary"},tb={class:"mb-3"},sb={class:"form-label d-flex justify-content-between align-items-center",id:"bot-short-description"},ob={key:0,class:"text-secondary"},lb={class:"mb-3"},ib={class:"form-label d-flex justify-content-between align-items-center",id:"bot-long-description"},nb={key:0,class:"text-secondary"},ab={class:"col-5"},db={class:"mb-3"},rb=["onUpdate:modelValue","aria-describedby"],cb={class:"col-5"},ub={class:"mb-3"},mb=["onUpdate:modelValue","aria-describedby"],hb={class:"col-2"},_b=["onClick"],pb=e("i",{class:"fa-regular fa-trash-can"},null,-1),bb=[pb],gb={class:"row"},fb={class:"col-12"},yb={class:"col-md-6 col-12"},vb={class:"mb-3"},kb={class:"d-flex justify-content-between align-items-center"},$b={class:"form-label d-flex justify-content-between",id:"bot-order-channel"},Fb=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),wb=e("div",null,"Ввести адрес ссылки на канал в форму после добавления тоукена ",-1),Cb=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Sb={class:"col-md-6 col-12"},Pb={class:"mb-3"},Vb={class:"d-flex justify-content-between"},Ub=e("label",{class:"form-label",id:"bot-main-channel"},"Канал для постов (id,рекламный)",-1),jb={key:0,class:"col-12 mb-2"},Bb={class:"form-check"},Ob=e("label",{class:"form-check-label",for:"need-payments"}," Необходимо добавить рассылку по топикам для канала заказов (он же системный канал) ",-1),Ib={key:1,class:"col-12 mb-2"},Tb=e("p",null,'Для того, чтоб узнать идентификатор топика в группе впишите в чат "Мой id"',-1),qb={class:"list-group"},Lb={class:"list-group-item"},Db={class:"mb-0"},Rb=["onUpdate:modelValue"],Gb={key:1,class:"row"},Mb={class:"col-12"},zb={class:"mb-3"},Kb={class:"d-flex justify-content-between"},Eb={class:"form-label",id:"bot-description"},Nb=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Ab=e("div",null,"Отобразится пользователю при первом запуске",-1),Jb=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Wb={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},Yb={class:"col-12"},Hb={class:"mb-3"},Qb={class:"d-flex justify-content-between"},Xb={class:"form-label",id:"bot-description"},Zb=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),xb=e("div",null,'Для меню "О Боте"',-1),eg=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),tg={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},sg={class:"col-12"},og={class:"mb-3"},lg={class:"d-flex justify-content-between"},ig={class:"form-label",id:"bot-maintenance-message"},ng=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),ag={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},dg={class:"col-md-6 col-12"},rg={class:"mb-3"},cg={class:"form-label",id:"bot-balance"},ug=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),mg=e("div",null,"Начальная сумма денег на счету у конкретного бота",-1),hg=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),_g={class:"col-md-6 col-12"},pg={class:"mb-3"},bg={class:"form-label",id:"bot-tax-per-day"},gg=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),fg=e("div",null,"Сумма списания денег за сутки работы бота (тариф)",-1),yg=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),vg={class:"col-md-6 col-12"},kg={class:"mb-3"},$g=e("label",{class:"form-label",id:"bot-level-1"},[m(" Уровень 1 CashBack, % "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),Fg={class:"col-md-6 col-12"},wg={class:"mb-3"},Cg=e("label",{class:"form-label",id:"bot-level-2"},"Уровень 2 CashBack, %",-1),Sg={class:"col-md-6 col-12"},Pg={class:"mb-3"},Vg=e("label",{class:"form-label",id:"bot-level-3"},"Уровень 3 CashBack, %",-1),Ug={class:"col-md-12 col-12"},jg={class:"mb-3"},Bg=e("label",{class:"form-label",id:"cashback-fired-period"},"Период сгорания CashBack",-1),Og=["value"],Ig={key:0,class:"mb-3"},Tg=e("label",{class:"form-label",id:"cashback-fired-level"},"Уровень сгорания CashBack, %",-1),qg={class:"mb-2"},Lg={class:"form-check"},Dg=e("label",{class:"form-check-label",for:"need-cashback-config"}," Необходимо настроить CashBack по категориям ",-1),Rg={key:0,class:"mb-2"},Gg=e("h6",null,"Настройка категорий CashBack-а",-1),Mg={class:"d-flex justify-content-between align-items-center w-100"},zg=e("small",null,"Название категории",-1),Kg=["onClick"],Eg=e("i",{class:"fa-regular fa-trash-can"},null,-1),Ng=[Eg],Ag=["onUpdate:modelValue","aria-describedby"],Jg=e("div",{class:"divider divider-small my-3 bg-highlight"},null,-1),Wg={class:"col-md-12 col-12 mb-2"},Yg={class:"card border-warning"},Hg={class:"card-body"},Qg={class:"form-group"},Xg=e("label",{class:"form-check-label",for:"warning-rules"},[e("i",{class:"fa-solid fa-triangle-exclamation text-danger"}),m(" Правила критических оповещений ")],-1),Zg=e("option",{value:null},"Не выбрано",-1),xg=["value"],e1={class:"card my-2 p-2"},t1={class:"row"},s1={class:"col-md-4 d-flex align-items-center"},o1={class:"m-0"},l1={class:"col-md-2"},i1={class:"form-check"},n1=["onUpdate:modelValue","id"],a1=["for"],d1={key:0},r1={key:1},c1={class:"col-md-5"},u1=["onUpdate:modelValue"],m1={class:"col-md-1 d-flex justify-content-center"},h1=["onClick"],_1=e("i",{class:"fa-solid fa-trash-can"},null,-1),p1=[_1],b1={class:"col-12 mb-2"},g1={class:"form-check"},f1=e("label",{class:"form-check-label",for:"need-payments"}," Необходимо подключить платежную систему ",-1),y1={key:1,class:"col-md-12 col-12"},v1={class:"form-check mb-3"},k1=["value"],$1=e("label",{class:"form-check-label",for:"bot-auto-cashback-on-payments"}," Начислять CashBack автоматически после успешной оплаты ",-1),F1={class:"mb-3"},w1=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),C1=e("div",null,"Если в боте планируется оплата, то необходимо через BotFather привязать нужную платежную систему и указать в данном поле полученный токен ",-1),S1=e("label",{class:"form-label",id:"payment_provider_token"},[m("Токен платежной системы "),e("a",{href:"https://t.me/botfather",target:"_blank"},"Подключить")],-1),P1={class:"col-12 mb-2"},V1={class:"form-check"},U1=e("label",{class:"form-check-label",for:"need-shop"}," Необходимо интегрировать магазин в бота ",-1),j1={key:2,class:"col-md-12 col-12"},B1={class:"mb-3"},O1=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),I1=e("div",null,"Ссылка на страницу ВК с товарами для вашего магазина в боте ",-1),T1=e("label",{class:"form-label",id:"bot-vk_shop_link"},[m("Ссылка на группу ВК с товарами "),e("a",{href:"https://vk.com/groups?w=groups_create",target:"_blank"},"Создать")],-1),q1={class:"col-md-12 col-12"},L1={class:"mb-3"},D1=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),R1=e("div",null,"Ссылка на внешний сервис обработки данных ",-1),G1=e("label",{class:"form-label",id:"callback_link"},"Ссылка на внешний сервис обработки данных ",-1),M1={class:"col-12"},z1={class:"card mb-3"},K1=e("div",{class:"card-header"},[e("h6",null,[m("Информационная ссылка: создайте контент в "),e("a",{target:"_blank",href:"https://telegra.ph"},"https://telegra.ph")])],-1),E1={class:"card-body"},N1=e("div",{class:"row"},[e("div",{class:"col-12"},[e("h6",null,"Ссылка")])],-1),A1={class:"row"},J1={class:"col-12"},W1={class:"mb-3"},Y1={class:"col-12"},H1={class:"card mb-3"},Q1=e("div",{class:"card-header"},[e("h6",null,"Ссылки на соц. сети")],-1),X1={class:"card-body"},Z1=e("div",{class:"row"},[e("div",{class:"col-12"},[e("h6",null,"Ссылка")])],-1),x1={class:"col-5"},ef={class:"mb-3"},tf=["onUpdate:modelValue","aria-describedby"],sf={class:"col-5"},of={class:"mb-3"},lf=["onUpdate:modelValue","aria-describedby"],nf={class:"col-2"},af=["onClick"],df=e("i",{class:"fa-regular fa-trash-can"},null,-1),rf=[df],cf={class:"row"},uf={class:"col-12"},mf={class:"col-12 mb-3"},hf=e("h6",null,[m("Аватар для бота "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),_f={class:"photo-preview d-flex justify-content-start flex-wrap w-100"},pf={for:"bot-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},bf=e("span",null,"+",-1),gf={class:"mb-2 img-preview",style:{"margin-right":"10px"}},ff={class:"remove"},yf=["onClick"],vf=e("i",{class:"fa-regular fa-trash-can"},null,-1),kf=[vf],$f={key:1,class:"mb-2 img-preview",style:{"margin-right":"10px"}},Ff={class:"remove"},wf=e("i",{class:"fa-regular fa-trash-can"},null,-1),Cf=[wf],Sf={class:"row"},Pf={class:"col-12"},Vf=["disabled"],Uf={key:0},jf={key:1},Bf={key:3,class:"pb-5 mb-5"},Of={key:4,class:"pb-5 mb-5"},If={key:5,class:"pb-5 mb-5"},Tf={key:6,class:"pb-5 mb-5"},qf={key:7,class:"pb-5 mb-5"},Lf={key:8,class:"pb-5 mb-5"},Df={key:9,class:"pb-5 mb-5"},Rf={key:10,class:"row pb-5 mb-5"},Gf={key:0,class:"col-12 col-md-8"},Mf={key:1,class:"col-12 col-md-4"},zf={key:11,class:"pb-5 mb-5"},Kf={props:["company","bot","editor"],data(){return{selected_warning:null,page:null,step:0,templates:[],load:!1,loadPage:!1,needPageListUpdate:!1,need_threads:!1,need_cashback_config:!1,need_payments:!1,need_shop:!1,command:null,warnings:[{title:"Сумма чека больше чем",key:"bill_sum_more_then"},{title:"Сумма начисления кэшбэка больше чем",key:"cashback_up_sum_more_then"},{title:"Сумма списания кэшбэка больше чем",key:"cashback_down_sum_more_then"}],cashback_fire_periods:[{title:"Не сгорает",value:0},{title:"7 дней",value:7},{title:"15 дней",value:15},{title:"30 дней",value:30},{title:"60 дней",value:60},{title:"60 дней",value:90},{title:"120 дней",value:120},{title:"180 дней",value:180},{title:"360 дней",value:360}],botForm:{title:null,short_description:null,long_description:null,is_template:!1,auto_cashback_on_payments:!1,template_description:null,bot_domain:null,bot_token:null,bot_token_dev:null,order_channel:null,message_threads:null,cashback_config:null,main_channel:null,vk_shop_link:null,callback_link:null,balance:null,tax_per_day:null,welcome_message:null,image:null,cashback_fire_percent:0,cashback_fire_period:0,description:null,info_link:null,social_links:[],maintenance_message:null,payment_provider_token:null,level_1:10,level_2:0,level_3:0,photos:[],commands:null,selected_bot_template_id:null,pages:[],amo:null,warnings:[]}}},watch:{need_threads:function(s,t){let o=[{title:"Отзывы",key:"reviews",value:null},{title:"Начисление cashback",key:"cashback",value:null},{title:"Вопросы",key:"questions",value:null},{title:"Конкурсы",key:"actions",value:null},{title:"Заказы",key:"orders",value:null},{title:"Вывод средств",key:"ask-money",value:null}];this.need_threads&&!this.botForm.message_threads&&(this.botForm.message_threads=o),this.need_threads&&this.botForm.message_threads&&o.forEach(d=>{this.botForm.message_threads.findIndex(n=>n.key===d.key)===-1&&this.botForm.message_threads.push(d)})},need_payments:function(s,t){this.need_payments||(this.botForm.auto_cashback_on_payments=!1)},"botForm.selected_bot_template_id":function(s,t){this.botForm.selected_bot_template_id!=null&&(this.loadSlugsByBotTemplate(this.botForm.selected_bot_template_id),this.loadPagesByBotTemplate(this.botForm.selected_bot_template_id))}},computed:{...C(["getSlugs"]),filteredWarnings(){return this.botForm.warnings.length===0?this.warnings:this.warnings.filter(s=>!(this.botForm.warnings.findIndex(t=>t.rule_key===s.key)>=0))}},mounted(){this.loadBotTemplates(),this.bot&&this.$nextTick(()=>{this.botForm={id:this.bot.id||null,title:this.bot.title||null,short_description:this.bot.short_description||null,long_description:this.bot.long_description||null,is_template:this.bot.is_template||!1,auto_cashback_on_payments:this.bot.auto_cashback_on_payments||!1,template_description:this.bot.template_description||null,bot_domain:this.bot.bot_domain||null,bot_token:this.bot.bot_token||null,bot_token_dev:this.bot.bot_token_dev||null,order_channel:this.bot.order_channel||null,message_threads:this.bot.message_threads||null,cashback_config:this.bot.cashback_config||null,main_channel:this.bot.main_channel||null,balance:this.bot.balance||null,tax_per_day:this.bot.tax_per_day||null,vk_shop_link:this.bot.vk_shop_link||null,callback_link:this.bot.callback_link||null,cashback_fire_percent:this.bot.cashback_fire_percent||0,cashback_fire_period:this.bot.cashback_fire_period||0,image:this.bot.image||null,commands:this.bot.commands||null,description:this.bot.description||null,info_link:this.bot.info_link||null,social_links:this.bot.social_links||[],maintenance_message:this.bot.maintenance_message||null,welcome_message:this.bot.welcome_message||null,payment_provider_token:this.bot.payment_provider_token||null,level_1:this.bot.level_1,level_2:this.bot.level_2,level_3:this.bot.level_3,photos:this.bot.photos||[],warnings:this.bot.warnings||[],amo:this.bot.amo||null},this.botForm.commands==null&&(this.botForm.commands=[{command:"/start",description:"начни с этой команды"},{command:"/admins",description:"доступные администраторы в системе"},{command:"/help",description:"как использовать систему"},{command:"/about",description:"о CashMan"}]),this.botForm.message_threads&&(this.need_threads=!0),this.botForm.payment_provider_token&&(this.need_payments=!0),this.botForm.cashback_config&&(this.need_cashback_config=!0),this.setStep(localStorage.getItem("cashman_set_botform_step_index")||0)})},methods:{setStep(s){this.step=parseInt(s),localStorage.setItem("cashman_set_botform_step_index",s)},addTextTo(s={param:null,text:null}){this.botForm[s.param]=s.text},removeCommands(s){this.botForm.commands.splice(s,1)},addCommands(){this.botForm.commands||(this.botForm.commands=[]),this.botForm.commands.push({command:null,description:null})},loadSlugsByBotTemplate(s){this.load=!0,this.$store.dispatch("loadSlugs",{dataObject:{botId:s},size:1e3}).then(t=>{this.botForm.slugs=this.getSlugs,this.$nextTick(()=>{this.load=!1})})},loadPagesByBotTemplate(s){this.$store.dispatch("loadBotPages",{botId:s}).then(t=>{this.botForm.pages=t})},loadBotTemplates(){this.$store.dispatch("loadTemplates").then(s=>{this.templates=s.data})},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},onChangePhotos(s){const t=s.target.files;this.botForm.image=null;for(let o=0;o<t.length;o++)this.botForm.photos.push(t[o])},addItem(s){this.botForm[s].push("")},addSocialLinks(){this.botForm.social_links.push({title:null,url:null})},removeItem(s,t){this.botForm[s].splice(t,1)},removePhoto(s){s?this.botForm.photos.splice(s,1):this.botForm.image=null},addBot(){let s=new FormData;Object.keys(this.botForm).forEach(t=>{const o=this.botForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.company&&s.append("company_id",this.company.id);for(let t=0;t<this.botForm.photos.length;t++)s.append("images[]",this.botForm.photos[t]);s.delete("photos"),this.$store.dispatch(this.bot==null?"createBot":"updateBot",{botForm:s}).then(t=>{this.$emit("callback",t.data),this.$notify({title:"Конструктор ботов",text:this.bot==null?"Бот успешно создан!":"Бот успешно обновлен!",type:"success"}),this.bot==null&&(this.botForm={title:null,short_description:null,long_description:null,is_template:!1,auto_cashback_on_payments:!1,template_description:null,bot_domain:null,bot_token:null,bot_token_dev:null,order_channel:null,message_threads:null,main_channel:null,balance:null,tax_per_day:null,callback_link:null,cashback_fire_percent:0,cashback_fire_period:0,image:null,description:null,info_link:null,social_links:[],maintenance_message:null,payment_provider_token:null,level_1:10,level_2:0,level_3:0,photos:[],warnings:[],selected_bot_template_id:null,pages:[]})}).catch(t=>{})},removeCashBackConfig(s){this.botForm.cashback_config.splice(s,1)},addCashBackConfig(){this.botForm.cashback_config=this.botForm.cashback_config==null?[]:this.botForm.cashback_config,this.botForm.cashback_config.push({title:null})},pageListCallback(s){this.loadPage=!0,this.page=s,this.$nextTick(()=>{this.loadPage=!1})},getWarning(s){let t=this.warnings.find(o=>o.key===s);return t||{title:"Не найдено"}},removeWarning(s){this.botForm.warnings.splice(s,1)},addWarning(){const s=this.selected_warning;this.botForm.warnings.push({rule_key:s.key,rule_value:0,is_active:!0}),this.selected_warning=null},pageCallback(s){this.loadPageList=!0,this.$nextTick(()=>{this.loadPageList=!1})}}},My=Object.assign(Kf,{__name:"BotForm",setup(s){return(t,o)=>{const d=B("Popper"),a=j("lazy");return l(),i(b,null,[s.company?(l(),i("div",M_,[e("div",z_,[e("h6",null,"Создаем бот к компании "+h(s.company.title||"Не установлен"),1)])])):c("",!0),s.editor?(l(),i("div",K_,[e("div",E_,[e("div",N_,[e("button",{type:"button",class:w([{"btn-info text-white":t.step===0},"btn btn-outline-info"]),onClick:o[0]||(o[0]=n=>t.setStep(0))},[A_,m(" Информация о боте ")],2),e("button",{type:"button",disabled:t.botForm.selected_bot_template_id===null,class:w([{"btn-info text-white":t.step===4},"btn btn-outline-info"]),onClick:o[1]||(o[1]=n=>t.setStep(4))},[W_,m(" Страницы ")],10,J_),e("button",{type:"button",disabled:t.botForm.selected_bot_template_id===null,class:w([{"btn-info text-white":t.step===10},"btn btn-outline-info"]),onClick:o[2]||(o[2]=n=>t.setStep(10))},[H_,m(" Настраиваемые поля ")],10,Y_),e("div",Q_,[e("button",{type:"button",disabled:t.botForm.selected_bot_template_id===null,class:"btn btn-outline-info dropdown-toggle custom-group-dropdown-btn",href:"#",role:"button",id:"dropdownMenuLink","data-bs-toggle":"dropdown","aria-expanded":"false"},x_,8,X_),e("ul",ep,[e("li",null,[e("a",{class:"dropdown-item",href:"#bot-menu-template",onClick:o[3]||(o[3]=n=>t.setStep(1))},[tp,m("Все клавиатуры в боте")])]),e("li",null,[e("a",{class:"dropdown-item",href:"#bot-slugs",onClick:o[4]||(o[4]=n=>t.setStep(2))},[sp,m("Все скрипты в боте")])]),e("li",null,[e("a",{class:"dropdown-item",href:"#bot-dialogs",onClick:o[5]||(o[5]=n=>t.setStep(6))},[op,m("Все диалоги в боте")])]),e("li",null,[e("a",{class:"dropdown-item",href:"#bot-users",onClick:o[6]||(o[6]=n=>t.setStep(3))},[lp,m("Все пользователи в боте")])]),e("li",null,[e("a",{class:"dropdown-item",href:"#bot-news",onClick:o[7]||(o[7]=n=>t.setStep(9))},[ip,m(" Новостной канал")])]),e("li",null,[e("a",{class:"dropdown-item",href:"#bot-amo",onClick:o[8]||(o[8]=n=>t.setStep(7))},[np,m(" AMO CRM")])]),e("li",null,[e("a",{class:"dropdown-item",href:"#bot-shop",onClick:o[9]||(o[9]=n=>t.setStep(8))},[ap,m(" Магазин")])])])])])])])):c("",!0),t.step===0?(l(),i("form",{key:2,class:"pb-5 mb-5",onSubmit:o[47]||(o[47]=S((...n)=>t.addBot&&t.addBot(...n),["prevent"]))},[t.templates.length>0&&s.bot==null?(l(),i("div",dp,[e("div",rp,[e("div",cp,[e("div",up,[e("label",mp,[v(d,null,{content:y(()=>[_p]),default:y(()=>[hp]),_:1}),m(" Выберите шаблон! "),pp]),u(e("select",{class:"form-control","aria-label":"Шаблон бота","onUpdate:modelValue":o[10]||(o[10]=n=>t.botForm.selected_bot_template_id=n),"aria-describedby":"bot-level-2"},[(l(!0),i(b,null,f(t.templates,(n,_)=>(l(),i("option",{value:n.id},h(n.template_description||n.bot_domain||"Не указано"),9,bp))),256))],512),[[V,t.botForm.selected_bot_template_id]])])])])])):c("",!0),e("div",gp,[e("div",fp,[e("div",yp,[u(e("input",{class:"form-check-input",type:"checkbox",value:t.botForm.is_template,"onUpdate:modelValue":o[11]||(o[11]=n=>t.botForm.is_template=n),id:"bot-is-template"},null,8,vp),[[k,t.botForm.is_template]]),kp])]),t.botForm.is_template?(l(),i("div",$p,[e("div",Fp,[e("label",wp,[v(d,null,{content:y(()=>[Sp]),default:y(()=>[Cp]),_:1}),m(" Название шаблона бота "),Pp]),u(e("input",{type:"text",class:"form-control",placeholder:"Название \\ описание шаблона","aria-label":"Описание шаблона","onUpdate:modelValue":o[12]||(o[12]=n=>t.botForm.template_description=n),maxlength:"255","aria-describedby":"bot-template-description",required:""},null,512),[[p,t.botForm.template_description]])])])):c("",!0)]),e("div",Vp,[Up,e("div",jp,[e("div",Bp,[e("label",Op,[v(d,null,{content:y(()=>[Tp]),default:y(()=>[Ip]),_:1}),m(" Доменное имя бота из BotFather "),qp]),u(e("input",{type:"text",class:"form-control",placeholder:"Имя бота","aria-label":"Имя бота","onUpdate:modelValue":o[13]||(o[13]=n=>t.botForm.bot_domain=n),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[p,t.botForm.bot_domain]]),t.botForm.bot_domain?(l(),i("p",Lp,[m("Проверить работу бота "),e("a",{href:"https://t.me/"+t.botForm.bot_domain,target:"_blank"},"@"+h(t.botForm.bot_domain),9,Dp)])):c("",!0)])]),e("div",Rp,[e("div",Gp,[e("label",Mp,[e("div",null,[v(d,null,{content:y(()=>[Kp]),default:y(()=>[zp]),_:1}),m(" Токен бота "),Ep]),Np]),u(e("input",{type:"text",class:"form-control",placeholder:"Токен","aria-label":"Токен","onUpdate:modelValue":o[14]||(o[14]=n=>t.botForm.bot_token=n),maxlength:"255","aria-describedby":"bot-token",required:""},null,512),[[p,t.botForm.bot_token]])])]),e("div",Ap,[e("div",Jp,[Wp,u(e("input",{type:"text",class:"form-control",placeholder:"Токен","aria-label":"Токен","onUpdate:modelValue":o[15]||(o[15]=n=>t.botForm.bot_token_dev=n),maxlength:"255","aria-describedby":"bot-token-dev"},null,512),[[p,t.botForm.bot_token_dev]])])]),e("div",Yp,[e("div",Hp,[e("div",Qp,[Xp,e("div",Zp,[e("label",xp,[e("span",null,[m(" Название бота "),t.botForm.title!=null?(l(),i("small",eb,"Длина текста "+h(t.botForm.title.length)+"/64",1)):c("",!0)])]),u(e("input",{type:"text",class:"form-control",placeholder:"Текст названия","aria-label":"Текст названия","onUpdate:modelValue":o[16]||(o[16]=n=>t.botForm.title=n),maxlength:"64","aria-describedby":"bot-title"},null,512),[[p,t.botForm.title]])]),e("div",tb,[e("label",sb,[e("span",null,[m(" Короткое описание бота "),t.botForm.short_description!=null?(l(),i("small",ob,"Длина текста "+h(t.botForm.title.length)+"/120",1)):c("",!0)])]),u(e("textarea",{class:"form-control",placeholder:"Короткий текст описания бота","aria-label":"Короткий текст описания бота","onUpdate:modelValue":o[17]||(o[17]=n=>t.botForm.short_description=n),maxlength:"120","aria-describedby":"bot-short-description"},`
                                `,512),[[p,t.botForm.short_description]])]),e("div",lb,[e("label",ib,[e("span",null,[m(" Длинное описание бота "),t.botForm.long_description!=null?(l(),i("small",nb,"Длина текста "+h(t.botForm.title.length)+"/512",1)):c("",!0)])]),u(e("textarea",{class:"form-control",placeholder:"Длинный текст описания бота","aria-label":"Длинный текст описания бота","onUpdate:modelValue":o[18]||(o[18]=n=>t.botForm.long_description=n),maxlength:"512","aria-describedby":"bot-long-description"},`
                                `,512),[[p,t.botForm.long_description]])]),(l(!0),i(b,null,f(t.botForm.commands,(n,_)=>(l(),i("div",{class:"row",key:"commands-"+_},[e("div",ab,[e("div",db,[u(e("input",{type:"text",class:"form-control",placeholder:"Название команды","aria-label":"Название команды",maxlength:"255","onUpdate:modelValue":r=>t.botForm.commands[_].command=r,"aria-describedby":"bot-command-"+_,required:""},null,8,rb),[[p,t.botForm.commands[_].command]])])]),e("div",cb,[e("div",ub,[u(e("input",{type:"text",class:"form-control",placeholder:"Описание команды","aria-label":"Описание команды",maxlength:"255","onUpdate:modelValue":r=>t.botForm.commands[_].description=r,"aria-describedby":"bot-command-description-"+_,required:""},null,8,mb),[[p,t.botForm.commands[_].description]])])]),e("div",hb,[e("button",{type:"button",onClick:r=>t.removeCommands(_),class:"btn btn-outline-danger w-100"},bb,8,_b)])]))),128)),e("div",gb,[e("div",fb,[e("button",{type:"button",onClick:o[19]||(o[19]=n=>t.addCommands()),class:"btn btn-outline-success w-100"},"Добавить еще команду ")])])])])]),e("div",yb,[e("div",vb,[e("div",kb,[e("label",$b,[e("div",null,[v(d,null,{content:y(()=>[wb]),default:y(()=>[Fb]),_:1}),m(" Канал для заказов (id) "),Cb])]),v(I,{token:t.botForm.bot_token,param:"order_channel",onCallback:t.addTextTo},null,8,["token","onCallback"])]),u(e("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":o[20]||(o[20]=n=>t.botForm.order_channel=n),maxlength:"255","aria-describedby":"bot-order-channel"},null,512),[[p,t.botForm.order_channel]])])]),e("div",Sb,[e("div",Pb,[e("div",Vb,[Ub,v(I,{token:t.botForm.bot_token,param:"main_channel",onCallback:t.addTextTo},null,8,["token","onCallback"])]),u(e("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":o[21]||(o[21]=n=>t.botForm.main_channel=n),maxlength:"255","aria-describedby":"bot-main-channel"},null,512),[[p,t.botForm.main_channel]])])]),t.botForm.order_channel?(l(),i("div",jb,[e("div",Bb,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[22]||(o[22]=n=>t.need_threads=n),type:"checkbox",id:"need-payments"},null,512),[[k,t.need_threads]]),Ob])])):c("",!0),t.need_threads&&t.botForm.order_channel?(l(),i("div",Ib,[Tb,e("ul",qb,[(l(!0),i(b,null,f(t.botForm.message_threads,(n,_)=>(l(),i("li",Lb,[e("p",Db,h(n.title)+" ("+h(n.key)+")",1),u(e("input",{type:"number",class:"form-control",min:"0",max:"10000",placeholder:"Идентификатор топика","onUpdate:modelValue":r=>t.botForm.message_threads[_].value=r},null,8,Rb),[[p,t.botForm.message_threads[_].value]])]))),256))])])):c("",!0)]),t.botForm.bot_token?(l(),i("div",Gb,[e("div",Mb,[e("div",zb,[e("div",Kb,[e("label",Eb,[v(d,null,{content:y(()=>[Ab]),default:y(()=>[Nb]),_:1}),m(" Приветственное сообщение "),Jb,t.botForm.welcome_message?(l(),i("small",Wb," Длина текста "+h(t.botForm.welcome_message.length),1)):c("",!0)]),v(T,{param:"welcome_message",onCallback:t.addTextTo},null,8,["onCallback"])]),u(e("textarea",{type:"text",class:"form-control",placeholder:"Текстовое приветствие при запуске бота","aria-label":"Текстовое приветствие при запуске бота","onUpdate:modelValue":o[23]||(o[23]=n=>t.botForm.welcome_message=n),"aria-describedby":"bot-description",required:""},`
                    `,512),[[p,t.botForm.welcome_message]])])]),e("div",Yb,[e("div",Hb,[e("div",Qb,[e("label",Xb,[v(d,null,{content:y(()=>[xb]),default:y(()=>[Zb]),_:1}),m(" Описание бота "),eg,t.botForm.description?(l(),i("small",tg," Длина текста "+h(t.botForm.description.length),1)):c("",!0)]),v(T,{param:"description",onCallback:t.addTextTo},null,8,["onCallback"])]),u(e("textarea",{type:"text",class:"form-control",placeholder:"Текстовое описание бота","aria-label":"Текстовое описание бота","onUpdate:modelValue":o[24]||(o[24]=n=>t.botForm.description=n),"aria-describedby":"bot-description",required:""},`
                    `,512),[[p,t.botForm.description]])])]),e("div",sg,[e("div",og,[e("div",lg,[e("label",ig,[m("Сообщение для режима тех. работ "),ng,t.botForm.maintenance_message?(l(),i("small",ag," Длина текста "+h(t.botForm.maintenance_message.length),1)):c("",!0)]),v(T,{param:"maintenance_message",onCallback:t.addTextTo},null,8,["onCallback"])]),u(e("textarea",{type:"text",class:"form-control",placeholder:"Текстовое сообщение","aria-label":"Текстовое сообщение","onUpdate:modelValue":o[25]||(o[25]=n=>t.botForm.maintenance_message=n),maxlength:"255","aria-describedby":"bot-maintenance-message",required:""},`
                    `,512),[[p,t.botForm.maintenance_message]])])]),e("div",dg,[e("div",rg,[e("label",cg,[v(d,null,{content:y(()=>[mg]),default:y(()=>[ug]),_:1}),m(" Баланс бота, руб "),hg]),u(e("input",{type:"number",class:"form-control",placeholder:"Баланс","aria-label":"Баланс","onUpdate:modelValue":o[26]||(o[26]=n=>t.botForm.balance=n),min:"0","aria-describedby":"bot-balance",required:""},null,512),[[p,t.botForm.balance]])])]),e("div",_g,[e("div",pg,[e("label",bg,[v(d,null,{content:y(()=>[fg]),default:y(()=>[gg]),_:1}),m(" Списание за сутки, руб "),yg]),u(e("input",{type:"number",class:"form-control",placeholder:"Списание","aria-label":"Списание","onUpdate:modelValue":o[27]||(o[27]=n=>t.botForm.tax_per_day=n),min:"0","aria-describedby":"bot-tax-per-day",required:""},null,512),[[p,t.botForm.tax_per_day]])])]),e("div",vg,[e("div",kg,[$g,u(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень CashBack","onUpdate:modelValue":o[28]||(o[28]=n=>t.botForm.level_1=n),min:"0","aria-describedby":"bot-level-1",required:""},null,512),[[p,t.botForm.level_1]])])]),e("div",Fg,[e("div",wg,[Cg,u(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень CashBack","onUpdate:modelValue":o[29]||(o[29]=n=>t.botForm.level_2=n),min:"0","aria-describedby":"bot-level-2"},null,512),[[p,t.botForm.level_2]])])]),e("div",Sg,[e("div",Pg,[Vg,u(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень CashBack","onUpdate:modelValue":o[30]||(o[30]=n=>t.botForm.level_3=n),min:"0","aria-describedby":"bot-level-3"},null,512),[[p,t.botForm.level_3]])])]),e("div",Ug,[e("div",jg,[Bg,u(e("select",{class:"form-control","onUpdate:modelValue":o[31]||(o[31]=n=>t.botForm.cashback_fire_period=n),id:"cashback-fired-period"},[(l(!0),i(b,null,f(t.cashback_fire_periods,n=>(l(),i("option",{value:n.value},h(n.title||"Не указано"),9,Og))),256))],512),[[V,t.botForm.cashback_fire_period]])]),t.botForm.cashback_fire_period>0?(l(),i("div",Ig,[Tg,u(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень сгорания CashBack","onUpdate:modelValue":o[32]||(o[32]=n=>t.botForm.cashback_fire_percent=n),min:"0",max:"100","aria-describedby":"cashback-fired-level"},null,512),[[p,t.botForm.cashback_fire_percent]])])):c("",!0)]),e("div",qg,[e("div",Lg,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[33]||(o[33]=n=>t.need_cashback_config=n),type:"checkbox",id:"need-cashback-config"},null,512),[[k,t.need_cashback_config]]),Dg])]),t.need_cashback_config?(l(),i("div",Rg,[Gg,(l(!0),i(b,null,f(t.botForm.cashback_config,(n,_)=>(l(),i("div",{class:"d-flex justify-content-between mb-2 flex-wrap",key:"social-link"+_},[e("div",Mg,[zg,e("button",{type:"button",onClick:r=>t.removeCashBackConfig(_),class:"btn btn-link text-danger"},Ng,8,Kg)]),u(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Название категории","aria-label":"Название категории",maxlength:"255","onUpdate:modelValue":r=>t.botForm.cashback_config[_].title=r,"aria-describedby":"bot-cashback-config-"+_,required:""},null,8,Ag),[[p,t.botForm.cashback_config[_].title]])]))),128)),e("button",{type:"button",onClick:o[34]||(o[34]=n=>t.addCashBackConfig()),class:"btn mb-2 rounded-sm text-uppercase btn-outline-info w-100"}," Добавить еще категорию "),Jg])):c("",!0),e("div",Wg,[e("div",Yg,[e("div",Hg,[e("div",Qg,[Xg,u(e("select",{class:"form-control","onUpdate:modelValue":o[35]||(o[35]=n=>t.selected_warning=n),onChange:o[36]||(o[36]=(...n)=>t.addWarning&&t.addWarning(...n)),id:"warning-rules"},[Zg,(l(!0),i(b,null,f(t.filteredWarnings,n=>(l(),i("option",{value:n},h(n.title),9,xg))),256))],544),[[V,t.selected_warning]])]),(l(!0),i(b,null,f(t.botForm.warnings,(n,_)=>(l(),i("div",e1,[e("div",t1,[e("div",s1,[e("p",o1,h(t.getWarning(n.rule_key).title||"Не найдено"),1)]),e("div",l1,[e("div",i1,[u(e("input",{class:"form-check-input","onUpdate:modelValue":r=>t.botForm.warnings[_].is_active=r,type:"checkbox",id:"warning-is-active-"+_},null,8,n1),[[k,t.botForm.warnings[_].is_active]]),e("label",{class:"form-check-label",for:"warning-is-active-"+_},[t.botForm.warnings[_].is_active?(l(),i("span",d1,"Вкл")):(l(),i("span",r1,"Выкл"))],8,a1)])]),e("div",c1,[u(e("input",{type:"number",class:"form-control",placeholder:"Значение","onUpdate:modelValue":r=>t.botForm.warnings[_].rule_value=r,min:"0","aria-describedby":"bot-level-3"},null,8,u1),[[p,t.botForm.warnings[_].rule_value]])]),e("div",m1,[e("button",{onClick:r=>t.removeWarning(_),type:"button",class:"btn btn-outline-danger"},p1,8,h1)])])]))),256))])])]),e("div",b1,[e("div",g1,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[37]||(o[37]=n=>t.need_payments=n),type:"checkbox",id:"need-payments"},null,512),[[k,t.need_payments]]),f1])]),t.need_payments?(l(),i("div",y1,[e("div",v1,[u(e("input",{class:"form-check-input",type:"checkbox",value:t.botForm.auto_cashback_on_payments,"onUpdate:modelValue":o[38]||(o[38]=n=>t.botForm.auto_cashback_on_payments=n),id:"bot-auto-cashback-on-payments"},null,8,k1),[[k,t.botForm.auto_cashback_on_payments]]),$1]),e("div",F1,[v(d,null,{content:y(()=>[C1]),default:y(()=>[w1]),_:1}),S1,u(e("input",{type:"text",class:"form-control",placeholder:"Токен","aria-label":"Токен","onUpdate:modelValue":o[39]||(o[39]=n=>t.botForm.payment_provider_token=n),"aria-describedby":"payment_provider_token"},null,512),[[p,t.botForm.payment_provider_token]])])])):c("",!0),e("div",P1,[e("div",V1,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[40]||(o[40]=n=>t.need_shop=n),type:"checkbox",id:"need-shop"},null,512),[[k,t.need_shop]]),U1])]),t.need_shop?(l(),i("div",j1,[e("div",B1,[v(d,null,{content:y(()=>[I1]),default:y(()=>[O1]),_:1}),T1,u(e("input",{type:"url",class:"form-control",placeholder:"Ссылка на группу ВК","aria-label":"ссылка на группу ВК","onUpdate:modelValue":o[41]||(o[41]=n=>t.botForm.vk_shop_link=n),"aria-describedby":"vk_shop_link"},null,512),[[p,t.botForm.vk_shop_link]])])])):c("",!0),e("div",q1,[e("div",L1,[v(d,null,{content:y(()=>[R1]),default:y(()=>[D1]),_:1}),G1,u(e("input",{type:"url",class:"form-control",placeholder:"Ссылка на внешний сервис","aria-label":"ссылка на внешний сервис","onUpdate:modelValue":o[42]||(o[42]=n=>t.botForm.callback_link=n),"aria-describedby":"callback_link"},null,512),[[p,t.botForm.callback_link]])])]),e("div",M1,[e("div",z1,[K1,e("div",E1,[N1,e("div",A1,[e("div",J1,[e("div",W1,[u(e("input",{type:"text",class:"form-control",placeholder:"Ссылка ресурс telegraph","aria-label":"Ссылка ресурс telegraph",maxlength:"255","onUpdate:modelValue":o[43]||(o[43]=n=>t.botForm.info_link=n),"aria-describedby":"bot-info-link"},null,512),[[p,t.botForm.info_link]])])])])])])]),e("div",Y1,[e("div",H1,[Q1,e("div",X1,[Z1,(l(!0),i(b,null,f(t.botForm.social_links,(n,_)=>(l(),i("div",{class:"row",key:"social-link"+_},[e("div",x1,[e("div",ef,[u(e("input",{type:"text",class:"form-control",placeholder:"Название ссылки","aria-label":"Название ссылки",maxlength:"255","onUpdate:modelValue":r=>t.botForm.social_links[_].title=r,"aria-describedby":"bot-social-link-"+_,required:""},null,8,tf),[[p,t.botForm.social_links[_].title]])])]),e("div",sf,[e("div",of,[u(e("input",{type:"text",class:"form-control",placeholder:"Ссылка на соц.сеть","aria-label":"Ссылка на соц.сеть",maxlength:"255","onUpdate:modelValue":r=>t.botForm.social_links[_].url=r,"aria-describedby":"bot-social-link-"+_,required:""},null,8,lf),[[p,t.botForm.social_links[_].url]])])]),e("div",nf,[e("button",{type:"button",onClick:r=>t.removeItem("social_links",_),class:"btn btn-outline-danger w-100"},rf,8,af)])]))),128)),e("div",cf,[e("div",uf,[e("button",{type:"button",onClick:o[44]||(o[44]=n=>t.addSocialLinks()),class:"btn btn-outline-success w-100"},"Добавить еще ссылку ")])])])])]),e("div",mf,[hf,e("div",_f,[e("label",pf,[bf,e("input",{type:"file",id:"bot-photos",multiple:"",accept:"image/*",onChange:o[45]||(o[45]=(...n)=>t.onChangePhotos&&t.onChangePhotos(...n)),style:{display:"none"}},null,32)]),t.botForm.photos?(l(!0),i(b,{key:0},f(t.botForm.photos,(n,_)=>(l(),i("div",gf,[u(e("img",null,null,512),[[a,t.getPhoto(n).imageUrl]]),e("div",ff,[e("a",{onClick:r=>t.removePhoto(_)},kf,8,yf)])]))),256)):(l(),i("div",$f,[u(e("img",null,null,512),[[a,"/images-by-bot-id/"+s.bot.id+"/"+t.botForm.image]]),e("div",Ff,[e("a",{onClick:o[46]||(o[46]=n=>t.removePhoto())},Cf)])]))])])])):c("",!0),e("div",Sf,[e("div",Pf,[e("button",{disabled:!t.botForm.bot_token,type:"submit",class:"btn btn-success w-100 p-3"},[s.bot?(l(),i("span",jf,"Обновить бота")):(l(),i("span",Uf,"Добавить бота"))],8,Vf)])])],32)):c("",!0),t.step===7?(l(),i("div",Bf,[t.load?c("",!0):(l(),$(Xh,{key:0,data:t.botForm.amo},null,8,["data"]))])):c("",!0),t.step===8?(l(),i("div",Of,[t.load?c("",!0):(l(),$(Sh,{key:0}))])):c("",!0),t.step===10?(l(),i("div",If,[t.load?c("",!0):(l(),$(G_,{key:0}))])):c("",!0),t.step===1?(l(),i("div",Tf,[t.load?c("",!0):(l(),$(q,{key:0,"select-mode":!1}))])):c("",!0),t.step===6?(l(),i("div",qf,[t.load?c("",!0):(l(),$(Vc,{key:0}))])):c("",!0),t.step===2?(l(),i("div",Lf,[t.load?c("",!0):(l(),$(yt,{key:0}))])):c("",!0),t.step===3?(l(),i("div",Df,[t.load?c("",!0):(l(),$(cs,{key:0}))])):c("",!0),t.step===4?(l(),i("div",Rf,[t.load?c("",!0):(l(),i("div",Gf,[t.loadPage?c("",!0):(l(),$(Pd,{key:0,page:t.page,onCallback:t.pageCallback},null,8,["page","onCallback"]))])),t.load?c("",!0):(l(),i("div",Mf,[v(L,{editor:!0,onCallback:t.pageListCallback},null,8,["onCallback"])]))])):c("",!0),t.step===9?(l(),i("div",zf,[v(K)])):c("",!0)],64)}}}),Ef={key:0},Nf={class:"row"},Af={class:"col-md-12 d-flex flex-column"},Jf={class:"d-flex"},Wf={class:"dropdown mr-2"},Yf=e("button",{class:"btn btn-outline-primary dropdown-toggle",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"}," Фильтры ",-1),Hf={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},Qf=["onClick"],Xf={class:"input-group mb-3"},Zf={key:0,class:"mt-2"},xf={class:"badge bg-info mr-1"},ey=["onClick"],ty=e("i",{class:"fa-solid fa-xmark"},null,-1),sy=[ty],oy={key:0,class:"row"},ly={class:"col-12"},iy={class:"mb-0"},ny={class:"mb-0"},ay={key:1,class:"row"},dy={class:"col-12 mb-3"},ry={class:"col-lg-4 col-12 mb-3"},cy={class:"card-body"},uy=["onClick"],my={key:0,class:"badge bg-info"},hy={class:"card-footer d-flex"},_y=["onClick"],py=e("i",{class:"fa-regular fa-copy"},null,-1),by=[py],gy=["onClick"],fy=e("i",{class:"fa-solid fa-boxes-packing"},null,-1),yy=[fy],vy=["onClick"],ky=e("i",{class:"fa-solid fa-box-open"},null,-1),$y=[ky],Fy=["onClick"],wy=e("i",{class:"fa-solid fa-trash-can text-white"},null,-1),Cy=[wy],Sy={class:"col-12"},Py={key:2,class:"row"},Vy=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранной компании нет созданных ботов! ")],-1),Uy=[Vy],jy={props:["companyId","editor"],data(){return{filters:[{name:"Активные",icon:"fa-brands fa-telegram",slug:"active"},{name:"Архивные",icon:"fa-solid fa-box-archive",slug:"archive"}],selectedFilters:[],show:!0,loading:!0,bots:[],search:null,bots_paginate_object:null}},computed:{...C(["getBots","getBotsPaginateObject","getCurrentCompany"]),filteredBots(){if(!this.bots)return[];if(this.selectedFilters.length===0&&this.search==null)return this.bots;if(this.selectedFilters.length===0&&this.search!=null)return this.bots.filter(t=>(t.bot_domain||"").trim().toLowerCase().indexOf(this.search.trim().toLowerCase())!==-1);let s=[];return this.selectedFilters.forEach(t=>{switch(t.slug){case"active":this.bots.filter(o=>o.deleted_at==null).forEach(o=>{s.push(o)});break;case"archive":this.bots.filter(o=>o.deleted_at!=null).forEach(o=>{s.push(o)});break}}),this.search==null?s:s.filter(t=>(t.bot_domain||"").trim().toLowerCase().indexOf(this.search.trim().toLowerCase())!==-1)}},mounted(){this.loadBots(),this.selectFilter("active")},methods:{duplicate(s){if(!this.getCurrentCompany){this.$notify("У Вас не выбран клиент!");return}this.$store.dispatch("duplicateBot",{dataObject:{bot_id:s,company_id:this.getCurrentCompany.id}}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно продублирован")})},addToArchive(s){this.$store.dispatch("removeBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен в архив")})},forceDelete(s){this.$store.dispatch("forceDeleteBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен из архива")})},extractFromArchive(s){this.$store.dispatch("restoreBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен из архива")})},selectFilter(s){let t=this.filters.find(o=>o.slug===s);t&&this.selectedFilters.filter(o=>o.slug===s).length===0&&this.selectedFilters.push(t)},removeSelectedFilter(s){let t=this.selectedFilters.findIndex(o=>o.slug===s);this.selectedFilters.splice(t,1)},selectBot(s){this.$emit("callback",s),this.show=!1,this.$notify("Вы выбрали бота из списка! Все остальные действия будут производится для этого бота.")},nextBots(s){this.loadBots(s)},loadBots(s=0){this.loading=!0,this.$store.dispatch("loadBots",{dataObject:{companyId:this.companyId||null,search:this.search},page:s}).then(t=>{this.loading=!1,this.bots=this.getBots,this.bots_paginate_object=this.getBotsPaginateObject}).catch(()=>{this.loading=!1})}}},zy=Object.assign(jy,{__name:"BotList",setup(s){return(t,o)=>t.show?(l(),i("div",Ef,[e("div",Nf,[e("div",Af,[e("div",Jf,[e("div",Wf,[Yf,e("ul",Hf,[(l(!0),i(b,null,f(t.filters,d=>(l(),i("li",null,[e("a",{class:"dropdown-item",onClick:a=>t.selectFilter(d.slug),href:"#filter"},[e("i",{class:w([d.icon,"mr-2"])},null,2),m(" "+h(d.name||"Не указано"),1)],8,Qf)]))),256))])]),e("div",Xf,[u(e("input",{type:"search",class:"form-control",placeholder:"Поиск бота","aria-label":"Поиск бота","onUpdate:modelValue":o[0]||(o[0]=d=>t.search=d),"aria-describedby":"button-addon2"},null,512),[[p,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=(...d)=>t.loadBots&&t.loadBots(...d)),type:"button",id:"button-addon2"},"Найти ")])]),t.selectedFilters.length>0?(l(),i("p",Zf,[(l(!0),i(b,null,f(t.selectedFilters,d=>(l(),i("span",xf,[m(h(d.name||"не указан")+" ",1),e("a",{onClick:a=>t.removeSelectedFilter(d.slug),class:"ml-1 text-white",href:"#filter"},sy,8,ey)]))),256))])):c("",!0)])]),t.bots_paginate_object?(l(),i("div",oy,[e("div",ly,[e("p",iy,"Количество найденных ботов "+h(t.bots_paginate_object.meta.total||0),1),e("p",ny,"Количество результатов на странице "+h(t.filteredBots.length||0),1)])])):c("",!0),t.bots.length>0?(l(),i("div",ay,[e("div",dy,[s.editor?c("",!0):(l(),i("button",{key:0,type:"button",class:"btn btn-outline-info",onClick:o[2]||(o[2]=d=>t.selectBot(null))},"Создать нового бота "))]),(l(!0),i(b,null,f(t.filteredBots,(d,a)=>(l(),i("div",ry,[e("div",{class:w(["card w-100",{"border-info":d.deleted_at==null,"border-secondary":d.deleted_at!=null}])},[e("div",cy,[e("p",{class:"d-flex justify-content-between",onClick:n=>t.selectBot(d),style:{"word-wrap":"break-word"}},[e("span",null,[e("i",{class:w([{"text-danger":d.deleted_at!=null},"fa-solid fa-robot mr-2"])},null,2),m(" "+h(d.bot_domain||"Не указано"),1)]),d.is_template?(l(),i("span",my,h(d.template_description||"Шаблон без названия"),1)):c("",!0)],8,uy)]),e("div",hy,[e("button",{class:"btn btn-outline-info mr-2",type:"button",onClick:n=>t.duplicate(d.id),title:"Дублировать"},by,8,_y),d.deleted_at==null?(l(),i("button",{key:0,class:"btn btn-outline-info",type:"button",onClick:n=>t.addToArchive(d.id),title:"В архив"},yy,8,gy)):c("",!0),d.deleted_at!=null?(l(),i("button",{key:1,class:"btn btn-outline-info mr-2",onClick:n=>t.extractFromArchive(d.id),title:"Из архива"},$y,8,vy)):c("",!0),d.deleted_at!=null?(l(),i("button",{key:2,class:"btn btn-danger mr-2",onClick:n=>t.forceDelete(d.id),title:"Удалить на совсем"},Cy,8,Fy)):c("",!0)])],2)]))),256)),e("div",Sy,[t.bots_paginate_object?(l(),$(P,{key:0,onPagination_page:t.nextBots,pagination:t.bots_paginate_object},null,8,["onPagination_page","pagination"])):c("",!0)])])):(l(),i("div",Py,Uy))])):c("",!0)}});export{Gy as I,My as _,zy as a,L as b,Pd as c,Vc as d};
