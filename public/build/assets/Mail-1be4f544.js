import{S as B,o as a,q as d,t as e,z as h,D as b,O as C,F as y,B as f,G as _,J as k,v,x as g,T as R,H as K,C as p,L as V,A as q}from"./index.es-fd92b082.js";import{V as U}from"./vue3-json-editor.esm.prod-1fe4324f.js";import{_ as M}from"./_plugin-vue_export-helper-c27b6911.js";import{v as w}from"./v4-a960c1f4.js";import{m as S}from"./index-4be11e74.js";import{T as j}from"./TelegramChannelHelper-daaa6b0f.js";const O={props:["editedKeyboard","type"],components:{Vue3JsonEditor:U},computed:{uuid(){return w()}},watch:{keyboard:{handler:function(o){this.save()},deep:!0}},data(){return{showCode:!1,showAssign:!1,selectedRow:null,load:!1,rowCount:1,keyboard:[],select:{row:0,col:0,type:this.type||"reply"}}},mounted(){this.editedKeyboard&&this.$nextTick(()=>{this.keyboard=this.editedKeyboard.menu})},methods:{needRemoveField(o,t,s){Object.keys(this.keyboard[t][s]).forEach(r=>{r!=="text"&&r!==o&&delete this.keyboard[t][s][r]})},save(){this.$emit("save",this.keyboard)},onJsonChange(o){this.keyboard=o,this.save()},removeColFromRow(o){this.keyboard[o].length>1?this.keyboard[o].splice(this.keyboard[o].length-1,1):this.keyboard.splice(o,1),this.keyboard.length===0&&(this.selectedRow=null),this.save()},addRowAbove(){this.addRow(!0)},addRowBelow(){this.addRow(!1)},addRow(o=!1){if(this.selectedRow==null)this.keyboard?this.keyboard.push([{text:"No Text"}]):this.keyboard=[[{text:"No Text"}]],this.selectedRow=null;else{let t=o?this.selectedRow:this.selectedRow+1;this.keyboard.splice(t,0,[{text:"No Text"}])}this.save()},addColToRow(o){this.keyboard[o].push({text:"No Text"}),this.save()},selectIndex(o,t){this.selectedRow=o,this.select.row=o,this.select.col=t,this.select.text=this.keyboard[o][t].text,this.load=!0,this.$nextTick(()=>{this.load=!1})},removeCol(o,t){this.keyboard[o].length>1?this.keyboard[o].splice(t,1):this.keyboard.splice(1,1),this.save()}}},J={class:"container"},N={class:"row"},D={class:"col-12 d-flex justify-content-between"},E=e("i",{class:"fa-solid fa-xmark"},null,-1),A=[E],L={class:"d-flex flex-column"},P={class:"form-check"},z=["id"],G=["for"],H={class:"col-12"},Y={class:"row"},Q={class:"col-2 d-flex justify-content-around p-2"},W=["onClick"],X=e("i",{class:"fa-solid fa-plus"},null,-1),Z=[X],I=["onClick"],x=e("i",{class:"fa-solid fa-minus"},null,-1),ee=[x],te={class:"col-10 d-flex justify-content-center p-1"},oe={class:"btn-group dropdown-center w-100 m-1"},se=["onClick","onUpdate:modelValue"],le=e("button",{type:"button",class:"btn btn-outline-primary dropdown-toggle dropdown-toggle-split","data-bs-toggle":"dropdown","aria-expanded":"false","data-bs-reference":"parent"},[e("span",{class:"visually-hidden"},"Toggle Dropdown")],-1),ae={class:"dropdown-menu w-100",style:{"min-width":"350px"}},ne={class:"px-4 py-3"},ie=e("div",{class:"alert alert-danger",role:"alert"}," Возможно выбрать только 1 тип действия ",-1),de={class:"mb-3"},re=["for"],ce=["onChange","onUpdate:modelValue","id"],he={class:"mb-3"},ue=["for"],be=["onChange","onUpdate:modelValue","id"],me={class:"mb-3"},_e=["for"],ye=["onChange","onUpdate:modelValue","id"],pe={class:"mb-3"},fe=["for"],ke=["onChange","onUpdate:modelValue","id"],ve={class:"form-check"},ge=["onChange","id"],$e=["for"],Ce={key:0,class:"form-check"},we=["onChange","onClick","id"],Fe=["for"],Te={class:"form-check"},Re=["onChange","onClick","id"],Ke=["for"],Se={class:"form-check"},Be=["onChange","onClick","id"],Ve=["for"],qe={key:0,class:"row"},Ue={class:"col-12"},Me=e("label",{class:"form-label",id:"bot-domain"},"JSON-код клавиатуры",-1);function je(o,t,s,r,l,c){const $=B("Vue3JsonEditor");return a(),d("div",J,[e("div",N,[e("div",D,[e("div",null,[l.selectedRow==null?(a(),d("button",{key:0,type:"button",class:"btn btn-primary mb-2",onClick:t[0]||(t[0]=(...m)=>c.addRow&&c.addRow(...m))},"Добавить строку ")):h("",!0),l.selectedRow!=null?(a(),d("button",{key:1,type:"button",class:"btn btn-primary mb-2",onClick:t[1]||(t[1]=(...m)=>c.addRowAbove&&c.addRowAbove(...m))},"Добавить строку выше ")):h("",!0),l.selectedRow!=null?(a(),d("button",{key:2,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:t[2]||(t[2]=(...m)=>c.addRowBelow&&c.addRowBelow(...m))},"Добавить строку ниже ")):h("",!0),l.selectedRow!=null?(a(),d("button",{key:3,type:"button",class:"btn btn-outline-danger mb-2 ml-2",onClick:t[3]||(t[3]=m=>l.selectedRow=null)},A)):h("",!0)]),e("div",L,[e("div",P,[b(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=m=>l.showCode=m),id:"showCode"+c.uuid},null,8,z),[[C,l.showCode]]),e("label",{class:"form-check-label",for:"showCode"+c.uuid}," Отобразить код ",8,G)])])]),e("div",H,[(a(!0),d(y,null,f(l.keyboard,(m,n)=>(a(),d("div",Y,[e("div",Q,[e("button",{type:"button",class:"btn btn-link w-100",onClick:T=>c.addColToRow(n)},Z,8,W),e("button",{type:"button",class:"btn btn-link w-100",onClick:T=>c.removeColFromRow(n)},ee,8,I)]),e("div",te,[(a(!0),d(y,null,f(m,(T,i)=>(a(),d("div",oe,[b(e("input",{type:"text",onClick:u=>c.selectIndex(n,i),class:"btn btn-outline-primary w-100","onUpdate:modelValue":u=>l.keyboard[n][i].text=u},null,8,se),[[_,l.keyboard[n][i].text]]),le,e("ul",ae,[e("form",ne,[ie,e("div",de,[e("label",{for:"command-row-"+n+"-col-"+i,class:"form-label"},"Команда (для меню в сообщении)",8,re),b(e("input",{type:"text",onChange:u=>c.needRemoveField("callback_data",n,i),"onUpdate:modelValue":u=>l.keyboard[n][i].callback_data=u,class:"form-control",id:"command-row-"+n+"-col-"+i,placeholder:"/start"},null,40,ce),[[_,l.keyboard[n][i].callback_data]])]),e("div",he,[e("label",{for:"switch-inline-query-row-"+n+"-col-"+i,class:"form-label"},"Ссылка на аккаунт в ТЕЛЕГРАММ",8,ue),b(e("input",{type:"text",class:"form-control",onChange:u=>c.needRemoveField("switch_inline_query",n,i),"onUpdate:modelValue":u=>l.keyboard[n][i].switch_inline_query=u,id:"switch-inline-query-row-"+n+"-col-"+i,placeholder:"@YourAccountLink"},null,40,be),[[_,l.keyboard[n][i].switch_inline_query]])]),e("div",me,[e("label",{for:"url-row-"+n+"-col-"+i,class:"form-label"},"Внешняя URL-ссылка",8,_e),b(e("input",{type:"text",class:"form-control",onChange:u=>c.needRemoveField("url",n,i),"onUpdate:modelValue":u=>l.keyboard[n][i].url=u,id:"url-row-"+n+"-col-"+i,placeholder:"https://t.me/example"},null,40,ye),[[_,l.keyboard[n][i].url]])]),e("div",pe,[e("label",{for:"switch-inline-query-current-chat-row-"+n+"-col-"+i,class:"form-label"},"Команда всплывающего меню бота",8,fe),b(e("input",{type:"text",class:"form-control",onChange:u=>c.needRemoveField("switch_inline_query_current_chat",n,i),"onUpdate:modelValue":u=>l.keyboard[n][i].switch_inline_query_current_chat=u,id:"witch-inline-query-current-chat-row-"+n+"-col-"+i,placeholder:"команда"},null,40,ke),[[_,l.keyboard[n][i].switch_inline_query_current_chat]])]),e("div",ve,[e("input",{type:"radio",onChange:u=>c.needRemoveField(null,n,i),name:"request-radio",class:"form-check-input",id:"no-action-row-"+n+"-col-"+i},null,40,ge),e("label",{class:"form-check-label",for:"no-action-row-"+n+"-col-"+i}," Без действий ",8,$e)]),n===0?(a(),d("div",Ce,[e("input",{type:"radio",onChange:u=>c.needRemoveField("pay",n,i),onClick:u=>l.keyboard[n][i].pay=!0,name:"request-radio",class:"form-check-input",id:"pay-action-row-"+n+"-col-"+i},null,40,we),e("label",{class:"form-check-label",for:"pay-action-row-"+n+"-col-"+i}," Кнопка оплаты ",8,Fe)])):h("",!0),e("div",Te,[e("input",{type:"radio",onChange:u=>c.needRemoveField("request_contact",n,i),onClick:u=>l.keyboard[n][i].request_contact=!0,name:"request-radio",class:"form-check-input",id:"phone-row-"+n+"-col-"+i},null,40,Re),e("label",{class:"form-check-label",for:"phone-row-"+n+"-col-"+i}," Запросить телефон (для нижнего меню) ",8,Ke)]),e("div",Se,[e("input",{type:"radio",name:"request-radio",onChange:u=>c.needRemoveField("request_location",n,i),onClick:u=>l.keyboard[n][i].request_location=!0,class:"form-check-input",id:"location-row-"+n+"-col-"+i},null,40,Be),e("label",{class:"form-check-label",for:"location-row-"+n+"-col-"+i}," Запросить локацию (для нижнего меню) ",8,Ve)])])])]))),256))])]))),256))])]),l.showCode?(a(),d("div",qe,[e("div",Ue,[Me,l.load?h("",!0):(a(),k($,{key:0,mode:"code",modelValue:l.keyboard,"onUpdate:modelValue":t[5]||(t[5]=m=>l.keyboard=m),"show-btns":!1,expandedOnStart:!0,onJsonChange:c.onJsonChange},null,8,["modelValue","onJsonChange"]))])])):h("",!0)])}const F=M(O,[["render",je]]);const Oe={class:"card"},Je={key:0,class:"card-header d-flex justify-content-between align-items-center"},Ne=["disabled"],De=e("i",{class:"fa-solid fa-arrow-left"},null,-1),Ee=[De],Ae=["data-bs-target","disabled"],Le=e("i",{class:"fa-regular fa-pen-to-square"},null,-1),Pe=[Le],ze=["disabled"],Ge=e("i",{class:"fa-regular fa-floppy-disk"},null,-1),He=[Ge],Ye={key:1,class:"card-header d-flex justify-content-between align-items-center"},Qe={class:"mr-2"},We=["data-bs-target","disabled"],Xe=e("i",{class:"fa-regular fa-pen-to-square"},null,-1),Ze=[Xe],Ie=["disabled"],xe=e("i",{class:"fa-regular fa-clone"},null,-1),et=[xe],tt=["disabled"],ot=e("i",{class:"fa-regular fa-floppy-disk"},null,-1),st=[ot],lt=["disabled"],at=e("i",{class:"fa-solid fa-trash-can"},null,-1),nt=[at],it={class:"card-body"},dt={key:0,class:"row"},rt={class:"col-md-6 col-12"},ct={class:"mb-3"},ht=e("label",{class:"form-label",id:"bot-domain"},"Тип",-1),ut=e("option",{value:"reply"},"Нижняя клавиатура",-1),bt=e("option",{value:"inline"},"Встроенная клавиатура",-1),mt=[ut,bt],_t={class:"col-md-6 col-12"},yt={class:"mb-3"},pt=e("label",{class:"form-label",id:"bot-domain"},"Мнемоническое имя",-1),ft={class:"row"},kt={class:"col-12"},vt={class:"row"},gt={class:"col-12"},$t={class:"row"},Ct={class:"col"},wt={type:"button",class:"btn btn-outline-primary w-100 mb-2"},Ft=["id"],Tt={class:"modal-dialog modal-fullscreen"},Rt={class:"modal-content"},Kt=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"open-construct-label"},"Визуальный редактор клавиатуры"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),St={class:"modal-body"},Bt=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),Vt={props:["keyboard","selectMode"],data:()=>({is_edited:!1,load:!1,keyboardForm:null}),computed:{uuid(){return w()}},watch:{keyboardForm:{handler(o){this.is_edited=!0},deep:!0}},mounted(){const o=this.keyboard;this.keyboardForm=o,this.$nextTick(()=>{this.is_edited=!1})},methods:{removeKeyboard(){this.$store.dispatch("removeKeyboardTemplate",{templateId:this.keyboardForm.id}).then(o=>{this.load=!0,this.$nextTick(()=>{this.load=!1}),this.$emit("callback",this.keyboardForm.id)}).catch(()=>{this.$emit("callback",this.keyboardForm.id)})},saveKeyboard(o){this.keyboardForm.menu=o},selectCard(){this.$emit("select",this.keyboardForm)},duplicateKeyboard(){let o=new FormData;Object.keys(this.keyboardForm).forEach(t=>{const s=this.keyboardForm[t]||"";typeof s=="object"?o.append(t,JSON.stringify(s)):o.append(t,s)}),this.$store.dispatch("createKeyboardTemplate",{keyboardForm:o}).then(t=>{this.$notify({title:"Конструктор ботов",text:"Меню успешно продублировано!",type:"success"}),this.load=!0,this.$nextTick(()=>{this.load=!1}),this.$emit("reload")})},updateKeyboard(){let o=new FormData;Object.keys(this.keyboardForm).forEach(t=>{const s=this.keyboardForm[t]||"";typeof s=="object"?o.append(t,JSON.stringify(s)):o.append(t,s)}),this.$store.dispatch("editKeyboardTemplate",{keyboardForm:o}).then(t=>{this.load=!0,this.$nextTick(()=>{this.load=!1,this.is_edited=!1}),this.$emit("callback")}).catch(()=>{this.is_edited=!0})}}},qt=Object.assign(Vt,{__name:"KeyboardCard",setup(o){return(t,s)=>(a(),d(y,null,[e("div",Oe,[o.selectMode?(a(),d("div",Je,[e("div",null,[e("button",{onClick:s[0]||(s[0]=(...r)=>t.selectCard&&t.selectCard(...r)),disabled:t.load,type:"button",class:"btn btn-outline-success mr-2"},Ee,8,Ne),e("button",{"data-bs-toggle":"modal","data-bs-target":"#open-construct-"+t.uuid,disabled:t.load,type:"button",title:"Редактировать клавиатуру",class:"btn btn-outline-success mr-2"},Pe,8,Ae),e("button",{onClick:s[1]||(s[1]=(...r)=>t.updateKeyboard&&t.updateKeyboard(...r)),type:"button",title:"Обновить клавиатуру",disabled:t.load||!t.is_edited,class:v(["btn btn-outline-primary mr-2",{"have-change":t.is_edited}])},He,10,ze)])])):h("",!0),o.selectMode?h("",!0):(a(),d("div",Ye,[e("div",null,[e("strong",Qe,"#"+g(o.keyboard.id),1),e("button",{"data-bs-toggle":"modal","data-bs-target":"#open-construct-"+t.uuid,disabled:t.load,type:"button",title:"Редактировать клавиатуру",class:"btn btn-outline-success mr-2"},Ze,8,We),e("button",{onClick:s[2]||(s[2]=(...r)=>t.duplicateKeyboard&&t.duplicateKeyboard(...r)),type:"button",title:"Дублировать клавиатуру",disabled:t.load,class:"btn btn-outline-primary mr-2"},et,8,Ie),e("button",{onClick:s[3]||(s[3]=(...r)=>t.updateKeyboard&&t.updateKeyboard(...r)),type:"button",title:"Обновить клавиатуру",disabled:t.load||!t.is_edited,class:v(["btn btn-outline-primary mr-2",{"have-change":t.is_edited}])},st,10,tt)]),e("button",{onClick:s[4]||(s[4]=(...r)=>t.removeKeyboard&&t.removeKeyboard(...r)),type:"button",disabled:t.load,title:"Удалить клавиатуру",class:"btn btn-outline-danger mr-2"},nt,8,lt)])),e("div",it,[o.selectMode?h("",!0):(a(),d("div",dt,[e("div",rt,[e("div",ct,[ht,b(e("select",{disabled:!0,"onUpdate:modelValue":s[5]||(s[5]=r=>o.keyboard.type=r),class:"form-control"},mt,512),[[R,o.keyboard.type]])])]),e("div",_t,[e("div",yt,[pt,b(e("input",{type:"text",class:"form-control",placeholder:"Мнемоническое имя",disabled:!0,"aria-label":"Мнемоническое имя","onUpdate:modelValue":s[6]||(s[6]=r=>o.keyboard.slug=r),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[_,o.keyboard.slug]])])])])),e("div",ft,[e("div",kt,[e("div",vt,[e("div",gt,[(a(!0),d(y,null,f(o.keyboard.menu,(r,l)=>(a(),d("div",$t,[(a(!0),d(y,null,f(r,(c,$)=>(a(),d("div",Ct,[e("button",wt,g(c.text),1)]))),256))]))),256))])])])])])]),e("div",{class:"modal fade",id:"open-construct-"+t.uuid,tabindex:"-1","aria-labelledby":"open-construct-label","aria-hidden":"true"},[e("div",Tt,[e("div",Rt,[Kt,e("div",St,[t.keyboardForm?(a(),k(F,{key:0,onSave:t.saveKeyboard,"edited-keyboard":t.keyboardForm},null,8,["onSave","edited-keyboard"])):h("",!0)]),Bt])])],8,Ft)],64))}}),Ut={key:0,class:"row mb-2"},Mt={class:"col-12"},jt={class:"card"},Ot=e("div",{class:"card-header"},[e("h6",null,"Форма создания шаблона клавиатуры")],-1),Jt={class:"card-body"},Nt={class:"col-md-6 col-12"},Dt={class:"mb-3"},Et=e("label",{class:"form-label",id:"bot-domain"},"Тип",-1),At=e("option",{value:"reply"},"Нижняя клавиатура",-1),Lt=e("option",{value:"inline"},"Встроенная клавиатура",-1),Pt=[At,Lt],zt={class:"col-md-6 col-12"},Gt={class:"mb-3"},Ht={class:"form-label d-flex justify-content-between",id:"bot-domain"},Yt=e("span",null,"Мнемоническое имя",-1),Qt=e("i",{class:"fa-solid fa-arrows-rotate"},null,-1),Wt=[Qt],Xt={class:"col-12"},Zt=e("div",{class:"col-12"},[e("button",{class:"btn btn-outline-success w-100 p-3"}," Добавить новый шаблон клавиатуры ")],-1),It={class:"row"},xt={key:0,class:"col-12"},eo={class:"badge bg-warning"},to={class:"col-12 mb-3"},oo={key:1,class:"card"},so={class:"card-body"},lo={key:2,class:"col-12 mb-3"},ao=e("div",{class:"alert alert-warning",role:"alert"},[e("p",null,"Список шаблонов клавиатур пуст!")],-1),no=[ao],io={props:["selectMode","type"],data(){return{keyboards:[],load:!1,bot:null,editedKeyboard:null,selectMenuIndex:null,keyboardForm:{type:"reply",bot_id:null,slug:null,menu:[]}}},computed:{...S(["getCurrentBot"]),filteredKeyboard(){return this.type?this.keyboards.filter(o=>o.type==this.type):this.keyboards}},mounted(){this.loadCurrentBot().then(()=>{this.loadMenusByBotTemplate(),this.generateSlug()})},methods:{selectCard(o){this.$emit("select",o)},keyboardCallbackAction(o){let t=this.keyboards.find(s=>s.id===o);t.deleted_at=new Date,this.loadMenusByBotTemplate()},loadMenusByBotTemplate(){this.$store.dispatch("loadBotKeyboards",{botId:this.bot.id}).then(o=>{this.keyboards=o.data})},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},submitKeyboard(){this.keyboardForm.bot_id=this.bot.id;let o=new FormData;Object.keys(this.keyboardForm).forEach(t=>{const s=this.keyboardForm[t]||"";typeof s=="object"?o.append(t,JSON.stringify(s)):o.append(t,s)}),this.$store.dispatch("createKeyboardTemplate",{keyboardForm:o}).then(t=>{this.keyboardForm={type:"reply",bot_id:null,slug:null,menu:[]},this.load=!0,this.$nextTick(()=>{this.load=!1}),this.loadMenusByBotTemplate()})},generateSlug(){this.keyboardForm.slug=w()},changeKeyboardFormMenu(o){this.keyboardForm.menu=o}}},ro=Object.assign(io,{__name:"KeyboardList",setup(o){return(t,s)=>(a(),d(y,null,[o.selectMode?h("",!0):(a(),d("div",Ut,[e("div",Mt,[e("div",jt,[Ot,e("div",Jt,[e("form",{onSubmit:s[3]||(s[3]=K((...r)=>t.submitKeyboard&&t.submitKeyboard(...r),["prevent"])),class:"row"},[e("div",Nt,[e("div",Dt,[Et,b(e("select",{"onUpdate:modelValue":s[0]||(s[0]=r=>t.keyboardForm.type=r),class:"form-control"},Pt,512),[[R,t.keyboardForm.type]])])]),e("div",zt,[e("div",Gt,[e("label",Ht,[Yt,e("a",{onClick:s[1]||(s[1]=(...r)=>t.generateSlug&&t.generateSlug(...r)),href:"#generate"},Wt)]),b(e("input",{type:"text",class:"form-control",placeholder:"Мнемоническое имя","aria-label":"Мнемоническое имя","onUpdate:modelValue":s[2]||(s[2]=r=>t.keyboardForm.slug=r),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[_,t.keyboardForm.slug]])])]),e("div",Xt,[t.load?h("",!0):(a(),k(F,{key:0,onSave:t.changeKeyboardFormMenu,"edited-keyboard":t.keyboardForm},null,8,["onSave","edited-keyboard"]))]),Zt],32)])])])])),e("div",It,[t.keyboards&&t.bot?(a(),d("div",xt,[e("p",null,[p("В списке клавиатур "),e("span",eo,g(t.filteredKeyboard.length)+" ед.",1)])])):h("",!0),t.keyboards&&t.bot?(a(!0),d(y,{key:1},f(t.filteredKeyboard,(r,l)=>(a(),d("div",to,[r.deleted_at?(a(),d("div",oo,[e("div",so,[e("p",null,"Удаленная клавиатура #"+g(r.id),1)])])):(a(),k(qt,{key:0,"select-mode":o.selectMode,onSelect:t.selectCard,onReload:t.loadMenusByBotTemplate,onCallback:t.keyboardCallbackAction,keyboard:r},null,8,["select-mode","onSelect","onReload","onCallback","keyboard"]))]))),256)):h("",!0),t.filteredKeyboard.length===0?(a(),d("div",lo,no)):h("",!0)])],64))}}),co={class:"col-md-12 col-12"},ho={class:"mb-3"},uo=e("i",{class:"fa-solid fa-xmark"},null,-1),bo=[uo],mo={class:"mb-3"},_o={class:"d-flex justify-content-between flex-wrap al"},yo=e("label",{class:"form-label",id:"bot-main-channel"},"Канал для постов (id,рекламный)",-1),po={class:"d-flex flex-wrap align-items-center"},fo=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),ko={class:"col-12 mb-2"},vo=e("label",{class:"form-label d-flex justify-content-between align-items-center mb-2",id:"bot-domain"},[p(" Текстовое содержимое страницы "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),go={class:"form-floating"},$o={for:"floatingTextarea2"},Co={key:0},wo={class:"col-12 mb-2"},Fo={class:"form-check"},To=e("label",{class:"form-check-label",for:"need-page-images"}," Изображения на странице (максимум 10) ",-1),Ro={key:0,class:"col-12 mb-2"},Ko={class:"card mb-3"},So=e("div",{class:"card-header"},[e("h6",null,"Изображения на странице")],-1),Bo={class:"card-body d-flex justify-content-start"},Vo={for:"photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},qo={class:"row"},Uo={key:0,class:"col-12 d-flex flex-wrap"},Mo={class:"mb-2 img-preview",style:{"margin-right":"10px"}},jo={class:"remove"},Oo=["onClick"],Jo={class:"col-12 mb-2"},No={class:"form-check"},Do=e("label",{class:"form-check-label",for:"need-inline-menu"}," Меню под текстом страницы ",-1),Eo={key:1,class:"col-12 mb-2"},Ao={class:"card"},Lo={class:"card-header d-flex justify-between align-items-center"},Po=e("h6",null,"Конструктор меню в сообщении",-1),zo={key:0},Go={key:1},Ho={class:"card-body"},Yo=e("div",{class:"col-12"},[e("button",{type:"submit",class:"btn btn-success w-100 p-3"}," Отправить сообщение в канал ")],-1),Qo={data(){return{load:!1,photos:[],showInlineTemplateSelector:!1,need_page_images:!1,need_inline_menu:!1,bot:null,mailForm:{text:"",inline_keyboard:null,channel:null}}},computed:{...S(["getCurrentBot"])},mounted(){this.loadCurrentBot()},methods:{addTextTo(o={param:null,text:null}){this.mailForm.channel=o.text},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},submitMail(){let o=new FormData;if(Object.keys(this.mailForm).forEach(t=>{const s=this.mailForm[t]||"";typeof s=="object"?o.append(t,JSON.stringify(s)):o.append(t,s)}),this.bot&&o.append("bot_id",this.bot.id),this.photos.length>0)for(let t=0;t<this.photos.length;t++)o.append("photos[]",this.photos[t]);this.$store.dispatch("sendToChannel",{mailForm:o}).then(t=>{this.load=!0,this.photos=[],this.need_inline_menu=!1,this.need_page_images=!1,this.mailForm={text:"",channel:null,inline_keyboard:null},this.$notify({title:"Конструктор ботов",text:"Сообщение успещно отправлено!",type:"success"})}).catch(t=>{})},saveInlineKeyboard(o){this.mailForm.inline_keyboard=o},selectInlineKeyboard(o){this.mailForm.inline_keyboard=o,this.showInlineTemplateSelector=!1},getPhoto(o){return{imageUrl:URL.createObjectURL(o)}},removePhoto(o){this.photos.splice(o,1)},removeImage(o){this.mailForm.images.splice(o,1)},onChangePhotos(o){const t=o.target.files;for(let s=0;s<t.length;s++)this.photos.push(t[s])}}},ts=Object.assign(Qo,{__name:"Mail",setup(o){return(t,s)=>{const r=V("lazy");return t.bot?(a(),d("form",{key:0,onSubmit:s[9]||(s[9]=K((...l)=>t.submitMail&&t.submitMail(...l),["prevent"]))},[e("div",co,[e("div",ho,[t.mailForm.channel!=null?(a(),d("button",{key:0,type:"button",class:"btn btn-outline-info",onClick:s[0]||(s[0]=l=>t.mailForm.channel=null)},bo)):h("",!0),p(" , "),e("button",{type:"button",class:v(["btn",{"btn-info":t.mailForm.channel===t.bot.main_channel,"btn-outline-info":t.mailForm.channel!==t.bot.main_channel}]),onClick:s[1]||(s[1]=l=>t.mailForm.channel=t.bot.main_channel)},"Главный канал ",2),p(" , "),e("button",{type:"button",class:v(["btn",{"btn-info":t.mailForm.channel===t.bot.order_channel,"btn-outline-info":t.mailForm.channel!==t.bot.order_channel}]),onClick:s[2]||(s[2]=l=>t.mailForm.channel=t.bot.order_channel)},"Канал заказов ",2)]),e("div",mo,[e("div",_o,[yo,e("div",po,[q(j,{token:t.bot.bot_token,param:"channel",onCallback:t.addTextTo},null,8,["token","onCallback"]),fo])]),b(e("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":s[3]||(s[3]=l=>t.mailForm.channel=l),maxlength:"255","aria-describedby":"bot-main-channel",required:""},null,512),[[_,t.mailForm.channel]])])]),e("div",ko,[vo,e("div",go,[b(e("textarea",{class:"form-control","onUpdate:modelValue":s[4]||(s[4]=l=>t.mailForm.text=l),maxlength:"4096",placeholder:"Введите текст",id:"floatingTextarea2",style:{"min-height":"100px"},required:""},null,512),[[_,t.mailForm.text]]),e("label",$o,[p("Содержимое страницы "),t.mailForm.text?(a(),d("span",Co,g(t.mailForm.text.length)+"/4096 ",1)):h("",!0)])])]),e("div",wo,[e("div",Fo,[b(e("input",{class:"form-check-input","onUpdate:modelValue":s[5]||(s[5]=l=>t.need_page_images=l),type:"checkbox",id:"need-page-images"},null,512),[[C,t.need_page_images]]),To])]),t.need_page_images?(a(),d("div",Ro,[e("div",Ko,[So,e("div",Bo,[e("label",Vo,[p(" + "),e("input",{type:"file",id:"photos",multiple:"",accept:"image/*",onChange:s[6]||(s[6]=(...l)=>t.onChangePhotos&&t.onChangePhotos(...l)),style:{display:"none"}},null,32)]),e("div",qo,[t.photos.length>0?(a(),d("div",Uo,[(a(!0),d(y,null,f(t.photos,(l,c)=>(a(),d("div",Mo,[b(e("img",null,null,512),[[r,t.getPhoto(l).imageUrl]]),e("div",jo,[e("a",{onClick:$=>t.removePhoto(c)},"Удалить",8,Oo)])]))),256))])):h("",!0)])])])])):h("",!0),e("div",Jo,[e("div",No,[b(e("input",{class:"form-check-input","onUpdate:modelValue":s[7]||(s[7]=l=>t.need_inline_menu=l),type:"checkbox",id:"need-inline-menu"},null,512),[[C,t.need_inline_menu]]),Do])]),t.need_inline_menu?(a(),d("div",Eo,[e("div",Ao,[e("div",Lo,[Po,e("button",{class:v(["btn",{"btn-outline-primary":!t.showInlineTemplateSelector,"btn-primary":t.showInlineTemplateSelector}]),type:"button",onClick:s[8]||(s[8]=l=>t.showInlineTemplateSelector=!t.showInlineTemplateSelector)},[t.showInlineTemplateSelector?(a(),d("span",Go," Скрыть шаблоны меню")):(a(),d("span",zo," Открыть шаблоны меню"))],2)]),e("div",Ho,[t.showInlineTemplateSelector?(a(),k(ro,{key:0,class:"mb-2",type:"inline",onSelect:t.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(a(),k(F,{key:1,type:"inline",onSave:t.saveInlineKeyboard,"edited-keyboard":t.mailForm.inline_keyboard},null,8,["onSave","edited-keyboard"]))])])])):h("",!0),Yo],32)):h("",!0)}}});export{F as B,ro as _,ts as a};
