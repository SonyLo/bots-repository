import{_ as B,a as A,b as Y,c as T,d as he,e as pe,f as be}from"./MailingTable-c4341411.js";import{R as q,q as l,t as i,v as e,B as f,O as v,D as m,H as c,J as h,F as g,C as y,y as u,A as r,T as k,P as S,G as C,x as b,K as $,L as Q,z as ee,u as M,Z as I,M as te,S as z,k as fe,g as K,o as ge,a8 as ve,a4 as $e,a9 as ye,aa as H,a7 as ke}from"./index.es-f98e90e3.js";import"./SlugForm-39f4178e.js";import{V as se,T as oe}from"./TelegramChannelHelper-ed863637.js";import{_ as V,B as J}from"./BotMediaList-30372b72.js";import{P as j}from"./Pagination-8d87cf85.js";import{_ as le}from"./GlobalSlugList-6909916a.js";import{b as D,c as ie,_ as Fe,a as G}from"./PromoCodesTable-377d5913.js";import{_ as we}from"./BotForm-a4996b46.js";import{_ as O}from"./_plugin-vue_export-helper-c27b6911.js";import{K as ne}from"./main-f646787a.js";import{v as Ce}from"./v4-4a60fe23.js";const Se={class:"row"},je={class:"col-12 mb-3"},qe={class:"form-label",id:"service-title"},ze=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Ve=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Pe={class:"col-12 mb-3"},Oe={key:0},Ue=["onClick"],Ae={class:"form-label",id:"service-category"},Ie=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Qe=e("div",null,"Категория услуги (используется для группировки) ",-1),Te=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Be={class:"col-12 mb-3"},Re={class:"form-label",id:"service-description"},Me=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),De=e("div",null," Краткая информация об оказываемой услуге ",-1),Ee=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Le={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},Ke={class:"col-12 col-md-6 mb-3"},Ne={class:"form-label",id:"service-title"},Je=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Ye=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),He={class:"col-12 col-md-6 mb-3"},Ge={class:"form-label",id:"service-title"},We=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Xe=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Ze={class:"col-12 mb-3"},xe={class:"form-check"},et=e("label",{class:"form-check-label",for:"need_images"}," Необходимо добавить изображения к сервиус ",-1),tt={key:0,class:"col-12 mb-3"},st={class:"form-label",id:"service-images"},ot=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),lt=e("div",null," Изображение, которое видит пользователь при выборе услуги ",-1),it=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),nt={class:"col-12 mb-3"},at={class:"form-check"},dt=e("label",{class:"form-check-label",for:"need_prepayment"}," Необходима предоплата ",-1),rt={class:"row"},ct={class:"col-12"},ut={type:"submit",class:"btn btn-outline-success w-100 p-3"},mt={key:0},_t={key:1},ht={props:["eventId","bot","service"],data(){return{load:!1,need_reset:!1,need_images:!1,categories:[],serviceForm:{id:null,title:null,appointment_event_id:null,description:null,category:null,images:[],need_prepayment:!1,price:0,discount_price:0}}},watch:{serviceForm:{handler(s){this.need_reset=!0},deep:!0}},mounted(){this.loadAppointmentServiceCategories(),console.log("Service form",this.service),this.service&&this.$nextTick(()=>{this.serviceForm={id:this.service.id||null,appointment_event_id:this.service.appointment_event_id||null,title:this.service.title||null,category:this.service.category||null,description:this.service.description||null,images:this.service.images||[],need_prepayment:this.service.need_prepayment||!1,price:this.service.price||0,discount_price:this.service.discount_price||0}})},methods:{loadAppointmentServiceCategories(){this.$store.dispatch("loadAppointmentServiceCategories",{dataObject:{bot_id:this.bot.id||null,event_id:this.eventId||null}}).then(s=>{this.categories=s})},selectPhotos(s){this.serviceForm.images||(this.serviceForm.images=[]);let t=this.serviceForm.images.indexOf(s.file_id);t!==-1?this.serviceForm.images.splice(t,1):this.serviceForm.images.push(s.file_id)},resetForm(){},submitForm(){let s=new FormData;Object.keys(this.serviceForm).forEach(t=>{const o=this.serviceForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),s.append("bot_id",this.bot.id),s.append("appointment_event_id",this.eventId),this.$store.dispatch(this.serviceForm.id===null?"addAppointmentService":"updateAppointmentService",{appointmentServiceForm:s}).then(t=>{this.$emit("callback",t.data),this.$notify("Услуги успешно создано")}).catch(t=>{this.$notify("Услуги создания события")})}}},pt=Object.assign(ht,{__name:"AppointmentServiceForm",setup(s){return(t,o)=>{const n=q("Popper");return l(),i("form",{onSubmit:o[7]||(o[7]=S((...a)=>t.submitForm&&t.submitForm(...a),["prevent"]))},[e("div",Se,[e("div",je,[e("label",qe,[f(n,{content:"Название оказываемой услуги"},{default:v(()=>[ze]),_:1}),m(" Название услуги "),Ve]),c(e("input",{type:"text",class:"form-control",placeholder:"Название","aria-label":"Название","onUpdate:modelValue":o[0]||(o[0]=a=>t.serviceForm.title=a),maxlength:"255","aria-describedby":"service-title",required:""},null,512),[[h,t.serviceForm.title]])]),e("div",Pe,[t.categories?(l(),i("p",Oe,[m(" Ранее созданные категории: "),(l(!0),i(g,null,y(t.categories,a=>(l(),i("span",{onClick:d=>t.serviceForm.category=a,class:"badge bg-primary mr-1 cursor-pointer"},u(a),9,Ue))),256))])):r("",!0),e("label",Ae,[f(n,null,{content:v(()=>[Qe]),default:v(()=>[Ie]),_:1}),m(" Категория услуги "),Te]),c(e("input",{type:"text",class:"form-control",placeholder:"Категория услуги","aria-label":"Категория услуги","onUpdate:modelValue":o[1]||(o[1]=a=>t.serviceForm.category=a),maxlength:"255","aria-describedby":"service-category",required:""},null,512),[[h,t.serviceForm.category]])]),e("div",Be,[e("label",Re,[f(n,null,{content:v(()=>[De]),default:v(()=>[Me]),_:1}),m(" Описание услуги "),Ee,t.serviceForm.description?(l(),i("small",Le," Длина текста "+u(t.serviceForm.description.length)+" / 255",1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Описание услуги","aria-label":"Описание услуги",maxlength:"255","onUpdate:modelValue":o[2]||(o[2]=a=>t.serviceForm.description=a),"aria-describedby":"service-description",required:""},`
                    `,512),[[h,t.serviceForm.description]])]),e("div",Ke,[e("label",Ne,[f(n,{content:"Цена оказываемой услуги"},{default:v(()=>[Je]),_:1}),m(" Цена услуги, руб "),Ye]),c(e("input",{type:"number",class:"form-control",placeholder:"Цена","aria-label":"Цена",min:"0","onUpdate:modelValue":o[3]||(o[3]=a=>t.serviceForm.price=a),"aria-describedby":"price",required:""},null,512),[[h,t.serviceForm.price]])]),e("div",He,[e("label",Ge,[f(n,{content:"Цена скидки на оказываемую услугу"},{default:v(()=>[We]),_:1}),m(" Цена скидки на услугу, руб "),Xe]),c(e("input",{type:"number",class:"form-control",placeholder:"Цена","aria-label":"Цена",min:"0","onUpdate:modelValue":o[4]||(o[4]=a=>t.serviceForm.discount_price=a),"aria-describedby":"price",required:""},null,512),[[h,t.serviceForm.discount_price]])]),e("div",Ze,[e("div",xe,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[5]||(o[5]=a=>t.need_images=a),type:"checkbox",id:"need_images"},null,512),[[k,t.need_images]]),et])]),t.need_images?(l(),i("div",tt,[e("label",st,[f(n,null,{content:v(()=>[lt]),default:v(()=>[ot]),_:1}),m(" Изображение к услуге "),it]),f(V,{"need-photo":!0,selected:t.serviceForm.images,onSelect:t.selectPhotos},null,8,["selected","onSelect"])])):r("",!0),e("div",nt,[e("div",at,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[6]||(o[6]=a=>t.serviceForm.need_prepayment=a),type:"checkbox",id:"need_prepayment"},null,512),[[k,t.serviceForm.need_prepayment]]),dt])])]),e("div",rt,[e("div",ct,[e("button",ut,[t.serviceForm.id===null?(l(),i("span",mt,"Создать услугу")):(l(),i("span",_t,"Обновить услугу"))])])])],32)}}}),bt={props:["param"],data(){return{expressions:[{expression:"{{userName}}",description:"Имя пользователя"},{expression:"{{level_1_percent}}",description:"Процент кэшбэка 1 уровня"},{expression:"{{level_2_percent}}",description:"Процент кэшбэка 2 уровня"},{expression:"{{level_3_percent}}",description:"Процент кэшбэка 3 уровня"},{expression:"{{cashback_fire_percent}}",description:"Процент сжигания кэшбэка"},{expression:"{{is_admin}}",description:"Статус администратора"},{expression:"{{is_work}}",description:"Статус работника"},{expression:"{{is_vip}}",description:"Статус VIP"},{expression:"{{is_manager}}",description:"Статус менеджера"},{expression:"{{is_deliveryman}}",description:"Статус доставщика"},{expression:"{{sex}}",description:"Пол клиента"},{expression:"{{cashback}}",description:"Сумма КэшБэк пользователя"},{expression:"{{telegramChatId}}",description:"Идентификатор чата"},{expression:"{{referralLink}}",description:"Реферальная ссылка"},{expression:"{{referralQr}}",description:"Реферальный QR-код"}]}},methods:{expressionsSelect(s){this.$emit("callback",{param:this.param,text:s.expression})}}},ft={class:"dropdown"},gt=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-brands fa-hire-a-helper"})],-1),vt={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},$t=["onClick"];function yt(s,t,o,n,a,d){return l(),i("div",ft,[gt,e("div",vt,[e("li",null,[(l(!0),i(g,null,y(a.expressions,_=>(l(),i("a",{class:"dropdown-item",onClick:p=>d.expressionsSelect(_)},u(_.description||"-"),9,$t))),256))])])])}const kt=O(bt,[["render",yt]]),Ft={key:0,class:"row"},wt={class:"col-12"},Ct={class:"form-floating mb-3"},St=e("label",{for:"floatingInput"},"Быстрый поиск команды",-1),jt={class:"col-12 mb-2"},qt={class:"form-check"},zt={class:"form-check-label",for:"need_global"},Vt={key:0},Pt={key:1},Ot={class:"form-check"},Ut=e("label",{class:"form-check-label",for:"need_show_deleted"}," Удаленные ",-1),At={key:0,class:"mb-3 col-12 col-sm-12"},It={class:"table"},Qt=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"Команда"),e("th",{scope:"col"},"Пояснение")])],-1),Tt=["onClick"],Bt={key:2,class:"mb-3 col-md-12"},Rt=e("div",{class:"alert alert-danger",role:"alert"}," У Вас еще нет добавленных скриптов! ",-1),Mt=[Rt],Dt={props:["command","canSelect"],data(){return{bot:null,load:!1,need_global:!0,need_show_deleted:!0,slugs:[],ownSearch:null,paginate:[]}},watch:{ownSearch:function(s,t){this.loadSlugs()},need_global:function(s,t){this.loadSlugs()},need_show_deleted:function(s,t){this.loadSlugs()}},computed:{...C(["getCurrentBot","getSlugs","getSlugsPaginateObject"])},mounted(){this.loadCurrentBot().then(()=>{this.loadSlugs()})},methods:{nextSlugs(s){this.loadSlugs(s)},loadSlugs(s=0){return this.$store.dispatch("loadSlugs",{dataObject:{botId:this.bot.id,needGlobal:this.need_global,needDeleted:this.need_show_deleted,search:this.ownSearch},page:s}).then(t=>{this.slugs=this.getSlugs,this.paginate=this.getSlugsPaginateObject})},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},callbackSlugs(){this.loadSlugs()},selectSlug(s){this.$emit("select",s)}}},Et=Object.assign(Dt,{__name:"BotSlugSimpleTableList",setup(s){return(t,o)=>t.bot?(l(),i("div",Ft,[e("div",wt,[e("div",Ct,[c(e("input",{type:"search","onUpdate:modelValue":o[0]||(o[0]=n=>t.ownSearch=n),class:"form-control",id:"floatingInput",placeholder:"name@example.com"},null,512),[[h,t.ownSearch]]),St])]),e("div",jt,[e("div",qt,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[1]||(o[1]=n=>t.need_global=n),type:"checkbox",id:"need_global"},null,512),[[k,t.need_global]]),e("label",zt,[t.need_global?(l(),i("span",Vt,"Глобальные")):(l(),i("span",Pt,"Локальные"))])]),e("div",Ot,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[2]||(o[2]=n=>t.need_show_deleted=n),type:"checkbox",id:"need_show_deleted"},null,512),[[k,t.need_show_deleted]]),Ut])]),t.slugs?(l(),i("div",At,[e("table",It,[Qt,e("tbody",null,[(l(!0),i(g,null,y(t.slugs,(n,a)=>(l(),i("tr",{class:b({"border-info":n.deleted_at==null,"border-danger":n.deleted_at!=null})},[e("th",{scope:"row",class:b({"text-danger":n.deleted_at!=null})},u(n.id||"Нет идентификатора"),3),e("td",{onClick:d=>t.selectSlug(n),class:b({"text-danger":n.deleted_at!=null})},u(n.command||"Нет команды"),11,Tt),e("td",{class:b({"text-danger":n.deleted_at!=null})},u(n.comment||"Пояснение не указано"),3)],2))),256))])])])):r("",!0),t.paginate?(l(),$(j,{key:1,onPagination_page:t.nextSlugs,pagination:t.paginate},null,8,["onPagination_page","pagination"])):r("",!0),t.slugs.length===0?(l(),i("div",Bt,Mt)):r("",!0)])):r("",!0)}}),Lt={class:"form-floating mb-3"},Kt=e("label",{for:"floatingInput"},"Команда",-1),Nt={class:"form-floating mb-3"},Jt=e("label",{for:"floatingInput"},"Мнемоническое имя",-1),Yt={class:"form-floating mb-3"},Ht=e("label",{for:"floatingInput"},"Описание скрипта",-1),Gt=e("h6",null," Параметры скрипта ",-1),Wt=e("div",{class:"alert alert-info",role:"alert"}," Данные параметры используются для настройки скриптов на стороне сервера ",-1),Xt={class:"dropdown"},Zt=e("button",{class:"btn btn-outline-info w-100 dropdown-toggle mb-2",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," Добавить ",-1),xt={class:"dropdown-menu w-100"},es=["onClick"],ts={class:"row"},ss={class:"col-12"},os=["onClick"],ls=e("p",null,"Вы можете подгрузить отсутствующие параметры конфигурации",-1),is=e("i",{class:"fa-solid fa-rotate mr-2"},null,-1),ns={key:0,class:"row"},as={class:"col-12"},ds={class:"table"},rs=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Ключ"),e("th",{scope:"col"},"Значение")])],-1),cs={colspan:"2"},us={class:"w-100 d-flex align-items-center justify-content-between"},ms={class:"dropdown mr-2"},_s=e("button",{class:"btn btn-outline-primary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-bars"})],-1),hs={class:"dropdown-menu"},ps=["onClick"],bs=e("i",{class:"fa-solid fa-trash-can"},null,-1),fs=["onClick"],gs=e("i",{class:"fa-solid fa-caret-left"},null,-1),vs=["onClick"],$s=e("i",{class:"fa-solid fa-caret-right"},null,-1),ys=["innerHTML"],ks={key:1,class:"mb-0 font-bold"},Fs={class:"dropdown"},ws={class:"btn btn-outline-primary dropdown-toggle w-100 d-flex justify-content-between align-items-center",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Cs={class:"dropdown-menu"},Ss=["onClick"],js={style:{width:"300px"}},qs={class:"form-floating"},zs=["onUpdate:modelValue","id"],Vs=["for"],Ps={key:0,class:"form-floating"},Os=["id","onUpdate:modelValue"],Us=["for"],As={key:1,class:"form-check"},Is=["onUpdate:modelValue","id"],Qs=["for"],Ts={key:2,class:"form-floating"},Bs=["onUpdate:modelValue","id"],Rs=["for"],Ms=["onClick"],Ds={key:0,class:"fa-solid fa-eye mr-2"},Es={key:1,class:"fa-solid fa-eye-slash mr-2"},Ls={key:2},Ks={key:3},Ns=["onClick"],Js={key:0,class:"fa-solid fa-eye mr-2"},Ys={key:1,class:"fa-solid fa-eye-slash mr-2"},Hs={key:2},Gs={key:3},Ws={key:5,class:"form-floating"},Xs=["onUpdate:modelValue","id"],Zs=["for"],xs=["onClick"],eo={key:0,class:"fa-solid fa-eye mr-2"},to={key:1,class:"fa-solid fa-eye-slash mr-2"},so={key:2},oo={key:3},lo={key:7,class:"form-check"},io=["onUpdate:modelValue","id"],no=["for"],ao={key:8,class:"form-floating"},ro=["id","onUpdate:modelValue"],co=["for"],uo=["onClick"],mo={key:0,class:"fa-solid fa-eye mr-2"},_o={key:1,class:"fa-solid fa-eye-slash mr-2"},ho={key:2},po={key:3},bo={colspan:"2"},fo={key:0,class:"form-floating mb-3"},go=["id","onUpdate:modelValue"],vo=["for"],$o={key:1,class:"form-floating"},yo=e("label",{class:"form-label",id:"bot-domain"},"JSON-код",-1),ko={key:2,class:"form-floating"},Fo=["onUpdate:modelValue","id"],wo=["for"],Co={key:3,class:"form-floating"},So=["onUpdate:modelValue","id"],jo=["for"],qo={key:1,class:"row"},zo=e("div",{class:"col-12"},[e("p",null,"Параметры скрипта еще не добавлены")],-1),Vo=[zo],Po={class:"btn btn-primary text-white w-100 mt-2 p-3"},Oo={key:0},Uo={key:1},Ao={props:["item"],components:{Vue3JsonEditor:se},data(){return{filters:[],simple:!0,configTypes:[{title:"Текстовый или числовой параметр",type:"text"},{title:"Большое текстовое поле",type:"large-text"},{title:"Канал обратной связи",type:"channel"},{title:"Логический оператор",type:"boolean"},{title:"Ссылка на изображение",type:"image"},{title:"Цвет",type:"color"},{title:"Geo",type:"geo"},{title:"Номер телефона",type:"phone"},{title:"ID скрипта",type:"script"},{title:"ID страницы",type:"page"},{title:"JSON",type:"json"}],bot:null,photos:[],slugForm:{bot_id:null,id:null,command:null,comment:null,slug:null,parent_id:null,config:[],is_global:!0}}},computed:{...C(["getCurrentBot"]),filteredConfigs(){return this.filters.length==0?this.slugForm.config:this.slugForm.config.filter(s=>this.filters.indexOf(s.type)>=0)}},mounted(){this.loadCurrentBot(),this.item&&(this.slugForm.id=this.item.id||null,this.slugForm.command=this.item.command,this.slugForm.comment=this.item.comment,this.slugForm.bot_id=this.item.bot_id,this.slugForm.slug=this.item.slug,this.slugForm.parent_id=this.item.parent_id||null,this.slugForm.config=this.item.config||[],this.slugForm.is_global=this.item.is_global||!1)},methods:{loadSlugParentParams(){this.$store.dispatch("loadSlugParams",{parentSlugId:this.slugForm.parent_id?this.slugForm.parent_id:this.slugForm.id}).then(s=>{let t=s.config,o=0;t.forEach(n=>{this.slugForm.config.findIndex(d=>d.key===n.key)===-1&&(o++,this.slugForm.config.unshift(n))}),this.$notify({title:"Конструктор команд",text:`Параметры успешно подгружены: Обновлено ${o} параметров`,type:"success"})})},toggleFilter(s){let t=this.filters.indexOf(s);t>=0?this.filters.splice(t,1):this.filters.push(s)},addTextTo(s,t={text:null}){this.slugForm.config[s].value=t.text},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},submit(){let s=new FormData;Object.keys(this.slugForm).forEach(t=>{const o=this.slugForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.$store.dispatch(this.slugForm.id===null?"createSlug":"updateSlug",{slugForm:s}).then(t=>{this.$notify({title:"Конструктор команд",text:"Команда успешно обновлена",type:"success"}),this.slugForm.id===null&&(this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0),this.$emit("callback")}).catch(t=>{})},onJsonChange(s,t){this.filteredConfigs[t].value=s},addConfig(s){this.slugForm.config.splice(0,0,{key:null,value:null,type:s||"text"})},move(s,t=0){let o=this.slugForm.config[s],n=this.slugForm.config.length||0,a=t===0?s-1>=0?s-1:n-1:s<n-1?s+1:0;this.slugForm.config[s]=this.slugForm.config[a],this.slugForm.config[a]=o},removeConfigItem(s){try{this.slugForm.config.splice(s,1)}catch{this.slugForm.config=[]}},selectSlug(s,t){this.filteredConfigs[t].value=s.id},selectPhoto(s,t){this.filteredConfigs[t].value=s.file_id}}},ae=Object.assign(Ao,{__name:"SlugTableForm",setup(s){return(t,o)=>{const n=Q("mask");return l(),i("form",{onSubmit:o[4]||(o[4]=S((...a)=>t.submit&&t.submit(...a),["prevent"]))},[e("div",Lt,[c(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=a=>t.slugForm.command=a),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[h,t.slugForm.command]]),Kt]),e("div",Nt,[c(e("input",{type:"text","onUpdate:modelValue":o[1]||(o[1]=a=>t.slugForm.slug=a),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[h,t.slugForm.slug]]),Jt]),e("div",Yt,[c(e("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=a=>t.slugForm.comment=a),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[h,t.slugForm.comment]]),Ht]),Gt,Wt,e("div",Xt,[Zt,e("ul",xt,[(l(!0),i(g,null,y(t.configTypes,(a,d)=>(l(),i("li",null,[e("a",{class:"dropdown-item",onClick:_=>t.addConfig(a.type)},u(a.title||"Не установлен"),9,es)]))),256))])]),e("div",ts,[e("div",ss,[e("p",null,[m("Фильтры: "),(l(!0),i(g,null,y(t.configTypes,(a,d)=>(l(),i("span",{class:b(["badge mb-1 bg-gray-100 cursor-pointer mr-1",{"bg-info":t.filters.indexOf(a.type)>=0}]),onClick:_=>t.toggleFilter(a.type)},u(a.type),11,os))),256))]),ls,e("button",{type:"button",onClick:o[3]||(o[3]=(...a)=>t.loadSlugParentParams&&t.loadSlugParentParams(...a)),class:"btn btn-outline-info"},[is,m("Загрузить ")])])]),t.filteredConfigs.length>0?(l(),i("div",ns,[e("div",as,[e("table",ds,[rs,e("tbody",null,[(l(!0),i(g,null,y(t.filteredConfigs,(a,d)=>(l(),i(g,null,[e("tr",{class:b({"table-light":d%2===0})},[e("td",cs,[e("div",us,[e("div",ms,[_s,e("ul",hs,[e("li",null,[e("a",{class:"dropdown-item",onClick:_=>t.removeConfigItem(d),href:"javascript:void(0)"},[bs,m(" Удалить")],8,ps)]),e("li",null,[e("a",{class:"dropdown-item",onClick:_=>t.move(d,0),href:"javascript:void(0)"},[gs,m(" Вверх")],8,fs)]),e("li",null,[e("a",{class:"dropdown-item",onClick:_=>t.move(d,1),href:"javascript:void(0)"},[$s,m(" Вниз")],8,vs)])])]),t.filteredConfigs[d].description?(l(),i("p",{key:0,class:"mb-0 font-italic font-bold",innerHTML:t.filteredConfigs[d].description},null,8,ys)):(l(),i("p",ks,"без описания")),e("div",Fs,[e("button",ws,u(t.filteredConfigs[d].type),1),e("ul",Cs,[(l(!0),i(g,null,y(t.configTypes,_=>(l(),i("li",null,[e("a",{class:"dropdown-item",onClick:p=>t.filteredConfigs[d].type=_.type},u(_.title||a.type),9,Ss)]))),256))])])])])],2),e("tr",{class:b({"table-light":d%2===0})},[e("td",js,[e("div",qs,[c(e("input",{type:"text",class:"form-control","onUpdate:modelValue":_=>t.filteredConfigs[d].key=_,id:"field-input-key-"+d,placeholder:"name@example.com"},null,8,zs),[[h,t.filteredConfigs[d].key]]),e("label",{for:"field-input-key-"+d},"Ключ",8,Vs)])]),e("td",null,[t.filteredConfigs[d].type==="text"||t.filteredConfigs[d].type==="channel"?(l(),i("div",Ps,[c(e("input",{type:"text",class:"form-control",id:"field-input-"+d,"onUpdate:modelValue":_=>t.filteredConfigs[d].value=_,placeholder:"name@example.com"},null,8,Os),[[h,t.filteredConfigs[d].value]]),e("label",{for:"field-input-"+d},"Значение",8,Us)])):r("",!0),t.filteredConfigs[d].type==="boolean"?(l(),i("div",As,[c(e("input",{class:"form-check-input","onUpdate:modelValue":_=>t.filteredConfigs[d].value=_,type:"checkbox",value:"false",id:"filtered-config-"+d+"-checkbox"},null,8,Is),[[k,t.filteredConfigs[d].value]]),e("label",{class:"form-check-label",for:"filtered-config-"+d+"-checkbox"},u(t.filteredConfigs[d].value?"Включено":"Выключено"),9,Qs)])):r("",!0),t.filteredConfigs[d].type==="geo"?(l(),i("div",Ts,[c(e("input",{class:"form-control",placeholder:"##.######,##.######","onUpdate:modelValue":_=>t.filteredConfigs[d].value=_,type:"text",id:"filtered-config-"+d+"-geo"},null,8,Bs),[[n,"##.######,##.######"],[h,t.filteredConfigs[d].value]]),e("label",{for:"filtered-config-"+d+"-geo"},"Значение",8,Rs)])):r("",!0),t.filteredConfigs[d].type==="script"?(l(),i("button",{key:3,type:"button",class:"btn btn-outline-light text-primary w-100 py-3",onClick:_=>a.content_show=!a.content_show},[a.content_show?(l(),i("i",Es)):(l(),i("i",Ds)),a.content_show?(l(),i("span",Ks,"Скрыть выбор скриптов")):(l(),i("span",Ls,"Показать выбор скриптов"))],8,Ms)):r("",!0),t.filteredConfigs[d].type==="page"?(l(),i("button",{key:4,type:"button",class:"btn btn-outline-light text-primary w-100 py-3",onClick:_=>a.content_show=!a.content_show},[a.content_show?(l(),i("i",Ys)):(l(),i("i",Js)),a.content_show?(l(),i("span",Gs,"Скрыть выбор страницы")):(l(),i("span",Hs,"Показать выбор страницы"))],8,Ns)):r("",!0),t.filteredConfigs[d].type==="phone"?(l(),i("div",Ws,[c(e("input",{class:"form-control",placeholder:"+7(###)###-##-##","onUpdate:modelValue":_=>t.filteredConfigs[d].value=_,type:"text",id:"filtered-config-"+d+"-phone"},null,8,Xs),[[n,"+7(###)###-##-##"],[h,t.filteredConfigs[d].value]]),e("label",{for:"filtered-config-"+d+"-phone"},"Значение",8,Zs)])):r("",!0),t.filteredConfigs[d].type==="json"?(l(),i("button",{key:6,type:"button",class:"btn btn-outline-light text-primary w-100 py-3",onClick:_=>a.content_show=!a.content_show},[a.content_show?(l(),i("i",to)):(l(),i("i",eo)),a.content_show?(l(),i("span",oo,"Скрыть редактор JSON")):(l(),i("span",so,"Показать редактор JSON"))],8,xs)):r("",!0),t.filteredConfigs[d].type==="color"?(l(),i("div",lo,[c(e("input",{class:"form-control","onUpdate:modelValue":_=>t.filteredConfigs[d].value=_,type:"color",id:"filtered-config-"+d+"-color"},null,8,io),[[h,t.filteredConfigs[d].value]]),e("label",{for:"filtered-config-"+d+"-color"},[e("p",{style:ee({color:t.filteredConfigs[d].value})},"Цвет: "+u(t.filteredConfigs[d].value),5)],8,no)])):r("",!0),t.filteredConfigs[d].type==="large-text"?(l(),i("div",ao,[c(e("textarea",{class:"form-control",id:"field-input-"+d,"onUpdate:modelValue":_=>t.filteredConfigs[d].value=_,placeholder:"name@example.com"},`
                            `,8,ro),[[h,t.filteredConfigs[d].value]]),e("label",{for:"field-input-"+d},"Значение",8,co)])):r("",!0),t.filteredConfigs[d].type==="image"?(l(),i("button",{key:9,type:"button",class:"btn btn-outline-light text-primary w-100 py-3",onClick:_=>a.content_show=!a.content_show},[a.content_show?(l(),i("i",_o)):(l(),i("i",mo)),a.content_show?(l(),i("span",po,"Скрыть выбор изображений")):(l(),i("span",ho,"Показать выбор изображений"))],8,uo)):r("",!0)])],2),a.content_show?(l(),i("tr",{key:0,class:b({"table-light":d%2===0})},[e("td",bo,[t.filteredConfigs[d].type==="image"?(l(),i("div",fo,[c(e("input",{class:"form-control mb-2",id:"field-input-"+d,type:"text",disabled:"true","onUpdate:modelValue":_=>t.filteredConfigs[d].value=_,placeholder:"name@example.com"},null,8,go),[[h,t.filteredConfigs[d].value]]),e("label",{for:"field-input-"+d},"FileId ссылка на изображение",8,vo),f(V,{"need-video":!1,"need-photo":!0,selected:[t.filteredConfigs[d].value],onSelect:_=>t.selectPhoto(_,d)},null,8,["selected","onSelect"])])):r("",!0),t.filteredConfigs[d].type==="json"?(l(),i("div",$o,[yo,f(M(se),{mode:"form",modelValue:t.filteredConfigs[d].value,"onUpdate:modelValue":_=>t.filteredConfigs[d].value=_,"show-btns":!1,expandedOnStart:!0,onJsonChange:_=>t.onJsonChange(_,d)},null,8,["modelValue","onUpdate:modelValue","onJsonChange"])])):r("",!0),t.filteredConfigs[d].type==="page"?(l(),i("div",ko,[c(e("input",{class:"form-control mb-2","onUpdate:modelValue":_=>t.filteredConfigs[d].value=_,type:"text",id:"filtered-config-"+d+"-script"},null,8,Fo),[[h,t.filteredConfigs[d].value]]),e("label",{for:"filtered-config-"+d+"-script"},"Значение",8,wo),f(B,{selected:[t.filteredConfigs[d].value],onCallback:_=>t.selectSlug(_,d),editor:!1},null,8,["selected","onCallback"])])):r("",!0),t.filteredConfigs[d].type==="script"?(l(),i("div",Co,[c(e("input",{class:"form-control mb-2","onUpdate:modelValue":_=>t.filteredConfigs[d].value=_,type:"text",id:"filtered-config-"+d+"-script"},null,8,So),[[h,t.filteredConfigs[d].value]]),e("label",{for:"filtered-config-"+d+"-script"},"Значение",8,jo),f(Et,{onSelect:_=>t.selectSlug(_,d)},null,8,["onSelect"])])):r("",!0)])],2)):r("",!0)],64))),256))])])])])):(l(),i("div",qo,Vo)),e("button",Po,[t.slugForm.id==null?(l(),i("span",Oo," Сохранить команду ")):(l(),i("span",Uo," Обновить команду "))])],32)}}});const Io={class:"card-header d-flex justify-content-between align-items-center"},Qo={class:"d-flex"},To=e("i",{class:"fa-solid fa-arrow-left"},null,-1),Bo=[To],Ro={class:"dropdown"},Mo=e("i",{class:"fa-solid fa-ellipsis"},null,-1),Do=[Mo],Eo={class:"dropdown-menu"},Lo=["data-bs-target"],Ko=e("i",{class:"fa-regular fa-pen-to-square mr-1"},null,-1),No=e("i",{class:"fa-solid fa-clone mr-1"},null,-1),Jo=e("i",{class:"fa-regular fa-trash-can text-danger mr-1"},null,-1),Yo={key:0,class:"fa-solid fa-arrow-up-short-wide"},Ho={key:1,class:"fa-solid fa-arrow-down-short-wide"},Go={class:"card-body"},Wo={class:"row"},Xo={class:"col-12"},Zo={key:0},xo={key:1,class:"list-group list-group-numbered"},el={class:"list-group-item d-flex justify-content-between align-items-start"},tl={class:"ms-2 me-auto"},sl=e("div",{class:"fw-bold"},"Идентификатор",-1),ol={class:"list-group-item d-flex justify-content-between align-items-start"},ll={class:"ms-2 me-auto"},il=e("div",{class:"fw-bold"},"Команда",-1),nl={class:"list-group-item d-flex justify-content-between align-items-start"},al={class:"ms-2 me-auto"},dl=e("div",{class:"fw-bold"},"Мнемоническое имя",-1),rl={class:"list-group-item d-flex justify-content-between align-items-start"},cl={class:"ms-2 me-auto"},ul=e("div",{class:"fw-bold"},"Пояснение",-1),ml={key:0,class:"list-group-item d-flex justify-content-between align-items-start"},_l={class:"ms-2 me-auto"},hl=e("div",{class:"fw-bold"},"Набор параметров скрипта",-1),pl={key:1,class:"list-group-item d-flex justify-content-between align-items-start"},bl=e("div",{class:"ms-2 me-auto"},[e("div",{class:"fw-bold"},"Привязана страница")],-1),fl=[bl],gl={key:2,class:"list-group-item d-flex justify-content-between align-items-start"},vl=e("div",{class:"ms-2 me-auto"},[e("div",{class:"fw-bold"},"Глобальный скрипт")],-1),$l=[vl],yl={class:"list-group-item d-flex justify-content-between align-items-start"},kl={class:"ms-2 me-auto w-100"},Fl=e("div",{class:"fw-bold"},"Перенести данные из:",-1),wl=e("option",{value:null},"Не выбрано",-1),Cl=["value"],Sl=e("p",{class:"my-2"},[e("em",null,"Перенос данных затирает текущие данные в данном скрипте")],-1),jl=["disabled"],ql=["id"],zl={class:"modal-dialog modal-fullscreen"},Vl={class:"modal-content"},Pl={class:"modal-header"},Ol={class:"modal-title",id:"exampleModalLabel"},Ul=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Al={class:"modal-body"},Il=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),Ql={props:["item","bot","selectMode","isActive"],data(){return{selected_slug_id:null,slugs:[],load:!1,simple:!0}},watch:{simple:function(){this.simple||this.loadAllSlugs()}},mounted(){},methods:{selectCard(){this.$emit("select",this.item)},slugFormCallback(){this.load=!0,this.$emit("callback"),this.$nextTick(()=>{this.load=!1})},editSlug(){this.load=!0,this.$nextTick(()=>{this.load=!1})},selectSlug(){this.load=!0,this.$emit("select",this.item),this.$nextTick(()=>{this.load=!1})},duplicateSlug(){this.load=!0,this.$store.dispatch("duplicateSlug",{dataObject:{slugId:this.item.id}}).then(s=>{this.$notify({title:"Конструктор команд",text:"Команда успешно продублирована",type:"success"}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}).catch(s=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})},submitRelocateData(){this.$store.dispatch("relocateSlugActionData",{slug_sender_id:this.selected_slug_id,slug_recipient_id:this.item.id,bot_id:this.bot.id}).then(s=>{this.$notify({title:"Конструктор команд",text:"Данные команды успешно перенесены",type:"success"})}).catch(s=>{this.$notify({title:"Конструктор команд",text:"Ошибка переноса данных",type:"error"})})},loadAllSlugs(){this.$store.dispatch("loadAllSlugs",{botId:this.bot.id}).then(s=>{this.slugs=s.data})},removeSlug(){this.load=!0,this.$store.dispatch("removeSlug",{dataObject:{slugId:this.item.id}}).then(s=>{this.$notify({title:"Конструктор команд",text:"Команда успешно удалена",type:"success"}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}).catch(s=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})})}}},Tl=Object.assign(Ql,{__name:"Slug",setup(s){return(t,o)=>(l(),i(g,null,[e("div",{class:b(["card",{"deprecated-slug":s.item.deprecated_at!=null,"global-slug":s.item.is_global,"bg-success text-white":s.isActive}])},[e("div",Io,[e("div",Qo,[e("button",{onClick:o[0]||(o[0]=(...n)=>t.selectSlug&&t.selectSlug(...n)),type:"button",title:"Выбрать команду",class:b(["btn btn-outline-primary mr-2",{"text-white":s.isActive}])},Bo,2),e("div",Ro,[e("button",{class:b([{"text-white border-white":s.isActive},"btn btn-outline-secondary"]),type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Do,2),e("ul",Eo,[e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:o[1]||(o[1]=(...n)=>t.editSlug&&t.editSlug(...n)),"data-bs-toggle":"modal","data-bs-target":"#edit-slug-"+s.item.id},[Ko,m(" Редактировать")],8,Lo)]),e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:o[2]||(o[2]=(...n)=>t.duplicateSlug&&t.duplicateSlug(...n))},[No,m(" Дублировать")])]),e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:o[3]||(o[3]=(...n)=>t.removeSlug&&t.removeSlug(...n))},[Jo,m(" Удалить")])])])])]),e("span",null,[e("small",null,[e("strong",null,"#"+u(s.item.id),1)])]),e("button",{type:"button",onClick:o[4]||(o[4]=n=>t.simple=!t.simple),class:b([{"text-white border-white":s.isActive},"btn btn-outline-primary ml-2"])},[t.simple?(l(),i("i",Yo)):(l(),i("i",Ho))],2)]),e("div",Go,[e("div",Wo,[e("div",Xo,[t.simple?(l(),i("p",Zo,u(s.item.command||"Нет команды"),1)):(l(),i("ol",xo,[e("li",el,[e("div",tl,[sl,m(" №"+u(s.item.id||"Нет идентификатора"),1)])]),e("li",ol,[e("div",ll,[il,m(" "+u(s.item.command||"Нет команды"),1)])]),e("li",nl,[e("div",al,[dl,m(" "+u(s.item.slug||"Slug"),1)])]),e("li",rl,[e("div",cl,[ul,m(" "+u(s.item.comment||"Пояснение не указано"),1)])]),s.item.config?(l(),i("li",ml,[e("div",_l,[hl,s.item.config?(l(!0),i(g,{key:0},y(s.item.config,n=>(l(),i("p",null,[e("strong",null,u(n.key||"Ключ не найден")+":",1),m(u(n.value||"Не указано"),1)]))),256)):r("",!0)])])):r("",!0),s.item.page?(l(),i("li",pl,fl)):r("",!0),s.item.is_global?(l(),i("li",gl,$l)):r("",!0),e("li",yl,[e("div",kl,[e("form",{onSubmit:o[6]||(o[6]=S((...n)=>t.submitRelocateData&&t.submitRelocateData(...n),["prevent"]))},[Fl,c(e("select",{class:"form-control w-100","onUpdate:modelValue":o[5]||(o[5]=n=>t.selected_slug_id=n),required:""},[wl,(l(!0),i(g,null,y(t.slugs,n=>(l(),i("option",{value:n.id},"#"+u(n.id)+" "+u(n.slug||"Не указан"),9,Cl))),256))],512),[[I,t.selected_slug_id]]),Sl,e("button",{disabled:t.selected_slug_id==null,class:"btn btn-outline-warning w-100"}," Выполнить перенос ",8,jl)],32)])])]))])])])],2),e("div",{class:"modal fade",id:"edit-slug-"+s.item.id,tabindex:"-1"},[e("div",zl,[e("div",Vl,[e("div",Pl,[e("h5",Ol,[m("Редактирование команды #"),e("span",null,u(s.item.id),1)]),Ul]),e("div",Al,[t.load?r("",!0):(l(),$(ae,{key:0,item:s.item,onCallback:t.slugFormCallback},null,8,["item","onCallback"]))]),Il])])],8,ql)],64))}}),Bl={key:0,class:"row"},Rl={class:"col-12 mb-2"},Ml={key:0},Dl=e("i",{class:"fa-solid fa-scroll"},null,-1),El={key:1},Ll=e("i",{class:"fa-regular fa-square-minus"},null,-1),Kl={key:0,class:"col-12"},Nl={class:"col-12"},Jl={class:"form-floating mb-3"},Yl=e("label",{for:"floatingInput"},"Быстрый поиск команды",-1),Hl={class:"col-12 mb-2"},Gl={class:"form-check"},Wl={class:"form-check-label",for:"need_global"},Xl={key:0},Zl={key:1},xl={class:"form-check"},ei=e("label",{class:"form-check-label",for:"need_show_deleted"}," Удаленные ",-1),ti={key:1,class:"mb-3 col-12 col-sm-12"},si={class:"table"},oi=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"Команда"),e("th",{scope:"col"},"Пояснение"),e("th",{scope:"col"},"Глобальный"),e("th",{scope:"col"},"Действия")])],-1),li=["onClick"],ii={key:0},ni=e("i",{class:"fa-solid fa-check text-success"},null,-1),ai=[ni],di={key:1},ri=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),ci=[ri],ui={class:"dropdown"},mi=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),_i={class:"dropdown-menu"},hi={key:0},pi=["onClick"],bi=e("i",{class:"fa-solid fa-arrow-left mr-1"},null,-1),fi={key:1},gi=["onClick"],vi=e("a",{class:"dropdown-item cursor-pointer","data-bs-toggle":"modal","data-bs-target":"#edit-table-slug"},[e("i",{class:"fa-regular fa-pen-to-square mr-1"}),m(" Редактировать")],-1),$i=[vi],yi=["onClick"],ki=e("i",{class:"fa-solid fa-clone mr-1"},null,-1),Fi=["href"],wi=e("i",{class:"fa-regular fa-file-excel mr-1"},null,-1),Ci={key:2},Si=["onClick"],ji=e("i",{class:"fa-regular fa-trash-can text-danger mr-1"},null,-1),qi={key:3},zi=["onClick"],Vi=e("i",{class:"fa-regular fa-trash-can text-danger mr-1"},null,-1),Pi={key:3,class:"mb-3 col-md-12"},Oi=e("div",{class:"alert alert-danger",role:"alert"}," У Вас еще нет добавленных скриптов! ",-1),Ui=[Oi],Ai={class:"modal fade",id:"edit-table-slug",tabindex:"-1"},Ii={class:"modal-dialog modal-fullscreen"},Qi={key:0,class:"modal-content"},Ti={class:"modal-header"},Bi={class:"modal-title",id:"exampleModalLabel"},Ri=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Mi={class:"modal-body"},Di={class:"row"},Ei={class:"col-12"},Li=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),Ki={props:["selected","command","canSelect"],data(){return{bot:null,relocated_slug_id:null,need_global:!0,need_show_deleted:!0,show:!1,load:!1,slugs:[],paginate:[],selectedSlug:null,ownSearch:null,slugForm:{command:null,comment:null,slug:null}}},watch:{ownSearch:function(s,t){this.loadSlugs()},need_global:function(s,t){this.loadSlugs()},need_show_deleted:function(s,t){this.loadSlugs()}},computed:{...C(["getCurrentBot","getSlugs","getSlugsPaginateObject"])},mounted(){this.loadCurrentBot().then(()=>{this.loadSlugs(),this.command&&this.$nextTick(()=>{this.slugForm.command=this.command})})},methods:{nextSlugs(s){this.loadSlugs(s)},loadSlugs(s=0){return console.log("selected",this.selected),this.$store.dispatch("loadSlugs",{dataObject:{botId:this.bot.id,needGlobal:this.need_global,needDeleted:this.need_show_deleted,search:this.ownSearch||null},page:s}).then(t=>{this.slugs=this.getSlugs,this.paginate=this.getSlugsPaginateObject})},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},callbackSlugs(){this.loadSlugs()},selectSlug(s){this.load=!0,this.$nextTick(()=>{this.selectedSlug=s,this.load=!1}),this.$emit("select",s)},selectCard(){this.$emit("select",this.item)},slugFormCallback(){this.load=!0;const s=this.selectedSlug;this.loadSlugs().then(()=>{let t=this.slugs.find(o=>o.id===s.id);this.selectSlug(t||null)}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})},editSlug(){this.load=!0,this.$nextTick(()=>{this.load=!1})},duplicateSlug(s){this.load=!0,this.$store.dispatch("duplicateSlug",{dataObject:{slugId:s.id}}).then(t=>{this.$notify({title:"Конструктор команд",text:"Команда успешно продублирована",type:"success"}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}).catch(t=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}),this.loadSlugs(),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})},submitRelocateData(){this.$store.dispatch("relocateSlugActionData",{slug_sender_id:this.relocated_slug_id,slug_recipient_id:this.item.id,bot_id:this.bot.id}).then(s=>{this.$notify({title:"Конструктор команд",text:"Данные команды успешно перенесены",type:"success"})}).catch(s=>{this.$notify({title:"Конструктор команд",text:"Ошибка переноса данных",type:"error"})})},restoreSlug(s){this.load=!0,this.$store.dispatch("restoreSlug",{dataObject:{slugId:s.id}}).then(t=>{this.$notify({title:"Конструктор команд",text:"Команда успешно восстановлена",type:"success"}),this.loadSlugs(),this.$nextTick(()=>{this.load=!1})}).catch(t=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})})},removeSlug(s){this.load=!0,this.$store.dispatch("removeSlug",{dataObject:{slugId:s.id}}).then(t=>{this.$notify({title:"Конструктор команд",text:"Команда успешно удалена",type:"success"}),this.loadSlugs()}).catch(t=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})})}}},Ni=Object.assign(Ki,{__name:"BotSlugTableList",setup(s){return(t,o)=>(l(),i(g,null,[t.bot?(l(),i("div",Bl,[e("div",Rl,[e("button",{type:"button",onClick:o[0]||(o[0]=n=>t.show=!t.show),class:"btn btn-outline-success p-3 w-100"},[t.show?(l(),i("span",El,[Ll,m(" Свернуть форму добавления")])):(l(),i("span",Ml,[Dl,m(" Добавить глобальный скрипт")]))])]),t.show?(l(),i("div",Kl,[t.bot?(l(),$(le,{key:0,"can-add":!0,bot:t.bot,onCallback:t.loadSlugs},null,8,["bot","onCallback"])):r("",!0)])):r("",!0),e("div",Nl,[e("div",Jl,[c(e("input",{type:"search","onUpdate:modelValue":o[1]||(o[1]=n=>t.ownSearch=n),class:"form-control",id:"floatingInput",placeholder:"name@example.com"},null,512),[[h,t.ownSearch]]),Yl])]),e("div",Hl,[e("div",Gl,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[2]||(o[2]=n=>t.need_global=n),type:"checkbox",id:"need_global"},null,512),[[k,t.need_global]]),e("label",Wl,[t.need_global?(l(),i("span",Xl,"Глобальные")):(l(),i("span",Zl,"Локальные"))])]),e("div",xl,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[3]||(o[3]=n=>t.need_show_deleted=n),type:"checkbox",id:"need_show_deleted"},null,512),[[k,t.need_show_deleted]]),ei])]),t.slugs&&t.bot?(l(),i("div",ti,[e("table",si,[oi,e("tbody",null,[(l(!0),i(g,null,y(t.slugs,(n,a)=>(l(),i("tr",{class:b({"border-info":n.deleted_at==null,"border-danger":n.deleted_at!=null})},[e("th",{scope:"row",class:b({"text-danger":n.deleted_at!=null})},u(n.id||"Нет идентификатора"),3),e("td",{onClick:d=>t.selectSlug(n),"data-bs-toggle":"modal","data-bs-target":"#edit-table-slug",class:b({"text-danger":n.deleted_at!=null})},u(n.command||"Нет команды"),11,li),e("td",{class:b({"text-danger":n.deleted_at!=null})},u(n.comment||"Пояснение не указано"),3),e("td",null,[n.is_global?(l(),i("span",ii,ai)):(l(),i("span",di,ci))]),e("td",null,[e("div",ui,[mi,e("ul",_i,[s.canSelect?(l(),i("li",hi,[e("a",{onClick:d=>t.selectSlug(n),title:"Выбрать команду",class:"dropdown-item cursor-pointer"},[bi,m(" Выбрать команду ")],8,pi)])):r("",!0),s.canSelect?(l(),i("hr",fi)):r("",!0),e("li",{onClick:d=>t.selectSlug(n)},$i,8,gi),e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:d=>t.duplicateSlug(n)},[ki,m(" Дублировать")],8,yi)]),e("li",null,[e("a",{class:"dropdown-item cursor-pointer",target:"_blank",href:"/admin/slugs/action-data-export/"+n.id},[wi,m(" Скачать данные участников")],8,Fi)]),n.deleted_at==null?(l(),i("li",Ci,[e("a",{class:"dropdown-item cursor-pointer",onClick:d=>t.removeSlug(n)},[ji,m(" Удалить")],8,Si)])):r("",!0),n.deleted_at!=null?(l(),i("li",qi,[e("a",{class:"dropdown-item cursor-pointer",onClick:d=>t.restoreSlug(n)},[Vi,m(" Восстановить")],8,zi)])):r("",!0)])])])],2))),256))])])])):r("",!0),t.paginate?(l(),$(j,{key:2,onPagination_page:t.nextSlugs,pagination:t.paginate},null,8,["onPagination_page","pagination"])):r("",!0),t.slugs.length===0?(l(),i("div",Pi,Ui)):r("",!0)])):r("",!0),e("div",Ai,[e("div",Ii,[t.selectedSlug&&!t.load?(l(),i("div",Qi,[e("div",Ti,[e("h5",Bi,[m("Редактирование команды #"),e("span",null,u(t.selectedSlug.id),1)]),Ri]),e("div",Mi,[e("div",Di,[e("div",Ei,[f(ae,{item:t.selectedSlug,onCallback:t.slugFormCallback},null,8,["item","onCallback"])])])]),Li])):r("",!0)])])],64))}}),Ji={class:"row"},Yi={class:"col-12"},Hi=e("h6",null,"Добавление нового скрипта в бота",-1),Gi={key:0,class:"row"},Wi={class:"col-md-6 col-lg-4 col-sm-6 col-12 mb-2"},Xi={key:1,class:"row"},Zi=e("div",{class:"col-12"},[e("div",{class:"alert alert-danger",role:"alert"},' У Вас еще нет добавленных скриптов! Воспользуйтесь разделом "Скрипты" для добавления. ')],-1),xi=[Zi],en={props:["bot","global","selected"],data(){return{load:!1,search:null,slugs:[],paginate:[]}},computed:{...C(["getSlugs","getSlugsPaginateObject"]),filteredSlugs(){return this.slugs?this.slugs.length===0?[]:this.search==null?this.slugs:this.slugs.filter(s=>{let t=s.slug||"",o=s.command||"",n=s.comment||"";return o.toLowerCase().indexOf(this.search.toLowerCase())!==-1||n.toLowerCase().indexOf(this.search.toLowerCase())!==-1||t.toLowerCase().indexOf(this.search.toLowerCase())!==-1}):[]}},mounted(){this.loadSlugs()},methods:{nextSlugs(s){this.loadSlugs(s)},selectSlug(s){this.$emit("callback",{id:s.id||null,slug:s.slug,comment:s.comment,command:s.command}),this.$notify("Вы выбрали скрипт из списка!")},loadSlugs(s=0){this.$store.dispatch("loadSlugs",{dataObject:{botId:this.bot.id,search:this.search||(this.selected||[]).length>0?this.selected[0]:null,needGlobal:this.global},page:s}).then(t=>{this.slugs=this.getSlugs,this.paginate=this.getSlugsPaginateObject})},callbackSlugs(){}}},tn=Object.assign(en,{__name:"BotSlugListSimple",setup(s){return(t,o)=>(l(),i("div",Ji,[e("div",Yi,[Hi,e("div",null,[c(e("input",{type:"text",class:"form-control mt-1 mb-1","onUpdate:modelValue":o[0]||(o[0]=n=>t.search=n),onKeyup:o[1]||(o[1]=(...n)=>t.loadSlugs&&t.loadSlugs(...n)),placeholder:"Поиск нужного скрипта по описанию"},null,544),[[h,t.search]])]),t.slugs.length>0?(l(),i("div",Gi,[(l(!0),i(g,null,y(t.slugs,(n,a)=>(l(),i("div",Wi,[f(Tl,{"is-active":(s.selected||[]).indexOf(n.id)!=-1,item:n,bot:s.bot,onCallback:t.callbackSlugs,onSelect:t.selectSlug},null,8,["is-active","item","bot","onCallback","onSelect"])]))),256)),t.paginate?(l(),$(j,{key:0,onPagination_page:t.nextSlugs,pagination:t.paginate},null,8,["onPagination_page","pagination"])):r("",!0)])):(l(),i("div",Xi,xi))])]))}});const sn={props:["param"],data(){return{expressions:[{expression:null,description:"Нет проверки"},{expression:"/([a-z0-9]+)/i",description:"Проверка набора из латинских букв и цифр"},{expression:"/([а-яё0-9]+)/iu",description:"Проверка на кириллицу и цифры"},{expression:"/(?P<digit>\\d+)/",description:"Проверка на число"},{expression:"/^([a-z0-9_-]+.)*[a-z0-9_-]+@[a-z0-9_-]+(.[a-z0-9_-]+)*.[a-z]{2,6}$/",description:"Проверка Email"},{expression:"/^((8|+7)[- ]?)?((?d{3})?[- ]?)?[d- ]{7,10}$/",description:"Проверка номера телефона: +7(982)000-00-00"},{expression:"/^(0[1-9]|[12][0-9]|3[01])[.](0[1-9]|1[012])[.](19|20)dd$/",description:"Проверка даты по формату DD.MM.YYYY"},{expression:"/^[0-9]{4}-(0[1-9]|1[012])-(0[1-9]|1[0-9]|2[0-9]|3[01])$/",description:"Проверка даты по формату YYYY-MM-DD"},{expression:"/^(https?://)?([da-z.-]+).([a-z.]{2,6})([/w .-]*)*/?$/",description:"Проверка доменного имени"}]}},methods:{expressionsSelect(s){this.$emit("callback",{param:this.param,text:s.expression})}}},on={class:"dropdown"},ln=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-regular fa-registered"})],-1),nn={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},an=["onClick"];function dn(s,t,o,n,a,d){return l(),i("div",on,[ln,e("div",nn,[e("li",null,[(l(!0),i(g,null,y(a.expressions,_=>(l(),i("a",{class:"dropdown-item",onClick:p=>d.expressionsSelect(_)},u(_.description||"-"),9,an))),256))])])])}const rn=O(sn,[["render",dn]]),cn={class:"row mt-2"},un={class:"col-12 d-flex justify-content-between align-items-center"},mn=["onClick"],_n={class:"row mb-2"},hn={class:"col-3"},pn={class:"form-floating"},bn=["onUpdate:modelValue"],fn=e("label",{for:"floatingInput"},"Значение параметра 1",-1),gn={class:"col-3"},vn={class:"form-floating"},$n=["onUpdate:modelValue"],yn=e("option",{value:null,selected:""},"без действия",-1),kn=["value"],Fn=e("label",{for:"floatingSelect"},"Доступные операции",-1),wn={class:"col-3"},Cn={class:"form-floating"},Sn=["onUpdate:modelValue"],jn=e("label",{for:"floatingInput"},"Значение параметра 2",-1),qn={class:"col-3"},zn={class:"form-floating"},Vn=["disabled","onUpdate:modelValue"],Pn=e("label",{for:"floatingInput"},"Переменная результата",-1),On=e("div",{class:"row"},[e("div",{class:"col-6"},[e("h6",null,"Если условие выполнено")]),e("div",{class:"col-6"},[e("h6",null,[m("Если условие "),e("span",{class:"text-danger"},"не"),m(" выполнено")])])],-1),Un={class:"row"},An={class:"col-6"},In={class:"form-floating mb-3"},Qn=["onUpdate:modelValue"],Tn=e("label",{for:"floatingInput"},"Текст для пользователя",-1),Bn={class:"col-6"},Rn={class:"form-floating mb-3"},Mn=["onUpdate:modelValue"],Dn=e("label",{for:"floatingInput"},"Текст для пользователя",-1),En={class:"row"},Ln={class:"col-6"},Kn={class:"form-check mb-2"},Nn=["onUpdate:modelValue","id"],Jn=["for"],Yn={class:"col-6"},Hn={class:"form-check mb-2"},Gn=["onUpdate:modelValue","id"],Wn=["for"],Xn={key:1,class:"alert alert-primary d-flex align-items-center mt-2",role:"alert"},Zn=e("i",{class:"fa-solid fa-triangle-exclamation mr-2"},null,-1),xn=e("div",null," Правила не добавлены ",-1),ea=[Zn,xn],ta={props:["modelValue"],data(){return{rules:[],operations:[{id:0,title:"Выдать результат без обработки"},{id:1,title:"Больше"},{id:2,title:"Меньше"},{id:3,title:"Равно"},{id:4,title:"Не равно"},{id:5,title:"Сложить"},{id:6,title:"Вычесть"},{id:7,title:"Логическое И"},{id:8,title:"Логическое ИЛИ"}]}},mounted(){this.modelValue&&(this.rules=this.modelValue)},methods:{addRule(){this.rules.push({param1:null,operation:null,param2:null,use_result_as:null,text_if_true:null,text_if_false:null,keyboard_if_true:null,keyboard_if_false:null,need_keyboard_if_true:!1,need_keyboard_if_false:!1}),this.$notify({title:"Конструктор ботов",text:"Успешная создано новое правило",type:"success"}),this.$emit("update:modelValue",this.rules)},testRule(s){let t=this.rules[s];return t.operation===5||t.operation===6},removeRule(s){this.rules.splice(s,1),this.$notify({title:"Конструктор ботов",text:"Успешная удалено выбранное правило",type:"success"})},saveInlineKeyboard(s,t,o){this.rules[t]["keyboard_if_"+(o?"true":"false")]=s}}},sa=Object.assign(ta,{__name:"BotDialogResultRules",setup(s){return(t,o)=>(l(),i(g,null,[e("button",{type:"button",onClick:o[0]||(o[0]=(...n)=>t.addRule&&t.addRule(...n)),class:"btn btn-outline-info"},"Добавить правило "),t.rules.length>0?(l(!0),i(g,{key:0},y(t.rules,(n,a)=>(l(),i(g,null,[e("div",cn,[e("div",un,[e("h6",null,"Шаг "+u(a+1),1),e("button",{onClick:d=>t.removeRule(a),type:"button",class:"btn btn-link"},"удалить правило ",8,mn)])]),e("div",_n,[e("div",hn,[e("div",pn,[c(e("input",{type:"text",class:"form-control","onUpdate:modelValue":d=>t.rules[a].param1=d,id:"floatingInput",placeholder:"name@example.com"},null,8,bn),[[h,t.rules[a].param1]]),fn])]),e("div",gn,[e("div",vn,[c(e("select",{class:"form-select","onUpdate:modelValue":d=>t.rules[a].operation=d,id:"floatingSelect","aria-label":"Floating label select example"},[yn,(l(!0),i(g,null,y(t.operations,d=>(l(),i("option",{value:d.id},u(d.title||"-"),9,kn))),256))],8,$n),[[I,t.rules[a].operation]]),Fn])]),e("div",wn,[e("div",Cn,[c(e("input",{type:"text","onUpdate:modelValue":d=>t.rules[a].param2=d,class:"form-control",id:"floatingInput",placeholder:"name@example.com"},null,8,Sn),[[h,t.rules[a].param2]]),jn])]),e("div",qn,[e("div",zn,[c(e("input",{type:"text",disabled:!t.testRule(a),"onUpdate:modelValue":d=>t.rules[a].use_result_as=d,class:"form-control",id:"floatingInput",placeholder:"name@example.com"},null,8,Vn),[[h,t.rules[a].use_result_as]]),Pn])])]),On,e("div",Un,[e("div",An,[e("div",In,[c(e("input",{type:"text","onUpdate:modelValue":d=>t.rules[a].text_if_true=d,class:"form-control",id:"floatingInput",placeholder:"name@example.com"},null,8,Qn),[[h,t.rules[a].text_if_true]]),Tn])]),e("div",Bn,[e("div",Rn,[c(e("input",{type:"text","onUpdate:modelValue":d=>t.rules[a].text_if_false=d,class:"form-control",id:"floatingInput",placeholder:"name@example.com"},null,8,Mn),[[h,t.rules[a].text_if_false]]),Dn])])]),e("div",En,[e("div",Ln,[e("div",Kn,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":d=>t.rules[a].need_keyboard_if_true=d,id:"need-keyboard-if-true-"+a},null,8,Nn),[[k,t.rules[a].need_keyboard_if_true]]),e("label",{class:"form-check-label",for:"need-keyboard-if-true-"+a}," Нужна клавиатура ",8,Jn)]),t.rules[a].need_keyboard_if_true?(l(),$(A,{key:0,type:"inline",onSave:d=>t.saveInlineKeyboard(d,a,!0),"edited-keyboard":t.rules[a].keyboard_if_true},null,8,["onSave","edited-keyboard"])):r("",!0)]),e("div",Yn,[e("div",Hn,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":d=>t.rules[a].need_keyboard_if_false=d,id:"need-keyboard-if-false-"+a},null,8,Gn),[[k,t.rules[a].need_keyboard_if_false]]),e("label",{class:"form-check-label",for:"need-keyboard-if-false-"+a}," Нужна клавиатура ",8,Wn)]),t.rules[a].need_keyboard_if_false?(l(),$(A,{key:0,type:"inline",onSave:d=>t.saveInlineKeyboard(d,a,!1),"edited-keyboard":t.rules[a].keyboard_if_false},null,8,["onSave","edited-keyboard"])):r("",!0)])])],64))),256)):(l(),i("div",Xn,ea))],64))}});const oa={props:["bot"],data(){return{search:null,variables:[]}},computed:{filteredVariable(){return this.search?this.variables.filter(s=>s.text.indexOf(this.search)!==-1):this.variables}},mounted(){this.loadVariables()},methods:{select(s){this.$emit("callback",s)},loadVariables(){this.$store.dispatch("loadDialogVariables",{bot_id:this.bot.id}).then(s=>{this.variables=s.data})}}},la={class:"dropdown"},ia=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-spell-check"})],-1),na={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},aa=e("div",{class:"dropdown-divider"},null,-1),da=["onClick"];function ra(s,t,o,n,a,d){return l(),i("div",la,[ia,e("div",na,[c(e("input",{type:"search",class:"form-control",id:"search-description-text","onUpdate:modelValue":t[0]||(t[0]=_=>a.search=_),placeholder:"Введите текст для поиска"},null,512),[[h,a.search]]),aa,(l(!0),i(g,null,y(d.filteredVariable,(_,p)=>(l(),i("p",{class:"p-1 text-left w-100 mb-1",onClick:F=>d.select(_)},u(_),9,da))),256))])])}const ca=O(oa,[["render",ra]]),ua={class:"mb-2 px-0"},ma={type:"submit",class:"btn btn-outline-success"},_a=e("i",{class:"fa-regular fa-floppy-disk mr-2"},null,-1),ha={key:0},pa={key:1},ba={class:"nav nav-tabs"},fa={class:"nav-item"},ga=e("i",{class:"fa-regular fa-comment-dots mr-2"},null,-1),va={class:"nav-item"},$a=e("i",{class:"fa-solid fa-link mr-2"},null,-1),ya={key:0,class:"nav-item"},ka=e("i",{class:"fa-brands fa-uncharted mr-2"},null,-1),Fa={key:1,class:"nav-item"},wa=e("i",{class:"fa-solid fa-hashtag mr-2"},null,-1),Ca={key:0,class:"py-2 px-0"},Sa={class:"form-check mb-2"},ja=["id"],qa=["for"],za={key:0,class:"form-check mb-2"},Va=["id"],Pa=["for"],Oa={key:1,class:"alert alert-info",role:"alert"},Ua={class:"form-floating mb-2"},Aa=["id"],Ia=["for"],Qa={key:2,class:"mb-2"},Ta={class:"form-floating"},Ba=e("label",{for:"floatingPassword"},"Сохранить ответ пользователя как внутреннюю переменную",-1),Ra={key:3,class:"form-check mb-2"},Ma=e("label",{class:"form-check-label",for:"need-custom-stored-value"}," Нужно изменить данные в переменной ",-1),Da={key:4,class:"mb-2"},Ea={class:"form-floating"},La=e("label",{for:"custom_stored_value"},"Поместить эти данные в результат",-1),Ka={key:5,class:"form-floating mb-2"},Na=["disabled","id"],Ja=["for"],Ya={key:1,class:"py-2 px-0"},Ha={class:"mb-2"},Ga={key:0,class:"row"},Wa=e("div",{class:"col-12"},[e("h6",null,"Выбрать следующий диалог:")],-1),Xa={key:0,class:"col-12 mb-2"},Za=e("i",{class:"fa-solid fa-arrows-rotate"},null,-1),xa={class:"col-md-12 mb-1"},ed={type:"button",class:"btn btn-outline-primary w-100 d-flex justify-content-between align-items-center",style:{"text-align":"left"}},td=["onClick"],sd={key:1,class:"row"},od=e("div",{class:"col-12"},[e("div",{class:"alert alert-danger",role:"alert"}," Диалогов для связывания нет ")],-1),ld=[od],id={key:2,class:"py-2 px-0"},nd={class:"form-check mb-2"},ad=e("label",{class:"form-check-label",for:"need-additional-functions"}," Нужен дополнительный функционал управления ",-1),dd={key:0,class:"form-floating mb-2"},rd=["id"],cd=["for"],ud={key:1,class:"mb-2"},md={class:"d-flex justify-content-between align-items-center"},_d=e("p",{class:"mb-2"},"Регулярное выражение для валидации данных ",-1),hd={class:"form-floating"},pd=["id"],bd=["for"],fd={key:2,class:"mb-2"},gd={class:"d-flex justify-content-between align-items-center"},vd=e("p",{class:"mb-2"},"Канал для отправки данных ",-1),$d={class:"form-floating"},yd=["id"],kd=["for"],Fd={key:3,class:"mb-2"},wd={class:"form-floating"},Cd=e("option",{selected:""},"Не выбрано",-1),Sd=["value"],jd=e("label",{for:"store_variants"},"Сохранить в переменную",-1),qd={class:"form-check mb-2"},zd=e("label",{class:"form-check-label",for:"need-dialog-image"}," В диалоге нужно изображение ",-1),Vd={key:4,class:"card mb-2"},Pd={class:"card-body"},Od=e("h6",null,"Фотографии к диалогу",-1),Ud={class:"photo-preview d-flex justify-content-start flex-wrap w-100"},Ad={for:"location-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},Id=e("span",null,"+",-1),Qd={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Td={class:"remove"},Bd=["onClick"],Rd={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Md={class:"remove"},Dd=["onClick"],Ed={class:"form-check mb-2"},Ld=e("label",{class:"form-check-label",for:"need-dialog-menu-inline"}," В диалоге нужно меню тексту ",-1),Kd={key:5,class:"card mb-2"},Nd=e("div",{class:"card-header"},[e("h6",null,"Кнопки к тексту вопроса")],-1),Jd={class:"card-body"},Yd={class:"form-check mb-2"},Hd=e("label",{class:"form-check-label",for:"need-dialog-menu-reply"}," В диалоге нужно нижнее меню ",-1),Gd={key:6,class:"card mb-2"},Wd=e("div",{class:"card-header"},[e("h6",null,"Кнопки в виде нижнего меню")],-1),Xd={class:"card-body"},Zd={class:"form-check mb-2"},xd=e("label",{class:"form-check-label",for:"need-chains"}," Нужны многоуровневые диалоги ",-1),er={key:7,class:"mb-2"},tr={key:0,class:"w-100 my-3",style:{"border-collapse":"separate","border-spacing":"5px 10px"}},sr=e("tr",{style:{"border-top":"1px #eaeaea solid"}},[e("td"),e("td"),e("td",null,[e("strong",null,"Ответ")]),e("td",null,[e("strong",null,"Следующий диалог")])],-1),or={style:{width:"40px"}},lr=["onClick"],ir=e("i",{class:"fa-solid fa-toggle-off cursor-pointer text-secondary"},null,-1),nr=[ir],ar=["onClick"],dr=e("i",{class:"fa-solid fa-toggle-on cursor-pointer text-primary"},null,-1),rr=[dr],cr={scope:"row"},ur={class:"form-floating"},mr=["onUpdate:modelValue"],_r=e("label",{for:"floatingInput"},"Точный текст ответа",-1),hr={class:"input-group"},pr={class:"form-floating"},br=["onUpdate:modelValue"],fr=e("label",{for:"floatingInput"},"Выберите\\введите диалог или введите его номер",-1),gr={class:"dropdown d-flex"},vr=e("button",{class:"btn btn-outline-secondary w-100",style:{"border-radius":"0px 5px 5px 0px"},"data-bs-auto-close":"outside",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-up-right-and-down-left-from-center"})],-1),$r={class:"dropdown-menu p-2",style:{width:"400px","max-height":"300px","overflow-y":"auto"}},yr={class:"list-group"},kr=["onClick"],Fr=["onClick"],wr={class:"px-3 pt-2"},Cr={class:"dropdown d-flex justify-content-center align-items-center"},Sr=e("button",{class:"btn btn-link",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-bars"})],-1),jr={class:"dropdown-menu"},qr=["onClick"],zr={key:0},Vr=e("td",null,null,-1),Pr=e("td",null,null,-1),Or={class:"input-group"},Ur={class:"form-floating"},Ar=["onUpdate:modelValue"],Ir=e("label",{for:"floatingInput"},"Шаблон предполагаемого текста",-1),Qr={class:"dropdown d-flex"},Tr=e("button",{class:"btn btn-outline-secondary w-100",style:{"border-radius":"0px 5px 5px 0px"},type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-up-right-and-down-left-from-center"})],-1),Br={class:"dropdown-menu"},Rr=["onClick"],Mr=["onClick"],Dr={class:"form-floating"},Er=["onUpdate:modelValue","id"],Lr=["for"],Kr={key:1,class:"alert alert-primary mt-2",role:"alert"},Nr={class:"form-check mb-2"},Jr=e("label",{class:"form-check-label",for:"need-set-flags"}," Установить флаги в соответствующее значение ",-1),Yr={key:8,class:"mb-2"},Hr=e("p",null,"Выбрать флаги",-1),Gr=["onClick"],Wr={key:3,class:"py-2 px-0"},Xr={props:["item","bot"],data(){return{tab:0,patterns:[{title:"Номер телефона РФ",value:"/^\\s?(\\+\\s?7|8)([- ()]*\\d){10}$/"},{title:"Дата в формате ДД/ММ/ГГГГ",value:"/(\\d{2})\\/(\\d{2})\\/(\\d{4})$/"},{title:"Время в формате ЧЧ:ММ[:СС]",value:"#^[01]?[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?$#"}],test:[],loading:!0,dialog_commands:[],dialog_commands_paginate_object:null,need_images:!1,need_inline_keyboard:!1,need_reply_keyboard:!1,need_custom_stored_value:!1,need_additional_functions:!1,need_chains:!1,need_set_flags:!1,flags_variants:[{title:"Является VIP",key:"is_vip",value:null},{title:"Является Админом",key:"is_admin",value:null},{title:"За работой",key:"is_work",value:null},{title:"Является менеджером",key:"is_manager",value:null}],store_variants:[{title:"Имя",key:"name"},{title:"Почта",key:"email"},{title:"Возраст",key:"age"},{title:"Город",key:"city"},{title:"Страна",key:"country"},{title:"Адрес",key:"address"},{title:"Телефон",key:"phone"},{title:"День рождение",key:"birthday"}],commandForm:{id:null,slug:null,pre_text:null,post_text:null,error_text:null,bot_id:null,input_pattern:null,inline_keyboard_id:null,reply_keyboard_id:null,images:null,next_bot_dialog_command_id:null,bot_dialog_group_id:null,is_empty:!1,is_inform:!1,custom_stored_value:null,result_flags:[],store_to:null,use_result_as:null,result_channel:null,inline_keyboard:null,reply_keyboard:null,answers:[],rules:[]},photos:[]}},watch:{"commandForm.is_inform":function(s,t){this.commandForm.is_inform&&(this.commandForm.is_empty=!1,this.commandForm.post_text=null,this.commandForm.answers=[])},need_custom_stored_value:function(s,t){this.need_custom_stored_value||(this.commandForm.custom_stored_value=null)},need_inline_keyboard:function(s,t){this.need_inline_keyboard||(this.commandForm.inline_keyboard_id=null,this.commandForm.inline_keyboard=null)},need_reply_keyboard:function(s,t){this.need_reply_keyboard||(this.commandForm.reply_keyboard_id=null,this.commandForm.reply_keyboard=null)},need_set_flags:function(s,t){this.need_set_flags||(this.commandForm.result_flags=[])},need_images:function(s,t){this.need_images||(this.commandForm.images=null)}},computed:{...C(["getDialogCommands","getDialogCommandsPaginateObject"]),filteredCommands(){return this.dialog_commands?this.dialog_commands.filter(s=>s.id!=this.commandForm.id):[]}},mounted(){this.item&&this.$nextTick(()=>{this.commandForm={id:this.item.id||null,slug:this.item.slug||null,pre_text:this.item.pre_text||null,post_text:this.item.post_text||null,error_text:this.item.error_text||null,custom_stored_value:this.item.custom_stored_value||null,is_empty:this.item.is_empty||!1,is_inform:this.item.is_inform||!1,input_pattern:this.item.input_pattern||null,inline_keyboard_id:this.item.inline_keyboard_id||null,reply_keyboard_id:this.item.reply_keyboard_id||null,images:this.item.images||[],next_bot_dialog_command_id:this.item.next_bot_dialog_command_id||null,bot_dialog_group_id:this.item.bot_dialog_group_id||null,result_channel:this.item.result_channel||null,inline_keyboard:this.item.inline_keyboard||null,reply_keyboard:this.item.reply_keyboard||null,result_flags:this.item.result_flags||[],store_to:this.item.store_to||null,answers:this.item.answers||[],use_result_as:this.item.use_result_as||null,rules:this.item.rules||[]},this.bot&&(this.commandForm.bot_id=this.bot.id||null),this.commandForm.inline_keyboard_id!=null&&(this.need_inline_keyboard=!0),this.commandForm.reply_keyboard_id!=null&&(this.need_reply_keyboard=!0),this.commandForm.images.length>0&&(this.need_images=!0),this.commandForm.result_flags.length>0&&(this.need_set_flags=!0),this.commandForm.answers.length>0&&(this.need_chains=!0),this.commandForm.custom_stored_value&&(this.need_custom_stored_value=!0)}),this.bot&&this.$nextTick(()=>{this.commandForm.bot_id=this.bot.id}),this.loadDialogs()},methods:{addVariableToTextBlock(s,t){this.commandForm[s]+=t},toggleRepeatSelfDialog(){this.commandForm.next_bot_dialog_command_id!=null&&this.commandForm.next_bot_dialog_command_id!==this.commandForm.id?this.commandForm.next_bot_dialog_command_id=this.commandForm.id:this.commandForm.next_bot_dialog_command_id=this.commandForm.next_bot_dialog_command_id===null?this.commandForm.id:null},addAnswer(){this.commandForm.answers.push({id:null,bot_dialog_command_id:null,answer:null,pattern:null,custom_stored_value:null,next_bot_dialog_command_id:null})},nextDialogs(s){this.loadDialogs(s)},removeDialogAnswer(s,t){if(s.id==null){this.commandForm.answers.splice(t,1);return}this.commandForm.answers.splice(t,1),this.loading=!0,this.$store.dispatch("removeDialogAnswer",{dataObject:{dialogAnswerId:s.id}}).then(o=>{this.loading=!1,this.loadDialogs()}).catch(()=>{this.loading=!1})},loadDialogs(s=0){this.loading=!0,this.$store.dispatch("loadLinkedDialogCommands",{dataObject:{botId:this.bot.id||null,order:"id",direction:"asc"},page:s,size:100}).then(t=>{this.loading=!1;let o=t.data;this.dialog_commands=o.data||[],delete o.data,this.dialog_commands_paginate_object=o}).catch(()=>{this.loading=!1})},doCommandLink(s){this.loading=!0,this.commandForm.next_bot_dialog_command_id=s},submit(){this.loading=!0;let s=new FormData;if(Object.keys(this.commandForm).forEach(t=>{const o=this.commandForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.photos){for(let t=0;t<this.photos.length;t++)s.append("files[]",this.photos[t]);s.delete("photos")}this.$store.dispatch(this.commandForm.id?"updateDialogCommand":"createDialogCommand",{dialogCommandForm:s}).then(t=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Успешная обработка диалоговой команды",type:"success"}),this.commandForm.id==null&&(this.commandForm={id:null,slug:null,pre_text:null,post_text:null,error_text:null,input_pattern:null,inline_keyboard_id:null,images:null,next_bot_dialog_command_id:null,bot_dialog_group_id:null,result_channel:null,inline_keyboard:null,is_inform:!1,is_empty:!1,result_flags:[],answers:[],store_to:null,custom_stored_value:null,use_result_as:null},this.photos=[]),this.$emit("callback")}).catch(t=>{this.loading=!1})},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removePhoto(s,t){this[s].splice(t,1)},onChangePhotos(s){const t=s.target.files;for(let o=0;o<t.length;o++)this.photos.push(t[o])},saveInlineKeyboard(s){this.commandForm.inline_keyboard=s},saveReplyKeyboard(s){this.commandForm.reply_keyboard=s},addTextTo(s={param:null,text:null}){this.commandForm[s.param]=s.text},selectElementById(s){this.$emit("select-element",s)},selectFlag(s){(!this.commandForm.result_flags||!Array.isArray(this.commandForm.result_flags))&&(this.commandForm.result_flags=[]);let t=this.commandForm.result_flags.indexOf(s.key);t===-1?this.commandForm.result_flags.push(s.key):this.commandForm.result_flags.splice(t,1)}}},W=Object.assign(Xr,{__name:"BotDialogCommandForm",setup(s){return(t,o)=>{const n=Q("lazy");return l(),i("form",{onSubmit:o[27]||(o[27]=S((...a)=>t.submit&&t.submit(...a),["prevent"]))},[e("div",ua,[e("button",ma,[_a,t.commandForm.id?(l(),i("span",ha,"Обновить диалог #"+u(t.commandForm.id),1)):(l(),i("span",pa,"Добавить диалог"))])]),e("ul",ba,[e("li",fa,[e("a",{class:b(["nav-link",{active:t.tab===0}]),onClick:o[0]||(o[0]=a=>t.tab=0),"aria-current":"page",href:"javascript:void(0)"},[ga,m(" Основное")],2)]),e("li",va,[e("a",{class:b(["nav-link",{active:t.tab===1}]),onClick:o[1]||(o[1]=a=>t.tab=1),href:"javascript:void(0)"},[$a,m(" Связывание диалогов")],2)]),t.commandForm.is_inform?r("",!0):(l(),i("li",ya,[e("a",{class:b(["nav-link",{active:t.tab===2}]),onClick:o[2]||(o[2]=a=>t.tab=2),href:"javascript:void(0)"},[ka,m(" Дополнительное")],2)])),t.commandForm.is_empty?(l(),i("li",Fa,[e("a",{class:b(["nav-link",{active:t.tab===3}]),onClick:o[3]||(o[3]=a=>t.tab=3),href:"javascript:void(0)","aria-disabled":"true"},[wa,m(" Вычисление результата")],2)])):r("",!0)]),t.tab===0?(l(),i("div",Ca,[e("div",Sa,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[4]||(o[4]=a=>t.commandForm.is_inform=a),id:"need-inform-dialog"+(t.commandForm.id||"new"),checked:""},null,8,ja),[[k,t.commandForm.is_inform]]),e("label",{class:"form-check-label",for:"need-inform-dialog"+(t.commandForm.id||"new")}," Диалог только выводит данные ",8,qa)]),t.commandForm.is_inform?r("",!0):(l(),i("div",za,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[5]||(o[5]=a=>t.commandForm.is_empty=a),id:"need-empty-dialog"+(t.commandForm.id||"new"),checked:""},null,8,Va),[[k,t.commandForm.is_empty]]),e("label",{class:"form-check-label",for:"need-empty-dialog"+(t.commandForm.id||"new")}," Диалог завершает цепочку (только вывод информации) ",8,Pa)])),t.commandForm.is_inform?(l(),i("div",Oa," Данный диалог позволит вам сразу вызвать связанный с ним другой диалог без ожидания ввод данных от пользователя! ")):r("",!0),f(ca,{onCallback:o[6]||(o[6]=a=>t.addVariableToTextBlock("pre_text",a)),bot:s.bot},null,8,["bot"]),e("div",Ua,[c(e("textarea",{class:"form-control",id:"commandForm-pre-text-"+t.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":o[7]||(o[7]=a=>t.commandForm.pre_text=a),required:""},`
                `,8,Aa),[[h,t.commandForm.pre_text]]),e("label",{for:"commandForm-pre-text-"+t.commandForm.id},"Текст диалога",8,Ia)]),t.commandForm.is_empty?r("",!0):(l(),i("div",Qa,[e("div",Ta,[c(e("input",{type:"text",class:"form-control",id:"floatingPassword","onUpdate:modelValue":o[8]||(o[8]=a=>t.commandForm.use_result_as=a),placeholder:"Password"},null,512),[[h,t.commandForm.use_result_as]]),Ba])])),t.commandForm.is_empty?r("",!0):(l(),i("div",Ra,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[9]||(o[9]=a=>t.need_custom_stored_value=a),id:"need-custom-stored-value"},null,512),[[k,t.need_custom_stored_value]]),Ma])),!t.commandForm.is_empty&&t.need_custom_stored_value?(l(),i("div",Da,[e("div",Ea,[c(e("input",{type:"text",class:"form-control",id:"custom_stored_value","onUpdate:modelValue":o[10]||(o[10]=a=>t.commandForm.custom_stored_value=a),placeholder:"Password"},null,512),[[h,t.commandForm.custom_stored_value]]),La])])):r("",!0),!t.commandForm.is_empty&&!t.commandForm.is_inform?(l(),i("div",Ka,[c(e("textarea",{class:"form-control",disabled:t.commandForm.is_inform,id:"commandForm-post-text-"+t.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":o[11]||(o[11]=a=>t.commandForm.post_text=a)},`
            `,8,Na),[[h,t.commandForm.post_text]]),e("label",{for:"commandForm-post-text-"+t.commandForm.id},"Текст после успешного завершения диалога",8,Ja)])):r("",!0)])):r("",!0),t.tab===1?(l(),i("div",Ya,[e("div",Ha,[t.filteredCommands.length>0?(l(),i("div",Ga,[Wa,t.commandForm.id?(l(),i("div",Xa,[e("button",{type:"button",onClick:o[12]||(o[12]=(...a)=>t.toggleRepeatSelfDialog&&t.toggleRepeatSelfDialog(...a)),class:b([{"btn-outline-primary":t.commandForm.next_bot_dialog_command_id!==t.commandForm.id,"btn-primary":t.commandForm.next_bot_dialog_command_id===t.commandForm.id},"btn"])},[Za,m(" Зациклить диалог на себе в случае ошибки ")],2)])):r("",!0),(l(!0),i(g,null,y(t.filteredCommands,(a,d)=>(l(),i("div",xa,[e("button",ed,[e("span",null,[t.commandForm.next_bot_dialog_command_id==a.id?(l(),i("i",{key:0,class:"fa-solid fa-unlink text-danger mr-2",onClick:o[13]||(o[13]=_=>t.doCommandLink(null))})):(l(),i("i",{key:1,onClick:_=>t.doCommandLink(a.id),class:"fa-solid fa-link mr-2 text-success"},null,8,td)),m(" [#"+u(a.id)+"] Текст диалога: "+u(a.pre_text||"Без текста"),1)])])]))),256)),t.dialog_commands_paginate_object?(l(),$(j,{key:1,onPagination_page:t.nextDialogs,pagination:t.dialog_commands_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])):(l(),i("div",sd,ld))])])):r("",!0),t.tab===2?(l(),i("div",id,[e("div",nd,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[14]||(o[14]=a=>t.need_additional_functions=a),id:"need-additional-functions"},null,512),[[k,t.need_additional_functions]]),ad]),!t.commandForm.is_empty&&t.need_additional_functions?(l(),i("div",dd,[c(e("textarea",{type:"text",class:"form-control",id:"commandForm-error-text-"+t.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":o[15]||(o[15]=a=>t.commandForm.error_text=a)},`
            `,8,rd),[[h,t.commandForm.error_text]]),e("label",{for:"commandForm-error-text-"+t.commandForm.id},"Текст на случай ошибки корректности данных",8,cd)])):r("",!0),!t.commandForm.is_empty&&t.need_additional_functions?(l(),i("div",ud,[e("div",md,[_d,f(rn,{param:"input_pattern",onCallback:t.addTextTo},null,8,["onCallback"])]),e("div",hd,[c(e("input",{type:"text","onUpdate:modelValue":o[16]||(o[16]=a=>t.commandForm.input_pattern=a),maxlength:"255",class:"form-control",id:"commandForm-input-pattern-"+t.commandForm.id,placeholder:"Регулярное выражение"},null,8,pd),[[h,t.commandForm.input_pattern]]),e("label",{for:"commandForm-result-channel-"+t.commandForm.id},"Регулярное выражение",8,bd)])])):r("",!0),t.need_additional_functions?(l(),i("div",fd,[e("div",gd,[vd,s.bot?(l(),$(oe,{key:0,token:s.bot.bot_token,param:"result_channel",onCallback:t.addTextTo},null,8,["token","onCallback"])):r("",!0)]),e("div",$d,[c(e("input",{type:"number","onUpdate:modelValue":o[17]||(o[17]=a=>t.commandForm.result_channel=a),class:"form-control",id:"commandForm-result-channel-"+t.commandForm.id,placeholder:"id канала"},null,8,yd),[[h,t.commandForm.result_channel]]),e("label",{for:"commandForm-result-channel-"+t.commandForm.id},"id канала",8,kd)])])):r("",!0),t.need_additional_functions?(l(),i("div",Fd,[e("div",wd,[c(e("select",{class:"form-select","onUpdate:modelValue":o[18]||(o[18]=a=>t.commandForm.store_to=a),id:"store_variants","aria-label":"Floating label select example"},[Cd,(l(!0),i(g,null,y(t.store_variants,a=>(l(),i("option",{value:a.key},u(a.title||"Не указано"),9,Sd))),256))],512),[[I,t.commandForm.store_to]]),jd])])):r("",!0),e("div",qd,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[19]||(o[19]=a=>t.need_images=a),id:"need-dialog-image",checked:""},null,512),[[k,t.need_images]]),zd]),t.need_images?(l(),i("div",Vd,[e("div",Pd,[Od,e("div",Ud,[e("label",Ad,[Id,e("input",{type:"file",id:"location-photos",multiple:"",accept:"image/*",onChange:o[20]||(o[20]=(...a)=>t.onChangePhotos&&t.onChangePhotos(...a)),style:{display:"none"}},null,32)]),t.photos.length>0?(l(!0),i(g,{key:0},y(t.photos,(a,d)=>(l(),i("div",Qd,[c(e("img",null,null,512),[[n,t.getPhoto(a).imageUrl]]),e("div",Td,[e("a",{onClick:_=>t.removePhoto("photos",d)},"Удалить",8,Bd)])]))),256)):r("",!0),t.commandForm.images&&s.bot?(l(!0),i(g,{key:1},y(t.commandForm.images,(a,d)=>(l(),i("div",Rd,[c(e("img",null,null,512),[[n,"/images-by-bot-id/"+s.bot.id+"/"+a]]),e("div",Md,[e("a",{onClick:_=>t.removePhoto("images",d)},"Удалить",8,Dd)])]))),256)):r("",!0)])])])):r("",!0),e("div",Ed,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[21]||(o[21]=a=>t.need_inline_keyboard=a),id:"need-dialog-menu-inline",checked:""},null,512),[[k,t.need_inline_keyboard]]),Ld]),t.need_inline_keyboard?(l(),i("div",Kd,[Nd,e("div",Jd,[f(A,{type:"inline",onSave:t.saveInlineKeyboard,"edited-keyboard":t.commandForm.inline_keyboard},null,8,["onSave","edited-keyboard"])])])):r("",!0),e("div",Yd,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[22]||(o[22]=a=>t.need_reply_keyboard=a),id:"need-dialog-menu-reply",checked:""},null,512),[[k,t.need_reply_keyboard]]),Hd]),t.need_reply_keyboard?(l(),i("div",Gd,[Wd,e("div",Xd,[f(A,{type:"reply",onSave:t.saveReplyKeyboard,"edited-keyboard":t.commandForm.reply_keyboard},null,8,["onSave","edited-keyboard"])])])):r("",!0),e("div",Zd,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[23]||(o[23]=a=>t.need_chains=a),id:"need-chains",checked:""},null,512),[[k,t.need_chains]]),xd]),t.need_chains?(l(),i("div",er,[e("button",{type:"button",class:"btn btn-outline-primary",onClick:o[24]||(o[24]=(...a)=>t.addAnswer&&t.addAnswer(...a))},"Добавить вариант ответа "),t.commandForm.answers.length>0?(l(),i("table",tr,[e("tbody",null,[(l(!0),i(g,null,y(t.commandForm.answers,(a,d)=>(l(),i(g,null,[sr,e("tr",null,[e("td",or,[t.commandForm.answers[d].in_edit_mode?(l(),i("span",{key:1,onClick:_=>t.commandForm.answers[d].in_edit_mode=!1},rr,8,ar)):(l(),i("span",{key:0,onClick:_=>t.commandForm.answers[d].in_edit_mode=!0},nr,8,lr))]),e("th",cr,u(d+1),1),e("td",null,[e("div",ur,[c(e("input",{type:"text","onUpdate:modelValue":_=>t.commandForm.answers[d].answer=_,class:"form-control",id:"floatingInput",placeholder:"name@example.com"},null,8,mr),[[h,t.commandForm.answers[d].answer]]),_r])]),e("td",null,[e("div",hr,[e("div",pr,[c(e("input",{type:"text",class:"form-control","onUpdate:modelValue":_=>t.commandForm.answers[d].next_bot_dialog_command_id=_,id:"floatingInput",placeholder:"name@example.com",required:""},null,8,br),[[h,t.commandForm.answers[d].next_bot_dialog_command_id]]),fr]),e("div",gr,[vr,e("div",$r,[e("ul",yr,[e("li",{class:"list-group-item cursor-pointer font-12",onClick:_=>t.commandForm.answers[d].next_bot_dialog_command_id=null}," Не выбран ",8,kr),(l(!0),i(g,null,y(t.getDialogCommands,_=>(l(),i("li",{class:"list-group-item cursor-pointer font-12",style:{"line-height":"100%","text-align":"left"},onClick:p=>t.commandForm.answers[d].next_bot_dialog_command_id=_.id}," #"+u(_.id||"-")+" "+u(_.pre_text||"-"),9,Fr))),256))]),e("div",wr,[t.dialog_commands_paginate_object?(l(),$(j,{key:0,onPagination_page:t.nextDialogs,pagination:t.dialog_commands_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])])])]),e("td",null,[e("div",Cr,[Sr,e("ul",jr,[e("li",null,[e("a",{class:"dropdown-item",onClick:_=>t.removeDialogAnswer(a,d),href:"javascript:void(0)"},"Удалить",8,qr)])])])])]),t.commandForm.answers[d].in_edit_mode?(l(),i("tr",zr,[Vr,Pr,e("td",null,[e("div",Or,[e("div",Ur,[c(e("input",{type:"text","onUpdate:modelValue":_=>t.commandForm.answers[d].pattern=_,class:"form-control",id:"floatingInput",placeholder:"name@example.com"},null,8,Ar),[[h,t.commandForm.answers[d].pattern]]),Ir]),e("div",Qr,[Tr,e("ul",Br,[e("li",null,[e("a",{class:"dropdown-item",onClick:_=>t.commandForm.answers[d].pattern=null,href:"javascript:void(0)"},"Не выбран",8,Rr)]),e("li",null,[(l(!0),i(g,null,y(t.patterns,_=>(l(),i("a",{class:"dropdown-item",onClick:p=>t.commandForm.answers[d].pattern=_.value,href:"javascript:void(0)"},u(_.title||"-"),9,Mr))),256))])])])])]),e("td",null,[e("div",Dr,[c(e("input",{type:"text","onUpdate:modelValue":_=>t.commandForm.answers[d].custom_stored_value=_,class:"form-control",id:"custom_stored_value-"+d,placeholder:"name@example.com"},null,8,Er),[[h,t.commandForm.answers[d].custom_stored_value]]),e("label",{for:"custom_stored_value-"+d},"Поместить данный текст в переменную",8,Lr)])])])):r("",!0)],64))),256))])])):(l(),i("div",Kr," Добавьте один или несколько вариантов ответов "))])):r("",!0),e("div",Nr,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[25]||(o[25]=a=>t.need_set_flags=a),id:"need-set-flags",checked:""},null,512),[[k,t.need_set_flags]]),Jr]),t.need_set_flags?(l(),i("div",Yr,[Hr,(l(!0),i(g,null,y(t.flags_variants,a=>(l(),i("span",{class:b(["badge text-info mr-2",{"bg-info text-white":t.commandForm.result_flags.indexOf(a.key)!=-1}]),onClick:d=>t.selectFlag(a)},u(a.title),11,Gr))),256))])):r("",!0)])):r("",!0),t.tab===3?(l(),i("div",Wr,[f(sa,{modelValue:t.commandForm.rules,"onUpdate:modelValue":o[26]||(o[26]=a=>t.commandForm.rules=a)},null,8,["modelValue"])])):r("",!0)],32)}}});const Zr={class:"row"},xr={class:"col-md-2 col-12"},ec=e("i",{class:"fa-regular fa-comment-dots",style:{"margin-right":"10px"}},null,-1),tc={class:"col-md-10 col-12"},sc={class:"input-group mb-3"},oc={style:{width:"200px !important"}},lc=te('<option value="25">25</option><option value="50">50</option><option value="100">100</option><option value="500">500</option><option value="1000">1000</option>',5),ic=[lc],nc={key:0,class:"row"},ac={class:"col-md-12"},dc={class:"table"},rc=e("th",{class:"text-left",scope:"col",style:{width:"40px"}},null,-1),cc=e("th",{class:"text-center",scope:"col",style:{width:"40px"}},"Команды",-1),uc={style:{width:"40px"}},mc=["onClick"],_c=e("i",{class:"fa-solid fa-toggle-off cursor-pointer text-secondary"},null,-1),hc=[_c],pc=["onClick"],bc=e("i",{class:"fa-solid fa-toggle-on cursor-pointer text-primary"},null,-1),fc=[bc],gc={scope:"row",class:"text-left",style:{width:"80px"}},vc={class:"d-flex justify-content-start align-items-center"},$c={key:0,class:"fa-solid fa-flag-checkered ml-2"},yc={key:1,class:"fa-solid fa-sitemap ml-2"},kc={key:2,class:"fa-solid fa-arrows-rotate ml-2"},Fc={class:"text-left",style:{"min-width":"400px"}},wc={key:0,class:"dropdown"},Cc={style:{"line-height":"100%","font-size":"14px","text-align":"left"},class:"btn btn-link m-0 p-0 text-decoration-none",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Sc={class:"dropdown-menu p-2"},jc=["onSubmit"],qc=e("p",{class:"mb-0"},"Значение",-1),zc=["onUpdate:modelValue"],Vc=e("button",{class:"btn btn-outline-primary mt-2 w-100 text-center"}," Сохранить ",-1),Pc={class:"dropdown my-2"},Oc={style:{"text-align":"left !important"},class:"text-decoration-none fst-italic color-black w-100 d-flex justify-content-between align-items-center",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Uc={class:"dropdown-menu p-4 text-body-secondary",style:{"max-width":"400px","min-width":"400px",height:"200px","overflow-y":"scroll"}},Ac=e("h6",null,"Основные параметры диалога",-1),Ic={class:"table"},Qc=e("td",null,"Есть ответы",-1),Tc={key:0},Bc={key:1},Rc=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Mc=[Rc],Dc=e("td",null,"Цепочки",-1),Ec={key:0,class:"badge bg-primary"},Lc={key:1},Kc=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Nc=[Kc],Jc=e("td",null,"Текст успеха",-1),Yc={key:0},Hc={key:1},Gc=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Wc=[Gc],Xc=e("td",null,"Текст ошибки",-1),Zc={key:0},xc={key:1},eu=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),tu=[eu],su=e("td",null,"Канал результата",-1),ou={key:0},lu={key:1},iu=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),nu=[iu],au=e("td",null,"Флаги",-1),du={key:0},ru={class:"badge bg-primary"},cu={key:1},uu=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),mu=[uu],_u=e("td",null,"Сохранить в",-1),hu={key:0},pu={key:1},bu=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),fu=[bu],gu=e("td",null,"Есть изображения",-1),vu={key:0,class:"fa-solid fa-check text-success"},$u={key:1,class:"fa-solid fa-xmark text-danger"},yu=e("td",null,"Есть паттерны",-1),ku={key:0},Fu={key:1},wu=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Cu=[wu],Su=e("td",null,"Пустой",-1),ju={key:0,class:"fa-solid fa-check text-success"},qu={key:1,class:"fa-solid fa-xmark text-danger"},zu=e("td",null,"Информационный",-1),Vu={key:0,class:"fa-solid fa-check text-success"},Pu={key:1,class:"fa-solid fa-xmark text-danger"},Ou=e("td",null,"Есть кнопки",-1),Uu={key:0,class:"fa-solid fa-check text-success"},Au={key:1,class:"fa-solid fa-xmark text-danger"},Iu=e("td",null,"Есть меню",-1),Qu={key:0,class:"fa-solid fa-check text-success"},Tu={key:1,class:"fa-solid fa-xmark text-danger"},Bu={key:1,class:"small font-bold m-0"},Ru=e("i",{class:"fa-solid fa-angles-right mx-2"},null,-1),Mu={style:{width:"150px"}},Du=["onClick"],Eu=e("i",{class:"fa-solid fa-angles-right mx-2"},null,-1),Lu=e("small",null,[e("i",{class:"fa-solid fa-arrow-up-right-from-square text-primary"})],-1),Ku=e("td",null,[e("i",{class:"fa-solid fa-arrow-right-long mx-2"})],-1),Nu={style:{"max-width":"770px"}},Ju={class:"dropdown"},Yu={style:{"line-height":"100%","font-size":"10px","text-align":"left"},class:"btn btn-link m-0 p-0 text-decoration-none",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Hu={key:0},Gu={key:1},Wu={class:"dropdown-menu p-2"},Xu=["onSubmit"],Zu=e("p",{class:"mb-0"},"Значение",-1),xu=["onUpdate:modelValue"],em=e("button",{class:"btn btn-outline-primary mt-2 w-100 text-center"}," Сохранить ",-1),tm={key:0},sm={key:0,class:"text-danger font-bold"},om={key:1,class:"text-success font-bold"},lm={key:2,class:"text-warning font-bold"},im=["onClick"],nm=e("i",{class:"fa-solid fa-angles-right mx-2"},null,-1),am=e("small",null,[e("i",{class:"fa-solid fa-arrow-up-right-from-square text-primary"})],-1),dm={key:0},rm=e("i",{class:"fa-solid fa-arrow-right-long mx-2"},null,-1),cm=[rm],um={key:1,style:{"max-width":"770px"}},mm={class:"mb-0",style:{"line-height":"100%","font-size":"10px"}},_m={class:"text-center",style:{width:"40px"}},hm={class:"dropdown"},pm=["disabled"],bm=e("i",{class:"fa-solid fa-ellipsis"},null,-1),fm=[bm],gm={class:"dropdown-menu"},vm=["onClick"],$m=e("i",{class:"fa-solid fa-arrow-left mr-1"},null,-1),ym=e("hr",null,null,-1),km=["onClick"],Fm=e("i",{class:"fa-solid fa-clone mr-1"},null,-1),wm=["onClick"],Cm=e("i",{class:"fa-solid fa-trash-can mr-1"},null,-1),Sm={key:0},jm={colspan:"17"},qm={key:1,class:"row"},zm=e("div",{class:"col-12"},[e("div",{class:"alert alert-danger",role:"alert"}," Не найдено ни одного диалога! ")],-1),Vm=[zm],Pm={class:"modal fade",id:"dialog-command-modal-editor",tabindex:"-1"},Om={class:"modal-dialog modal-fullscreen"},Um={class:"modal-content"},Am=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"}," Создание диалогового сообщения "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Im={class:"modal-body"},Qm=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),Tm={data(){return{direction:"desc",order:"updated_at",size:500,variables:[],bot:null,selected:null,loading:!0,current_page:0,dialog_commands:[],search:null,dialog_commands_paginate_object:null}},computed:{...C(["getDialogCommands","getCurrentBot","getDialogCommandsPaginateObject"])},mounted(){this.loadCurrentBot().then(()=>{let s=localStorage.getItem("cashman_dialogs_current_page_"+this.bot.id)||0;this.loadDialogs(s)})},methods:{updateDialogCommand(s){let t=new FormData;Object.keys(s).forEach(o=>{const n=s[o]||"";typeof n=="object"?t.append(o,JSON.stringify(n)):t.append(o,n)}),this.$store.dispatch("updateDialogCommand",{dialogCommandForm:t}).then(o=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Успешная обработка диалоговой команды",type:"success"})}).catch(()=>{this.$notify({title:"Конструктор ботов",text:"Ошибка обработки диалоговой команды",type:"error"})})},updateAnswer(s){this.$store.dispatch("updatedDialogAnswer",{...s,bot_id:this.bot.id}).then(t=>{this.$notify({title:"Конструктор ботов",text:"Текст успешно обновлен",type:"success"})}).catch(t=>{})},loadAndOrder(s){this.order=s,this.direction=this.direction==="desc"?"asc":"desc",this.loadDialogs(0)},loadAndOpenEditor(s){this.loading=!0,this.$store.dispatch("loadLinkedDialogCommand",{command_id:s,bot_id:this.bot.id}).then(t=>{this.selected=t.data,console.log(t.data),this.loading=!1,new bootstrap.Modal(document.getElementById("dialog-command-modal-editor"),{}).show()}).catch(()=>{this.$notify({title:"Конструктор ботов",text:"Ошибка работы с командой",type:"error"})})},openEditor(s){this.loading=!0,s||this.dialog_commands.forEach(t=>{t.in_edit_mode=!1}),this.$nextTick(()=>{this.selected=s,this.loading=!1})},removeCommand(s){this.loading=!0,this.$store.dispatch("removeDialogCommand",{dataObject:{dialogCommandId:s}}).then(t=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Диалоговая команда успешно удалена!",type:"success"}),this.loadDialogs(),this.$emit("callback")}).catch(t=>{this.loading=!1})},duplicate(s){this.loading=!0,this.$store.dispatch("duplicateDialogCommand",{dataObject:{dialogCommandId:s}}).then(t=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Диалоговая команда успешно продублирована!",type:"success"}),this.loadDialogs(),this.$emit("callback")}).catch(t=>{this.loading=!1})},toggleEditMode(s){this.selected=s,s.in_edit_mode=!s.in_edit_mode},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},selectDialog(s){this.$emit("select-dialog",s),this.$notify("Вы выбрали диалог из списка!")},nextDialogs(s){this.loadDialogs(s)},selectElement(s){this.loading=!0,this.$nextTick(()=>{this.selected=this.dialog_commands.find(t=>t.id===s)||null,this.loading=!1})},loadDialogs(s=0){this.current_page=s,localStorage.setItem("cashman_dialogs_current_page_"+this.bot.id,this.current_page),this.$store.dispatch("loadDialogCommands",{dataObject:{botId:this.bot.id||null,search:this.search,order:this.order,direction:this.direction},page:s,size:this.size||25}).then(t=>{const o=this.selected;this.dialog_commands=this.getDialogCommands,this.dialog_commands_paginate_object=this.getDialogCommandsPaginateObject,this.loading=!0,this.$nextTick(()=>{o&&(this.selected=this.dialog_commands.find(n=>n.id===o.id)||null,this.selected.in_edit_mode=!1),this.loading=!1})}).catch(()=>{this.loading=!1})}}},de=Object.assign(Tm,{__name:"BotDialogGroupList",setup(s){return(t,o)=>(l(),i(g,null,[e("div",Zr,[e("div",xr,[e("button",{type:"button",onClick:o[0]||(o[0]=n=>t.openEditor(null)),"data-bs-toggle":"modal","data-bs-target":"#dialog-command-modal-editor",class:"btn btn-outline-success mb-2 w-100"},[ec,m("Новый диалог ")])]),e("div",tc,[e("div",sc,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск диалога","aria-label":"Поиск диалога","onUpdate:modelValue":o[1]||(o[1]=n=>t.search=n),"aria-describedby":"button-addon2"},null,512),[[h,t.search]]),e("div",oc,[c(e("select",{onChange:o[2]||(o[2]=n=>t.loadDialogs(t.current_page)),"onUpdate:modelValue":o[3]||(o[3]=n=>t.size=n),class:"form-select rounded-0"},ic,544),[[I,t.size]])]),e("button",{class:"btn btn-outline-secondary",onClick:o[4]||(o[4]=n=>t.loadDialogs(0)),type:"button",id:"button-addon2"},"Найти ")])])]),t.dialog_commands.length>0?(l(),i("div",nc,[e("div",ac,[e("table",dc,[e("thead",null,[e("tr",null,[rc,e("th",{class:"text-left cursor-pointer",scope:"col",onClick:o[5]||(o[5]=n=>t.loadAndOrder("id")),style:{width:"80px"}}," # "),e("th",{class:"text-left cursor-pointer",scope:"col",onClick:o[6]||(o[6]=n=>t.loadAndOrder("pre_text")),style:{"min-width":"400px"}},"Текст диалога "),cc])]),e("tbody",null,[(l(!0),i(g,null,y(t.dialog_commands,(n,a)=>(l(),i(g,null,[e("tr",null,[e("td",uc,[n.in_edit_mode?(l(),i("span",{key:1,onClick:d=>t.toggleEditMode(n)},fc,8,pc)):(l(),i("span",{key:0,onClick:d=>t.toggleEditMode(n)},hc,8,mc))]),e("th",gc,[e("span",vc,[m(u(n.id)+" ",1),n.is_empty?(l(),i("i",$c)):r("",!0),n.is_inform?(l(),i("i",yc)):r("",!0),n.next_bot_dialog_command_id===n.id?(l(),i("i",kc)):r("",!0)])]),e("td",Fc,[n.is_empty?r("",!0):(l(),i("div",wc,[e("button",Cc,[m(" Результат будет сохранен в "),e("strong",null,u(n.use_result_as||"не задана"),1)]),e("div",Sc,[e("form",{onSubmit:S(d=>t.updateDialogCommand(n),["prevent"]),class:"p-2"},[qc,c(e("textarea",{class:"form-control","onUpdate:modelValue":d=>n.use_result_as=d,name:"",id:"",cols:"30",rows:"10"},null,8,zc),[[h,n.use_result_as]]),Vc],40,jc)])])),e("div",Pc,[e("button",Oc,u(n.pre_text||"-"),1),e("div",Uc,[Ac,e("table",Ic,[e("tbody",null,[e("tr",null,[Qc,e("td",null,[(n.answers||[]).length>0?(l(),i("p",Tc,u(n.answers.length),1)):(l(),i("p",Bc,Mc))])]),e("tr",null,[Dc,e("td",null,[n.next_bot_dialog_command_id?(l(),i("span",Ec,"#"+u(n.next_bot_dialog_command_id||"-")+" ("+u(n.chain.length||0)+")",1)):(l(),i("span",Lc,Nc))])]),e("tr",null,[Jc,e("td",null,[n.post_text?(l(),i("p",Yc,u(n.post_text),1)):(l(),i("p",Hc,Wc))])]),e("tr",null,[Xc,e("td",null,[n.error_text?(l(),i("p",Zc,u(n.error_text),1)):(l(),i("p",xc,tu))])]),e("tr",null,[su,e("td",null,[n.result_channel?(l(),i("p",ou,u(n.result_channel),1)):(l(),i("p",lu,nu))])]),e("tr",null,[au,e("td",null,[n.result_flags.length>0?(l(),i("p",du,[(l(!0),i(g,null,y(n.result_flags,d=>(l(),i("span",ru,u(d||"-"),1))),256))])):(l(),i("p",cu,mu))])]),e("tr",null,[_u,e("td",null,[n.store_to?(l(),i("p",hu,u(n.store_to),1)):(l(),i("p",pu,fu))])]),e("tr",null,[gu,e("td",null,[(n.images||[]).length>0?(l(),i("i",vu)):(l(),i("i",$u))])]),e("tr",null,[yu,e("td",null,[n.input_pattern?(l(),i("p",ku,u(n.input_pattern),1)):(l(),i("p",Fu,Cu))])]),e("tr",null,[Su,e("td",null,[n.is_empty?(l(),i("i",ju)):(l(),i("i",qu))])]),e("tr",null,[zu,e("td",null,[n.is_inform?(l(),i("i",Vu)):(l(),i("i",Pu))])]),e("tr",null,[Ou,e("td",null,[n.inline_keyboard_id!=null?(l(),i("i",Uu)):(l(),i("i",Au))])]),e("tr",null,[Iu,e("td",null,[n.reply_keyboard_id!=null?(l(),i("i",Qu)):(l(),i("i",Tu))])])])])])]),(n.next_bot_dialog_command_id||(n.answers||[]).length>0)&&!n.is_inform?(l(),i("p",Bu,[m("Ответ"),Ru,m("диалог")])):r("",!0),e("table",null,[(l(!0),i(g,null,y(n.answers,d=>(l(),i("tr",null,[e("td",Mu,u(d.answer),1),e("td",{style:{width:"90px"},class:"cursor-pointer",onClick:_=>t.loadAndOpenEditor(d.next_bot_dialog_command_id)},[Eu,m(u(d.next_bot_dialog_command_id)+" ",1),Lu],8,Du),Ku,e("td",Nu,[e("div",Ju,[e("button",Yu,[d.custom_stored_value?(l(),i("span",Hu,u(d.custom_stored_value||"-"),1)):(l(),i("span",Gu,"нажмите, чтобы добавить"))]),e("div",Wu,[e("form",{onSubmit:S(_=>t.updateAnswer(d),["prevent"]),class:"p-2"},[Zu,c(e("textarea",{class:"form-control","onUpdate:modelValue":_=>d.custom_stored_value=_,name:"",id:"",cols:"30",rows:"10"},null,8,xu),[[h,d.custom_stored_value]]),em],40,Xu)])])])]))),256)),n.next_bot_dialog_command_id?(l(),i("tr",tm,[e("td",null,[(n.answers||[]).length>0&&!n.is_inform?(l(),i("span",sm,"Другой ответ")):r("",!0),(n.answers||[]).length===0&&!n.is_inform?(l(),i("span",om,"Любой ответ")):r("",!0),(n.answers||[]).length===0&&n.is_inform?(l(),i("span",lm,"Переход к диалогу")):r("",!0)]),e("td",{class:"cursor-pointer",onClick:d=>t.loadAndOpenEditor(n.next_bot_dialog_command_id)},[nm,m(u(n.next_bot_dialog_command_id||"-")+" ",1),am],8,im),n.custom_stored_value?(l(),i("td",dm,cm)):r("",!0),n.custom_stored_value?(l(),i("td",um,[e("p",mm,u(n.custom_stored_value||"-"),1)])):r("",!0)])):r("",!0)])]),e("td",_m,[e("div",hm,[e("button",{disabled:t.loading,class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},fm,8,pm),e("ul",gm,[e("li",null,[e("a",{onClick:d=>t.selectDialog(n),title:"Выбрать диалог",class:"dropdown-item cursor-pointer"},[$m,m(" Выбрать диалог ")],8,vm)]),ym,e("li",null,[e("a",{title:"Дублирование команды",onClick:d=>t.duplicate(n.id),class:"dropdown-item cursor-pointer"},[Fm,m(" Дублирование диалога ")],8,km)]),e("li",null,[e("a",{onClick:d=>t.removeCommand(n.id),title:"Удаление команды",class:"dropdown-item cursor-pointer"},[Cm,m(" Удаление диалога ")],8,wm)])])])])]),n.in_edit_mode?(l(),i("tr",Sm,[e("td",jm,[t.bot&&!t.loading?(l(),$(W,{key:0,item:t.selected,onCallback:t.loadDialogs,onSelectElement:t.selectElement,bot:t.bot},null,8,["item","onCallback","onSelectElement","bot"])):r("",!0)])])):r("",!0)],64))),256))])]),t.dialog_commands_paginate_object?(l(),$(j,{key:0,onPagination_page:t.nextDialogs,pagination:t.dialog_commands_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",qm,Vm)),e("div",Pm,[e("div",Om,[e("div",Um,[Am,e("div",Im,[t.bot&&!t.loading?(l(),$(W,{key:0,item:t.selected,onCallback:t.loadDialogs,onSelectElement:t.selectElement,bot:t.bot},null,8,["item","onCallback","onSelectElement","bot"])):r("",!0)]),Qm])])])],64))}}),Bm=e("div",{class:"alert alert-success",role:"alert"},' Проверка правил идет по методу "И" - все правила должны выполняться для перехода на данную страницу, иначе будет вызвана страница из блока "иначе". Действия для "иначе" добавлять не обязательно. ',-1),Rm=e("h6",null,"Блок условий",-1),Mm={key:0,class:"py-2"},Dm={class:"form-label",id:"bot-domain"},Em=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Lm=e("div",null,"Напишите текст, который будет отображен пользователю вместе с основным контентом в случае если условие будет выполнено ",-1),Km={class:"dropdown mb-2"},Nm=e("button",{class:"btn btn-outline-info dropdown-toggle w-100",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"}," Добавить условие ",-1),Jm={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},Ym=["onClick"],Hm={key:1},Gm={key:2,class:"list-group"},Wm={key:0,class:"list-group-item d-flex justify-content-between align-items-center"},Xm={class:"form-check"},Zm={class:"form-check-label",for:"bot-user-is-vip"},xm={key:0},e_={key:1},t_=e("i",{class:"fa-solid fa-trash-can"},null,-1),s_=[t_],o_={key:1,class:"list-group-item d-flex justify-content-between align-items-center"},l_={class:"form-check"},i_={class:"form-check-label",for:"bot-user-is-admin"},n_={key:0},a_={key:1},d_=e("i",{class:"fa-solid fa-trash-can"},null,-1),r_=[d_],c_={key:2,class:"list-group-item d-flex justify-content-between align-items-center"},u_={class:"form-check"},m_={class:"form-check-label",for:"bot-user-is-deliveryman"},__={key:0},h_={key:1},p_=e("i",{class:"fa-solid fa-trash-can"},null,-1),b_=[p_],f_={key:3,class:"list-group-item d-flex justify-content-between align-items-center"},g_={class:"form-check"},v_={class:"form-check-label",for:"bot-user-is-work"},$_={key:0},y_={key:1},k_=e("i",{class:"fa-solid fa-trash-can"},null,-1),F_=[k_],w_={key:4,class:"list-group-item d-flex justify-content-between align-items-center"},C_={class:"form-check"},S_={class:"form-check-label",for:"bot-user-in-location"},j_={key:0},q_={key:1},z_=e("i",{class:"fa-solid fa-trash-can"},null,-1),V_=[z_],P_={key:5,class:"list-group-item d-flex justify-content-between align-items-center"},O_=e("label",{class:"form-label",id:"bot-domain"}," Возраст от ",-1),U_=e("i",{class:"fa-solid fa-trash-can"},null,-1),A_=[U_],I_={key:6,class:"list-group-item d-flex justify-content-between align-items-center"},Q_=e("label",{class:"form-label",id:"bot-domain"}," Только для города ",-1),T_=e("i",{class:"fa-solid fa-trash-can"},null,-1),B_=[T_],R_={key:7,class:"list-group-item d-flex justify-content-between align-items-center"},M_={class:"form-check"},D_={class:"form-check-label",for:"bot-user-sex"},E_={key:0},L_={key:1},K_=e("i",{class:"fa-solid fa-trash-can"},null,-1),N_=[K_],J_={key:8,class:"list-group-item"},Y_={class:"mb-3"},H_={class:"d-flex justify-content-between align-items-center"},G_={class:"form-label d-flex w-100 align-items-center",id:"bot-order-channel"},W_=["onClick"],X_=e("i",{class:"fa-solid fa-trash-can"},null,-1),Z_=[X_],x_=["onUpdate:modelValue"],eh={key:3,class:"mt-5"},th={key:4,class:"d-flex justify-content-between"},sh={key:6,class:"py-2"},oh={class:"form-label",id:"bot-domain"},lh=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),ih=e("div",null,'Напишите текст, который будет отображен пользователю вместе с основным контентом в случае если условие не будет выполнено и будет вызван блок "иначе" ',-1),nh={props:["bot","rulesForm"],data(){return{rules:[{id:1,title:"Является администратором",rules_block:"bot_user",rule:{is_admin:!0}},{id:2,title:"Является VIP-пользователем",rules_block:"bot_user",rule:{is_vip:!0}},{id:3,title:"Находится в заведении",rules_block:"bot_user",rule:{user_in_location:!0}},{id:4,title:"За работой",rules_block:"bot_user",rule:{is_work:!0}},{id:5,title:"Возраст от ...",rules_block:"bot_user",rule:{age:18}},{id:6,title:"Находится в городе ...",rules_block:"bot_user",rule:{city:"Краснодар"}},{id:7,title:"Пол",rules_block:"bot_user",rule:{sex:!0}},{id:8,title:"Состоит в канале",rules_block:"channels",rule:{channel:1}},{id:9,title:"Является Менеджером",rules_block:"bot_user",rule:{is_manager:!0}}]}},computed:{rulesForCustomFields(){let s=this.rules.filter(t=>t.key!=null);return console.log("filtered rules",s),s}},mounted(){},methods:{hasRuleKey(s){return this.rulesForm.rules_if==null?!1:(console.log("key=>",s||"-"),Object.keys(this.rulesForm.rules_if.bot_user).find(t=>t===s)!=null)},modifyChannel(s){this.rulesForm.rules_if.channels[s.param]=s.text},removeChannelFromRule(s){this.rulesForm.rules_if.channels.splice(s,1)},removeRule(s){delete this.rulesForm.rules_if.bot_user[s]},addRules(s){this.rulesForm.rules_if||(this.rulesForm.rules_if={bot_user:{},channels:[]}),s.rules_block==="bot_user"&&(this.rulesForm.rules_if.bot_user={...this.rulesForm.rules_if.bot_user,...s.rule}),s.rules_block==="channels"&&this.rulesForm.rules_if.channels.push(s.rule.channel)},loadCurrentBotFields(){return this.$store.dispatch("loadCurrentBotFields",{bot_id:this.bot.id}).then(s=>{(s.data||[]).forEach(o=>{o.is_active&&(this.rules.push({id:this.rules.length+1,title:o.label,key:o.key,type:o.type,rules_block:"bot_user",rule:{}}),o.type===0&&(this.rules[this.rules.length-1].rule[o.key]=""),o.type===1&&(this.rules[this.rules.length-1].rule[o.key]=0),o.type===2&&(this.rules[this.rules.length-1].rule[o.key]=!0))}),console.log("new rules=>",this.rules)})},attachPageToRule(s){s.id!=this.rulesForm.id?this.rulesForm.rules_else_page_id=s.id:this.$notify({title:"Конструктор страниц",text:"Вы не можете связать данную страницу с собой",type:"error"})}}},ah=Object.assign(nh,{__name:"PageRules",setup(s){return(t,o)=>{const n=q("Popper");return l(),i(g,null,[Bm,Rm,s.rulesForm.rules_if?(l(),i("div",Mm,[e("label",Dm,[f(n,null,{content:v(()=>[Lm]),default:v(()=>[Em]),_:1}),m(" Сообщение при успешном прохождении условий (не обязательно) ")]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст сообщения","aria-label":"Текст сообщения","onUpdate:modelValue":o[0]||(o[0]=a=>s.rulesForm.rules_if_message=a),maxlength:"255","aria-describedby":"rules-else-message"},`
            `,512),[[h,s.rulesForm.rules_if_message]])])):r("",!0),e("div",Km,[Nm,e("ul",Jm,[(l(!0),i(g,null,y(t.rules,a=>(l(),i("li",null,[e("a",{onClick:d=>t.addRules(a),class:"dropdown-item",href:"javascript:void(0)"},u(a.title||"Не указан"),9,Ym)]))),256))])]),s.rulesForm.rules_if?(l(),i("h6",Hm,"Выбранные условия")):r("",!0),s.rulesForm.rules_if?(l(),i("ul",Gm,[t.hasRuleKey("is_vip")?(l(),i("li",Wm,[e("div",Xm,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[1]||(o[1]=a=>s.rulesForm.rules_if.bot_user.is_vip=a),type:"checkbox",id:"bot-user-is-vip"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_vip]]),e("label",Zm,[s.rulesForm.rules_if.bot_user.is_vip?(l(),i("span",xm,"Является VIP-пользователем")):(l(),i("span",e_,"Не является VIP-пользователем"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[2]||(o[2]=a=>t.removeRule("is_vip"))},s_)])):r("",!0),t.hasRuleKey("is_admin")?(l(),i("li",o_,[e("div",l_,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[3]||(o[3]=a=>s.rulesForm.rules_if.bot_user.is_admin=a),type:"checkbox",id:"bot-user-is-admin"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_admin]]),e("label",i_,[s.rulesForm.rules_if.bot_user.is_admin?(l(),i("span",n_,"Является администратором")):(l(),i("span",a_,"Не является администратором"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[4]||(o[4]=a=>t.removeRule("is_admin"))},r_)])):r("",!0),t.hasRuleKey("is_deliveryman")?(l(),i("li",c_,[e("div",u_,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[5]||(o[5]=a=>s.rulesForm.rules_if.bot_user.is_deliveryman=a),type:"checkbox",id:"bot-user-is-deliveryman"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_deliveryman]]),e("label",m_,[s.rulesForm.rules_if.bot_user.is_deliveryman?(l(),i("span",__,"Является доставщиком")):(l(),i("span",h_,"Не является доставщиком"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[6]||(o[6]=a=>t.removeRule("is_deliveryman"))},b_)])):r("",!0),t.hasRuleKey("is_work")?(l(),i("li",f_,[e("div",g_,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[7]||(o[7]=a=>s.rulesForm.rules_if.bot_user.is_work=a),type:"checkbox",id:"bot-user-is-work"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_work]]),e("label",v_,[s.rulesForm.rules_if.bot_user.is_work?(l(),i("span",$_,"За работой")):(l(),i("span",y_,"Не работает"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[8]||(o[8]=a=>t.removeRule("is_work"))},F_)])):r("",!0),t.hasRuleKey("user_in_location")?(l(),i("li",w_,[e("div",C_,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[9]||(o[9]=a=>s.rulesForm.rules_if.bot_user.user_in_location=a),type:"checkbox",id:"bot-user-in-location"},null,512),[[k,s.rulesForm.rules_if.bot_user.user_in_location]]),e("label",S_,[s.rulesForm.rules_if.bot_user.user_in_location?(l(),i("span",j_,"Находится в заведении")):(l(),i("span",q_,"Не находится в заведении"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[10]||(o[10]=a=>t.removeRule("user_in_location"))},V_)])):r("",!0),t.hasRuleKey("age")?(l(),i("li",P_,[e("div",null,[O_,c(e("input",{type:"text",class:"form-control",placeholder:"Возраст от","aria-label":"Возраст от","onUpdate:modelValue":o[11]||(o[11]=a=>s.rulesForm.rules_if.bot_user.age=a),maxlength:"255","aria-describedby":"bot-user-age"},null,512),[[h,s.rulesForm.rules_if.bot_user.age]])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[12]||(o[12]=a=>t.removeRule("age"))},A_)])):r("",!0),t.hasRuleKey("city")?(l(),i("li",I_,[e("div",null,[Q_,c(e("input",{type:"text",class:"form-control",placeholder:"Город","aria-label":"Город","onUpdate:modelValue":o[13]||(o[13]=a=>s.rulesForm.rules_if.bot_user.city=a),maxlength:"255","aria-describedby":"bot-user-city"},null,512),[[h,s.rulesForm.rules_if.bot_user.city]])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[14]||(o[14]=a=>t.removeRule("city"))},B_)])):r("",!0),t.hasRuleKey("sex")?(l(),i("li",R_,[e("div",M_,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[15]||(o[15]=a=>s.rulesForm.rules_if.bot_user.sex=a),type:"checkbox",id:"bot-user-sex"},null,512),[[k,s.rulesForm.rules_if.bot_user.sex]]),e("label",D_,[s.rulesForm.rules_if.bot_user.sex?(l(),i("span",E_,"Только для мужчин")):(l(),i("span",L_,"Только для женщин"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[16]||(o[16]=a=>t.removeRule("sex"))},N_)])):r("",!0),s.rulesForm.rules_if.channels.length>0?(l(),i("li",J_,[m("Проверка нахождения в канале \\ группе: "),(l(!0),i(g,null,y(s.rulesForm.rules_if.channels,(a,d)=>(l(),i("div",Y_,[e("div",H_,[e("label",G_,[f(oe,{token:s.bot.bot_token,param:`${d}`,onCallback:t.modifyChannel},null,8,["token","param","onCallback"]),m(" Канал для проверки ")]),e("button",{type:"button",class:"btn btn-link text-danger",onClick:_=>t.removeChannelFromRule(d)},Z_,8,W_)]),c(e("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":_=>s.rulesForm.rules_if.channels[d]=_,maxlength:"255","aria-describedby":"bot-order-channel"},null,8,x_),[[h,s.rulesForm.rules_if.channels[d]]])]))),256))])):r("",!0)])):r("",!0),s.rulesForm.rules_if?(l(),i("h6",eh,"Иначе")):r("",!0),s.rulesForm.rules_else_page_id?(l(),i("p",th,[m("Вы выбрали страницу #"+u(s.rulesForm.rules_else_page_id)+' в качестве условия "иначе" ',1),e("a",{href:"javascript:void(0)",onClick:o[17]||(o[17]=a=>s.rulesForm.rules_else_page_id=null)},"Очистить")])):r("",!0),s.rulesForm.rules_if?(l(),$(B,{key:5,current:s.rulesForm.id,onCallback:t.attachPageToRule,editor:!1},null,8,["current","onCallback"])):r("",!0),s.rulesForm.rules_if?(l(),i("div",sh,[e("label",oh,[f(n,null,{content:v(()=>[ih]),default:v(()=>[lh]),_:1}),m(" Сообщение в случае невыполнения условий (не обязательно) ")]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст сообщения","aria-label":"Текст сообщения","onUpdate:modelValue":o[18]||(o[18]=a=>s.rulesForm.rules_else_message=a),maxlength:"255","aria-describedby":"rules-else-message"},`
            `,512),[[h,s.rulesForm.rules_else_message]])])):r("",!0)],64)}}}),dh={class:"page-container"},rh={class:"page-content"},ch={class:"row"},uh={class:"col"},mh={class:"row"},_h={class:"col"},hh={class:"row"},ph={class:"col"},bh={class:"row"},fh={class:"col-12"},gh=["innerHTML"],vh={key:0,class:"row"},$h={class:"col-12"},yh={key:1,class:"row mt-2"},kh=e("p",{class:"mb-0"},[e("strong",null,"Нижнее меню")],-1),Fh={class:"col-12"},wh={props:["page"]},Ch=Object.assign(wh,{__name:"PagePreview",setup(s){return(t,o)=>{const n=Q("lazy");return l(),i("div",dh,[e("div",rh,[e("div",ch,[s.page.images?(l(!0),i(g,{key:0},y(s.page.images,(a,d)=>(l(),i("div",uh,[c(e("img",null,null,512),[[n,"/images-by-bot-id/"+s.page.bot_id+"/"+a]])]))),256)):r("",!0)]),e("div",mh,[s.page.videos?(l(!0),i(g,{key:0},y(s.page.videos,(a,d)=>(l(),i("div",_h,[f(J,{content:a,type:"video"},null,8,["content"])]))),256)):r("",!0)]),e("div",hh,[s.page.audios?(l(!0),i(g,{key:0},y(s.page.audios,(a,d)=>(l(),i("div",ph,[f(J,{content:a,type:"audio"},null,8,["content"])]))),256)):r("",!0)]),e("div",bh,[e("div",fh,[e("p",{innerHTML:s.page.content},null,8,gh)])])]),s.page.inlineKeyboard?(l(),i("div",vh,[e("div",$h,[s.page.inlineKeyboard.deleted_at?r("",!0):(l(),$(Y,{key:0,simple:!0,"select-mode":!0,keyboard:s.page.inlineKeyboard},null,8,["keyboard"]))])])):r("",!0),s.page.replyKeyboard?(l(),i("div",yh,[kh,e("div",Fh,[s.page.replyKeyboard.deleted_at?r("",!0):(l(),$(Y,{key:0,simple:!0,"select-mode":!0,keyboard:s.page.replyKeyboard},null,8,["keyboard"]))])])):r("",!0)])}}});const Sh={key:0,class:"row pt-3"},jh={class:"col-12"},qh={class:"alert alert-info",role:"alert"},zh=e("strong",null,"Внимание!",-1),Vh={style:{"font-size":"16px"}},Ph={key:0,class:"row"},Oh={class:"col-12 mb-2"},Uh=e("h6",null,"На странице выбраны следующие разделы",-1),Ah={class:"mini-pics justify-content-start d-inline-flex text-primary"},Ih=e("i",{class:"fa-regular fa-images"},null,-1),Qh=[Ih],Th=e("i",{class:"fa-regular fa-note-sticky"},null,-1),Bh=[Th],Rh=e("i",{class:"fa-solid fa-photo-film"},null,-1),Mh=[Rh],Dh=e("i",{class:"fa-regular fa-file-audio"},null,-1),Eh=[Dh],Lh=e("i",{class:"fa-regular fa-file-word"},null,-1),Kh=[Lh],Nh=e("i",{class:"fa-solid fa-link"},null,-1),Jh=[Nh],Yh=e("i",{class:"fa-solid fa-scroll"},null,-1),Hh=[Yh],Gh=e("i",{class:"fa-regular fa-comment-dots"},null,-1),Wh=[Gh],Xh=e("i",{class:"fa-solid fa-scale-balanced"},null,-1),Zh=[Xh],xh=e("i",{class:"fa-regular fa-keyboard"},null,-1),ep=[xh],tp=e("i",{class:"fa-solid fa-ellipsis"},null,-1),sp=[tp],op={class:"row"},lp={class:"col-md-8 col-12 mb-2"},ip={class:"form-label",id:"bot-domain"},np=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),ap=e("div",null,[m(" Команда должна начинаться с символа . и *"),e("br"),m(" Например: .*Меню"),e("br")],-1),dp=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),rp={class:"col-md-4 col-12 mb-2 d-flex justify-content-end align-items-end"},cp={class:"btn-group",style:{background:"white"},role:"group","aria-label":"Basic example"},up={key:0,type:"submit",title:"Сохранить страницу",id:"save-page-btn",class:"btn btn-primary min-menu-btn"},mp=e("i",{class:"fa-regular fa-floppy-disk"},null,-1),_p=[mp],hp=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),pp=[hp],bp=e("button",{type:"button",title:"Список страниц","data-bs-toggle":"offcanvas","data-bs-target":"#offcanvas",class:"btn btn-outline-primary text-primary min-menu-btn"},[e("i",{class:"fa-solid fa-list-ol"})],-1),fp={class:"row"},gp={class:"col-12 mb-2"},vp={class:"form-label d-flex justify-content-between align-items-center mb-0",id:"bot-domain"},$p=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),yp=e("div",null,[m(" Текстовый редактор. Данный текст будет в таком"),e("br"),m(" же виде отображен в посте в телеграм. ")],-1),kp=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Fp={class:"form-floating"},wp={for:"floatingTextarea2"},Cp={key:0},Sp={class:"col-12 mb-2"},jp={class:"nav nav-tabs justify-content-center"},qp=e("i",{class:"fa-regular fa-keyboard"},null,-1),zp=e("span",null,"Нижнее меню",-1),Vp=[qp,zp],Pp=e("i",{class:"fa-solid fa-ellipsis"},null,-1),Op=e("span",null,"Меню под текстом",-1),Up=[Pp,Op],Ap=e("i",{class:"fa-regular fa-images"},null,-1),Ip=e("span",null,"Изображения",-1),Qp=[Ap,Ip],Tp=e("i",{class:"fa-solid fa-photo-film"},null,-1),Bp=e("span",null,"Видео",-1),Rp=[Tp,Bp],Mp=e("i",{class:"fa-regular fa-note-sticky"},null,-1),Dp=e("span",null,"Стикеры",-1),Ep=[Mp,Dp],Lp=e("i",{class:"fa-regular fa-file-audio"},null,-1),Kp=e("span",null,"Аудио",-1),Np=[Lp,Kp],Jp=e("i",{class:"fa-regular fa-file-word"},null,-1),Yp=e("span",null,"Документы",-1),Hp=[Jp,Yp],Gp=e("i",{class:"fa-solid fa-link"},null,-1),Wp=e("span",null,"Другая страница",-1),Xp=[Gp,Wp],Zp=e("i",{class:"fa-solid fa-scroll"},null,-1),xp=e("span",null,"Скрипт",-1),eb=[Zp,xp],tb=e("i",{class:"fa-regular fa-comment-dots"},null,-1),sb=e("span",null,"Начало диалога",-1),ob=[tb,sb],lb=e("i",{class:"fa-solid fa-scale-balanced"},null,-1),ib=e("span",null,"Правила",-1),nb=[lb,ib],ab={key:0,class:"col-12 mb-2"},db={class:"form-check"},rb=e("label",{class:"form-check-label",for:"need-reply-menu"}," Нижнее меню страницы ",-1),cb={key:1,class:"col-12 mb-2"},ub={class:"card"},mb={class:"card-header d-flex justify-between align-items-center"},_b=e("h6",null,"Конструктор нижнего меню",-1),hb={key:0},pb={key:1},bb={class:"card-body"},fb={class:"row"},gb={class:"col-12 mb-2"},vb={class:"form-label",id:"bot-domain"},$b=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),yb=e("div",null," Заголовок для нижнего меню ",-1),kb={key:2,class:"col-12 mb-2"},Fb={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},wb={class:"d-flex justify-content-center mb-3"},Cb={alt:"",width:"100",height:"100"},Sb=e("h1",{class:"text-body-emphasis"},"Нижнее меню",-1),jb=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"}," Создание и настройка нижнего меню страницы бота. Добавление и редактирование функций кнопок бота на странице. Данное меню отображается пользователю всегда. ",-1),qb={class:"d-inline-flex gap-2 mb-5"},zb=["disabled"],Vb=e("a",{href:"https://telegra.ph/Nizhnee-menyu-bota-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),Pb={key:0,class:"col-12 mb-2"},Ob={class:"form-check"},Ub=e("label",{class:"form-check-label",for:"need-inline-menu"}," Меню под текстом страницы ",-1),Ab={key:1,class:"col-12 mb-2"},Ib={class:"card"},Qb={class:"card-header d-flex justify-between align-items-center"},Tb=e("h6",null,"Конструктор меню в сообщении",-1),Bb={key:0},Rb={key:1},Mb={class:"card-body"},Db={key:2,class:"col-12 mb-2"},Eb={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},Lb={class:"d-flex justify-content-center mb-3"},Kb={alt:"",width:"100",height:"100"},Nb=e("h1",{class:"text-body-emphasis"},"Меню под текстом",-1),Jb=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"}," В отличии от нижнего меню, которое отображается всегда, меню под текстом показывается под контентом только в момент отображения этого контента. ",-1),Yb={class:"d-inline-flex gap-2 mb-5"},Hb=["disabled"],Gb=e("a",{href:"https://telegra.ph/Menyu-k-tekstu-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),Wb={key:0,class:"col-12 mb-2"},Xb={class:"form-check"},Zb=e("label",{class:"form-check-label",for:"need-page-images"}," Изображения на странице (максимум 10) ",-1),xb={key:1,class:"col-12 mb-2"},ef={class:"card mb-3"},tf=e("div",{class:"card-header"},[e("h6",null,"Загрузите изображения с файловой системы")],-1),sf={class:"card-body d-flex justify-content-start"},of={for:"photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},lf={class:"row"},nf={key:0,class:"col-12 d-flex flex-wrap"},af={class:"mb-2 img-preview",style:{"margin-right":"10px"}},df={class:"remove"},rf=["onClick"],cf={key:1},uf={key:2,class:"col-12 d-flex flex-wrap"},mf={class:"mb-2 img-preview",style:{"margin-right":"10px"}},_f={class:"remove"},hf=["onClick"],pf={key:2,class:"col-12 mb-2"},bf={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},ff={class:"d-flex justify-content-center mb-3"},gf={alt:"",width:"100",height:"100"},vf=e("h1",{class:"text-body-emphasis"},"Изображения",-1),$f=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"},[m(" Вы можете добавить к одной странице от "),e("b",null,"1"),m(" до "),e("b",null,"10"),m(" изображений. Изображения (от 2х) будут собраны в группу и показаны под текстовым содержимым страницы. Если изображение одно, то текст будет отображен под ним. ")],-1),yf={class:"d-inline-flex gap-2 mb-5"},kf=["disabled"],Ff=e("a",{href:"https://telegra.ph/Dobavlenie-izobrazhenij-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),wf={key:0,class:"col-12 mb-2"},Cf={class:"form-check"},Sf=e("label",{class:"form-check-label",for:"need-page-video"}," Видео к странице ",-1),jf={key:1,class:"col-12 mb-2"},qf={key:2,class:"col-12 mb-2"},zf={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},Vf={class:"d-flex justify-content-center mb-3"},Pf={alt:"",width:"100",height:"100"},Of=e("h1",{class:"text-body-emphasis"},"Видео",-1),Uf=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"},[m(" Вы можете добавить к одной странице от "),e("b",null,"1"),m(" до "),e("b",null,"10"),m(" видео. Ролики (от 2х) будут собраны в группу и показаны под текстовым содержимым страницы. ")],-1),Af={class:"d-inline-flex gap-2 mb-5"},If=["disabled"],Qf=e("a",{href:"https://telegra.ph/Dobavlenie-video-na-stranicu-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),Tf={key:0,class:"col-12 mb-2"},Bf={class:"form-check"},Rf=e("label",{class:"form-check-label",for:"need-page-sticker"}," Стикер к странице ",-1),Mf={key:1,class:"col-12 mb-2"},Df={key:2,class:"col-12 mb-2"},Ef={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},Lf={class:"d-flex justify-content-center mb-3"},Kf={alt:"",width:"100",height:"100"},Nf=e("h1",{class:"text-body-emphasis"},"Стикеры",-1),Jf=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"}," Вы можете переслать любой стикер в бота (от лица администратора) и затем этот стикер использовать для взаимодействия с пользователем. ",-1),Yf={class:"d-inline-flex gap-2 mb-5"},Hf=["disabled"],Gf=e("a",{href:"https://telegra.ph/Dobavlenie-stikera-na-stranicu-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),Wf={key:0,class:"col-12 mb-2"},Xf={class:"form-check"},Zf=e("label",{class:"form-check-label",for:"need-page-audio"}," Звук к странице ",-1),xf={key:1,class:"col-12 mb-2"},e1={key:2,class:"col-12 mb-2"},t1={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},s1={class:"d-flex justify-content-center mb-3"},o1={alt:"",width:"100",height:"100"},l1=e("h1",{class:"text-body-emphasis"},"Аудио",-1),i1=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"},[m(" Вы можете добавить к одной странице от "),e("b",null,"1"),m(" до "),e("b",null,"10"),m(" аудио. Музыка (от 2х) будет собрана в группу и показана под текстовым содержимым страницы. Если вы хотите использовать "),e("b",{class:"text-danger"},"голосовое"),m(", то можно использовать максимум "),e("b",{class:"text-danger"},"одну запись"),m(". Или же, вы можете конвертировать её в mp3 и залить как музыкальный файл в бота. ")],-1),n1={class:"d-inline-flex gap-2 mb-5"},a1=["disabled"],d1=e("a",{href:"https://telegra.ph/Dobavlenie-audio-na-stranicu-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),r1={key:0,class:"col-12 mb-2"},c1={class:"form-check"},u1=e("label",{class:"form-check-label",for:"need-page-document"}," Документ \\ презентацию к странице \\ картинку в оригинале ",-1),m1={key:1,class:"col-12 mb-2"},_1={key:2,class:"col-12 mb-2"},h1={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},p1={class:"d-flex justify-content-center mb-3"},b1={alt:"",width:"100",height:"100"},f1=e("h1",{class:"text-body-emphasis"},"Документы",-1),g1=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"},[m(" Вы можете добавить к одной странице от "),e("b",null,"1"),m(" до "),e("b",null,"10"),m(" документов. Документы (от 2х) будут собраны в группу и показана под текстовым содержимым страницы. В качестве файлов вы можете использовать текстовые документы, презентации, файлы-pdf, изображения в оригинальном размере. ")],-1),v1={class:"d-inline-flex gap-2 mb-5"},$1=["disabled"],y1=e("a",{href:"https://telegra.ph/Dobavlenie-dokumenta-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),k1={class:"col-12 mb-2"},F1={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},w1={class:"d-flex justify-content-center mb-3"},C1={alt:"",width:"100",height:"100"},S1=e("h1",{class:"text-body-emphasis"},"Связь со страницей",-1),j1=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"}," Вы можете привязать вызов другой страницы непосредственно после вызова текущей. Это позволит выводить контент по цепочке для пользователя. ",-1),q1={key:0,class:"my-3 text-success font-bold"},z1={class:"d-inline-flex gap-2 mb-5"},V1={key:1,"data-bs-toggle":"modal","data-bs-target":"#page-list-modal",class:"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill btn-primary",type:"button"},P1=e("a",{href:"https://telegra.ph/Svyazyvanie-so-stranicej-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),O1=e("h6",{class:"mb-3"},"Конструктор цепочек",-1),U1={class:"d-flex justify-content-center align-items-center flex-wrap"},A1=e("span",{class:"px-2"},"Текущая страница",-1),I1=e("i",{class:"fa-solid fa-arrow-right"},null,-1),Q1={class:"d-flex justify-content-center align-items-center px-3 py-2"},T1=["onClick"],B1={class:"position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"},R1={key:0,class:"fa-solid fa-arrow-right ml-2"},M1={key:0,class:"fa-solid fa-arrow-right"},D1=e("button",{type:"button","data-bs-toggle":"modal","data-bs-target":"#page-list-modal",class:"btn btn-outline-secondary position-relative rounded-5 ml-5"},[e("i",{class:"fa-solid fa-plus"})],-1),E1={key:0,class:"col-12 mb-2"},L1=e("div",{class:"alert alert-info",role:"alert"}," Если в вашем боте нет каких-то предустановленных скриптов вы можете найти их в глобальном магазине скриптов ",-1),K1={class:"form-check"},N1=e("label",{class:"form-check-label",for:"need-show-global-slug-list"}," Добавить скрипты из глобального магазина? ",-1),J1={key:1,class:"col-12 mb-2"},Y1={class:"form-check"},H1=e("label",{class:"form-check-label",for:"need-slug-attach"}," Привязать скрипт ",-1),G1={key:2,class:"col-12 mb-2"},W1={key:0,class:"alert alert-success d-flex justify-content-between align-items-center",role:"alert"},X1={key:3,class:"col-12 mb-2"},Z1={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},x1={class:"d-flex justify-content-center mb-3"},eg={alt:"",width:"100",height:"100"},tg=e("h1",{class:"text-body-emphasis"},"Скрипты",-1),sg=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"}," Скрипты содержат основной функционал системы. Вы можете к каждой странице привязать один скрипт, который будет вызван после вывода основного содержимого страницы. ",-1),og={class:"d-inline-flex gap-2 mb-5"},lg=["disabled"],ig=e("a",{href:"https://telegra.ph/Svyazyvanie-so-skriptom-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),ng={key:0,class:"col-12 mb-2"},ag={class:"form-check"},dg=e("label",{class:"form-check-label",for:"need-dialog-attach"}," Привязать начало диалога ",-1),rg={key:1,class:"col-12 mb-2"},cg={key:0},ug={key:2,class:"col-12 mb-2"},mg={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},_g={class:"d-flex justify-content-center mb-3"},hg={alt:"",width:"100",height:"100"},pg=e("h1",{class:"text-body-emphasis"},"Диалоги",-1),bg=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"}," Диалоги страницы - это инструмент запроса данных от пользователя. Вы можете привязать начало диалога к странице, а сам диалог будет вызван по цепочке. ",-1),fg={class:"d-inline-flex gap-2 mb-5"},gg=["disabled"],vg=e("a",{href:"https://telegra.ph/Dobavlenie-dialoga-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),$g={key:0,class:"col-12 mb-2"},yg={class:"form-check"},kg=e("label",{class:"form-check-label",for:"need-rules"}," Нужны правила загрузки страницы ",-1),Fg={key:1,class:"col-12 mb-2"},wg={key:2,class:"col-12 mb-2"},Cg={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},Sg={class:"d-flex justify-content-center mb-3"},jg={alt:"",width:"100",height:"100"},qg=e("h1",{class:"text-body-emphasis"},"Правила отображения страницы",-1),zg=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"}," Вы можете создать правила, согласно которым будет отображена та или иная страница. Вы можете перенаправить пользователя с одной страницы на другую, в случае если ваше условие не выполнено. ",-1),Vg={class:"d-inline-flex gap-2 mb-5"},Pg=["disabled"],Og=e("a",{href:"https://telegra.ph/Pravila-na-stranice-01-03",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),Ug=e("div",{class:"row"},[e("div",{class:"col-12"},[e("div",{class:"alert alert-info",role:"alert"},[e("h6",null,"Страница поддерживает комбинации клавиш:"),e("ul",{class:"mb-0 mr-0 p-0"},[e("li",null,[e("strong",null,"Ctrl+S"),m(" - открыть\\закрыть окно сохранения")]),e("li",null,[e("strong",null,"Ctrl+D"),m(" - просмотр страницы (для сохраненных страниц)")]),e("li",null,[e("strong",null,"Ctrl+пробел"),m(" - открыть\\закрыть список страниц")]),e("li",null,[e("strong",null,"Ctrl+backspace"),m(" - очистить страницу\\новая страница")]),e("li",null,[e("strong",null,"Ctrl+стрелка вправо"),m(" - переключение между вкладка вперед")]),e("li",null,[e("strong",null,"Ctrl+стрелка влево"),m(" - переключение между вкладка назад")])])])])],-1),Ag={class:"modal fade",id:"save-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Ig={class:"modal-dialog"},Qg={class:"modal-content"},Tg=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"Сохранение страницы"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Bg={class:"modal-body"},Rg={key:0,class:"row"},Mg={class:"col-12 mb-2"},Dg={class:"d-flex justify-between"},Eg=["href"],Lg={class:"col-12 mb-2"},Kg=e("h6",null,"На странице выбраны следующие разделы",-1),Ng={class:"mini-pics text-primary"},Jg=e("i",{class:"fa-regular fa-images"},null,-1),Yg=[Jg],Hg=e("i",{class:"fa-regular fa-note-sticky"},null,-1),Gg=[Hg],Wg=e("i",{class:"fa-solid fa-photo-film"},null,-1),Xg=[Wg],Zg=e("i",{class:"fa-regular fa-file-audio"},null,-1),xg=[Zg],ev=e("i",{class:"fa-regular fa-file-word"},null,-1),tv=[ev],sv=e("i",{class:"fa-solid fa-link"},null,-1),ov=[sv],lv=e("i",{class:"fa-solid fa-scroll"},null,-1),iv=[lv],nv=e("i",{class:"fa-regular fa-comment-dots"},null,-1),av=[nv],dv=e("i",{class:"fa-solid fa-scale-balanced"},null,-1),rv=[dv],cv=e("i",{class:"fa-regular fa-keyboard"},null,-1),uv=[cv],mv=e("i",{class:"fa-solid fa-ellipsis"},null,-1),_v=[mv],hv={key:0,class:"col-12 mb-2"},pv={class:"form-check"},bv=e("label",{class:"form-check-label",for:"need-show-qr-and-link"}," Показать ссылку на страницу и QR-код ",-1),fv={key:1,class:"col-12 mb-2"},gv={class:"d-flex justify-content-center"},vv={style:{width:"200px",height:"200px"}},$v={class:"col-12 mb-2"},yv={class:"form-label",id:"bot-domain"},kv=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Fv=e("div",null,"Напишите для себя пояснение для чего нужна данная страница. Это поможет другим менеджерам лучше понять Вас. ",-1),wv=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Cv={class:"col-12"},Sv={class:"form-check"},jv=e("label",{class:"form-check-label",for:"is-external"}," Внешнее управление страницей ",-1),qv={key:0,class:"alert alert-danger",role:"alert"},zv={key:0,class:"mb-0"},Vv=e("strong",null,'"Информация о боте"',-1),Pv=e("strong",null,"Другие настройки",-1),Ov=e("strong",null,'"Ссылка на внешний сервис обработки данных"',-1),Uv={class:"col-12"},Av={class:"form-check"},Iv=e("label",{class:"form-check-label",for:"need_log_user_action"}," Логгировать действия пользователя в канал при переходе ",-1),Qv={class:"col-12"},Tv={class:"form-check"},Bv=e("label",{class:"form-check-label",for:"need-stay-after-save"}," Остаться на текущей странице после сохранения ",-1),Rv=e("div",{class:"col-12"},[e("button",{type:"submit",id:"submit-page",class:"btn btn-success w-100 p-3"},"Сохранить ")],-1),Mv=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Не сохранять")],-1),Dv={class:"modal fade",id:"page-list-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Ev={class:"modal-dialog"},Lv={class:"modal-content"},Kv={class:"modal-body"},Nv={class:"modal fade",id:"page-preview-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Jv={class:"modal-dialog"},Yv={class:"modal-content"},Hv={class:"modal-body"},Gv={key:1},Wv={class:"offcanvas offcanvas-end w-25",tabindex:"-1",id:"offcanvas","data-bs-keyboard":"true","data-bs-scroll":"true","data-bs-backdrop":"true"},Xv=e("div",{class:"offcanvas-header"},[e("h6",{class:"offcanvas-title d-none d-sm-block",id:"offcanvas"},"Ваши страницы (кнопки)"),e("button",{type:"button",class:"btn-close text-reset","data-bs-dismiss":"offcanvas","aria-label":"Close"})],-1),Zv={class:"offcanvas-body"},xv={class:"row"},e$={class:"col-12"},t$={data(){return{tab:0,links:[],saveModal:null,pageModal:null,pagePreviewModal:null,page:null,need_show_qr_and_link:!1,need_stay_after_save:!0,need_show_global_slug_list:!1,need_clean:!1,load:!1,photos:[],showReplyTemplateSelector:!1,showInlineTemplateSelector:!1,loaded_page_list:!0,load_slug_simple_list:!0,showMenu:!1,need_page_sticker:!1,need_page_audios:!1,need_page_documents:!1,need_page_video:!1,need_page_images:!1,need_inline_menu:!1,need_reply_menu:!1,need_attach_page:!1,need_attach_dialog:!1,need_attach_slug:!1,need_rules:!1,bot:null,pageForm:{id:null,content:"",command:null,slug:null,comment:null,videos:[],images:[],audios:[],documents:[],sticker:null,reply_keyboard_title:null,reply_keyboard:null,reply_keyboard_settings:null,inline_keyboard:null,is_external:!1,need_log_user_action:!1,next_page_id:null,next_bot_dialog_command_id:null,next_bot_menu_slug_id:null,rules_if:null,rules_else_page_id:null,rules_if_message:null,rules_else_message:null}}},watch:{need_page_images:function(s,t){this.need_page_images||(this.photos=[],this.pageForm.images=[])},need_page_audios:function(s,t){this.need_page_audios||(this.pageForm.audios=[])},need_page_documents:function(s,t){this.need_page_documents||(this.pageForm.documents=[])},need_page_sticker:function(s,t){this.need_page_sticker||(this.pageForm.sticker=null)},need_page_video:function(s,t){this.need_page_video||(this.pageForm.videos=[])},need_inline_menu:function(s,t){this.need_inline_menu||(this.pageForm.inline_keyboard=null,this.pageForm.inline_keyboard_id=null)},need_rules:function(s,t){this.need_rules||(this.pageForm.rules_if=null,this.pageForm.rules_else_page_id=null,this.pageForm.rules_if_message=null,this.pageForm.rules_else_message=null)},need_reply_menu:function(s,t){this.need_reply_menu||(this.pageForm.reply_keyboard=null,this.pageForm.reply_keyboard_id=null)},need_attach_page:function(s,t){this.need_attach_page||(this.pageForm.next_page_id=null)},need_attach_dialog:function(s,t){this.need_attach_dialog||(this.pageForm.next_bot_dialog_command_id=null)},need_attach_slug:function(s,t){this.need_attach_slug||(this.pageForm.next_bot_menu_slug_id=null)},pageForm:{handler:function(s){this.pageForm.reply_keyboard!=null&&(this.need_reply_menu=!0),this.pageForm.inline_keyboard!=null&&(this.need_inline_menu=!0),this.pageForm.images.length>0&&(this.need_page_images=!0),this.pageForm.next_bot_dialog_command_id!=null&&(this.need_attach_dialog=!0),this.pageForm.next_bot_menu_slug_id!=null&&(this.need_attach_slug=!0),this.pageForm.next_page_id!=null&&(this.need_attach_page=!0),this.pageForm.rules_if!=null&&(this.need_rules=!0),this.pageForm.videos.length>0&&(this.need_page_video=!0),this.pageForm.audios.length>0&&(this.need_page_audios=!0),this.pageForm.documents.length>0&&(this.need_page_documents=!0),this.pageForm.sticker&&(this.need_page_sticker=!0),this.need_clean=!0},deep:!0}},computed:{...C(["getCurrentBot"]),qr(){return"https://api.qrserver.com/v1/create-qr-code/?size=450x450&qzone=2&data="+this.link},selectedLinkIds(){let s=this.links.map(t=>t.id);return this.page==null?s:this.page.id!=null?[this.page.id,...s]:s},hasParts(){return this.need_page_sticker||this.need_page_audios||this.need_page_documents||this.need_page_video||this.need_page_images||this.need_inline_menu||this.need_reply_menu||this.need_attach_page||this.need_attach_dialog||this.need_attach_slug||this.need_rules},pageLink(){if(!this.pageForm.id)return"Ссылка недоступна";let s="";for(let t=0;t<10-(""+this.pageForm.id).length;t++)s+="0";return s+=this.pageForm.id,"https://t.me/"+this.getCurrentBot.bot_domain+"?start="+btoa("004"+s)}},mounted(){this.page?this.preparePageForm(this.page):this.clearForm(),this.loadCurrentBot().then(()=>{this.saveModal=new bootstrap.Modal(document.getElementById("save-modal"),{})}),this.pageModal=new bootstrap.Offcanvas(document.getElementById("offcanvas"),{scroll:!0}),this.pagePreviewModal=new bootstrap.Modal(document.getElementById("page-preview-modal"),{}),window.addEventListener("keydown",s=>{if(s.ctrlKey&&s.keyCode==8&&(s.preventDefault(),this.clearForm()),s.ctrlKey&&s.code=="KeyD"&&(s.preventDefault(),this.pagePreviewModal.toggle()),s.ctrlKey&&s.keyCode==32&&(s.preventDefault(),this.pageModal.toggle()),s.ctrlKey&&s.code=="KeyS"){s.preventDefault();const t=document.querySelector("#save-page-btn");t?t.click():this.$notify({title:"Конструктор страниц",text:"Вы еще не начали создавать страницу!",type:"warning"})}s.ctrlKey&&s.keyCode==39&&(s.preventDefault(),this.tab===10?this.tab=0:this.tab++),s.ctrlKey&&s.keyCode==37&&(s.preventDefault(),this.tab===0?this.tab=10:this.tab--)})},methods:{chainCollapseTest(s){return this.page==null?this.links.filter(t=>t.id==s.id).length>1:[this.page,...this.links].filter(t=>t.id==s.id).length>1},loadPageChains(){return this.$store.dispatch("loadPageChains",{dataObject:{start_page_id:this.page.id}}).then(s=>{this.links=s.data})},removeLink(s){this.links.splice(s,1)},loadSlugs(){this.load_slug_simple_list=!1,this.need_show_global_slug_list=!1,this.$nextTick(()=>{this.load_slug_simple_list=!0})},preparePageForm(s){this.links=[],this.page=s,this.photos=[],this.$nextTick(()=>{this.pageForm={id:s.id,slug_id:s.slug?s.slug.id:null,content:s.content,command:s.slug?s.slug.command:null,slug:s.slug?s.slug.slug:null,comment:s.slug?s.slug.comment:null,images:s.images||[],sticker:s.sticker||null,reply_keyboard_title:s.reply_keyboard_title||null,reply_keyboard_id:s.reply_keyboard_id||null,inline_keyboard_id:s.inline_keyboard_id||null,reply_keyboard:s.replyKeyboard||null,inline_keyboard:s.inlineKeyboard||null,next_page_id:s.next_page_id||null,next_bot_dialog_command_id:s.next_bot_dialog_command_id||null,next_bot_menu_slug_id:s.next_bot_menu_slug_id||null,is_external:s.is_external||!1,need_log_user_action:s.need_log_user_action||!1,rules_if:s.rules_if||null,rules_else_page_id:s.rules_else_page_id||null,audios:s.audios||[],documents:s.documents||[],videos:s.videos||[],rules_if_message:s.rules_if_message||null,rules_else_message:s.rules_else_message||null},this.pageForm.id!=null&&this.pageForm.next_page_id!=null&&this.loadPageChains()})},copyToClipBoard(s){navigator.clipboard.writeText(s).then(()=>{this.$notify({title:"Копирование",text:"Ссылка скопирована в буфер"})}).catch(t=>{this.$notify({title:"Копирование",text:"Ошибка копирования",type:"error"})})},associateDialog(s){this.pageForm.next_bot_dialog_command_id=s.id},associateSlug(s){this.pageForm.next_bot_menu_slug_id=s.id},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},clearLinks(){this.links=[],this.pageForm.next_page_id=null},attachPage(s){this.links.length==0&&(s.id!=this.pageForm.id?(this.$notify({title:"Конструктор страниц",text:"Вы успешно связали страницы!",type:"success"}),this.pageForm.next_page_id=s.id):this.$notify({title:"Конструктор страниц",text:"Вы не можете связать данную страницу с собой",type:"error"})),(this.page==null?this.links.findIndex(o=>o.id===s.id)!=-1:this.links.findIndex(o=>o.id===s.id)!=-1||s.id===this.page.id)||this.links.push(s)},injectContent(s){this.pageForm.content?this.pageForm.content+=s.text:this.pageForm.content=s.text},clearForm(){this.photos=[],this.pageForm={id:null,content:null,command:null,slug:null,comment:null,sticker:null,images:[],reply_keyboard:null,inline_keyboard:null,is_external:!1,need_log_user_action:!1,videos:[],audios:[],documents:[],reply_keyboard_title:null,reply_keyboard_id:null,inline_keyboard_id:null,next_page_id:null,next_menu_slug:null,next_bot_dialog_command_id:null,next_bot_menu_slug_id:null,rules_if_message:null,rules_else_message:null},this.photos=[],this.showReplyTemplateSelector=!1,this.showInlineTemplateSelector=!1,this.need_page_images=!1,this.need_page_video=!1,this.need_inline_menu=!1,this.need_reply_menu=!1,this.need_attach_page=!1,this.need_attach_dialog=!1,this.need_attach_slug=!1,this.need_rules=!1,this.need_page_audios=!1,this.need_page_documents=!1,this.need_page_sticker=!1,this.links=[],this.$nextTick(()=>{this.need_clean=!1})},openSaveModal(){(this.pageForm.comment||"").length===0&&(this.pageForm.comment=this.pageForm.command),this.saveModal.show()},submitPage(){let s=new FormData;if(Object.keys(this.pageForm).forEach(t=>{const o=this.pageForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.bot&&s.append("bot_id",this.bot.id),this.photos.length>0)for(let t=0;t<this.photos.length;t++)s.append("photos[]",this.photos[t]);this.$store.dispatch(this.pageForm.id==null?"createPage":"updatePage",{pageForm:s}).then(t=>{this.pageForm.id==null&&this.preparePageForm(t.data),this.links.length>0&&this.$store.dispatch("storePageChains",{dataObject:{start_page_id:t.data.id,links:this.links.map(o=>o.id)}}),this.need_stay_after_save||(this.load=!0,this.$nextTick(()=>{this.load=!1,this.clearForm()})),this.loaded_page_list=!1,this.$nextTick(()=>{this.loaded_page_list=!0}),this.saveModal.hide(),this.$emit("callback",t.data),this.$notify({title:"Конструктор ботов",text:this.pageForm.id==null?"Страница успешно создана!":"Страница успешно обновлена!",type:"success"}),this.$store.dispatch("loadPages",{dataObject:{botId:this.bot.id,needNewFirst:!0},page:localStorage.getItem(`cashman_pagelist_${this.bot.id}_page_index`)||0})}).catch(t=>{})},saveInlineKeyboard(s){this.pageForm.inline_keyboard=s},selectReplyKeyboard(s){this.pageForm.reply_keyboard=s,this.showReplyTemplateSelector=!1},selectInlineKeyboard(s){this.pageForm.inline_keyboard=s,this.showInlineTemplateSelector=!1},saveReplyKeyboard(s){this.pageForm.reply_keyboard=s},saveReplyKeyboardSettings(s){this.pageForm.reply_keyboard_settings=s},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removePhoto(s){this.photos.splice(s,1)},removeImage(s){this.pageForm.images.splice(s,1)},onChangePhotos(s){const t=s.target.files;for(let o=0;o<t.length;o++)this.photos.push(t[o])},onChange(s){this.pageForm.content=s},selectPhoto(s){this.pageForm.images||(this.pageForm.images=[]);let t=this.pageForm.images.indexOf(s.file_id);t!==-1?this.pageForm.images.splice(t,1):this.pageForm.images.push(s.file_id)},selectSticker(s){this.pageForm.sticker=s.file_id},selectVideo(s){this.pageForm.videos||(this.pageForm.videos=[]);let t=this.pageForm.videos.indexOf(s.file_id);t!==-1?this.pageForm.videos.splice(t,1):this.pageForm.videos.push(s.file_id)},selectAudio(s){this.pageForm.audios||(this.pageForm.audios=[]);let t=this.pageForm.audios.indexOf(s.file_id);if(s.type==="voice"){if(t!==-1){this.pageForm.audios.splice(t,1);return}this.pageForm.audios=[s.file_id];return}t!==-1?this.pageForm.audios.splice(t,1):this.pageForm.audios.push(s.file_id)},selectDocument(s){this.pageForm.documents||(this.pageForm.documents=[]);let t=this.pageForm.documents.indexOf(s.file_id);t!==-1?this.pageForm.documents.splice(t,1):this.pageForm.documents.push(s.file_id)},pageListCallback(s){this.$notify("Вы выбрали страницу из списка! Все остальные действия будут производится для этой страницы"),this.load=!0,this.preparePageForm(s),this.$nextTick(()=>{this.load=!1})}}},s$=Object.assign(t$,{__name:"Page",setup(s){return(t,o)=>{const n=q("Popper"),a=Q("lazy");return l(),i(g,null,[t.pageForm.id?(l(),i("div",Sh,[e("div",jh,[e("div",qh,[zh,m(" Вы в режиме редактирования страницы (кнопки) "),e("strong",Vh,u(t.page.slug?t.page.slug.command:"Без названия"),1),m(", если хотите создать новую нажмите "),e("a",{href:"javascript:void(0)",class:"btn btn-primary ml-2",onClick:o[0]||(o[0]=(...d)=>t.clearForm&&t.clearForm(...d))},"Создать новую страницу")])])])):r("",!0),t.bot?(l(),i("form",{key:1,id:"page-construct",class:"py-3",onSubmit:o[43]||(o[43]=S((...d)=>t.openSaveModal&&t.openSaveModal(...d),["prevent"]))},[t.hasParts?(l(),i("div",Ph,[e("div",Oh,[Uh,e("ul",Ah,[e("li",{class:b(["mr-1",{active:t.need_page_images}]),title:"Изображения"},Qh,2),e("li",{class:b(["mr-1",{active:t.need_page_sticker}]),title:"Стикеры"},Bh,2),e("li",{class:b(["mr-1",{active:t.need_page_video}]),title:"Видео"},Mh,2),e("li",{class:b(["mr-1",{active:t.need_page_audios}]),title:"Аудио"},Eh,2),e("li",{class:b(["mr-1",{active:t.need_page_documents}]),title:"Документы"},Kh,2),e("li",{class:b(["mr-1",{active:t.need_attach_page}]),title:"Страницы"},Jh,2),e("li",{class:b(["mr-1",{active:t.need_attach_slug}]),title:"Скрипты"},Hh,2),e("li",{class:b(["mr-1",{active:t.need_attach_dialog}]),title:"Диалоги"},Wh,2),e("li",{class:b(["mr-1",{active:t.need_rules}]),title:"Правила"},Zh,2),e("li",{class:b(["mr-1",{active:t.need_reply_menu}]),title:"Нижнее меню"},ep,2),e("li",{title:"Текстовое меню",class:b({active:t.need_inline_menu})},sp,2)])])])):r("",!0),e("div",op,[e("div",lp,[e("label",ip,[f(n,null,{content:v(()=>[ap]),default:v(()=>[np]),_:1}),m(" Команда "),dp]),c(e("input",{type:"text",class:"form-control",placeholder:"Команда","aria-label":"Команда","onUpdate:modelValue":o[1]||(o[1]=d=>t.pageForm.command=d),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[h,t.pageForm.command]])]),e("div",rp,[e("div",cp,[t.pageForm.id||t.need_clean?(l(),i("button",up,_p)):r("",!0),t.pageForm.id||t.need_clean?(l(),i("button",{key:1,type:"button",onClick:o[2]||(o[2]=(...d)=>t.clearForm&&t.clearForm(...d)),title:"Очистить \\ Новая страница",class:"btn btn-outline-primary min-menu-btn"},pp)):r("",!0),bp])])]),c(e("div",fp,[e("div",gp,[e("label",vp,[e("div",null,[f(n,null,{content:v(()=>[yp]),default:v(()=>[$p]),_:1}),m(" Текстовое содержимое страницы "),kp]),f(kt,{param:"content",onCallback:t.injectContent},null,8,["onCallback"])]),e("div",Fp,[c(e("textarea",{class:"form-control","onUpdate:modelValue":o[3]||(o[3]=d=>t.pageForm.content=d),maxlength:"4096",placeholder:"Введите текст",id:"floatingTextarea2",style:{"min-height":"150px"}},null,512),[[h,t.pageForm.content]]),e("label",wp,[m("Содержимое страницы "),t.pageForm.content?(l(),i("span",Cp,u(t.pageForm.content.length)+"/4096 ",1)):r("",!0)])])]),e("div",Sp,[e("ul",jp,[e("li",{class:"nav-item",onClick:o[4]||(o[4]=d=>t.tab=0)},[e("a",{class:b([{active:t.tab===0,"primary-mark":t.need_reply_menu},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},Vp,2)]),e("li",{class:"nav-item",onClick:o[5]||(o[5]=d=>t.tab=1)},[e("a",{class:b([{active:t.tab===1,"primary-mark":t.need_inline_menu},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},Up,2)]),e("li",{class:"nav-item",onClick:o[6]||(o[6]=d=>t.tab=2)},[e("a",{class:b([{active:t.tab===2,"primary-mark":t.need_page_images},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},Qp,2)]),e("li",{class:"nav-item",onClick:o[7]||(o[7]=d=>t.tab=3)},[e("a",{class:b([{active:t.tab===3,"primary-mark":t.need_page_video},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},Rp,2)]),e("li",{class:"nav-item",onClick:o[8]||(o[8]=d=>t.tab=4)},[e("a",{class:b([{active:t.tab===4,"primary-mark":t.need_page_sticker},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},Ep,2)]),e("li",{class:"nav-item",onClick:o[9]||(o[9]=d=>t.tab=5)},[e("a",{class:b([{active:t.tab===5,"primary-mark":t.need_page_audios},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},Np,2)]),e("li",{class:"nav-item",onClick:o[10]||(o[10]=d=>t.tab=6)},[e("a",{class:b([{active:t.tab===6,"primary-mark":t.need_page_documents},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},Hp,2)]),e("li",{class:"nav-item",onClick:o[11]||(o[11]=d=>t.tab=7)},[e("a",{class:b([{active:t.tab===7,"primary-mark":t.need_attach_page},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},Xp,2)]),e("li",{class:"nav-item",onClick:o[12]||(o[12]=d=>t.tab=8)},[e("a",{class:b([{active:t.tab===8,"primary-mark":t.need_attach_slug},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},eb,2)]),e("li",{class:"nav-item",onClick:o[13]||(o[13]=d=>t.tab=9)},[e("a",{class:b([{active:t.tab===9,"primary-mark":t.need_attach_dialog},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},ob,2)]),e("li",{class:"nav-item",onClick:o[14]||(o[14]=d=>t.tab=10)},[e("a",{class:b([{active:t.tab===10,"primary-mark":t.need_rules},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},nb,2)])])]),c(e("div",null,[t.need_reply_menu?(l(),i("div",ab,[e("div",db,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[15]||(o[15]=d=>t.need_reply_menu=d),type:"checkbox",id:"need-reply-menu"},null,512),[[k,t.need_reply_menu]]),rb])])):r("",!0),t.need_reply_menu?(l(),i("div",cb,[e("div",ub,[e("div",mb,[_b,e("button",{class:b(["btn",{"btn-outline-primary":!t.showReplyTemplateSelector,"btn-primary":t.showReplyTemplateSelector}]),type:"button",onClick:o[16]||(o[16]=d=>t.showReplyTemplateSelector=!t.showReplyTemplateSelector)},[t.showReplyTemplateSelector?(l(),i("span",pb," Скрыть шаблоны меню")):(l(),i("span",hb," Открыть шаблоны меню"))],2)]),e("div",bb,[e("div",fb,[e("div",gb,[e("label",vb,[f(n,null,{content:v(()=>[yb]),default:v(()=>[$b]),_:1}),m(" Заголовок ")]),c(e("input",{type:"text",class:"form-control",placeholder:"Заголовок меню","aria-label":"Заголовок меню","onUpdate:modelValue":o[17]||(o[17]=d=>t.pageForm.reply_keyboard_title=d),maxlength:"255","aria-describedby":"bot-domain"},null,512),[[h,t.pageForm.reply_keyboard_title]])])]),t.showReplyTemplateSelector?(l(),$(T,{key:0,class:"mb-2",type:"reply",onSelect:t.selectReplyKeyboard,"select-mode":!0},null,8,["onSelect"])):(l(),$(A,{key:1,type:"reply",onSave:t.saveReplyKeyboard,onSaveSettings:t.saveReplyKeyboardSettings,"edited-keyboard":t.pageForm.reply_keyboard},null,8,["onSave","onSaveSettings","edited-keyboard"]))])])])):(l(),i("div",kb,[e("div",Fb,[e("div",wb,[c(e("img",Cb,null,512),[[a,"../images/icon.png"]])]),Sb,jb,e("div",qb,[e("button",{disabled:t.need_reply_menu,onClick:o[18]||(o[18]=d=>t.need_reply_menu=!0),class:b([{"btn-primary":!t.need_reply_menu,"btn-outline-secondary":t.need_reply_menu},"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill"]),type:"button"}," Добавить ",10,zb),Vb])])]))],512),[[z,t.tab===0]]),c(e("div",null,[t.need_inline_menu?(l(),i("div",Pb,[e("div",Ob,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[19]||(o[19]=d=>t.need_inline_menu=d),type:"checkbox",id:"need-inline-menu"},null,512),[[k,t.need_inline_menu]]),Ub])])):r("",!0),t.need_inline_menu?(l(),i("div",Ab,[e("div",Ib,[e("div",Qb,[Tb,e("button",{class:b(["btn",{"btn-outline-primary":!t.showInlineTemplateSelector,"btn-primary":t.showInlineTemplateSelector}]),type:"button",onClick:o[20]||(o[20]=d=>t.showInlineTemplateSelector=!t.showInlineTemplateSelector)},[t.showInlineTemplateSelector?(l(),i("span",Rb," Скрыть шаблоны меню")):(l(),i("span",Bb," Открыть шаблоны меню"))],2)]),e("div",Mb,[t.showInlineTemplateSelector?(l(),$(T,{key:0,class:"mb-2",type:"inline",onSelect:t.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(l(),$(A,{key:1,type:"inline",onSave:t.saveInlineKeyboard,"edited-keyboard":t.pageForm.inline_keyboard},null,8,["onSave","edited-keyboard"]))])])])):(l(),i("div",Db,[e("div",Eb,[e("div",Lb,[c(e("img",Kb,null,512),[[a,"../images/icon.png"]])]),Nb,Jb,e("div",Yb,[e("button",{disabled:t.need_inline_menu,onClick:o[21]||(o[21]=d=>t.need_inline_menu=!0),class:b([{"btn-primary":!t.need_inline_menu,"btn-outline-secondary":t.need_inline_menu},"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill"]),type:"button"}," Добавить ",10,Hb),Gb])])]))],512),[[z,t.tab===1]]),c(e("div",null,[t.need_page_images?(l(),i("div",Wb,[e("div",Xb,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[22]||(o[22]=d=>t.need_page_images=d),type:"checkbox",id:"need-page-images"},null,512),[[k,t.need_page_images]]),Zb])])):r("",!0),t.need_page_images?(l(),i("div",xb,[e("div",ef,[tf,e("div",sf,[e("label",of,[m(" + "),e("input",{type:"file",id:"photos",multiple:"",accept:"image/*",onChange:o[23]||(o[23]=(...d)=>t.onChangePhotos&&t.onChangePhotos(...d)),style:{display:"none"}},null,32)]),e("div",lf,[t.photos.length>0?(l(),i("div",nf,[(l(!0),i(g,null,y(t.photos,(d,_)=>(l(),i("div",af,[c(e("img",null,null,512),[[a,t.getPhoto(d).imageUrl]]),e("div",df,[e("a",{onClick:p=>t.removePhoto(_)},"Удалить",8,rf)])]))),256))])):r("",!0),t.pageForm.images.length>0?(l(),i("h6",cf,"Ранее загруженные фотографии")):r("",!0),t.pageForm.images.length>0?(l(),i("div",uf,[(l(!0),i(g,null,y(t.pageForm.images,(d,_)=>(l(),i("div",mf,[c(e("img",null,null,512),[[a,"/images-by-bot-id/"+t.bot.id+"/"+d]]),e("div",_f,[e("a",{onClick:p=>t.removeImage(_)},"Удалить",8,hf)])]))),256))])):r("",!0)])])])])):(l(),i("div",pf,[e("div",bf,[e("div",ff,[c(e("img",gf,null,512),[[a,"../images/icon.png"]])]),vf,$f,e("div",yf,[e("button",{disabled:t.need_page_images,onClick:o[24]||(o[24]=d=>t.need_page_images=!0),class:b([{"btn-primary":!t.need_page_images,"btn-outline-secondary":t.need_page_images},"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill"]),type:"button"}," Добавить ",10,kf),Ff])])]))],512),[[z,t.tab===2]]),c(e("div",null,[t.need_page_video?(l(),i("div",wf,[e("div",Cf,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[25]||(o[25]=d=>t.need_page_video=d),type:"checkbox",id:"need-page-video"},null,512),[[k,t.need_page_video]]),Sf])])):r("",!0),t.need_page_video?(l(),i("div",jf,[f(V,{"need-video":!0,"need-video-note":!0,selected:t.pageForm.videos,onSelect:t.selectVideo},null,8,["selected","onSelect"])])):(l(),i("div",qf,[e("div",zf,[e("div",Vf,[c(e("img",Pf,null,512),[[a,"../images/icon.png"]])]),Of,Uf,e("div",Af,[e("button",{disabled:t.need_page_video,onClick:o[26]||(o[26]=d=>t.need_page_video=!0),class:b([{"btn-primary":!t.need_page_video,"btn-outline-secondary":t.need_page_video},"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill"]),type:"button"}," Добавить ",10,If),Qf])])]))],512),[[z,t.tab===3]]),c(e("div",null,[t.need_page_sticker?(l(),i("div",Tf,[e("div",Bf,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[27]||(o[27]=d=>t.need_page_sticker=d),type:"checkbox",id:"need-page-sticker"},null,512),[[k,t.need_page_sticker]]),Rf])])):r("",!0),t.need_page_sticker?(l(),i("div",Mf,[f(V,{"need-sticker":!0,selected:[t.pageForm.sticker],onSelect:t.selectSticker},null,8,["selected","onSelect"])])):(l(),i("div",Df,[e("div",Ef,[e("div",Lf,[c(e("img",Kf,null,512),[[a,"../images/icon.png"]])]),Nf,Jf,e("div",Yf,[e("button",{disabled:t.need_page_sticker,onClick:o[28]||(o[28]=d=>t.need_page_sticker=!0),class:b([{"btn-primary":!t.need_page_sticker,"btn-outline-secondary":t.need_page_sticker},"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill"]),type:"button"}," Добавить ",10,Hf),Gf])])]))],512),[[z,t.tab===4]]),c(e("div",null,[t.need_page_audios?(l(),i("div",Wf,[e("div",Xf,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[29]||(o[29]=d=>t.need_page_audios=d),type:"checkbox",id:"need-page-audio"},null,512),[[k,t.need_page_audios]]),Zf])])):r("",!0),t.need_page_audios?(l(),i("div",xf,[f(V,{"need-audio":!0,selected:t.pageForm.audios,onSelect:t.selectAudio},null,8,["selected","onSelect"])])):(l(),i("div",e1,[e("div",t1,[e("div",s1,[c(e("img",o1,null,512),[[a,"../images/icon.png"]])]),l1,i1,e("div",n1,[e("button",{disabled:t.need_page_audios,onClick:o[30]||(o[30]=d=>t.need_page_audios=!0),class:b([{"btn-primary":!t.need_page_audios,"btn-outline-secondary":t.need_page_audios},"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill"]),type:"button"}," Добавить ",10,a1),d1])])]))],512),[[z,t.tab===5]]),c(e("div",null,[t.need_page_documents?(l(),i("div",r1,[e("div",c1,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[31]||(o[31]=d=>t.need_page_documents=d),type:"checkbox",id:"need-page-document"},null,512),[[k,t.need_page_documents]]),u1])])):r("",!0),t.need_page_documents?(l(),i("div",m1,[f(V,{"need-document":!0,selected:t.pageForm.documents,onSelect:t.selectDocument},null,8,["selected","onSelect"])])):(l(),i("div",_1,[e("div",h1,[e("div",p1,[c(e("img",b1,null,512),[[a,"../images/icon.png"]])]),f1,g1,e("div",v1,[e("button",{disabled:t.need_page_documents,onClick:o[32]||(o[32]=d=>t.need_page_documents=!0),class:b([{"btn-primary":!t.need_page_documents,"btn-outline-secondary":t.need_page_documents},"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill"]),type:"button"}," Добавить ",10,$1),y1])])]))],512),[[z,t.tab===6]]),c(e("div",null,[e("div",k1,[e("div",F1,[e("div",w1,[c(e("img",C1,null,512),[[a,"../images/icon.png"]])]),S1,j1,t.pageForm.next_page_id?(l(),i("p",q1,"Связано со страницей #"+u(t.pageForm.next_page_id),1)):r("",!0),e("div",z1,[t.pageForm.next_page_id?(l(),i("button",{key:0,class:"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill btn-danger",type:"button",onClick:o[33]||(o[33]=(...d)=>t.clearLinks&&t.clearLinks(...d))},"Очистить ")):(l(),i("button",V1," Связать ")),P1]),O1,e("div",U1,[A1,I1,(l(!0),i(g,null,y(t.links,(d,_)=>(l(),i("div",Q1,[e("button",{type:"button",onClick:p=>t.removeLink(_),class:b([{"btn-danger":t.chainCollapseTest(d)},"btn btn-primary position-relative rounded-5"])},[m(u(d.slug.command||"-")+" ",1),e("span",B1," #"+u(d.id),1)],10,T1),_<t.links.length-1?(l(),i("i",R1)):r("",!0)]))),256)),t.links.length>0?(l(),i("i",M1)):r("",!0),D1])])])],512),[[z,t.tab===7]]),c(e("div",null,[t.need_attach_slug?(l(),i("div",E1,[L1,e("div",K1,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[34]||(o[34]=d=>t.need_show_global_slug_list=d),type:"checkbox",id:"need-show-global-slug-list"},null,512),[[k,t.need_show_global_slug_list]]),N1]),t.bot&&t.need_show_global_slug_list?(l(),$(le,{key:0,"can-add":!0,bot:t.bot,onCallback:t.loadSlugs},null,8,["bot","onCallback"])):r("",!0)])):r("",!0),t.need_attach_slug?(l(),i("div",J1,[e("div",Y1,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[35]||(o[35]=d=>t.need_attach_slug=d),type:"checkbox",id:"need-slug-attach"},null,512),[[k,t.need_attach_slug]]),H1])])):r("",!0),t.need_attach_slug?(l(),i("div",G1,[t.pageForm.next_bot_menu_slug_id?(l(),i("div",W1,[m(" Связано со скриптом #"+u(t.pageForm.next_bot_menu_slug_id)+" ",1),e("a",{class:"btn btn-link text-danger",onClick:o[36]||(o[36]=d=>t.pageForm.next_bot_menu_slug_id=null)},"Очистить")])):r("",!0),t.bot&&t.load_slug_simple_list?(l(),$(tn,{key:1,global:!0,"can-select":!0,selected:[t.pageForm.next_bot_menu_slug_id],onCallback:t.associateSlug,bot:t.bot},null,8,["selected","onCallback","bot"])):r("",!0)])):(l(),i("div",X1,[e("div",Z1,[e("div",x1,[c(e("img",eg,null,512),[[a,"../images/icon.png"]])]),tg,sg,e("div",og,[e("button",{disabled:t.need_attach_slug,onClick:o[37]||(o[37]=d=>t.need_attach_slug=!0),class:b([{"btn-primary":!t.need_attach_slug,"btn-outline-secondary":t.need_attach_slug},"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill"]),type:"button"}," Добавить ",10,lg),ig])])]))],512),[[z,t.tab===8]]),c(e("div",null,[t.need_attach_dialog?(l(),i("div",ng,[e("div",ag,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[38]||(o[38]=d=>t.need_attach_dialog=d),type:"checkbox",id:"need-dialog-attach"},null,512),[[k,t.need_attach_dialog]]),dg])])):r("",!0),t.need_attach_dialog?(l(),i("div",rg,[t.pageForm.next_bot_dialog_command_id?(l(),i("p",cg,[m("Связано с диалогом #"+u(t.pageForm.next_bot_dialog_command_id)+" ",1),e("a",{class:"btn btn-link",onClick:o[39]||(o[39]=d=>t.pageForm.next_bot_dialog_command_id=null)},"Очистить")])):r("",!0),t.bot?(l(),$(de,{key:1,onSelectDialog:t.associateDialog,bot:t.bot},null,8,["onSelectDialog","bot"])):r("",!0)])):(l(),i("div",ug,[e("div",mg,[e("div",_g,[c(e("img",hg,null,512),[[a,"../images/icon.png"]])]),pg,bg,e("div",fg,[e("button",{disabled:t.need_attach_dialog,onClick:o[40]||(o[40]=d=>t.need_attach_dialog=!0),class:b([{"btn-primary":!t.need_attach_dialog,"btn-outline-secondary":t.need_attach_dialog},"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill"]),type:"button"}," Добавить ",10,gg),vg])])]))],512),[[z,t.tab===9]]),c(e("div",null,[t.need_rules?(l(),i("div",$g,[e("div",yg,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[41]||(o[41]=d=>t.need_rules=d),type:"checkbox",id:"need-rules"},null,512),[[k,t.need_rules]]),kg])])):r("",!0),t.need_rules?(l(),i("div",Fg,[f(ah,{bot:t.bot,"rules-form":t.pageForm},null,8,["bot","rules-form"])])):(l(),i("div",wg,[e("div",Cg,[e("div",Sg,[c(e("img",jg,null,512),[[a,"../images/icon.png"]])]),qg,zg,e("div",Vg,[e("button",{disabled:t.need_rules,onClick:o[42]||(o[42]=d=>t.need_rules=!0),class:b([{"btn-primary":!t.need_rules,"btn-outline-secondary":t.need_rules},"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill"]),type:"button"}," Добавить ",10,Pg),Og])])]))],512),[[z,t.tab===10]])],512),[[z,!t.pageForm.is_external]])],32)):r("",!0),Ug,e("div",Ag,[e("div",Ig,[e("div",Qg,[Tg,e("div",Bg,[t.bot?(l(),i("div",Rg,[e("div",Mg,[e("h6",Dg,[e("span",null,[m("Вы создаете страницу для "),e("a",{href:"https://t.me/"+t.bot.bot_domain,target:"_blank"},u(t.bot.bot_domain),9,Eg)])])])])):r("",!0),e("form",{onSubmit:o[50]||(o[50]=S((...d)=>t.submitPage&&t.submitPage(...d),["prevent"])),class:"row"},[e("div",Lg,[Kg,e("ul",Ng,[e("li",{class:b({active:t.need_page_images})},Yg,2),e("li",{class:b({active:t.need_page_sticker})},Gg,2),e("li",{class:b({active:t.need_page_video})},Xg,2),e("li",{class:b({active:t.need_page_audios})},xg,2),e("li",{class:b({active:t.need_page_documents})},tv,2),e("li",{class:b({active:t.need_attach_page})},ov,2),e("li",{class:b({active:t.need_attach_slug})},iv,2),e("li",{class:b({active:t.need_attach_dialog})},av,2),e("li",{class:b({active:t.need_rules})},rv,2),e("li",{class:b({active:t.need_reply_menu})},uv,2),e("li",{class:b({active:t.need_inline_menu})},_v,2)])]),t.pageForm.id?(l(),i("div",hv,[e("div",pv,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[44]||(o[44]=d=>t.need_show_qr_and_link=d),type:"checkbox",id:"need-show-qr-and-link"},null,512),[[k,t.need_show_qr_and_link]]),bv])])):r("",!0),t.pageForm.id&&t.need_show_qr_and_link?(l(),i("div",fv,[e("p",null,[m("Ссылка на текущую страницу: "),e("span",{class:"bg-secondary font-bold cursor-pointer",onClick:o[45]||(o[45]=d=>t.copyToClipBoard(t.pageLink))},u(t.pageLink),1)]),e("div",gv,[c(e("img",vv,null,512),[[a,t.qr]])])])):r("",!0),e("div",$v,[e("label",yv,[f(n,null,{content:v(()=>[Fv]),default:v(()=>[kv]),_:1}),m(" Описание страницы "),wv]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Описание страницы","aria-label":"Описание страницы","onUpdate:modelValue":o[46]||(o[46]=d=>t.pageForm.comment=d),maxlength:"255","aria-describedby":"bot-domain",required:""},`
            `,512),[[h,t.pageForm.comment]])]),e("div",Cv,[e("div",Sv,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[47]||(o[47]=d=>t.pageForm.is_external=d),type:"checkbox",id:"is-external"},null,512),[[k,t.pageForm.is_external]]),jv]),t.pageForm.is_external?(l(),i("div",qv,[m(" Обработка ссылок передана на внешний адрес, указанный в настройках бота! Все запросы по данной кнопке будут отправлены на указанный URL-адрес: "),e("strong",null,u(t.bot.callback_link||"не указано")+".",1),t.bot.callback_link?r("",!0):(l(),i("p",zv,[m("Внешня ссылка не установлена! Перейдите в раздел "),Vv,m(", затем "),Pv,m(" и установите ссылку для внешнего управления в поле "),Ov,m("!")]))])):r("",!0)]),e("div",Uv,[e("div",Av,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[48]||(o[48]=d=>t.pageForm.need_log_user_action=d),type:"checkbox",id:"need_log_user_action"},null,512),[[k,t.pageForm.need_log_user_action]]),Iv])]),e("div",Qv,[e("div",Tv,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[49]||(o[49]=d=>t.need_stay_after_save=d),type:"checkbox",id:"need-stay-after-save"},null,512),[[k,t.need_stay_after_save]]),Bv])]),Rv],32)]),Mv])])]),e("div",Dv,[e("div",Ev,[e("div",Lv,[e("div",Kv,[f(B,{current:t.pageForm.id,selected:t.selectedLinkIds,onCallback:t.attachPage,editor:!1},null,8,["current","selected","onCallback"])])])])]),e("div",Nv,[e("div",Jv,[e("div",Yv,[e("div",Hv,[t.page?(l(),$(Ch,{key:0,page:t.page},null,8,["page"])):(l(),i("p",Gv,"Сперва сохраните страницу"))])])])]),m("- "),e("div",Wv,[Xv,e("div",Zv,[e("div",xv,[e("div",e$,[t.loaded_page_list?(l(),$(B,{key:0,editor:!0,current:t.page,onCallback:t.pageListCallback},null,8,["current","onCallback"])):r("",!0)])])])])],64)}}}),o$={props:["bot","item"],data(){return{sectionForm:{section:null},categoryForm:{label:null},tab:0,types:[{title:"Готовый продукт",value:1},{title:"Товар на вес",value:2},{title:"Конструктор товара",value:3}],productCategories:[],sections:["Общие характеристики","Дополнительная информация"],photos:[],categories:[],removed_options:[],productForm:{article:null,vk_product_id:null,frontpad_article:null,iiko_article:null,title:null,description:null,images:[],type:1,old_price:null,current_price:null,variants:[],in_stop_list_at:null,bot_id:null,options:[],reviews:[],categories:[]}}},computed:{...C(["getProductCategories"]),filteredCategories(){return this.productCategories.length===0?this.categories:this.categories.filter(s=>this.productCategories.indexOf(s.value)===-1)}},mounted(){this.loadProductCategories(),this.item&&this.$nextTick(()=>{this.productForm={id:this.item.id||null,article:this.item.article||null,vk_product_id:this.item.vk_product_id||null,frontpad_article:this.item.frontpad_article||null,iiko_article:this.item.iiko_article||null,title:this.item.title||null,description:this.item.description||null,images:this.item.images||null,type:this.item.type||1,old_price:this.item.old_price||null,current_price:this.item.current_price||null,variants:this.item.variants||null,in_stop_list_at:this.item.in_stop_list_at||null,bot_id:this.item.bot_id||null,options:this.item.options||null,reviews:this.item.reviews||null},this.options=[],this.item.categories.forEach(s=>{this.productCategories.push(s.id)})})},methods:{prepareCategoryName(s){let t=this.categories.find(o=>o.value===s);return console.log(t),t?t.label:s},addCategory(){const s=this.categoryForm.label;this.productCategories.push(s),this.categoryForm.label=null},selectCategory(s){this.productCategories.push(s.value)},submit(){let s=new FormData;if(Object.keys(this.productForm).forEach(t=>{const o=this.productForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.bot&&s.append("bot_id",this.bot.id),this.photos.length>0)for(let t=0;t<this.photos.length;t++)s.append("photos[]",this.photos[t]);this.removed_options.length>0&&s.append("removed_options",JSON.stringify(this.removed_options)),this.productCategories.length>0&&s.append("categories",JSON.stringify(this.productCategories)),this.$store.dispatch("saveProduct",{productForm:s}).then(t=>{this.load=!0,this.$notify({title:"Конструктор ботов",text:"Продукт успешно сохранен!",type:"success"}),this.clearForm(),this.$emit("refresh")}).catch(t=>{})},onChangePhotos(s){const t=s.target.files;for(let o=0;o<t.length;o++)this.photos.push(t[o])},loadProductCategories(){this.$store.dispatch("loadProductCategories",{dataObject:{bot_id:this.bot.id}}).then(()=>{this.getProductCategories.forEach(t=>{this.categories.push({value:t.id,label:t.title})})})},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removeSection(s){this.sections.splice(s,1)},addSection(){this.sections.push(this.sectionForm.section),this.sectionForm.section=null},addOption(){this.productForm.options||(this.productForm.options=[]),this.productForm.options.push({id:null,key:null,value:null,title:null,section:null})},addVariant(){this.productForm.variants||(this.productForm.variants=[]),this.productForm.variants.push({key:null,value:null})},removeProductCategory(s){this.productCategories.splice(s,1)},removeVariant(s){this.productForm.variants.splice(s,1)},removeOption(s){this.productForm.options[s].id&&this.removed_options.push(this.productForm.options[s].id),this.productForm.options.splice(s,1)},removeImage(s){this.productForm.images.splice(s,1)},removePhoto(s){this.photos.splice(s,1)},clearForm(){const s={article:null,vk_product_id:null,title:null,description:null,images:[],type:1,old_price:null,current_price:null,variants:[],in_stop_list_at:null,bot_id:null,options:[],reviews:[],categories:[]};this.photos=[],this.removed_options=[],this.productCategories=[],this.productForm=s}}},l$={class:"nav nav-tabs"},i$={class:"nav-item"},n$={class:"nav-item"},a$={class:"nav-item"},d$={key:0},r$=e("div",{class:"col-12"},[e("button",{type:"submit",class:"btn btn-outline-primary"},[e("i",{class:"fa-regular fa-floppy-disk mr-2"}),m(" Сохранить товар ")])],-1),c$={class:"col-md-8 d-flex align-items-center"},u$={class:"form-check"},m$=e("label",{class:"form-check-label",for:"in-stop-list"}," Товар находится в стоп-листе ",-1),_$={class:"col-md-4 d-flex justify-content-end"},h$={class:"col-md-12 mb-3"},p$=["onClick"],b$={class:"dropdown"},f$=e("button",{type:"button",class:"btn btn-outline-info w-100","data-bs-toggle":"dropdown","data-bs-display":"static","aria-expanded":"false"},[e("p",{class:"mb-0"},"Выберите категорию")],-1),g$={class:"dropdown-menu w-100",style:{"overflow-y":"scroll",height:"300px"}},v$={class:"p-3"},$$=e("label",{for:"exampleDropdownFormEmail1",class:"form-label"},"Новая категория",-1),y$={class:"p-3"},k$=e("li",null,[e("hr",{class:"dropdown-divider"})],-1),F$=["onClick"],w$={class:"col-md-6"},C$={class:"form-floating mb-3"},S$=e("label",{for:"article"},"Артикул товара",-1),j$={class:"col-md-6"},q$={class:"form-floating mb-3"},z$=e("label",{for:"article"},"Артикул товара FrontPad",-1),V$={class:"col-md-6"},P$={class:"form-floating mb-3"},O$=e("label",{for:"article"},"Артикул товара в IIKO",-1),U$={class:"col-md-6"},A$={class:"form-floating mb-3"},I$=e("label",{for:"vk-product-id"},"Идентификатор товара VK",-1),Q$={class:"col-md-6"},T$={class:"form-floating mb-3"},B$=e("label",{for:"title"},"Названи товара",-1),R$={class:"col-md-6"},M$={class:"form-floating mb-3"},D$=["value"],E$=e("label",{for:"type"},"Тип товара",-1),L$={class:"col-md-12"},K$={class:"form-floating mb-3"},N$=e("label",{for:"description"},"Описание товара",-1),J$={class:"col-md-6"},Y$={class:"form-floating mb-3"},H$=e("label",{for:"current-price"},"Актуальная цена",-1),G$={class:"col-md-6"},W$={class:"form-floating mb-3"},X$=e("label",{for:"old-price"},"Старая цена",-1),Z$={class:"col-md-12 mb-3"},x$={class:"card"},ey={class:"card-header"},ty={key:0},sy={class:"card-body"},oy={class:"row"},ly={class:"col-12 mb-3"},iy={class:"col-md-6 mb-3"},ny={class:"card w-100"},ay={class:"card-body"},dy={class:"form-floating mb-3"},ry=["onUpdate:modelValue","id"],cy=["for"],uy={class:"form-floating mb-3"},my=["onUpdate:modelValue","id"],_y=["for"],hy={class:"card-footer"},py=["onClick"],by=e("i",{class:"fa-solid fa-trash-can"},null,-1),fy=[by],gy={class:"col-md-12 mb-3"},vy={class:"card"},$y=e("div",{class:"card-header"},[e("h6",null,"Характеристики товара")],-1),yy={class:"card-body"},ky={class:"row mb-3"},Fy={class:"col-12"},wy=e("button",{class:"btn btn-outline-info",type:"submit",id:"button-addon2"},"Добавить секцию ",-1),Cy={class:"badge bg-info mr-1"},Sy=["onClick"],jy=e("i",{class:"fa-solid fa-xmark"},null,-1),qy=[jy],zy={class:"row"},Vy={class:"col-md-4 mb-3"},Py={class:"card w-100"},Oy={class:"card-body"},Uy={class:"form-floating mb-3"},Ay=["onUpdate:modelValue","id"],Iy=["for"],Qy={class:"form-floating mb-3"},Ty=["onUpdate:modelValue","id"],By=["for"],Ry={class:"form-floating mb-3"},My=["onUpdate:modelValue","id"],Dy=e("option",{value:null},"Без секции",-1),Ey=["value"],Ly=["for"],Ky={class:"card-footer"},Ny=["onClick"],Jy=e("i",{class:"fa-solid fa-trash-can"},null,-1),Yy=[Jy],Hy={class:"row"},Gy={class:"col-12"},Wy={class:"col-md-12 mb-3"},Xy=e("h6",null,"Фотографии товара",-1),Zy={class:"photo-preview d-flex justify-content-start flex-wrap w-100"},xy={for:"location-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},e2=e("span",null,"+",-1),t2={class:"mb-2 img-preview",style:{"margin-right":"10px"}},s2={class:"remove"},o2=["onClick"],l2={class:"mb-2 img-preview",style:{"margin-right":"10px"}},i2={class:"remove"},n2=["onClick"],a2={key:1};function d2(s,t,o,n,a,d){const _=Q("lazy");return l(),i(g,null,[e("ul",l$,[e("li",i$,[e("a",{class:b(["nav-link",{active:a.tab===0}]),onClick:t[0]||(t[0]=p=>a.tab=0),"aria-current":"page",href:"#product-form-info"},"Информация о товаре",2)]),e("li",n$,[e("a",{class:b(["nav-link",{active:a.tab===1}]),onClick:t[1]||(t[1]=p=>a.tab=1),href:"#product-reviews"},"Комментарии",2)]),e("li",a$,[e("a",{class:b(["nav-link",{active:a.tab===2}]),onClick:t[2]||(t[2]=p=>a.tab=2),href:"#product-reviews"},"Заказы",2)])]),a.tab===0?(l(),i("div",d$,[e("form",{onSubmit:t[21]||(t[21]=S((...p)=>d.submit&&d.submit(...p),["prevent"])),class:"row py-2"},[r$,e("div",c$,[e("div",u$,[c(e("input",{class:"form-check-input","onUpdate:modelValue":t[3]||(t[3]=p=>a.productForm.in_stop_list_at=p),type:"checkbox",value:"false",id:"in-stop-list"},null,512),[[k,a.productForm.in_stop_list_at]]),m$])]),e("div",_$,[e("a",{href:"#",class:"btn btn-link",onClick:t[4]||(t[4]=(...p)=>d.clearForm&&d.clearForm(...p))},"Новый товар")]),e("div",h$,[(l(!0),i(g,null,y(a.productCategories,(p,F)=>(l(),i("span",{class:"badge bg-info mr-1 mb-1 cursor-pointer",onClick:w=>d.removeProductCategory(F)},u(d.prepareCategoryName(p)),9,p$))),256)),e("div",b$,[f$,e("ul",g$,[e("div",v$,[$$,c(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[5]||(t[5]=p=>a.categoryForm.label=p),id:"exampleDropdownFormEmail1",placeholder:"Название категории"},null,512),[[h,a.categoryForm.label]])]),e("div",y$,[e("button",{class:"btn btn-primary w-100",type:"button",onClick:t[6]||(t[6]=(...p)=>d.addCategory&&d.addCategory(...p))},"Добавить категорию ")]),k$,(l(!0),i(g,null,y(d.filteredCategories,p=>(l(),i("li",null,[e("button",{class:"dropdown-item",type:"button",onClick:F=>d.selectCategory(p)},u(p.label),9,F$)]))),256))])])]),e("div",w$,[e("div",C$,[c(e("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=p=>a.productForm.article=p),class:"form-control",id:"article",placeholder:"name@example.com"},null,512),[[h,a.productForm.article]]),S$])]),e("div",j$,[e("div",q$,[c(e("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=p=>a.productForm.frontpad_article=p),class:"form-control",id:"article",placeholder:"name@example.com"},null,512),[[h,a.productForm.frontpad_article]]),z$])]),e("div",V$,[e("div",P$,[c(e("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=p=>a.productForm.iiko_article=p),class:"form-control",id:"article",placeholder:"name@example.com"},null,512),[[h,a.productForm.iiko_article]]),O$])]),e("div",U$,[e("div",A$,[c(e("input",{type:"text","onUpdate:modelValue":t[10]||(t[10]=p=>a.productForm.vk_product_id=p),disabled:!0,class:"form-control",id:"vk-product-id",placeholder:"name@example.com"},null,512),[[h,a.productForm.vk_product_id]]),I$])]),e("div",Q$,[e("div",T$,[c(e("input",{type:"text","onUpdate:modelValue":t[11]||(t[11]=p=>a.productForm.title=p),class:"form-control",id:"title",placeholder:"name@example.com"},null,512),[[h,a.productForm.title]]),B$])]),e("div",R$,[e("div",M$,[c(e("select",{class:"form-select","onUpdate:modelValue":t[12]||(t[12]=p=>a.productForm.type=p),id:"type","aria-label":"Floating label select example"},[(l(!0),i(g,null,y(a.types,(p,F)=>(l(),i("option",{value:p.value},u(p.title),9,D$))),256))],512),[[I,a.productForm.type]]),E$])]),e("div",L$,[e("div",K$,[c(e("textarea",{class:"form-control","onUpdate:modelValue":t[13]||(t[13]=p=>a.productForm.description=p),placeholder:"Leave a comment here",id:"description"},null,512),[[h,a.productForm.description]]),N$])]),e("div",J$,[e("div",Y$,[c(e("input",{type:"number","onUpdate:modelValue":t[14]||(t[14]=p=>a.productForm.current_price=p),class:"form-control",id:"current-price",placeholder:"name@example.com"},null,512),[[h,a.productForm.current_price]]),H$])]),e("div",G$,[e("div",W$,[c(e("input",{type:"number","onUpdate:modelValue":t[15]||(t[15]=p=>a.productForm.old_price=p),class:"form-control",id:"old-price",placeholder:"name@example.com"},null,512),[[h,a.productForm.old_price]]),X$])]),e("div",Z$,[e("div",x$,[e("div",ey,[e("h6",null,[m("Варианты товара "),a.productForm.variants?(l(),i("span",ty,"("+u(a.productForm.variants.length)+")",1)):r("",!0)])]),e("div",sy,[e("div",oy,[e("div",ly,[e("button",{type:"button",class:"btn btn-outline-info w-100",onClick:t[16]||(t[16]=(...p)=>d.addVariant&&d.addVariant(...p))},"Добавить вариант ")]),(l(!0),i(g,null,y(a.productForm.variants,(p,F)=>(l(),i("div",iy,[e("div",ny,[e("div",ay,[e("div",dy,[c(e("input",{type:"text","onUpdate:modelValue":w=>a.productForm.variants[F].key=w,class:"form-control",id:"variant-key-"+F,placeholder:"name@example.com",required:""},null,8,ry),[[h,a.productForm.variants[F].key]]),e("label",{for:"variant-key-"+F},"Ключ",8,cy)]),e("div",uy,[c(e("input",{type:"text","onUpdate:modelValue":w=>a.productForm.variants[F].value=w,class:"form-control",id:"variant-value-"+F,placeholder:"name@example.com",required:""},null,8,my),[[h,a.productForm.variants[F].value]]),e("label",{for:"variant-value-"+F},"Значение",8,_y)])]),e("div",hy,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:w=>d.removeVariant(F)},fy,8,py)])])]))),256))])])])]),e("div",gy,[e("div",vy,[$y,e("div",yy,[e("div",ky,[e("div",Fy,[e("form",{onSubmit:t[18]||(t[18]=S((...p)=>d.addSection&&d.addSection(...p),["prevent"])),class:"input-group mb-3"},[c(e("input",{type:"text","onUpdate:modelValue":t[17]||(t[17]=p=>a.sectionForm.section=p),class:"form-control border-info",placeholder:"Название секции","aria-label":"Recipient's username","aria-describedby":"button-addon2",required:""},null,512),[[h,a.sectionForm.section]]),wy],32),(l(!0),i(g,null,y(a.sections,(p,F)=>(l(),i("span",Cy,[m(u(p)+" ",1),e("strong",{onClick:w=>d.removeSection(F)},qy,8,Sy)]))),256))])]),e("div",zy,[(l(!0),i(g,null,y(a.productForm.options,(p,F)=>(l(),i("div",Vy,[e("div",Py,[e("div",Oy,[e("div",Uy,[c(e("input",{type:"text","onUpdate:modelValue":w=>a.productForm.options[F].title=w,class:"form-control",id:"option-title-"+F,placeholder:"name@example.com"},null,8,Ay),[[h,a.productForm.options[F].title]]),e("label",{for:"option-title-"+F},"Название характеристики",8,Iy)]),e("div",Qy,[c(e("input",{type:"text","onUpdate:modelValue":w=>a.productForm.options[F].value=w,class:"form-control",id:"option-value-"+F,placeholder:"name@example.com"},null,8,Ty),[[h,a.productForm.options[F].value]]),e("label",{for:"option-value-"+F},"Значение характеристики",8,By)]),e("div",Ry,[c(e("select",{class:"form-select","onUpdate:modelValue":w=>a.productForm.options[F].section=w,id:"option-section-"+F,"aria-label":"Floating label select example"},[Dy,(l(!0),i(g,null,y(a.sections,w=>(l(),i("option",{value:w},u(w),9,Ey))),256))],8,My),[[I,a.productForm.options[F].section]]),e("label",{for:"option-section-"+F},"Секция товара",8,Ly)])]),e("div",Ky,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:w=>d.removeOption(F)},Yy,8,Ny)])])]))),256))]),e("div",Hy,[e("div",Gy,[e("button",{type:"button",class:"btn btn-outline-info w-100",onClick:t[19]||(t[19]=(...p)=>d.addOption&&d.addOption(...p))},"Добавить характеристику ")])])])])]),e("div",Wy,[Xy,e("div",Zy,[e("label",xy,[e2,e("input",{type:"file",id:"location-photos",multiple:"",accept:"image/*",onChange:t[20]||(t[20]=(...p)=>d.onChangePhotos&&d.onChangePhotos(...p)),style:{display:"none"}},null,32)]),a.productForm.images?(l(!0),i(g,{key:0},y(a.productForm.images,(p,F)=>(l(),i("div",t2,[c(e("img",null,null,512),[[_,p]]),e("div",s2,[e("a",{onClick:w=>d.removeImage(F)},"Удалить",8,o2)])]))),256)):r("",!0),a.photos.length>0?(l(!0),i(g,{key:1},y(a.photos,(p,F)=>(l(),i("div",l2,[c(e("img",null,null,512),[[_,d.getPhoto(p).imageUrl]]),e("div",i2,[e("a",{onClick:w=>d.removePhoto(F)},"Удалить",8,n2)])]))),256)):r("",!0)])])],32)])):r("",!0),a.tab===1?(l(),i("div",a2," Отзывы ")):r("",!0)],64)}const re=O(o$,[["render",d2]]);({...C(["getCurrentBot"])});const r2=e("button",{class:"btn btn-outline-info",type:"submit",id:"button-addon2"}," Найти ",-1),c2={key:0},u2={class:"row"},m2={class:"col-12"},_2={class:"table"},h2=e("thead",null,[e("tr",null,[e("th",{scope:"col"}),e("th",{scope:"col"},"#"),e("th",{scope:"col"},"Название"),e("th",{scope:"col"},"Картинка"),e("th",{scope:"col"},"Действия")])],-1),p2=["onClick"],b2=e("i",{class:"fa-solid fa-toggle-off cursor-pointer text-secondary"},null,-1),f2=[b2],g2=["onClick"],v2=e("i",{class:"fa-solid fa-toggle-on cursor-pointer text-primary"},null,-1),$2=[v2],y2={scope:"row"},k2=["onClick"],F2=["src"],w2={key:1},C2={class:"d-flex"},S2=e("i",{class:"fa-regular fa-copy"},null,-1),j2=[S2],q2=e("i",{class:"fa-solid fa-trash-can"},null,-1),z2=[q2],V2={key:0},P2={colspan:"5"},O2={props:["bot"],data(){return{search:null,products:[],paginate:null}},computed:{...C(["getProducts","getProductsPaginateObject"]),filteredProducts(){return this.search?this.products.filter(s=>s.title.toLowerCase().trim().indexOf(this.search.toLowerCase().trim())>=0):this.products}},mounted(){this.loadProducts()},methods:{refresh(){this.products.forEach(s=>{s.in_edit_mode=!1})},toggleEditProduct(s){console.log("product0",s),s.in_edit_mode=!s.in_edit_mode},selectProduct(s){this.$emit("select",s)},nextProducts(s){this.loadProducts(s)},preparedImgUrl(s){return s.toLocaleLowerCase().startsWith("https://")||s.toLocaleLowerCase().startsWith("http://")?s:"/images-by-bot-id/"+this.bot.id+"/"+s},removeProduct(s){this.$store.dispatch("removeProduct",s.id).then(t=>{this.$notify({title:"Конструктор ботов",text:"Продукт успешно удален!",type:"success"})}).catch(t=>{})},duplicateProduct(s){this.$store.dispatch("duplicateProduct",s.id).then(t=>{this.$notify({title:"Конструктор ботов",text:"Продукт успешно продублирован!",type:"success"})}).catch(t=>{})},loadProducts(s=0){return this.$store.dispatch("loadProducts",{dataObject:{bot_id:this.bot.id,search:this.search},page:s}).then(()=>{this.products=this.getProducts,this.paginate=this.getProductsPaginateObject})}}},U2=Object.assign(O2,{__name:"ProductTableList",setup(s){return(t,o)=>(l(),i(g,null,[e("form",{class:"input-group mb-3",onSubmit:o[1]||(o[1]=S(n=>t.loadProducts(0),["prevent"]))},[c(e("input",{type:"text",class:"form-control border-info",placeholder:"Поиск товара","aria-label":"Поиск товара","onUpdate:modelValue":o[0]||(o[0]=n=>t.search=n),"aria-describedby":"button-addon2",required:""},null,512),[[h,t.search]]),r2],32),e("p",null,[m("Всего товаров: "),t.paginate?(l(),i("span",c2,u(t.paginate.meta.total||0),1)):r("",!0)]),e("div",u2,[e("div",m2,[e("table",_2,[h2,e("tbody",null,[(l(!0),i(g,null,y(t.filteredProducts,(n,a)=>(l(),i(g,null,[e("tr",null,[e("td",null,[n.in_edit_mode?(l(),i("span",{key:1,onClick:d=>t.toggleEditProduct(n)},$2,8,g2)):(l(),i("span",{key:0,onClick:d=>t.toggleEditProduct(n)},f2,8,p2))]),e("th",y2,u(n.id),1),e("td",null,[e("a",{href:"javascript:void(0)",onClick:d=>t.selectProduct(n)},u(n.title),9,k2)]),e("td",null,[(n.images||[]).length>0?(l(),i("img",{key:0,src:t.preparedImgUrl(n.images[0]),style:{width:"100px",height:"100px","object-fit":"cover"},class:"d-block",alt:"..."},null,8,F2)):(l(),i("p",w2,"Не добавлено"))]),e("td",null,[e("div",C2,[e("button",{title:"Дублировать товар",onClick:o[2]||(o[2]=(...d)=>t.duplicateProduct&&t.duplicateProduct(...d)),class:"btn btn-outline-info mr-1"},j2),e("button",{title:"Удалить товар",onClick:o[3]||(o[3]=(...d)=>t.removeProduct&&t.removeProduct(...d)),class:"btn btn-outline-danger"},z2)])])]),n.in_edit_mode?(l(),i("tr",V2,[e("td",P2,[f(re,{bot:s.bot,item:n,onRefresh:t.refresh},null,8,["bot","item","onRefresh"])])])):r("",!0)],64))),256))])])])]),t.paginate?(l(),$(j,{key:0,onPagination_page:t.nextProducts,pagination:t.paginate},null,8,["onPagination_page","pagination"])):r("",!0)],64))}}),A2=e("button",{class:"btn btn-outline-info",type:"submit",id:"button-addon2"}," Найти ",-1),I2={key:0},Q2={class:"row"},T2={class:"col-12"},B2={class:"table"},R2=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"Название"),e("th",{scope:"col"},"Состояние"),e("th",{scope:"col"},"Позиция в выдаче"),e("th",{scope:"col"},"Действия")])],-1),M2={scope:"row"},D2=["onClick"],E2=["onClick"],L2={key:0},K2={key:1},N2=["onChange","onUpdate:modelValue"],J2=["onClick"],Y2=e("i",{class:"fa-solid fa-trash-can"},null,-1),H2=[Y2],G2={props:["bot"],data(){return{search:null,categories:[],paginate:null}},computed:{...C(["getProductCategories","getProductCategoriesPaginateObject"]),filteredProductCategories(){return this.search?this.categories.filter(s=>s.title.toLowerCase().trim().indexOf(this.search.toLowerCase().trim())>=0):this.categories}},mounted(){this.loadProductCategories()},methods:{updateCategory(s){console.log("update",s),this.$store.dispatch("storeProductCategory",{category:s,bot_id:this.bot.id}).then(t=>{this.$notify({title:"Конструктор ботов",text:"Данные сохранены!",type:"success"})}).catch(t=>{this.$notify({title:"Конструктор ботов",text:"Ошибка сохранения данных!",type:"error"})})},changeCategoryStatus(s){let t=this.categories.findIndex(o=>s.id===o.id);t!==-1&&(this.categories[t].is_active=!this.categories[t].is_active,this.$store.dispatch("changeProductCategoryStatus",s.id).then(o=>{this.$notify({title:"Конструктор ботов",text:"Статус категории успешно изменен!",type:"success"})}).catch(o=>{}))},selectProductCategory(s){this.$emit("select",s)},nextProductCategories(s){this.loadProductCategories(s)},removeProductCategory(s){this.$store.dispatch("removeProductCategory",s.id).then(t=>{this.$notify({title:"Конструктор ботов",text:"Продукт успешно удален!",type:"success"})}).catch(t=>{})},loadProductCategories(s=0){return this.$store.dispatch("loadProductCategories",{dataObject:{bot_id:this.bot.id,search:this.search},page:s}).then(()=>{this.categories=this.getProductCategories,this.paginate=this.getProductCategoriesPaginateObject})}}},W2=Object.assign(G2,{__name:"ProductCategoryTableList",setup(s){return(t,o)=>(l(),i(g,null,[e("form",{class:"input-group mb-3",onSubmit:o[1]||(o[1]=S(n=>t.loadProductCategories(0),["prevent"]))},[c(e("input",{type:"text",class:"form-control border-info",placeholder:"Поиск категории товара","aria-label":"Поиск категории товара","onUpdate:modelValue":o[0]||(o[0]=n=>t.search=n),"aria-describedby":"button-addon2",required:""},null,512),[[h,t.search]]),A2],32),e("p",null,[m("Всего категорий: "),t.paginate?(l(),i("span",I2,u(t.paginate.meta.total||0),1)):r("",!0)]),e("div",Q2,[e("div",T2,[e("table",B2,[R2,e("tbody",null,[(l(!0),i(g,null,y(t.filteredProductCategories,(n,a)=>(l(),i("tr",null,[e("th",M2,u(n.id),1),e("td",null,[e("a",{href:"javascript:void(0)",onClick:d=>t.selectProductCategory(n),"data-bs-toggle":"modal","data-bs-target":"#product-form-edit"},null,8,D2),m(u(n.title),1)]),e("td",null,[e("button",{type:"button",onClick:d=>t.changeCategoryStatus(n),class:"btn btn-outline-success"},[n.is_active?(l(),i("span",L2,"Активная")):(l(),i("span",K2,"Не активная"))],8,E2)]),e("td",null,[c(e("input",{type:"number",onChange:d=>t.updateCategory(n),"onUpdate:modelValue":d=>n.order_position=d,class:"form-control"},null,40,N2),[[h,n.order_position]])]),e("td",null,[e("button",{title:"Удалить товар",onClick:d=>t.removeProductCategory(n),class:"btn btn-outline-danger"},H2,8,J2)])]))),256))])])])]),t.paginate?(l(),$(j,{key:0,onPagination_page:t.nextProductCategories,pagination:t.paginate},null,8,["onPagination_page","pagination"])):r("",!0)],64))}}),X2={class:"nav nav-tabs my-3"},Z2={class:"nav-item"},x2={class:"nav-item"},ek={class:"nav-item"},tk={class:"nav-item"},sk={key:0},ok={class:"card mb-2"},lk=e("div",{class:"card-header"},[e("h6",null,"Управление магазином")],-1),ik={class:"card-body"},nk={class:"row"},ak={class:"col-12"},dk={class:"form-label d-flex justify-content-between mt-2",id:"bot-level-3"},rk=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),ck=e("div",null,"Ссылка на страницу ВК с товарами для вашего магазина в боте ",-1),uk=e("a",{href:"https://vk.com/groups?w=groups_create",target:"_blank"},"Создать",-1),mk=["disabled"],_k=e("i",{class:"fa-regular fa-floppy-disk mr-2"},null,-1),hk={class:"row mb-3"},pk={class:"col-md-3"},bk=["href"],fk=te('<div class="col-md-3"><button class="btn btn-outline-info w-100">Экспорт в XLS</button></div><div class="col-md-3"><button class="btn btn-outline-info w-100">Импорт из XLS</button></div><div class="col-md-3"><button class="btn btn-outline-danger w-100">Удалить товары</button></div>',3),gk=e("div",{class:"row"},[e("div",{class:"col-md-3"},[e("button",{class:"btn btn-outline-info w-100"},"Экспортировать заказы")])],-1),vk={key:1},$k={class:"modal fade",id:"product-form-edit",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},yk={class:"modal-dialog"},kk={class:"modal-content"},Fk=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Modal title"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),wk={class:"modal-body"},Ck=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close"),e("button",{type:"button",class:"btn btn-primary"},"Save changes")],-1),Sk={key:2},jk={key:3},qk={data(){return{load:!1,tab:0,url:null,link:null,bot:null,selectedProduct:null,selectedCategory:null,botForm:{vk_shop_link:null}}},computed:{...C(["getCurrentBot"])},mounted(){this.bot=this.getCurrentBot,this.botForm.vk_shop_link=this.bot.vk_shop_link||null,this.updateProducts()},methods:{updateShopLink(){this.load=!0,this.botForm.bot_id=this.bot.id,this.$store.dispatch("updateShopLink",{botForm:this.botForm}).then(s=>{this.load=!1,this.updateProducts(),this.$notify({title:"Менеджер магазина",text:"Ссылка на источник в ВК обновлена"})}).catch(()=>{this.load=!1})},refresh(){this.load=!0,this.selectedProduct=null,this.$nextTick(()=>{this.load=!1})},selectProduct(s){this.load=!0,this.$nextTick(()=>{this.selectedProduct=s,this.load=!1})},selectProductCategory(s){this.load=!0,this.$nextTick(()=>{this.selectedCategory=s,this.load=!1})},updateProducts(){this.load=!0,this.$store.dispatch("updateProductsFromVk",{dataObject:{bot_domain:this.getCurrentBot.bot_domain}}).then(s=>{this.link=s.data.url,this.load=!1,this.url=null}).catch(()=>{this.load=!1})}}},zk=Object.assign(qk,{__name:"Shop",setup(s){return(t,o)=>{const n=q("Popper");return l(),i(g,null,[e("ul",X2,[e("li",Z2,[e("a",{class:b(["nav-link",{active:t.tab===0}]),onClick:o[0]||(o[0]=a=>t.tab=0),"aria-current":"page",href:"#"},"Товары",2)]),e("li",x2,[e("a",{class:b(["nav-link",{active:t.tab===3}]),onClick:o[1]||(o[1]=a=>t.tab=3),href:"#"},"Категории товаров",2)]),e("li",ek,[e("a",{class:b(["nav-link",{active:t.tab===1}]),onClick:o[2]||(o[2]=a=>t.tab=1),href:"#"},"Настройка&Обновление",2)]),e("li",tk,[e("a",{class:b(["nav-link",{active:t.tab===2}]),onClick:o[3]||(o[3]=a=>t.tab=2),href:"#"},"Заказы",2)])]),t.tab===1?(l(),i("div",sk,[e("div",ok,[lk,e("div",ik,[e("div",nk,[e("div",ak,[e("form",{onSubmit:o[5]||(o[5]=S((...a)=>t.updateShopLink&&t.updateShopLink(...a),["prevent"])),class:"mb-2"},[e("label",dk,[e("div",null,[f(n,null,{content:v(()=>[ck]),default:v(()=>[rk]),_:1}),m(" ВК-группа ")]),uk]),c(e("input",{type:"url",class:"form-control",placeholder:"Ссылка на группу ВК","aria-label":"ссылка на группу ВК","onUpdate:modelValue":o[4]||(o[4]=a=>t.botForm.vk_shop_link=a),"aria-describedby":"vk_shop_link"},null,512),[[h,t.botForm.vk_shop_link]]),e("button",{disabled:t.load,class:"btn btn-outline-primary mt-2 mb-2 w-100"},[_k,m(" Сохранить ")],8,mk)],32)])]),e("div",hk,[e("div",pk,[e("a",{target:"_blank",href:t.link,class:"btn btn-primary w-100"}," Обновить товар ",8,bk)]),fk]),gk])])])):r("",!0),t.tab===0?(l(),i("div",vk,[t.bot&&!t.load?(l(),$(U2,{key:0,bot:t.bot,onSelect:t.selectProduct},null,8,["bot","onSelect"])):r("",!0),e("div",$k,[e("div",yk,[e("div",kk,[Fk,e("div",wk,[t.bot&&!t.load?(l(),$(re,{key:0,bot:t.bot,item:t.selectedProduct,onRefresh:t.refresh},null,8,["bot","item","onRefresh"])):r("",!0)]),Ck])])])])):r("",!0),t.tab===2?(l(),i("div",Sk)):r("",!0),t.tab===3?(l(),i("div",jk,[t.bot&&!t.load?(l(),$(W2,{key:0,bot:t.bot,onSelect:t.selectProductCategory},null,8,["bot","onSelect"])):r("",!0)])):r("",!0)],64)}}}),Vk={props:["data"],data(){return{hasConnect:!1,bot:null,amoForm:{client_id:null,client_secret:null,auth_code:null,redirect_uri:null,subdomain:null,bot_id:null}}},computed:{...C(["getCurrentBot"])},mounted(){this.bot=this.getCurrentBot,this.data?this.$nextTick(()=>{this.amoForm.client_id=this.data.client_id||null,this.amoForm.client_secret=this.data.client_secret||null,this.amoForm.auth_code=this.data.auth_code||null,this.amoForm.redirect_uri=this.data.redirect_uri||null,this.amoForm.subdomain=this.data.subdomain||null,this.amoForm.bot_id=this.data.bot_id||this.bot.id||null}):this.amoForm.bot_id=this.bot.id||null},methods:{submitAmo(){let s=new FormData;Object.keys(this.amoForm).forEach(t=>{const o=this.amoForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.$store.dispatch("saveAmoCRM",{amoForm:s}).then(t=>{this.$notify("Данные CRM успешно сохранены")}).catch(t=>{})}}},Pk=e("div",{class:"col-12"},[e("p",null,[e("a",{target:"_blank",href:"https://www.amocrm.ru/developers/content/oauth/step-by-step"},"Документация для разработчика "),m(" по шагам")])],-1),Ok={class:"col-md-6 col-12 mb-2"},Uk={class:"form-label",id:"client_id"},Ak=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Ik=e("div",null,"ID интеграции",-1),Qk=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Tk={class:"col-md-6 col-12 mb-2"},Bk={class:"form-label",id:"client_secret"},Rk=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Mk=e("div",null,"Секрет интеграции",-1),Dk=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Ek={class:"col-md-6 mb-2"},Lk={class:"form-label",id:"auth_code"},Kk=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Nk=e("div",null,"Полученный код авторизации",-1),Jk=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Yk={class:"col-md-6 col-12 mb-2"},Hk={class:"form-label",id:"subdomain2"},Gk=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Wk=e("div",null,"Ваш поддомен в системе AMO CRM",-1),Xk=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Zk=e("div",{class:"col-md-12 col-12"},[e("button",{type:"submit",class:"btn btn-outline-primary p-3 w-100"},[e("i",{class:"fa-solid fa-cloud-arrow-down mr-1"}),m(" Сохранить настройку AMO ")])],-1);function xk(s,t,o,n,a,d){const _=q("Popper");return l(),i("form",{onSubmit:t[4]||(t[4]=S((...p)=>d.submitAmo&&d.submitAmo(...p),["prevent"])),class:"row"},[Pk,e("div",Ok,[e("label",Uk,[f(_,null,{content:v(()=>[Ik]),default:v(()=>[Ak]),_:1}),m(" client_id "),Qk]),c(e("input",{type:"text",class:"form-control",placeholder:"client_id","aria-label":"client_id","onUpdate:modelValue":t[0]||(t[0]=p=>a.amoForm.client_id=p),"aria-describedby":"client_id"},null,512),[[h,a.amoForm.client_id]])]),e("div",Tk,[e("label",Bk,[f(_,null,{content:v(()=>[Mk]),default:v(()=>[Rk]),_:1}),m(" client_secret "),Dk]),c(e("input",{type:"text",class:"form-control",placeholder:"client_secret","aria-label":"client_secret","onUpdate:modelValue":t[1]||(t[1]=p=>a.amoForm.client_secret=p),"aria-describedby":"client_secret"},null,512),[[h,a.amoForm.client_secret]])]),e("div",Ek,[e("label",Lk,[f(_,null,{content:v(()=>[Nk]),default:v(()=>[Kk]),_:1}),m(" auth_code "),Jk]),c(e("textarea",{class:"form-control",placeholder:"auth_code","aria-label":"auth_code","onUpdate:modelValue":t[2]||(t[2]=p=>a.amoForm.auth_code=p),"aria-describedby":"auth_code"},`
                                    `,512),[[h,a.amoForm.auth_code]])]),e("div",Yk,[e("label",Hk,[f(_,null,{content:v(()=>[Wk]),default:v(()=>[Gk]),_:1}),m(" subdomain "),Xk]),c(e("input",{type:"text",class:"form-control",placeholder:"subdomain","aria-label":"subdomain","onUpdate:modelValue":t[3]||(t[3]=p=>a.amoForm.subdomain=p),"aria-describedby":"subdomain"},null,512),[[h,a.amoForm.subdomain]])]),Zk],32)}const e0=O(Vk,[["render",xk]]),t0={props:["data"],data(){return{load:!1,bot:null,yClientsForm:{login:null,password:null,partner_token:null,company:null}}},computed:{...C(["getCurrentBot"])},mounted(){this.bot=this.getCurrentBot,this.data&&this.$nextTick(()=>{this.yClientsForm.login=this.data.login||null,this.yClientsForm.password=this.data.password||null,this.yClientsForm.partner_token=this.data.partner_token||null,this.yClientsForm.company=this.data.company||null})},methods:{submitYClients(){let s=new FormData;Object.keys(this.yClientsForm).forEach(t=>{const o=this.yClientsForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),s.append("bot_id",this.bot.id),this.$store.dispatch("saveYClients",{yClientsForm:s}).then(t=>{this.$notify({title:"Работа с YClients",text:"Данные YClients успешно сохранены",type:"success"})}).catch(t=>{this.$notify({title:"Работа с YClients",text:"Ошибка сохранения данных",type:"error"})})}}},s0=e("h6",null,"Настройка YClients",-1),o0={class:"row"},l0={class:"col-md-12"},i0={class:"mb-2"},n0=e("label",{class:"form-label d-flex justify-content-between mt-2",for:"login"},[m(" Логин "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),a0={class:"mb-2"},d0=e("label",{class:"form-label d-flex justify-content-between mt-2",for:"password"},[m(" Пароль "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),r0={class:"mb-2"},c0=e("label",{class:"form-label d-flex justify-content-between mt-2",for:"partner_token"},[m(" Партнерский тоукен "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),u0={class:"mb-2"},m0=e("label",{class:"form-label d-flex justify-content-between mt-2",for:"partner_token"},[m(" ID компании, в которую записывать клиентов "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),_0=e("button",{class:"btn btn-success w-100 r mb-3 text-uppercase font-900"}," Сохранить ",-1);function h0(s,t,o,n,a,d){return l(),i(g,null,[s0,e("form",{onSubmit:t[4]||(t[4]=S((..._)=>d.submitYClients&&d.submitYClients(..._),["prevent"]))},[e("div",o0,[e("div",l0,[e("div",i0,[n0,c(e("input",{type:"text",id:"login",class:"form-control",placeholder:"Ваш логин","aria-label":"Ваш логин","onUpdate:modelValue":t[0]||(t[0]=_=>a.yClientsForm.login=_),"aria-describedby":"Ваш логин",required:""},null,512),[[h,a.yClientsForm.login]])]),e("div",a0,[d0,c(e("input",{type:"text",id:"password",class:"form-control",placeholder:"Ваш пароль","aria-label":"Ваш пароль","onUpdate:modelValue":t[1]||(t[1]=_=>a.yClientsForm.password=_),"aria-describedby":"Ваш пароль",required:""},null,512),[[h,a.yClientsForm.password]])]),e("div",r0,[c0,c(e("input",{type:"text",id:"partner_token",class:"form-control",placeholder:"Ваш партнерский тоукен","aria-label":"Ваш партнерский тоукен","onUpdate:modelValue":t[2]||(t[2]=_=>a.yClientsForm.partner_token=_),"aria-describedby":"Ваш партнерский тоукен",required:""},null,512),[[h,a.yClientsForm.partner_token]])]),e("div",u0,[m0,c(e("input",{type:"number",id:"throttle",class:"form-control",placeholder:"ID компании","aria-label":"ID компании","onUpdate:modelValue":t[3]||(t[3]=_=>a.yClientsForm.company=_),"aria-describedby":"ID компании",required:""},null,512),[[h,a.yClientsForm.company]])])])]),_0],32)],64)}const p0=O(t0,[["render",h0]]),b0={class:"py-2"},f0={class:"nav nav-tabs"},g0={class:"nav-item"},v0={class:"nav-item"},$0={key:0,class:"row"},y0={class:"col-12 py-2"},k0={key:1,class:"row"},F0={class:"col-12 py-2"},w0={class:"col-12"},C0={props:["bot"],data(){return{tab:1,load:!1,loadMailingTable:!1}},mounted(){},methods:{callbackPersonalMail(){this.loadMailingTable=!0,this.$nextTick(()=>{this.loadMailingTable=!1})}}},S0=Object.assign(C0,{__name:"Mail",setup(s){return(t,o)=>(l(),i("div",b0,[e("ul",f0,[e("li",g0,[e("a",{class:b(["nav-link",{active:t.tab===0}]),onClick:o[0]||(o[0]=n=>t.tab=0),"aria-current":"page",href:"#"},"Рассылка в канал",2)]),e("li",v0,[e("a",{class:b(["nav-link",{active:t.tab===1}]),onClick:o[1]||(o[1]=n=>t.tab=1),href:"#"},"Рассылка в бота",2)])]),t.tab===0?(l(),i("div",$0,[e("div",y0,[f(he)])])):r("",!0),t.tab===1?(l(),i("div",k0,[e("div",F0,[f(pe,{onCallback:t.callbackPersonalMail},null,8,["onCallback"])]),e("div",w0,[t.loadMailingTable?r("",!0):(l(),$(be,{key:0,bot:s.bot},null,8,["bot"]))])])):r("",!0)]))}}),j0={data(){return{load:!1,bot:null,fieldTypes:[{title:"Текст",value:0},{title:"Число",value:1},{title:"Логический",value:2},{title:"Дата и время",value:3}],fieldForm:{fields:[]}}},computed:{...C(["getCurrentBot"])},mounted(){this.loadCurrentBot().then(()=>{this.bot=this.getCurrentBot,this.$nextTick(()=>{this.fieldForm.fields=this.bot.field_settings||[]}),this.loadCurrentBotFields()})},methods:{loadCurrentBotFields(){return this.$store.dispatch("loadCurrentBotFields",{bot_id:this.bot.id}).then(s=>{this.fieldForm.fields=s.data||[]})},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},removeField(s){this.fieldForm.fields.splice(s,1)},submit(){let s=new FormData;Object.keys(this.fieldForm).forEach(t=>{const o=this.fieldForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),s.append("bot_id",this.bot.id),this.$store.dispatch("storeBotFields",{dataObject:s}).then(t=>{this.$notify({title:"Конструктор ботов",text:"Поля успешно обновлены",type:"success"}),this.fieldForm.fields=[],this.fieldForm.fields=t.data}).catch(t=>{this.$notify({title:"Конструктор ботов",text:"Ошибка обновления полей",type:"error"})})},addField(){if(this.fieldForm.fields||(this.fieldForm.fields=[]),this.fieldForm.fields.length>0&&this.fieldForm.fields.findIndex(t=>t.key==null)!==-1){this.$notify({title:"Настраиваемые поля",text:"У вас есть пустые ключевые поля!",type:"error"});return}this.fieldForm.fields.push({key:null,type:0,label:null,description:null,required:!1,validate_pattern:null})}}},q0={class:"mb-2"},z0={class:"d-flex justify-content-between"},V0=e("h6",null,"Настройка полей пользователя бота",-1),P0=e("i",{class:"fa-solid fa-plus mr-2"},null,-1),O0=e("p",null,[e("em",null,"Данные поля будут добавлены пользователю бота и будут автоматически учитываться в условиях страниц, скриптах (в формах заполнения данных), диалогах. Ключи должны быть уникальные для каждого бота. Если ключ дублируется, то будет использовано более позднее его значение. Если поле добавлено и сохранено, то удалить его уже нельзя, только скрыть. "),m(". "),e("br"),e("span",{class:"text-danger"},"*"),m(" - обязательное поле ")],-1),U0={class:"table"},A0=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},[m("Ключ"),e("span",{class:"text-danger"},"*")]),e("th",{scope:"col"},[m("Подпись поля"),e("span",{class:"text-danger"},"*")]),e("th",{scope:"col"},[m("Тип поля"),e("span",{class:"text-danger"},"*")]),e("th",{scope:"col"},"Паттерн"),e("th",{scope:"col"},"Обязательный"),e("th",{scope:"col"},[m("Вопрос для анкеты"),e("span",{class:"text-danger"},"*")]),e("th",{scope:"col"})])],-1),I0={scope:"row"},Q0={scope:"col"},T0=["onUpdate:modelValue"],B0={scope:"col"},R0=["onUpdate:modelValue"],M0={scope:"col"},D0=["onUpdate:modelValue"],E0=["value"],L0={scope:"col"},K0=["disabled","onUpdate:modelValue"],N0={scope:"col"},J0={class:"form-check"},Y0=["onUpdate:modelValue","id"],H0=["for"],G0={key:0},W0={key:1},X0={scope:"col"},Z0=["onUpdate:modelValue"],x0={scope:"col"},e3=["onClick"],t3=e("i",{class:"fa-regular fa-trash-can"},null,-1),s3=[t3],o3={key:1,class:"form-check mt-2"},l3=["onUpdate:modelValue","id"],i3=["for"],n3={key:0},a3=e("i",{class:"fa-solid fa-eye text-success"},null,-1),d3=[a3],r3={key:1},c3=e("i",{class:"fa-solid fa-eye-slash text-danger"},null,-1),u3=[c3],m3=e("button",{type:"submit",class:"btn btn-success w-100 p-3"}," Сохранить поля ",-1);function _3(s,t,o,n,a,d){return l(),i("div",q0,[e("div",z0,[V0,e("button",{type:"button",onClick:t[0]||(t[0]=_=>d.addField()),class:"btn mb-2 rounded-sm btn-outline-info"},[P0,m(" Добавить параметр ")])]),O0,e("form",{onSubmit:t[1]||(t[1]=S((..._)=>d.submit&&d.submit(..._),["prevent"]))},[e("table",U0,[A0,e("tbody",null,[(l(!0),i(g,null,y(a.fieldForm.fields,(_,p)=>(l(),i("tr",null,[e("th",I0,u(p+1),1),e("th",Q0,[c(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Ключ","aria-label":"Ключ",maxlength:"255","onUpdate:modelValue":F=>a.fieldForm.fields[p].key=F,required:""},null,8,T0),[[h,a.fieldForm.fields[p].key]])]),e("th",B0,[c(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Подпись поля","aria-label":"Название поля",maxlength:"255","onUpdate:modelValue":F=>a.fieldForm.fields[p].label=F,required:""},null,8,R0),[[h,a.fieldForm.fields[p].label]])]),e("th",M0,[c(e("select",{class:"form-select","onUpdate:modelValue":F=>a.fieldForm.fields[p].type=F},[(l(!0),i(g,null,y(a.fieldTypes,F=>(l(),i("option",{value:F.value},u(F.title||"Не указан"),9,E0))),256))],8,D0),[[I,a.fieldForm.fields[p].type]])]),e("th",L0,[c(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Паттерн","aria-label":"Паттерн",maxlength:"255",disabled:a.fieldForm.fields[p].type===2,"onUpdate:modelValue":F=>a.fieldForm.fields[p].validate_pattern=F},null,8,K0),[[h,a.fieldForm.fields[p].validate_pattern]])]),e("th",N0,[e("div",J0,[c(e("input",{class:"form-check-input","onUpdate:modelValue":F=>a.fieldForm.fields[p].required=F,type:"checkbox",value:"",id:"field-required"+p},null,8,Y0),[[k,a.fieldForm.fields[p].required]]),e("label",{class:"form-check-label",for:"field-required"+p},[a.fieldForm.fields[p].required?(l(),i("span",G0,"Да")):r("",!0),a.fieldForm.fields[p].required?r("",!0):(l(),i("span",W0,"Нет"))],8,H0)])]),e("th",X0,[c(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Описание вопроса","aria-label":"Описание вопроса",maxlength:"255","onUpdate:modelValue":F=>a.fieldForm.fields[p].description=F,required:""},null,8,Z0),[[h,a.fieldForm.fields[p].description]])]),e("th",x0,[a.fieldForm.fields[p].id?(l(),i("div",o3,[c(e("input",{class:"form-check-input d-none","onUpdate:modelValue":F=>a.fieldForm.fields[p].is_active=F,type:"checkbox",value:"",id:"field-is_active-"+p},null,8,l3),[[k,a.fieldForm.fields[p].is_active]]),e("label",{class:"form-check-label",for:"field-is_active-"+p},[a.fieldForm.fields[p].is_active?(l(),i("span",n3,d3)):r("",!0),a.fieldForm.fields[p].is_active?r("",!0):(l(),i("span",r3,u3))],8,i3)])):(l(),i("button",{key:0,type:"button",onClick:F=>d.removeField(p),class:"btn btn-link text-danger"},s3,8,e3))])]))),256))])]),m3],32)])}const h3=O(j0,[["render",_3]]),p3={class:"row"},b3={class:"input-group mb-3"},f3={key:0,class:"row"},g3={class:"col-12 col-md-12 mb-3"},v3={class:"table"},$3=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"Тип"),e("th",{scope:"col"},"Подпись"),e("th",{scope:"col"},"File Id"),e("th",{scope:"col"},"Действия")])],-1),y3={scope:"row"},k3={class:"badge bg-info rounded-pill"},F3={style:{"word-break":"break-all"}},w3={style:{"word-break":"break-all"}},C3={style:{"min-width":"200px"}},S3=["onClick"],j3=e("i",{class:"fa-solid fa-eye"},null,-1),q3=[j3],z3=["onClick"],V3=e("i",{class:"fa-brands fa-telegram"},null,-1),P3=[V3],O3=["onClick"],U3=e("i",{class:"fa-solid fa-trash"},null,-1),A3=[U3],I3={class:"col-12"},Q3={key:1,class:"row"},T3=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет медиа-файлов ")],-1),B3=[T3],R3={class:"modal fade",id:"preview-modal",tabindex:"-1","aria-labelledby":"preview-modal-label","aria-hidden":"true"},M3={class:"modal-dialog"},D3={class:"modal-content"},E3={class:"modal-body"},L3={key:0,class:"d-flex justify-content-center align-items-center"},K3=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),N3={data(){return{bot:null,previewContent:null,loading:!0,media:[],search:null,media_paginate_object:null}},computed:{...C(["getMedia","getMediaPaginateObject","getCurrentBot"])},mounted(){this.loadCurrentBot().then(()=>{this.loadMedia()})},methods:{selectMedia(s){this.$emit("select",s)},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},nextMedia(s){this.loadMedia(s)},remove(s){this.$store.dispatch("removeMedia",{dataObject:{mediaId:s}}).then(t=>{this.loadMedia(),this.$notify({title:"Удаление медиа-контента",text:"Медиа контент удален"})}).catch(()=>{})},showPreview(s){this.previewContent=null,this.$nextTick(()=>{this.previewContent=s,new bootstrap.Modal("#preview-modal",{}).show()})},showPreviewInTg(s){this.$store.dispatch("showMediaPreview",{dataObject:{mediaId:s}}).then(t=>{this.$notify({title:"Превью медиа-контента",text:"Отправлено в бота"})}).catch(()=>{})},loadMedia(s=0){this.loading=!0,this.$store.dispatch("loadMedia",{dataObject:{bot_id:this.bot.id||null,search:this.search,needVideo:!0,needVideoNote:!0,needPhoto:!0,needAudio:!0,needDocument:!0,needSticker:!0},page:s}).then(t=>{this.loading=!1,this.media=this.getMedia,this.media_paginate_object=this.getMediaPaginateObject}).catch(()=>{this.loading=!1})}}},J3=Object.assign(N3,{__name:"BotMediaTable",setup(s){return(t,o)=>(l(),i(g,null,[e("div",p3,[e("div",b3,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск файла","aria-label":"Поиск файла","onUpdate:modelValue":o[0]||(o[0]=n=>t.search=n)},null,512),[[h,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=n=>t.loadMedia(0)),type:"button",id:"button-addon2"},"Найти ")])]),t.media.length>0?(l(),i("div",f3,[e("div",g3,[e("table",v3,[$3,e("tbody",null,[(l(!0),i(g,null,y(t.media,(n,a)=>(l(),i("tr",null,[e("th",y3,u(n.id),1),e("td",null,[e("span",k3,u(n.type),1)]),e("td",null,[e("p",F3,u(n.caption??"Без подписи"),1)]),e("td",null,[e("p",w3,u(n.file_id),1)]),e("td",null,[e("div",C3,[e("a",{href:"javascript:void(0)",class:"btn btn-info mr-2",onClick:d=>t.showPreview(n)},q3,8,S3),e("a",{href:"javascript:void(0)",class:"btn btn-info mr-2",onClick:d=>t.showPreviewInTg(n.id)},P3,8,z3),e("a",{href:"javascript:void(0)",class:"btn btn-outline-danger text-danger",onClick:d=>t.remove(n.id)},A3,8,O3)])])]))),256))])])]),e("div",I3,[t.media_paginate_object?(l(),$(j,{key:0,onPagination_page:t.nextMedia,pagination:t.media_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",Q3,B3)),e("div",R3,[e("div",M3,[e("div",D3,[e("div",E3,[t.previewContent!=null?(l(),i("div",L3,[f(J,{type:t.previewContent.type,content:t.previewContent.file_id},null,8,["type","content"])])):r("",!0)]),K3])])])],64))}}),Y3={class:"row py-3"},H3={class:"col-12"},G3={class:"row"},W3={class:"col-12"},X3={key:0},Z3={key:1},x3={key:0,class:"col-12 mb-3"},eF={class:"col-12 mb-3"},tF={key:0},sF={key:1},oF={key:1,class:"col-12 mb-3"},lF={class:"row py-3"},iF=e("div",{class:"col-12"},[e("p",{class:"mb-0"},"Выбор статуса")],-1),nF={class:"col-md-3"},aF=["onClick"],dF={class:"row"},rF={class:"col-12 mb-3"},cF={class:"form-label",id:"service-title"},uF=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),mF=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),_F={class:"col-12 mb-3"},hF={class:"form-label",id:"service-title"},pF=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),bF=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),fF={class:"col-12 mb-3"},gF={class:"form-label",id:"appointment-info"},vF=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),$F=e("div",null," Краткая информация от клиента ",-1),yF=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),kF={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},FF={class:"row"},wF={class:"col-12"},CF={type:"submit",class:"btn btn-outline-success w-100 p-3"},SF={key:0},jF={key:1},qF={props:["eventId","bot","appointment"],data(){return{step:0,load:!1,selected_schedule_time:null,selected_bot_user:null,need_load_users:!1,need_schedule_time:!1,statuses:[{value:0,title:"Новая запись"},{value:1,title:"Подтверждение записи"},{value:2,title:"Прохождение по записи"},{value:3,title:"Отмена записи"}],days:["понедельник","вторник","среду","четверг","пятницу","субботу","воскресенье"],appointmentForm:{id:null,appointment_event_id:null,appointment_schedule_id:null,bot_user_id:null,status:0,name:null,phone:null,info:null}}},mounted(){this.appointment&&this.$nextTick(()=>{this.appointmentForm={id:this.appointment.id||null,appointment_event_id:this.appointment.appointment_event_id||null,appointment_schedule_id:this.appointment.appointment_schedule_id||null,bot_user_id:this.appointment.bot_user_id||null,status:this.appointment.status||0,name:this.appointment.name||null,phone:this.appointment.phone||null,info:this.appointment.info||null},this.selected_schedule_time=this.appointment.schedule||null,this.selected_bot_user=this.appointment.botUser||null})},methods:{selectScheduleTime(s){if(s.appointment){this.$notify("Данное время уже занято!");return}this.selected_schedule_time=s,this.need_schedule_time=!1},selectBotUser(s){this.selected_bot_user=s,this.need_load_users=!1},clearAppointmentForm(){this.appointmentForm={id:null,appointment_event_id:null,appointment_schedule_id:null,bot_user_id:null,status:0},this.selected_schedule_time=null,this.selected_bot_user=null},submitForm(){this.appointmentForm.bot_user_id=this.selected_bot_user.id,this.appointmentForm.appointment_schedule_id=this.selected_schedule_time.id,this.appointmentForm.appointment_event_id=this.eventId;let s=new FormData;Object.keys(this.appointmentForm).forEach(t=>{const o=this.appointmentForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),s.append("bot_id",this.bot.id),this.$store.dispatch("storeAppointment",{dataObject:{appointmentForm:s}}).then(t=>{this.clearAppointmentForm(),this.$emit("callback"),this.$notify("Запись успешно создана")}).catch(t=>{this.$notify("Ошибка создания записи")})}}},zF=Object.assign(qF,{__name:"AppointmentForm",setup(s){return(t,o)=>{const n=q("Popper"),a=Q("mask");return l(),i(g,null,[e("div",Y3,[e("div",H3,[e("button",{onClick:o[0]||(o[0]=(...d)=>t.clearAppointmentForm&&t.clearAppointmentForm(...d)),class:"btn btn-primary"},"Новая заявка ")])]),e("form",{onSubmit:o[6]||(o[6]=S((...d)=>t.submitForm&&t.submitForm(...d),["prevent"]))},[e("div",G3,[e("div",W3,[e("a",{href:"javascript:void(0)",class:"btn btn-link",onClick:o[1]||(o[1]=d=>t.need_load_users=!t.need_load_users)},[t.selected_bot_user==null?(l(),i("span",X3,"Выберите пользователя")):r("",!0),t.selected_bot_user?(l(),i("span",Z3," Пользователь "+u(t.selected_bot_user.name||t.selected_bot_user.fio_from_telegram||t.selected_bot_user.telegram_chat_id||"-"),1)):r("",!0)])]),t.need_load_users?(l(),i("div",x3,[f(D,{simple:!0,onSelect:t.selectBotUser},null,8,["onSelect"])])):r("",!0),e("div",eF,[e("a",{href:"javascript:void(0)",class:"btn btn-link",onClick:o[2]||(o[2]=d=>t.need_schedule_time=!t.need_schedule_time)},[t.selected_schedule_time==null?(l(),i("span",tF,"Выберите время в расписании")):r("",!0),t.selected_schedule_time?(l(),i("span",sF," Запись на "+u(t.days[t.selected_schedule_time.day-1]||"-")+" с "+u(t.selected_schedule_time.start_time||"-")+" до "+u(t.selected_schedule_time.end_time||"-"),1)):r("",!0)])]),t.need_schedule_time?(l(),i("div",oF,[f(ie,{"event-id":s.eventId,bot:s.bot,onSelect:t.selectScheduleTime},null,8,["event-id","bot","onSelect"])])):r("",!0)]),e("div",lF,[iF,(l(!0),i(g,null,y(t.statuses,d=>(l(),i("div",nF,[e("button",{type:"button",class:b([{"btn-success text-white":t.appointmentForm.status==d.value},"btn btn-outline-success w-100"]),onClick:_=>t.appointmentForm.status=d.value},u(d.title||"не указано"),11,aF)]))),256))]),e("div",dF,[e("div",rF,[e("label",cF,[f(n,{content:"ФИО человека, который посетит запись"},{default:v(()=>[uF]),_:1}),m(" Ф.И.О. посетителя "),mF]),c(e("input",{type:"text",class:"form-control",placeholder:"Иванов Иван Иванович","aria-label":"ФИО","onUpdate:modelValue":o[3]||(o[3]=d=>t.appointmentForm.name=d),maxlength:"255","aria-describedby":"appointment-name",required:""},null,512),[[h,t.appointmentForm.name]])]),e("div",_F,[e("label",hF,[f(n,{content:"Номер телефона человека, который посетит запись"},{default:v(()=>[pF]),_:1}),m(" Телефонный номер "),bF]),c(e("input",{type:"text",class:"form-control",placeholder:"+7(000)000-00-00","aria-label":"номер телефона","onUpdate:modelValue":o[4]||(o[4]=d=>t.appointmentForm.phone=d),maxlength:"255","aria-describedby":"appointment-phone",required:""},null,512),[[a,"+7(###)###-##-##"],[h,t.appointmentForm.phone]])]),e("div",fF,[e("label",gF,[f(n,null,{content:v(()=>[$F]),default:v(()=>[vF]),_:1}),m(" Описание услуги "),yF,t.appointmentForm.info?(l(),i("small",kF," Длина текста "+u(t.appointmentForm.info.length)+" / 255",1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Информация от клиента","aria-label":"Информация от клиента",maxlength:"255","onUpdate:modelValue":o[5]||(o[5]=d=>t.appointmentForm.info=d),"aria-describedby":"appointment-info",required:""},`
                    `,512),[[h,t.appointmentForm.info]])])]),e("div",FF,[e("div",wF,[e("button",CF,[t.appointmentForm.id==null?(l(),i("span",SF,"Записаться")):(l(),i("span",jF,"Обновить запись"))])])])],32)],64)}}}),VF={class:"row"},PF={class:"col-12"},OF={key:0,class:"table"},UF=e("th",{scope:"col"},"Действие",-1),AF=["onClick"],IF={scope:"row"},QF={key:0},TF={key:0,class:"dropdown"},BF=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),RF={class:"dropdown-menu"},MF={key:0},DF=["onClick"],EF={key:1},LF={class:"col-12"},KF={props:["bot","eventId"],data(){return{direction:"desc",order:"updated_at",show:!0,is_group:!1,loading:!0,services:[],search:null,statuses:["Новая запись","Подтверждение записи","Прохождение по записи","Отмена записи"],days:["понедельник","вторник","среду","четверг","пятницу","субботу","воскресенье"],paginate_object:null}},computed:{...C(["getAppointments","getAppointmentsPaginateObject"])},mounted(){this.loadAppointments()},methods:{nextAppointments(s){this.loadAppointments(s)},selectAppointment(s){this.$emit("select",s)},loadAndOrder(s){this.order=s,this.direction=this.direction==="desc"?"asc":"desc",this.loadAppointments(0)},removeAppointment(s){this.loading=!0,this.$store.dispatch("removeAppointment",{dataObject:{appointmentId:s}}).then(t=>{this.loading=!1,this.loadAppointments(0),this.$notify("Запись успешно удалена")}).catch(()=>{this.loading=!1,this.$notify("Ошибка удаления записи")})},loadAppointments(s=0){this.loading=!0,this.$store.dispatch("loadAppointments",{dataObject:{event_id:this.eventId,bot_id:this.bot.id||null,search:this.search,order:this.order,direction:this.direction},page:s,size:100}).then(t=>{this.loading=!1,this.services=this.getAppointments,this.paginate_object=this.getAppointmentsPaginateObject}).catch(()=>{this.loading=!1})}}},NF=Object.assign(KF,{__name:"AppointmentsTable",setup(s){return(t,o)=>(l(),i("div",VF,[e("div",PF,[t.services.length>0?(l(),i("table",OF,[e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"cursor-pointer",onClick:o[0]||(o[0]=n=>t.loadAndOrder("id"))},"#"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[1]||(o[1]=n=>t.loadAndOrder("bot_user_id"))},"Пользователь"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[2]||(o[2]=n=>t.loadAndOrder("appointment_schedule_id"))},"Дата записи "),e("th",{scope:"col",class:"cursor-pointer",onClick:o[3]||(o[3]=n=>t.loadAndOrder("status"))},"Статус"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[4]||(o[4]=n=>t.loadAndOrder("name"))},"Посетитель"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[5]||(o[5]=n=>t.loadAndOrder("phone"))},"Телефон посетителя"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[6]||(o[6]=n=>t.loadAndOrder("info"))},"Доп.инф"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[7]||(o[7]=n=>t.loadAndOrder("updated_at"))},"Дата изменения"),UF])]),e("tbody",null,[(l(!0),i(g,null,y(t.services,(n,a)=>(l(),i("tr",{onClick:d=>t.selectAppointment(n),class:b({"border-info":n.deleted_at==null,"border-danger":n.deleted_at!=null})},[e("th",IF,u(n.id),1),e("td",null,u(n.botUser.fio_from_telegram||n.botUser.telegram_chat_id||"Не указано"),1),e("td",null,[n.schedule?(l(),i("p",QF," Запись на "+u(t.days[n.schedule.day-1]||"Не указано")+" с "+u(n.schedule.start_time||"Не указано")+" до "+u(n.schedule.end_time||"Не указано"),1)):r("",!0)]),e("td",null,u(t.statuses[n.status]),1),e("td",null,u(t.$filters.current(n.updated_at)),1),e("td",null,u(n.name||"не указано"),1),e("td",null,u(n.phone||"не указано"),1),e("td",null,u(n.info||"не указано"),1),e("td",null,[n.id?(l(),i("div",TF,[BF,e("ul",RF,[n.deleted_at==null?(l(),i("li",MF,[e("a",{class:"dropdown-item",onClick:d=>t.removeAppointment(n.id),href:"javascript:void(0)"},"Удалить",8,DF)])):r("",!0)])])):r("",!0)])],10,AF))),256))])])):(l(),i("p",EF,"На текущий момент нет ни одного созданного сервиса"))]),e("div",LF,[t.paginate_object?(l(),$(j,{key:0,onPagination_page:t.nextAppointments,pagination:t.paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])]))}}),JF={class:"row py-2"},YF={class:"col-12"},HF={class:"input-group mb-3"},GF={class:"col-12"},WF={key:0,class:"table"},XF=e("th",{scope:"col"},"Действие",-1),ZF={scope:"row"},xF=["onClick"],e5={key:0,class:"fa-solid fa-chevron-down text-success"},t5={key:1,class:"fa-solid fa-xmark text-danger"},s5={key:0,class:"dropdown"},o5=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),l5={class:"dropdown-menu"},i5={key:0},n5=["onClick"],a5={key:1},d5=["onClick"],r5={key:1},c5={class:"col-12"},u5={props:["bot"],data(){return{direction:"desc",order:"updated_at",show:!0,is_group:!1,loading:!0,events:[],search:null,paginate_object:null}},computed:{...C(["getAppointmentEvents","getAppointmentEventsPaginateObject"])},mounted(){this.loadAppointmentEvents()},methods:{duplicateAppointmentEvent(s){this.loading=!0,this.$store.dispatch("duplicateAppointmentEvent",{dataObject:{appointmentEventId:s,bot_id:this.bot.id}}).then(t=>{this.loading=!1,this.loadAppointmentEvents(0),this.$notify("Событие успешно продублировано")}).catch(()=>{this.loading=!1,this.$notify("Ошибка дублирования события")})},removeAppointmentEvent(s){this.loading=!0,this.$store.dispatch("removeAppointmentEvent",{dataObject:{appointmentEventId:s}}).then(t=>{this.loading=!1,this.loadAppointmentEvents(0),this.$notify("Событие успешно удалено")}).catch(()=>{this.loading=!1,this.$notify("Ошибка удаления события")})},nextAppointmentEvents(s){this.loadAppointmentEvents(s)},selectEvent(s){this.$emit("select",s)},loadAndOrder(s){this.order=s,this.direction=this.direction==="desc"?"asc":"desc",this.loadAppointmentEvents(0)},loadAppointmentEvents(s=0){this.loading=!0,this.$store.dispatch("loadAppointmentEvents",{dataObject:{bot_id:this.bot.id||null,search:this.search,is_group:this.is_group,order:this.order,direction:this.direction},page:s,size:20}).then(t=>{this.loading=!1,this.events=this.getAppointmentEvents,this.paginate_object=this.getAppointmentEventsPaginateObject}).catch(()=>{this.loading=!1})}}},m5=Object.assign(u5,{__name:"AppointmentEventTable",setup(s){return(t,o)=>(l(),i("div",JF,[e("div",YF,[e("div",HF,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск события","aria-label":"Поиск события","onUpdate:modelValue":o[0]||(o[0]=n=>t.search=n),"aria-describedby":"appointment-search-event"},null,512),[[h,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=n=>t.loadAppointmentEvents(0)),type:"button",id:"appointment-search-event"},"Найти ")])]),e("div",GF,[t.events.length>0?(l(),i("table",WF,[e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"cursor-pointer",onClick:o[2]||(o[2]=n=>t.loadAndOrder("id"))},"#"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[3]||(o[3]=n=>t.loadAndOrder("title"))},"Название"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[4]||(o[4]=n=>t.loadAndOrder("subtitle"))},"Подзаголовок"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[5]||(o[5]=n=>t.loadAndOrder("address"))},"Адрес"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[6]||(o[6]=n=>t.loadAndOrder("description"))},"Описание"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[7]||(o[7]=n=>t.loadAndOrder("is_group"))},"Групповое"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[8]||(o[8]=n=>t.loadAndOrder("updated_at"))},"Дата изменения"),XF])]),e("tbody",null,[(l(!0),i(g,null,y(t.events,(n,a)=>(l(),i("tr",{class:b({"border-info":n.deleted_at==null,"border-danger":n.deleted_at!=null})},[e("th",ZF,u(n.id),1),e("td",{onClick:d=>t.selectEvent(n)},u(n.title||"Не указано"),9,xF),e("td",null,u(n.subtitle||"Не указано"),1),e("td",null,u(n.address||"Не указано"),1),e("td",null,u(n.description||"Не указано"),1),e("td",null,[n.is_group?(l(),i("i",e5)):(l(),i("i",t5))]),e("td",null,u(t.$filters.current(n.updated_at)),1),e("td",null,[n.id?(l(),i("div",s5,[o5,e("ul",l5,[n.deleted_at==null?(l(),i("li",i5,[e("a",{class:"dropdown-item",onClick:d=>t.removeAppointmentEvent(n.id),href:"javascript:void(0)"},"Удалить",8,n5)])):r("",!0),n.deleted_at==null?(l(),i("li",a5,[e("a",{class:"dropdown-item",onClick:d=>t.duplicateAppointmentEvent(n.id),href:"javascript:void(0)"},"Дублировать",8,d5)])):r("",!0)])])):r("",!0)])],2))),256))])])):(l(),i("p",r5,"На текущий момент нет событий в вашем списке"))]),e("div",c5,[t.paginate_object?(l(),$(j,{key:0,onPagination_page:t.nextAppointmentEvents,pagination:t.paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])]))}}),_5={class:"row"},h5={class:"col-12"},p5={key:0,class:"table"},b5=e("th",{scope:"col"},"Действие",-1),f5={scope:"row"},g5=["onClick"],v5={key:0,class:"fa-solid fa-chevron-down text-success"},$5={key:1,class:"fa-solid fa-xmark text-danger"},y5={key:0,class:"dropdown"},k5=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),F5={class:"dropdown-menu"},w5={key:0},C5=["onClick"],S5={key:1},j5={class:"col-12"},q5={props:["bot","eventId"],data(){return{direction:"desc",order:"updated_at",show:!0,is_group:!1,loading:!0,services:[],search:null,paginate_object:null}},computed:{...C(["getAppointmentServices","getAppointmentServicesPaginateObject"])},mounted(){this.loadAppointmentServices()},methods:{nextAppointmentService(s){this.loadAppointmentServices(s)},selectService(s){this.$emit("select",s)},removeAppointmentService(s){this.loading=!0,this.$store.dispatch("removeAppointmentService",{dataObject:{appointmentServiceId:s}}).then(t=>{this.loading=!1,this.loadAppointmentServices(0),this.$notify("Сервис успешно удален")}).catch(()=>{this.loading=!1,this.$notify("Ошибка удаления сервиса")})},loadAndOrder(s){this.order=s,this.direction=this.direction==="desc"?"asc":"desc",this.loadAppointmentServices(0)},loadAppointmentServices(s=0){this.loading=!0,this.$store.dispatch("loadAppointmentServices",{dataObject:{event_id:this.eventId,bot_id:this.bot.id||null,search:this.search,order:this.order,direction:this.direction},page:s,size:100}).then(t=>{this.loading=!1,this.services=this.getAppointmentServices,this.paginate_object=this.getAppointmentServicesPaginateObject}).catch(()=>{this.loading=!1})}}},z5=Object.assign(q5,{__name:"AppointmentServicesTable",setup(s){return(t,o)=>(l(),i("div",_5,[e("div",h5,[t.services.length>0?(l(),i("table",p5,[e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"cursor-pointer",onClick:o[0]||(o[0]=n=>t.loadAndOrder("id"))},"#"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[1]||(o[1]=n=>t.loadAndOrder("title"))},"Название"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[2]||(o[2]=n=>t.loadAndOrder("subtitle"))},"Подзаголовок"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[3]||(o[3]=n=>t.loadAndOrder("description"))},"Описание"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[4]||(o[4]=n=>t.loadAndOrder("is_group"))},"Групповое"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[5]||(o[5]=n=>t.loadAndOrder("updated_at"))},"Дата изменения"),b5])]),e("tbody",null,[(l(!0),i(g,null,y(t.services,(n,a)=>(l(),i("tr",{class:b({"border-info":n.deleted_at==null,"border-danger":n.deleted_at!=null})},[e("th",f5,u(n.id),1),e("td",{onClick:d=>t.selectService(n)},u(n.title||"Не указано"),9,g5),e("td",null,u(n.subtitle||"Не указано"),1),e("td",null,u(n.description||"Не указано"),1),e("td",null,[n.is_group?(l(),i("i",v5)):(l(),i("i",$5))]),e("td",null,u(t.$filters.current(n.updated_at)),1),e("td",null,[n.id?(l(),i("div",y5,[k5,e("ul",F5,[n.deleted_at==null?(l(),i("li",w5,[e("a",{class:"dropdown-item",onClick:d=>t.removeAppointmentService(n.id),href:"javascript:void(0)"},"Удалить",8,C5)])):r("",!0)])])):r("",!0)])],2))),256))])])):(l(),i("p",S5,"На текущий момент нет ни одного созданого сервиса"))]),e("div",j5,[t.paginate_object?(l(),$(j,{key:0,onPagination_page:t.nextAppointmentService,pagination:t.paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])]))}}),V5={class:"row"},P5={class:"col-12 mb-3"},O5={class:"form-label",id:"event-title"},U5=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),A5=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),I5={class:"col-12 mb-3"},Q5={class:"form-label",id:"event-subtitle"},T5=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),B5=e("div",null,"Подзаголовок события или доп. инфа под названием события ",-1),R5=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),M5={class:"col-12 mb-3"},D5={class:"form-check"},E5=e("label",{class:"form-check-label",for:"need_add_address"}," Нужно указать адрес и координат мероприятия ",-1),L5={key:0,class:"col-12 mb-3"},K5={class:"form-label",id:"event-address"},N5=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),J5=e("div",null,"Адрес, указывающий точное место проведения события \\ мероприятия ",-1),Y5={key:1,class:"col-12 mb-3"},H5={class:"form-label",id:"event-coords"},G5=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),W5=e("div",null,"Координаты мероприятия ",-1),X5={class:"col-12 mb-3"},Z5={class:"form-label",id:"event-description"},x5=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),ew=e("div",null," Краткая информация о происходящем мероприятии ",-1),tw=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),sw={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},ow={class:"col-12 mb-3"},lw={class:"form-label",id:"event-on_start_appointment"},iw=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),nw=e("div",null," Текст, который будет отображен клиенту, когда тот записался ",-1),aw=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),dw={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},rw={class:"col-12 mb-3"},cw={class:"form-label",id:"event-on_cancel_appointment"},uw=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),mw=e("div",null," Текст, который будет отображен клиенту, когда тот отменил запись ",-1),_w=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),hw={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},pw={class:"col-12 mb-3"},bw={class:"form-label",id:"event-on_after_appointment"},fw=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),gw=e("div",null," Текст, который будет отображен клиенту, когда тот прошел событие успешно ",-1),vw=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),$w={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},yw={class:"col-12 mb-3"},kw={class:"form-label",id:"event-on_repeat_appointment"},Fw=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),ww=e("div",null," Текст, который будет отображен клиенту, когда тот записывается 2й и более раз ",-1),Cw=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Sw={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},jw={class:"col-12 mb-3"},qw={class:"form-check"},zw=e("label",{class:"form-check-label",for:"need_media"}," Нужно изображение к событию ",-1),Vw={key:2,class:"col-12 mb-3"},Pw={class:"form-label",id:"event-images"},Ow=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Uw=e("div",null," Изображение, которое видит пользователь при выборе события ",-1),Aw=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Iw={class:"col-12 mb-3"},Qw={class:"form-check"},Tw=e("label",{class:"form-check-label",for:"is-group"}," Является групповым мероприятием ",-1),Bw={key:3,class:"col-md-6 col-12 mb-3"},Rw={class:"form-label",id:"event-min_people"},Mw=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Dw=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Ew={key:4,class:"col-md-6 col-12 mb-3"},Lw={class:"form-label",id:"event-max_people"},Kw=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Nw=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Jw={class:"row"},Yw={class:"col-12"},Hw={type:"submit",class:"btn btn-outline-success w-100 p-3"},Gw={key:0},Ww={key:1},Xw={props:["event","bot"],data(){return{step:0,load:!1,need_reset:!1,need_services:!1,need_add_address:!1,need_media:!1,eventForm:{id:null,title:null,subtitle:null,description:null,address:null,coords:null,images:[],services:[],times:[],is_group:!1,max_people:0,min_people:0,on_start_appointment:null,on_cancel_appointment:null,on_after_appointment:null,on_repeat_appointment:null}}},watch:{eventForm:{handler(s){this.need_reset=!0},deep:!0}},mounted(){this.event&&this.$nextTick(()=>{this.eventForm={id:this.event.id||null,title:this.event.title||null,subtitle:this.event.subtitle||null,description:this.event.description||null,images:this.event.images||[],is_group:this.event.is_group||!1,address:this.event.address||null,coords:this.event.coords||null,max_people:this.event.max_people||0,min_people:this.event.min_people||0,on_start_appointment:this.event.on_start_appointment||null,on_cancel_appointment:this.event.on_cancel_appointment||null,on_after_appointment:this.event.on_after_appointment||null,on_repeat_appointment:this.event.on_repeat_appointment||null}})},methods:{selectPhotos(s){this.eventForm.images||(this.eventForm.images=[]);let t=this.eventForm.images.indexOf(s.file_id);t!==-1?this.eventForm.images.splice(t,1):this.eventForm.images.push(s.file_id)},resetForm(){},submitForm(){let s=new FormData;Object.keys(this.eventForm).forEach(t=>{const o=this.eventForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),s.append("bot_id",this.bot.id),this.$store.dispatch(this.eventForm.id===null?"addAppointmentEvent":"updateAppointmentEvent",{appointmentEventForm:s}).then(t=>{this.$emit("callback",t.data),this.$nextTick(()=>{this.eventForm={id:null,title:null,subtitle:null,description:null,address:null,coords:null,images:[],services:[],times:[],is_group:!1,max_people:0,min_people:0,on_start_appointment:null,on_cancel_appointment:null,on_after_appointment:null,on_repeat_appointment:null}}),this.$notify("Событие успешно создано")}).catch(t=>{this.$notify("Ошибка создания события")})}}},X=Object.assign(Xw,{__name:"AppointmentEventForm",setup(s){return(t,o)=>{const n=q("Popper"),a=Q("mask");return l(),i("form",{onSubmit:o[14]||(o[14]=S((...d)=>t.submitForm&&t.submitForm(...d),["prevent"]))},[e("div",V5,[e("div",P5,[e("label",O5,[f(n,{content:"Название вашего события (или специалиста), на которое планируется осуществить запись"},{default:v(()=>[U5]),_:1}),m(" Название события "),A5]),c(e("input",{type:"text",class:"form-control",placeholder:"Название","aria-label":"Название","onUpdate:modelValue":o[0]||(o[0]=d=>t.eventForm.title=d),maxlength:"255","aria-describedby":"event-title",required:""},null,512),[[h,t.eventForm.title]])]),e("div",I5,[e("label",Q5,[f(n,null,{content:v(()=>[B5]),default:v(()=>[T5]),_:1}),m(" Подзаголовок события "),R5]),c(e("input",{type:"text",class:"form-control",placeholder:"Подзаголовок","aria-label":"Подзаголовок","onUpdate:modelValue":o[1]||(o[1]=d=>t.eventForm.subtitle=d),maxlength:"255","aria-describedby":"event-subtitle",required:""},null,512),[[h,t.eventForm.subtitle]])]),e("div",M5,[e("div",D5,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[2]||(o[2]=d=>t.need_add_address=d),type:"checkbox",id:"need_add_address"},null,512),[[k,t.need_add_address]]),E5])]),t.need_add_address?(l(),i("div",L5,[e("label",K5,[f(n,null,{content:v(()=>[J5]),default:v(()=>[N5]),_:1}),m(" Адрес события \\ мероприятия ")]),c(e("input",{type:"text",class:"form-control",placeholder:"Адрес события","aria-label":"Адрес события","onUpdate:modelValue":o[3]||(o[3]=d=>t.eventForm.address=d),maxlength:"255","aria-describedby":"event-address",required:""},null,512),[[h,t.eventForm.address]])])):r("",!0),t.need_add_address?(l(),i("div",Y5,[e("label",H5,[f(n,null,{content:v(()=>[W5]),default:v(()=>[G5]),_:1}),m(" Координаты мероприятия: широта, долгота ")]),c(e("input",{type:"text",class:"form-control",placeholder:"00.0000,00.0000","aria-label":"Координаты события","onUpdate:modelValue":o[4]||(o[4]=d=>t.eventForm.coords=d),maxlength:"255","aria-describedby":"event-coords",required:""},null,512),[[h,t.eventForm.coords],[a,"##.####,##.####"]])])):r("",!0),e("div",X5,[e("label",Z5,[f(n,null,{content:v(()=>[ew]),default:v(()=>[x5]),_:1}),m(" Описание события "),tw,t.eventForm.description?(l(),i("small",sw," Длина текста "+u(t.eventForm.description.length)+"/255",1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Описание мероприятия","aria-label":"Описание мероприятия",maxlength:"255","onUpdate:modelValue":o[5]||(o[5]=d=>t.eventForm.description=d),"aria-describedby":"event-description",required:""},`
                    `,512),[[h,t.eventForm.description]])]),e("div",ow,[e("label",lw,[f(n,null,{content:v(()=>[nw]),default:v(()=>[iw]),_:1}),m(" Текст при записи на событие "),aw,t.eventForm.on_start_appointment?(l(),i("small",dw," Длина текста "+u(t.eventForm.on_start_appointment.length)+"/255",1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст при записи на событие","aria-label":"Текст при записи на событие","onUpdate:modelValue":o[6]||(o[6]=d=>t.eventForm.on_start_appointment=d),maxlength:"255","aria-describedby":"event-on_start_appointment",required:""},`
                    `,512),[[h,t.eventForm.on_start_appointment]])]),e("div",rw,[e("label",cw,[f(n,null,{content:v(()=>[mw]),default:v(()=>[uw]),_:1}),m(" Текст при отмене записи на событие "),_w,t.eventForm.on_cancel_appointment?(l(),i("small",hw," Длина текста "+u(t.eventForm.on_cancel_appointment.length)+"/255",1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст при отмене записи на событие","aria-label":"Текст при отмене записи на событие","onUpdate:modelValue":o[7]||(o[7]=d=>t.eventForm.on_cancel_appointment=d),maxlength:"255","aria-describedby":"event-on_cancel_appointment",required:""},`
                    `,512),[[h,t.eventForm.on_cancel_appointment]])]),e("div",pw,[e("label",bw,[f(n,null,{content:v(()=>[gw]),default:v(()=>[fw]),_:1}),m(" Текст после прохождения события "),vw,t.eventForm.on_after_appointment?(l(),i("small",$w," Длина текста "+u(t.eventForm.on_after_appointment.length)+"/255",1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст после прохождения события","aria-label":"Текст после прохождения события","onUpdate:modelValue":o[8]||(o[8]=d=>t.eventForm.on_after_appointment=d),maxlength:"255","aria-describedby":"event-on_after_appointment",required:""},`
                    `,512),[[h,t.eventForm.on_after_appointment]])]),e("div",yw,[e("label",kw,[f(n,null,{content:v(()=>[ww]),default:v(()=>[Fw]),_:1}),m(" Текст при повторной записи на событие "),Cw,t.eventForm.on_repeat_appointment?(l(),i("small",Sw," Длина текста "+u(t.eventForm.on_repeat_appointment.length)+"/255",1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:" Текст при повторной записи на событие","aria-label":" Текст при повторной записи на событие","onUpdate:modelValue":o[9]||(o[9]=d=>t.eventForm.on_repeat_appointment=d),maxlength:"255","aria-describedby":"event-on_repeat_appointment",required:""},`
                    `,512),[[h,t.eventForm.on_repeat_appointment]])]),e("div",jw,[e("div",qw,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[10]||(o[10]=d=>t.need_media=d),type:"checkbox",id:"need_media"},null,512),[[k,t.need_media]]),zw])]),t.need_media?(l(),i("div",Vw,[e("label",Pw,[f(n,null,{content:v(()=>[Uw]),default:v(()=>[Ow]),_:1}),m(" Изображение к событию "),Aw]),f(V,{"need-photo":!0,selected:t.eventForm.images,onSelect:t.selectPhotos},null,8,["selected","onSelect"])])):r("",!0),e("div",Iw,[e("div",Qw,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[11]||(o[11]=d=>t.eventForm.is_group=d),type:"checkbox",id:"is-group"},null,512),[[k,t.eventForm.is_group]]),Tw])]),t.eventForm.is_group?(l(),i("div",Bw,[e("label",Rw,[f(n,{content:"Минимально необходимое число людей, для начала 1 мероприятия"},{default:v(()=>[Mw]),_:1}),m(" Минимальное число посетителей в группе "),Dw]),c(e("input",{type:"number",class:"form-control",placeholder:"Минимальное число посетителей","aria-label":"Название","onUpdate:modelValue":o[12]||(o[12]=d=>t.eventForm.min_people=d),"aria-describedby":"event-min_people",required:""},null,512),[[h,t.eventForm.min_people]])])):r("",!0),t.eventForm.is_group?(l(),i("div",Ew,[e("label",Lw,[f(n,{content:"Количество людей, которые могут посетить мероприятие за 1 сеанс"},{default:v(()=>[Kw]),_:1}),m(" Максимальное число посетителей в группе "),Nw]),c(e("input",{type:"number",class:"form-control",placeholder:"Максимальное число посетителей","aria-label":"Название","onUpdate:modelValue":o[13]||(o[13]=d=>t.eventForm.max_people=d),"aria-describedby":"event-max_people",required:""},null,512),[[h,t.eventForm.max_people]])])):r("",!0)]),e("div",Jw,[e("div",Yw,[e("button",Hw,[t.eventForm.id==null?(l(),i("span",Gw,"Создать событие")):(l(),i("span",Ww,"Обновить событие"))])])])],32)}}}),Zw={class:"row pt-3"},xw={class:"col-md-4"},eC={class:"form-floating mb-3"},tC=e("label",{for:"config-step"},"Шаг, минуты",-1),sC={class:"col-md-4"},oC={class:"form-floating mb-3"},lC=e("label",{for:"config-start-time"},"Начало, часы",-1),iC={class:"col-md-4"},nC={class:"form-floating mb-3"},aC=["min"],dC=e("label",{for:"config-end-time"},"Конец, часы",-1),rC=e("hr",null,null,-1),cC={key:0,class:"row"},uC={class:"col-12 d-flex justify-content-end pb-3"},mC={class:"row"},_C={class:"col-md-4 text-center"},hC={key:0,class:"fa-solid fa-arrow-down-short-wide"},pC={key:1,class:"fa-solid fa-arrow-up-wide-short"},bC={class:"col-md-4 text-center"},fC={key:0,class:"fa-solid fa-arrow-down-short-wide"},gC={key:1,class:"fa-solid fa-arrow-up-wide-short"},vC={class:"col-md-4 text-center"},$C={key:0,class:"fa-solid fa-arrow-down-short-wide"},yC={key:1,class:"fa-solid fa-arrow-up-wide-short"},kC={class:"col-md-4"},FC={class:"form-floating"},wC=["onUpdate:modelValue","id"],CC=["for"],SC={class:"col-md-4"},jC={class:"form-floating"},qC=["onUpdate:modelValue","id"],zC=["for"],VC={class:"col-md-4"},PC={class:"form-floating"},OC=["onUpdate:modelValue","id"],UC=["for"],AC={class:"row mt-3"},IC={class:"col-12"},QC={class:"row"},TC={class:"col-12"},BC={class:"col-12"},RC={class:"text-center"},MC={class:"row d-flex justify-content-center"},DC={class:"col-md-4"},EC={class:"table"},LC=e("th",{scope:"col"},"#",-1),KC={scope:"col"},NC={scope:"row"},JC=["onClick"],YC={key:0,class:"fa-solid fa-check"},HC={key:1,class:"fa-solid fa-xmark"},GC={components:{VueDatePicker:ne},props:["eventId","bot"],data(){return{date:null,load:!1,step:30,start:8,end:18,order:null,direction:null,paginate_object:null,years:[2024,2025],months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","октябрь","Ноябрь","Декабрь"],days:["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],schedule:[],added_schedule:[]}},watch:{date:{handler:function(s){this.loadAppointmentSchedules()},deep:!0}},computed:{...C(["getAppointmentSchedules","getAppointmentSchedulesPaginateObject"]),currentWeek(){return new Date().getWeek()},currentMonthWeek(){return new Date().getMonthWeek()},currentMonth(){return new Date().getMonth()},currentYear(){return new Date().getFullYear()},times(){let s=this.step,t=[],o=0,n=0;for(let a=0;o<24*60;a++){let d=Math.floor(o/60);if(d>=this.start&&d<=this.end){let _=o%60;t[n]=("0"+d).slice(-2)+":"+("0"+_).slice(-2),n++}o=o+s}return t}},mounted(){this.date=new Date,this.loadAppointmentSchedules()},methods:{removeAppointmentSchedule(s){this.loading=!0,this.$store.dispatch("removeAppointmentSchedule",{dataObject:{appointmentScheduleId:s}}).then(t=>{this.loading=!1,this.loadAppointmentSchedules(0),this.$notify("Время успешно удалено")}).catch(()=>{this.loading=!1,this.$notify("Ошибка удаления времени")})},loadAndOrder(s){this.order=s,this.direction=this.direction==="desc"?"asc":"desc",this.loadAppointmentSchedules(0)},nextAppointmentSchedule(s){this.loadAppointmentSchedules(s)},loadAppointmentSchedules(s=0){this.loading=!0,this.$store.dispatch("loadAppointmentSchedules",{dataObject:{date:this.date||null,event_id:this.eventId,bot_id:this.bot.id||null,order:this.order,direction:this.direction},page:s,size:20}).then(t=>{this.loading=!1,this.schedule=this.getAppointmentSchedules,this.paginate_object=this.getAppointmentSchedulesPaginateObject}).catch(()=>{this.loading=!1})},storeSchedule(){this.$store.dispatch("storeAppointmentSchedule",{dataObject:{schedule:[...this.schedule,...this.added_schedule],bot_id:this.bot.id,appointment_event_id:this.eventId}}).then(()=>{this.$notify("Расписание успешно сохранено"),this.loadAppointmentSchedules(),this.added_schedule=[]}).catch(()=>{this.$notify("Ошибка сохраения расписания")})},inScheduleRow(s){return this.schedule.findIndex(t=>t.start_time==this.times[s])!=-1||this.added_schedule.findIndex(t=>t.start_time==this.times[s])!=-1},inSchedule(s,t){return this.schedule.findIndex(o=>o.day==t&&o.start_time==this.times[s])!=-1||this.added_schedule.findIndex(o=>o.day==t&&o.start_time==this.times[s])!=-1},setScheduleItem(s,t){let o=this.schedule.findIndex(n=>n.day==t&&n.start_time==this.times[s]);if(o!==-1){this.schedule.splice(o,1);return}if(o=this.added_schedule.findIndex(n=>n.day==t&&n.start_time==this.times[s]),o!==-1){this.added_schedule.splice(o,1);return}this.added_schedule.push({day:t,start_time:this.times[s]||null,end_time:this.times[s+1]||null,week:this.date==null?this.currentWeek:new Date(this.date).getWeek(),month:this.date==null?this.currentMonth:new Date(this.date).getMonth(),year:this.date==null?this.currentYear:new Date(this.date).getFullYear()})}}},WC=Object.assign(GC,{__name:"AppointmentScheduleForm",setup(s){return(t,o)=>(l(),i(g,null,[e("div",Zw,[e("div",xw,[e("div",eC,[c(e("input",{type:"number",class:"form-control","onUpdate:modelValue":o[0]||(o[0]=n=>t.step=n),min:"0",id:"config-step",placeholder:"30 минут"},null,512),[[h,t.step]]),tC])]),e("div",sC,[e("div",oC,[c(e("input",{type:"number","onUpdate:modelValue":o[1]||(o[1]=n=>t.start=n),min:"0",max:"23",class:"form-control",id:"config-start-time",placeholder:"Часы"},null,512),[[h,t.start]]),lC])]),e("div",iC,[e("div",nC,[c(e("input",{type:"number","onUpdate:modelValue":o[2]||(o[2]=n=>t.end=n),min:t.start,max:"23",class:"form-control",id:"config-end-time",placeholder:"Часы"},null,8,aC),[[h,t.end]]),dC])])]),rC,t.schedule.length>0||t.added_schedule.length>0?(l(),i("div",cC,[e("div",uC,[e("button",{onClick:o[3]||(o[3]=(...n)=>t.storeSchedule&&t.storeSchedule(...n)),class:"btn btn-primary"},"Сохранить текущий график ")]),e("div",mC,[e("div",_C,[e("a",{onClick:o[4]||(o[4]=n=>t.loadAndOrder("day")),href:"javascript:void(0)"},[m("День "),t.order==="day"&&t.direction==="asc"?(l(),i("i",hC)):r("",!0),t.order==="day"&&t.direction==="desc"?(l(),i("i",pC)):r("",!0)])]),e("div",bC,[e("a",{onClick:o[5]||(o[5]=n=>t.loadAndOrder("start_time")),href:"javascript:void(0)"},[m("Начало "),t.order==="start_time"&&t.direction==="asc"?(l(),i("i",fC)):r("",!0),t.order==="start_time"&&t.direction==="desc"?(l(),i("i",gC)):r("",!0)])]),e("div",vC,[e("a",{onClick:o[6]||(o[6]=n=>t.loadAndOrder("end_time")),href:"javascript:void(0)"},[m("Конец "),t.order==="end_time"&&t.direction==="asc"?(l(),i("i",$C)):r("",!0),t.order==="end_time"&&t.direction==="desc"?(l(),i("i",yC)):r("",!0)])])])])):r("",!0),(l(!0),i(g,null,y([...t.schedule,...t.added_schedule],(n,a)=>(l(),i("div",{class:b(["row py-2",{"bg-warning":n.id==null}])},[e("div",kC,[e("div",FC,[c(e("input",{type:"text","onUpdate:modelValue":d=>t.days[n.day-1]=d,class:"form-control",id:"day-of-week-"+a,placeholder:"День недели"},null,8,wC),[[h,t.days[n.day-1]]]),e("label",{for:"day-of-week-"+a},"День недели",8,CC)])]),e("div",SC,[e("div",jC,[c(e("input",{type:"text","onUpdate:modelValue":d=>n.start_time=d,class:"form-control",id:"day-of-start-at-"+a,placeholder:"Время начало"},null,8,qC),[[h,n.start_time]]),e("label",{for:"day-of-start-at-"+a},"Начало",8,zC)])]),e("div",VC,[e("div",PC,[c(e("input",{type:"text","onUpdate:modelValue":d=>n.end_time=d,class:"form-control",id:"day-of-end-at-"+a,placeholder:"Время окончания"},null,8,OC),[[h,n.end_time]]),e("label",{for:"day-of-end-at-"+a},"Окончание",8,UC)])])],2))),256)),e("div",AC,[e("div",IC,[t.paginate_object?(l(),$(j,{key:0,onPagination_page:t.nextAppointmentSchedule,pagination:t.paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])]),e("div",QC,[e("div",TC,[e("button",{class:"btn btn-primary",onClick:o[7]||(o[7]=n=>t.schedule=[])},"Очистить таблицу")]),e("div",BC,[e("p",RC,[m(" Год: "),e("strong",null,u(t.currentYear),1),m(" Месяц: "),e("strong",null,u(t.months[t.currentMonth]),1),m(" Неделя: "),e("strong",null,u(t.currentWeek),1)])])]),e("div",MC,[e("div",DC,[f(M(ne),{modelValue:t.date,"onUpdate:modelValue":o[8]||(o[8]=n=>t.date=n)},null,8,["modelValue"])])]),e("table",EC,[e("thead",null,[e("tr",null,[LC,(l(!0),i(g,null,y(t.days,n=>(l(),i("th",KC,u(n),1))),256))])]),e("tbody",null,[(l(!0),i(g,null,y(t.times,(n,a)=>(l(),i("tr",{class:b({"table-light":t.inScheduleRow(a)})},[e("th",NC,u(n),1),(l(),i(g,null,y(7,d=>e("td",null,[e("button",{class:b([{"btn-primary text-white":t.inSchedule(a,d)},"btn btn-outline-primary"]),onClick:_=>t.setScheduleItem(a,d)},[t.inSchedule(a,d)?(l(),i("i",YC)):(l(),i("i",HC))],10,JC)])),64))],2))),256))])])],64))}});(function(){try{if(typeof document<"u"){var s=document.createElement("style");s.appendChild(document.createTextNode(".vue3-star-ratings[data-v-7fab3f62]{width:fit-content;overflow:hidden;position:relative;white-space:nowrap}.vue3-star-ratings *[data-v-7fab3f62]{box-sizing:border-box;margin:0;padding:0;line-height:1}.vue3-star-ratings__inner[data-v-7fab3f62],.vue3-star-ratings__outer[data-v-7fab3f62]{height:inherit}.vue3-star-ratings__outer[data-v-7fab3f62]{position:absolute;top:0;left:0;width:var(--vue3StarRatingOuterWidth);max-width:100%;overflow:hidden;color:var(--vue3StarRatingsOuterColor);transition:width .32s cubic-bezier(.075,.82,.165,1)}.vue3-star-ratings__inner[data-v-7fab3f62]{color:var(--vue3StarRatingsInnerColor)}.vue3-star-ratings__icon[data-v-7fab3f62]{fill:currentColor;width:var(--vue3StarRatingIconSize);aspect-ratio:1;cursor:pointer;display:inline-block}")),document.head.appendChild(s)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}})();const ce=(s,t)=>{const o=s.__vccOpts||s;for(const[n,a]of t)o[n]=a;return o},XC={},ZC={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512.002 512.002"},xC=e("path",{d:"M511.267 197.258a14.995 14.995 0 00-12.107-10.209l-158.723-23.065-70.985-143.827a14.998 14.998 0 00-26.901 0l-70.988 143.827-158.72 23.065a14.998 14.998 0 00-8.312 25.585l114.848 111.954-27.108 158.083a14.999 14.999 0 0021.763 15.812l141.967-74.638 141.961 74.637a15 15 0 0021.766-15.813l-27.117-158.081 114.861-111.955a14.994 14.994 0 003.795-15.375z"},null,-1),e4=[xC];function t4(s,t){return l(),i("svg",ZC,e4)}const Z=ce(XC,[["render",t4]]),s4={class:"vue3-star-ratings__outer"},o4={class:"vue3-star-ratings__inner"},l4=fe({__name:"Vue3StarRatings",props:{modelValue:{default:0},numberOfStars:{default:5},starColor:{default:"#ff9800"},inactiveColor:{default:"#333333"},starSize:{default:24},disableClick:{type:Boolean},customSvg:{default:Z}},emits:["update:modelValue"],setup(s,{emit:t}){const o=s,n=K(()=>o.customSvg||Z),a={rounded(w,U){const P=Math.pow(10,U);return Math.round(w*P)/P}},d=ge(),_=K({get(){return o.modelValue},set(w){const U=a.rounded(w,1);t("update:modelValue",U)}});function p(w){if(o.disableClick)return;const U=this.getBoundingClientRect(),{pageX:P}=w,L=P-U.left,ue=U.width,me=o.numberOfStars,_e=L/ue*me;_.value=_e}const F=K(()=>(_.value<0?0:_.value>o.numberOfStars?o.numberOfStars:_.value)/o.numberOfStars*100);return ve(()=>{var w;const U={"--vue3StarRatingsInnerColor":o.inactiveColor,"--vue3StarRatingsOuterColor":o.starColor,"--vue3StarRatingOuterWidth":`${F.value}%`,"--vue3StarRatingIconSize":`${o.starSize}px`};for(const[P,L]of Object.entries(U))(w=d.value)==null||w.style.setProperty(P,L)}),$e(()=>{var w;(w=d.value)==null||w.addEventListener("click",p)}),ye(()=>{var w;(w=d.value)==null||w.removeEventListener("click",p)}),(w,U)=>(l(),i("div",{class:"vue3-star-ratings",ref_key:"starsContainer",ref:d,style:ee({pointerEvents:w.disableClick?"none":"auto"})},[e("div",s4,[(l(!0),i(g,null,y(w.numberOfStars,P=>(l(),$(H(n.value),{key:P,class:"vue3-star-ratings__icon"}))),128))]),e("div",o4,[(l(!0),i(g,null,y(w.numberOfStars,P=>(l(),$(H(n.value),{key:P,class:"vue3-star-ratings__icon"}))),128))])],4))}}),E=ce(l4,[["__scopeId","data-v-7fab3f62"]]),i4={class:"row py-3"},n4={class:"col-12"},a4={class:"row"},d4={class:"col-12"},r4={key:0},c4={key:1},u4={key:0,class:"col-12 mb-3"},m4={class:"col-12 mb-3"},_4={key:0},h4={key:1},p4={key:1,class:"col-12 mb-3"},b4={class:"col-12 mb-3"},f4={class:"col-12 mb-3"},g4={class:"form-label",id:"event-on_after_appointment"},v4=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),$4=e("div",null," Текст, который пользователь оставляет после прохождения услуги ",-1),y4=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),k4={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},F4={class:"row"},w4={class:"col-12"},C4={type:"submit",class:"btn btn-outline-success w-100 p-3"},S4={key:0},j4={key:1},q4={props:["eventId","bot","review"],components:{vue3starRatings:E},data(){return{step:0,load:!1,selected_schedule_time:null,selected_bot_user:null,need_load_users:!1,need_schedule_time:!1,days:["понедельник","вторник","среду","четверг","пятницу","субботу","воскресенье"],reviewForm:{id:null,appointment_event_id:null,appointment_schedule_id:null,bot_user_id:null,rating:null,text:null}}},watch:{reviewForm:{handler(s){this.need_reset=!0},deep:!0}},mounted(){this.review&&this.$nextTick(()=>{this.reviewForm={id:this.review.id||null,appointment_event_id:this.review.appointment_event_id||null,appointment_schedule_id:this.review.appointment_schedule_id||null,bot_user_id:this.review.bot_user_id||null,rating:this.review.rating||null,text:this.review.text||null},this.selected_schedule_time=this.review.schedule||null,this.selected_bot_user=this.review.botUser||null})},methods:{selectScheduleTime(s){this.selected_schedule_time=s,this.need_schedule_time=!1},selectBotUser(s){this.selected_bot_user=s,this.need_load_users=!1},clearReviewForm(){this.reviewForm={id:null,appointment_event_id:null,appointment_schedule_id:null,bot_user_id:null,rating:null,text:null},this.selected_schedule_time=null,this.selected_bot_user=null},submitForm(){this.reviewForm.bot_user_id=this.selected_bot_user.id,this.reviewForm.appointment_schedule_id=this.selected_schedule_time.id,this.reviewForm.appointment_event_id=this.eventId;let s=new FormData;Object.keys(this.reviewForm).forEach(t=>{const o=this.reviewForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),s.append("bot_id",this.bot.id),this.$store.dispatch("storeAppointmentReview",{dataObject:{appointmentReviewForm:s}}).then(t=>{this.$emit("callback",t.data),this.$notify("Отзыв успешно создан"),this.clearReviewForm()}).catch(t=>{this.$notify("Ошибка создания отзыва")})}}},z4=Object.assign(q4,{__name:"AppointmentReviewForm",setup(s){return(t,o)=>{const n=q("Popper");return l(),i(g,null,[e("div",i4,[e("div",n4,[e("button",{onClick:o[0]||(o[0]=(...a)=>t.clearReviewForm&&t.clearReviewForm(...a)),class:"btn btn-primary"},"Новый отзыв")])]),e("form",{onSubmit:o[5]||(o[5]=S((...a)=>t.submitForm&&t.submitForm(...a),["prevent"]))},[e("div",a4,[e("div",d4,[e("a",{href:"javascript:void(0)",class:"btn btn-link",onClick:o[1]||(o[1]=a=>t.need_load_users=!t.need_load_users)},[t.selected_bot_user==null?(l(),i("span",r4,"Выберите пользователя")):r("",!0),t.selected_bot_user?(l(),i("span",c4," Пользователь "+u(t.selected_bot_user.name||t.selected_bot_user.fio_from_telegram||t.selected_bot_user.telegram_chat_id||"-"),1)):r("",!0)])]),t.need_load_users?(l(),i("div",u4,[f(D,{simple:!0,onSelect:t.selectBotUser},null,8,["onSelect"])])):r("",!0),e("div",m4,[e("a",{href:"javascript:void(0)",class:"btn btn-link",onClick:o[2]||(o[2]=a=>t.need_schedule_time=!t.need_schedule_time)},[t.selected_schedule_time==null?(l(),i("span",_4,"Выберите время в расписании")):r("",!0),t.selected_schedule_time?(l(),i("span",h4," Запись на "+u(t.days[t.selected_schedule_time.day-1]||"-")+" с "+u(t.selected_schedule_time.start_time||"-")+" до "+u(t.selected_schedule_time.end_time||"-"),1)):r("",!0)])]),t.need_schedule_time?(l(),i("div",p4,[f(ie,{"event-id":s.eventId,bot:s.bot,onSelect:t.selectScheduleTime},null,8,["event-id","bot","onSelect"])])):r("",!0),e("div",b4,[e("p",null," Рейтинг: "+u(t.reviewForm.rating||0),1),f(M(E),{modelValue:t.reviewForm.rating,"onUpdate:modelValue":o[3]||(o[3]=a=>t.reviewForm.rating=a)},null,8,["modelValue"])]),e("div",f4,[e("label",g4,[f(n,null,{content:v(()=>[$4]),default:v(()=>[v4]),_:1}),m(" Текст отзыва "),y4,t.reviewForm.text?(l(),i("small",k4," Длина текста "+u(t.reviewForm.text.length)+"/255",1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст отзыва","aria-label":"Текст отзыва","onUpdate:modelValue":o[4]||(o[4]=a=>t.reviewForm.text=a),maxlength:"255","aria-describedby":"review-text",required:""},`
                    `,512),[[h,t.reviewForm.text]])])]),e("div",F4,[e("div",w4,[e("button",C4,[t.reviewForm.id==null?(l(),i("span",S4,"Оставить отзыв")):(l(),i("span",j4,"Обновить отзыв"))])])])],32)],64)}}}),V4={class:"row"},P4={class:"col-12"},O4={key:0,class:"table"},U4=e("th",{scope:"col"},"Действие",-1),A4=["onClick"],I4={scope:"row"},Q4={class:"d-flex align-items-center"},T4={class:"ml-2"},B4={key:0,class:"dropdown"},R4=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),M4={class:"dropdown-menu"},D4={key:0},E4=["onClick"],L4={key:1},K4={class:"col-12"},N4={props:["bot","eventId"],components:{vue3starRatings:E},data(){return{direction:"desc",order:"updated_at",show:!0,is_group:!1,loading:!0,reviews:[],search:null,paginate_object:null}},computed:{...C(["getAppointmentReviews","getAppointmentReviewsPaginateObject"])},mounted(){this.loadAppointmentReviews()},methods:{nextAppointmentReviews(s){this.loadAppointmentReviews(s)},selectReview(s){this.$emit("select",s)},loadAndOrder(s){this.order=s,this.direction=this.direction==="desc"?"asc":"desc",this.loadAppointmentReviews(0)},removeAppointmentReview(s){this.loading=!0,this.$store.dispatch("removeAppointmentReview",{dataObject:{appointmentReviewId:s}}).then(t=>{this.loadAppointmentReviews(0),this.$notify("Сервис успешно удален"),this.loading=!1}).catch(()=>{this.loading=!1,this.$notify("Ошибка удаления сервиса")})},loadAppointmentReviews(s=0){this.loading=!0,this.$store.dispatch("loadAppointmentReviews",{dataObject:{event_id:this.eventId,bot_id:this.bot.id||null,search:this.search,order:this.order,direction:this.direction},page:s,size:100}).then(t=>{this.loading=!1,this.reviews=this.getAppointmentReviews,this.paginate_object=this.getAppointmentReviewsPaginateObject}).catch(()=>{this.loading=!1})}}},J4=Object.assign(N4,{__name:"AppointmentReviewsTable",setup(s){return(t,o)=>(l(),i("div",V4,[e("div",P4,[t.reviews.length>0?(l(),i("table",O4,[e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"cursor-pointer",onClick:o[0]||(o[0]=n=>t.loadAndOrder("id"))},"#"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[1]||(o[1]=n=>t.loadAndOrder("bot_user_id"))},"Пользователь"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[2]||(o[2]=n=>t.loadAndOrder("rating"))},"Рейтинг"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[3]||(o[3]=n=>t.loadAndOrder("text"))},"Текст"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[4]||(o[4]=n=>t.loadAndOrder("updated_at"))},"Дата изменения"),U4])]),e("tbody",null,[(l(!0),i(g,null,y(t.reviews,(n,a)=>(l(),i("tr",{onClick:d=>t.selectReview(n),class:b({"border-info":n.deleted_at==null,"border-danger":n.deleted_at!=null})},[e("th",I4,u(n.id),1),e("td",null,u(n.botUser.fio_from_telegram||n.botUser.telegram_chat_id||"Не указано"),1),e("td",null,[e("p",Q4,[f(M(E),{disableClick:!0,modelValue:n.rating,"onUpdate:modelValue":d=>n.rating=d},null,8,["modelValue","onUpdate:modelValue"]),e("span",T4,u(n.rating||0),1)])]),e("td",null,u(n.text||"Не указано"),1),e("td",null,u(t.$filters.current(n.updated_at)),1),e("td",null,[n.id?(l(),i("div",B4,[R4,e("ul",M4,[n.deleted_at==null?(l(),i("li",D4,[e("a",{class:"dropdown-item",onClick:d=>t.removeAppointmentReview(n.id),href:"javascript:void(0)"},"Удалить",8,E4)])):r("",!0)])])):r("",!0)])],10,A4))),256))])])):(l(),i("p",L4,"На текущий момент нет ни одного созданного отзыва"))]),e("div",K4,[t.paginate_object?(l(),$(j,{key:0,onPagination_page:t.nextAppointmentReviews,pagination:t.paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])]))}}),Y4={key:0,class:"py-2"},H4={class:"row"},G4={class:"col-12"},W4={key:1,class:"py-2"},X4={class:"row"},Z4={class:"col-12"},x4={key:2,class:"py-2"},e8={class:"row"},t8={class:"col-12"},s8={class:"nav nav-tabs justify-content-center"},o8={key:0,class:"row py-3"},l8={class:"col-12"},i8={key:1,class:"row py-3"},n8={class:"col-12"},a8={class:"col-12 py-3"},d8=e("h4",null,"Доступные сервисы в событии",-1),r8={key:2,class:"row"},c8={class:"col-12"},u8={key:3,class:"row"},m8={class:"col-12"},_8={class:"col-12 py-3"},h8=e("h4",null,"Актуальные записи на событие",-1),p8={key:4,class:"row"},b8={class:"col-12"},f8={class:"col-12 py-3"},g8=e("h4",null,"Отзывы к событию",-1),v8={props:["bot"],data(){return{part:0,tab:0,loadTable:!1,loadService:!1,loadReviewForm:!1,loadAppointments:!1,loadReviews:!1,loadAppointmentForm:!1,loadForm:!1,selectedEvent:null,selectedService:null,selectedAppointment:null,selectedReview:null}},computed:{...C(["getAppointmentEvents","getAppointmentEventsPaginateObject"])},mounted(){},methods:{callbackForm(){this.loadTable=!0,this.$nextTick(()=>{this.loadTable=!1})},callbackAppointment(){this.loadAppointments=!0,this.$nextTick(()=>{this.loadAppointments=!1})},callbackReview(){this.loadReviews=!0,this.$nextTick(()=>{this.loadReviews=!1})},createEvent(){this.part=2},selectAppointment(s){this.loadAppointmentForm=!0,this.selectedAppointment=s,this.$nextTick(()=>{this.loadAppointmentForm=!1})},selectService(s){this.loadService=!0,this.selectedService=s,this.$nextTick(()=>{this.loadService=!1})},selectReview(s){this.loadReviewForm=!0,this.selectedReview=s,this.$nextTick(()=>{this.loadReviewForm=!1})},selectEvent(s){this.loadForm=!0,this.$nextTick(()=>{this.loadForm=!1,this.selectedEvent=s,this.part=1,this.tab=0})}}},$8=Object.assign(v8,{__name:"Appointment",setup(s){return(t,o)=>(l(),i(g,null,[t.part===0?(l(),i("div",Y4,[e("div",H4,[e("div",G4,[e("button",{type:"button",onClick:o[0]||(o[0]=(...n)=>t.createEvent&&t.createEvent(...n)),class:"btn btn-primary"}," Создать новое событие ")])]),t.loadTable?r("",!0):(l(),$(m5,{key:0,onSelect:t.selectEvent,bot:s.bot},null,8,["onSelect","bot"]))])):r("",!0),t.part===2?(l(),i("div",W4,[e("div",X4,[e("div",Z4,[e("button",{type:"button",onClick:o[1]||(o[1]=n=>t.part=0),class:"btn btn-outline-primary"}," Назад ")])]),t.loadForm?r("",!0):(l(),$(X,{key:0,onCallback:t.callbackForm,bot:s.bot},null,8,["onCallback","bot"]))])):r("",!0),t.part===1?(l(),i("div",x4,[e("div",e8,[e("div",t8,[e("button",{type:"button",onClick:o[2]||(o[2]=n=>t.part=0),class:"btn btn-outline-primary"}," Назад ")])]),e("ul",s8,[e("li",{class:"nav-item",onClick:o[3]||(o[3]=n=>t.tab=0)},[e("a",{class:b(["nav-link",{active:t.tab===0}]),"aria-current":"page",href:"javascript:void(0)"},"Информация о событии",2)]),e("li",{class:"nav-item",onClick:o[4]||(o[4]=n=>t.tab=1)},[e("a",{class:b(["nav-link",{active:t.tab===1}]),href:"javascript:void(0)"},"Сервисы в событии",2)]),e("li",{class:"nav-item",onClick:o[5]||(o[5]=n=>t.tab=2)},[e("a",{class:b(["nav-link",{active:t.tab===2}]),href:"javascript:void(0)"},"График",2)]),e("li",{class:"nav-item",onClick:o[6]||(o[6]=n=>t.tab=3)},[e("a",{class:b(["nav-link",{active:t.tab===3}]),href:"javascript:void(0)"},"Записи на событие",2)]),e("li",{class:"nav-item",onClick:o[7]||(o[7]=n=>t.tab=4)},[e("a",{class:b(["nav-link",{active:t.tab===4}]),href:"javascript:void(0)"},"Отзывы о событии",2)])]),t.tab===0?(l(),i("div",o8,[e("div",l8,[t.loadForm?r("",!0):(l(),$(X,{key:0,onCallback:t.callbackForm,event:t.selectedEvent,bot:s.bot},null,8,["onCallback","event","bot"]))])])):r("",!0),t.tab===1?(l(),i("div",i8,[e("div",n8,[t.loadService?r("",!0):(l(),$(pt,{key:0,service:t.selectedService,"event-id":t.selectedEvent.id,bot:s.bot},null,8,["service","event-id","bot"]))]),e("div",a8,[d8,f(z5,{"event-id":t.selectedEvent.id,onSelect:t.selectService,bot:s.bot},null,8,["event-id","onSelect","bot"])])])):r("",!0),t.tab===2?(l(),i("div",r8,[e("div",c8,[f(WC,{"event-id":t.selectedEvent.id,bot:s.bot},null,8,["event-id","bot"])])])):r("",!0),t.tab===3?(l(),i("div",u8,[e("div",m8,[t.loadAppointmentForm?r("",!0):(l(),$(zF,{key:0,bot:s.bot,onCallback:t.callbackAppointment,"event-id":t.selectedEvent.id,appointment:t.selectedAppointment},null,8,["bot","onCallback","event-id","appointment"]))]),e("div",_8,[h8,t.loadAppointments?r("",!0):(l(),$(NF,{key:0,"event-id":t.selectedEvent.id,onSelect:t.selectAppointment,bot:s.bot},null,8,["event-id","onSelect","bot"]))])])):r("",!0),t.tab===4?(l(),i("div",p8,[e("div",b8,[t.loadReviewForm?r("",!0):(l(),$(z4,{key:0,review:t.selectedReview,bot:s.bot,onCallback:o[8]||(o[8]=n=>t.callbackReview()),"event-id":t.selectedEvent.id},null,8,["review","bot","event-id"]))]),e("div",f8,[g8,t.loadReviews?r("",!0):(l(),$(J4,{key:0,bot:s.bot,onSelect:t.selectReview,"event-id":t.selectedEvent.id},null,8,["bot","onSelect","event-id"]))])])):r("",!0)])):r("",!0)],64))}}),y8={props:["param"],data(){return{htmlInjections:[{title:"Кнопка синяя",value:"<a href='http://test.com/test' class='w-100 btn btn-primary'>Текст кнопки</a>"},{title:"Кнопка без цвета",value:"<a href='http://test.com/test' class='w-100 btn btn-link'>Текст кнопки</a>"},{title:"Кнопка с синей обводкой",value:"<a href='http://test.com/test' class='w-100 btn btn-outline-primary'>Текст кнопки</a>"}]}},mounted(){},methods:{attachTo(s){this.$emit("callback",{param:this.param||null,value:s})}}},k8={class:"dropdown"},F8=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," Кнопки ",-1),w8={class:"dropdown-menu"},C8=["onClick"],S8={class:"dropdown-item",href:"javascript:void(0)"};function j8(s,t,o,n,a,d){return l(),i("div",k8,[F8,e("ul",w8,[(l(!0),i(g,null,y(a.htmlInjections,_=>(l(),i("li",{onClick:p=>d.attachTo(_.value)},[e("a",S8,u(_.title||"Не указано"),1)],8,C8))),256))])])}const R=O(y8,[["render",j8]]),q8={class:"row"},z8={class:"col-12 mb-3"},V8={class:"form-label",id:"quiz-title"},P8=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),O8=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),U8={class:"col-12 mb-3"},A8={class:"form-check"},I8=e("label",{class:"form-check-label",for:"need_media"}," Нужен медиа-контент ",-1),Q8={key:0,class:"col-12 mb-3"},T8={class:"form-label",id:"quiz-images"},B8=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),R8=e("div",null," Изображение, которое видит пользователь при выборе квиза ",-1),M8=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),D8={class:"col-12 mb-3"},E8={class:"form-label",id:"quiz-description"},L8=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),K8=e("div",null," Краткая информация о квизе ",-1),N8=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),J8={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},Y8={class:"col-12 mb-3"},H8={class:"form-check"},G8=e("label",{class:"form-check-label",for:"polling_mode"}," Квиз в режиме опроса (без команд и таймеров) ",-1),W8={key:1,class:"col-12 mb-3"},X8={class:"form-label",id:"quiz-time_limit"},Z8=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),x8=e("div",null," Время на ответ ",-1),e6=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),t6={class:"col-12 mb-3"},s6={class:"form-check"},o6=e("label",{class:"form-check-label",for:"is-group"}," Показывать ответы по окончанию раунда ",-1),l6={class:"col-12 mb-3"},i6={class:"form-check"},n6=e("label",{class:"form-check-label",for:"is_active"}," Квиз виден пользователям ",-1),a6={key:2,class:"col-12 mb-3"},d6={class:"form-check"},r6=e("label",{class:"form-check-label",for:"round_mode"}," Использовать систему раундов ",-1),c6={class:"col-12 mb-3"},u6={class:"form-label",id:"quiz-time_limit"},m6=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),_6=e("div",null," Число попыток прохождения квиза ",-1),h6=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),p6={class:"col-12 mb-3"},b6={class:"form-label",id:"quiz-time_limit"},f6=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),g6=e("div",null," Сколько % нужно ответить чтоб пройти ",-1),v6=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),$6={class:"row"},y6={class:"col-12 py-2"},k6={class:"col-12 mb-3"},F6={class:"row"},w6={class:"col-10"},C6={class:"d-flex justify-content-between"},S6={class:"form-label",id:"quiz-success_message"},j6=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),q6=e("div",null," Текст в случае успешного прохождения квиза ",-1),z6=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),V6={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},P6=["onUpdate:modelValue"],O6={class:"col-2 d-flex align-items-center justify-content-center"},U6=["disabled","onClick"],A6={class:"row"},I6={class:"col-12 mb-2"},Q6={class:"form-check"},T6=e("label",{class:"form-check-label",for:"need_inline_menu_on_success"}," Меню под текстом страницы при выигрыше ",-1),B6={key:0,class:"col-12 mb-2"},R6={class:"card"},M6={class:"card-header d-flex justify-between align-items-center"},D6=e("h6",null,"Конструктор меню в сообщении",-1),E6={key:0},L6={key:1},K6={class:"card-body"},N6={class:"row"},J6={class:"col-12 py-2"},Y6={class:"col-12 mb-3"},H6={class:"row"},G6={class:"col-10"},W6={class:"d-flex justify-content-between"},X6=["id"],Z6=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),x6=e("div",null," Текст в случае неудачного прохождения квиза ",-1),e7=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),t7={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},s7=["onUpdate:modelValue"],o7={class:"col-2 d-flex align-items-center justify-content-center"},l7=["disabled","onClick"],i7={class:"row"},n7={class:"col-12 mb-2"},a7={class:"form-check"},d7=e("label",{class:"form-check-label",for:"need_template_selector_on_failure"}," Меню под текстом страницы при проигрыше ",-1),r7={key:0,class:"col-12 mb-2"},c7={class:"card"},u7={class:"card-header d-flex justify-between align-items-center"},m7=e("h6",null,"Конструктор меню в сообщении",-1),_7={key:0},h7={key:1},p7={class:"card-body"},b7={class:"row"},f7={class:"col-12 mb-3"},g7={class:"form-floating"},v7=["value","selected"],$7=e("label",{for:"quiz-display-type"},"Тип вывода вопросов",-1),y7={class:"row"},k7={class:"col-12"},F7={type:"submit",class:"btn btn-outline-success w-100 p-3"},w7={key:0},C7={key:1},S7={props:["quiz","bot"],data(){return{step:0,load:!1,need_reset:!1,need_services:!1,need_media:!1,need_inline_menu_on_success:!1,need_template_selector_on_success:!1,need_template_selector_on_failure:!1,need_inline_menu_on_failure:!1,types:["По порядку","Перемешать всё","Перемешать ответы","Перемешать вопросы"],quizForm:{id:null,title:null,image:null,description:null,completed_at:null,start_at:null,end_at:null,display_type:0,time_limit:30,show_answers:!1,polling_mode:!1,round_mode:!0,is_active:!1,try_count:1,success_percent:50,success_message:["Задание успешно пройдено!"],failure_message:["К сожалению вы не прошли задание!"],success_inline_keyboard_id:null,success_inline_keyboard:null,failure_inline_keyboard_id:null,failure_inline_keyboard:null}}},watch:{quizForm:{handler(s){this.need_reset=!0},deep:!0},"quizForm.polling_mode":{handler(s){this.quizForm.round_mode=!1},deep:!0}},mounted(){this.quiz&&this.$nextTick(()=>{this.quizForm={id:this.quiz.id||null,title:this.quiz.title||null,image:this.quiz.image||null,description:this.quiz.description||null,completed_at:this.quiz.completed_at?this.$filters.currentFull(this.quiz.completed_at):null,start_at:this.quiz.start_at?this.$filters.currentFull(this.quiz.start_at):null,end_at:this.quiz.end_at?this.$filters.currentFull(this.quiz.end_at):null,display_type:this.quiz.display_type||0,time_limit:this.quiz.time_limit||30,show_answers:this.quiz.show_answers||!1,polling_mode:this.quiz.polling_mode||!1,round_mode:this.quiz.round_mode||!1,is_active:this.quiz.is_active||!1,try_count:this.quiz.try_count||1,success_inline_keyboard_id:this.quiz.success_inline_keyboard_id||null,success_inline_keyboard:this.quiz.success_inline_keyboard||null,failure_inline_keyboard_id:this.quiz.failure_inline_keyboard_id||null,failure_inline_keyboard:this.quiz.failure_inline_keyboard||null,success_percent:this.quiz.success_percent||50,success_message:this.quiz.success_message||["Задание успешно пройдено!"],failure_message:this.quiz.failure_message||["К сожалению вы не прошли задание!"]},this.quizForm.success_inline_keyboard&&(this.need_inline_menu_on_success=!0),this.quizForm.failure_inline_keyboard&&(this.need_inline_menu_on_failure=!0)})},methods:{saveInlineKeyboardOnSuccess(s){this.quizForm.success_inline_keyboard=s},saveInlineKeyboardOnFailure(s){this.quizForm.failure_inline_keyboard=s},selectInlineKeyboardOnSuccess(s){this.quizForm.success_inline_keyboard=s,this.need_template_selector_on_success=!1},selectInlineKeyboardOnFailure(s){this.quizForm.failure_inline_keyboard=s,this.need_template_selector_on_failure=!1},attachTo(s,t){this.quizForm[s.param][t]==null?this.quizForm[s.param][t]=s.value:this.quizForm[s.param][t]+=s.value},selectPhoto(s){this.quizForm.image=s.file_id},removeMessage(s,t){this.quizForm[s||"success_message"].splice(t,1)},addMessage(s,t){this.quizForm[s||"success_message"].push(t)},submitForm(){let s=new FormData;Object.keys(this.quizForm).forEach(t=>{const o=this.quizForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),s.append("bot_id",this.bot.id),this.$store.dispatch("storeQuiz",{quizForm:s}).then(t=>{this.quizForm={id:null,title:null,image:null,description:null,completed_at:null,start_at:null,end_at:null,display_type:0,time_limit:30,show_answers:!1,polling_mode:!1,round_mode:!1,is_active:!1,try_count:1,success_percent:50,success_inline_keyboard_id:null,success_inline_keyboard:null,failure_inline_keyboard_id:null,failure_inline_keyboard:null,success_message:["Задание успешно пройдено!"],failure_message:["К сожалению вы не прошли задание!"]},this.$emit("callback",t.data),this.$notify("Событие успешно создано")}).catch(t=>{this.$notify("Ошибка создания события")})}}},x=Object.assign(S7,{__name:"QuizForm",setup(s){return(t,o)=>{const n=q("Popper");return l(),i("form",{onSubmit:o[17]||(o[17]=S((...a)=>t.submitForm&&t.submitForm(...a),["prevent"])),class:"py-3"},[e("div",q8,[e("div",z8,[e("label",V8,[f(n,{content:"Название вашего квиза"},{default:v(()=>[P8]),_:1}),m(" Название квиза "),O8]),c(e("input",{type:"text",class:"form-control",placeholder:"Название","aria-label":"Название","onUpdate:modelValue":o[0]||(o[0]=a=>t.quizForm.title=a),maxlength:"255","aria-describedby":"quiz-title",required:""},null,512),[[h,t.quizForm.title]])]),e("div",U8,[e("div",A8,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[1]||(o[1]=a=>t.need_media=a),type:"checkbox",id:"need_media"},null,512),[[k,t.need_media]]),I8])]),t.need_media?(l(),i("div",Q8,[e("label",T8,[f(n,null,{content:v(()=>[R8]),default:v(()=>[B8]),_:1}),m(" Изображение к квизу "),M8]),f(V,{"need-photo":!0,selected:t.quizForm.image,onSelect:t.selectPhoto},null,8,["selected","onSelect"])])):r("",!0),e("div",D8,[e("label",E8,[f(n,null,{content:v(()=>[K8]),default:v(()=>[L8]),_:1}),m(" Описание события "),N8,t.quizForm.description?(l(),i("small",J8," Длина текста "+u(t.quizForm.description.length)+"/255",1)):r("",!0)]),c(e("textarea",{class:"form-control",placeholder:"Описание мероприятия","aria-label":"Описание мероприятия",maxlength:"255","onUpdate:modelValue":o[2]||(o[2]=a=>t.quizForm.description=a),"aria-describedby":"quiz-description",required:""},`
                    `,512),[[h,t.quizForm.description]])]),e("div",Y8,[e("div",H8,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[3]||(o[3]=a=>t.quizForm.polling_mode=a),type:"checkbox",id:"polling_mode"},null,512),[[k,t.quizForm.polling_mode]]),G8])]),t.quizForm.polling_mode?r("",!0):(l(),i("div",W8,[e("label",X8,[f(n,null,{content:v(()=>[x8]),default:v(()=>[Z8]),_:1}),m(" Лимит времени на ответ в секундах "),e6]),c(e("input",{type:"number",class:"form-control",placeholder:"Лимит времени на ответ","aria-label":"Лимит времени на ответ",step:"0.1",min:"0","onUpdate:modelValue":o[4]||(o[4]=a=>t.quizForm.time_limit=a),"aria-describedby":"quiz-time_limit",required:""},null,512),[[h,t.quizForm.time_limit]])])),e("div",t6,[e("div",s6,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[5]||(o[5]=a=>t.quizForm.show_answers=a),type:"checkbox",id:"is-group"},null,512),[[k,t.quizForm.show_answers]]),o6])]),e("div",l6,[e("div",i6,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[6]||(o[6]=a=>t.quizForm.is_active=a),type:"checkbox",id:"is_active"},null,512),[[k,t.quizForm.is_active]]),n6])]),t.quizForm.polling_mode?r("",!0):(l(),i("div",a6,[e("div",d6,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[7]||(o[7]=a=>t.quizForm.round_mode=a),type:"checkbox",id:"round_mode"},null,512),[[k,t.quizForm.round_mode]]),r6])])),e("div",c6,[e("label",u6,[f(n,null,{content:v(()=>[_6]),default:v(()=>[m6]),_:1}),m(" Количество попыток "),h6]),c(e("input",{type:"number",class:"form-control",placeholder:"Число попыток","aria-label":"Число попыток",step:"1",min:"1","onUpdate:modelValue":o[8]||(o[8]=a=>t.quizForm.try_count=a),"aria-describedby":"quiz-try_count",required:""},null,512),[[h,t.quizForm.try_count]])]),e("div",p6,[e("label",b6,[f(n,null,{content:v(()=>[g6]),default:v(()=>[f6]),_:1}),m(" % для прохождения "),v6]),c(e("input",{type:"number",class:"form-control",placeholder:"Процент для победы","aria-label":"Процент для победы",step:"1",min:"0","onUpdate:modelValue":o[9]||(o[9]=a=>t.quizForm.success_percent=a),"aria-describedby":"quiz-success_percent",required:""},null,512),[[h,t.quizForm.success_percent]])])]),e("div",$6,[e("div",y6,[e("button",{class:"btn btn-outline-info rounded-5",type:"button",onClick:o[10]||(o[10]=a=>t.addMessage("success_message",null))},"Добавить еще вариант текста ")]),(l(!0),i(g,null,y(t.quizForm.success_message,(a,d)=>(l(),i("div",k6,[e("div",F6,[e("div",w6,[e("div",C6,[e("label",S6,[f(n,null,{content:v(()=>[q6]),default:v(()=>[j6]),_:1}),m(" Текст при победе "),z6,t.quizForm.success_message[d]?(l(),i("small",V6," Длина текста "+u(t.quizForm.success_message[d].length)+"/255",1)):r("",!0)]),f(R,{param:"success_message",onCallback:_=>t.attachTo(_,d)},null,8,["onCallback"])]),c(e("textarea",{class:"form-control",placeholder:"Текст при победе","aria-label":"Текст при победе",maxlength:"255","onUpdate:modelValue":_=>t.quizForm.success_message[d]=_,"aria-describedby":"quiz-success_message",required:""},`
                    `,8,P6),[[h,t.quizForm.success_message[d]]])]),e("div",O6,[e("button",{class:"btn btn-outline-danger",disabled:t.quizForm.success_message.length<=1,onClick:_=>t.removeMessage("success_message",d)},"Удалить ",8,U6)])])]))),256))]),e("div",A6,[e("div",I6,[e("div",Q6,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[11]||(o[11]=a=>t.need_inline_menu_on_success=a),type:"checkbox",id:"need_inline_menu_on_success"},null,512),[[k,t.need_inline_menu_on_success]]),T6])]),t.need_inline_menu_on_success?(l(),i("div",B6,[e("div",R6,[e("div",M6,[D6,e("button",{class:b(["btn",{"btn-outline-primary":!t.need_template_selector_on_success,"btn-primary":t.need_template_selector_on_success}]),type:"button",onClick:o[12]||(o[12]=a=>t.need_template_selector_on_success=!t.need_template_selector_on_success)},[t.need_template_selector_on_success?(l(),i("span",L6," Скрыть шаблоны меню")):(l(),i("span",E6," Открыть шаблоны меню"))],2)]),e("div",K6,[t.need_template_selector_on_success?(l(),$(T,{key:0,class:"mb-2",type:"inline",onSelect:t.selectInlineKeyboardOnSuccess,"select-mode":!0},null,8,["onSelect"])):(l(),$(A,{key:1,type:"inline",onSave:t.saveInlineKeyboardOnSuccess,"edited-keyboard":t.quizForm.success_inline_keyboard},null,8,["onSave","edited-keyboard"]))])])])):r("",!0)]),e("div",N6,[e("div",J6,[e("button",{class:"btn btn-outline-info rounded-5",type:"button",onClick:o[13]||(o[13]=a=>t.addMessage("failure_message",null))},"Добавить еще вариант текста ")]),(l(!0),i(g,null,y(t.quizForm.failure_message,(a,d)=>(l(),i("div",Y6,[e("div",H6,[e("div",G6,[e("div",W6,[e("label",{class:"form-label",id:"quiz-failure_message"+d},[f(n,null,{content:v(()=>[x6]),default:v(()=>[Z6]),_:1}),m(" Текст при проигрыше "),e7,t.quizForm.failure_message[d]?(l(),i("small",t7," Длина текста "+u(t.quizForm.failure_message[d].length)+"/255",1)):r("",!0)],8,X6),f(R,{param:"failure_message",onCallback:_=>t.attachTo(_,d)},null,8,["onCallback"])]),c(e("textarea",{class:"form-control",placeholder:"Текст при проигрыше","aria-label":"Текст при проигрыше",maxlength:"255","onUpdate:modelValue":_=>t.quizForm.failure_message[d]=_,"aria-describedby":"quiz-success_message",required:""},`
                    `,8,s7),[[h,t.quizForm.failure_message[d]]])]),e("div",o7,[e("button",{class:"btn btn-outline-danger",disabled:t.quizForm.failure_message.length<=1,onClick:_=>t.removeMessage("failure_message",d)},"Удалить ",8,l7)])])]))),256))]),e("div",i7,[e("div",n7,[e("div",a7,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[14]||(o[14]=a=>t.need_inline_menu_on_failure=a),type:"checkbox",id:"need_template_selector_on_failure"},null,512),[[k,t.need_inline_menu_on_failure]]),d7])]),t.need_inline_menu_on_failure?(l(),i("div",r7,[e("div",c7,[e("div",u7,[m7,e("button",{class:b(["btn",{"btn-outline-primary":!t.need_template_selector_on_failure,"btn-primary":t.need_template_selector_on_failure}]),type:"button",onClick:o[15]||(o[15]=a=>t.need_template_selector_on_failure=!t.need_template_selector_on_failure)},[t.need_template_selector_on_failure?(l(),i("span",h7," Скрыть шаблоны меню")):(l(),i("span",_7," Открыть шаблоны меню"))],2)]),e("div",p7,[t.need_template_selector_on_failure?(l(),$(T,{key:0,class:"mb-2",type:"inline",onSelect:t.selectInlineKeyboardOnFailure,"select-mode":!0},null,8,["onSelect"])):(l(),$(A,{key:1,type:"inline",onSave:t.saveInlineKeyboardOnFailure,"edited-keyboard":t.quizForm.failure_inline_keyboard},null,8,["onSave","edited-keyboard"]))])])])):r("",!0)]),e("div",b7,[e("div",f7,[e("div",g7,[c(e("select",{class:"form-select","onUpdate:modelValue":o[16]||(o[16]=a=>t.quizForm.display_type=a),id:"quiz-display-type","aria-label":"quiz-display-type"},[(l(!0),i(g,null,y(t.types,(a,d)=>(l(),i("option",{value:d,selected:d==t.quizForm.display_type},u(a),9,v7))),256))],512),[[I,t.quizForm.display_type]]),$7])])]),e("div",y7,[e("div",k7,[e("button",F7,[t.quizForm.id==null?(l(),i("span",w7,"Создать квиз")):(l(),i("span",C7,"Обновить квиз"))])])])],32)}}}),j7={class:"row py-2"},q7={class:"col-12"},z7={class:"input-group mb-3"},V7={class:"col-12"},P7={key:0,class:"table"},O7=e("th",{scope:"col"},"Число вопросов",-1),U7=e("th",{scope:"col"},"Число команд",-1),A7=e("th",{scope:"col"},"Действие",-1),I7={scope:"row"},Q7=["onClick"],T7={key:0,style:{width:"50px",height:"50px"},alt:""},B7={key:1},R7={key:0,class:"mb-0"},M7={key:1},D7={key:0,class:"mb-0"},E7={key:1},L7={key:0,class:"mb-0"},K7={key:1},N7={key:0,class:"fa-solid fa-chevron-down text-success"},J7={key:1,class:"fa-solid fa-xmark text-danger"},Y7={key:0,class:"fa-solid fa-chevron-down text-success"},H7={key:1,class:"fa-solid fa-xmark text-danger"},G7={key:0,class:"dropdown"},W7=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),X7={class:"dropdown-menu"},Z7={key:0},x7=["onClick"],e9={key:1},t9=e("div",{class:"alert alert-warning alert-dismissible fade show",role:"alert"},[e("strong",null,"Внимание!"),m(" Вы еще не добавили ни одного квиза! "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"alert","aria-label":"Close"})],-1),s9={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},o9={class:"d-flex justify-content-center mb-3"},l9={alt:"",width:"100",height:"100"},i9=e("h1",{class:"text-body-emphasis"},"Создание Квиза",-1),n9=e("p",{class:"col-lg-8 mx-auto fs-5 text-muted"}," Квиз - это игра. Создавайте игры и делитесь с клиентами ссылкой на игру. Формируйте команды, начисляйте баллы, меняйте баллы на вкусные призы. Всё в ваших руках. ",-1),a9={class:"d-inline-flex gap-2 mb-5"},d9=e("a",{href:"https://telegra.ph/Sozdanie-Kviza-01-13",target:"_blank",class:"d-inline-flex align-items-center btn btn-outline-secondary btn-lg px-4 rounded-pill"}," Подробнее ",-1),r9={key:0,class:"col-12"},c9={props:["bot"],data(){return{direction:"desc",order:"updated_at",show:!0,loading:!0,quizzes:[],search:null,paginate_object:null}},computed:{...C(["getQuizzes","getQuizzesPaginateObject"])},mounted(){this.loadQuizzes()},methods:{removeQuiz(s){this.loading=!0,this.$store.dispatch("removeQuiz",{quizId:s}).then(t=>{this.loading=!1,this.loadQuizzes(0),this.$notify("Событие успешно удалено")}).catch(()=>{this.loading=!1,this.$notify("Ошибка удаления события")})},createQuiz(){this.$emit("create")},nextQuizzes(s){this.loadQuizzes(s)},selectEvent(s){this.$emit("select",s)},loadAndOrder(s){this.order=s,this.direction=this.direction==="desc"?"asc":"desc",this.loadQuizzes(0)},loadQuizzes(s=0){this.loading=!0,this.$store.dispatch("loadQuizzes",{dataObject:{bot_id:this.bot.id||null,search:this.search,order:this.order,direction:this.direction},page:s,size:20}).then(t=>{this.loading=!1,this.quizzes=this.getQuizzes,this.paginate_object=this.getQuizzesPaginateObject}).catch(()=>{this.loading=!1})}}},u9=Object.assign(c9,{__name:"QuizTable",setup(s){return(t,o)=>{const n=Q("lazy");return l(),i("div",j7,[e("div",q7,[e("div",z7,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск квиза","aria-label":"Поиск квиза","onUpdate:modelValue":o[0]||(o[0]=a=>t.search=a),"aria-describedby":"quiz-search-quiz"},null,512),[[h,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=a=>t.loadQuizzes(0)),type:"button",id:"quiz-search-quiz"},"Найти ")])]),e("div",V7,[t.quizzes.length>0?(l(),i("table",P7,[e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"cursor-pointer",onClick:o[2]||(o[2]=a=>t.loadAndOrder("id"))},"#"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[3]||(o[3]=a=>t.loadAndOrder("title"))},"Название"),O7,U7,e("th",{scope:"col",class:"cursor-pointer",onClick:o[4]||(o[4]=a=>t.loadAndOrder("image"))},"Изображение к квизу"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[5]||(o[5]=a=>t.loadAndOrder("description"))},"Описание"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[6]||(o[6]=a=>t.loadAndOrder("completed_at"))},"Квиз пройден"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[7]||(o[7]=a=>t.loadAndOrder("start_at"))},"Дата и время начала"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[8]||(o[8]=a=>t.loadAndOrder("end_at"))},"Дата и время завершения"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[9]||(o[9]=a=>t.loadAndOrder("display_type"))},"Тип отображения"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[10]||(o[10]=a=>t.loadAndOrder("show_answers"))},"Показывать ответы по окончанию раунда "),e("th",{scope:"col",class:"cursor-pointer",onClick:o[11]||(o[11]=a=>t.loadAndOrder("is_active"))},"Активный "),e("th",{scope:"col",class:"cursor-pointer",onClick:o[12]||(o[12]=a=>t.loadAndOrder("updated_at"))},"Дата изменения"),A7])]),e("tbody",null,[(l(!0),i(g,null,y(t.quizzes,(a,d)=>(l(),i("tr",{class:b({"border-info":a.deleted_at==null,"border-danger":a.deleted_at!=null})},[e("th",I7,u(a.id),1),e("td",{onClick:_=>t.selectEvent(a)},u(a.title||"Не указано"),9,Q7),e("td",null,u((a.questions||[]).length),1),e("td",null,u((a.commands||[]).length),1),e("td",null,[a.image!=null?c((l(),i("img",T7,null,512)),[[n,"/file-by-file-id/"+a.image]]):(l(),i("p",B7,"не указано"))]),e("td",null,u(a.description||"Не указано"),1),e("td",null,[a.completed_at?(l(),i("p",R7,u(t.$filters.currentFull(a.completed_at)),1)):(l(),i("p",M7,"Не задано"))]),e("td",null,[a.start_at?(l(),i("p",D7,u(t.$filters.currentFull(a.start_at)),1)):(l(),i("p",E7,"Не задано"))]),e("td",null,[a.end_at?(l(),i("p",L7,u(t.$filters.currentFull(a.end_at)),1)):(l(),i("p",K7,"Не задано"))]),e("td",null,u(a.display_type),1),e("td",null,u(a.time_limit),1),e("td",null,[a.show_answers?(l(),i("i",N7)):(l(),i("i",J7))]),e("td",null,[a.is_active?(l(),i("i",Y7)):(l(),i("i",H7))]),e("td",null,u(t.$filters.current(a.updated_at)),1),e("td",null,[a.id?(l(),i("div",G7,[W7,e("ul",X7,[a.deleted_at==null?(l(),i("li",Z7,[e("a",{class:"dropdown-item",onClick:_=>t.removeQuiz(a.id),href:"javascript:void(0)"},"Удалить",8,x7)])):r("",!0)])])):r("",!0)])],2))),256))])])):(l(),i("div",e9,[t9,e("div",s9,[e("div",o9,[c(e("img",l9,null,512),[[n,"../images/icon.png"]])]),i9,n9,e("div",a9,[e("button",{onClick:o[13]||(o[13]=(...a)=>t.createQuiz&&t.createQuiz(...a)),class:"d-inline-flex align-items-center btn btn-lg px-4 rounded-pill btn-primary",type:"button"}," Добавить "),d9])])]))]),t.quizzes.length>0?(l(),i("div",r9,[t.paginate_object?(l(),$(j,{key:0,onPagination_page:t.nextQuizzes,pagination:t.paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])):r("",!0)])}}}),m9={props:{type:String,value:String}},_9={class:"d-flex mb-2"},h9={class:"form-floating mb-3"},p9=["value"],b9=e("label",{for:"custom-url-link-for-success"},"Ссылка на файл",-1);function f9(s,t,o,n,a,d){return l(),i(g,null,[e("div",_9,[e("span",{class:b(["badge bg-secondary cursor-pointer mr-1",{"bg-success":o.type=="video"}]),onClick:t[0]||(t[0]=_=>s.$emit("update:type","video"))},"Видео",2),e("span",{class:b(["badge bg-secondary cursor-pointer mr-1",{"bg-success":o.type=="video_note"}]),onClick:t[1]||(t[1]=_=>s.$emit("update:type","video_note"))},"Кружок",2),e("span",{class:b(["badge bg-secondary cursor-pointer mr-1",{"bg-success":o.type=="photo"}]),onClick:t[2]||(t[2]=_=>s.$emit("update:type","photo"))},"Изображение",2),e("span",{class:b(["badge bg-secondary cursor-pointer mr-1",{"bg-success":o.type=="audio"}]),onClick:t[3]||(t[3]=_=>s.$emit("update:type","audio"))},"Звук",2)]),e("div",h9,[e("input",{type:"text",class:"form-control",value:o.value,onInput:t[4]||(t[4]=_=>s.$emit("update:value",_.target.value)),id:"custom-url-link-for-success",placeholder:"https://...."},null,40,p9),b9])],64)}const N=O(m9,[["render",f9]]),g9={class:"row py-3"},v9={class:"col-12"},$9={class:"row"},y9={class:"col-12 mb-3"},k9={key:0},F9=["onClick"],w9={class:"form-label",id:"quiz-round"},C9=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),S9=e("div",null," Раунд, в котором будет отображен вопрос ",-1),j9=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),q9={class:"col-12 mb-3"},z9={class:"form-label",id:"event-on_after_appointment"},V9=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),P9=e("div",null," Текст вопроса ",-1),O9=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),U9={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},A9={class:"col-12 mb-3"},I9={class:"form-check"},Q9=e("label",{class:"form-check-label",for:"need_media"}," Нужен медиа-контент ",-1),T9={key:0,class:"col-12 mb-3"},B9={class:"form-label",id:"quiz-images"},R9=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),M9=e("div",null," Изображение, видео, аудио сопровождение вопроса ",-1),D9={key:0,class:"badge rounded-pill text-bg-info m-0"},E9=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),L9=e("h6",null,"Вставьте ссылку на контент...",-1),K9=e("h6",null,"...или выберите из доступных",-1),N9={class:"col-12 mb-3"},J9={class:"form-check"},Y9=e("label",{class:"form-check-label",for:"is_multiply"}," Множественные ответы ",-1),H9={class:"col-12 mb-3"},G9={class:"form-check"},W9=e("label",{class:"form-check-label",for:"is_open"}," Открытый вопрос ",-1),X9={class:"col-12 mb-3"},Z9={class:"d-flex justify-content-between"},x9={class:"form-label",id:"quiz-description"},eS=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),tS=e("div",null," Текст при выборе правильного ответа ",-1),sS=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),oS={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},lS={class:"col-12 mb-3"},iS={class:"form-check"},nS=e("label",{class:"form-check-label",for:"need_media_for_success"}," Нужен медиа-контент при правильном ответе ",-1),aS={key:1,class:"col-12 mb-3"},dS=e("h6",null,"Вставьте ссылку на контент...",-1),rS=e("h6",null,"...или выберите из доступных",-1),cS={class:"col-12 mb-3"},uS={class:"d-flex justify-content-between"},mS={class:"form-label",id:"quiz-description"},_S=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),hS=e("div",null," Текст в выбора неправильного ответа ",-1),pS=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),bS={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},fS={class:"col-12 mb-3"},gS={class:"form-check"},vS=e("label",{class:"form-check-label",for:"need_media_for_failed"}," Нужен медиа-контент при неправильном ответе ",-1),$S={key:2,class:"col-12 mb-3"},yS=e("h6",null,"Вставьте ссылку на контент...",-1),kS=e("h6",null,"...или выберите из доступных",-1),FS={class:"row"},wS={class:"col-12"},CS={class:"col-12"},SS={key:0,class:"table"},jS=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"Текст вопроса"),e("th",{scope:"col"},"Баллы"),e("th",{scope:"col"},"Контент"),e("th",{scope:"col"},"Тип контента"),e("th",{scope:"col"},"Является верным"),e("th",{scope:"col"},"Действие")])],-1),qS={scope:"row"},zS={class:"form-floating mb-3"},VS=["onUpdate:modelValue","id"],PS=["for"],OS={class:"form-floating mb-3"},US=["onUpdate:modelValue","id"],AS=["for"],IS=["onClick"],QS={class:"form-check"},TS=["onUpdate:modelValue","id"],BS=["for"],RS={class:"dropdown"},MS=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),DS={class:"dropdown-menu"},ES={key:0},LS=["onClick"],KS={key:1},NS=["onClick"],JS={key:1},YS={class:"row"},HS={class:"col-12"},GS={type:"submit",class:"btn btn-outline-success w-100 p-3"},WS={key:0},XS={key:1},ZS={class:"modal fade",id:"chooseMediaContent",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},xS={class:"modal-dialog"},ej={class:"modal-content"},tj={key:0,class:"modal-body"},sj=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),oj={class:"modal fade",id:"chooseSuccessMediaContent",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},lj={class:"modal-dialog"},ij={class:"modal-content"},nj={class:"modal-body"},aj=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),dj={class:"modal fade",id:"chooseFailureMediaContent",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},rj={class:"modal-dialog"},cj={class:"modal-content"},uj={class:"modal-body"},mj=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),_j={class:"modal fade",id:"chooseBaseMediaContent",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},hj={class:"modal-dialog"},pj={class:"modal-content"},bj={class:"modal-body"},fj=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),gj={props:["quizId","bot","question"],data(){return{step:0,load:!1,selectedQuestionIndex:null,need_media:!1,need_media_for_success:!1,need_media_for_failed:!1,rounds:[],questionForm:{id:null,text:null,round:null,media_content:null,content_type:null,is_multiply:!1,is_open:!1,answers:[],success_message:null,failure_message:null,success_media_content:null,failure_media_content:null,success_media_content_type:null,failure_media_content_type:null}}},watch:{questionForm:{handler(s){this.need_reset=!0},deep:!0},need_media:function(s,t){this.need_page_images||(this.questionForm.media_content=null,this.questionForm.content_type=null)},need_media_for_success:function(s,t){this.need_page_images||(this.questionForm.success_media_content=null,this.questionForm.success_media_content_type=null)},need_media_for_failed:function(s,t){this.need_page_images||(this.questionForm.failure_media_content=null,this.questionForm.failure_media_content_type=null)}},mounted(){this.loadQuizRounds(),this.question&&(this.question.media_content!=null&&(this.need_media=!0),this.question.success_media_content!=null&&(this.need_media_for_success=!0),this.question.failure_media_content!=null&&(this.need_media_for_failed=!0),this.$nextTick(()=>{this.questionForm={id:this.question.id||null,text:this.question.text||null,round:this.question.round||null,media_content:this.question.media_content||null,content_type:this.question.content_type||null,is_multiply:this.question.is_multiply||!1,is_open:this.question.is_open||!1,answers:this.question.answers||[],success_message:this.question.success_message||null,failure_message:this.question.failure_message||null,success_media_content:this.question.success_media_content||null,failure_media_content:this.question.failure_media_content||null,success_media_content_type:this.question.success_media_content_type||null,failure_media_content_type:this.question.failure_media_content_type||null}}))},methods:{attachTo(s){this.questionForm[s.param]==null?this.questionForm[s.param]=s.value:this.questionForm[s.param]+=s.value},loadQuizRounds(){this.$store.dispatch("loadQuizRounds",{dataObject:{bot_id:this.bot.id||null,quiz_id:this.quizId||null}}).then(s=>{this.rounds=s})},chooseBaseMediaContent(s){new bootstrap.Modal(document.getElementById("chooseBaseMediaContent"),{}).show()},chooseSuccessMediaContent(s){new bootstrap.Modal(document.getElementById("chooseSuccessMediaContent"),{}).show()},chooseFailureMediaContent(s){new bootstrap.Modal(document.getElementById("chooseFailureMediaContent"),{}).show()},chooseMediaContent(s){this.selectedQuestionIndex=null,this.$nextTick(()=>{this.selectedQuestionIndex=s}),new bootstrap.Modal(document.getElementById("chooseMediaContent"),{}).show()},selectMediaForFailure(s){this.questionForm.failure_media_content=s.file_id,this.questionForm.failure_media_content_type=s.type},selectMediaForSuccess(s){this.questionForm.success_media_content=s.file_id,this.questionForm.success_media_content_type=s.type},selectMediaForAnswer(s){this.questionForm.answers[this.selectedQuestionIndex].media_content=s.file_id,this.questionForm.answers[this.selectedQuestionIndex].content_type=s.type},selectMedia(s){this.questionForm.media_content=s.file_id,this.questionForm.content_type=s.type},clearQuestionForm(){this.questionForm={id:null,text:null,round:null,media_content:null,content_type:null,is_multiply:!1,is_open:!1,answers:[],success_message:null,failure_message:null,success_media_content:null,failure_media_content:null,success_media_content_type:null,failure_media_content_type:null}},addNewAnswer(){this.questionForm.answers.push({text:null,media_content:null,content_type:null,is_right_answer:!1,points:0})},removeAnswerFromArray(s){this.questionForm.answers.splice(s,1)},removeAnswer(s){this.$store.dispatch("removeQuizAnswer",{quizAnswerId:s}).then(t=>{this.$notify("Вопрос успешно удален");let o=this.questionForm.answers.findIndex(n=>n.id==s);this.questionForm.answers.splice(o,1)}).catch(t=>{this.$notify("Ошибка удаления вопроса")})},submitForm(){let s=new FormData;Object.keys(this.questionForm).forEach(t=>{const o=this.questionForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),s.append("bot_id",this.bot.id),s.append("quiz_id",this.quizId),this.$store.dispatch("storeQuizQuestion",{quizQuestionForm:s}).then(t=>{this.$emit("callback",t.data),this.$notify("Вопрос успешно создан"),this.clearQuestionForm(),this.loadQuizRounds()}).catch(t=>{this.$notify("Ошибка создания вопроса")})}}},vj=Object.assign(gj,{__name:"QuizQuestionForm",setup(s){return(t,o)=>{const n=q("Popper");return l(),i(g,null,[e("div",g9,[e("div",v9,[e("button",{onClick:o[0]||(o[0]=(...a)=>t.clearQuestionForm&&t.clearQuestionForm(...a)),class:"btn btn-primary"},"Новый вопрос ")])]),e("form",{onSubmit:o[20]||(o[20]=S((...a)=>t.submitForm&&t.submitForm(...a),["prevent"]))},[e("div",$9,[e("div",y9,[t.rounds.length>0?(l(),i("p",k9,[m(" Ранее созданные раунды: "),(l(!0),i(g,null,y(t.rounds,a=>(l(),i("span",{onClick:d=>t.questionForm.round=a,class:"badge bg-primary mr-1 cursor-pointer"},u(a),9,F9))),256))])):r("",!0),e("label",w9,[f(n,null,{content:v(()=>[S9]),default:v(()=>[C9]),_:1}),m(" Раунд "),j9]),c(e("input",{type:"number",class:"form-control",placeholder:"Раунд","aria-label":"Раундт",step:"1",min:"1","onUpdate:modelValue":o[1]||(o[1]=a=>t.questionForm.round=a),"aria-describedby":"quiz-round",required:""},null,512),[[h,t.questionForm.round]])]),e("div",q9,[e("label",z9,[f(n,null,{content:v(()=>[P9]),default:v(()=>[V9]),_:1}),m(" Текст вопроса "),O9,t.questionForm.text?(l(),i("small",U9," Длина текста "+u(t.questionForm.text.length)+"/255",1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст вопроса","aria-label":"Текст вопроса","onUpdate:modelValue":o[2]||(o[2]=a=>t.questionForm.text=a),maxlength:"255","aria-describedby":"review-text",required:""},`
                    `,512),[[h,t.questionForm.text]])]),e("div",A9,[e("div",I9,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[3]||(o[3]=a=>t.need_media=a),type:"checkbox",id:"need_media"},null,512),[[k,t.need_media]]),Q9])]),t.need_media?(l(),i("div",T9,[e("label",B9,[f(n,null,{content:v(()=>[M9]),default:v(()=>[R9]),_:1}),m(" Медиа контент к вопросу "),t.questionForm.content_type?(l(),i("span",D9,u(t.questionForm.content_type),1)):r("",!0),E9]),L9,f(N,{value:t.questionForm.media_content,type:t.questionForm.content_type,"onUpdate:type":o[4]||(o[4]=a=>t.questionForm.content_type=a),"onUpdate:value":o[5]||(o[5]=a=>t.questionForm.media_content=a)},null,8,["value","type"]),K9,e("button",{type:"button",onClick:o[6]||(o[6]=(...a)=>t.chooseBaseMediaContent&&t.chooseBaseMediaContent(...a)),class:"btn btn-outline-info rounded-lg"},"Выбрать медиа-файл ")])):r("",!0),e("div",N9,[e("div",J9,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[7]||(o[7]=a=>t.questionForm.is_multiply=a),type:"checkbox",id:"is_multiply"},null,512),[[k,t.questionForm.is_multiply]]),Y9])]),e("div",H9,[e("div",G9,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[8]||(o[8]=a=>t.questionForm.is_open=a),type:"checkbox",id:"is_open"},null,512),[[k,t.questionForm.is_open]]),W9])]),e("div",X9,[e("div",Z9,[e("label",x9,[f(n,null,{content:v(()=>[tS]),default:v(()=>[eS]),_:1}),m(" Текст при выборе правильного ответа "),sS,t.questionForm.success_message?(l(),i("small",oS," Длина текста "+u(t.questionForm.success_message.length)+"/255",1)):r("",!0)]),f(R,{param:"success_message",onCallback:t.attachTo},null,8,["onCallback"])]),c(e("textarea",{class:"form-control",placeholder:"Текст при правильном ответе","aria-label":"Текст при правильном ответе",maxlength:"255","onUpdate:modelValue":o[9]||(o[9]=a=>t.questionForm.success_message=a),"aria-describedby":"quiz-question-success_message"},`
                    `,512),[[h,t.questionForm.success_message]])]),e("div",lS,[e("div",iS,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[10]||(o[10]=a=>t.need_media_for_success=a),type:"checkbox",id:"need_media_for_success"},null,512),[[k,t.need_media_for_success]]),nS])]),t.need_media_for_success?(l(),i("div",aS,[dS,f(N,{type:t.questionForm.success_media_content_type,"onUpdate:type":o[11]||(o[11]=a=>t.questionForm.success_media_content_type=a),value:t.questionForm.success_media_content,"onUpdate:value":o[12]||(o[12]=a=>t.questionForm.success_media_content=a)},null,8,["type","value"]),rS,e("button",{type:"button",onClick:o[13]||(o[13]=(...a)=>t.chooseSuccessMediaContent&&t.chooseSuccessMediaContent(...a)),class:"btn btn-outline-info rounded-lg"},"Выбрать медиа-файл ")])):r("",!0),e("div",cS,[e("div",uS,[e("label",mS,[f(n,null,{content:v(()=>[hS]),default:v(()=>[_S]),_:1}),m(" Текст при выборе неправильного ответа "),pS,t.questionForm.failure_message?(l(),i("small",bS," Длина текста "+u(t.questionForm.failure_message.length)+"/255",1)):r("",!0)]),f(R,{param:"failure_message",onCallback:t.attachTo},null,8,["onCallback"])]),c(e("textarea",{class:"form-control",placeholder:"Текст при неправильном ответе","aria-label":"Текст при неправильном ответе",maxlength:"255","onUpdate:modelValue":o[14]||(o[14]=a=>t.questionForm.failure_message=a),"aria-describedby":"quiz-question-failure-message"},`
                    `,512),[[h,t.questionForm.failure_message]])]),e("div",fS,[e("div",gS,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[15]||(o[15]=a=>t.need_media_for_failed=a),type:"checkbox",id:"need_media_for_failed"},null,512),[[k,t.need_media_for_failed]]),vS])]),t.need_media_for_failed?(l(),i("div",$S,[yS,f(N,{type:t.questionForm.failure_media_content_type,"onUpdate:type":o[16]||(o[16]=a=>t.questionForm.failure_media_content_type=a),value:t.questionForm.failure_media_content,"onUpdate:value":o[17]||(o[17]=a=>t.questionForm.failure_media_content=a)},null,8,["type","value"]),kS,e("button",{type:"button",onClick:o[18]||(o[18]=(...a)=>t.chooseFailureMediaContent&&t.chooseFailureMediaContent(...a)),class:"btn btn-outline-info rounded-lg"},"Выбрать медиа-файл ")])):r("",!0)]),e("div",FS,[e("div",wS,[e("button",{onClick:o[19]||(o[19]=(...a)=>t.addNewAnswer&&t.addNewAnswer(...a)),type:"button",class:"btn btn-outline-success rounded-5"}," Добавить ответы ")]),e("div",CS,[t.questionForm.answers.length>0?(l(),i("table",SS,[jS,e("tbody",null,[(l(!0),i(g,null,y(t.questionForm.answers,(a,d)=>(l(),i("tr",{class:b({"border-info":a.deleted_at==null,"border-danger":a.deleted_at!=null})},[e("th",qS,u(a.id||"Новый"),1),e("td",null,[e("div",zS,[c(e("input",{type:"text","onUpdate:modelValue":_=>t.questionForm.answers[d].text=_,class:"form-control",id:"answer-text-"+d,placeholder:"Текст ответа"},null,8,VS),[[h,t.questionForm.answers[d].text]]),e("label",{for:"answer-text-"+d},"Текст ответа",8,PS)])]),e("td",null,[e("div",OS,[c(e("input",{type:"text","onUpdate:modelValue":_=>t.questionForm.answers[d].points=_,class:"form-control",id:"answer-points-"+d,placeholder:"Текст ответа"},null,8,US),[[h,t.questionForm.answers[d].points]]),e("label",{for:"answer-points-"+d},"Баллы",8,AS)])]),e("td",null,[e("p",{class:"cursor-pointer",onClick:_=>t.chooseMediaContent(d)},u(a.media_content||"Не указано"),9,IS)]),e("td",null,u(a.content_type||"Не указано"),1),e("td",null,[e("div",QS,[c(e("input",{class:"form-check-input","onUpdate:modelValue":_=>t.questionForm.answers[d].is_right_answer=_,type:"checkbox",id:"answer-is_right_answer-"+d},null,8,TS),[[k,t.questionForm.answers[d].is_right_answer]]),e("label",{class:"form-check-label",for:"answer-is_right_answer-"+d}," Правильный ответ ",8,BS)])]),e("td",null,[e("div",RS,[MS,e("ul",DS,[a.id==null?(l(),i("li",ES,[e("a",{class:"dropdown-item",onClick:_=>t.removeAnswerFromArray(d),href:"javascript:void(0)"},"Удалить",8,LS)])):r("",!0),a.deleted_at==null&&a.id!=null?(l(),i("li",KS,[e("a",{class:"dropdown-item",onClick:_=>t.removeAnswer(a.id),href:"javascript:void(0)"},"Удалить",8,NS)])):r("",!0)])])])],2))),256))])])):(l(),i("p",JS,"На текущий момент нет ни одного созданного ответа"))])]),e("div",YS,[e("div",HS,[e("button",GS,[t.questionForm.id==null?(l(),i("span",WS,"Сохранить вопрос")):(l(),i("span",XS,"Обновить вопрос"))])])])],32),e("div",ZS,[e("div",xS,[e("div",ej,[t.selectedQuestionIndex!=null?(l(),i("div",tj,[f(V,{"need-video":!0,"need-video-note":!0,"need-audio":!0,"need-photo":!0,selected:[t.questionForm.answers[t.selectedQuestionIndex||0].media_content||""],onSelect:t.selectMediaForAnswer},null,8,["selected","onSelect"])])):r("",!0),sj])])]),e("div",oj,[e("div",lj,[e("div",ij,[e("div",nj,[f(V,{"need-video":!0,"need-video-note":!0,"need-audio":!0,"need-photo":!0,selected:[t.questionForm.success_media_content],onSelect:t.selectMediaForSuccess},null,8,["selected","onSelect"])]),aj])])]),e("div",dj,[e("div",rj,[e("div",cj,[e("div",uj,[f(V,{"need-video":!0,"need-video-note":!0,"need-audio":!0,"need-photo":!0,selected:[t.questionForm.failure_media_content],onSelect:t.selectMediaForFailure},null,8,["selected","onSelect"])]),mj])])]),e("div",_j,[e("div",hj,[e("div",pj,[e("div",bj,[f(V,{"need-video":!0,"need-video-note":!0,"need-audio":!0,"need-photo":!0,selected:[t.questionForm.media_content],onSelect:t.selectMedia},null,8,["selected","onSelect"])]),fj])])])],64)}}}),$j={class:"row"},yj={class:"col-12"},kj={key:0,class:"table"},Fj=e("th",{scope:"col"},"Число ответов",-1),wj=e("th",{scope:"col"},"Действие",-1),Cj={scope:"row"},Sj=["onClick"],jj={key:0,class:"fa-solid fa-chevron-down text-success"},qj={key:1,class:"fa-solid fa-xmark text-danger"},zj={key:0,class:"fa-solid fa-chevron-down text-success"},Vj={key:1,class:"fa-solid fa-xmark text-danger"},Pj={key:0,class:"dropdown"},Oj=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),Uj={class:"dropdown-menu"},Aj={key:0},Ij=["onClick"],Qj={key:1},Tj={class:"col-12"},Bj={props:["bot","quizId"],data(){return{direction:"desc",order:"updated_at",show:!0,is_group:!1,loading:!0,questions:[],search:null,paginate_object:null}},computed:{...C(["getQuizQuestions","getQuizQuestionsPaginateObject"])},mounted(){this.loadQuizQuestions()},methods:{nextQuizQuestion(s){this.loadQuizQuestions(s)},selectQuizQuestion(s){this.$emit("select",s),this.$notify("Вопрос успешно выбран")},removeQuizQuestion(s){this.loading=!0,this.$store.dispatch("removeQuizQuestion",{quizQuestionId:s}).then(t=>{this.loading=!1,this.loadQuizQuestions(0),this.$notify("Вопрос успешно удален")}).catch(()=>{this.loading=!1,this.$notify("Вопрос удаления сервиса")})},loadAndOrder(s){this.order=s,this.direction=this.direction==="desc"?"asc":"desc",this.loadQuizQuestions(0)},loadQuizQuestions(s=0){this.loading=!0,this.$store.dispatch("loadQuizQuestions",{dataObject:{quiz_id:this.quizId,bot_id:this.bot.id||null,search:this.search,order:this.order,direction:this.direction},page:s,size:100}).then(t=>{this.loading=!1,this.questions=this.getQuizQuestions,this.paginate_object=this.getQuizQuestionsPaginateObject}).catch(()=>{this.loading=!1})}}},Rj=Object.assign(Bj,{__name:"QuizQuestionTable",setup(s){return(t,o)=>(l(),i("div",$j,[e("div",yj,[t.questions.length>0?(l(),i("table",kj,[e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"cursor-pointer",onClick:o[0]||(o[0]=n=>t.loadAndOrder("id"))},"#"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[1]||(o[1]=n=>t.loadAndOrder("text"))},"Текст вопроса"),Fj,e("th",{scope:"col",class:"cursor-pointer",onClick:o[2]||(o[2]=n=>t.loadAndOrder("round"))},"Раунд"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[3]||(o[3]=n=>t.loadAndOrder("media_content"))},"Контент"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[4]||(o[4]=n=>t.loadAndOrder("content_type"))},"Тип контента"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[5]||(o[5]=n=>t.loadAndOrder("is_multiply"))},"Множественный"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[6]||(o[6]=n=>t.loadAndOrder("is_open"))},"Открытый"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[7]||(o[7]=n=>t.loadAndOrder("updated_at"))},"Дата изменения"),wj])]),e("tbody",null,[(l(!0),i(g,null,y(t.questions,(n,a)=>(l(),i("tr",{class:b({"border-info":n.deleted_at==null,"border-danger":n.deleted_at!=null})},[e("th",Cj,u(n.id),1),e("td",{onClick:d=>t.selectQuizQuestion(n)},u(n.text||"Не указано"),9,Sj),e("td",null,u((n.answers||[]).length),1),e("td",null,u(n.round||"Не указано"),1),e("td",null,u(n.media_content||"Не указано"),1),e("td",null,u(n.content_type||"Не указано"),1),e("td",null,[n.is_multiply?(l(),i("i",jj)):(l(),i("i",qj))]),e("td",null,[n.is_open?(l(),i("i",zj)):(l(),i("i",Vj))]),e("td",null,u(t.$filters.current(n.updated_at)),1),e("td",null,[n.id?(l(),i("div",Pj,[Oj,e("ul",Uj,[n.deleted_at==null?(l(),i("li",Aj,[e("a",{class:"dropdown-item",onClick:d=>t.removeQuizQuestion(n.id),href:"javascript:void(0)"},"Удалить",8,Ij)])):r("",!0)])])):r("",!0)])],2))),256))])])):(l(),i("p",Qj,"На текущий момент нет ни одного созданного вопроса"))]),e("div",Tj,[t.paginate_object?(l(),$(j,{key:0,onPagination_page:t.nextQuizQuestion,pagination:t.paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])]))}}),Mj={class:"row py-3"},Dj={class:"col-12"},Ej={class:"row"},Lj={class:"col-12 mb-3"},Kj={class:"form-label",id:"command-title"},Nj=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Jj=e("div",null," Название команды ",-1),Yj=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Hj={class:"col-12 mb-3"},Gj={class:"form-label",id:"event-on_after_appointment"},Wj=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Xj=e("div",null," Текст описания команды ",-1),Zj=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),xj={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},eq=e("div",{class:"col-12 mb-3"},[e("button",{type:"button",class:"btn btn-outline-info rounded-5","data-bs-toggle":"modal","data-bs-target":"#select-players"}," Подобрать участников команды ")],-1),tq={key:0,class:"col-12 mb-3"},sq=e("h4",null,"Пользователи в команде",-1),oq={class:"list-group list-group-numbered"},lq={class:"list-group-item d-flex justify-content-between align-items-start"},iq={class:"ms-2 me-auto"},nq={class:"fw-bold"},aq={class:"dropdown"},dq=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),rq={class:"dropdown-menu"},cq=["onClick"],uq={class:"row"},mq={class:"col-12"},_q={type:"submit",class:"btn btn-outline-success w-100 p-3"},hq={key:0},pq={key:1},bq={class:"modal fade",id:"select-players",tabindex:"-1","aria-labelledby":"select-players-label","aria-hidden":"true"},fq={class:"modal-dialog modal-fullscreen"},gq={class:"modal-content"},vq=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"select-players-label"},"Подбор участников команды"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),$q={class:"modal-body"},yq=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),kq={props:["quizId","bot","command"],data(){return{step:0,load:!1,commandForm:{id:null,title:null,description:null,players:[]}}},watch:{commandForm:{handler(s){this.need_reset=!0},deep:!0}},mounted(){this.command&&this.$nextTick(()=>{this.commandForm={id:this.command.id||null,title:this.command.title||null,description:this.command.description||null,players:this.command.players||[]}})},methods:{removePlayerFromCommand(s){},selectBotUser(s){if(this.commandForm.players.findIndex(o=>o.id==s.id)>=0){this.$notify("Такой пользователь уже есть в списке");return}this.$notify("Пользователь успешно добавлен"),this.commandForm.players.push(s)},clearCommandForm(){this.commandForm={id:null,title:null,description:null,players:[]}},submitForm(){let s=new FormData;Object.keys(this.commandForm).forEach(t=>{const o=this.commandForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),s.append("bot_id",this.bot.id),s.append("quiz_id",this.quizId),this.$store.dispatch("storeQuizCommand",{quizCommandForm:s}).then(t=>{this.$emit("callback",t.data),this.$notify("Команда успешно создана"),this.clearCommandForm()}).catch(t=>{this.$notify("Ошибка создания команды")})}}},Fq=Object.assign(kq,{__name:"QuizCommandForm",setup(s){return(t,o)=>{const n=q("Popper");return l(),i(g,null,[e("div",Mj,[e("div",Dj,[e("button",{onClick:o[0]||(o[0]=(...a)=>t.clearCommandForm&&t.clearCommandForm(...a)),class:"btn btn-primary"},"Новая команда")])]),e("form",{onSubmit:o[3]||(o[3]=S((...a)=>t.submitForm&&t.submitForm(...a),["prevent"]))},[e("div",Ej,[e("div",Lj,[e("label",Kj,[f(n,null,{content:v(()=>[Jj]),default:v(()=>[Nj]),_:1}),m(" Название команды "),Yj]),c(e("input",{type:"text",class:"form-control",placeholder:"Название команды","aria-label":"Название команды",maxlength:"255","onUpdate:modelValue":o[1]||(o[1]=a=>t.commandForm.title=a),"aria-describedby":"command-title",required:""},null,512),[[h,t.commandForm.title]])]),e("div",Hj,[e("label",Gj,[f(n,null,{content:v(()=>[Xj]),default:v(()=>[Wj]),_:1}),m(" Описание команды "),Zj,t.commandForm.description?(l(),i("small",xj," Длина текста "+u(t.commandForm.description.length)+"/255",1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст описания","aria-label":"Текст описания","onUpdate:modelValue":o[2]||(o[2]=a=>t.commandForm.description=a),maxlength:"255","aria-describedby":"command-text",required:""},`
                    `,512),[[h,t.commandForm.description]])]),eq,t.commandForm.players.length>0?(l(),i("div",tq,[sq,e("ol",oq,[(l(!0),i(g,null,y(t.commandForm.players,a=>(l(),i("li",lq,[e("div",iq,[e("div",nq,"#"+u(a.id),1),m(" "+u(a.fio_from_telegram||a.telegram_chat_id),1)]),e("div",aq,[dq,e("ul",rq,[e("li",null,[e("a",{class:"dropdown-item",onClick:d=>t.removePlayerFromCommand(a.id),href:"javascript:void(0)"},"Удалить",8,cq)])])])]))),256))])])):r("",!0)]),e("div",uq,[e("div",mq,[e("button",_q,[t.commandForm.id==null?(l(),i("span",hq,"Сохранить команду")):(l(),i("span",pq,"Обновить команду"))])])])],32),e("div",bq,[e("div",fq,[e("div",gq,[vq,e("div",$q,[f(D,{simple:!0,onSelect:t.selectBotUser},null,8,["onSelect"])]),yq])])])],64)}}}),wq={class:"row"},Cq={class:"col-12"},Sq={key:0,class:"table"},jq=e("th",{scope:"col"},"Число участников",-1),qq=e("th",{scope:"col"},"Действие",-1),zq={scope:"row"},Vq=["onClick"],Pq={key:0,class:"dropdown"},Oq=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),Uq={class:"dropdown-menu"},Aq={key:0},Iq=["onClick"],Qq={key:1},Tq={class:"col-12"},Bq={props:["bot","quizId"],data(){return{direction:"desc",order:"updated_at",show:!0,is_group:!1,loading:!0,commands:[],search:null,paginate_object:null}},computed:{...C(["getQuizCommands","getQuizCommandsPaginateObject"])},mounted(){this.loadQuizCommands()},methods:{nextQuizCommand(s){this.loadQuizCommands(s)},selectQuizCommand(s){this.$emit("select",s),this.$notify("Вопрос успешно выбран")},removeQuizCommand(s){this.loading=!0,this.$store.dispatch("removeQuizCommand",{quizCommandId:s}).then(t=>{this.loading=!1,this.loadQuizCommands(0),this.$notify("Вопрос успешно удален")}).catch(()=>{this.loading=!1,this.$notify("Вопрос удаления сервиса")})},loadAndOrder(s){this.order=s,this.direction=this.direction==="desc"?"asc":"desc",this.loadQuizCommands(0)},loadQuizCommands(s=0){this.loading=!0,this.$store.dispatch("loadQuizCommands",{dataObject:{quiz_id:this.quizId,bot_id:this.bot.id||null,search:this.search,order:this.order,direction:this.direction},page:s,size:100}).then(t=>{this.loading=!1,this.commands=this.getQuizCommands,this.paginate_object=this.getQuizCommandsPaginateObject}).catch(()=>{this.loading=!1})}}},Rq=Object.assign(Bq,{__name:"QuizCommandTable",setup(s){return(t,o)=>(l(),i("div",wq,[e("div",Cq,[t.commands.length>0?(l(),i("table",Sq,[e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"cursor-pointer",onClick:o[0]||(o[0]=n=>t.loadAndOrder("id"))},"#"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[1]||(o[1]=n=>t.loadAndOrder("title"))},"Название"),jq,e("th",{scope:"col",class:"cursor-pointer",onClick:o[2]||(o[2]=n=>t.loadAndOrder("description"))},"Описание"),qq])]),e("tbody",null,[(l(!0),i(g,null,y(t.commands,(n,a)=>(l(),i("tr",{class:b({"border-info":n.deleted_at==null,"border-danger":n.deleted_at!=null})},[e("th",zq,u(n.id),1),e("td",{onClick:d=>t.selectQuizCommand(n)},u(n.title||"Не указано"),9,Vq),e("td",null,u((n.players||[]).length),1),e("td",null,u(n.description||"Не указано"),1),e("td",null,[n.id?(l(),i("div",Pq,[Oq,e("ul",Uq,[n.deleted_at==null?(l(),i("li",Aq,[e("a",{class:"dropdown-item",onClick:d=>t.removeQuizCommand(n.id),href:"javascript:void(0)"},"Удалить",8,Iq)])):r("",!0)])])):r("",!0)])],2))),256))])])):(l(),i("p",Qq,"На текущий момент нет ни одной созданной команды"))]),e("div",Tq,[t.paginate_object?(l(),$(j,{key:0,onPagination_page:t.nextQuizCommand,pagination:t.paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])]))}}),Mq={class:"row"},Dq={class:"col-12"},Eq={key:0,class:"table"},Lq=e("th",{scope:"col"},"Название квиза",-1),Kq=e("th",{scope:"col"},"Название команды",-1),Nq=e("th",{scope:"col"},"Число участников",-1),Jq=e("th",{scope:"col"},"Результат",-1),Yq=e("th",{scope:"col"},"Действие",-1),Hq={scope:"row"},Gq=["onClick"],Wq={key:0},Xq=e("td",null,"-",-1),Zq={key:0,class:"dropdown"},xq=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),ez={class:"dropdown-menu"},tz={key:0},sz=["onClick"],oz={key:1},lz={class:"col-12"},iz={props:["bot","quizId"],data(){return{direction:"desc",order:"updated_at",show:!0,is_group:!1,loading:!0,results:[],search:null,paginate_object:null}},computed:{...C(["getQuizResults","getQuizResultsPaginateObject"])},mounted(){this.loadQuizResults()},methods:{nextQuizResult(s){this.loadQuizResults(s)},selectQuizResult(s){this.$emit("select",s),this.$notify("Вопрос успешно выбран")},removeQuizResult(s){this.loading=!0,this.$store.dispatch("removeQuizResult",{quizResultId:s}).then(t=>{this.loading=!1,this.loadQuizResults(0),this.$notify("Вопрос успешно удален")}).catch(()=>{this.loading=!1,this.$notify("Вопрос удаления сервиса")})},loadAndOrder(s){this.order=s,this.direction=this.direction==="desc"?"asc":"desc",this.loadQuizResults(0)},loadQuizResults(s=0){this.loading=!0,this.$store.dispatch("loadQuizResults",{dataObject:{quiz_id:this.quizId,bot_id:this.bot.id||null,search:this.search,order:this.order,direction:this.direction},page:s,size:100}).then(t=>{this.loading=!1,this.results=this.getQuizResults,this.paginate_object=this.getQuizResultsPaginateObject}).catch(()=>{this.loading=!1})}}},nz=Object.assign(iz,{__name:"QuizResultTable",setup(s){return(t,o)=>(l(),i("div",Mq,[e("div",Dq,[t.results.length>0?(l(),i("table",Eq,[e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"cursor-pointer",onClick:o[0]||(o[0]=n=>t.loadAndOrder("id"))},"#"),Lq,Kq,Nq,e("th",{scope:"col",class:"cursor-pointer",onClick:o[1]||(o[1]=n=>t.loadAndOrder("points"))},"Баллы"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[2]||(o[2]=n=>t.loadAndOrder("times"))},"Время"),Jq,Yq])]),e("tbody",null,[(l(!0),i(g,null,y(t.results,(n,a)=>(l(),i("tr",{class:b({"border-info":n.deleted_at==null,"border-danger":n.deleted_at!=null})},[e("th",Hq,u(n.id),1),e("td",{onClick:d=>t.selectQuizResult(n)},u(n.quiz.title||"Не указано"),9,Gq),e("td",null,[n.command?(l(),i("span",Wq,u(n.command.title||"Не указано"),1)):r("",!0)]),e("td",null,u((n.command.players||[]).length),1),e("td",null,u(n.points||"Не указано"),1),e("td",null,u(n.times||"Не указано"),1),Xq,e("td",null,[n.id?(l(),i("div",Zq,[xq,e("ul",ez,[n.deleted_at==null?(l(),i("li",tz,[e("a",{class:"dropdown-item",onClick:d=>t.removeQuizResult(n.id),href:"javascript:void(0)"},"Удалить",8,sz)])):r("",!0)])])):r("",!0)])],2))),256))])])):(l(),i("p",oz,"На текущий момент нет ни одного созданного вопроса"))]),e("div",lz,[t.paginate_object?(l(),$(j,{key:0,onPagination_page:t.nextQuizResult,pagination:t.paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])]))}}),az={key:0,class:"py-2"},dz={class:"row"},rz={class:"col-12"},cz={key:1,class:"py-2"},uz={class:"row"},mz={class:"col-12"},_z={key:2,class:"py-2"},hz={class:"row"},pz={class:"col-12"},bz={class:"nav nav-tabs justify-content-center"},fz={key:0,class:"row py-3"},gz={class:"col-12"},vz={key:1,class:"row py-3"},$z={class:"col-12"},yz={class:"col-12 py-3"},kz=e("h4",null,"Доступные вопросы",-1),Fz={key:2,class:"row"},wz={class:"col-12"},Cz={class:"col-12 py-3"},Sz=e("h4",null,"Команды участники квиза",-1),jz={key:3,class:"row"},qz={class:"col-12 py-3"},zz=e("h4",null,"Статистика",-1),Vz={key:4,class:"row"},Pz=e("div",{class:"col-12"},null,-1),Oz=e("div",{class:"col-12 py-3"},[e("h4",null,"Отзывы к событию")],-1),Uz=[Pz,Oz],Az={props:["bot"],data(){return{part:0,tab:0,loadTable:!1,loadQuizCommand:!1,loadQuizQuestion:!1,loadQuizQuestionTable:!1,loadQuizCommandTable:!1,loadQuizResult:!1,loadForm:!1,selectedQuiz:null,selectedQuizQuestion:null,selectedQuizCommand:null,selectedQuizResult:null}},mounted(){},methods:{callbackCommandForm(){this.loadQuizCommandTable=!0,this.$nextTick(()=>{this.loadQuizCommandTable=!1})},callbackQuestionForm(){this.loadQuizQuestionTable=!0,this.$nextTick(()=>{this.loadQuizQuestionTable=!1})},callbackForm(){this.loadTable=!0,this.part=0,this.$nextTick(()=>{this.loadTable=!1})},createQuiz(){this.part=2},selectQuizResult(s){this.loadQuizResult=!0,this.$nextTick(()=>{this.loadQuizResult=!1,this.selectedQuizResult=s})},selectQuizCommand(s){this.loadQuizCommand=!0,this.$nextTick(()=>{this.loadQuizCommand=!1,this.selectedQuizCommand=s})},selectQuizQuestion(s){this.loadQuizQuestion=!0,this.$nextTick(()=>{this.loadQuizQuestion=!1,this.selectedQuizQuestion=s})},selectQuiz(s){this.loadForm=!0,this.$nextTick(()=>{this.loadForm=!1,this.selectedQuiz=s,this.part=1,this.tab=0})}}},Iz=Object.assign(Az,{__name:"Quizzes",setup(s){return(t,o)=>(l(),i(g,null,[t.part===0?(l(),i("div",az,[e("div",dz,[e("div",rz,[e("button",{type:"button",onClick:o[0]||(o[0]=(...n)=>t.createQuiz&&t.createQuiz(...n)),class:"btn btn-primary"}," Создать новый квиз ")])]),t.loadTable?r("",!0):(l(),$(u9,{key:0,onCreate:t.createQuiz,onSelect:t.selectQuiz,bot:s.bot},null,8,["onCreate","onSelect","bot"]))])):r("",!0),t.part===2?(l(),i("div",cz,[e("div",uz,[e("div",mz,[e("button",{type:"button",onClick:o[1]||(o[1]=n=>t.part=0),class:"btn btn-outline-primary"}," Назад ")])]),t.loadForm?r("",!0):(l(),$(x,{key:0,onCallback:t.callbackForm,bot:s.bot},null,8,["onCallback","bot"]))])):r("",!0),t.part===1?(l(),i("div",_z,[e("div",hz,[e("div",pz,[e("button",{type:"button",onClick:o[2]||(o[2]=n=>t.part=0),class:"btn btn-outline-primary"}," Назад ")])]),e("ul",bz,[e("li",{class:"nav-item",onClick:o[3]||(o[3]=n=>t.tab=0)},[e("a",{class:b(["nav-link",{active:t.tab===0}]),"aria-current":"page",href:"javascript:void(0)"},"Информация о квизе",2)]),e("li",{class:"nav-item",onClick:o[4]||(o[4]=n=>t.tab=1)},[e("a",{class:b(["nav-link",{active:t.tab===1}]),href:"javascript:void(0)"},"Вопросы квиза",2)]),e("li",{class:"nav-item",onClick:o[5]||(o[5]=n=>t.tab=2)},[e("a",{class:b(["nav-link",{active:t.tab===2}]),href:"javascript:void(0)"},"Команды на квизе",2)]),e("li",{class:"nav-item",onClick:o[6]||(o[6]=n=>t.tab=3)},[e("a",{class:b(["nav-link",{active:t.tab===3}]),href:"javascript:void(0)"},"Командная статистика",2)])]),t.tab===0?(l(),i("div",fz,[e("div",gz,[t.loadForm?r("",!0):(l(),$(x,{key:0,onCallback:t.callbackForm,quiz:t.selectedQuiz,bot:s.bot},null,8,["onCallback","quiz","bot"]))])])):r("",!0),t.tab===1?(l(),i("div",vz,[e("div",$z,[t.loadQuizQuestion?r("",!0):(l(),$(vj,{key:0,question:t.selectedQuizQuestion,"quiz-id":t.selectedQuiz.id,onCallback:t.callbackQuestionForm,bot:s.bot},null,8,["question","quiz-id","onCallback","bot"]))]),e("div",yz,[kz,t.loadQuizQuestionTable?r("",!0):(l(),$(Rj,{key:0,"quiz-id":t.selectedQuiz.id,onSelect:t.selectQuizQuestion,bot:s.bot},null,8,["quiz-id","onSelect","bot"]))])])):r("",!0),t.tab===2?(l(),i("div",Fz,[e("div",wz,[t.loadQuizCommand?r("",!0):(l(),$(Fq,{key:0,command:t.selectedQuizCommand,"quiz-id":t.selectedQuiz.id,onCallback:t.callbackCommandForm,bot:s.bot},null,8,["command","quiz-id","onCallback","bot"]))]),e("div",Cz,[Sz,t.loadQuizCommandTable?r("",!0):(l(),$(Rq,{key:0,"quiz-id":t.selectedQuiz.id,onSelect:t.selectQuizCommand,bot:s.bot},null,8,["quiz-id","onSelect","bot"]))])])):r("",!0),t.tab===3?(l(),i("div",jz,[e("div",qz,[zz,f(nz,{"quiz-id":t.selectedQuiz.id,onSelect:t.selectQuizResult,bot:s.bot},null,8,["quiz-id","onSelect","bot"])])])):r("",!0),t.tab===4?(l(),i("div",Vz,Uz)):r("",!0)])):r("",!0)],64))}}),Qz={class:"row"},Tz={class:"col-12 mb-3 d-flex align-items-center"},Bz={class:"dropdown mr-2"},Rz={class:"btn btn-info dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Mz={key:0},Dz={key:1},Ez={class:"dropdown-menu"},Lz=["onClick"],Kz={class:"dropdown-item",href:"#"},Nz=e("p",{class:"mb-0"}," - тип пункта меню",-1),Jz={class:"col-12 col-md-12 mb-3"},Yz={class:"form-label",id:"service-title"},Hz=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Gz=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Wz={class:"col-12 mb-3"},Xz={class:"form-label",id:"service-description"},Zz=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),xz=e("div",null," Краткая информация о команде ",-1),eV=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),tV={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},sV={class:"col-12 mb-3"},oV={class:"form-label",id:"service-input_message_content"},lV=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),iV=e("div",null," Текст, который будет в сообщении после выбора данного пункта меню ",-1),nV=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),aV={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},dV={class:"col-12 mb-3"},rV={class:"form-check"},cV=e("label",{class:"form-check-label",for:"need_keyboard"}," Нужна клавиатура к тексту ",-1),uV={key:0,class:"col-12 mb-3"},mV={class:"card"},_V={class:"card-body"},hV={class:"form-check"},pV=e("label",{class:"form-check-label",for:"need_show_inline_template_selector"}," Выбрать клавиатуру из шаблона ",-1),bV={class:"col-12 mb-3"},fV={class:"form-check"},gV=e("label",{class:"form-check-label",for:"need_custom_settings"}," Нужны дополнительные настройки ",-1),vV={class:"col-12"},$V={key:0,class:"card mb-2"},yV={class:"card-header d-flex justify-content-between align-items-center"},kV=e("h6",null,"Дополнительная конфигурация",-1),FV={class:"card-body"},wV={class:"row mb-2"},CV={class:"col-5"},SV={class:"form-label",id:"service-title"},jV=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),qV=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),zV=["onUpdate:modelValue"],VV={class:"col-5"},PV={class:"form-label",id:"service-title"},OV=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),UV=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),AV=["onUpdate:modelValue"],IV={class:"col-2 d-flex flex-column justify-content-end align-items-center"},QV=["onClick"],TV={key:1,class:"row mb-2"},BV=e("div",{class:"col-12"},[e("div",{class:"alert alert-info",role:"alert"}," Вы еще не добавили ни одной дополнительной настройки ")],-1),RV=[BV],MV=e("div",{class:"row"},[e("div",{class:"col-12"},[e("button",{type:"submit",class:"btn btn-outline-primary w-100"},"Сохранить пункт меню ")])],-1),DV={props:["item"],data(){return{need_custom_settings:!1,need_keyboard:!1,need_show_inline_template_selector:!1,types:[{title:"Текст",value:0},{title:"Фото",value:1}],itemForm:{id:null,type:0,title:null,description:null,input_message_content:null,inline_keyboard_id:null,inline_keyboard:{menu:null},custom_settings:[]}}},computed:{preparedTypeTile(){return this.types.filter(s=>s.value==this.itemForm.type)[0]||null},uuid(){return Ce()}},watch:{itemForm:{handler(s){this.need_reset=!0},deep:!0}},mounted(){this.item&&this.$nextTick(()=>{console.log("menu",this.item.inline_keyboard),this.itemForm={id:this.item.id||uuid,type:this.item.type||0,title:this.item.title||null,description:this.item.description||null,input_message_content:this.item.input_message_content||null,need_keyboard:this.item.title||!1,inline_keyboard_id:this.item.inline_keyboard_id||null,inline_keyboard:this.item.inline_keyboard?this.item.inline_keyboard:{menu:null},custom_settings:this.item.custom_settings||[]},this.itemForm.inline_keyboard&&(this.need_keyboard=!0),this.itemForm.custom_settings&&(this.need_custom_settings=!0)})},methods:{submitForm(){this.$emit("callback",this.itemForm),this.itemForm={id:null,type:0,title:null,description:null,input_message_content:null,inline_keyboard_id:null,inline_keyboard:{menu:null},custom_settings:[]},this.need_keyboard=!1,this.need_custom_settings=!1,this.need_show_inline_template_selector=!1},addCustomSettings(){this.itemForm.custom_settings.push({key:null,value:null})},removeCustomSetting(s){this.itemForm.custom_settings.splice(s,1)},selectInlineKeyboard(s){console.log("selectInlineKeyboard",s),this.itemForm.inline_keyboard={id:null,menu:s,slug:null},this.need_show_inline_template_selector=!1}}},EV=Object.assign(DV,{__name:"InlineQueryItemForm",setup(s){return(t,o)=>{const n=q("Popper");return l(),i("form",{onSubmit:o[7]||(o[7]=S((...a)=>t.submitForm&&t.submitForm(...a),["prevent"])),class:"mb-2"},[e("div",Qz,[e("div",Tz,[e("div",Bz,[e("button",Rz,[t.itemForm.type?(l(),i("span",Mz,u(t.preparedTypeTile.title),1)):(l(),i("span",Dz,"Тип поля"))]),e("ul",Ez,[(l(!0),i(g,null,y(t.types,a=>(l(),i("li",{onClick:d=>t.itemForm.type=a.value},[e("a",Kz,u(a.title||"Не указан"),1)],8,Lz))),256))])]),Nz]),e("div",Jz,[e("label",Yz,[f(n,{content:"Заголовок"},{default:v(()=>[Hz]),_:1}),m(" Заголовок "),Gz]),c(e("input",{type:"text",class:"form-control",placeholder:"Заголовок","aria-label":"Заголовок","onUpdate:modelValue":o[0]||(o[0]=a=>t.itemForm.title=a),"aria-describedby":"title",required:""},null,512),[[h,t.itemForm.title]])]),e("div",Wz,[e("label",Xz,[f(n,null,{content:v(()=>[xz]),default:v(()=>[Zz]),_:1}),m(" Описание команду "),eV,t.itemForm.description?(l(),i("small",tV," Длина текста "+u(t.itemForm.description.length)+" / 255",1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Описание команды","aria-label":"Описание команды",maxlength:"255","onUpdate:modelValue":o[1]||(o[1]=a=>t.itemForm.description=a),"aria-describedby":"service-description",required:""},`
                    `,512),[[h,t.itemForm.description]])]),e("div",sV,[e("label",oV,[f(n,null,{content:v(()=>[iV]),default:v(()=>[lV]),_:1}),m(" Текст после выбора "),nV,t.itemForm.input_message_content?(l(),i("small",aV," Длина текста "+u(t.itemForm.input_message_content.length)+" / 255",1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст поста","aria-label":"Текст поста",maxlength:"255","onUpdate:modelValue":o[2]||(o[2]=a=>t.itemForm.input_message_content=a),"aria-describedby":"service-input_message_content",required:""},`
                    `,512),[[h,t.itemForm.input_message_content]])]),e("div",dV,[e("div",rV,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[3]||(o[3]=a=>t.need_keyboard=a),type:"checkbox",id:"need_keyboard"},null,512),[[k,t.need_keyboard]]),cV])]),t.need_keyboard?(l(),i("div",uV,[e("div",mV,[e("div",_V,[e("div",hV,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[4]||(o[4]=a=>t.need_show_inline_template_selector=a),type:"checkbox",id:"need_show_inline_template_selector"},null,512),[[k,t.need_show_inline_template_selector]]),pV]),t.need_show_inline_template_selector?(l(),$(T,{key:0,class:"mb-2",type:"inline",onSelect:t.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(l(),$(A,{key:1,type:"inline",onSave:t.selectInlineKeyboard,"edited-keyboard":t.itemForm.inline_keyboard.menu},null,8,["onSave","edited-keyboard"]))])])])):r("",!0),e("div",bV,[e("div",fV,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[5]||(o[5]=a=>t.need_custom_settings=a),type:"checkbox",id:"need_custom_settings"},null,512),[[k,t.need_custom_settings]]),gV])]),e("div",vV,[t.need_custom_settings?(l(),i("div",$V,[e("div",yV,[kV,e("button",{type:"button",onClick:o[6]||(o[6]=(...a)=>t.addCustomSettings&&t.addCustomSettings(...a)),class:"btn btn-outline-primary"},"Добавить настройку ")]),e("div",FV,[t.itemForm.custom_settings.length>0?(l(!0),i(g,{key:0},y(t.itemForm.custom_settings,(a,d)=>(l(),i("div",wV,[e("div",CV,[e("label",SV,[f(n,{content:"Ключ"},{default:v(()=>[jV]),_:1}),m(" Ключ "),qV]),c(e("input",{type:"text",class:"form-control",placeholder:"Ключ","aria-label":"Ключ",min:"0","onUpdate:modelValue":_=>t.itemForm.custom_settings[d].key=_,"aria-describedby":"price",required:""},null,8,zV),[[h,t.itemForm.custom_settings[d].key]])]),e("div",VV,[e("label",PV,[f(n,{content:"Значение"},{default:v(()=>[OV]),_:1}),m(" Значение "),UV]),c(e("input",{type:"text",class:"form-control",placeholder:"Значение","aria-label":"Значение",min:"0","onUpdate:modelValue":_=>t.itemForm.custom_settings[d].value=_,"aria-describedby":"price",required:""},null,8,AV),[[h,t.itemForm.custom_settings[d].value]])]),e("div",IV,[e("button",{onClick:_=>t.removeCustomSetting(d),class:"btn btn-outline-danger"},"Удалить ",8,QV)])]))),256)):(l(),i("div",TV,RV))])])):r("",!0)])]),MV],32)}}}),LV={class:"row"},KV={class:"col-12 mb-3"},NV={class:"form-label",id:"service-title"},JV=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),YV=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),HV={class:"col-12 mb-3"},GV={class:"form-label",id:"service-description"},WV=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),XV=e("div",null," Краткая информация о команде ",-1),ZV=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),xV={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},eP={class:"col-12 mb-2"},tP={key:0},sP={class:"table-responsive"},oP={class:"table"},lP=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Название"),e("th",{scope:"col"},"Описание"),e("th",{scope:"col"},"Текст"),e("th",{scope:"col"},"Есть клавиатура"),e("th",{scope:"col"},"Есть доп настройки"),e("th",{scope:"col"},"Действие")])],-1),iP=["onClick"],nP=["onClick"],aP=["onClick"],dP={key:0,class:"fa-solid fa-check text-success"},rP={key:1,class:"fa-solid fa-xmark text-danger"},cP={key:0,class:"fa-solid fa-check text-success"},uP={key:1,class:"fa-solid fa-xmark text-danger"},mP={class:"dropdown"},_P=e("button",{class:"btn btn-link",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-bars"})],-1),hP={class:"dropdown-menu"},pP=["onClick"],bP={class:"row"},fP={class:"col-12"},gP={type:"submit",class:"btn btn-outline-success w-100 p-3"},vP={key:0},$P={key:1},yP={class:"modal fade",id:"inline-query-item-editor",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},kP={class:"modal-dialog modal-lg"},FP={class:"modal-content"},wP={class:"modal-body"},CP={props:["bot","inlineQuery"],data(){return{load:!1,selectedInlineQueryItem:null,inlineQueryModal:null,inlineQueryForm:{id:null,command:null,description:null,items:[]}}},watch:{inlineQueryForm:{handler(s){this.need_reset=!0},deep:!0}},mounted(){this.inlineQueryModal=new bootstrap.Modal(document.getElementById("inline-query-item-editor"),{}),this.inlineQuery&&this.$nextTick(()=>{this.inlineQueryForm={id:this.inlineQuery.id||null,command:this.inlineQuery.command||null,description:this.inlineQuery.description||null,items:this.inlineQuery.items||[]}})},methods:{removeInlineQueryItem(s){const t=this.inlineQueryForm.items[s];this.inlineQueryForm.items.splice(s,1),this.$store.dispatch("removeInlineQueryItem",{queryItemId:t.id}).then(o=>{this.$notify("Команда успешно удалена")}).catch(o=>{this.$notify("Ошибка удаления команды")})},openModal(){this.load=!0,this.$nextTick(()=>{this.selectedInlineQueryItem=null,this.load=!1,this.inlineQueryModal.show()})},addInlineQueryItem(s){let t=this.inlineQueryForm.items.findIndex(o=>o.id===s.id);t===-1?this.inlineQueryForm.items.push(s):this.inlineQueryForm.items[t]=s},selectInlineQueryItem(s){this.load=!0,this.$nextTick(()=>{this.selectedInlineQueryItem=s,this.load=!1,this.inlineQueryModal.show()})},submitForm(){let s=new FormData;Object.keys(this.inlineQueryForm).forEach(t=>{const o=this.inlineQueryForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),s.append("bot_id",this.bot.id),this.$store.dispatch("storeInlineQuery",{inlineQueryForm:s}).then(t=>{this.inlineQueryForm={id:null,command:null,description:null,items:[]},this.$emit("callback",t.data),this.$notify("Команда успешно создана")}).catch(t=>{this.$notify("Ошибка создания команды"),this.$emit("callback",response.data)})}}},SP=Object.assign(CP,{__name:"InlineQueryForm",setup(s){return(t,o)=>{const n=q("Popper");return l(),i(g,null,[e("form",{onSubmit:o[3]||(o[3]=S((...a)=>t.submitForm&&t.submitForm(...a),["prevent"]))},[e("div",LV,[e("div",KV,[e("label",NV,[f(n,{content:"Название оказываемой услуги"},{default:v(()=>[JV]),_:1}),m(" Название команды "),YV]),c(e("input",{type:"text",class:"form-control",placeholder:"Команда","aria-label":"Команда","onUpdate:modelValue":o[0]||(o[0]=a=>t.inlineQueryForm.command=a),maxlength:"255","aria-describedby":"service-title",required:""},null,512),[[h,t.inlineQueryForm.command]])]),e("div",HV,[e("label",GV,[f(n,null,{content:v(()=>[XV]),default:v(()=>[WV]),_:1}),m(" Описание команду "),ZV,t.inlineQueryForm.description?(l(),i("small",xV," Длина текста "+u(t.inlineQueryForm.description.length)+" / 255",1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Описание команды","aria-label":"Описание команды",maxlength:"255","onUpdate:modelValue":o[1]||(o[1]=a=>t.inlineQueryForm.description=a),"aria-describedby":"service-description",required:""},`
                    `,512),[[h,t.inlineQueryForm.description]])]),e("div",eP,[e("button",{type:"button",class:"btn btn-outline-primary",onClick:o[2]||(o[2]=(...a)=>t.openModal&&t.openModal(...a))}," Добавление пункта меню ")]),t.inlineQueryForm.items.length>0?(l(),i("div",tP,[e("div",sP,[e("table",oP,[lP,e("tbody",null,[(l(!0),i(g,null,y(t.inlineQueryForm.items,(a,d)=>(l(),i("tr",null,[e("td",{onClick:_=>t.selectInlineQueryItem(a)},u(a.title||"-"),9,iP),e("td",{onClick:_=>t.selectInlineQueryItem(a)},u(a.description||"-"),9,nP),e("td",{onClick:_=>t.selectInlineQueryItem(a)},u(a.input_message_content||"-"),9,aP),e("td",null,[a.inline_keyboard?(l(),i("i",dP)):(l(),i("i",rP))]),e("td",null,[(a.custom_settings||[]).length>0?(l(),i("i",cP)):(l(),i("i",uP))]),e("td",null,[e("div",mP,[_P,e("ul",hP,[e("li",null,[e("a",{class:"dropdown-item",onClick:_=>t.removeInlineQueryItem(d),href:"#"},"Удалить",8,pP)])])])])]))),256))])])])])):r("",!0)]),e("div",bP,[e("div",fP,[e("button",gP,[t.inlineQueryForm.id===null?(l(),i("span",vP,"Создать встроенное меню")):(l(),i("span",$P,"Обновить встроенное меню"))])])])],32),e("div",yP,[e("div",kP,[e("div",FP,[e("div",wP,[t.load?r("",!0):(l(),$(EV,{key:0,item:t.selectedInlineQueryItem,onCallback:t.addInlineQueryItem},null,8,["item","onCallback"]))])])])])],64)}}}),jP={class:"row"},qP={class:"col-12"},zP={key:0,class:"table"},VP=e("th",{scope:"col",class:"cursor-pointer"},"Кол-во пунктов меню",-1),PP=e("th",{scope:"col"},"Действие",-1),OP={scope:"row"},UP=["onClick"],AP={key:0,class:"dropdown"},IP=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),QP={class:"dropdown-menu"},TP={key:0},BP=["onClick"],RP={key:1},MP={class:"col-12"},DP={props:["bot"],data(){return{direction:"desc",order:"updated_at",show:!0,loading:!0,queries:[],search:null,paginate_object:null}},computed:{...C(["getInlineQueries","getInlineQueriesPaginateObject"])},mounted(){this.loadInlineQueries()},methods:{nextInlineQuery(s){this.loadInlineQueries(s)},selectInlineQuery(s){this.$emit("select",s),this.$notify("Встроенное меню успешно выбрано")},removeInlineQuery(s){this.loading=!0,this.$store.dispatch("removeInlineQuery",{queryId:s}).then(t=>{this.loading=!1,this.loadInlineQueries(0),this.$notify("Встроенное меню успешно удалено")}).catch(()=>{this.loading=!1,this.$notify("Ошибка удаления встроенного меню")})},loadAndOrder(s){this.order=s,this.direction=this.direction==="desc"?"asc":"desc",this.loadInlineQueries(0)},loadInlineQueries(s=0){this.loading=!0,this.$store.dispatch("loadInlineQueries",{dataObject:{bot_id:this.bot.id||null,search:this.search,order:this.order,direction:this.direction},page:s,size:100}).then(t=>{this.loading=!1,this.queries=this.getInlineQueries,this.paginate_object=this.getInlineQueriesPaginateObject}).catch(()=>{this.loading=!1})}}},EP=Object.assign(DP,{__name:"InlineQueryTable",setup(s){return(t,o)=>(l(),i("div",jP,[e("div",qP,[t.queries.length>0?(l(),i("table",zP,[e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"cursor-pointer",onClick:o[0]||(o[0]=n=>t.loadAndOrder("id"))},"#"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[1]||(o[1]=n=>t.loadAndOrder("command"))},"Команда"),VP,e("th",{scope:"col",class:"cursor-pointer",onClick:o[2]||(o[2]=n=>t.loadAndOrder("description"))},"Описание"),PP])]),e("tbody",null,[(l(!0),i(g,null,y(t.queries,(n,a)=>(l(),i("tr",{class:b({"border-info":n.deleted_at==null,"border-danger":n.deleted_at!=null})},[e("th",OP,u(n.id),1),e("td",{onClick:d=>t.selectInlineQuery(n)},u(n.command||"Не указано"),9,UP),e("td",null,u(n.items.length),1),e("td",null,u(n.description||"Не указано"),1),e("td",null,[n.id?(l(),i("div",AP,[IP,e("ul",QP,[n.deleted_at==null?(l(),i("li",TP,[e("a",{class:"dropdown-item",onClick:d=>t.removeInlineQuery(n.id),href:"javascript:void(0)"},"Удалить",8,BP)])):r("",!0)])])):r("",!0)])],2))),256))])])):(l(),i("p",RP,"На текущий момент нет ни одной созданной команды"))]),e("div",MP,[t.paginate_object?(l(),$(j,{key:0,onPagination_page:t.nextInlineQuery,pagination:t.paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])]))}}),LP={class:"my-2"},KP={key:0,class:"row mb-2"},NP={class:"col-12"},JP={key:3,class:"spinner-border",role:"status"},YP=e("span",{class:"visually-hidden"},"Loading...",-1),HP=[YP],GP={props:["bot"],data(){return{load:!1,selectedInlineQuery:null}},mounted(){},methods:{selectInlineQuery(s){this.load=!0,this.$nextTick(()=>{this.selectedInlineQuery=s,this.load=!1})},reloadTable(){this.load=!0,this.$nextTick(()=>{this.load=!1})}}},WP=Object.assign(GP,{__name:"InlineQuery",setup(s){return(t,o)=>(l(),i("div",LP,[t.selectedInlineQuery!=null?(l(),i("div",KP,[e("div",NP,[e("button",{type:"button",onClick:o[0]||(o[0]=n=>t.selectInlineQuery(null)),class:"btn btn-primary"}," Добавить новое встроенное меню")])])):r("",!0),t.load?r("",!0):(l(),$(SP,{key:1,bot:s.bot,onCallback:t.reloadTable,"inline-query":t.selectedInlineQuery},null,8,["bot","onCallback","inline-query"])),t.load?r("",!0):(l(),$(EP,{key:2,bot:s.bot,onSelect:t.selectInlineQuery},null,8,["bot","onSelect"])),t.load?(l(),i("div",JP,HP)):r("",!0)]))}}),XP={key:0,class:"py-2"},ZP={class:"row"},xP={class:"col-12"},eO={key:1,class:"py-2"},tO={class:"row"},sO={class:"col-12"},oO={key:2,class:"py-2"},lO={class:"row"},iO={class:"col-12"},nO={class:"nav nav-tabs justify-content-center"},aO={key:0,class:"row py-3"},dO={class:"col-12"},rO={key:1,class:"row py-3"},cO=e("div",{class:"col-12 py-3"},[e("h4",null,"Статистика")],-1),uO=[cO],mO={props:["bot"],data(){return{part:0,tab:0,selectedPromoCode:null,loadForm:!1,loadTable:!1}},methods:{callbackForm(){this.loadTable=!0,this.selectedPromoCode=null,this.part=0,this.$nextTick(()=>{this.loadTable=!1})},createPromoCode(){this.part=2},selectPromoCode(s){this.loadForm=!0,this.$nextTick(()=>{this.loadForm=!1,this.selectedPromoCode=s,this.part=1,this.tab=0})}}},_O=Object.assign(mO,{__name:"PromoCodes",setup(s){return(t,o)=>(l(),i(g,null,[t.part===0?(l(),i("div",XP,[e("div",ZP,[e("div",xP,[e("button",{type:"button",onClick:o[0]||(o[0]=(...n)=>t.createPromoCode&&t.createPromoCode(...n)),class:"btn btn-primary"}," Создать новый промокод ")])]),t.loadTable?r("",!0):(l(),$(Fe,{key:0,onCreate:t.createPromoCode,onSelect:t.selectPromoCode,bot:s.bot},null,8,["onCreate","onSelect","bot"]))])):r("",!0),t.part===2?(l(),i("div",eO,[e("div",tO,[e("div",sO,[e("button",{type:"button",onClick:o[1]||(o[1]=n=>t.part=0),class:"btn btn-outline-primary"}," Назад ")])]),t.loadForm?r("",!0):(l(),$(G,{key:0,onCallback:t.callbackForm,bot:s.bot},null,8,["onCallback","bot"]))])):r("",!0),t.part===1?(l(),i("div",oO,[e("div",lO,[e("div",iO,[e("button",{type:"button",onClick:o[2]||(o[2]=n=>t.part=0),class:"btn btn-outline-primary"}," Назад ")])]),e("ul",nO,[e("li",{class:"nav-item",onClick:o[3]||(o[3]=n=>t.tab=0)},[e("a",{class:b(["nav-link",{active:t.tab===0}]),"aria-current":"page",href:"javascript:void(0)"},"Информация о Промокоде",2)]),e("li",{class:"nav-item",onClick:o[4]||(o[4]=n=>t.tab=1)},[e("a",{class:b(["nav-link",{active:t.tab===1}]),href:"javascript:void(0)"},"Статистика использования",2)])]),t.tab===0?(l(),i("div",aO,[e("div",dO,[t.loadForm?r("",!0):(l(),$(G,{key:0,onCallback:t.callbackForm,code:t.selectedPromoCode,bot:s.bot},null,8,["onCallback","code","bot"]))])])):r("",!0),t.tab===1?(l(),i("div",rO,uO)):r("",!0)])):r("",!0)],64))}}),hO={props:["data"],data(){return{hasConnect:!1,bot:null,frontPadForm:{hook_url:null,channel:null,affiliate:null,point:null,token:null,statuses:[{value:null,key:"new",title:"Новый"}],bot_id:null,pays:[{value:null,key:"cash",title:"Наличные"},{value:null,key:"card",title:"Перевод на карту"}]}}},computed:{...C(["getCurrentBot"])},mounted(){this.bot=this.getCurrentBot,this.data?this.$nextTick(()=>{this.frontPadForm.hook_url=this.data.hook_url||null,this.frontPadForm.channel=this.data.channel||null,this.frontPadForm.affiliate=this.data.affiliate||null,this.frontPadForm.point=this.data.point||null,this.frontPadForm.token=this.data.token||null,this.frontPadForm.bot_id=this.data.bot_id||this.bot.id||null,this.data.pays!=null&&(this.frontPadForm.pays=this.data.pays),this.data.statuses!=null&&(this.frontPadForm.statuses=this.data.statuses)}):this.frontPadForm.bot_id=this.bot.id||null},methods:{submit(){let s=new FormData;Object.keys(this.frontPadForm).forEach(t=>{const o=this.frontPadForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.$store.dispatch("saveFrontPad",{frontPadForm:s}).then(t=>{this.$notify("Данные CRM успешно сохранены")}).catch(t=>{})}}},pO={class:"col-md-6 col-12 mb-2"},bO={class:"form-label",id:"token"},fO=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),gO=e("div",null,"Токен интеграции",-1),vO=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),$O={class:"col-md-6 col-12 mb-2"},yO={class:"form-label",id:"channel"},kO=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),FO=e("div",null,'Данные брать из справочника FrontPad "Каналы продаж". Создать канал. Telegram. Указать значение для API',-1),wO={class:"col-md-6 col-12 mb-2"},CO={class:"form-label",id:"affiliate"},SO=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),jO=e("div",null,"Филиал",-1),qO={class:"col-md-6 col-12 mb-2"},zO={class:"form-label",id:"point"},VO=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),PO=e("div",null,"Филиал",-1),OO={class:"col-12"},UO=e("div",{class:"alert alert-info",role:"alert"},' Данные брать из справочника FrontPad "Статусы". Указать значение для API ',-1),AO={key:0,class:"card mb-2 p-0"},IO=e("div",{class:"card-header"},[e("h6",null,"Статусы")],-1),QO={class:"card-body"},TO={class:"table"},BO=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Название"),e("th",{scope:"col"},"Ключ"),e("th",{scope:"col"},"Значение")])],-1),RO=["onUpdate:modelValue"],MO={class:"col-12"},DO=e("div",{class:"alert alert-info",role:"alert"},' Данные брать из справочника FrontPad "Варианты оплат". Указать значение для API ',-1),EO={key:0,class:"card mb-2 p-0"},LO=e("div",{class:"card-header"},[e("h6",null,"Типы оплаты")],-1),KO={class:"card-body"},NO={class:"table"},JO=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Название"),e("th",{scope:"col"},"Ключ"),e("th",{scope:"col"},"Значение")])],-1),YO=["onUpdate:modelValue"],HO=e("div",{class:"col-md-12 col-12"},[e("button",{type:"submit",class:"btn btn-outline-primary p-3 w-100"},[e("i",{class:"fa-solid fa-cloud-arrow-down mr-1"}),m(" Сохранить настройку ")])],-1);function GO(s,t,o,n,a,d){const _=q("Popper");return l(),i("form",{onSubmit:t[4]||(t[4]=S((...p)=>d.submit&&d.submit(...p),["prevent"])),class:"row"},[e("div",pO,[e("label",bO,[f(_,null,{content:v(()=>[gO]),default:v(()=>[fO]),_:1}),m(" Токен интеграции "),vO]),c(e("input",{type:"text",class:"form-control",placeholder:"Токен","aria-label":"Токен","onUpdate:modelValue":t[0]||(t[0]=p=>a.frontPadForm.token=p),"aria-describedby":"token"},null,512),[[h,a.frontPadForm.token]])]),e("div",$O,[e("label",yO,[f(_,null,{content:v(()=>[FO]),default:v(()=>[kO]),_:1}),m(" Канал продаж ")]),c(e("input",{type:"text",class:"form-control",placeholder:"channel","aria-label":"channel","onUpdate:modelValue":t[1]||(t[1]=p=>a.frontPadForm.channel=p),"aria-describedby":"channel"},null,512),[[h,a.frontPadForm.channel]])]),e("div",wO,[e("label",CO,[f(_,null,{content:v(()=>[jO]),default:v(()=>[SO]),_:1}),m(" Филиал ")]),c(e("input",{type:"text",class:"form-control",placeholder:"Филиал","aria-label":"Филиал","onUpdate:modelValue":t[2]||(t[2]=p=>a.frontPadForm.affiliate=p),"aria-describedby":"Филиал"},null,512),[[h,a.frontPadForm.affiliate]])]),e("div",qO,[e("label",zO,[f(_,null,{content:v(()=>[PO]),default:v(()=>[VO]),_:1}),m(" Точка продаж ")]),c(e("input",{type:"text",class:"form-control",placeholder:"Точка продаж","aria-label":"Точка продаж","onUpdate:modelValue":t[3]||(t[3]=p=>a.frontPadForm.point=p),"aria-describedby":"Точка продаж"},null,512),[[h,a.frontPadForm.point]])]),e("div",OO,[UO,a.frontPadForm.statuses?(l(),i("div",AO,[IO,e("div",QO,[e("table",TO,[BO,e("tbody",null,[(l(!0),i(g,null,y(a.frontPadForm.statuses,(p,F)=>(l(),i("tr",null,[e("td",null,u(p.title||"-"),1),e("td",null,u(p.key||"-"),1),e("td",null,[c(e("input",{type:"text",class:"form-control",placeholder:"Статус","aria-label":"Статус","onUpdate:modelValue":w=>a.frontPadForm.statuses[F].value=w,"aria-describedby":"Статус"},null,8,RO),[[h,a.frontPadForm.statuses[F].value]])])]))),256))])])])])):r("",!0)]),e("div",MO,[DO,a.frontPadForm.pays?(l(),i("div",EO,[LO,e("div",KO,[e("table",NO,[JO,e("tbody",null,[(l(!0),i(g,null,y(a.frontPadForm.pays,(p,F)=>(l(),i("tr",null,[e("td",null,u(p.title||"-"),1),e("td",null,u(p.key||"-"),1),e("td",null,[c(e("input",{type:"text",class:"form-control",placeholder:"Статус","aria-label":"Статус","onUpdate:modelValue":w=>a.frontPadForm.pays[F].value=w,"aria-describedby":"Статус"},null,8,YO),[[h,a.frontPadForm.pays[F].value]])])]))),256))])])])])):r("",!0)]),HO],32)}const WO=O(hO,[["render",GO]]);const XO={class:"d-flex custom-dropdown justify-content-between align-items-center"},ZO={class:"btn-group"},xO=e("i",{class:"fa-solid fa-info mr-2"},null,-1),eU=e("i",{class:"fa-solid fa-file mr-2"},null,-1),tU={key:0,class:"btn btn-primary",type:"button","data-bs-toggle":"offcanvas","data-bs-target":"#bot-section-menu","aria-controls":"staticBackdrop"},sU=e("i",{class:"fa-solid fa-screwdriver-wrench p-2 text-primary"},null,-1),oU=[sU],lU={key:0,class:"pb-5 mb-5"},iU={key:1,class:"pb-5 mb-5"},nU={key:2,class:"pb-5 mb-5"},aU={key:3,class:"pb-5 mb-5"},dU={key:4,class:"pb-5 mb-5"},rU={key:5,class:"pb-5 mb-5"},cU={key:6,class:"pb-5 mb-5"},uU={key:7,class:"pb-5 mb-5"},mU={key:8,class:"pb-5 pt-2 mb-5"},_U={key:9,class:"pb-5 mb-5"},hU={key:10,class:"pb-5 mb-5 pt-2"},pU={key:11,class:"pb-5 mb-5"},bU={key:12,class:"pb-5 mb-5 pt-2"},fU={key:13,class:"pb-5 mb-5 pt-2"},gU={key:14,class:"pb-5 mb-5 pt-2"},vU={key:15,class:"row pb-5 mb-5"},$U={key:0,class:"col-12 col-md-12"},yU={key:16,class:"pb-5 mb-5"},kU={class:"offcanvas offcanvas-end","data-bs-scroll":"true","data-bs-backdrop":"false",tabindex:"-1",id:"bot-section-menu","aria-labelledby":"staticBackdropLabel"},FU=e("div",{class:"offcanvas-header"},[e("h5",{class:"offcanvas-title",id:"staticBackdropLabel"},"Меню управления ботом"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"offcanvas","aria-label":"Close"})],-1),wU={class:"offcanvas-body"},CU={class:"list-group list-group-flush bot-section-menu-group"},SU=e("i",{class:"fa-regular fa-newspaper mr-2"},null,-1),jU=e("i",{class:"fa-regular fa-calendar-days mr-2"},null,-1),qU=e("i",{class:"fa-solid fa-q mr-2"},null,-1),zU=e("i",{class:"fa-solid fa-q mr-2"},null,-1),VU=e("i",{class:"fa-solid fa-clipboard-list mr-2"},null,-1),PU=e("i",{class:"fa-solid fa-code mr-2"},null,-1),OU=e("i",{class:"fa-solid fa-keyboard mr-2"},null,-1),UU=e("i",{class:"fa-solid fa-scroll mr-2"},null,-1),AU=e("i",{class:"fa-solid fa-comment-dots mr-2"},null,-1),IU=e("i",{class:"fa-solid fa-users mr-2"},null,-1),QU=e("i",{class:"fa-solid fa-list-check mr-2"},null,-1),TU=e("i",{class:"fa-solid fa-list-check mr-2"},null,-1),BU=e("i",{class:"fa-solid fa-list-check mr-2"},null,-1),RU=e("i",{class:"fa-brands fa-shopify mr-2"},null,-1),MU=e("i",{class:"fa-brands fa-shopify mr-2"},null,-1),DU={props:["bot"],data(){return{page:null,step:0,load:!1,loadPage:!1}},mounted(){this.setStep(localStorage.getItem("cashman_set_botform_step_index")||0)},methods:{botCallbackUpdate(s){this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{}),this.$emit("callback")},hasRole(s){return window.hasRole(s)||!1},setStep(s){this.step=parseInt(s),localStorage.setItem("cashman_set_botform_step_index",s)},pageListCallback(s){this.loadPage=!0,this.page=s,this.$nextTick(()=>{this.loadPage=!1})},pageCallback(s){this.page=s,this.loadPageList=!0,this.$nextTick(()=>{this.loadPageList=!1})},loadCurrentCompany(s=null){this.$store.dispatch("updateCurrentCompany",{company:s}).then(()=>{this.company=this.getCurrentCompany})},companyListCallback(s){this.load=!0,this.loadCurrentCompany(s),this.$nextTick(()=>{this.load=!1})}}},BI=Object.assign(DU,{__name:"BotSection",setup(s){return(t,o)=>(l(),i(g,null,[e("div",XO,[e("div",ZO,[e("button",{type:"button",class:b(["btn btn-primary text-primary",{"bg-primary text-white":t.step==0}]),onClick:o[0]||(o[0]=n=>t.setStep(0))},[xO,m("Информация о боте ")],2),e("button",{type:"button",class:b(["btn btn-primary text-primary",{"bg-primary text-white":t.step==4}]),onClick:o[1]||(o[1]=n=>t.setStep(4))},[eU,m("Страницы (кнопки бота) ")],2)]),t.hasRole("admin")?(l(),i("button",tU,oU)):r("",!0)]),t.step===14?(l(),i("div",lU,[t.load?r("",!0):(l(),$(Iz,{key:0,bot:s.bot},null,8,["bot"]))])):r("",!0),t.step===16?(l(),i("div",iU,[t.load?r("",!0):(l(),$(_O,{key:0,bot:s.bot},null,8,["bot"]))])):r("",!0),t.step===13?(l(),i("div",nU,[t.load?r("",!0):(l(),$($8,{key:0,bot:s.bot},null,8,["bot"]))])):r("",!0),t.step===0?(l(),i("div",aU,[t.load?r("",!0):(l(),$(we,{key:0,onCallback:t.botCallbackUpdate,bot:s.bot},null,8,["onCallback","bot"]))])):r("",!0),t.step===15?(l(),i("div",dU,[t.load?r("",!0):(l(),$(WP,{key:0,bot:s.bot},null,8,["bot"]))])):r("",!0),t.step===7?(l(),i("div",rU,[t.load?r("",!0):(l(),$(e0,{key:0,data:s.bot.amo},null,8,["data"]))])):r("",!0),t.step===17?(l(),i("div",cU,[t.load?r("",!0):(l(),$(WO,{key:0,data:s.bot.frontPad},null,8,["data"]))])):r("",!0),t.step===12?(l(),i("div",uU,[t.load?r("",!0):(l(),$(p0,{key:0,data:s.bot.y_clients},null,8,["data"]))])):r("",!0),t.step===11?(l(),i("div",mU,[t.load?r("",!0):(l(),$(J3,{key:0}))])):r("",!0),t.step===8?(l(),i("div",_U,[t.load?r("",!0):(l(),$(zk,{key:0}))])):r("",!0),t.step===10?(l(),i("div",hU,[t.load?r("",!0):(l(),$(h3,{key:0}))])):r("",!0),t.step===1?(l(),i("div",pU,[t.load?r("",!0):(l(),$(T,{key:0,"select-mode":!1}))])):r("",!0),t.step===6?(l(),i("div",bU,[t.load?r("",!0):(l(),$(de,{key:0}))])):r("",!0),t.step===2?(l(),i("div",fU,[t.load?r("",!0):(l(),$(Ni,{key:0}))])):r("",!0),t.step===3?(l(),i("div",gU,[t.load?r("",!0):(l(),$(D,{key:0}))])):r("",!0),t.step===4?(l(),i("div",vU,[t.load?r("",!0):(l(),i("div",$U,[t.loadPage?r("",!0):(l(),$(s$,{key:0,page:t.page,onCallback:t.pageCallback},null,8,["page","onCallback"]))]))])):r("",!0),t.step===9?(l(),i("div",yU,[f(S0,{bot:s.bot},null,8,["bot"])])):r("",!0),e("div",kU,[FU,e("div",wU,[e("ul",CU,[e("li",null,[e("a",{class:"list-group-item list-group-item-action",href:"#bot-news",onClick:o[2]||(o[2]=n=>t.setStep(9))},[SU,m(" Рассылки")])]),e("li",null,[e("a",{class:"list-group-item list-group-item-action",href:"#bot-appointments",onClick:o[3]||(o[3]=n=>t.setStep(13))},[jU,m("Запись на событие (прием)")])]),e("li",null,[e("a",{class:"list-group-item list-group-item-action",href:"#bot-quizzes",onClick:o[4]||(o[4]=n=>t.setStep(14))},[qU,m("Квизы")])]),e("li",null,[e("a",{class:"list-group-item list-group-item-action",href:"#bot-promo-codes",onClick:o[5]||(o[5]=n=>t.setStep(16))},[zU,m("Промокоды")])]),e("li",null,[e("a",{class:"list-group-item list-group-item-action",href:"#bot-inline-queries",onClick:o[6]||(o[6]=n=>t.setStep(15))},[VU,m("Встраиваемые запросы")])]),e("li",null,[e("a",{class:"list-group-item list-group-item-action",href:"#bot-custom-fields",onClick:o[7]||(o[7]=n=>t.setStep(10))},[PU,m("Настраиваемые поля")])]),e("li",null,[e("a",{class:"list-group-item list-group-item-action",href:"#bot-menu-template",onClick:o[8]||(o[8]=n=>t.setStep(1))},[OU,m("Все клавиатуры в боте")])]),e("li",null,[e("a",{class:"list-group-item list-group-item-action",href:"#bot-slugs",onClick:o[9]||(o[9]=n=>t.setStep(2))},[UU,m("Все скрипты в боте")])]),e("li",null,[e("a",{class:"list-group-item list-group-item-action",href:"#bot-dialogs",onClick:o[10]||(o[10]=n=>t.setStep(6))},[AU,m("Все диалоги в боте")])]),e("li",null,[e("a",{class:"list-group-item list-group-item-action",href:"#bot-users",onClick:o[11]||(o[11]=n=>t.setStep(3))},[IU,m("Все пользователи в боте")])]),e("li",null,[e("a",{class:"list-group-item list-group-item-action",href:"#bot-amo",onClick:o[12]||(o[12]=n=>t.setStep(7))},[QU,m(" AMO CRM")])]),e("li",null,[e("a",{class:"list-group-item list-group-item-action",href:"#bot-front-pad",onClick:o[13]||(o[13]=n=>t.setStep(17))},[TU,m(" FrontPad")])]),e("li",null,[e("a",{class:"list-group-item list-group-item-action",href:"#bot-y-clients",onClick:o[14]||(o[14]=n=>t.setStep(12))},[BU,m(" YClients")])]),e("li",null,[e("a",{class:"list-group-item list-group-item-action",href:"#bot-shop",onClick:o[15]||(o[15]=n=>t.setStep(8))},[RU,m(" Магазин")])]),e("li",null,[e("a",{class:"list-group-item list-group-item-action",href:"#bot-media",onClick:o[16]||(o[16]=n=>t.setStep(11))},[MU,m(" Медиа файлы бота")])])])])])],64))}}),EU={key:0},LU={key:0,class:"row"},KU={class:"col-md-12"},NU=e("h4",null,"Боты в работе",-1),JU={class:"mb-0"},YU={class:"table mb-5"},HU=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"Домен"),e("th",{scope:"col"},"Название"),e("th",{scope:"col"},"Шаблон"),e("th",{scope:"col"},"Дата изменения"),e("th",{scope:"col"},"Действие")])],-1),GU={scope:"row"},WU=["onClick"],XU=["onClick"],ZU={key:0,class:"badge bg-primary"},xU={key:1},eA={class:"d-flex"},tA=["onClick"],sA=e("i",{class:"fa-regular fa-star"},null,-1),oA=[sA],lA=["onClick"],iA=e("i",{class:"fa-solid fa-chevron-down"},null,-1),nA=[iA],aA=["onClick"],dA=e("i",{class:"fa-solid fa-chevron-up"},null,-1),rA=[dA],cA=e("hr",null,null,-1),uA={class:"row"},mA={class:"col-md-12 d-flex flex-column"},_A={class:"d-flex"},hA={class:"dropdown mr-2"},pA=e("button",{class:"btn btn-outline-primary dropdown-toggle",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"}," Фильтры ",-1),bA={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},fA=["onClick"],gA={class:"input-group mb-3"},vA={key:0,class:"mt-2"},$A={class:"badge bg-primary mr-1"},yA=["onClick"],kA=e("i",{class:"fa-solid fa-xmark"},null,-1),FA=[kA],wA={key:1,class:"row"},CA={class:"col-12"},SA=e("h4",null,"Все боты",-1),jA={class:"mb-0"},qA={class:"mb-0"},zA={key:2,class:"row"},VA={class:"col-12 mb-3"},PA={key:0,class:"col-12 mb-3"},OA={class:"table"},UA=e("th",{scope:"col"},"Действие",-1),AA={scope:"row"},IA=["onClick"],QA=["onClick"],TA={key:0,class:"badge bg-primary"},BA={key:1},RA={class:"d-flex"},MA=["onClick"],DA=e("i",{class:"fa-regular fa-star"},null,-1),EA=[DA],LA=["onClick"],KA=e("i",{class:"fa-regular fa-copy"},null,-1),NA=[KA],JA=["onClick"],YA=e("i",{class:"fa-solid fa-boxes-packing"},null,-1),HA=[YA],GA=["onClick"],WA=e("i",{class:"fa-solid fa-box-open"},null,-1),XA=[WA],ZA=["onClick"],xA=e("i",{class:"fa-solid fa-trash-can text-white"},null,-1),eI=[xA],tI={class:"col-lg-4 col-12 mb-3"},sI={class:"card-body"},oI=["onClick"],lI={key:0,class:"badge bg-info"},iI={class:"card-footer d-flex"},nI=["onClick"],aI=e("i",{class:"fa-regular fa-star"},null,-1),dI=[aI],rI=["onClick"],cI=e("i",{class:"fa-regular fa-copy"},null,-1),uI=[cI],mI=["onClick"],_I=e("i",{class:"fa-solid fa-boxes-packing"},null,-1),hI=[_I],pI=["onClick"],bI=e("i",{class:"fa-solid fa-box-open"},null,-1),fI=[bI],gI=["onClick"],vI=e("i",{class:"fa-solid fa-trash-can text-white"},null,-1),$I=[vI],yI={class:"col-12"},kI={key:3,class:"row"},FI=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранной компании нет созданных ботов! ")],-1),wI=[FI],CI={props:["companyId","editor"],data(){return{displayType:1,direction:"desc",order:"updated_at",filters:[{name:"Активные",icon:"fa-brands fa-telegram",slug:"active"},{name:"Архивные",icon:"fa-solid fa-box-archive",slug:"archive"}],selectedFilters:[],show:!0,loading:!0,bots:[],favorites:[],search:null,bots_paginate_object:null}},watch:{displayType:function(s,t){localStorage.setItem("cashman_set_botlist_display_type",this.displayType)},selectedFilters:{handler:function(s){this.loadBots()},deep:!0}},computed:{...C(["getBots","getBotsPaginateObject","getCurrentCompany","getBotFavorites","inBotFav"]),filteredBots(){if(!this.bots)return[];if(this.selectedFilters.length===0&&this.search==null)return this.bots;if(this.selectedFilters.length===0&&this.search!=null)return this.bots.filter(t=>(t.bot_domain||"").trim().toLowerCase().indexOf(this.search.trim().toLowerCase())!==-1);let s=[];return this.selectedFilters.forEach(t=>{switch(t.slug){case"active":this.bots.filter(o=>o.deleted_at==null).forEach(o=>{s.push(o)});break;case"archive":this.bots.filter(o=>o.deleted_at!=null).forEach(o=>{s.push(o)});break}}),this.search==null?s:s.filter(t=>(t.bot_domain||"").trim().toLowerCase().indexOf(this.search.trim().toLowerCase())!==-1)}},mounted(){this.selectFilter("active"),this.displayType=parseInt(localStorage.getItem("cashman_set_botlist_display_type")||0)},methods:{hasRole(s){return window.hasRole(s)||!1},loadBotsByIds(){if(this.getBotFavorites.length==0){this.favorites=[];return}this.loading=!0,this.$store.dispatch("loadBotsByIds",{ids:this.getBotFavorites}).then(s=>{this.loading=!1,this.favorites=s}).catch(()=>{this.loading=!1})},prepareFavorites(){this.$store.dispatch("loadBotFavs").then(s=>{this.loadBotsByIds()})},moveOrderFavBot(s,t){this.$store.dispatch("swapBotInFav",{id:s,direction:t}).then(o=>{this.loadBotsByIds()})},addToFavorite(s){if(this.inBotFav(s)){this.$store.dispatch("removeFromBotFavorites",s).then(t=>{this.$notify("Указанный бот успешно удален из избранного"),this.loadBotsByIds()});return}this.$store.dispatch("addBotToFavorites",s).then(t=>{this.$notify("Указанный бот успешно добавлен в избранное"),this.loadBotsByIds()})},duplicate(s){if(!this.getCurrentCompany){this.$notify("У Вас не выбран клиент!");return}this.$store.dispatch("duplicateBot",{dataObject:{bot_id:s,company_id:this.getCurrentCompany.id}}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно продублирован")})},addToArchive(s){this.$store.dispatch("removeBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.$store.dispatch("resetCurrentBot"),this.loadBots(o),this.$notify("Указанный бот успешно перемещен в архив")})},forceDelete(s){this.$store.dispatch("forceDeleteBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.$store.dispatch("resetCurrentBot"),this.loadBots(o),this.$notify("Указанный бот успешно перемещен из архива")})},extractFromArchive(s){this.$store.dispatch("restoreBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен из архива")})},selectFilter(s){let t=this.filters.find(o=>o.slug===s);t&&this.selectedFilters.filter(o=>o.slug===s).length===0&&this.selectedFilters.push(t)},removeSelectedFilter(s){let t=this.selectedFilters.findIndex(o=>o.slug===s);this.selectedFilters.splice(t,1)},selectBot(s){this.$emit("callback",s),this.show=!1,this.$notify("Вы выбрали бота из списка! Все остальные действия будут производится для этого бота.")},nextBots(s){this.loadBots(s)},loadAndOrder(s){this.order=s,this.direction=this.direction==="desc"?"asc":"desc",this.loadBots(0)},loadBots(s=0){this.loading=!0,this.$store.dispatch("loadBots",{dataObject:{companyId:this.companyId||null,search:this.search,order:this.order,direction:this.direction,filters:this.selectedFilters.map(t=>t.slug)},page:s,size:20}).then(t=>{this.loading=!1,this.bots=this.getBots,this.bots_paginate_object=this.getBotsPaginateObject,this.prepareFavorites()}).catch(()=>{this.loading=!1})}}},RI=Object.assign(CI,{__name:"BotList",setup(s){return(t,o)=>t.show?(l(),i("div",EU,[t.favorites.length>0?(l(),i("div",LU,[e("div",KU,[NU,e("p",JU,"Количество ботов в работе "+u(t.favorites.length||0),1),e("table",YU,[HU,e("tbody",null,[(l(!0),i(g,null,y(t.favorites,(n,a)=>(l(),i("tr",{class:b({"border-info":n.deleted_at==null,"border-danger":n.deleted_at!=null})},[e("th",GU,u(n.id),1),e("td",{onClick:d=>t.selectBot(n)},[e("i",{class:b([{"text-danger":n.deleted_at!=null},"fa-solid fa-robot mr-2"])},null,2),m(" "+u(n.bot_domain||"Не указано"),1)],8,WU),e("td",{onClick:d=>t.selectBot(n)},u(n.title||"Не указано"),9,XU),e("td",null,[n.is_template?(l(),i("span",ZU,u(n.template_description||"Не указано"),1)):(l(),i("span",xU,"Не является шаблоном"))]),e("td",null,u(t.$filters.current(n.updated_at)),1),e("td",null,[e("div",eA,[e("button",{class:b(["btn btn-outline-danger mr-2",{"btn-danger text-white":t.inBotFav(n.id)}]),type:"button",onClick:d=>t.addToFavorite(n.id),title:"Добавить в избранное"},oA,10,tA),t.favorites.length>1?(l(),i("button",{key:0,class:"btn btn-outline-primary mr-2",type:"button",onClick:d=>t.moveOrderFavBot(n.id,1),title:"Переместить вниз"},nA,8,lA)):r("",!0),t.favorites.length>1?(l(),i("button",{key:1,class:"btn btn-outline-primary mr-2",type:"button",onClick:d=>t.moveOrderFavBot(n.id,0),title:"Переместить вверх"},rA,8,aA)):r("",!0)])])],2))),256))])]),cA])])):r("",!0),e("div",uA,[e("div",mA,[e("div",_A,[e("div",hA,[pA,e("ul",bA,[(l(!0),i(g,null,y(t.filters,n=>(l(),i("li",null,[e("a",{class:"dropdown-item",onClick:a=>t.selectFilter(n.slug),href:"#filter"},[e("i",{class:b([n.icon,"mr-2"])},null,2),m(" "+u(n.name||"Не указано"),1)],8,fA)]))),256))])]),e("div",gA,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск бота","aria-label":"Поиск бота","onUpdate:modelValue":o[0]||(o[0]=n=>t.search=n),onKeydown:o[1]||(o[1]=ke((...n)=>t.loadBots&&t.loadBots(...n),["enter"])),"aria-describedby":"button-addon2"},null,544),[[h,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[2]||(o[2]=(...n)=>t.loadBots&&t.loadBots(...n)),type:"button",id:"button-addon2"},"Найти ")])]),t.selectedFilters.length>0?(l(),i("p",vA,[(l(!0),i(g,null,y(t.selectedFilters,n=>(l(),i("span",$A,[m(u(n.name||"не указан")+" ",1),e("a",{onClick:a=>t.removeSelectedFilter(n.slug),class:"ml-1 text-white",href:"#filter"},FA,8,yA)]))),256))])):r("",!0)])]),t.bots_paginate_object?(l(),i("div",wA,[e("div",CA,[SA,e("p",jA,"Количество найденных ботов "+u(t.bots_paginate_object.meta.total||0),1),e("p",qA,"Количество результатов на странице "+u(t.bots.length||0),1),e("p",null,[m(" Тип отображения списка: "),e("span",{onClick:o[3]||(o[3]=n=>t.displayType=0),class:b([{"bg-primary":t.displayType===0,"bg-secondary":t.displayType!==0},"badge cursor-pointer mr-2"])},"Карточки",2),e("span",{class:b([{"bg-primary":t.displayType===1,"bg-secondary":t.displayType!==1},"badge cursor-pointer mr-2"]),onClick:o[4]||(o[4]=n=>t.displayType=1)},"Таблица",2)])])])):r("",!0),t.bots.length>0?(l(),i("div",zA,[e("div",VA,[s.editor?r("",!0):(l(),i("button",{key:0,type:"button",class:"btn btn-outline-info",onClick:o[5]||(o[5]=n=>t.selectBot(null))},"Создать нового бота "))]),t.displayType===1?(l(),i("div",PA,[e("table",OA,[e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"cursor-pointer",onClick:o[6]||(o[6]=n=>t.loadAndOrder("id"))},"#"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[7]||(o[7]=n=>t.loadAndOrder("bot_domain"))},"Домен"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[8]||(o[8]=n=>t.loadAndOrder("title"))},"Название"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[9]||(o[9]=n=>t.loadAndOrder("template_description"))},"Шаблон"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[10]||(o[10]=n=>t.loadAndOrder("updated_at"))},"Дата изменения"),UA])]),e("tbody",null,[(l(!0),i(g,null,y(t.bots,(n,a)=>(l(),i("tr",{class:b({"border-info":n.deleted_at==null,"border-danger":n.deleted_at!=null})},[e("th",AA,u(n.id),1),e("td",{onClick:d=>t.selectBot(n)},[e("i",{class:b([{"text-danger":n.deleted_at!=null},"fa-solid fa-robot mr-2"])},null,2),m(" "+u(n.bot_domain||"Не указано"),1)],8,IA),e("td",{onClick:d=>t.selectBot(n)},u(n.title||"Не указано"),9,QA),e("td",null,[n.is_template?(l(),i("span",TA,u(n.template_description||"Не указано"),1)):(l(),i("span",BA,"Не является шаблоном"))]),e("td",null,u(t.$filters.current(n.updated_at)),1),e("td",null,[e("div",RA,[e("button",{class:b(["btn btn-outline-danger mr-2",{"btn-danger text-white":t.inBotFav(n.id)}]),type:"button",onClick:d=>t.addToFavorite(n.id),title:"Добавить в избранное"},EA,10,MA),e("button",{class:"btn btn-outline-info mr-2",type:"button",onClick:d=>t.duplicate(n.id),title:"Дублировать"},NA,8,LA),n.deleted_at==null&&t.hasRole("admin")?(l(),i("button",{key:0,class:"btn btn-outline-info",type:"button",onClick:d=>t.addToArchive(n.id),title:"В архив"},HA,8,JA)):r("",!0),n.deleted_at!=null&&t.hasRole("admin")?(l(),i("button",{key:1,class:"btn btn-outline-info mr-2",onClick:d=>t.extractFromArchive(n.id),title:"Из архива"},XA,8,GA)):r("",!0),n.deleted_at!=null&&t.hasRole("admin")?(l(),i("button",{key:2,class:"btn btn-danger mr-2",onClick:d=>t.forceDelete(n.id),title:"Удалить на совсем"},eI,8,ZA)):r("",!0)])])],2))),256))])])])):r("",!0),t.displayType===0?(l(!0),i(g,{key:1},y(t.bots,(n,a)=>(l(),i("div",tI,[e("div",{class:b(["card w-100",{"border-info":n.deleted_at==null,"border-secondary":n.deleted_at!=null}])},[e("div",sI,[e("p",{class:"d-flex justify-content-between",onClick:d=>t.selectBot(n),style:{"word-wrap":"break-word"}},[e("span",null,[e("i",{class:b([{"text-danger":n.deleted_at!=null},"fa-solid fa-robot mr-2"])},null,2),m(" "+u(n.bot_domain||"Не указано"),1)]),n.is_template?(l(),i("span",lI,u(n.template_description||"Шаблон без названия"),1)):r("",!0)],8,oI)]),e("div",iI,[e("button",{class:b(["btn btn-outline-danger mr-2",{"btn-danger text-white":t.inBotFav(n.id)}]),type:"button",onClick:d=>t.addToFavorite(n.id),title:"Добавить в избранное"},dI,10,nI),e("button",{class:"btn btn-outline-info mr-2",type:"button",onClick:d=>t.duplicate(n.id),title:"Дублировать"},uI,8,rI),n.deleted_at==null&&t.hasRole("admin")?(l(),i("button",{key:0,class:"btn btn-outline-info",type:"button",onClick:d=>t.addToArchive(n.id),title:"В архив"},hI,8,mI)):r("",!0),n.deleted_at!=null&&t.hasRole("admin")?(l(),i("button",{key:1,class:"btn btn-outline-info mr-2",onClick:d=>t.extractFromArchive(n.id),title:"Из архива"},fI,8,pI)):r("",!0),n.deleted_at!=null&&t.hasRole("admin")?(l(),i("button",{key:2,class:"btn btn-danger mr-2",onClick:d=>t.forceDelete(n.id),title:"Удалить на совсем"},$I,8,gI)):r("",!0)])],2)]))),256)):r("",!0),e("div",yI,[t.bots_paginate_object?(l(),$(j,{key:0,onPagination_page:t.nextBots,pagination:t.bots_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",kI,wI))])):r("",!0)}});export{RI as _,BI as a,s$ as b,de as c};
