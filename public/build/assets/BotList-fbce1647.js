import{q as l,t as i,v as e,F as g,C as y,y as h,D as _,A as r,P as j,H as c,X as V,x as v,K as F,G as C,J as p,Q as k,B as f,a5 as M,Y as U,L as q,O as b,M as A}from"./index.es-77235f88.js";import{_ as L,a as E,b as B}from"./GlobalSlugList-c8d86e2b.js";import{P as S}from"./Pagination-df5e6be2.js";import{_ as P}from"./_plugin-vue_export-helper-c27b6911.js";import{T as O}from"./TelegramChannelHelper-587b5dac.js";import{B as T,_ as R}from"./Mail-e1f52f7d.js";/* empty css                                                               */const x={props:["param"],data(){return{expressions:[{expression:"{{userName}}",description:"Имя пользователя"},{expression:"{{telegramChatId}}",description:"Идентификатор чата"},{expression:"{{referralLink}}",description:"Реферальная ссылка"},{expression:"{{referralQr}}",description:"Реферальный QR-код"}]}},methods:{expressionsSelect(s){this.$emit("callback",{param:this.param,text:s.expression})}}},z={class:"dropdown"},K=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-brands fa-hire-a-helper"})],-1),N={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},Y=["onClick"];function J(s,t,o,n,d,a){return l(),i("div",z,[K,e("div",N,[e("li",null,[(l(!0),i(g,null,y(d.expressions,m=>(l(),i("a",{class:"dropdown-item",onClick:u=>a.expressionsSelect(m)},h(m.description||"-"),9,Y))),256))])])])}const W=P(x,[["render",J]]);const H={class:"card-header d-flex justify-content-between"},G={class:"dropdown"},Q=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),X={class:"dropdown-menu"},Z=e("i",{class:"fa-solid fa-arrow-left mr-1"},null,-1),ee=e("hr",null,null,-1),te=["data-bs-target"],se=e("i",{class:"fa-regular fa-pen-to-square mr-1"},null,-1),oe=e("i",{class:"fa-solid fa-clone mr-1"},null,-1),le=e("i",{class:"fa-regular fa-trash-can text-danger mr-1"},null,-1),ie={key:0,class:"fa-solid fa-arrow-up-short-wide"},ne={key:1,class:"fa-solid fa-arrow-down-short-wide"},ae={class:"card-body"},de={class:"row"},re={class:"col-12"},ce={key:0},ue={key:1,class:"list-group list-group-numbered"},_e={class:"list-group-item d-flex justify-content-between align-items-start"},he={class:"ms-2 me-auto"},me=e("div",{class:"fw-bold"},"Идентификатор",-1),pe={class:"list-group-item d-flex justify-content-between align-items-start"},be={class:"ms-2 me-auto"},ge=e("div",{class:"fw-bold"},"Команда",-1),fe={class:"list-group-item d-flex justify-content-between align-items-start"},ve={class:"ms-2 me-auto"},$e=e("div",{class:"fw-bold"},"Мнемоническое имя",-1),ye={class:"list-group-item d-flex justify-content-between align-items-start"},ke={class:"ms-2 me-auto"},Fe=e("div",{class:"fw-bold"},"Пояснение",-1),we={key:0,class:"list-group-item d-flex justify-content-between align-items-start"},Ce={class:"ms-2 me-auto"},je=e("div",{class:"fw-bold"},"Набор параметров скрипта",-1),Se={key:1,class:"list-group-item d-flex justify-content-between align-items-start"},Ve=e("div",{class:"ms-2 me-auto"},[e("div",{class:"fw-bold"},"Привязана страница")],-1),Pe=[Ve],Ue={key:2,class:"list-group-item d-flex justify-content-between align-items-start"},Be=e("div",{class:"ms-2 me-auto"},[e("div",{class:"fw-bold"},"Глобальный скрипт")],-1),Oe=[Be],Te={class:"list-group-item d-flex justify-content-between align-items-start"},qe={class:"ms-2 me-auto w-100"},De=e("div",{class:"fw-bold"},"Перенести данные из:",-1),Ie=e("option",{value:null},"Не выбрано",-1),Re=["value"],Le=e("p",{class:"my-2"},[e("em",null,"Перенос данных затирает текущие данные в данном скрипте")],-1),Me=["disabled"],Ae=["id"],Ee={class:"modal-dialog modal-fullscreen"},xe={class:"modal-content"},ze={class:"modal-header"},Ke={class:"modal-title",id:"exampleModalLabel"},Ne=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Ye={class:"modal-body"},Je=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),We={props:["item","bot","selectMode"],data(){return{selected_slug_id:null,slugs:[],load:!1,simple:!0}},watch:{simple:function(){this.simple||this.loadAllSlugs()}},mounted(){},methods:{selectCard(){this.$emit("select",this.item)},slugFormCallback(){this.load=!0,this.$emit("callback"),this.$nextTick(()=>{this.load=!1})},editSlug(){this.load=!0,this.$nextTick(()=>{this.load=!1})},selectSlug(){this.load=!0,this.$emit("select",this.item),this.$nextTick(()=>{this.load=!1})},duplicateSlug(){this.load=!0,this.$store.dispatch("duplicateSlug",{dataObject:{slugId:this.item.id}}).then(s=>{this.$notify({title:"Конструктор команд",text:"Команда успешно продублирована",type:"success"}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}).catch(s=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})},submitRelocateData(){this.$store.dispatch("relocateSlugActionData",{slug_sender_id:this.selected_slug_id,slug_recipient_id:this.item.id,bot_id:this.bot.id}).then(s=>{this.$notify({title:"Конструктор команд",text:"Данные команды успешно перенесены",type:"success"})}).catch(s=>{this.$notify({title:"Конструктор команд",text:"Ошибка переноса данных",type:"error"})})},loadAllSlugs(){this.$store.dispatch("loadAllSlugs",{botId:this.bot.id}).then(s=>{this.slugs=s.data})},removeSlug(){this.load=!0,this.$store.dispatch("removeSlug",{dataObject:{slugId:this.item.id}}).then(s=>{this.$notify({title:"Конструктор команд",text:"Команда успешно удалена",type:"success"}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}).catch(s=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})})}}},He=Object.assign(We,{__name:"Slug",setup(s){return(t,o)=>(l(),i(g,null,[e("div",{class:v(["card",{"deprecated-slug":s.item.deprecated_at!=null,"global-slug":s.item.is_global}])},[e("div",H,[e("div",G,[Q,e("ul",X,[e("li",null,[e("a",{onClick:o[0]||(o[0]=(...n)=>t.selectSlug&&t.selectSlug(...n)),title:"Выбрать команду",class:"dropdown-item cursor-pointer"},[Z,_(" Выбрать команду ")])]),ee,e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:o[1]||(o[1]=(...n)=>t.editSlug&&t.editSlug(...n)),"data-bs-toggle":"modal","data-bs-target":"#edit-slug-"+s.item.id},[se,_(" Редактировать")],8,te)]),e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:o[2]||(o[2]=(...n)=>t.duplicateSlug&&t.duplicateSlug(...n))},[oe,_(" Дублировать")])]),e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:o[3]||(o[3]=(...n)=>t.removeSlug&&t.removeSlug(...n))},[le,_(" Удалить")])])])]),e("button",{type:"button",onClick:o[4]||(o[4]=n=>t.simple=!t.simple),class:"btn btn-outline-primary ml-2"},[t.simple?(l(),i("i",ie)):(l(),i("i",ne))])]),e("div",ae,[e("div",de,[e("div",re,[t.simple?(l(),i("p",ce,h(s.item.command||"Нет команды"),1)):(l(),i("ol",ue,[e("li",_e,[e("div",he,[me,_(" №"+h(s.item.id||"Нет идентификатора"),1)])]),e("li",pe,[e("div",be,[ge,_(" "+h(s.item.command||"Нет команды"),1)])]),e("li",fe,[e("div",ve,[$e,_(" "+h(s.item.slug||"Slug"),1)])]),e("li",ye,[e("div",ke,[Fe,_(" "+h(s.item.comment||"Пояснение не указано"),1)])]),s.item.config?(l(),i("li",we,[e("div",Ce,[je,s.item.config?(l(!0),i(g,{key:0},y(s.item.config,n=>(l(),i("p",null,[e("strong",null,h(n.key||"Ключ не найден")+":",1),_(h(n.value||"Не указано"),1)]))),256)):r("",!0)])])):r("",!0),s.item.page?(l(),i("li",Se,Pe)):r("",!0),s.item.is_global?(l(),i("li",Ue,Oe)):r("",!0),e("li",Te,[e("div",qe,[e("form",{onSubmit:o[6]||(o[6]=j((...n)=>t.submitRelocateData&&t.submitRelocateData(...n),["prevent"]))},[De,c(e("select",{class:"form-control w-100","onUpdate:modelValue":o[5]||(o[5]=n=>t.selected_slug_id=n),required:""},[Ie,(l(!0),i(g,null,y(t.slugs,n=>(l(),i("option",{value:n.id},"#"+h(n.id)+" "+h(n.slug||"Не указан"),9,Re))),256))],512),[[V,t.selected_slug_id]]),Le,e("button",{disabled:t.selected_slug_id==null,class:"btn btn-outline-warning w-100"}," Выполнить перенос ",8,Me)],32)])])]))])])])],2),e("div",{class:"modal fade",id:"edit-slug-"+s.item.id,tabindex:"-1"},[e("div",Ee,[e("div",xe,[e("div",ze,[e("h5",Ke,[_("Редактирование команды #"),e("span",null,h(s.item.id),1)]),Ne]),e("div",Ye,[t.load?r("",!0):(l(),F(L,{key:0,item:s.item,onCallback:t.slugFormCallback},null,8,["item","onCallback"]))]),Je])])],8,Ae)],64))}}),Ge={key:0,class:"row"},Qe={class:"col-12 mb-2"},Xe={key:0},Ze=e("i",{class:"fa-solid fa-scroll"},null,-1),et={key:1},tt=e("i",{class:"fa-regular fa-square-minus"},null,-1),st={key:0,class:"col-12"},ot={class:"col-12"},lt={class:"form-floating mb-3"},it=e("label",{for:"floatingInput"},"Быстрый поиск команды",-1),nt={class:"col-12 mb-2"},at={class:"form-check"},dt={class:"form-check-label",for:"need_global"},rt={key:0},ct={key:1},ut={class:"form-check"},_t=e("label",{class:"form-check-label",for:"need_show_deleted"}," Удаленные ",-1),ht={key:1,class:"mb-3 col-12 col-sm-12"},mt={class:"table"},pt=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"Команда"),e("th",{scope:"col"},"Пояснение"),e("th",{scope:"col"},"Глобальный"),e("th",{scope:"col"},"Действия")])],-1),bt=["onClick"],gt={key:0},ft=e("i",{class:"fa-solid fa-check text-success"},null,-1),vt=[ft],$t={key:1},yt=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),kt=[yt],Ft={class:"dropdown"},wt=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),Ct={class:"dropdown-menu"},jt={key:0},St=["onClick"],Vt=e("i",{class:"fa-solid fa-arrow-left mr-1"},null,-1),Pt={key:1},Ut=["onClick"],Bt=e("a",{class:"dropdown-item cursor-pointer","data-bs-toggle":"modal","data-bs-target":"#edit-table-slug"},[e("i",{class:"fa-regular fa-pen-to-square mr-1"}),_(" Редактировать")],-1),Ot=[Bt],Tt=["onClick"],qt=e("i",{class:"fa-solid fa-clone mr-1"},null,-1),Dt=["href"],It=e("i",{class:"fa-regular fa-file-excel mr-1"},null,-1),Rt={key:2},Lt=["onClick"],Mt=e("i",{class:"fa-regular fa-trash-can text-danger mr-1"},null,-1),At={key:3},Et=["onClick"],xt=e("i",{class:"fa-regular fa-trash-can text-danger mr-1"},null,-1),zt={key:3,class:"mb-3 col-md-12"},Kt=e("div",{class:"alert alert-danger",role:"alert"}," У Вас еще нет добавленных скриптов! ",-1),Nt=[Kt],Yt={class:"modal fade",id:"edit-table-slug",tabindex:"-1"},Jt={class:"modal-dialog modal-fullscreen"},Wt={key:0,class:"modal-content"},Ht={class:"modal-header"},Gt={class:"modal-title",id:"exampleModalLabel"},Qt=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Xt={class:"modal-body"},Zt={class:"row"},es={class:"col-8"},ts={class:"col-4"},ss={class:"list-group list-group-numbered"},os={key:0,class:"list-group-item d-flex justify-content-between align-items-start"},ls={class:"ms-2 me-auto"},is=e("div",{class:"fw-bold"},"Набор параметров скрипта",-1),ns={key:1},as={key:1,class:"list-group-item d-flex justify-content-between align-items-start"},ds=e("div",{class:"ms-2 me-auto"},[e("div",{class:"fw-bold"},"Привязана страница")],-1),rs=[ds],cs={key:2,class:"list-group-item d-flex justify-content-between align-items-start"},us=e("div",{class:"ms-2 me-auto"},[e("div",{class:"fw-bold"},"Является глобальным скриптом")],-1),_s=[us],hs={class:"list-group-item d-flex justify-content-between align-items-start"},ms={class:"ms-2 me-auto w-100"},ps=e("div",{class:"fw-bold"},"Перенести данные из:",-1),bs=e("option",{value:null},"Не выбрано",-1),gs=["value"],fs=e("p",{class:"my-2"},[e("em",null,"Перенос данных затирает текущие данные в данном скрипте")],-1),vs=["disabled"],$s=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),ys={props:["command","canSelect"],data(){return{bot:null,relocated_slug_id:null,need_global:!0,need_show_deleted:!0,show:!1,load:!1,slugs:[],paginate:[],selectedSlug:null,ownSearch:null,slugForm:{command:null,comment:null,slug:null}}},watch:{ownSearch:function(s,t){this.loadSlugs()},need_global:function(s,t){this.loadSlugs()},need_show_deleted:function(s,t){this.loadSlugs()}},computed:{...C(["getCurrentBot","getSlugs","getSlugsPaginateObject"])},mounted(){this.loadCurrentBot().then(()=>{this.loadSlugs(),this.command&&this.$nextTick(()=>{this.slugForm.command=this.command})})},methods:{nextSlugs(s){this.loadSlugs(s)},loadSlugs(s=0){return this.$store.dispatch("loadSlugs",{dataObject:{botId:this.bot.id,needGlobal:this.need_global,needDeleted:this.need_show_deleted,search:this.ownSearch},page:s}).then(t=>{this.slugs=this.getSlugs,this.paginate=this.getSlugsPaginateObject})},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},callbackSlugs(){this.loadSlugs()},selectSlug(s){this.load=!0,this.$nextTick(()=>{this.selectedSlug=s,this.load=!1}),this.$emit("select",s)},selectCard(){this.$emit("select",this.item)},slugFormCallback(){this.load=!0;const s=this.selectedSlug;this.loadSlugs().then(()=>{let t=this.slugs.find(o=>o.id===s.id);this.selectSlug(t||null)}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})},editSlug(){this.load=!0,this.$nextTick(()=>{this.load=!1})},duplicateSlug(s){this.load=!0,this.$store.dispatch("duplicateSlug",{dataObject:{slugId:s.id}}).then(t=>{this.$notify({title:"Конструктор команд",text:"Команда успешно продублирована",type:"success"}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}).catch(t=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}),this.loadSlugs(),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})},submitRelocateData(){this.$store.dispatch("relocateSlugActionData",{slug_sender_id:this.relocated_slug_id,slug_recipient_id:this.item.id,bot_id:this.bot.id}).then(s=>{this.$notify({title:"Конструктор команд",text:"Данные команды успешно перенесены",type:"success"})}).catch(s=>{this.$notify({title:"Конструктор команд",text:"Ошибка переноса данных",type:"error"})})},restoreSlug(s){this.load=!0,this.$store.dispatch("restoreSlug",{dataObject:{slugId:s.id}}).then(t=>{this.$notify({title:"Конструктор команд",text:"Команда успешно восстановлена",type:"success"}),this.loadSlugs(),this.$nextTick(()=>{this.load=!1})}).catch(t=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})})},removeSlug(s){this.load=!0,this.$store.dispatch("removeSlug",{dataObject:{slugId:s.id}}).then(t=>{this.$notify({title:"Конструктор команд",text:"Команда успешно удалена",type:"success"}),this.loadSlugs()}).catch(t=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})})}}},x0=Object.assign(ys,{__name:"BotSlugTableList",setup(s){return(t,o)=>(l(),i(g,null,[t.bot?(l(),i("div",Ge,[e("div",Qe,[e("button",{type:"button",onClick:o[0]||(o[0]=n=>t.show=!t.show),class:"btn btn-outline-success p-3 w-100"},[t.show?(l(),i("span",et,[tt,_(" Свернуть форму добавления")])):(l(),i("span",Xe,[Ze,_(" Добавить глобальный скрипт")]))])]),t.show?(l(),i("div",st,[t.bot?(l(),F(E,{key:0,"can-add":!0,bot:t.bot,onCallback:t.loadSlugs},null,8,["bot","onCallback"])):r("",!0)])):r("",!0),e("div",ot,[e("div",lt,[c(e("input",{type:"search","onUpdate:modelValue":o[1]||(o[1]=n=>t.ownSearch=n),class:"form-control",id:"floatingInput",placeholder:"name@example.com"},null,512),[[p,t.ownSearch]]),it])]),e("div",nt,[e("div",at,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[2]||(o[2]=n=>t.need_global=n),type:"checkbox",id:"need_global"},null,512),[[k,t.need_global]]),e("label",dt,[t.need_global?(l(),i("span",rt,"Глобальные")):(l(),i("span",ct,"Локальные"))])]),e("div",ut,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[3]||(o[3]=n=>t.need_show_deleted=n),type:"checkbox",id:"need_show_deleted"},null,512),[[k,t.need_show_deleted]]),_t])]),t.slugs&&t.bot?(l(),i("div",ht,[e("table",mt,[pt,e("tbody",null,[(l(!0),i(g,null,y(t.slugs,(n,d)=>(l(),i("tr",{class:v({"border-info":n.deleted_at==null,"border-danger":n.deleted_at!=null})},[e("th",{scope:"row",class:v({"text-danger":n.deleted_at!=null})},h(n.id||"Нет идентификатора"),3),e("td",{onClick:a=>t.selectSlug(n),"data-bs-toggle":"modal","data-bs-target":"#edit-table-slug",class:v({"text-danger":n.deleted_at!=null})},h(n.command||"Нет команды"),11,bt),e("td",{class:v({"text-danger":n.deleted_at!=null})},h(n.comment||"Пояснение не указано"),3),e("td",null,[n.is_global?(l(),i("span",gt,vt)):(l(),i("span",$t,kt))]),e("td",null,[e("div",Ft,[wt,e("ul",Ct,[s.canSelect?(l(),i("li",jt,[e("a",{onClick:a=>t.selectSlug(n),title:"Выбрать команду",class:"dropdown-item cursor-pointer"},[Vt,_(" Выбрать команду ")],8,St)])):r("",!0),s.canSelect?(l(),i("hr",Pt)):r("",!0),e("li",{onClick:a=>t.selectSlug(n)},Ot,8,Ut),e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:a=>t.duplicateSlug(n)},[qt,_(" Дублировать")],8,Tt)]),e("li",null,[e("a",{class:"dropdown-item cursor-pointer",target:"_blank",href:"/admin/slugs/action-data-export/"+n.id},[It,_(" Скачать данные участников")],8,Dt)]),n.deleted_at==null?(l(),i("li",Rt,[e("a",{class:"dropdown-item cursor-pointer",onClick:a=>t.removeSlug(n)},[Mt,_(" Удалить")],8,Lt)])):r("",!0),n.deleted_at!=null?(l(),i("li",At,[e("a",{class:"dropdown-item cursor-pointer",onClick:a=>t.restoreSlug(n)},[xt,_(" Восстановить")],8,Et)])):r("",!0)])])])],2))),256))])])])):r("",!0),t.paginate?(l(),F(S,{key:2,onPagination_page:t.nextSlugs,pagination:t.paginate},null,8,["onPagination_page","pagination"])):r("",!0),t.slugs.length===0?(l(),i("div",zt,Nt)):r("",!0)])):r("",!0),e("div",Yt,[e("div",Jt,[t.selectedSlug&&!t.load?(l(),i("div",Wt,[e("div",Ht,[e("h5",Gt,[_("Редактирование команды #"),e("span",null,h(t.selectedSlug.id),1)]),Qt]),e("div",Xt,[e("div",Zt,[e("div",es,[f(L,{item:t.selectedSlug,onCallback:t.slugFormCallback},null,8,["item","onCallback"])]),e("div",ts,[e("ol",ss,[t.selectedSlug.config?(l(),i("li",os,[e("div",ls,[is,(t.selectedSlug.config||[]).length>0?(l(!0),i(g,{key:0},y(t.selectedSlug.config,n=>(l(),i("p",null,[e("strong",null,h(n.key||"Ключ не найден")+":",1),_(h(n.value||"Не указано"),1)]))),256)):(l(),i("p",ns,"Отсутствует"))])])):r("",!0),t.selectedSlug.page?(l(),i("li",as,rs)):r("",!0),t.selectedSlug.is_global?(l(),i("li",cs,_s)):r("",!0),e("li",hs,[e("div",ms,[e("form",{onSubmit:o[5]||(o[5]=j((...n)=>t.submitRelocateData&&t.submitRelocateData(...n),["prevent"]))},[ps,c(e("select",{class:"form-control w-100","onUpdate:modelValue":o[4]||(o[4]=n=>t.relocated_slug_id=n),required:""},[bs,(l(!0),i(g,null,y(t.slugs,n=>(l(),i("option",{value:n.id},"#"+h(n.id)+" "+h(n.slug||"Не указан"),9,gs))),256))],512),[[V,t.relocated_slug_id]]),fs,e("button",{disabled:t.relocated_slug_id==null,class:"btn btn-outline-warning w-100"}," Выполнить перенос ",8,vs)],32)])])])])])]),$s])):r("",!0)])])],64))}}),ks={class:"row"},Fs={class:"input-group mb-3"},ws={key:0,class:"row"},Cs={class:"col-12 col-md-12 mb-3"},js={class:"table"},Ss=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"Ф.И.О. из телеграмма"),e("th",{scope:"col"},"Имя пользователя"),e("th",{scope:"col"},"Домен"),e("th",{scope:"col"},"Телефон"),e("th",{scope:"col"},"TG id"),e("th",{scope:"col"},"Админ"),e("th",{scope:"col"},"VIP"),e("th",{scope:"col"},"Доставщик"),e("th",{scope:"col"},"Менеджер"),e("th",{scope:"col"},"За работой")])],-1),Vs={scope:"row"},Ps=["href"],Us={key:1},Bs=["onClick"],Os=e("i",{class:"fa-solid fa-check text-success"},null,-1),Ts=[Os],qs=["onClick"],Ds=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Is=[Ds],Rs=["onClick"],Ls=e("i",{class:"fa-solid fa-check text-success"},null,-1),Ms=[Ls],As=["onClick"],Es=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),xs=[Es],zs=["onClick"],Ks=e("i",{class:"fa-solid fa-check text-success"},null,-1),Ns=[Ks],Ys=["onClick"],Js=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Ws=[Js],Hs=["onClick"],Gs=e("i",{class:"fa-solid fa-check text-success"},null,-1),Qs=[Gs],Xs=["onClick"],Zs=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),eo=[Zs],to=["onClick"],so=e("i",{class:"fa-solid fa-check text-success"},null,-1),oo=[so],lo=["onClick"],io=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),no=[io],ao={class:"col-12"},ro={key:1,class:"row"},co=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет пользователей ")],-1),uo=[co],_o={data(){return{bot:null,loading:!0,bot_users:[],search:null,bot_users_paginate_object:null}},computed:{...C(["getBotUsers","getBotUsersPaginateObject","getCurrentBot"])},mounted(){this.loadCurrentBot().then(()=>{this.loadUsers()})},methods:{loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},changeUserStatus(s,t,o="is_admin"){this.bot_users[s][o]=t===1,this.$store.dispatch("changeUserStatus",{dataObject:{bot_user_id:this.bot_users[s].id,status:t,type:o}}).then(()=>{this.$notify({title:"Конструктор ботов",text:"Статус пользователя успешно изменен! Пользователь оповещен об изменении статуса!",type:"success"})}).catch(()=>{this.$notify({title:"Конструктор ботов",text:"Ошибка изменения статуса",type:"error"})})},nextUsers(s){this.loadUsers(s)},loadUsers(s=0){this.loading=!0,this.$store.dispatch("loadBotUsers",{dataObject:{botId:this.bot.id||null,search:this.search},size:100,page:s}).then(t=>{this.loading=!1,this.bot_users=this.getBotUsers,this.bot_users_paginate_object=this.getBotUsersPaginateObject}).catch(()=>{this.loading=!1})}}},z0=Object.assign(_o,{__name:"BotUserList",setup(s){return(t,o)=>(l(),i(g,null,[e("div",ks,[e("div",Fs,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск пользователя","aria-label":"Поиск пользователя",onKeydown:o[0]||(o[0]=M(n=>t.loadUsers(0),["enter"])),"onUpdate:modelValue":o[1]||(o[1]=n=>t.search=n)},null,544),[[p,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[2]||(o[2]=n=>t.loadUsers(0)),type:"button",id:"button-addon2"},"Найти ")])]),t.bot_users.length>0?(l(),i("div",ws,[e("div",Cs,[e("table",js,[Ss,e("tbody",null,[(l(!0),i(g,null,y(t.bot_users,(n,d)=>(l(),i("tr",null,[e("th",Vs,h(n.id),1),e("td",null,h(n.fio_from_telegram||"Не указано"),1),e("td",null,h(n.name||"Не указано"),1),e("td",null,[n.username?(l(),i("a",{key:0,href:"https://t.me/"+n.username,target:"_blank"},"@"+h(n.username),9,Ps)):(l(),i("span",Us,"Не указано"))]),e("td",null,h(n.phone||"Не указано"),1),e("td",null,h(n.telegram_chat_id||"Не указано"),1),e("td",null,[n.is_admin?(l(),i("span",{key:0,onClick:a=>t.changeUserStatus(d,0,"is_admin")},Ts,8,Bs)):(l(),i("span",{key:1,onClick:a=>t.changeUserStatus(d,1,"is_admin")},Is,8,qs))]),e("td",null,[n.is_vip?(l(),i("span",{key:0,onClick:a=>t.changeUserStatus(d,0,"is_vip")},Ms,8,Rs)):(l(),i("span",{key:1,onClick:a=>t.changeUserStatus(d,1,"is_vip")},xs,8,As))]),e("td",null,[n.is_deliveryman?(l(),i("span",{key:0,onClick:a=>t.changeUserStatus(d,0,"is_deliveryman")},Ns,8,zs)):(l(),i("span",{key:1,onClick:a=>t.changeUserStatus(d,1,"is_deliveryman")},Ws,8,Ys))]),e("td",null,[n.is_manager?(l(),i("span",{key:0,onClick:a=>t.changeUserStatus(d,0,"is_manager")},Qs,8,Hs)):(l(),i("span",{key:1,onClick:a=>t.changeUserStatus(d,1,"is_manager")},eo,8,Xs))]),e("td",null,[n.is_work?(l(),i("span",{key:0,onClick:a=>t.changeUserStatus(d,0,"is_work")},oo,8,to)):(l(),i("span",{key:1,onClick:a=>t.changeUserStatus(d,1,"is_work")},no,8,lo))])]))),256))])])]),e("div",ao,[t.bot_users_paginate_object?(l(),F(S,{key:0,onPagination_page:t.nextUsers,pagination:t.bot_users_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",ro,uo))],64))}});const ho={props:["param"],data(){return{search:null,descriptions:[]}},computed:{filteredDescription(){return this.search?this.descriptions.filter(s=>s.text.indexOf(this.search)!==-1):this.descriptions}},mounted(){this.loadDescription()},methods:{select(s){this.$emit("callback",{param:this.param,text:s})},loadDescription(){this.$store.dispatch("loadDescription").then(s=>{this.descriptions=s.data})}}},mo={class:"dropdown"},po=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-spell-check"})],-1),bo={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},go=e("div",{class:"dropdown-divider"},null,-1),fo=["onClick"];function vo(s,t,o,n,d,a){return l(),i("div",mo,[po,e("div",bo,[c(e("input",{type:"search",class:"form-control",id:"search-description-text","onUpdate:modelValue":t[0]||(t[0]=m=>d.search=m),placeholder:"Введите текст для поиска"},null,512),[[p,d.search]]),go,(l(!0),i(g,null,y(a.filteredDescription,(m,u)=>(l(),i("p",{class:"p-1 text-left w-100",onClick:$=>a.select(m.text)},h(m.text),9,fo))),256))])])}const D=P(ho,[["render",vo]]);const $o={class:"row"},yo={class:"col-md-12 col-12"},ko={class:"form-check mb-3"},Fo=["value"],wo=e("label",{class:"form-check-label",for:"bot-is-template"}," Сделать шаблоном ",-1),Co={key:0,class:"col-md-12 col-12"},jo={class:"mb-3"},So={class:"form-label",id:"bot-template-description"},Vo=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Po=e("div",null,"Если Вы создаете шаблон, а не реального бота ",-1),Uo=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Bo={class:"row"},Oo=e("div",{class:"col-12"},[e("p",null,[_("Для создания бота в Телеграм воспользуйтесь "),e("a",{href:"https://telegra.ph/Sozdanie-telegram-bota-06-12",target:"_blank"},"инструкцией")])],-1),To={class:"col-md-12 col-12"},qo={class:"mb-3"},Do={class:"form-label d-flex justify-content-between",id:"bot-token"},Io=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Ro=e("div",null,"Взять из BotFather при создании бота! Длинная нечитаемая подсвеченная строка! ",-1),Lo=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Mo=e("a",{href:"https://t.me/botfather",target:"_blank"},"Создать нового бота в ТГ",-1),Ao={key:0,class:"col-12"},Eo={class:"mb-3"},xo={class:"form-label",id:"bot-domain"},zo=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Ko=e("div",null,'Строго взять из BotFather! ТО что при создании с окончанием на "bot"',-1),No=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Yo={key:0},Jo=["href"],Wo={key:1,class:"col-12"},Ho={class:"card"},Go={class:"card-body"},Qo=e("h6",null,"Настройка параметров бота в BotFather",-1),Xo={class:"mb-3"},Zo={class:"form-label d-flex justify-content-between align-items-center",id:"bot-title"},el={key:0,class:"text-secondary"},tl={class:"mb-3"},sl={class:"form-label d-flex justify-content-between align-items-center",id:"bot-short-description"},ol={key:0,class:"text-secondary"},ll={class:"mb-3"},il={class:"form-label d-flex justify-content-between align-items-center",id:"bot-long-description"},nl={key:0,class:"text-secondary"},al={class:"col-5"},dl={class:"mb-3"},rl=["onUpdate:modelValue","aria-describedby"],cl={class:"col-5"},ul={class:"mb-3"},_l=["onUpdate:modelValue","aria-describedby"],hl={class:"col-2"},ml=["onClick"],pl=e("i",{class:"fa-regular fa-trash-can"},null,-1),bl=[pl],gl={class:"row"},fl={class:"col-12"},vl={key:2,class:"col-md-6 col-12"},$l={class:"mb-3"},yl={class:"d-flex justify-content-between align-items-center"},kl={class:"form-label d-flex justify-content-between",id:"bot-order-channel"},Fl=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),wl=e("div",null,"Ввести адрес ссылки на канал в форму после добавления тоукена ",-1),Cl=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),jl={key:3,class:"col-md-6 col-12"},Sl={class:"mb-3"},Vl={class:"d-flex justify-content-between"},Pl=e("label",{class:"form-label",id:"bot-main-channel"},"Канал для постов (id,рекламный)",-1),Ul={key:4,class:"col-12 mb-2"},Bl={class:"form-check"},Ol=e("label",{class:"form-check-label",for:"need-payments"}," Необходимо добавить рассылку по топикам для канала заказов (он же системный канал) ",-1),Tl={key:5,class:"col-12 mb-2"},ql={class:"d-flex justify-content-between align-items-center mb-2"},Dl=e("p",null,'Для того, чтоб узнать идентификатор топика в группе впишите в чат "Мой id"',-1),Il=e("i",{class:"fa-solid fa-paperclip mr-2"},null,-1),Rl={class:"list-group"},Ll={class:"list-group-item"},Ml={class:"mb-0"},Al=["onUpdate:modelValue"],El={key:0,class:"row"},xl={class:"col-12"},zl={class:"mb-3"},Kl={class:"d-flex justify-content-between"},Nl={class:"form-label",id:"bot-description"},Yl=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Jl=e("div",null,"Отобразится пользователю при первом запуске",-1),Wl=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Hl={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},Gl={class:"col-12"},Ql={class:"mb-3"},Xl={class:"d-flex justify-content-between"},Zl={class:"form-label",id:"bot-description"},ei=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),ti=e("div",null,'Для меню "О Боте"',-1),si=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),oi={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},li={class:"col-12"},ii={class:"mb-3"},ni={class:"d-flex justify-content-between"},ai={class:"form-label",id:"bot-maintenance-message"},di=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),ri={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},ci={class:"col-md-6 col-12"},ui={class:"mb-3"},_i={class:"form-label",id:"bot-balance"},hi=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),mi=e("div",null,"Начальная сумма денег на счету у конкретного бота",-1),pi=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),bi={class:"col-md-6 col-12"},gi={class:"mb-3"},fi={class:"form-label",id:"bot-tax-per-day"},vi=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),$i=e("div",null,"Сумма списания денег за сутки работы бота (тариф)",-1),yi=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),ki={class:"col-md-6 col-12"},Fi={class:"mb-3"},wi=e("label",{class:"form-label",id:"bot-level-1"},[_(" Уровень 1 CashBack, % "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),Ci={class:"col-md-6 col-12"},ji={class:"mb-3"},Si=e("label",{class:"form-label",id:"bot-level-2"},"Уровень 2 CashBack, %",-1),Vi={class:"col-md-6 col-12"},Pi={class:"mb-3"},Ui=e("label",{class:"form-label",id:"bot-level-3"},"Уровень 3 CashBack, %",-1),Bi={class:"col-md-12 col-12"},Oi={class:"mb-3"},Ti=e("label",{class:"form-label",id:"cashback-fired-period"},"Период сгорания CashBack",-1),qi=["value"],Di={key:0,class:"mb-3"},Ii=e("label",{class:"form-label",id:"cashback-fired-level"},"Уровень сгорания CashBack, %",-1),Ri={class:"mb-2"},Li={class:"form-check"},Mi=e("label",{class:"form-check-label",for:"need-cashback-config"}," Необходимо настроить CashBack по категориям ",-1),Ai={key:0,class:"mb-2"},Ei=e("h6",null,"Настройка категорий CashBack-а",-1),xi={class:"d-flex justify-content-between align-items-center w-100"},zi=e("small",null,"Название категории",-1),Ki=["onClick"],Ni=e("i",{class:"fa-regular fa-trash-can"},null,-1),Yi=[Ni],Ji=["onUpdate:modelValue","aria-describedby"],Wi=e("div",{class:"divider divider-small my-3 bg-highlight"},null,-1),Hi={class:"col-md-12 col-12 mb-2"},Gi={class:"card border-warning"},Qi={class:"card-body"},Xi={class:"form-group"},Zi=e("label",{class:"form-check-label",for:"warning-rules"},[e("i",{class:"fa-solid fa-triangle-exclamation text-danger"}),_(" Правила критических оповещений ")],-1),en=e("option",{value:null},"Не выбрано",-1),tn=["value"],sn={class:"card my-2 p-2"},on={class:"row"},ln={class:"col-md-4 d-flex align-items-center"},nn={class:"m-0"},an={class:"col-md-2"},dn={class:"form-check"},rn=["onUpdate:modelValue","id"],cn=["for"],un={key:0},_n={key:1},hn={class:"col-md-5"},mn=["onUpdate:modelValue"],pn={class:"col-md-1 d-flex justify-content-center"},bn=["onClick"],gn=e("i",{class:"fa-solid fa-trash-can"},null,-1),fn=[gn],vn={class:"col-12 mb-2"},$n={class:"form-check"},yn=e("label",{class:"form-check-label",for:"need-payments"}," Необходимо подключить платежную систему ",-1),kn={key:1,class:"col-md-12 col-12"},Fn={class:"form-check mb-3"},wn=["value"],Cn=e("label",{class:"form-check-label",for:"bot-auto-cashback-on-payments"}," Начислять CashBack автоматически после успешной оплаты ",-1),jn={class:"mb-3"},Sn=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Vn=e("div",null,"Если в боте планируется оплата, то необходимо через BotFather привязать нужную платежную систему и указать в данном поле полученный токен ",-1),Pn=e("label",{class:"form-label",id:"payment_provider_token"},[_("Токен платежной системы "),e("a",{href:"https://t.me/botfather",target:"_blank"},"Подключить")],-1),Un={class:"col-12 mb-2"},Bn={class:"form-check"},On=e("label",{class:"form-check-label",for:"need-shop"}," Необходимо интегрировать магазин в бота ",-1),Tn={key:2,class:"col-md-12 col-12"},qn={class:"mb-3"},Dn=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),In=e("div",null,"Ссылка на страницу ВК с товарами для вашего магазина в боте ",-1),Rn=e("label",{class:"form-label",id:"bot-vk_shop_link"},[_("Ссылка на группу ВК с товарами "),e("a",{href:"https://vk.com/groups?w=groups_create",target:"_blank"},"Создать")],-1),Ln={class:"col-md-12 col-12"},Mn={class:"mb-3"},An=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),En=e("div",null,"Ссылка на внешний сервис обработки данных ",-1),xn=e("label",{class:"form-label",id:"callback_link"},"Ссылка на внешний сервис обработки данных ",-1),zn={class:"col-12"},Kn={class:"card mb-3"},Nn=e("div",{class:"card-header"},[e("h6",null,[_("Информационная ссылка: создайте контент в "),e("a",{target:"_blank",href:"https://telegra.ph"},"https://telegra.ph")])],-1),Yn={class:"card-body"},Jn=e("div",{class:"row"},[e("div",{class:"col-12"},[e("h6",null,"Ссылка")])],-1),Wn={class:"row"},Hn={class:"col-12"},Gn={class:"mb-3"},Qn={class:"col-12"},Xn={class:"card mb-3"},Zn=e("div",{class:"card-header"},[e("h6",null,"Ссылки на соц. сети")],-1),ea={class:"card-body"},ta=e("div",{class:"row"},[e("div",{class:"col-12"},[e("h6",null,"Ссылка")])],-1),sa={class:"col-5"},oa={class:"mb-3"},la=["onUpdate:modelValue","aria-describedby"],ia={class:"col-5"},na={class:"mb-3"},aa=["onUpdate:modelValue","aria-describedby"],da={class:"col-2"},ra=["onClick"],ca=e("i",{class:"fa-regular fa-trash-can"},null,-1),ua=[ca],_a={class:"row"},ha={class:"col-12"},ma={class:"col-12 mb-3"},pa=e("h6",null,[_("Аватар для бота "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),ba={class:"photo-preview d-flex justify-content-start flex-wrap w-100"},ga={for:"bot-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},fa=e("span",null,"+",-1),va={class:"mb-2 img-preview",style:{"margin-right":"10px"}},$a={class:"remove"},ya=["onClick"],ka=e("i",{class:"fa-regular fa-trash-can"},null,-1),Fa=[ka],wa={key:1,class:"mb-2 img-preview",style:{"margin-right":"10px"}},Ca={class:"remove"},ja=e("i",{class:"fa-regular fa-trash-can"},null,-1),Sa=[ja],Va={class:"row"},Pa={class:"col-12"},Ua=["disabled"],Ba={key:0},Oa={key:1},Ta={props:["company","bot"],data(){return{selected_warning:null,page:null,step:0,templates:[],load:!1,loadPage:!1,needPageListUpdate:!1,need_threads:!1,need_cashback_config:!1,need_payments:!1,need_shop:!1,command:null,warnings:[{title:"Сумма чека больше чем",key:"bill_sum_more_then"},{title:"Сумма начисления кэшбэка больше чем",key:"cashback_up_sum_more_then"},{title:"Сумма списания кэшбэка больше чем",key:"cashback_down_sum_more_then"}],cashback_fire_periods:[{title:"Не сгорает",value:0},{title:"7 дней",value:7},{title:"15 дней",value:15},{title:"30 дней",value:30},{title:"60 дней",value:60},{title:"60 дней",value:90},{title:"120 дней",value:120},{title:"180 дней",value:180},{title:"360 дней",value:360}],botForm:{title:"",short_description:"",long_description:"",is_template:!1,auto_cashback_on_payments:!1,template_description:null,bot_domain:null,bot_token:null,bot_token_dev:null,order_channel:null,message_threads:null,cashback_config:null,main_channel:null,vk_shop_link:null,callback_link:null,balance:null,tax_per_day:null,welcome_message:null,image:null,cashback_fire_percent:0,cashback_fire_period:0,description:null,info_link:null,social_links:[],maintenance_message:null,payment_provider_token:null,level_1:10,level_2:0,level_3:0,photos:[],commands:null,selected_bot_template_id:null,pages:[],amo:null,warnings:[]}}},watch:{"botForm.bot_token":{handler(s){this.botForm.bot_token&&this.getMe()},deep:!0},need_threads:function(s,t){let o=[{title:"Отзывы",key:"reviews",value:null},{title:"Начисление cashback",key:"cashback",value:null},{title:"Вопросы",key:"questions",value:null},{title:"Конкурсы",key:"actions",value:null},{title:"Заказы",key:"orders",value:null},{title:"Вывод средств",key:"ask-money",value:null}];this.need_threads&&!this.botForm.message_threads&&(this.botForm.message_threads=o),this.need_threads&&this.botForm.message_threads&&o.forEach(n=>{this.botForm.message_threads.findIndex(a=>a.key===n.key)===-1&&this.botForm.message_threads.push(n)})},need_payments:function(s,t){this.need_payments||(this.botForm.auto_cashback_on_payments=!1)}},computed:{...C(["getSlugs"]),filteredWarnings(){return this.botForm.warnings.length===0?this.warnings:this.warnings.filter(s=>!(this.botForm.warnings.findIndex(t=>t.rule_key===s.key)>=0))}},mounted(){this.bot&&this.$nextTick(()=>{this.botForm={id:this.bot.id||null,title:this.bot.title||"",short_description:this.bot.short_description||"",long_description:this.bot.long_description||"",is_template:this.bot.is_template||!1,auto_cashback_on_payments:this.bot.auto_cashback_on_payments||!1,template_description:this.bot.template_description||null,bot_domain:this.bot.bot_domain||null,bot_token:this.bot.bot_token||null,bot_token_dev:this.bot.bot_token_dev||null,order_channel:this.bot.order_channel||null,message_threads:this.bot.message_threads||null,cashback_config:this.bot.cashback_config||null,main_channel:this.bot.main_channel||null,balance:this.bot.balance||null,tax_per_day:this.bot.tax_per_day||null,vk_shop_link:this.bot.vk_shop_link||null,callback_link:this.bot.callback_link||null,cashback_fire_percent:this.bot.cashback_fire_percent||0,cashback_fire_period:this.bot.cashback_fire_period||0,image:this.bot.image||null,commands:this.bot.commands||null,description:this.bot.description||null,info_link:this.bot.info_link||null,social_links:this.bot.social_links||[],maintenance_message:this.bot.maintenance_message||null,welcome_message:this.bot.welcome_message||null,payment_provider_token:this.bot.payment_provider_token||null,level_1:this.bot.level_1,level_2:this.bot.level_2,level_3:this.bot.level_3,photos:this.bot.photos||[],warnings:this.bot.warnings||[],amo:this.bot.amo||null},this.botForm.commands==null&&(this.botForm.commands=[{command:"/start",description:"начни с этой команды"},{command:"/admins",description:"доступные администраторы в системе"},{command:"/help",description:"как использовать систему"},{command:"/about",description:"о CashMan"}]),this.botForm.message_threads&&(this.need_threads=!0),this.botForm.payment_provider_token&&(this.need_payments=!0),this.botForm.cashback_config&&(this.need_cashback_config=!0)})},methods:{createBotTopics(){this.$store.dispatch("createBotTopics",{dataObject:{topics:this.botForm.message_threads,bot_id:this.bot.id}}).then(s=>{this.botForm.message_threads=s.data})},getMe(){this.$store.dispatch("getMe",{bot_token:this.botForm.bot_token}).then(s=>{this.botForm.bot_domain=s.username||null,this.botForm.title=s.first_name||null})},getChatLink(s){this.$store.dispatch("loadChatInfo",{dataObject:{chat_id:s,bot_id:this.bot.id}}).then(t=>{console.log("chat info",t)})},addTextTo(s={param:null,text:null}){this.botForm[s.param]=s.text},removeCommands(s){this.botForm.commands.splice(s,1)},addCommands(){this.botForm.commands||(this.botForm.commands=[]),this.botForm.commands.push({command:null,description:null})},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},onChangePhotos(s){const t=s.target.files;this.botForm.image=null;for(let o=0;o<t.length;o++)this.botForm.photos.push(t[o])},addItem(s){this.botForm[s].push("")},addSocialLinks(){this.botForm.social_links.push({title:null,url:null})},removeItem(s,t){this.botForm[s].splice(t,1)},removePhoto(s){s?this.botForm.photos.splice(s,1):this.botForm.image=null},addBot(){let s=new FormData;Object.keys(this.botForm).forEach(t=>{const o=this.botForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.company&&s.append("company_id",this.company.id);for(let t=0;t<this.botForm.photos.length;t++)s.append("images[]",this.botForm.photos[t]);s.delete("photos"),this.$store.dispatch(this.bot==null?"createBot":"updateBot",{botForm:s}).then(t=>{let o=t.data;console.log("bot",o),this.$emit("callback",o),this.$notify({title:"Конструктор ботов",text:this.bot==null?"Бот успешно создан!":"Бот успешно обновлен!",type:"success"}),this.$store.dispatch("updateBotWebhook",{dataObject:{bot_id:o.id}}),this.bot==null&&(this.botForm={title:"",short_description:"",long_description:"",is_template:!1,auto_cashback_on_payments:!1,template_description:null,bot_domain:null,bot_token:null,bot_token_dev:null,order_channel:null,message_threads:null,main_channel:null,balance:null,tax_per_day:null,callback_link:null,cashback_fire_percent:0,cashback_fire_period:0,image:null,description:null,info_link:null,social_links:[],maintenance_message:null,payment_provider_token:null,level_1:10,level_2:0,level_3:0,photos:[],warnings:[],selected_bot_template_id:null,pages:[]})}).catch(t=>{this.$notify({title:"Конструктор ботов",text:"Ошибочка...",type:"error"})})},removeCashBackConfig(s){this.botForm.cashback_config.splice(s,1)},addCashBackConfig(){this.botForm.cashback_config=this.botForm.cashback_config==null?[]:this.botForm.cashback_config,this.botForm.cashback_config.push({title:null})},getWarning(s){let t=this.warnings.find(o=>o.key===s);return t||{title:"Не найдено"}},removeWarning(s){this.botForm.warnings.splice(s,1)},addWarning(){const s=this.selected_warning;this.botForm.warnings.push({rule_key:s.key,rule_value:0,is_active:!0}),this.selected_warning=null}}},K0=Object.assign(Ta,{__name:"BotForm",setup(s){return(t,o)=>{const n=U("Popper"),d=q("lazy");return l(),i("form",{class:"pb-5 mb-5",onSubmit:o[38]||(o[38]=j((...a)=>t.addBot&&t.addBot(...a),["prevent"]))},[e("div",$o,[e("div",yo,[e("div",ko,[c(e("input",{class:"form-check-input",type:"checkbox",value:t.botForm.is_template,"onUpdate:modelValue":o[0]||(o[0]=a=>t.botForm.is_template=a),id:"bot-is-template"},null,8,Fo),[[k,t.botForm.is_template]]),wo])]),t.botForm.is_template?(l(),i("div",Co,[e("div",jo,[e("label",So,[f(n,null,{content:b(()=>[Po]),default:b(()=>[Vo]),_:1}),_(" Название шаблона бота "),Uo]),c(e("input",{type:"text",class:"form-control",placeholder:"Название \\ описание шаблона","aria-label":"Описание шаблона","onUpdate:modelValue":o[1]||(o[1]=a=>t.botForm.template_description=a),maxlength:"255","aria-describedby":"bot-template-description",required:""},null,512),[[p,t.botForm.template_description]])])])):r("",!0)]),e("div",Bo,[Oo,e("div",To,[e("div",qo,[e("label",Do,[e("div",null,[f(n,null,{content:b(()=>[Ro]),default:b(()=>[Io]),_:1}),_(" Токен бота "),Lo]),Mo]),c(e("input",{type:"text",class:"form-control",placeholder:"Токен","aria-label":"Токен","onUpdate:modelValue":o[2]||(o[2]=a=>t.botForm.bot_token=a),maxlength:"255","aria-describedby":"bot-token",required:""},null,512),[[p,t.botForm.bot_token]])])]),t.botForm.bot_token?(l(),i("div",Ao,[e("div",Eo,[e("label",xo,[f(n,null,{content:b(()=>[Ko]),default:b(()=>[zo]),_:1}),_(" Доменное имя бота (загружается автоматически) "),No]),c(e("input",{type:"text",class:"form-control",placeholder:"Имя бота","aria-label":"Имя бота","onUpdate:modelValue":o[3]||(o[3]=a=>t.botForm.bot_domain=a),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[p,t.botForm.bot_domain]]),t.botForm.bot_domain?(l(),i("p",Yo,[_("Проверить работу бота "),e("a",{href:"https://t.me/"+t.botForm.bot_domain,target:"_blank"},"@"+h(t.botForm.bot_domain),9,Jo)])):r("",!0)])])):r("",!0),t.botForm.bot_token?(l(),i("div",Wo,[e("div",Ho,[e("div",Go,[Qo,e("div",Xo,[e("label",Zo,[e("span",null,[_(" Название бота "),t.botForm.title.length>0?(l(),i("small",el,"Длина текста "+h(t.botForm.title.length)+"/64",1)):r("",!0)])]),c(e("input",{type:"text",class:"form-control",placeholder:"Текст названия","aria-label":"Текст названия","onUpdate:modelValue":o[4]||(o[4]=a=>t.botForm.title=a),maxlength:"64","aria-describedby":"bot-title"},null,512),[[p,t.botForm.title]])]),e("div",tl,[e("label",sl,[e("span",null,[_(" Короткое описание бота "),t.botForm.short_description.length>0?(l(),i("small",ol,"Длина текста "+h(t.botForm.short_description.length)+"/120",1)):r("",!0)])]),c(e("textarea",{class:"form-control",placeholder:"Короткий текст описания бота","aria-label":"Короткий текст описания бота","onUpdate:modelValue":o[5]||(o[5]=a=>t.botForm.short_description=a),maxlength:"120","aria-describedby":"bot-short-description"},`
                                `,512),[[p,t.botForm.short_description]])]),e("div",ll,[e("label",il,[e("span",null,[_(" Длинное описание бота "),t.botForm.long_description.length>0?(l(),i("small",nl,"Длина текста "+h(t.botForm.long_description.length)+"/512",1)):r("",!0)])]),c(e("textarea",{class:"form-control",placeholder:"Длинный текст описания бота","aria-label":"Длинный текст описания бота","onUpdate:modelValue":o[6]||(o[6]=a=>t.botForm.long_description=a),maxlength:"512","aria-describedby":"bot-long-description"},`
                                `,512),[[p,t.botForm.long_description]])]),(l(!0),i(g,null,y(t.botForm.commands,(a,m)=>(l(),i("div",{class:"row",key:"commands-"+m},[e("div",al,[e("div",dl,[c(e("input",{type:"text",class:"form-control",placeholder:"Название команды","aria-label":"Название команды",maxlength:"255","onUpdate:modelValue":u=>t.botForm.commands[m].command=u,"aria-describedby":"bot-command-"+m,required:""},null,8,rl),[[p,t.botForm.commands[m].command]])])]),e("div",cl,[e("div",ul,[c(e("input",{type:"text",class:"form-control",placeholder:"Описание команды","aria-label":"Описание команды",maxlength:"255","onUpdate:modelValue":u=>t.botForm.commands[m].description=u,"aria-describedby":"bot-command-description-"+m,required:""},null,8,_l),[[p,t.botForm.commands[m].description]])])]),e("div",hl,[e("button",{type:"button",onClick:u=>t.removeCommands(m),class:"btn btn-outline-danger w-100"},bl,8,ml)])]))),128)),e("div",gl,[e("div",fl,[e("button",{type:"button",onClick:o[7]||(o[7]=a=>t.addCommands()),class:"btn btn-outline-success w-100"},"Добавить еще команду ")])])])])])):r("",!0),t.botForm.bot_token?(l(),i("div",vl,[e("div",$l,[e("div",yl,[e("label",kl,[e("div",null,[f(n,null,{content:b(()=>[wl]),default:b(()=>[Fl]),_:1}),_(" Канал для заказов (id) "),Cl])]),f(O,{token:t.botForm.bot_token,param:"order_channel",onCallback:t.addTextTo},null,8,["token","onCallback"])]),c(e("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":o[8]||(o[8]=a=>t.botForm.order_channel=a),maxlength:"255","aria-describedby":"bot-order-channel"},null,512),[[p,t.botForm.order_channel]]),e("small",null,[e("a",{onClick:o[9]||(o[9]=a=>t.getChatLink(t.botForm.order_channel)),href:"javascript:void(0)"},"Узнать ссылку"),_("(будет отправлена в бота)")])])])):r("",!0),t.botForm.bot_token?(l(),i("div",jl,[e("div",Sl,[e("div",Vl,[Pl,f(O,{token:t.botForm.bot_token,param:"main_channel",onCallback:t.addTextTo},null,8,["token","onCallback"])]),c(e("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":o[10]||(o[10]=a=>t.botForm.main_channel=a),maxlength:"255","aria-describedby":"bot-main-channel"},null,512),[[p,t.botForm.main_channel]]),e("small",null,[e("a",{onClick:o[11]||(o[11]=a=>t.getChatLink(t.botForm.main_channel)),href:"javascript:void(0)"},"Узнать ссылку"),_("(будет отправлена в бота)")])])])):r("",!0),t.botForm.order_channel&&t.botForm.bot_token?(l(),i("div",Ul,[e("div",Bl,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[12]||(o[12]=a=>t.need_threads=a),type:"checkbox",id:"need-payments"},null,512),[[k,t.need_threads]]),Ol])])):r("",!0),t.need_threads&&t.botForm.order_channel?(l(),i("div",Tl,[e("div",ql,[Dl,e("a",{class:"btn btn-outline-info",onClick:o[13]||(o[13]=(...a)=>t.createBotTopics&&t.createBotTopics(...a)),href:"javascript:void(0)"},[Il,_("Создать топики автоматически ")])]),e("ul",Rl,[(l(!0),i(g,null,y(t.botForm.message_threads,(a,m)=>(l(),i("li",Ll,[e("p",Ml,h(a.title)+" ("+h(a.key)+")",1),c(e("input",{type:"number",class:"form-control",min:"0",max:"10000",placeholder:"Идентификатор топика","onUpdate:modelValue":u=>t.botForm.message_threads[m].value=u},null,8,Al),[[p,t.botForm.message_threads[m].value]])]))),256))])])):r("",!0)]),t.botForm.bot_token?(l(),i("div",El,[e("div",xl,[e("div",zl,[e("div",Kl,[e("label",Nl,[f(n,null,{content:b(()=>[Jl]),default:b(()=>[Yl]),_:1}),_(" Приветственное сообщение "),Wl,t.botForm.welcome_message?(l(),i("small",Hl," Длина текста "+h(t.botForm.welcome_message.length),1)):r("",!0)]),f(D,{param:"welcome_message",onCallback:t.addTextTo},null,8,["onCallback"])]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текстовое приветствие при запуске бота","aria-label":"Текстовое приветствие при запуске бота","onUpdate:modelValue":o[14]||(o[14]=a=>t.botForm.welcome_message=a),"aria-describedby":"bot-description",required:""},`
                    `,512),[[p,t.botForm.welcome_message]])])]),e("div",Gl,[e("div",Ql,[e("div",Xl,[e("label",Zl,[f(n,null,{content:b(()=>[ti]),default:b(()=>[ei]),_:1}),_(" Описание бота "),si,t.botForm.description?(l(),i("small",oi," Длина текста "+h(t.botForm.description.length),1)):r("",!0)]),f(D,{param:"description",onCallback:t.addTextTo},null,8,["onCallback"])]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текстовое описание бота","aria-label":"Текстовое описание бота","onUpdate:modelValue":o[15]||(o[15]=a=>t.botForm.description=a),"aria-describedby":"bot-description",required:""},`
                    `,512),[[p,t.botForm.description]])])]),e("div",li,[e("div",ii,[e("div",ni,[e("label",ai,[_("Сообщение для режима тех. работ "),di,t.botForm.maintenance_message?(l(),i("small",ri," Длина текста "+h(t.botForm.maintenance_message.length),1)):r("",!0)]),f(D,{param:"maintenance_message",onCallback:t.addTextTo},null,8,["onCallback"])]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текстовое сообщение","aria-label":"Текстовое сообщение","onUpdate:modelValue":o[16]||(o[16]=a=>t.botForm.maintenance_message=a),maxlength:"255","aria-describedby":"bot-maintenance-message",required:""},`
                    `,512),[[p,t.botForm.maintenance_message]])])]),e("div",ci,[e("div",ui,[e("label",_i,[f(n,null,{content:b(()=>[mi]),default:b(()=>[hi]),_:1}),_(" Баланс бота, руб "),pi]),c(e("input",{type:"number",class:"form-control",placeholder:"Баланс","aria-label":"Баланс","onUpdate:modelValue":o[17]||(o[17]=a=>t.botForm.balance=a),min:"0","aria-describedby":"bot-balance",required:""},null,512),[[p,t.botForm.balance]])])]),e("div",bi,[e("div",gi,[e("label",fi,[f(n,null,{content:b(()=>[$i]),default:b(()=>[vi]),_:1}),_(" Списание за сутки, руб "),yi]),c(e("input",{type:"number",class:"form-control",placeholder:"Списание","aria-label":"Списание","onUpdate:modelValue":o[18]||(o[18]=a=>t.botForm.tax_per_day=a),min:"0","aria-describedby":"bot-tax-per-day",required:""},null,512),[[p,t.botForm.tax_per_day]])])]),e("div",ki,[e("div",Fi,[wi,c(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень CashBack","onUpdate:modelValue":o[19]||(o[19]=a=>t.botForm.level_1=a),min:"0","aria-describedby":"bot-level-1",required:""},null,512),[[p,t.botForm.level_1]])])]),e("div",Ci,[e("div",ji,[Si,c(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень CashBack","onUpdate:modelValue":o[20]||(o[20]=a=>t.botForm.level_2=a),min:"0","aria-describedby":"bot-level-2"},null,512),[[p,t.botForm.level_2]])])]),e("div",Vi,[e("div",Pi,[Ui,c(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень CashBack","onUpdate:modelValue":o[21]||(o[21]=a=>t.botForm.level_3=a),min:"0","aria-describedby":"bot-level-3"},null,512),[[p,t.botForm.level_3]])])]),e("div",Bi,[e("div",Oi,[Ti,c(e("select",{class:"form-control","onUpdate:modelValue":o[22]||(o[22]=a=>t.botForm.cashback_fire_period=a),id:"cashback-fired-period"},[(l(!0),i(g,null,y(t.cashback_fire_periods,a=>(l(),i("option",{value:a.value},h(a.title||"Не указано"),9,qi))),256))],512),[[V,t.botForm.cashback_fire_period]])]),t.botForm.cashback_fire_period>0?(l(),i("div",Di,[Ii,c(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень сгорания CashBack","onUpdate:modelValue":o[23]||(o[23]=a=>t.botForm.cashback_fire_percent=a),min:"0",max:"100","aria-describedby":"cashback-fired-level"},null,512),[[p,t.botForm.cashback_fire_percent]])])):r("",!0)]),e("div",Ri,[e("div",Li,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[24]||(o[24]=a=>t.need_cashback_config=a),type:"checkbox",id:"need-cashback-config"},null,512),[[k,t.need_cashback_config]]),Mi])]),t.need_cashback_config?(l(),i("div",Ai,[Ei,(l(!0),i(g,null,y(t.botForm.cashback_config,(a,m)=>(l(),i("div",{class:"d-flex justify-content-between mb-2 flex-wrap",key:"social-link"+m},[e("div",xi,[zi,e("button",{type:"button",onClick:u=>t.removeCashBackConfig(m),class:"btn btn-link text-danger"},Yi,8,Ki)]),c(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Название категории","aria-label":"Название категории",maxlength:"255","onUpdate:modelValue":u=>t.botForm.cashback_config[m].title=u,"aria-describedby":"bot-cashback-config-"+m,required:""},null,8,Ji),[[p,t.botForm.cashback_config[m].title]])]))),128)),e("button",{type:"button",onClick:o[25]||(o[25]=a=>t.addCashBackConfig()),class:"btn mb-2 rounded-sm text-uppercase btn-outline-info w-100"}," Добавить еще категорию "),Wi])):r("",!0),e("div",Hi,[e("div",Gi,[e("div",Qi,[e("div",Xi,[Zi,c(e("select",{class:"form-control","onUpdate:modelValue":o[26]||(o[26]=a=>t.selected_warning=a),onChange:o[27]||(o[27]=(...a)=>t.addWarning&&t.addWarning(...a)),id:"warning-rules"},[en,(l(!0),i(g,null,y(t.filteredWarnings,a=>(l(),i("option",{value:a},h(a.title),9,tn))),256))],544),[[V,t.selected_warning]])]),(l(!0),i(g,null,y(t.botForm.warnings,(a,m)=>(l(),i("div",sn,[e("div",on,[e("div",ln,[e("p",nn,h(t.getWarning(a.rule_key).title||"Не найдено"),1)]),e("div",an,[e("div",dn,[c(e("input",{class:"form-check-input","onUpdate:modelValue":u=>t.botForm.warnings[m].is_active=u,type:"checkbox",id:"warning-is-active-"+m},null,8,rn),[[k,t.botForm.warnings[m].is_active]]),e("label",{class:"form-check-label",for:"warning-is-active-"+m},[t.botForm.warnings[m].is_active?(l(),i("span",un,"Вкл")):(l(),i("span",_n,"Выкл"))],8,cn)])]),e("div",hn,[c(e("input",{type:"number",class:"form-control",placeholder:"Значение","onUpdate:modelValue":u=>t.botForm.warnings[m].rule_value=u,min:"0","aria-describedby":"bot-level-3"},null,8,mn),[[p,t.botForm.warnings[m].rule_value]])]),e("div",pn,[e("button",{onClick:u=>t.removeWarning(m),type:"button",class:"btn btn-outline-danger"},fn,8,bn)])])]))),256))])])]),e("div",vn,[e("div",$n,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[28]||(o[28]=a=>t.need_payments=a),type:"checkbox",id:"need-payments"},null,512),[[k,t.need_payments]]),yn])]),t.need_payments?(l(),i("div",kn,[e("div",Fn,[c(e("input",{class:"form-check-input",type:"checkbox",value:t.botForm.auto_cashback_on_payments,"onUpdate:modelValue":o[29]||(o[29]=a=>t.botForm.auto_cashback_on_payments=a),id:"bot-auto-cashback-on-payments"},null,8,wn),[[k,t.botForm.auto_cashback_on_payments]]),Cn]),e("div",jn,[f(n,null,{content:b(()=>[Vn]),default:b(()=>[Sn]),_:1}),Pn,c(e("input",{type:"text",class:"form-control",placeholder:"Токен","aria-label":"Токен","onUpdate:modelValue":o[30]||(o[30]=a=>t.botForm.payment_provider_token=a),"aria-describedby":"payment_provider_token"},null,512),[[p,t.botForm.payment_provider_token]])])])):r("",!0),e("div",Un,[e("div",Bn,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[31]||(o[31]=a=>t.need_shop=a),type:"checkbox",id:"need-shop"},null,512),[[k,t.need_shop]]),On])]),t.need_shop?(l(),i("div",Tn,[e("div",qn,[f(n,null,{content:b(()=>[In]),default:b(()=>[Dn]),_:1}),Rn,c(e("input",{type:"url",class:"form-control",placeholder:"Ссылка на группу ВК","aria-label":"ссылка на группу ВК","onUpdate:modelValue":o[32]||(o[32]=a=>t.botForm.vk_shop_link=a),"aria-describedby":"vk_shop_link"},null,512),[[p,t.botForm.vk_shop_link]])])])):r("",!0),e("div",Ln,[e("div",Mn,[f(n,null,{content:b(()=>[En]),default:b(()=>[An]),_:1}),xn,c(e("input",{type:"url",class:"form-control",placeholder:"Ссылка на внешний сервис","aria-label":"ссылка на внешний сервис","onUpdate:modelValue":o[33]||(o[33]=a=>t.botForm.callback_link=a),"aria-describedby":"callback_link"},null,512),[[p,t.botForm.callback_link]])])]),e("div",zn,[e("div",Kn,[Nn,e("div",Yn,[Jn,e("div",Wn,[e("div",Hn,[e("div",Gn,[c(e("input",{type:"text",class:"form-control",placeholder:"Ссылка ресурс telegraph","aria-label":"Ссылка ресурс telegraph",maxlength:"255","onUpdate:modelValue":o[34]||(o[34]=a=>t.botForm.info_link=a),"aria-describedby":"bot-info-link"},null,512),[[p,t.botForm.info_link]])])])])])])]),e("div",Qn,[e("div",Xn,[Zn,e("div",ea,[ta,(l(!0),i(g,null,y(t.botForm.social_links,(a,m)=>(l(),i("div",{class:"row",key:"social-link"+m},[e("div",sa,[e("div",oa,[c(e("input",{type:"text",class:"form-control",placeholder:"Название ссылки","aria-label":"Название ссылки",maxlength:"255","onUpdate:modelValue":u=>t.botForm.social_links[m].title=u,"aria-describedby":"bot-social-link-"+m,required:""},null,8,la),[[p,t.botForm.social_links[m].title]])])]),e("div",ia,[e("div",na,[c(e("input",{type:"text",class:"form-control",placeholder:"Ссылка на соц.сеть","aria-label":"Ссылка на соц.сеть",maxlength:"255","onUpdate:modelValue":u=>t.botForm.social_links[m].url=u,"aria-describedby":"bot-social-link-"+m,required:""},null,8,aa),[[p,t.botForm.social_links[m].url]])])]),e("div",da,[e("button",{type:"button",onClick:u=>t.removeItem("social_links",m),class:"btn btn-outline-danger w-100"},ua,8,ra)])]))),128)),e("div",_a,[e("div",ha,[e("button",{type:"button",onClick:o[35]||(o[35]=a=>t.addSocialLinks()),class:"btn btn-outline-success w-100"},"Добавить еще ссылку ")])])])])]),e("div",ma,[pa,e("div",ba,[e("label",ga,[fa,e("input",{type:"file",id:"bot-photos",multiple:"",accept:"image/*",onChange:o[36]||(o[36]=(...a)=>t.onChangePhotos&&t.onChangePhotos(...a)),style:{display:"none"}},null,32)]),t.botForm.photos?(l(!0),i(g,{key:0},y(t.botForm.photos,(a,m)=>(l(),i("div",va,[c(e("img",null,null,512),[[d,t.getPhoto(a).imageUrl]]),e("div",$a,[e("a",{onClick:u=>t.removePhoto(m)},Fa,8,ya)])]))),256)):(l(),i("div",wa,[c(e("img",null,null,512),[[d,"/images-by-bot-id/"+s.bot.id+"/"+t.botForm.image]]),e("div",Ca,[e("a",{onClick:o[37]||(o[37]=a=>t.removePhoto())},Sa)])]))])])])):r("",!0),e("div",Va,[e("div",Pa,[e("button",{disabled:!t.botForm.bot_token,type:"submit",class:"btn btn-success w-100 p-3"},[s.bot?(l(),i("span",Oa,"Обновить бота")):(l(),i("span",Ba,"Добавить бота"))],8,Ua)])])],32)}}});const qa={class:"row"},Da={class:"input-group mb-3"},Ia={class:"row"},Ra={class:"col-12"},La={class:"form-check"},Ma=e("label",{class:"form-check-label",for:"needDeleted"},"Отобразить удаленные",-1),Aa={key:0,class:"row"},Ea={key:0,class:"col-12"},xa={class:"col-12 mb-3"},za={class:"list-group w-100"},Ka={class:"d-flex justify-content-between"},Na=["onClick"],Ya={key:0},Ja={key:1},Wa={key:2},Ha=e("i",{class:"fa-solid fa-lock"},null,-1),Ga=[Ha],Qa={key:0},Xa={class:"dropdown"},Za=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),ed={class:"dropdown-menu"},td={key:0},sd=["onClick"],od=e("i",{class:"fa-solid fa-copy mr-1"},null,-1),ld={key:1},id=["onClick"],nd=e("i",{class:"fa-solid fa-ban mr-1"},null,-1),ad=["onClick"],dd=e("i",{class:"fa-solid fa-copy mr-1"},null,-1),rd={key:2},cd=["onClick"],ud=e("i",{class:"fa-solid fa-trash mr-1"},null,-1),_d={key:0,class:"component-icons"},hd={key:0},md=e("i",{class:"fa-regular fa-images"},null,-1),pd=[md],bd={key:1},gd=e("i",{class:"fa-regular fa-note-sticky"},null,-1),fd=[gd],vd={key:2},$d=e("i",{class:"fa-solid fa-photo-film"},null,-1),yd=[$d],kd={key:3},Fd=e("i",{class:"fa-regular fa-file-audio"},null,-1),wd=[Fd],Cd={key:4},jd=e("i",{class:"fa-regular fa-file-word"},null,-1),Sd=[jd],Vd={key:5},Pd=e("i",{class:"fa-solid fa-link"},null,-1),Ud=[Pd],Bd={key:6},Od=e("i",{class:"fa-solid fa-scroll"},null,-1),Td=[Od],qd={key:7},Dd=e("i",{class:"fa-regular fa-comment-dots"},null,-1),Id=[Dd],Rd={key:8},Ld=e("i",{class:"fa-solid fa-scale-balanced"},null,-1),Md=[Ld],Ad={key:9},Ed=e("i",{class:"fa-regular fa-keyboard"},null,-1),xd=[Ed],zd={key:10},Kd=e("i",{class:"fa-solid fa-ellipsis"},null,-1),Nd=[Kd],Yd={class:"col-12"},Jd={key:1,class:"row"},Wd=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," Созданных страниц не найдено! ")],-1),Hd=[Wd],Gd={props:["editor","current"],data(){return{bot:null,current_page:0,need_deleted:!1,loading:!0,pages:[],search:null,pages_paginate_object:null,need_new_page:!1}},watch:{need_deleted:function(s,t){this.nextPages(0)},getPages:function(s,t){this.$nextTick(()=>{this.search||(this.pages=this.getPages)})},search:function(s,t){this.nextPages(0)}},computed:{...C(["getPages","getCurrentBot","getPagesPaginateObject"])},mounted(){this.loadCurrentBot().then(()=>{this.current_page=localStorage.getItem(`cashman_pagelist_${this.bot.id}_page_index`)||0,this.loadPages()})},methods:{loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},selectPage(s){this.$emit("callback",s),this.$notify("Вы выбрали страницу из списка! Все остальные действия будут производится для этой страницы")},nextPages(s){this.current_page=s,localStorage.setItem(`cashman_pagelist_${this.bot.id}_page_index`,this.current_page),this.loadPages()},duplicatePage(s){this.loading=!0,this.$store.dispatch("duplicatePage",{dataObject:{pageId:s}}).then(t=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},forceRemovePage(s){this.loading=!0,this.$store.dispatch("forceRemovePage",{dataObject:{pageId:s}}).then(t=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},restorePage(s){this.loading=!0,this.$store.dispatch("restorePage",{dataObject:{pageId:s}}).then(t=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},removePage(s){this.loading=!0,this.$store.dispatch("removePage",{dataObject:{pageId:s}}).then(t=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},loadPages(){this.loading=!0,this.$store.dispatch("loadPages",{dataObject:{botId:this.bot.id||null,search:this.search||null,needDeleted:this.need_deleted},page:this.current_page||0}).then(s=>{this.loading=!1,this.pages=this.getPages,this.pages_paginate_object=this.getPagesPaginateObject,this.pages.length===0&&localStorage.setItem(`cashman_pagelist_${this.bot.id}_page_index`,0)}).catch(()=>{this.loading=!1})}}},I=Object.assign(Gd,{__name:"PagesList",setup(s){return(t,o)=>(l(),i(g,null,[e("div",qa,[e("div",Da,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск страницы","aria-label":"Поиск бота","onUpdate:modelValue":o[0]||(o[0]=n=>t.search=n),"aria-describedby":"button-addon2"},null,512),[[p,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=(...n)=>t.loadPages&&t.loadPages(...n)),type:"button",id:"button-addon2"},"Найти ")])]),e("div",Ia,[e("div",Ra,[e("div",La,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[2]||(o[2]=n=>t.need_deleted=n),type:"checkbox",id:"needDeleted"},null,512),[[k,t.need_deleted]]),Ma])])]),t.pages.length>0?(l(),i("div",Aa,[t.pages.length>7?(l(),i("div",Ea,[t.pages_paginate_object?(l(),F(S,{key:0,onPagination_page:t.nextPages,pagination:t.pages_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])):r("",!0),e("div",xa,[e("ul",za,[(l(!0),i(g,null,y(t.pages,(n,d)=>(l(),i("li",{class:v(["list-group-item cursor-pointer page-menu-item btn btn-outline-info mb-1",{"border border-warning":n.deleted_at!=null}])},[e("div",Ka,[e("strong",{onClick:a=>t.selectPage(n)},[_("#"+h(n.id||"Не указано")+" ",1),n.slug?(l(),i("span",Ya,h(n.slug.command||"Не указано"),1)):(l(),i("span",Ja,"Не привязано к команде")),s.current&&s.current==n.id?(l(),i("span",Wa,Ga)):r("",!0)],8,Na),s.editor?(l(),i("div",Qa,[e("div",Xa,[Za,e("ul",ed,[n.deleted_at!=null?(l(),i("li",td,[e("a",{class:"dropdown-item",onClick:a=>t.restorePage(n.id)},[od,_("Восстановить")],8,sd)])):r("",!0),n.deleted_at!=null?(l(),i("li",ld,[e("a",{class:"dropdown-item",onClick:a=>t.forceRemovePage(n.id)},[nd,_("Удалить полностью")],8,id)])):r("",!0),e("li",null,[e("a",{class:"dropdown-item",onClick:a=>t.duplicatePage(n.id)},[dd,_("Дублировать")],8,ad)]),n.deleted_at==null?(l(),i("li",rd,[e("a",{class:"dropdown-item",onClick:a=>t.removePage(n.id)},[ud,_("Удалить")],8,cd)])):r("",!0)])])])):r("",!0)]),n?(l(),i("ul",_d,[(n.images||[]).length>0?(l(),i("li",hd,pd)):r("",!0),n.sticker?(l(),i("li",bd,fd)):r("",!0),(n.videos||[]).length>0?(l(),i("li",vd,yd)):r("",!0),(n.audios||[]).length>0?(l(),i("li",kd,wd)):r("",!0),(n.documents||[]).length>0?(l(),i("li",Cd,Sd)):r("",!0),n.next_page_id?(l(),i("li",Vd,Ud)):r("",!0),n.next_bot_menu_slug_id?(l(),i("li",Bd,Td)):r("",!0),n.next_bot_dialog_command_id?(l(),i("li",qd,Id)):r("",!0),n.rules_if?(l(),i("li",Rd,Md)):r("",!0),n.reply_keyboard_id?(l(),i("li",Ad,xd)):r("",!0),n.inline_keyboard_id?(l(),i("li",zd,Nd)):r("",!0)])):r("",!0)],2))),256))])]),e("div",Yd,[t.pages_paginate_object?(l(),F(S,{key:0,onPagination_page:t.nextPages,pagination:t.pages_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",Jd,Hd))],64))}}),Qd={class:"row"},Xd={class:"col-12"},Zd={class:"card-body"},er=e("h6",null,"Добавление нового скрипта в бота",-1),tr={key:0,class:"row"},sr={class:"col-md-4 mb-2"},or={key:1,class:"row"},lr=e("div",{class:"col-12"},[e("div",{class:"alert alert-danger",role:"alert"},' У Вас еще нет добавленных скриптов! Воспользуйтесь разделом "Скрипты" для добавления. ')],-1),ir=[lr],nr={props:["bot","global"],data(){return{load:!1,search:null,slugs:[],paginate:[]}},computed:{...C(["getSlugs","getSlugsPaginateObject"]),filteredSlugs(){return this.slugs?this.slugs.length===0?[]:this.search==null?this.slugs:this.slugs.filter(s=>{let t=s.slug||"",o=s.command||"",n=s.comment||"";return o.toLowerCase().indexOf(this.search.toLowerCase())!==-1||n.toLowerCase().indexOf(this.search.toLowerCase())!==-1||t.toLowerCase().indexOf(this.search.toLowerCase())!==-1}):[]}},mounted(){this.loadSlugs()},methods:{nextSlugs(s){this.loadSlugs(s)},selectSlug(s){this.$emit("callback",{id:s.id||null,slug:s.slug,comment:s.comment,command:s.command}),this.$notify("Вы выбрали скрипт из списка!")},loadSlugs(s=0){this.$store.dispatch("loadSlugs",{dataObject:{botId:this.bot.id,search:this.search,needGlobal:this.global},page:s}).then(t=>{this.slugs=this.getSlugs,this.paginate=this.getSlugsPaginateObject})},callbackSlugs(){}}},ar=Object.assign(nr,{__name:"BotSlugListSimple",setup(s){return(t,o)=>(l(),i("div",Qd,[e("div",Xd,[e("div",Zd,[er,e("div",null,[c(e("input",{type:"text",class:"form-control mt-1 mb-1","onUpdate:modelValue":o[0]||(o[0]=n=>t.search=n),onKeyup:o[1]||(o[1]=(...n)=>t.loadSlugs&&t.loadSlugs(...n)),placeholder:"Поиск нужного скрипта по описанию"},null,544),[[p,t.search]])]),t.slugs.length>0?(l(),i("div",tr,[(l(!0),i(g,null,y(t.slugs,(n,d)=>(l(),i("div",sr,[f(He,{item:n,bot:s.bot,onCallback:t.callbackSlugs,onSelect:t.selectSlug},null,8,["item","bot","onCallback","onSelect"])]))),256)),t.paginate?(l(),F(S,{key:0,onPagination_page:t.nextSlugs,pagination:t.paginate},null,8,["onPagination_page","pagination"])):r("",!0)])):(l(),i("div",or,ir))])])]))}});const dr={props:["param"],data(){return{expressions:[{expression:null,description:"Нет проверки"},{expression:"/([a-z0-9]+)/i",description:"Проверка набора из латинских букв и цифр"},{expression:"/([а-яё0-9]+)/iu",description:"Проверка на кириллицу и цифры"},{expression:"/(?P<digit>\\d+)/",description:"Проверка на число"},{expression:"/^([a-z0-9_-]+.)*[a-z0-9_-]+@[a-z0-9_-]+(.[a-z0-9_-]+)*.[a-z]{2,6}$/",description:"Проверка Email"},{expression:"/^((8|+7)[- ]?)?((?d{3})?[- ]?)?[d- ]{7,10}$/",description:"Проверка номера телефона: +7(982)000-00-00"},{expression:"/^(0[1-9]|[12][0-9]|3[01])[.](0[1-9]|1[012])[.](19|20)dd$/",description:"Проверка даты по формату DD.MM.YYYY"},{expression:"/^[0-9]{4}-(0[1-9]|1[012])-(0[1-9]|1[0-9]|2[0-9]|3[01])$/",description:"Проверка даты по формату YYYY-MM-DD"},{expression:"/^(https?://)?([da-z.-]+).([a-z.]{2,6})([/w .-]*)*/?$/",description:"Проверка доменного имени"}]}},methods:{expressionsSelect(s){this.$emit("callback",{param:this.param,text:s.expression})}}},rr={class:"dropdown"},cr=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-regular fa-registered"})],-1),ur={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},_r=["onClick"];function hr(s,t,o,n,d,a){return l(),i("div",rr,[cr,e("div",ur,[e("li",null,[(l(!0),i(g,null,y(d.expressions,m=>(l(),i("a",{class:"dropdown-item",onClick:u=>a.expressionsSelect(m)},h(m.description||"-"),9,_r))),256))])])])}const mr=P(dr,[["render",hr]]),pr={key:0,class:"mb-2 d-flex justify-content-start flex-wrap"},br=e("p",null,"Связь цепочек: ",-1),gr=["onClick"],fr={key:0,class:"fa-solid fa-arrow-right font-12"},vr={class:"form-floating mb-2"},$r=["id"],yr=["for"],kr={class:"form-check mb-2"},Fr=e("label",{class:"form-check-label",for:"need-empty-dialog"}," Диалог без ожидания ответа ",-1),wr={key:1,class:"form-floating mb-2"},Cr=["id"],jr=["for"],Sr={key:2,class:"form-floating mb-2"},Vr=["id"],Pr=["for"],Ur={key:3,class:"mb-2"},Br={class:"d-flex justify-content-between"},Or=["for"],Tr=["id"],qr={class:"mb-2"},Dr={class:"d-flex justify-content-between"},Ir=["for"],Rr=["id"],Lr={class:"mb-2"},Mr={class:"form-check"},Ar=e("label",{class:"form-check-label",for:"need-dialog-image"}," В диалоге нужно изображение ",-1),Er={class:"form-check"},xr=e("label",{class:"form-check-label",for:"need-dialog-menu-inline"}," В диалоге нужно меню тексту ",-1),zr={class:"form-check"},Kr=e("label",{class:"form-check-label",for:"need-dialog-menu-reply"}," В диалоге нужно нижнее меню ",-1),Nr={key:4,class:"card mb-2"},Yr={class:"card-body"},Jr=e("h6",null,"Фотографии к диалогу",-1),Wr={class:"photo-preview d-flex justify-content-start flex-wrap w-100"},Hr={for:"location-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},Gr=e("span",null,"+",-1),Qr={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Xr={class:"remove"},Zr=["onClick"],ec={class:"mb-2 img-preview",style:{"margin-right":"10px"}},tc={class:"remove"},sc=["onClick"],oc={key:5,class:"card mb-2"},lc=e("div",{class:"card-header"},[e("h6",null,"Кнопки к тексту вопроса")],-1),ic={class:"card-body"},nc={key:6,class:"card mb-2"},ac=e("div",{class:"card-header"},[e("h6",null,"Кнопки в виде нижнего меню")],-1),dc={class:"card-body"},rc={class:"mb-2"},cc=e("label",{class:"form-check-label",for:"need-empty-dialog"}," Сохранить в переменную ",-1),uc=e("option",{selected:""},"Не выбрано",-1),_c=["value"],hc={class:"form-check mb-2"},mc=e("label",{class:"form-check-label",for:"need-set-flags"}," Установить флаги в соответствующее значение ",-1),pc={key:7,class:"mb-2"},bc=e("p",null,"Выбрать флаги",-1),gc=["onClick"],fc={key:8,class:"mb-2"},vc={key:0,class:"row"},$c=e("div",{class:"col-12"},[e("p",null,"Доступные для связывания диалоги:")],-1),yc={class:"col-md-12 mb-1"},kc={type:"button",class:"btn btn-outline-primary w-100 d-flex justify-content-between align-items-center",style:{"text-align":"left"}},Fc=["onClick"],wc={key:0,class:"fa-solid fa-link mr-2 text-success"},Cc={key:1,class:"row"},jc=e("div",{class:"col-12"},[e("div",{class:"alert alert-danger",role:"alert"}," Диалогов для связывания нет ")],-1),Sc=[jc],Vc=e("hr",null,null,-1),Pc={class:"mb-2"},Uc={type:"submit",class:"btn btn-outline-success p-3 w-100"},Bc={key:0},Oc={key:1},Tc={props:["item","bot"],data(){return{loading:!0,dialog_commands:[],dialog_commands_paginate_object:null,need_images:!1,need_inline_keyboard:!1,need_reply_keyboard:!1,need_set_flags:!1,flags_variants:[{title:"Является VIP",key:"is_vip",value:null},{title:"Является Админом",key:"is_admin",value:null},{title:"За работой",key:"is_work",value:null},{title:"Является менеджером",key:"is_manager",value:null}],store_variants:[{title:"Имя",key:"name"},{title:"Почта",key:"email"},{title:"Возраст",key:"age"},{title:"Город",key:"city"},{title:"Страна",key:"country"},{title:"Адрес",key:"address"},{title:"Телефон",key:"phone"},{title:"День рождение",key:"birthday"}],commandForm:{id:null,slug:null,pre_text:null,post_text:null,error_text:null,bot_id:null,input_pattern:null,inline_keyboard_id:null,reply_keyboard_id:null,images:null,next_bot_dialog_command_id:null,bot_dialog_group_id:null,is_empty:!1,result_flags:[],store_to:null,result_channel:null,inline_keyboard:null,reply_keyboard:null},photos:[]}},computed:{...C(["getDialogCommands","getDialogCommandsPaginateObject"]),filteredCommands(){return this.dialog_commands?this.dialog_commands.filter(s=>s.id!=this.commandForm.id):[]}},mounted(){this.item&&this.$nextTick(()=>{this.commandForm={id:this.item.id||null,slug:this.item.slug||null,pre_text:this.item.pre_text||null,post_text:this.item.post_text||null,error_text:this.item.error_text||null,is_empty:this.item.is_empty||!1,input_pattern:this.item.input_pattern||null,inline_keyboard_id:this.item.inline_keyboard_id||null,reply_keyboard_id:this.item.reply_keyboard_id||null,images:this.item.images||[],next_bot_dialog_command_id:this.item.next_bot_dialog_command_id||null,bot_dialog_group_id:this.item.bot_dialog_group_id||null,result_channel:this.item.result_channel||null,inline_keyboard:this.item.inline_keyboard||null,reply_keyboard:this.item.reply_keyboard||null,result_flags:this.item.result_flags||[],store_to:this.item.store_to||null},this.bot&&(this.commandForm.bot_id=this.bot.id||null),this.commandForm.inline_keyboard_id!=null&&(this.need_inline_keyboard=!0),this.commandForm.reply_keyboard_id!=null&&(this.need_reply_keyboard=!0),this.commandForm.images.length>0&&(this.need_images=!0),this.commandForm.result_flags.length>0&&(this.need_set_flags=!0)}),this.bot&&this.$nextTick(()=>{this.commandForm.bot_id=this.bot.id}),this.item&&(this.dialog_commands=this.getDialogCommands,this.dialog_commands_paginate_object=this.getDialogCommandsPaginateObject)},methods:{nextDialogs(s){this.loadDialogs(s)},loadDialogs(s=0){this.loading=!0,this.$store.dispatch("loadDialogCommands",{dataObject:{botId:this.bot.id||null,search:this.search},page:s}).then(t=>{this.loading=!1,this.dialog_commands=this.getDialogCommands,this.dialog_commands_paginate_object=this.getDialogCommandsPaginateObject}).catch(()=>{this.loading=!1})},doCommandLink(s){this.loading=!0,this.commandForm.next_bot_dialog_command_id=s},submit(){this.loading=!0;let s=new FormData;if(Object.keys(this.commandForm).forEach(t=>{const o=this.commandForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.photos){for(let t=0;t<this.photos.length;t++)s.append("files[]",this.photos[t]);s.delete("photos")}this.$store.dispatch(this.commandForm.id?"updateDialogCommand":"createDialogCommand",{dialogCommandForm:s}).then(t=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Успешная обработка диалоговой команды",type:"success"}),this.commandForm.id==null&&(this.commandForm={id:null,slug:null,pre_text:null,post_text:null,error_text:null,input_pattern:null,inline_keyboard_id:null,images:null,next_bot_dialog_command_id:null,bot_dialog_group_id:null,result_channel:null,inline_keyboard:null,is_empty:!1,result_flags:[],store_to:null},this.photos=[]),this.$emit("callback")}).catch(t=>{this.loading=!1})},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removePhoto(s,t){this[s].splice(t,1)},onChangePhotos(s){const t=s.target.files;for(let o=0;o<t.length;o++)this.photos.push(t[o])},saveInlineKeyboard(s){this.commandForm.inline_keyboard=s},saveReplyKeyboard(s){this.commandForm.reply_keyboard=s},addTextTo(s={param:null,text:null}){this.commandForm[s.param]=s.text},selectElementById(s){this.$emit("select-element",s)},selectFlag(s){(!this.commandForm.result_flags||!Array.isArray(this.commandForm.result_flags))&&(this.commandForm.result_flags=[]);let t=this.commandForm.result_flags.indexOf(s.key);t===-1?this.commandForm.result_flags.push(s.key):this.commandForm.result_flags.splice(t,1)}}},qc=Object.assign(Tc,{__name:"BotDialogCommandForm",setup(s){return(t,o)=>{const n=q("lazy");return l(),i("form",{onSubmit:o[13]||(o[13]=j((...d)=>t.submit&&t.submit(...d),["prevent"]))},[t.commandForm.next_bot_dialog_command_id?(l(),i("div",pr,[br,(l(!0),i(g,null,y(s.item.chain,(d,a)=>(l(),i("div",null,[e("span",{class:v(["badge cursor-pointer",{"bg-success":t.commandForm.id==d,"bg-primary":t.commandForm.id!=d}]),onClick:m=>t.selectElementById(d)},h(d),11,gr),a<s.item.chain.length-1?(l(),i("i",fr)):r("",!0)]))),256))])):r("",!0),e("div",vr,[c(e("input",{type:"text",class:"form-control",id:"commandForm-pre-text-"+t.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":o[0]||(o[0]=d=>t.commandForm.pre_text=d),required:""},null,8,$r),[[p,t.commandForm.pre_text]]),e("label",{for:"commandForm-pre-text-"+t.commandForm.id},"Текст диалога",8,yr)]),e("div",kr,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[1]||(o[1]=d=>t.commandForm.is_empty=d),id:"need-empty-dialog",checked:""},null,512),[[k,t.commandForm.is_empty]]),Fr]),t.commandForm.is_empty?r("",!0):(l(),i("div",wr,[c(e("input",{type:"text",class:"form-control",id:"commandForm-post-text-"+t.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":o[2]||(o[2]=d=>t.commandForm.post_text=d),required:""},null,8,Cr),[[p,t.commandForm.post_text]]),e("label",{for:"commandForm-post-text-"+t.commandForm.id},"Текст после успешного завершения диалога",8,jr)])),t.commandForm.is_empty?r("",!0):(l(),i("div",Sr,[c(e("input",{type:"text",class:"form-control",id:"commandForm-error-text-"+t.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":o[3]||(o[3]=d=>t.commandForm.error_text=d),required:""},null,8,Vr),[[p,t.commandForm.error_text]]),e("label",{for:"commandForm-error-text-"+t.commandForm.id},"Текст на случай ошибки корректности данных",8,Pr)])),t.commandForm.is_empty?r("",!0):(l(),i("div",Ur,[e("div",Br,[e("label",{class:"form-label",for:"commandForm-result-channel-"+t.commandForm.id},"Регулярное выражение для валидации данных ",8,Or),f(mr,{param:"input_pattern",onCallback:t.addTextTo},null,8,["onCallback"])]),c(e("input",{type:"text",class:"form-control",placeholder:"Регулярное выражение","aria-label":"Регулярное выражение","onUpdate:modelValue":o[4]||(o[4]=d=>t.commandForm.input_pattern=d),maxlength:"255",id:"commandForm-input-pattern-"+t.commandForm.id,"aria-describedby":"commandForm-input-pattern"},null,8,Tr),[[p,t.commandForm.input_pattern]])])),e("div",qr,[e("div",Dr,[e("label",{class:"form-label",for:"commandForm-result-channel-"+t.commandForm.id},"Канал для отправки данных ",8,Ir),s.bot?(l(),F(O,{key:0,token:s.bot.bot_token,param:"result_channel",onCallback:t.addTextTo},null,8,["token","onCallback"])):r("",!0)]),c(e("input",{type:"number",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":o[5]||(o[5]=d=>t.commandForm.result_channel=d),id:"commandForm-result-channel-"+t.commandForm.id,"aria-describedby":"bot-order-channel"},null,8,Rr),[[p,t.commandForm.result_channel]])]),e("div",Lr,[e("div",Mr,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[6]||(o[6]=d=>t.need_images=d),id:"need-dialog-image",checked:""},null,512),[[k,t.need_images]]),Ar]),e("div",Er,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[7]||(o[7]=d=>t.need_inline_keyboard=d),id:"need-dialog-menu-inline",checked:""},null,512),[[k,t.need_inline_keyboard]]),xr]),e("div",zr,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[8]||(o[8]=d=>t.need_reply_keyboard=d),id:"need-dialog-menu-reply",checked:""},null,512),[[k,t.need_reply_keyboard]]),Kr])]),t.need_images?(l(),i("div",Nr,[e("div",Yr,[Jr,e("div",Wr,[e("label",Hr,[Gr,e("input",{type:"file",id:"location-photos",multiple:"",accept:"image/*",onChange:o[9]||(o[9]=(...d)=>t.onChangePhotos&&t.onChangePhotos(...d)),style:{display:"none"}},null,32)]),t.photos.length>0?(l(!0),i(g,{key:0},y(t.photos,(d,a)=>(l(),i("div",Qr,[c(e("img",null,null,512),[[n,t.getPhoto(d).imageUrl]]),e("div",Xr,[e("a",{onClick:m=>t.removePhoto("photos",a)},"Удалить",8,Zr)])]))),256)):r("",!0),t.commandForm.images&&s.bot?(l(!0),i(g,{key:1},y(t.commandForm.images,(d,a)=>(l(),i("div",ec,[c(e("img",null,null,512),[[n,"/images-by-bot-id/"+s.bot.id+"/"+d]]),e("div",tc,[e("a",{onClick:m=>t.removePhoto("images",a)},"Удалить",8,sc)])]))),256)):r("",!0)])])])):r("",!0),t.need_inline_keyboard?(l(),i("div",oc,[lc,e("div",ic,[f(T,{onSave:t.saveInlineKeyboard,"edited-keyboard":t.commandForm.inline_keyboard},null,8,["onSave","edited-keyboard"])])])):r("",!0),t.need_reply_keyboard?(l(),i("div",nc,[ac,e("div",dc,[f(T,{onSave:t.saveReplyKeyboard,"edited-keyboard":t.commandForm.reply_keyboard},null,8,["onSave","edited-keyboard"])])])):r("",!0),e("div",rc,[cc,c(e("select",{class:"form-control","onUpdate:modelValue":o[10]||(o[10]=d=>t.commandForm.store_to=d)},[uc,(l(!0),i(g,null,y(t.store_variants,d=>(l(),i("option",{value:d.key},h(d.title||"Не указано"),9,_c))),256))],512),[[V,t.commandForm.store_to]])]),e("div",hc,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[11]||(o[11]=d=>t.need_set_flags=d),id:"need-set-flags",checked:""},null,512),[[k,t.need_set_flags]]),mc]),t.need_set_flags?(l(),i("div",pc,[bc,(l(!0),i(g,null,y(t.flags_variants,d=>(l(),i("span",{class:v(["badge text-info mr-2",{"bg-info text-white":t.commandForm.result_flags.indexOf(d.key)!=-1}]),onClick:a=>t.selectFlag(d)},h(d.title),11,gc))),256))])):r("",!0),t.commandForm.id?(l(),i("div",fc,[t.filteredCommands.length>0?(l(),i("div",vc,[$c,(l(!0),i(g,null,y(t.filteredCommands,(d,a)=>(l(),i("div",yc,[e("button",kc,[e("span",{onClick:m=>t.doCommandLink(d.id)},[t.commandForm.next_bot_dialog_command_id==d.id?(l(),i("i",wc)):r("",!0),_(" #"+h(d.id)+" "+h(d.pre_text||"Без текста"),1)],8,Fc),t.commandForm.next_bot_dialog_command_id==d.id?(l(),i("i",{key:0,class:"fa-solid fa-unlink text-danger",onClick:o[12]||(o[12]=m=>t.doCommandLink(null))})):r("",!0)])]))),256)),t.dialog_commands_paginate_object?(l(),F(S,{key:0,onPagination_page:t.nextDialogs,pagination:t.dialog_commands_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])):(l(),i("div",Cc,Sc))])):r("",!0),Vc,e("div",Pc,[e("button",Uc,[t.commandForm.id?(l(),i("span",Bc,"Обновить диалог")):(l(),i("span",Oc,"Добавить диалог"))])])],32)}}});const Dc={class:"row"},Ic={class:"col-md-2 col-12"},Rc=e("i",{class:"fa-regular fa-comment-dots",style:{"margin-right":"10px"}},null,-1),Lc={class:"col-md-10 col-12"},Mc={class:"input-group mb-3"},Ac={key:0,class:"row"},Ec={class:"col-md-12"},xc={class:"table"},zc=e("thead",null,[e("tr",null,[e("th",{class:"text-center",scope:"col"},"#"),e("th",{class:"text-center",scope:"col"},"Текст диалога"),e("th",{class:"text-center",scope:"col"},"Цепочки"),e("th",{class:"text-center",scope:"col"},"Текст успеха"),e("th",{class:"text-center",scope:"col"},"Текст ошибки"),e("th",{class:"text-center",scope:"col"},"Канал результата"),e("th",{class:"text-center",scope:"col"},"Флаги"),e("th",{class:"text-center",scope:"col"},"Сохранить в"),e("th",{class:"text-center",scope:"col"},"Есть изображения"),e("th",{class:"text-center",scope:"col"},"Есть паттерны"),e("th",{class:"text-center",scope:"col"},"Пустой"),e("th",{class:"text-center",scope:"col"},"Есть кнопки"),e("th",{class:"text-center",scope:"col"},"Есть меню"),e("th",{class:"text-center",scope:"col"},"Команды")])],-1),Kc={scope:"row"},Nc={class:"text-center"},Yc=["onClick"],Jc={class:"text-center"},Wc={key:0,class:"badge bg-primary"},Hc={key:1},Gc=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Qc=[Gc],Xc={class:"text-center"},Zc={key:0},eu={key:1},tu=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),su=[tu],ou={class:"text-center"},lu={key:0},iu={key:1},nu=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),au=[nu],du={class:"text-center"},ru={key:0},cu={key:1},uu=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),_u=[uu],hu={class:"text-center"},mu={key:0},pu={class:"badge bg-primary"},bu={key:1},gu=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),fu=[gu],vu={class:"text-center"},$u={key:0},yu={key:1},ku=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Fu=[ku],wu={class:"text-center"},Cu={key:0,class:"fa-solid fa-check text-success"},ju={key:1,class:"fa-solid fa-xmark text-danger"},Su={class:"text-center"},Vu={key:0},Pu={key:1},Uu=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),Bu=[Uu],Ou={class:"text-center"},Tu={key:0,class:"fa-solid fa-check text-success"},qu={key:1,class:"fa-solid fa-xmark text-danger"},Du={class:"text-center"},Iu={key:0,class:"fa-solid fa-check text-success"},Ru={key:1,class:"fa-solid fa-xmark text-danger"},Lu={class:"text-center"},Mu={key:0,class:"fa-solid fa-check text-success"},Au={key:1,class:"fa-solid fa-xmark text-danger"},Eu={class:"text-center"},xu={class:"dropdown"},zu=["disabled"],Ku=e("i",{class:"fa-solid fa-ellipsis"},null,-1),Nu=[Ku],Yu={class:"dropdown-menu"},Ju=["onClick"],Wu=e("i",{class:"fa-solid fa-arrow-left mr-1"},null,-1),Hu=e("hr",null,null,-1),Gu=["onClick"],Qu=e("i",{class:"fa-solid fa-clone mr-1"},null,-1),Xu=["onClick"],Zu=e("i",{class:"fa-solid fa-trash-can mr-1"},null,-1),e_={key:1,class:"row"},t_=e("div",{class:"col-12"},[e("div",{class:"alert alert-danger",role:"alert"}," Не найдено ни одного диалога! ")],-1),s_=[t_],o_={class:"modal fade",id:"dialog-command-modal-editor",tabindex:"-1"},l_={class:"modal-dialog modal-fullscreen"},i_={class:"modal-content"},n_=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"}," Создание диалогового сообщения "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),a_={class:"modal-body"},d_=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),r_={data(){return{bot:null,selected:null,loading:!0,dialog_commands:[],search:null,dialog_commands_paginate_object:null}},computed:{...C(["getDialogCommands","getCurrentBot","getDialogCommandsPaginateObject"])},mounted(){this.loadCurrentBot().then(()=>{this.loadDialogs()})},methods:{openEditor(s){this.loading=!0,this.$nextTick(()=>{this.selected=s,this.loading=!1})},removeCommand(s){this.loading=!0,this.$store.dispatch("removeDialogCommand",{dataObject:{dialogCommandId:s}}).then(t=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Диалоговая команда успешно удалена!",type:"success"}),this.loadDialogs(),this.$emit("callback")}).catch(t=>{this.loading=!1})},duplicate(s){this.loading=!0,this.$store.dispatch("duplicateDialogCommand",{dataObject:{dialogCommandId:s}}).then(t=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Диалоговая команда успешно продублирована!",type:"success"}),this.loadDialogs(),this.$emit("callback")}).catch(t=>{this.loading=!1})},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},selectDialog(s){this.$emit("select-dialog",s),this.$notify("Вы выбрали диалог из списка!")},nextDialogs(s){this.loadDialogs(s)},selectElement(s){this.loading=!0,this.$nextTick(()=>{this.selected=this.dialog_commands.find(t=>t.id===s)||null,this.loading=!1})},loadDialogs(s=0){this.$store.dispatch("loadDialogCommands",{dataObject:{botId:this.bot.id||null,search:this.search},page:s}).then(t=>{const o=this.selected;this.dialog_commands=this.getDialogCommands,this.dialog_commands_paginate_object=this.getDialogCommandsPaginateObject,this.loading=!0,this.$nextTick(()=>{o&&(this.selected=this.dialog_commands.find(n=>n.id===o.id)||null),this.loading=!1})}).catch(()=>{this.loading=!1})}}},c_=Object.assign(r_,{__name:"BotDialogGroupList",setup(s){return(t,o)=>(l(),i(g,null,[e("div",Dc,[e("div",Ic,[e("button",{type:"button",onClick:o[0]||(o[0]=n=>t.openEditor(null)),"data-bs-toggle":"modal","data-bs-target":"#dialog-command-modal-editor",class:"btn btn-outline-success mb-2 w-100"},[Rc,_("Новый диалог ")])]),e("div",Lc,[e("div",Mc,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск диалога","aria-label":"Поиск диалога","onUpdate:modelValue":o[1]||(o[1]=n=>t.search=n),"aria-describedby":"button-addon2"},null,512),[[p,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[2]||(o[2]=n=>t.loadDialogs(0)),type:"button",id:"button-addon2"},"Найти ")])])]),t.dialog_commands.length>0?(l(),i("div",Ac,[e("div",Ec,[e("table",xc,[zc,e("tbody",null,[(l(!0),i(g,null,y(t.dialog_commands,(n,d)=>(l(),i("tr",null,[e("th",Kc,h(n.id),1),e("td",Nc,[e("a",{"data-bs-toggle":"modal",onClick:a=>t.openEditor(n),"data-bs-target":"#dialog-command-modal-editor",href:"javascript:void(0)"},h(n.pre_text||"-"),9,Yc)]),e("td",Jc,[n.next_bot_dialog_command_id?(l(),i("span",Wc,"#"+h(n.next_bot_dialog_command_id||"-")+" ("+h(n.chain.length||0)+")",1)):(l(),i("span",Hc,Qc))]),e("td",Xc,[n.post_text?(l(),i("p",Zc,h(n.post_text),1)):(l(),i("p",eu,su))]),e("td",ou,[n.error_text?(l(),i("p",lu,h(n.error_text),1)):(l(),i("p",iu,au))]),e("td",du,[n.result_channel?(l(),i("p",ru,h(n.result_channel),1)):(l(),i("p",cu,_u))]),e("td",hu,[n.result_flags.length>0?(l(),i("p",mu,[(l(!0),i(g,null,y(n.result_flags,a=>(l(),i("span",pu,h(a||"-"),1))),256))])):(l(),i("p",bu,fu))]),e("td",vu,[n.store_to?(l(),i("p",$u,h(n.store_to),1)):(l(),i("p",yu,Fu))]),e("td",wu,[n.images.length>0?(l(),i("i",Cu)):(l(),i("i",ju))]),e("td",Su,[n.input_pattern?(l(),i("p",Vu,h(n.input_pattern),1)):(l(),i("p",Pu,Bu))]),e("td",Ou,[n.is_empty?(l(),i("i",Tu)):(l(),i("i",qu))]),e("td",Du,[n.inline_keyboard_id!=null?(l(),i("i",Iu)):(l(),i("i",Ru))]),e("td",Lu,[n.reply_keyboard_id!=null?(l(),i("i",Mu)):(l(),i("i",Au))]),e("td",Eu,[e("div",xu,[e("button",{disabled:t.loading,class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Nu,8,zu),e("ul",Yu,[e("li",null,[e("a",{onClick:a=>t.selectDialog(n),title:"Выбрать диалог",class:"dropdown-item cursor-pointer"},[Wu,_(" Выбрать диалог ")],8,Ju)]),Hu,e("li",null,[e("a",{title:"Дублирование команды",onClick:a=>t.duplicate(n.id),class:"dropdown-item cursor-pointer"},[Qu,_(" Дублирование диалога ")],8,Gu)]),e("li",null,[e("a",{onClick:a=>t.removeCommand(n.id),title:"Удаление команды",class:"dropdown-item cursor-pointer"},[Zu,_(" Удаление диалога ")],8,Xu)])])])])]))),256))])]),t.dialog_commands_paginate_object?(l(),F(S,{key:0,onPagination_page:t.nextDialogs,pagination:t.dialog_commands_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",e_,s_)),e("div",o_,[e("div",l_,[e("div",i_,[n_,e("div",a_,[t.bot&&!t.loading?(l(),F(qc,{key:0,item:t.selected,onCallback:t.loadDialogs,onSelectElement:t.selectElement,bot:t.bot},null,8,["item","onCallback","onSelectElement","bot"])):r("",!0)]),d_])])])],64))}}),u_=e("div",{class:"alert alert-success",role:"alert"},' Проверка правил идет по методу "И" - все правила должны выполняться для перехода на данную страницу, иначе будет вызвана страница из блока "иначе". Действия для "иначе" добавлять не обязательно. ',-1),__=e("h6",null,"Блок условий",-1),h_={key:0,class:"py-2"},m_={class:"form-label",id:"bot-domain"},p_=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),b_=e("div",null,"Напишите текст, который будет отображен пользователю вместе с основным контентом в случае если условие будет выполнено ",-1),g_={class:"dropdown mb-2"},f_=e("button",{class:"btn btn-outline-info dropdown-toggle w-100",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"}," Добавить условие ",-1),v_={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},$_=["onClick"],y_={key:1},k_={key:2,class:"list-group"},F_={key:0,class:"list-group-item d-flex justify-content-between align-items-center"},w_={class:"form-check"},C_={class:"form-check-label",for:"bot-user-is-vip"},j_={key:0},S_={key:1},V_=e("i",{class:"fa-solid fa-trash-can"},null,-1),P_=[V_],U_={key:1,class:"list-group-item d-flex justify-content-between align-items-center"},B_={class:"form-check"},O_={class:"form-check-label",for:"bot-user-is-admin"},T_={key:0},q_={key:1},D_=e("i",{class:"fa-solid fa-trash-can"},null,-1),I_=[D_],R_={key:2,class:"list-group-item d-flex justify-content-between align-items-center"},L_={class:"form-check"},M_={class:"form-check-label",for:"bot-user-is-deliveryman"},A_={key:0},E_={key:1},x_=e("i",{class:"fa-solid fa-trash-can"},null,-1),z_=[x_],K_={key:3,class:"list-group-item d-flex justify-content-between align-items-center"},N_={class:"form-check"},Y_={class:"form-check-label",for:"bot-user-is-work"},J_={key:0},W_={key:1},H_=e("i",{class:"fa-solid fa-trash-can"},null,-1),G_=[H_],Q_={key:4,class:"list-group-item d-flex justify-content-between align-items-center"},X_={class:"form-check"},Z_={class:"form-check-label",for:"bot-user-in-location"},eh={key:0},th={key:1},sh=e("i",{class:"fa-solid fa-trash-can"},null,-1),oh=[sh],lh={key:5,class:"list-group-item d-flex justify-content-between align-items-center"},ih=e("label",{class:"form-label",id:"bot-domain"}," Возраст от ",-1),nh=e("i",{class:"fa-solid fa-trash-can"},null,-1),ah=[nh],dh={key:6,class:"list-group-item d-flex justify-content-between align-items-center"},rh=e("label",{class:"form-label",id:"bot-domain"}," Только для города ",-1),ch=e("i",{class:"fa-solid fa-trash-can"},null,-1),uh=[ch],_h={key:7,class:"list-group-item d-flex justify-content-between align-items-center"},hh={class:"form-check"},mh={class:"form-check-label",for:"bot-user-sex"},ph={key:0},bh={key:1},gh=e("i",{class:"fa-solid fa-trash-can"},null,-1),fh=[gh],vh={key:8,class:"list-group-item"},$h={class:"mb-3"},yh={class:"d-flex justify-content-between align-items-center"},kh={class:"form-label d-flex w-100 align-items-center",id:"bot-order-channel"},Fh=["onClick"],wh=e("i",{class:"fa-solid fa-trash-can"},null,-1),Ch=[wh],jh=["onUpdate:modelValue"],Sh={key:3,class:"mt-5"},Vh={key:4,class:"d-flex justify-content-between"},Ph={key:6,class:"py-2"},Uh={class:"form-label",id:"bot-domain"},Bh=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Oh=e("div",null,'Напишите текст, который будет отображен пользователю вместе с основным контентом в случае если условие не будет выполнено и будет вызван блок "иначе" ',-1),Th={props:["bot","rulesForm"],data(){return{rules:[{id:1,title:"Является администратором",rules_block:"bot_user",rule:{is_admin:!0}},{id:2,title:"Является VIP-пользователем",rules_block:"bot_user",rule:{is_vip:!0}},{id:3,title:"Находится в заведении",rules_block:"bot_user",rule:{user_in_location:!0}},{id:4,title:"За работой",rules_block:"bot_user",rule:{is_work:!0}},{id:5,title:"Возраст от ...",rules_block:"bot_user",rule:{age:18}},{id:6,title:"Находится в городе ...",rules_block:"bot_user",rule:{city:"Краснодар"}},{id:7,title:"Пол",rules_block:"bot_user",rule:{sex:!0}},{id:8,title:"Состоит в канале",rules_block:"channels",rule:{channel:1}},{id:9,title:"Является Менеджером",rules_block:"bot_user",rule:{is_manager:!0}}]}},computed:{rulesForCustomFields(){let s=this.rules.filter(t=>t.key!=null);return console.log("filtered rules",s),s}},mounted(){},methods:{hasRuleKey(s){return this.rulesForm.rules_if==null?!1:(console.log("key=>",s||"-"),Object.keys(this.rulesForm.rules_if.bot_user).find(t=>t===s)!=null)},modifyChannel(s){this.rulesForm.rules_if.channels[s.param]=s.text},removeChannelFromRule(s){this.rulesForm.rules_if.channels.splice(s,1)},removeRule(s){delete this.rulesForm.rules_if.bot_user[s]},addRules(s){this.rulesForm.rules_if||(this.rulesForm.rules_if={bot_user:{},channels:[]}),s.rules_block==="bot_user"&&(this.rulesForm.rules_if.bot_user={...this.rulesForm.rules_if.bot_user,...s.rule}),s.rules_block==="channels"&&this.rulesForm.rules_if.channels.push(s.rule.channel)},loadCurrentBotFields(){return this.$store.dispatch("loadCurrentBotFields",{bot_id:this.bot.id}).then(s=>{(s.data||[]).forEach(o=>{o.is_active&&(this.rules.push({id:this.rules.length+1,title:o.label,key:o.key,type:o.type,rules_block:"bot_user",rule:{}}),o.type===0&&(this.rules[this.rules.length-1].rule[o.key]=""),o.type===1&&(this.rules[this.rules.length-1].rule[o.key]=0),o.type===2&&(this.rules[this.rules.length-1].rule[o.key]=!0))}),console.log("new rules=>",this.rules)})},attachPageToRule(s){s.id!=this.rulesForm.id?this.rulesForm.rules_else_page_id=s.id:this.$notify({title:"Конструктор страниц",text:"Вы не можете связать данную страницу с собой",type:"error"})}}},qh=Object.assign(Th,{__name:"PageRules",setup(s){return(t,o)=>{const n=U("Popper");return l(),i(g,null,[u_,__,s.rulesForm.rules_if?(l(),i("div",h_,[e("label",m_,[f(n,null,{content:b(()=>[b_]),default:b(()=>[p_]),_:1}),_(" Сообщение при успешном прохождении условий (не обязательно) ")]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст сообщения","aria-label":"Текст сообщения","onUpdate:modelValue":o[0]||(o[0]=d=>s.rulesForm.rules_if_message=d),maxlength:"255","aria-describedby":"rules-else-message"},`
            `,512),[[p,s.rulesForm.rules_if_message]])])):r("",!0),e("div",g_,[f_,e("ul",v_,[(l(!0),i(g,null,y(t.rules,d=>(l(),i("li",null,[e("a",{onClick:a=>t.addRules(d),class:"dropdown-item",href:"javascript:void(0)"},h(d.title||"Не указан"),9,$_)]))),256))])]),s.rulesForm.rules_if?(l(),i("h6",y_,"Выбранные условия")):r("",!0),s.rulesForm.rules_if?(l(),i("ul",k_,[t.hasRuleKey("is_vip")?(l(),i("li",F_,[e("div",w_,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[1]||(o[1]=d=>s.rulesForm.rules_if.bot_user.is_vip=d),type:"checkbox",id:"bot-user-is-vip"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_vip]]),e("label",C_,[s.rulesForm.rules_if.bot_user.is_vip?(l(),i("span",j_,"Является VIP-пользователем")):(l(),i("span",S_,"Не является VIP-пользователем"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[2]||(o[2]=d=>t.removeRule("is_vip"))},P_)])):r("",!0),t.hasRuleKey("is_admin")?(l(),i("li",U_,[e("div",B_,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[3]||(o[3]=d=>s.rulesForm.rules_if.bot_user.is_admin=d),type:"checkbox",id:"bot-user-is-admin"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_admin]]),e("label",O_,[s.rulesForm.rules_if.bot_user.is_admin?(l(),i("span",T_,"Является администратором")):(l(),i("span",q_,"Не является администратором"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[4]||(o[4]=d=>t.removeRule("is_admin"))},I_)])):r("",!0),t.hasRuleKey("is_deliveryman")?(l(),i("li",R_,[e("div",L_,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[5]||(o[5]=d=>s.rulesForm.rules_if.bot_user.is_deliveryman=d),type:"checkbox",id:"bot-user-is-deliveryman"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_deliveryman]]),e("label",M_,[s.rulesForm.rules_if.bot_user.is_deliveryman?(l(),i("span",A_,"Является доставщиком")):(l(),i("span",E_,"Не является доставщиком"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[6]||(o[6]=d=>t.removeRule("is_deliveryman"))},z_)])):r("",!0),t.hasRuleKey("is_work")?(l(),i("li",K_,[e("div",N_,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[7]||(o[7]=d=>s.rulesForm.rules_if.bot_user.is_work=d),type:"checkbox",id:"bot-user-is-work"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_work]]),e("label",Y_,[s.rulesForm.rules_if.bot_user.is_work?(l(),i("span",J_,"За работой")):(l(),i("span",W_,"Не работает"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[8]||(o[8]=d=>t.removeRule("is_work"))},G_)])):r("",!0),t.hasRuleKey("user_in_location")?(l(),i("li",Q_,[e("div",X_,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[9]||(o[9]=d=>s.rulesForm.rules_if.bot_user.user_in_location=d),type:"checkbox",id:"bot-user-in-location"},null,512),[[k,s.rulesForm.rules_if.bot_user.user_in_location]]),e("label",Z_,[s.rulesForm.rules_if.bot_user.user_in_location?(l(),i("span",eh,"Находится в заведении")):(l(),i("span",th,"Не находится в заведении"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[10]||(o[10]=d=>t.removeRule("user_in_location"))},oh)])):r("",!0),t.hasRuleKey("age")?(l(),i("li",lh,[e("div",null,[ih,c(e("input",{type:"text",class:"form-control",placeholder:"Возраст от","aria-label":"Возраст от","onUpdate:modelValue":o[11]||(o[11]=d=>s.rulesForm.rules_if.bot_user.age=d),maxlength:"255","aria-describedby":"bot-user-age"},null,512),[[p,s.rulesForm.rules_if.bot_user.age]])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[12]||(o[12]=d=>t.removeRule("age"))},ah)])):r("",!0),t.hasRuleKey("city")?(l(),i("li",dh,[e("div",null,[rh,c(e("input",{type:"text",class:"form-control",placeholder:"Город","aria-label":"Город","onUpdate:modelValue":o[13]||(o[13]=d=>s.rulesForm.rules_if.bot_user.city=d),maxlength:"255","aria-describedby":"bot-user-city"},null,512),[[p,s.rulesForm.rules_if.bot_user.city]])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[14]||(o[14]=d=>t.removeRule("city"))},uh)])):r("",!0),t.hasRuleKey("sex")?(l(),i("li",_h,[e("div",hh,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[15]||(o[15]=d=>s.rulesForm.rules_if.bot_user.sex=d),type:"checkbox",id:"bot-user-sex"},null,512),[[k,s.rulesForm.rules_if.bot_user.sex]]),e("label",mh,[s.rulesForm.rules_if.bot_user.sex?(l(),i("span",ph,"Только для мужчин")):(l(),i("span",bh,"Только для женщин"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[16]||(o[16]=d=>t.removeRule("sex"))},fh)])):r("",!0),s.rulesForm.rules_if.channels.length>0?(l(),i("li",vh,[_("Проверка нахождения в канале \\ группе: "),(l(!0),i(g,null,y(s.rulesForm.rules_if.channels,(d,a)=>(l(),i("div",$h,[e("div",yh,[e("label",kh,[f(O,{token:s.bot.bot_token,param:`${a}`,onCallback:t.modifyChannel},null,8,["token","param","onCallback"]),_(" Канал для проверки ")]),e("button",{type:"button",class:"btn btn-link text-danger",onClick:m=>t.removeChannelFromRule(a)},Ch,8,Fh)]),c(e("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":m=>s.rulesForm.rules_if.channels[a]=m,maxlength:"255","aria-describedby":"bot-order-channel"},null,8,jh),[[p,s.rulesForm.rules_if.channels[a]]])]))),256))])):r("",!0)])):r("",!0),s.rulesForm.rules_if?(l(),i("h6",Sh,"Иначе")):r("",!0),s.rulesForm.rules_else_page_id?(l(),i("p",Vh,[_("Вы выбрали страницу #"+h(s.rulesForm.rules_else_page_id)+' в качестве условия "иначе" ',1),e("a",{href:"javascript:void(0)",onClick:o[17]||(o[17]=d=>s.rulesForm.rules_else_page_id=null)},"Очистить")])):r("",!0),s.rulesForm.rules_if?(l(),F(I,{key:5,current:s.rulesForm.id,onCallback:t.attachPageToRule,editor:!1},null,8,["current","onCallback"])):r("",!0),s.rulesForm.rules_if?(l(),i("div",Ph,[e("label",Uh,[f(n,null,{content:b(()=>[Oh]),default:b(()=>[Bh]),_:1}),_(" Сообщение в случае невыполнения условий (не обязательно) ")]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст сообщения","aria-label":"Текст сообщения","onUpdate:modelValue":o[18]||(o[18]=d=>s.rulesForm.rules_else_message=d),maxlength:"255","aria-describedby":"rules-else-message"},`
            `,512),[[p,s.rulesForm.rules_else_message]])])):r("",!0)],64)}}});const Dh={class:"row"},Ih={class:"col-12 mb-2"},Rh=e("h6",null,"На странице выбраны следующие разделы",-1),Lh={class:"mini-pics justify-content-start"},Mh=e("i",{class:"fa-regular fa-images"},null,-1),Ah=[Mh],Eh=e("i",{class:"fa-regular fa-note-sticky"},null,-1),xh=[Eh],zh=e("i",{class:"fa-solid fa-photo-film"},null,-1),Kh=[zh],Nh=e("i",{class:"fa-regular fa-file-audio"},null,-1),Yh=[Nh],Jh=e("i",{class:"fa-regular fa-file-word"},null,-1),Wh=[Jh],Hh=e("i",{class:"fa-solid fa-link"},null,-1),Gh=[Hh],Qh=e("i",{class:"fa-solid fa-scroll"},null,-1),Xh=[Qh],Zh=e("i",{class:"fa-regular fa-comment-dots"},null,-1),em=[Zh],tm=e("i",{class:"fa-solid fa-scale-balanced"},null,-1),sm=[tm],om=e("i",{class:"fa-regular fa-keyboard"},null,-1),lm=[om],im=e("i",{class:"fa-solid fa-ellipsis"},null,-1),nm=[im],am={class:"row"},dm={class:"col-8 mb-2"},rm={class:"form-label",id:"bot-domain"},cm=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),um=e("div",null,[_(" Команда должна начинаться с символа . и *"),e("br"),_(" Например: .*Меню"),e("br")],-1),_m=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),hm={class:"col-4 mb-2 d-flex justify-content-end align-items-end"},mm={class:"btn-group",style:{background:"white"},role:"group","aria-label":"Basic example"},pm={key:0,type:"submit",title:"Сохранить страницу",class:"btn btn-primary min-menu-btn"},bm=e("i",{class:"fa-regular fa-floppy-disk"},null,-1),gm=[bm],fm=e("i",{class:"fa-solid fa-xmark text-danger"},null,-1),vm=[fm],$m=e("button",{type:"button",title:"Список страниц","data-bs-toggle":"modal","data-bs-target":"#pages-modal",class:"btn btn-outline-primary min-menu-btn"},[e("i",{class:"fa-solid fa-list-ol"})],-1),ym={class:"col-12 mb-2"},km={class:"form-check"},Fm=e("label",{class:"form-check-label",for:"is-external"}," Внешнее управление страницей ",-1),wm={key:0,class:"row"},Cm={class:"col-12 mb-2"},jm={class:"form-label d-flex justify-content-between align-items-center mb-0",id:"bot-domain"},Sm=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Vm=e("div",null,[_(" Текстовый редактор. Данный текст будет в таком"),e("br"),_(" же виде отображен в посте в телеграм. ")],-1),Pm=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Um={class:"form-floating"},Bm={for:"floatingTextarea2"},Om={key:0},Tm={class:"col-12 mb-2"},qm={class:"nav nav-tabs justify-content-center"},Dm=e("i",{class:"fa-regular fa-keyboard"},null,-1),Im=e("span",null,"Нижнее меню",-1),Rm=[Dm,Im],Lm=e("i",{class:"fa-solid fa-ellipsis"},null,-1),Mm=e("span",null,"Меню под текстом",-1),Am=[Lm,Mm],Em=e("i",{class:"fa-regular fa-images"},null,-1),xm=e("span",null,"Изображения",-1),zm=[Em,xm],Km=e("i",{class:"fa-solid fa-photo-film"},null,-1),Nm=e("span",null,"Видео",-1),Ym=[Km,Nm],Jm=e("i",{class:"fa-regular fa-note-sticky"},null,-1),Wm=e("span",null,"Стикеры",-1),Hm=[Jm,Wm],Gm=e("i",{class:"fa-regular fa-file-audio"},null,-1),Qm=e("span",null,"Аудио",-1),Xm=[Gm,Qm],Zm=e("i",{class:"fa-regular fa-file-word"},null,-1),ep=e("span",null,"Документы",-1),tp=[Zm,ep],sp=e("i",{class:"fa-solid fa-link"},null,-1),op=e("span",null,"Другая страница",-1),lp=[sp,op],ip=e("i",{class:"fa-solid fa-scroll"},null,-1),np=e("span",null,"Скрипт",-1),ap=[ip,np],dp=e("i",{class:"fa-regular fa-comment-dots"},null,-1),rp=e("span",null,"Начало диалога",-1),cp=[dp,rp],up=e("i",{class:"fa-solid fa-scale-balanced"},null,-1),_p=e("span",null,"Правила",-1),hp=[up,_p],mp={key:0},pp={class:"col-12 mb-2"},bp={class:"form-check"},gp=e("label",{class:"form-check-label",for:"need-reply-menu"}," Нижнее меню страницы ",-1),fp={key:0,class:"col-12 mb-2"},vp={class:"card"},$p={class:"card-header d-flex justify-between align-items-center"},yp=e("h6",null,"Конструктор нижнего меню",-1),kp={key:0},Fp={key:1},wp={class:"card-body"},Cp={class:"row"},jp={class:"col-12 mb-2"},Sp={class:"form-label",id:"bot-domain"},Vp=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Pp=e("div",null," Заголовок для нижнего меню ",-1),Up={key:1},Bp={class:"col-12 mb-2"},Op={class:"form-check"},Tp=e("label",{class:"form-check-label",for:"need-inline-menu"}," Меню под текстом страницы ",-1),qp={key:0,class:"col-12 mb-2"},Dp={class:"card"},Ip={class:"card-header d-flex justify-between align-items-center"},Rp=e("h6",null,"Конструктор меню в сообщении",-1),Lp={key:0},Mp={key:1},Ap={class:"card-body"},Ep={key:2},xp={class:"col-12 mb-2"},zp={class:"form-check"},Kp=e("label",{class:"form-check-label",for:"need-page-images"}," Изображения на странице (максимум 10) ",-1),Np={key:0,class:"col-12 mb-2"},Yp={class:"card mb-3"},Jp=e("div",{class:"card-header"},[e("h6",null,"Загрузите изображения с файловой системы")],-1),Wp={class:"card-body d-flex justify-content-start"},Hp={for:"photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},Gp={class:"row"},Qp={key:0,class:"col-12 d-flex flex-wrap"},Xp={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Zp={class:"remove"},eb=["onClick"],tb={key:1},sb={key:2,class:"col-12 d-flex flex-wrap"},ob={class:"mb-2 img-preview",style:{"margin-right":"10px"}},lb={class:"remove"},ib=["onClick"],nb={key:3},ab={class:"col-12 mb-2"},db={class:"form-check"},rb=e("label",{class:"form-check-label",for:"need-page-video"}," Видео к странице ",-1),cb={key:0,class:"col-12 mb-2"},ub=e("p",{class:"alert alert-danger"},[e("strong",null,"Внимание!"),_(" не больше 10 видео на 1й странице! ")],-1),_b={key:4},hb={class:"col-12 mb-2"},mb={class:"form-check"},pb=e("label",{class:"form-check-label",for:"need-page-sticker"}," Стикер к странице ",-1),bb={key:0,class:"col-12 mb-2"},gb={key:5},fb={class:"col-12 mb-2"},vb={class:"form-check"},$b=e("label",{class:"form-check-label",for:"need-page-audio"}," Звук к странице ",-1),yb={key:0,class:"col-12 mb-2"},kb=e("p",{class:"alert alert-danger"},[e("strong",null,"Внимание!"),_(" не больше 10 аудио на 1й странице! ")],-1),Fb={key:6},wb={class:"col-12 mb-2"},Cb={class:"form-check"},jb=e("label",{class:"form-check-label",for:"need-page-document"}," Документ \\ презентацию к странице \\ картинку в оригинале ",-1),Sb={key:0,class:"col-12 mb-2"},Vb=e("p",{class:"alert alert-danger"},[e("strong",null,"Внимание!"),_(" не больше 10 документов на 1й странице! ")],-1),Pb={key:7},Ub={class:"col-12 mb-2"},Bb={class:"form-check"},Ob=e("label",{class:"form-check-label",for:"need-page-attach"}," Связать с другой страницей ",-1),Tb={key:0,class:"col-12 mb-2"},qb={key:0},Db={key:8},Ib={class:"col-12 mb-2"},Rb={class:"form-check"},Lb=e("label",{class:"form-check-label",for:"need-slug-attach"}," Привязать скрипт ",-1),Mb={key:0,class:"col-12 mb-2"},Ab={key:0},Eb={key:9},xb={class:"col-12 mb-2"},zb={class:"form-check"},Kb=e("label",{class:"form-check-label",for:"need-dialog-attach"}," Привязать начало диалога ",-1),Nb={key:0,class:"col-12 mb-2"},Yb={key:0},Jb={key:10},Wb={class:"col-12 mb-2"},Hb={class:"form-check"},Gb=e("label",{class:"form-check-label",for:"need-rules"}," Нужны правила загрузки страницы ",-1),Qb={key:0,class:"col-12 mb-2"},Xb={class:"modal fade",id:"save-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Zb={class:"modal-dialog"},e1={class:"modal-content"},t1=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"Сохранение страницы"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),s1={class:"modal-body"},o1={key:0,class:"row"},l1={class:"col-12 mb-2"},i1={class:"d-flex justify-between"},n1={class:"col-12 mb-2"},a1=e("h6",null,"На странице выбраны следующие разделы",-1),d1={class:"mini-pics"},r1=e("i",{class:"fa-regular fa-images"},null,-1),c1=[r1],u1=e("i",{class:"fa-regular fa-note-sticky"},null,-1),_1=[u1],h1=e("i",{class:"fa-solid fa-photo-film"},null,-1),m1=[h1],p1=e("i",{class:"fa-regular fa-file-audio"},null,-1),b1=[p1],g1=e("i",{class:"fa-regular fa-file-word"},null,-1),f1=[g1],v1=e("i",{class:"fa-solid fa-link"},null,-1),$1=[v1],y1=e("i",{class:"fa-solid fa-scroll"},null,-1),k1=[y1],F1=e("i",{class:"fa-regular fa-comment-dots"},null,-1),w1=[F1],C1=e("i",{class:"fa-solid fa-scale-balanced"},null,-1),j1=[C1],S1=e("i",{class:"fa-regular fa-keyboard"},null,-1),V1=[S1],P1=e("i",{class:"fa-solid fa-ellipsis"},null,-1),U1=[P1],B1={key:0,class:"col-12 mb-2"},O1={class:"form-check"},T1=e("label",{class:"form-check-label",for:"need-show-qr-and-link"}," Показать ссылку на страницу и QR-код ",-1),q1={key:1,class:"col-12 mb-2"},D1={class:"d-flex justify-content-center"},I1={style:{width:"200px",height:"200px"}},R1={class:"col-12 mb-2"},L1={class:"form-label",id:"bot-domain"},M1=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),A1=e("div",null,"Напишите для себя пояснение для чего нужна данная страница. Это поможет другим менеджерам лучше понять Вас. ",-1),E1=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),x1=e("div",{class:"col-12"},[e("button",{type:"submit",class:"btn btn-primary w-100 p-3"},"Сохранить ")],-1),z1=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Не сохранять")],-1),K1={class:"modal fade",id:"pages-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},N1={class:"modal-dialog"},Y1={class:"modal-content"},J1={class:"modal-body"},W1={data(){return{tab:0,saveModal:null,page:null,need_show_qr_and_link:!1,need_clean:!1,load:!1,photos:[],showReplyTemplateSelector:!1,showInlineTemplateSelector:!1,showMenu:!1,need_page_sticker:!1,need_page_audios:!1,need_page_documents:!1,need_page_video:!1,need_page_images:!1,need_inline_menu:!1,need_reply_menu:!1,need_attach_page:!1,need_attach_dialog:!1,need_attach_slug:!1,need_rules:!1,bot:null,pageForm:{id:null,content:"",command:null,slug:null,comment:null,videos:[],images:[],audios:[],documents:[],sticker:null,reply_keyboard_title:null,reply_keyboard:null,inline_keyboard:null,is_external:!1,next_page_id:null,next_bot_dialog_command_id:null,next_bot_menu_slug_id:null,rules_if:null,rules_else_page_id:null,rules_if_message:null,rules_else_message:null}}},watch:{need_page_images:function(s,t){this.need_page_images||(this.photos=[],this.pageForm.images=[])},need_page_audios:function(s,t){this.need_page_audios||(this.pageForm.audios=[])},need_page_documents:function(s,t){this.need_page_documents||(this.pageForm.documents=[])},need_page_sticker:function(s,t){this.need_page_sticker||(this.pageForm.sticker=null)},need_page_video:function(s,t){this.need_page_video||(this.pageForm.videos=[])},need_inline_menu:function(s,t){this.need_inline_menu||(this.pageForm.inline_keyboard=null,this.pageForm.inline_keyboard_id=null)},need_rules:function(s,t){this.need_rules||(this.pageForm.rules_if=null,this.pageForm.rules_else_page_id=null,this.pageForm.rules_if_message=null,this.pageForm.rules_else_message=null)},need_reply_menu:function(s,t){this.need_reply_menu||(this.pageForm.reply_keyboard=null,this.pageForm.reply_keyboard_id=null)},need_attach_page:function(s,t){this.need_attach_page||(this.pageForm.next_page_id=null)},need_attach_dialog:function(s,t){this.need_attach_dialog||(this.pageForm.next_bot_dialog_command_id=null)},need_attach_slug:function(s,t){this.need_attach_slug||(this.pageForm.next_bot_menu_slug_id=null)},pageForm:{handler:function(s){this.pageForm.reply_keyboard!=null&&(this.need_reply_menu=!0),this.pageForm.inline_keyboard!=null&&(this.need_inline_menu=!0),this.pageForm.images.length>0&&(this.need_page_images=!0),this.pageForm.next_bot_dialog_command_id!=null&&(this.need_attach_dialog=!0),this.pageForm.next_bot_menu_slug_id!=null&&(this.need_attach_slug=!0),this.pageForm.next_page_id!=null&&(this.need_attach_page=!0),this.pageForm.rules_if!=null&&(this.need_rules=!0),this.pageForm.videos.length>0&&(this.need_page_video=!0),this.pageForm.audios.length>0&&(this.need_page_audios=!0),this.pageForm.documents.length>0&&(this.need_page_documents=!0),this.pageForm.sticker&&(this.need_page_sticker=!0),this.need_clean=!0},deep:!0}},computed:{...C(["getCurrentBot"]),qr(){return"https://api.qrserver.com/v1/create-qr-code/?size=450x450&qzone=2&data="+this.link},pageLink(){if(!this.pageForm.id)return"Ссылка недоступна";let s="";for(let t=0;t<10-(""+this.pageForm.id).length;t++)s+="0";return s+=this.pageForm.id,"https://t.me/"+this.getCurrentBot.bot_domain+"?start="+btoa("004"+s)}},mounted(){this.page?this.preparePageForm():this.clearForm(),this.loadCurrentBot().then(()=>{this.saveModal=new bootstrap.Modal(document.getElementById("save-modal"),{})})},methods:{preparePageForm(){let s=this.page;this.photos=[],this.pageForm={id:s.id,slug_id:s.slug?s.slug.id:null,content:s.content,command:s.slug?s.slug.command:null,slug:s.slug?s.slug.slug:null,comment:s.slug?s.slug.comment:null,images:s.images||[],sticker:s.sticker||null,reply_keyboard_title:s.reply_keyboard_title||null,reply_keyboard_id:s.reply_keyboard_id||null,inline_keyboard_id:s.inline_keyboard_id||null,reply_keyboard:s.replyKeyboard||null,inline_keyboard:s.inlineKeyboard||null,next_page_id:s.next_page_id||null,next_bot_dialog_command_id:s.next_bot_dialog_command_id||null,next_bot_menu_slug_id:s.next_bot_menu_slug_id||null,is_external:s.is_external||!1,rules_if:s.rules_if||null,rules_else_page_id:s.rules_else_page_id||null,audios:s.audios||[],documents:s.documents||[],videos:s.videos||[],rules_if_message:s.rules_if_message||null,rules_else_message:s.rules_else_message||null}},copyToClipBoard(s){navigator.clipboard.writeText(s).then(()=>{this.$notify({title:"Копирование",text:"Ссылка скопирована в буфер"})}).catch(t=>{this.$notify({title:"Копирование",text:"Ошибка копирования",type:"error"})})},associateDialog(s){this.pageForm.next_bot_dialog_command_id=s.id},associateSlug(s){this.pageForm.next_bot_menu_slug_id=s.id},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},attachPage(s){s.id!=this.pageForm.id?this.pageForm.next_page_id=s.id:this.$notify({title:"Конструктор страниц",text:"Вы не можете связать данную страницу с собой",type:"error"})},injectContent(s){this.pageForm.content?this.pageForm.content+=s.text:this.pageForm.content=s.text},clearForm(){this.photos=[],this.pageForm={id:null,content:null,command:null,slug:null,comment:null,sticker:null,images:[],reply_keyboard:null,inline_keyboard:null,is_external:!1,videos:[],audios:[],documents:[],reply_keyboard_title:null,reply_keyboard_id:null,inline_keyboard_id:null,next_page_id:null,next_bot_dialog_command_id:null,next_bot_menu_slug_id:null,rules_if_message:null,rules_else_message:null},this.photos=[],this.showReplyTemplateSelector=!1,this.showInlineTemplateSelector=!1,this.need_page_images=!1,this.need_page_video=!1,this.need_inline_menu=!1,this.need_reply_menu=!1,this.need_attach_page=!1,this.need_attach_dialog=!1,this.need_attach_slug=!1,this.need_rules=!1,this.need_page_audios=!1,this.need_page_documents=!1,this.need_page_sticker=!1,this.$nextTick(()=>{this.need_clean=!1})},openSaveModal(){this.saveModal.show()},submitPage(){let s=new FormData;if(Object.keys(this.pageForm).forEach(t=>{const o=this.pageForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.bot&&s.append("bot_id",this.bot.id),this.photos.length>0)for(let t=0;t<this.photos.length;t++)s.append("photos[]",this.photos[t]);this.$store.dispatch(this.pageForm.id==null?"createPage":"updatePage",{pageForm:s}).then(t=>{this.pageForm.id==null&&(this.load=!0,this.$nextTick(()=>{this.load=!1,this.clearForm()})),this.saveModal.hide(),this.$emit("callback",t.data),this.$notify({title:"Конструктор ботов",text:this.pageForm.id==null?"Страница успешно создана!":"Страница успешно обновлена!",type:"success"}),this.pageForm.id!=null&&this.$store.dispatch("loadPages",{dataObject:{botId:this.bot.id},page:localStorage.getItem(`cashman_pagelist_${this.bot.id}_page_index`)||0})}).catch(t=>{})},saveInlineKeyboard(s){this.pageForm.inline_keyboard=s},selectReplyKeyboard(s){this.pageForm.reply_keyboard=s,this.showReplyTemplateSelector=!1},selectInlineKeyboard(s){this.pageForm.inline_keyboard=s,this.showInlineTemplateSelector=!1},saveReplyKeyboard(s){this.pageForm.reply_keyboard=s},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removePhoto(s){this.photos.splice(s,1)},removeImage(s){this.pageForm.images.splice(s,1)},onChangePhotos(s){const t=s.target.files;for(let o=0;o<t.length;o++)this.photos.push(t[o])},onChange(s){this.pageForm.content=s},selectPhoto(s){this.pageForm.images||(this.pageForm.images=[]);let t=this.pageForm.images.indexOf(s.file_id);t!==-1?this.pageForm.images.splice(t,1):this.pageForm.images.push(s.file_id)},selectSticker(s){this.pageForm.sticker=s.file_id},selectVideo(s){this.pageForm.videos||(this.pageForm.videos=[]);let t=this.pageForm.videos.indexOf(s.file_id);t!==-1?this.pageForm.videos.splice(t,1):this.pageForm.videos.push(s.file_id)},selectAudio(s){this.pageForm.audios||(this.pageForm.audios=[]);let t=this.pageForm.audios.indexOf(s.file_id);if(s.type==="voice"){if(t!==-1){this.pageForm.audios.splice(t,1);return}this.pageForm.audios=[s.file_id];return}t!==-1?this.pageForm.audios.splice(t,1):this.pageForm.audios.push(s.file_id)},selectDocument(s){this.pageForm.documents||(this.pageForm.documents=[]);let t=this.pageForm.documents.indexOf(s.file_id);t!==-1?this.pageForm.documents.splice(t,1):this.pageForm.documents.push(s.file_id)},pageListCallback(s){this.load=!0,this.page=s,this.preparePageForm(),this.$nextTick(()=>{this.load=!1})}}},N0=Object.assign(W1,{__name:"Page",setup(s){return(t,o)=>{const n=U("Popper"),d=q("lazy");return l(),i(g,null,[t.bot?(l(),i("form",{key:0,id:"page-construct",onSubmit:o[33]||(o[33]=j((...a)=>t.openSaveModal&&t.openSaveModal(...a),["prevent"]))},[e("div",Dh,[e("div",Ih,[Rh,e("ul",Lh,[e("li",{title:"Изображения",class:v({active:t.need_page_images})},Ah,2),e("li",{title:"Стикеры",class:v({active:t.need_page_sticker})},xh,2),e("li",{title:"Видео",class:v({active:t.need_page_video})},Kh,2),e("li",{title:"Аудио",class:v({active:t.need_page_audios})},Yh,2),e("li",{title:"Документы",class:v({active:t.need_page_documents})},Wh,2),e("li",{title:"Страницы",class:v({active:t.need_attach_page})},Gh,2),e("li",{title:"Скрипты",class:v({active:t.need_attach_slug})},Xh,2),e("li",{title:"Диалоги",class:v({active:t.need_attach_dialog})},em,2),e("li",{title:"Правила",class:v({active:t.need_rules})},sm,2),e("li",{title:"Нижнее меню",class:v({active:t.need_reply_menu})},lm,2),e("li",{title:"Текстовое меню",class:v({active:t.need_inline_menu})},nm,2)])])]),e("div",am,[e("div",dm,[e("label",rm,[f(n,null,{content:b(()=>[um]),default:b(()=>[cm]),_:1}),_(" Команда "),_m]),c(e("input",{type:"text",class:"form-control",placeholder:"Команда","aria-label":"Команда","onUpdate:modelValue":o[0]||(o[0]=a=>t.pageForm.command=a),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[p,t.pageForm.command]])]),e("div",hm,[e("div",mm,[t.pageForm.id||t.need_clean?(l(),i("button",pm,gm)):r("",!0),t.pageForm.id||t.need_clean?(l(),i("button",{key:1,type:"button",onClick:o[1]||(o[1]=(...a)=>t.clearForm&&t.clearForm(...a)),title:"Очистить \\ Новая страница",class:"btn btn-outline-primary min-menu-btn"},vm)):r("",!0),$m])]),e("div",ym,[e("div",km,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[2]||(o[2]=a=>t.pageForm.is_external=a),type:"checkbox",id:"is-external"},null,512),[[k,t.pageForm.is_external]]),Fm])])]),t.pageForm.is_external?r("",!0):(l(),i("div",wm,[e("div",Cm,[e("label",jm,[e("div",null,[f(n,null,{content:b(()=>[Vm]),default:b(()=>[Sm]),_:1}),_(" Текстовое содержимое страницы "),Pm]),f(W,{param:"content",onCallback:t.injectContent},null,8,["onCallback"])]),e("div",Um,[c(e("textarea",{class:"form-control","onUpdate:modelValue":o[3]||(o[3]=a=>t.pageForm.content=a),maxlength:"4096",placeholder:"Введите текст",id:"floatingTextarea2",style:{"min-height":"300px"}},null,512),[[p,t.pageForm.content]]),e("label",Bm,[_("Содержимое страницы "),t.pageForm.content?(l(),i("span",Om,h(t.pageForm.content.length)+"/4096 ",1)):r("",!0)])])]),e("div",Tm,[e("ul",qm,[e("li",{class:"nav-item",onClick:o[4]||(o[4]=a=>t.tab=0)},[e("a",{class:v([{active:t.tab===0},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},Rm,2)]),e("li",{class:"nav-item",onClick:o[5]||(o[5]=a=>t.tab=1)},[e("a",{class:v([{active:t.tab===1},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},Am,2)]),e("li",{class:"nav-item",onClick:o[6]||(o[6]=a=>t.tab=2)},[e("a",{class:v([{active:t.tab===2},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},zm,2)]),e("li",{class:"nav-item",onClick:o[7]||(o[7]=a=>t.tab=3)},[e("a",{class:v([{active:t.tab===3},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},Ym,2)]),e("li",{class:"nav-item",onClick:o[8]||(o[8]=a=>t.tab=4)},[e("a",{class:v([{active:t.tab===4},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},Hm,2)]),e("li",{class:"nav-item",onClick:o[9]||(o[9]=a=>t.tab=5)},[e("a",{class:v([{active:t.tab===5},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},Xm,2)]),e("li",{class:"nav-item",onClick:o[10]||(o[10]=a=>t.tab=6)},[e("a",{class:v([{active:t.tab===6},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},tp,2)]),e("li",{class:"nav-item",onClick:o[11]||(o[11]=a=>t.tab=7)},[e("a",{class:v([{active:t.tab===7},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},lp,2)]),e("li",{class:"nav-item",onClick:o[12]||(o[12]=a=>t.tab=8)},[e("a",{class:v([{active:t.tab===8},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},ap,2)]),e("li",{class:"nav-item",onClick:o[13]||(o[13]=a=>t.tab=9)},[e("a",{class:v([{active:t.tab===9},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},cp,2)]),e("li",{class:"nav-item",onClick:o[14]||(o[14]=a=>t.tab=10)},[e("a",{class:v([{active:t.tab===10},"nav-link d-flex flex-column justify-content-center align-items-center font-12"]),href:"javascript:void(0)"},hp,2)])])]),t.tab===0?(l(),i("div",mp,[e("div",pp,[e("div",bp,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[15]||(o[15]=a=>t.need_reply_menu=a),type:"checkbox",id:"need-reply-menu"},null,512),[[k,t.need_reply_menu]]),gp])]),t.need_reply_menu?(l(),i("div",fp,[e("div",vp,[e("div",$p,[yp,e("button",{class:v(["btn",{"btn-outline-primary":!t.showReplyTemplateSelector,"btn-primary":t.showReplyTemplateSelector}]),type:"button",onClick:o[16]||(o[16]=a=>t.showReplyTemplateSelector=!t.showReplyTemplateSelector)},[t.showReplyTemplateSelector?(l(),i("span",Fp," Скрыть шаблоны меню")):(l(),i("span",kp," Открыть шаблоны меню"))],2)]),e("div",wp,[e("div",Cp,[e("div",jp,[e("label",Sp,[f(n,null,{content:b(()=>[Pp]),default:b(()=>[Vp]),_:1}),_(" Заголовок ")]),c(e("input",{type:"text",class:"form-control",placeholder:"Заголовок меню","aria-label":"Заголовок меню","onUpdate:modelValue":o[17]||(o[17]=a=>t.pageForm.reply_keyboard_title=a),maxlength:"255","aria-describedby":"bot-domain"},null,512),[[p,t.pageForm.reply_keyboard_title]])])]),t.showReplyTemplateSelector?(l(),F(R,{key:0,class:"mb-2",type:"reply",onSelect:t.selectReplyKeyboard,"select-mode":!0},null,8,["onSelect"])):(l(),F(T,{key:1,type:"reply",onSave:t.saveReplyKeyboard,"edited-keyboard":t.pageForm.reply_keyboard},null,8,["onSave","edited-keyboard"]))])])])):r("",!0)])):r("",!0),t.tab===1?(l(),i("div",Up,[e("div",Bp,[e("div",Op,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[18]||(o[18]=a=>t.need_inline_menu=a),type:"checkbox",id:"need-inline-menu"},null,512),[[k,t.need_inline_menu]]),Tp])]),t.need_inline_menu?(l(),i("div",qp,[e("div",Dp,[e("div",Ip,[Rp,e("button",{class:v(["btn",{"btn-outline-primary":!t.showInlineTemplateSelector,"btn-primary":t.showInlineTemplateSelector}]),type:"button",onClick:o[19]||(o[19]=a=>t.showInlineTemplateSelector=!t.showInlineTemplateSelector)},[t.showInlineTemplateSelector?(l(),i("span",Mp," Скрыть шаблоны меню")):(l(),i("span",Lp," Открыть шаблоны меню"))],2)]),e("div",Ap,[t.showInlineTemplateSelector?(l(),F(R,{key:0,class:"mb-2",type:"inline",onSelect:t.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(l(),F(T,{key:1,type:"inline",onSave:t.saveInlineKeyboard,"edited-keyboard":t.pageForm.inline_keyboard},null,8,["onSave","edited-keyboard"]))])])])):r("",!0)])):r("",!0),t.tab===2?(l(),i("div",Ep,[e("div",xp,[e("div",zp,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[20]||(o[20]=a=>t.need_page_images=a),type:"checkbox",id:"need-page-images"},null,512),[[k,t.need_page_images]]),Kp])]),t.need_page_images?(l(),i("div",Np,[e("div",Yp,[Jp,e("div",Wp,[e("label",Hp,[_(" + "),e("input",{type:"file",id:"photos",multiple:"",accept:"image/*",onChange:o[21]||(o[21]=(...a)=>t.onChangePhotos&&t.onChangePhotos(...a)),style:{display:"none"}},null,32)]),e("div",Gp,[t.photos.length>0?(l(),i("div",Qp,[(l(!0),i(g,null,y(t.photos,(a,m)=>(l(),i("div",Xp,[c(e("img",null,null,512),[[d,t.getPhoto(a).imageUrl]]),e("div",Zp,[e("a",{onClick:u=>t.removePhoto(m)},"Удалить",8,eb)])]))),256))])):r("",!0),t.pageForm.images.length>0?(l(),i("h6",tb,"Ранее загруженные фотографии")):r("",!0),t.pageForm.images.length>0?(l(),i("div",sb,[(l(!0),i(g,null,y(t.pageForm.images,(a,m)=>(l(),i("div",ob,[c(e("img",null,null,512),[[d,"/images-by-bot-id/"+t.bot.id+"/"+a]]),e("div",lb,[e("a",{onClick:u=>t.removeImage(m)},"Удалить",8,ib)])]))),256))])):r("",!0)])])])])):r("",!0)])):r("",!0),t.tab===3?(l(),i("div",nb,[e("div",ab,[e("div",db,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[22]||(o[22]=a=>t.need_page_video=a),type:"checkbox",id:"need-page-video"},null,512),[[k,t.need_page_video]]),rb])]),t.need_page_video?(l(),i("div",cb,[ub,f(B,{"need-video":!0,"need-video-note":!0,selected:t.pageForm.videos,onSelect:t.selectVideo},null,8,["selected","onSelect"])])):r("",!0)])):r("",!0),t.tab===4?(l(),i("div",_b,[e("div",hb,[e("div",mb,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[23]||(o[23]=a=>t.need_page_sticker=a),type:"checkbox",id:"need-page-sticker"},null,512),[[k,t.need_page_sticker]]),pb])]),t.need_page_sticker?(l(),i("div",bb,[f(B,{"need-sticker":!0,selected:[t.pageForm.sticker],onSelect:t.selectSticker},null,8,["selected","onSelect"])])):r("",!0)])):r("",!0),t.tab===5?(l(),i("div",gb,[e("div",fb,[e("div",vb,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[24]||(o[24]=a=>t.need_page_audios=a),type:"checkbox",id:"need-page-audio"},null,512),[[k,t.need_page_audios]]),$b])]),t.need_page_audios?(l(),i("div",yb,[kb,f(B,{"need-audio":!0,selected:t.pageForm.audios,onSelect:t.selectAudio},null,8,["selected","onSelect"])])):r("",!0)])):r("",!0),t.tab===6?(l(),i("div",Fb,[e("div",wb,[e("div",Cb,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[25]||(o[25]=a=>t.need_page_documents=a),type:"checkbox",id:"need-page-document"},null,512),[[k,t.need_page_documents]]),jb])]),t.need_page_documents?(l(),i("div",Sb,[Vb,f(B,{"need-document":!0,selected:t.pageForm.documents,onSelect:t.selectDocument},null,8,["selected","onSelect"])])):r("",!0)])):r("",!0),t.tab===7?(l(),i("div",Pb,[e("div",Ub,[e("div",Bb,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[26]||(o[26]=a=>t.need_attach_page=a),type:"checkbox",id:"need-page-attach"},null,512),[[k,t.need_attach_page]]),Ob])]),t.need_attach_page?(l(),i("div",Tb,[t.pageForm.next_page_id?(l(),i("p",qb,[_("Связано со страницей #"+h(t.pageForm.next_page_id)+" ",1),e("a",{class:"btn btn-link",onClick:o[27]||(o[27]=a=>t.pageForm.next_page_id=null)},"Очистить")])):r("",!0),f(I,{current:t.pageForm.id,onCallback:t.attachPage,editor:!1},null,8,["current","onCallback"])])):r("",!0)])):r("",!0),t.tab===8?(l(),i("div",Db,[e("div",Ib,[e("div",Rb,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[28]||(o[28]=a=>t.need_attach_slug=a),type:"checkbox",id:"need-slug-attach"},null,512),[[k,t.need_attach_slug]]),Lb])]),t.need_attach_slug?(l(),i("div",Mb,[t.pageForm.next_bot_menu_slug_id?(l(),i("p",Ab,[_("Связано со скриптом #"+h(t.pageForm.next_bot_menu_slug_id)+" ",1),e("a",{class:"btn btn-link",onClick:o[29]||(o[29]=a=>t.pageForm.next_bot_menu_slug_id=null)},"Очистить")])):r("",!0),t.bot?(l(),F(ar,{key:1,global:!0,onCallback:t.associateSlug,bot:t.bot},null,8,["onCallback","bot"])):r("",!0)])):r("",!0)])):r("",!0),t.tab===9?(l(),i("div",Eb,[e("div",xb,[e("div",zb,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[30]||(o[30]=a=>t.need_attach_dialog=a),type:"checkbox",id:"need-dialog-attach"},null,512),[[k,t.need_attach_dialog]]),Kb])]),t.need_attach_dialog?(l(),i("div",Nb,[t.pageForm.next_bot_dialog_command_id?(l(),i("p",Yb,[_("Связано с диалогом #"+h(t.pageForm.next_bot_dialog_command_id)+" ",1),e("a",{class:"btn btn-link",onClick:o[31]||(o[31]=a=>t.pageForm.next_bot_dialog_command_id=null)},"Очистить")])):r("",!0),t.bot?(l(),F(c_,{key:1,onSelectDialog:t.associateDialog,bot:t.bot},null,8,["onSelectDialog","bot"])):r("",!0)])):r("",!0)])):r("",!0),t.tab===10?(l(),i("div",Jb,[e("div",Wb,[e("div",Hb,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[32]||(o[32]=a=>t.need_rules=a),type:"checkbox",id:"need-rules"},null,512),[[k,t.need_rules]]),Gb])]),t.need_rules?(l(),i("div",Qb,[f(qh,{bot:t.bot,"rules-form":t.pageForm},null,8,["bot","rules-form"])])):r("",!0)])):r("",!0)]))],32)):r("",!0),e("div",Xb,[e("div",Zb,[e("div",e1,[t1,e("div",s1,[t.bot?(l(),i("div",o1,[e("div",l1,[e("h6",i1,[e("span",null,"Вы создаете страницу для "+h(t.bot.bot_domain),1)])])])):r("",!0),e("form",{onSubmit:o[37]||(o[37]=j((...a)=>t.submitPage&&t.submitPage(...a),["prevent"])),class:"row"},[e("div",n1,[a1,e("ul",d1,[e("li",{class:v({active:t.need_page_images})},c1,2),e("li",{class:v({active:t.need_page_sticker})},_1,2),e("li",{class:v({active:t.need_page_video})},m1,2),e("li",{class:v({active:t.need_page_audios})},b1,2),e("li",{class:v({active:t.need_page_documents})},f1,2),e("li",{class:v({active:t.need_attach_page})},$1,2),e("li",{class:v({active:t.need_attach_slug})},k1,2),e("li",{class:v({active:t.need_attach_dialog})},w1,2),e("li",{class:v({active:t.need_rules})},j1,2),e("li",{class:v({active:t.need_reply_menu})},V1,2),e("li",{class:v({active:t.need_inline_menu})},U1,2)])]),t.pageForm.id?(l(),i("div",B1,[e("div",O1,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[34]||(o[34]=a=>t.need_show_qr_and_link=a),type:"checkbox",id:"need-show-qr-and-link"},null,512),[[k,t.need_show_qr_and_link]]),T1])])):r("",!0),t.pageForm.id&&t.need_show_qr_and_link?(l(),i("div",q1,[e("p",null,[_("Ссылка на текущую страницу: "),e("span",{class:"bg-secondary font-bold cursor-pointer",onClick:o[35]||(o[35]=a=>t.copyToClipBoard(t.pageLink))},h(t.pageLink),1)]),e("div",D1,[c(e("img",I1,null,512),[[d,t.qr]])])])):r("",!0),e("div",R1,[e("label",L1,[f(n,null,{content:b(()=>[A1]),default:b(()=>[M1]),_:1}),_(" Описание страницы "),E1]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Описание страницы","aria-label":"Описание страницы","onUpdate:modelValue":o[36]||(o[36]=a=>t.pageForm.comment=a),maxlength:"255","aria-describedby":"bot-domain",required:""},`
            `,512),[[p,t.pageForm.comment]])]),x1],32)]),z1])])]),e("div",K1,[e("div",N1,[e("div",Y1,[e("div",J1,[f(I,{editor:!0,current:t.page,onCallback:t.pageListCallback},null,8,["current","onCallback"])])])])])],64)}}}),H1={props:["bot","item"],data(){return{sectionForm:{section:null},categoryForm:{label:null},tab:0,types:[{title:"Готовый продукт",value:1},{title:"Товар на вес",value:2},{title:"Конструктор товара",value:3}],productCategories:[],sections:["Общие характеристики","Дополнительная информация"],photos:[],categories:[],removed_options:[],productForm:{article:null,vk_product_id:null,title:null,description:null,images:[],type:1,old_price:null,current_price:null,variants:[],in_stop_list_at:null,bot_id:null,options:[],reviews:[],categories:[]}}},computed:{...C(["getProductCategories"]),filteredCategories(){return this.productCategories.length===0?this.categories:this.categories.filter(s=>this.productCategories.indexOf(s.value)===-1)}},mounted(){this.loadProductCategories(),this.item&&this.$nextTick(()=>{this.productForm={id:this.item.id||null,article:this.item.article||null,vk_product_id:this.item.vk_product_id||null,title:this.item.title||null,description:this.item.description||null,images:this.item.images||null,type:this.item.type||1,old_price:this.item.old_price||null,current_price:this.item.current_price||null,variants:this.item.variants||null,in_stop_list_at:this.item.in_stop_list_at||null,bot_id:this.item.bot_id||null,options:this.item.options||null,reviews:this.item.reviews||null},this.options=[],this.item.categories.forEach(s=>{this.productCategories.push(s.id)})})},methods:{prepareCategoryName(s){let t=this.categories.find(o=>o.value===s);return console.log(t),t?t.label:s},addCategory(){const s=this.categoryForm.label;this.productCategories.push(s),this.categoryForm.label=null},selectCategory(s){this.productCategories.push(s.value)},submit(){let s=new FormData;if(Object.keys(this.productForm).forEach(t=>{const o=this.productForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.bot&&s.append("bot_id",this.bot.id),this.photos.length>0)for(let t=0;t<this.photos.length;t++)s.append("photos[]",this.photos[t]);this.removed_options.length>0&&s.append("removed_options",JSON.stringify(this.removed_options)),this.productCategories.length>0&&s.append("categories",JSON.stringify(this.productCategories)),this.$store.dispatch("saveProduct",{productForm:s}).then(t=>{this.load=!0,this.$notify({title:"Конструктор ботов",text:"Продукт успешно сохранен!",type:"success"}),this.clearForm(),this.$emit("refresh")}).catch(t=>{})},onChangePhotos(s){const t=s.target.files;for(let o=0;o<t.length;o++)this.photos.push(t[o])},loadProductCategories(){this.$store.dispatch("loadProductCategories",{dataObject:{bot_id:this.bot.id}}).then(()=>{this.getProductCategories.forEach(t=>{this.categories.push({value:t.id,label:t.title})})})},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removeSection(s){this.sections.splice(s,1)},addSection(){this.sections.push(this.sectionForm.section),this.sectionForm.section=null},addOption(){this.productForm.options||(this.productForm.options=[]),this.productForm.options.push({id:null,key:null,value:null,title:null,section:null})},addVariant(){this.productForm.variants||(this.productForm.variants=[]),this.productForm.variants.push({key:null,value:null})},removeProductCategory(s){this.productCategories.splice(s,1)},removeVariant(s){this.productForm.variants.splice(s,1)},removeOption(s){this.productForm.options[s].id&&this.removed_options.push(this.productForm.options[s].id),this.productForm.options.splice(s,1)},removeImage(s){this.productForm.images.splice(s,1)},removePhoto(s){this.photos.splice(s,1)},clearForm(){const s={article:null,vk_product_id:null,title:null,description:null,images:[],type:1,old_price:null,current_price:null,variants:[],in_stop_list_at:null,bot_id:null,options:[],reviews:[],categories:[]};this.photos=[],this.removed_options=[],this.productCategories=[],this.productForm=s}}},G1={class:"nav nav-tabs"},Q1={class:"nav-item"},X1={class:"nav-item"},Z1={class:"nav-item"},eg={key:0},tg={class:"col-md-8 d-flex align-items-center"},sg={class:"form-check"},og=e("label",{class:"form-check-label",for:"in-stop-list"}," Товар находится в стоп-листе ",-1),lg={class:"col-md-4 d-flex justify-content-end"},ig={class:"col-md-12 mb-3"},ng=["onClick"],ag={class:"dropdown"},dg=e("button",{type:"button",class:"btn btn-outline-info w-100","data-bs-toggle":"dropdown","data-bs-display":"static","aria-expanded":"false"},[e("p",{class:"mb-0"},"Выберите категорию")],-1),rg={class:"dropdown-menu w-100",style:{"overflow-y":"scroll",height:"300px"}},cg={class:"p-3"},ug=e("label",{for:"exampleDropdownFormEmail1",class:"form-label"},"Новая категория",-1),_g={class:"p-3"},hg=e("li",null,[e("hr",{class:"dropdown-divider"})],-1),mg=["onClick"],pg={class:"col-md-6"},bg={class:"form-floating mb-3"},gg=e("label",{for:"article"},"Артикул товара",-1),fg={class:"col-md-6"},vg={class:"form-floating mb-3"},$g=e("label",{for:"vk-product-id"},"Идентификатор товара VK",-1),yg={class:"col-md-6"},kg={class:"form-floating mb-3"},Fg=e("label",{for:"title"},"Названи товара",-1),wg={class:"col-md-6"},Cg={class:"form-floating mb-3"},jg=["value"],Sg=e("label",{for:"type"},"Тип товара",-1),Vg={class:"col-md-12"},Pg={class:"form-floating mb-3"},Ug=e("label",{for:"description"},"Описание товара",-1),Bg={class:"col-md-6"},Og={class:"form-floating mb-3"},Tg=e("label",{for:"current-price"},"Актуальная цена",-1),qg={class:"col-md-6"},Dg={class:"form-floating mb-3"},Ig=e("label",{for:"old-price"},"Старая цена",-1),Rg={class:"col-md-12 mb-3"},Lg={class:"card"},Mg={class:"card-header"},Ag={key:0},Eg={class:"card-body"},xg={class:"row"},zg={class:"col-12 mb-3"},Kg={class:"col-md-6 mb-3"},Ng={class:"card w-100"},Yg={class:"card-body"},Jg={class:"form-floating mb-3"},Wg=["onUpdate:modelValue","id"],Hg=["for"],Gg={class:"form-floating mb-3"},Qg=["onUpdate:modelValue","id"],Xg=["for"],Zg={class:"card-footer"},ef=["onClick"],tf=e("i",{class:"fa-solid fa-trash-can"},null,-1),sf=[tf],of={class:"col-md-12 mb-3"},lf={class:"card"},nf=e("div",{class:"card-header"},[e("h6",null,"Характеристики товара")],-1),af={class:"card-body"},df={class:"row mb-3"},rf={class:"col-12"},cf=e("button",{class:"btn btn-outline-info",type:"submit",id:"button-addon2"},"Добавить секцию ",-1),uf={class:"badge bg-info mr-1"},_f=["onClick"],hf=e("i",{class:"fa-solid fa-xmark"},null,-1),mf=[hf],pf={class:"row"},bf={class:"col-md-4 mb-3"},gf={class:"card w-100"},ff={class:"card-body"},vf={class:"form-floating mb-3"},$f=["onUpdate:modelValue","id"],yf=["for"],kf={class:"form-floating mb-3"},Ff=["onUpdate:modelValue","id"],wf=["for"],Cf={class:"form-floating mb-3"},jf=["onUpdate:modelValue","id"],Sf=e("option",{value:null},"Без секции",-1),Vf=["value"],Pf=["for"],Uf={class:"card-footer"},Bf=["onClick"],Of=e("i",{class:"fa-solid fa-trash-can"},null,-1),Tf=[Of],qf={class:"row"},Df={class:"col-12"},If={class:"col-md-12 mb-3"},Rf=e("h6",null,"Фотографии товара",-1),Lf={class:"photo-preview d-flex justify-content-start flex-wrap w-100"},Mf={for:"location-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},Af=e("span",null,"+",-1),Ef={class:"mb-2 img-preview",style:{"margin-right":"10px"}},xf={class:"remove"},zf=["onClick"],Kf={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Nf={class:"remove"},Yf=["onClick"],Jf=e("div",{class:"col-12"},[e("button",{type:"submit",class:"btn btn-outline-primary w-100 p-3"},"Сохранить ")],-1),Wf={key:1};function Hf(s,t,o,n,d,a){const m=q("lazy");return l(),i(g,null,[e("ul",G1,[e("li",Q1,[e("a",{class:v(["nav-link",{active:d.tab===0}]),onClick:t[0]||(t[0]=u=>d.tab=0),"aria-current":"page",href:"#product-form-info"},"Информация о товаре",2)]),e("li",X1,[e("a",{class:v(["nav-link",{active:d.tab===1}]),onClick:t[1]||(t[1]=u=>d.tab=1),href:"#product-reviews"},"Комментарии",2)]),e("li",Z1,[e("a",{class:v(["nav-link",{active:d.tab===2}]),onClick:t[2]||(t[2]=u=>d.tab=2),href:"#product-reviews"},"Заказы",2)])]),d.tab===0?(l(),i("div",eg,[e("form",{onSubmit:t[19]||(t[19]=j((...u)=>a.submit&&a.submit(...u),["prevent"])),class:"row"},[e("div",tg,[e("div",sg,[c(e("input",{class:"form-check-input","onUpdate:modelValue":t[3]||(t[3]=u=>d.productForm.in_stop_list_at=u),type:"checkbox",value:"false",id:"in-stop-list"},null,512),[[k,d.productForm.in_stop_list_at]]),og])]),e("div",lg,[e("a",{href:"#",class:"btn btn-link",onClick:t[4]||(t[4]=(...u)=>a.clearForm&&a.clearForm(...u))},"Новый товар")]),e("div",ig,[(l(!0),i(g,null,y(d.productCategories,(u,$)=>(l(),i("span",{class:"badge bg-info mr-1 mb-1 cursor-pointer",onClick:w=>a.removeProductCategory($)},h(a.prepareCategoryName(u)),9,ng))),256)),e("div",ag,[dg,e("ul",rg,[e("div",cg,[ug,c(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[5]||(t[5]=u=>d.categoryForm.label=u),id:"exampleDropdownFormEmail1",placeholder:"Название категории"},null,512),[[p,d.categoryForm.label]])]),e("div",_g,[e("button",{class:"btn btn-primary w-100",type:"button",onClick:t[6]||(t[6]=(...u)=>a.addCategory&&a.addCategory(...u))},"Добавить категорию ")]),hg,(l(!0),i(g,null,y(a.filteredCategories,u=>(l(),i("li",null,[e("button",{class:"dropdown-item",type:"button",onClick:$=>a.selectCategory(u)},h(u.label),9,mg)]))),256))])])]),e("div",pg,[e("div",bg,[c(e("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=u=>d.productForm.article=u),class:"form-control",id:"article",placeholder:"name@example.com"},null,512),[[p,d.productForm.article]]),gg])]),e("div",fg,[e("div",vg,[c(e("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=u=>d.productForm.vk_product_id=u),disabled:!0,class:"form-control",id:"vk-product-id",placeholder:"name@example.com"},null,512),[[p,d.productForm.vk_product_id]]),$g])]),e("div",yg,[e("div",kg,[c(e("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=u=>d.productForm.title=u),class:"form-control",id:"title",placeholder:"name@example.com"},null,512),[[p,d.productForm.title]]),Fg])]),e("div",wg,[e("div",Cg,[c(e("select",{class:"form-select","onUpdate:modelValue":t[10]||(t[10]=u=>d.productForm.type=u),id:"type","aria-label":"Floating label select example"},[(l(!0),i(g,null,y(d.types,(u,$)=>(l(),i("option",{value:u.value},h(u.title),9,jg))),256))],512),[[V,d.productForm.type]]),Sg])]),e("div",Vg,[e("div",Pg,[c(e("textarea",{class:"form-control","onUpdate:modelValue":t[11]||(t[11]=u=>d.productForm.description=u),placeholder:"Leave a comment here",id:"description"},null,512),[[p,d.productForm.description]]),Ug])]),e("div",Bg,[e("div",Og,[c(e("input",{type:"number","onUpdate:modelValue":t[12]||(t[12]=u=>d.productForm.current_price=u),class:"form-control",id:"current-price",placeholder:"name@example.com"},null,512),[[p,d.productForm.current_price]]),Tg])]),e("div",qg,[e("div",Dg,[c(e("input",{type:"number","onUpdate:modelValue":t[13]||(t[13]=u=>d.productForm.old_price=u),class:"form-control",id:"old-price",placeholder:"name@example.com"},null,512),[[p,d.productForm.old_price]]),Ig])]),e("div",Rg,[e("div",Lg,[e("div",Mg,[e("h6",null,[_("Варианты товара "),d.productForm.variants?(l(),i("span",Ag,"("+h(d.productForm.variants.length)+")",1)):r("",!0)])]),e("div",Eg,[e("div",xg,[e("div",zg,[e("button",{type:"button",class:"btn btn-outline-info w-100",onClick:t[14]||(t[14]=(...u)=>a.addVariant&&a.addVariant(...u))},"Добавить вариант ")]),(l(!0),i(g,null,y(d.productForm.variants,(u,$)=>(l(),i("div",Kg,[e("div",Ng,[e("div",Yg,[e("div",Jg,[c(e("input",{type:"text","onUpdate:modelValue":w=>d.productForm.variants[$].key=w,class:"form-control",id:"variant-key-"+$,placeholder:"name@example.com",required:""},null,8,Wg),[[p,d.productForm.variants[$].key]]),e("label",{for:"variant-key-"+$},"Ключ",8,Hg)]),e("div",Gg,[c(e("input",{type:"text","onUpdate:modelValue":w=>d.productForm.variants[$].value=w,class:"form-control",id:"variant-value-"+$,placeholder:"name@example.com",required:""},null,8,Qg),[[p,d.productForm.variants[$].value]]),e("label",{for:"variant-value-"+$},"Значение",8,Xg)])]),e("div",Zg,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:w=>a.removeVariant($)},sf,8,ef)])])]))),256))])])])]),e("div",of,[e("div",lf,[nf,e("div",af,[e("div",df,[e("div",rf,[e("form",{onSubmit:t[16]||(t[16]=j((...u)=>a.addSection&&a.addSection(...u),["prevent"])),class:"input-group mb-3"},[c(e("input",{type:"text","onUpdate:modelValue":t[15]||(t[15]=u=>d.sectionForm.section=u),class:"form-control border-info",placeholder:"Название секции","aria-label":"Recipient's username","aria-describedby":"button-addon2",required:""},null,512),[[p,d.sectionForm.section]]),cf],32),(l(!0),i(g,null,y(d.sections,(u,$)=>(l(),i("span",uf,[_(h(u)+" ",1),e("strong",{onClick:w=>a.removeSection($)},mf,8,_f)]))),256))])]),e("div",pf,[(l(!0),i(g,null,y(d.productForm.options,(u,$)=>(l(),i("div",bf,[e("div",gf,[e("div",ff,[e("div",vf,[c(e("input",{type:"text","onUpdate:modelValue":w=>d.productForm.options[$].title=w,class:"form-control",id:"option-title-"+$,placeholder:"name@example.com"},null,8,$f),[[p,d.productForm.options[$].title]]),e("label",{for:"option-title-"+$},"Название характеристики",8,yf)]),e("div",kf,[c(e("input",{type:"text","onUpdate:modelValue":w=>d.productForm.options[$].value=w,class:"form-control",id:"option-value-"+$,placeholder:"name@example.com"},null,8,Ff),[[p,d.productForm.options[$].value]]),e("label",{for:"option-value-"+$},"Значение характеристики",8,wf)]),e("div",Cf,[c(e("select",{class:"form-select","onUpdate:modelValue":w=>d.productForm.options[$].section=w,id:"option-section-"+$,"aria-label":"Floating label select example"},[Sf,(l(!0),i(g,null,y(d.sections,w=>(l(),i("option",{value:w},h(w),9,Vf))),256))],8,jf),[[V,d.productForm.options[$].section]]),e("label",{for:"option-section-"+$},"Секция товара",8,Pf)])]),e("div",Uf,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:w=>a.removeOption($)},Tf,8,Bf)])])]))),256))]),e("div",qf,[e("div",Df,[e("button",{type:"button",class:"btn btn-outline-info w-100",onClick:t[17]||(t[17]=(...u)=>a.addOption&&a.addOption(...u))},"Добавить характеристику ")])])])])]),e("div",If,[Rf,e("div",Lf,[e("label",Mf,[Af,e("input",{type:"file",id:"location-photos",multiple:"",accept:"image/*",onChange:t[18]||(t[18]=(...u)=>a.onChangePhotos&&a.onChangePhotos(...u)),style:{display:"none"}},null,32)]),d.productForm.images?(l(!0),i(g,{key:0},y(d.productForm.images,(u,$)=>(l(),i("div",Ef,[c(e("img",null,null,512),[[m,u]]),e("div",xf,[e("a",{onClick:w=>a.removeImage($)},"Удалить",8,zf)])]))),256)):r("",!0),d.photos.length>0?(l(!0),i(g,{key:1},y(d.photos,(u,$)=>(l(),i("div",Kf,[c(e("img",null,null,512),[[m,a.getPhoto(u).imageUrl]]),e("div",Nf,[e("a",{onClick:w=>a.removePhoto($)},"Удалить",8,Yf)])]))),256)):r("",!0)])]),Jf],32)])):r("",!0),d.tab===1?(l(),i("div",Wf," Отзывы ")):r("",!0)],64)}const Gf=P(H1,[["render",Hf]]),Qf={props:["item"],data(){return{bot:null}},methods:{preparedImgUrl(s){return s.toLocaleLowerCase().startsWith("https://")||s.toLocaleLowerCase().startsWith("http://")?s:"/images-by-bot-id/"+this.bot.id+"/"+s},removeProduct(){this.$store.dispatch("removeProduct",this.item.id).then(s=>{this.$notify({title:"Конструктор ботов",text:"Продукт успешно удален!",type:"success"})}).catch(s=>{})},duplicateProduct(){this.$store.dispatch("duplicateProduct",this.item.id).then(s=>{this.$notify({title:"Конструктор ботов",text:"Продукт успешно продублирован!",type:"success"})}).catch(s=>{})}},mounted(){this.bot=this.getCurrentBot},computed:{...C(["getCurrentBot"])}},Xf={key:0,class:"card"},Zf={class:"card-header"},ev={class:"card-body"},tv=["id"],sv={class:"carousel-inner"},ov=["src"],lv=["data-bs-target"],iv=e("span",{class:"carousel-control-prev-icon","aria-hidden":"true"},null,-1),nv=e("span",{class:"visually-hidden"},"Previous",-1),av=[iv,nv],dv=["data-bs-target"],rv=e("span",{class:"carousel-control-next-icon","aria-hidden":"true"},null,-1),cv=e("span",{class:"visually-hidden"},"Next",-1),uv=[rv,cv],_v={class:"card-footer d-flex justify-content-between"},hv=e("i",{class:"fa-regular fa-copy"},null,-1),mv=[hv],pv=e("i",{class:"fa-solid fa-trash-can"},null,-1),bv=[pv];function gv(s,t,o,n,d,a){return d.bot?(l(),i("div",Xf,[e("div",Zf,[e("p",null,"#"+h(o.item.id),1)]),e("div",ev,[e("p",null,h(o.item.title),1),e("div",{id:"image-slider-"+o.item.id,class:"carousel slide","data-bs-ride":"carousel"},[e("div",sv,[(l(!0),i(g,null,y(o.item.images,(m,u)=>(l(),i("div",{class:v(["carousel-item",{active:u===0}]),style:{height:"300px"}},[e("img",{src:a.preparedImgUrl(m),class:"d-block w-100 object-fit-cover",alt:"..."},null,8,ov)],2))),256))]),e("button",{class:"carousel-control-prev",type:"button","data-bs-target":"#image-slider-"+o.item.id,"data-bs-slide":"prev"},av,8,lv),e("button",{class:"carousel-control-next",type:"button","data-bs-target":"#image-slider-"+o.item.id,"data-bs-slide":"next"},uv,8,dv)],8,tv)]),e("div",_v,[e("button",{title:"Дублировать товар",onClick:t[0]||(t[0]=(...m)=>a.duplicateProduct&&a.duplicateProduct(...m)),class:"btn btn-outline-info mr-1"},mv),e("button",{title:"Удалить товар",onClick:t[1]||(t[1]=(...m)=>a.removeProduct&&a.removeProduct(...m)),class:"btn btn-outline-danger"},bv)])])):r("",!0)}const fv=P(Qf,[["render",gv]]),vv=e("button",{class:"btn btn-outline-info",type:"submit",id:"button-addon2"}," Найти ",-1),$v={key:0},yv={class:"row"},kv={class:"col-4 mb-2"},Fv={props:["bot"],data(){return{search:null,products:[],paginate:null}},computed:{...C(["getProducts","getProductsPaginateObject"]),filteredProducts(){return this.search?this.products.filter(s=>s.title.toLowerCase().trim().indexOf(this.search.toLowerCase().trim())>=0):this.products}},mounted(){this.loadProducts()},methods:{selectProduct(s){this.$emit("select",s)},nextProducts(s){this.loadProducts(s)},loadProducts(s=0){return this.$store.dispatch("loadProducts",{dataObject:{bot_id:this.bot.id,search:this.search},page:s}).then(()=>{this.products=this.getProducts,this.paginate=this.getProductsPaginateObject})}}},wv=Object.assign(Fv,{__name:"ProductList",setup(s){return(t,o)=>(l(),i(g,null,[e("form",{class:"input-group mb-3",onSubmit:o[1]||(o[1]=j(n=>t.loadProducts(0),["prevent"]))},[c(e("input",{type:"text",class:"form-control border-info",placeholder:"Поиск товара","aria-label":"Поиск товара","onUpdate:modelValue":o[0]||(o[0]=n=>t.search=n),"aria-describedby":"button-addon2",required:""},null,512),[[p,t.search]]),vv],32),e("p",null,[_("Всего товаров: "),t.paginate?(l(),i("span",$v,h(t.paginate.meta.total||0),1)):r("",!0)]),e("div",yv,[(l(!0),i(g,null,y(t.filteredProducts,(n,d)=>(l(),i("div",kv,[f(fv,{onClick:a=>t.selectProduct(n),item:n},null,8,["onClick","item"])]))),256))]),t.paginate?(l(),F(S,{key:0,onPagination_page:t.nextProducts,pagination:t.paginate},null,8,["onPagination_page","pagination"])):r("",!0)],64))}}),Cv={class:"card mb-2"},jv=e("div",{class:"card-header"},[e("h6",null,"Управление магазином")],-1),Sv={class:"card-body"},Vv={class:"row"},Pv={class:"col-12"},Uv={class:"form-label d-flex justify-content-between mt-2",id:"bot-level-3"},Bv=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Ov=e("div",null,"Ссылка на страницу ВК с товарами для вашего магазина в боте ",-1),Tv=e("a",{href:"https://vk.com/groups?w=groups_create",target:"_blank"},"Создать",-1),qv=["disabled"],Dv=e("i",{class:"fa-regular fa-floppy-disk mr-2"},null,-1),Iv={class:"row mb-3"},Rv={class:"col-md-3"},Lv=["href"],Mv=A('<div class="col-md-3"><button class="btn btn-outline-info w-100">Экспорт в XLS</button></div><div class="col-md-3"><button class="btn btn-outline-info w-100">Импорт из XLS</button></div><div class="col-md-3"><button class="btn btn-outline-danger w-100">Удалить товары</button></div>',3),Av=e("div",{class:"row"},[e("div",{class:"col-md-3"},[e("button",{class:"btn btn-outline-info w-100"},"Экспортировать заказы")])],-1),Ev={class:"card"},xv=e("div",{class:"card-header"},[e("h6",null,"Работа с товаром")],-1),zv={class:"card-body"},Kv={class:"card mt-2"},Nv={class:"card-body"},Yv={data(){return{load:!1,tab:0,url:null,link:null,bot:null,selectedProduct:null,botForm:{vk_shop_link:null}}},computed:{...C(["getCurrentBot"])},mounted(){this.bot=this.getCurrentBot,this.botForm.vk_shop_link=this.bot.vk_shop_link||null,this.updateProducts()},methods:{updateShopLink(){this.load=!0,this.botForm.bot_id=this.bot.id,this.$store.dispatch("updateShopLink",{botForm:this.botForm}).then(s=>{this.load=!1,this.updateProducts(),this.$notify({title:"Менеджер магазина",text:"Ссылка на источник в ВК обновлена"})}).catch(()=>{this.load=!1})},refresh(){this.load=!0,this.selectedProduct=null,this.$nextTick(()=>{this.load=!1})},selectProduct(s){this.load=!0,this.$nextTick(()=>{this.selectedProduct=s,this.load=!1})},updateProducts(){this.load=!0,this.$store.dispatch("updateProductsFromVk",{dataObject:{bot_domain:this.getCurrentBot.bot_domain}}).then(s=>{this.link=s.data.url,this.load=!1,this.url=null}).catch(()=>{this.load=!1})}}},Y0=Object.assign(Yv,{__name:"Shop",setup(s){return(t,o)=>{const n=U("Popper");return l(),i(g,null,[e("div",Cv,[jv,e("div",Sv,[e("div",Vv,[e("div",Pv,[e("form",{onSubmit:o[1]||(o[1]=j((...d)=>t.updateShopLink&&t.updateShopLink(...d),["prevent"])),class:"mb-2"},[e("label",Uv,[e("div",null,[f(n,null,{content:b(()=>[Ov]),default:b(()=>[Bv]),_:1}),_(" ВК-группа ")]),Tv]),c(e("input",{type:"url",class:"form-control",placeholder:"Ссылка на группу ВК","aria-label":"ссылка на группу ВК","onUpdate:modelValue":o[0]||(o[0]=d=>t.botForm.vk_shop_link=d),"aria-describedby":"vk_shop_link"},null,512),[[p,t.botForm.vk_shop_link]]),e("button",{disabled:t.load,class:"btn btn-outline-primary mt-2 mb-2 w-100"},[Dv,_(" Сохранить ")],8,qv)],32)])]),e("div",Iv,[e("div",Rv,[e("a",{target:"_blank",href:t.link,class:"btn btn-primary w-100"}," Обновить товар ",8,Lv)]),Mv]),Av])]),e("div",Ev,[xv,e("div",zv,[t.bot&&!t.load?(l(),F(Gf,{key:0,bot:t.bot,item:t.selectedProduct,onRefresh:t.refresh},null,8,["bot","item","onRefresh"])):r("",!0)])]),e("div",Kv,[e("div",Nv,[t.bot&&!t.load?(l(),F(wv,{key:0,bot:t.bot,onSelect:t.selectProduct},null,8,["bot","onSelect"])):r("",!0)])])],64)}}}),Jv={props:["data"],data(){return{hasConnect:!1,bot:null,amoForm:{client_id:null,client_secret:null,auth_code:null,redirect_uri:null,subdomain:null,bot_id:null}}},computed:{...C(["getCurrentBot"])},mounted(){this.bot=this.getCurrentBot,this.data?this.$nextTick(()=>{this.amoForm.client_id=this.data.client_id||null,this.amoForm.client_secret=this.data.client_secret||null,this.amoForm.auth_code=this.data.auth_code||null,this.amoForm.redirect_uri=this.data.redirect_uri||null,this.amoForm.subdomain=this.data.subdomain||null,this.amoForm.bot_id=this.data.bot_id||this.bot.id||null}):this.amoForm.bot_id=this.bot.id||null},methods:{submitAmo(){let s=new FormData;Object.keys(this.amoForm).forEach(t=>{const o=this.amoForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.$store.dispatch("saveAmoCRM",{amoForm:s}).then(t=>{this.$notify("Данные CRM успешно сохранены")}).catch(t=>{})}}},Wv=e("div",{class:"col-12"},[e("p",null,[e("a",{target:"_blank",href:"https://www.amocrm.ru/developers/content/oauth/step-by-step"},"Документация для разработчика "),_(" по шагам")])],-1),Hv={class:"col-md-6 col-12 mb-2"},Gv={class:"form-label",id:"client_id"},Qv=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Xv=e("div",null,"ID интеграции",-1),Zv=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),e$={class:"col-md-6 col-12 mb-2"},t$={class:"form-label",id:"client_secret"},s$=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),o$=e("div",null,"Секрет интеграции",-1),l$=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),i$={class:"col-md-6 mb-2"},n$={class:"form-label",id:"auth_code"},a$=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),d$=e("div",null,"Полученный код авторизации",-1),r$=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),c$={class:"col-md-6 col-12 mb-2"},u$={class:"form-label",id:"subdomain2"},_$=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),h$=e("div",null,"Ваш поддомен в системе AMO CRM",-1),m$=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),p$=e("div",{class:"col-md-12 col-12"},[e("button",{type:"submit",class:"btn btn-outline-primary p-3 w-100"},[e("i",{class:"fa-solid fa-cloud-arrow-down mr-1"}),_(" Сохранить настройку AMO ")])],-1);function b$(s,t,o,n,d,a){const m=U("Popper");return l(),i("form",{onSubmit:t[4]||(t[4]=j((...u)=>a.submitAmo&&a.submitAmo(...u),["prevent"])),class:"row"},[Wv,e("div",Hv,[e("label",Gv,[f(m,null,{content:b(()=>[Xv]),default:b(()=>[Qv]),_:1}),_(" client_id "),Zv]),c(e("input",{type:"text",class:"form-control",placeholder:"client_id","aria-label":"client_id","onUpdate:modelValue":t[0]||(t[0]=u=>d.amoForm.client_id=u),"aria-describedby":"client_id"},null,512),[[p,d.amoForm.client_id]])]),e("div",e$,[e("label",t$,[f(m,null,{content:b(()=>[o$]),default:b(()=>[s$]),_:1}),_(" client_secret "),l$]),c(e("input",{type:"text",class:"form-control",placeholder:"client_secret","aria-label":"client_secret","onUpdate:modelValue":t[1]||(t[1]=u=>d.amoForm.client_secret=u),"aria-describedby":"client_secret"},null,512),[[p,d.amoForm.client_secret]])]),e("div",i$,[e("label",n$,[f(m,null,{content:b(()=>[d$]),default:b(()=>[a$]),_:1}),_(" auth_code "),r$]),c(e("textarea",{class:"form-control",placeholder:"auth_code","aria-label":"auth_code","onUpdate:modelValue":t[2]||(t[2]=u=>d.amoForm.auth_code=u),"aria-describedby":"auth_code"},`
                                    `,512),[[p,d.amoForm.auth_code]])]),e("div",c$,[e("label",u$,[f(m,null,{content:b(()=>[h$]),default:b(()=>[_$]),_:1}),_(" subdomain "),m$]),c(e("input",{type:"text",class:"form-control",placeholder:"subdomain","aria-label":"subdomain","onUpdate:modelValue":t[3]||(t[3]=u=>d.amoForm.subdomain=u),"aria-describedby":"subdomain"},null,512),[[p,d.amoForm.subdomain]])]),p$],32)}const J0=P(Jv,[["render",b$]]),g$={props:["data"],data(){return{load:!1,bot:null,yClientsForm:{login:null,password:null,partner_token:null,company:null}}},computed:{...C(["getCurrentBot"])},mounted(){this.bot=this.getCurrentBot,this.data&&this.$nextTick(()=>{this.yClientsForm.login=this.data.login||null,this.yClientsForm.password=this.data.password||null,this.yClientsForm.partner_token=this.data.partner_token||null,this.yClientsForm.company=this.data.company||null})},methods:{submitYClients(){let s=new FormData;Object.keys(this.yClientsForm).forEach(t=>{const o=this.yClientsForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),s.append("bot_id",this.bot.id),this.$store.dispatch("saveYClients",{yClientsForm:s}).then(t=>{this.$notify({title:"Работа с YClients",text:"Данные YClients успешно сохранены",type:"success"})}).catch(t=>{this.$notify({title:"Работа с YClients",text:"Ошибка сохранения данных",type:"error"})})}}},f$=e("h6",null,"Настройка YClients",-1),v$={class:"row"},$$={class:"col-md-12"},y$={class:"mb-2"},k$=e("label",{class:"form-label d-flex justify-content-between mt-2",for:"login"},[_(" Логин "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),F$={class:"mb-2"},w$=e("label",{class:"form-label d-flex justify-content-between mt-2",for:"password"},[_(" Пароль "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),C$={class:"mb-2"},j$=e("label",{class:"form-label d-flex justify-content-between mt-2",for:"partner_token"},[_(" Партнерский тоукен "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),S$={class:"mb-2"},V$=e("label",{class:"form-label d-flex justify-content-between mt-2",for:"partner_token"},[_(" ID компании, в которую записывать клиентов "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),P$=e("button",{class:"btn btn-success w-100 r mb-3 text-uppercase font-900"}," Сохранить ",-1);function U$(s,t,o,n,d,a){return l(),i(g,null,[f$,e("form",{onSubmit:t[4]||(t[4]=j((...m)=>a.submitYClients&&a.submitYClients(...m),["prevent"]))},[e("div",v$,[e("div",$$,[e("div",y$,[k$,c(e("input",{type:"text",id:"login",class:"form-control",placeholder:"Ваш логин","aria-label":"Ваш логин","onUpdate:modelValue":t[0]||(t[0]=m=>d.yClientsForm.login=m),"aria-describedby":"Ваш логин",required:""},null,512),[[p,d.yClientsForm.login]])]),e("div",F$,[w$,c(e("input",{type:"text",id:"password",class:"form-control",placeholder:"Ваш пароль","aria-label":"Ваш пароль","onUpdate:modelValue":t[1]||(t[1]=m=>d.yClientsForm.password=m),"aria-describedby":"Ваш пароль",required:""},null,512),[[p,d.yClientsForm.password]])]),e("div",C$,[j$,c(e("input",{type:"text",id:"partner_token",class:"form-control",placeholder:"Ваш партнерский тоукен","aria-label":"Ваш партнерский тоукен","onUpdate:modelValue":t[2]||(t[2]=m=>d.yClientsForm.partner_token=m),"aria-describedby":"Ваш партнерский тоукен",required:""},null,512),[[p,d.yClientsForm.partner_token]])]),e("div",S$,[V$,c(e("input",{type:"number",id:"throttle",class:"form-control",placeholder:"ID компании","aria-label":"ID компании","onUpdate:modelValue":t[3]||(t[3]=m=>d.yClientsForm.company=m),"aria-describedby":"ID компании",required:""},null,512),[[p,d.yClientsForm.company]])])])]),P$],32)],64)}const W0=P(g$,[["render",U$]]),B$={data(){return{load:!1,bot:null,fieldTypes:[{title:"Текст",value:0},{title:"Число",value:1},{title:"Логический",value:2},{title:"Дата и время",value:3}],fieldForm:{fields:[]}}},computed:{...C(["getCurrentBot"])},mounted(){this.loadCurrentBot().then(()=>{this.bot=this.getCurrentBot,this.$nextTick(()=>{this.fieldForm.fields=this.bot.field_settings||[]}),this.loadCurrentBotFields()})},methods:{loadCurrentBotFields(){return this.$store.dispatch("loadCurrentBotFields",{bot_id:this.bot.id}).then(s=>{this.fieldForm.fields=s.data||[]})},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},removeField(s){this.fieldForm.fields.splice(s,1)},submit(){let s=new FormData;Object.keys(this.fieldForm).forEach(t=>{const o=this.fieldForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),s.append("bot_id",this.bot.id),this.$store.dispatch("storeBotFields",{dataObject:s}).then(t=>{this.$notify({title:"Конструктор ботов",text:"Поля успешно обновлены",type:"success"}),this.fieldForm.fields=[],this.fieldForm.fields=t.data}).catch(t=>{this.$notify({title:"Конструктор ботов",text:"Ошибка обновления полей",type:"error"})})},addField(){if(this.fieldForm.fields||(this.fieldForm.fields=[]),this.fieldForm.fields.length>0&&this.fieldForm.fields.findIndex(t=>t.key==null)!==-1){this.$notify({title:"Настраиваемые поля",text:"У вас есть пустые ключевые поля!",type:"error"});return}this.fieldForm.fields.push({key:null,type:0,label:null,description:null,required:!1,validate_pattern:null})}}},O$={class:"mb-2"},T$={class:"d-flex justify-content-between"},q$=e("h6",null,"Настройка полей пользователя бота",-1),D$=e("i",{class:"fa-solid fa-plus mr-2"},null,-1),I$=e("p",null,[e("em",null,"Данные поля будут добавлены пользователю бота и будут автоматически учитываться в условиях страниц, скриптах (в формах заполнения данных), диалогах. Ключи должны быть уникальные для каждого бота. Если ключ дублируется, то будет использовано более позднее его значение. Если поле добавлено и сохранено, то удалить его уже нельзя, только скрыть. "),_(". "),e("br"),e("span",{class:"text-danger"},"*"),_(" - обязательное поле ")],-1),R$={class:"table"},L$=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},[_("Ключ"),e("span",{class:"text-danger"},"*")]),e("th",{scope:"col"},[_("Подпись поля"),e("span",{class:"text-danger"},"*")]),e("th",{scope:"col"},[_("Тип поля"),e("span",{class:"text-danger"},"*")]),e("th",{scope:"col"},"Паттерн"),e("th",{scope:"col"},"Обязательный"),e("th",{scope:"col"},[_("Вопрос для анкеты"),e("span",{class:"text-danger"},"*")]),e("th",{scope:"col"})])],-1),M$={scope:"row"},A$={scope:"col"},E$=["onUpdate:modelValue"],x$={scope:"col"},z$=["onUpdate:modelValue"],K$={scope:"col"},N$=["onUpdate:modelValue"],Y$=["value"],J$={scope:"col"},W$=["disabled","onUpdate:modelValue"],H$={scope:"col"},G$={class:"form-check"},Q$=["onUpdate:modelValue","id"],X$=["for"],Z$={key:0},ey={key:1},ty={scope:"col"},sy=["onUpdate:modelValue"],oy={scope:"col"},ly=["onClick"],iy=e("i",{class:"fa-regular fa-trash-can"},null,-1),ny=[iy],ay={key:1,class:"form-check mt-2"},dy=["onUpdate:modelValue","id"],ry=["for"],cy={key:0},uy=e("i",{class:"fa-solid fa-eye text-success"},null,-1),_y=[uy],hy={key:1},my=e("i",{class:"fa-solid fa-eye-slash text-danger"},null,-1),py=[my],by=e("button",{type:"submit",class:"btn btn-success w-100 p-3"}," Сохранить поля ",-1);function gy(s,t,o,n,d,a){return l(),i("div",O$,[e("div",T$,[q$,e("button",{type:"button",onClick:t[0]||(t[0]=m=>a.addField()),class:"btn mb-2 rounded-sm btn-outline-info"},[D$,_(" Добавить параметр ")])]),I$,e("form",{onSubmit:t[1]||(t[1]=j((...m)=>a.submit&&a.submit(...m),["prevent"]))},[e("table",R$,[L$,e("tbody",null,[(l(!0),i(g,null,y(d.fieldForm.fields,(m,u)=>(l(),i("tr",null,[e("th",M$,h(u+1),1),e("th",A$,[c(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Ключ","aria-label":"Ключ",maxlength:"255","onUpdate:modelValue":$=>d.fieldForm.fields[u].key=$,required:""},null,8,E$),[[p,d.fieldForm.fields[u].key]])]),e("th",x$,[c(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Подпись поля","aria-label":"Название поля",maxlength:"255","onUpdate:modelValue":$=>d.fieldForm.fields[u].label=$,required:""},null,8,z$),[[p,d.fieldForm.fields[u].label]])]),e("th",K$,[c(e("select",{class:"form-select","onUpdate:modelValue":$=>d.fieldForm.fields[u].type=$},[(l(!0),i(g,null,y(d.fieldTypes,$=>(l(),i("option",{value:$.value},h($.title||"Не указан"),9,Y$))),256))],8,N$),[[V,d.fieldForm.fields[u].type]])]),e("th",J$,[c(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Паттерн","aria-label":"Паттерн",maxlength:"255",disabled:d.fieldForm.fields[u].type===2,"onUpdate:modelValue":$=>d.fieldForm.fields[u].validate_pattern=$},null,8,W$),[[p,d.fieldForm.fields[u].validate_pattern]])]),e("th",H$,[e("div",G$,[c(e("input",{class:"form-check-input","onUpdate:modelValue":$=>d.fieldForm.fields[u].required=$,type:"checkbox",value:"",id:"field-required"+u},null,8,Q$),[[k,d.fieldForm.fields[u].required]]),e("label",{class:"form-check-label",for:"field-required"+u},[d.fieldForm.fields[u].required?(l(),i("span",Z$,"Да")):r("",!0),d.fieldForm.fields[u].required?r("",!0):(l(),i("span",ey,"Нет"))],8,X$)])]),e("th",ty,[c(e("input",{type:"text",class:"form-control mb-2 w-100",placeholder:"Описание вопроса","aria-label":"Описание вопроса",maxlength:"255","onUpdate:modelValue":$=>d.fieldForm.fields[u].description=$,required:""},null,8,sy),[[p,d.fieldForm.fields[u].description]])]),e("th",oy,[d.fieldForm.fields[u].id?(l(),i("div",ay,[c(e("input",{class:"form-check-input d-none","onUpdate:modelValue":$=>d.fieldForm.fields[u].is_active=$,type:"checkbox",value:"",id:"field-is_active-"+u},null,8,dy),[[k,d.fieldForm.fields[u].is_active]]),e("label",{class:"form-check-label",for:"field-is_active-"+u},[d.fieldForm.fields[u].is_active?(l(),i("span",cy,_y)):r("",!0),d.fieldForm.fields[u].is_active?r("",!0):(l(),i("span",hy,py))],8,ry)])):(l(),i("button",{key:0,type:"button",onClick:$=>a.removeField(u),class:"btn btn-link text-danger"},ny,8,ly))])]))),256))])]),by],32)])}const H0=P(B$,[["render",gy]]),fy={class:"row"},vy={class:"input-group mb-3"},$y={key:0,class:"row"},yy={class:"col-12 col-md-12 mb-3"},ky={class:"table"},Fy=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"Тип"),e("th",{scope:"col"},"Подпись"),e("th",{scope:"col"},"File Id"),e("th",{scope:"col"},"Действия")])],-1),wy={scope:"row"},Cy={class:"badge bg-info rounded-pill"},jy=["onClick"],Sy=["onClick"],Vy={class:"col-12"},Py={key:1,class:"row"},Uy=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет медиа-файлов ")],-1),By=[Uy],Oy={data(){return{bot:null,loading:!0,media:[],search:null,media_paginate_object:null}},computed:{...C(["getMedia","getMediaPaginateObject","getCurrentBot"])},mounted(){this.loadCurrentBot().then(()=>{this.loadMedia()})},methods:{selectMedia(s){this.$emit("select",s)},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},nextMedia(s){this.loadMedia(s)},remove(s){this.$store.dispatch("removeMedia",{dataObject:{mediaId:s}}).then(t=>{this.loadMedia(),this.$notify({title:"Удаление медиа-контента",text:"Медиа контент удален"})}).catch(()=>{})},showPreview(s){this.$store.dispatch("showMediaPreview",{dataObject:{mediaId:s}}).then(t=>{this.$notify({title:"Превью медиа-контента",text:"Отправлено в бота"})}).catch(()=>{})},loadMedia(s=0){this.loading=!0,this.$store.dispatch("loadMedia",{dataObject:{bot_id:this.bot.id||null,search:this.search,needVideo:!0,needVideoNote:!0,needPhoto:!0,needAudio:!0,needDocument:!0,needSticker:!0},page:s}).then(t=>{this.loading=!1,this.media=this.getMedia,this.media_paginate_object=this.getMediaPaginateObject}).catch(()=>{this.loading=!1})}}},G0=Object.assign(Oy,{__name:"BotMediaTable",setup(s){return(t,o)=>(l(),i(g,null,[e("div",fy,[e("div",vy,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск файла","aria-label":"Поиск файла","onUpdate:modelValue":o[0]||(o[0]=n=>t.search=n)},null,512),[[p,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=n=>t.loadMedia(0)),type:"button",id:"button-addon2"},"Найти ")])]),t.media.length>0?(l(),i("div",$y,[e("div",yy,[e("table",ky,[Fy,e("tbody",null,[(l(!0),i(g,null,y(t.media,(n,d)=>(l(),i("tr",null,[e("th",wy,h(n.id),1),e("td",null,[e("span",Cy,h(n.type),1)]),e("td",null,h(n.caption??"Без подписи"),1),e("td",null,[e("a",{href:"#file",onClick:a=>t.showPreview(n.id)},h(n.file_id),9,jy)]),e("td",null,[e("a",{href:"javascript:void(0)",class:"btn btn-link p-0 my-2 text-danger",onClick:a=>t.remove(n.id)},"Удалить",8,Sy)])]))),256))])])]),e("div",Vy,[t.media_paginate_object?(l(),F(S,{key:0,onPagination_page:t.nextMedia,pagination:t.media_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",Py,By))],64))}}),Ty={class:"row"},qy={class:"col-12 mb-3"},Dy={class:"form-label",id:"service-title"},Iy=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Ry=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Ly={class:"col-12 mb-3"},My={key:0},Ay=["onClick"],Ey={class:"form-label",id:"service-category"},xy=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),zy=e("div",null,"Категория услуги (используется для группировки) ",-1),Ky=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Ny={class:"col-12 mb-3"},Yy={class:"form-label",id:"service-description"},Jy=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Wy=e("div",null," Краткая информация об оказываемой услуге ",-1),Hy=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Gy={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},Qy={class:"col-12 mb-3"},Xy={class:"form-label",id:"service-images"},Zy=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),ek=e("div",null," Изображение, которое видит пользователь при выборе услуги ",-1),tk=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),sk={class:"col-12 mb-3"},ok={class:"form-check"},lk=e("label",{class:"form-check-label",for:"need_prepayment"}," Необходима предоплата ",-1),ik={class:"row"},nk={class:"col-12"},ak={type:"submit",class:"btn btn-outline-success w-100 p-3"},dk={key:0},rk={key:1},ck={props:["service","bot"],data(){return{load:!1,need_reset:!1,event_services:[],serviceForm:{title:null,appointment_event_id:null,description:null,category:null,images:[],need_prepayment:!1,price:0,discount_price:0}}},computed:{categories(){return this.event_services.length==0?[]:this.event_services.map(function(s){return s.category})}},watch:{serviceForm:{handler(s){this.need_reset=!0},deep:!0}},mounted(){this.service&&this.$nextTick(()=>{this.serviceForm={id:this.service.id||null,appointment_event_id:this.service.appointment_event_id||null,title:this.service.title||null,category:this.service.category||null,description:this.service.description||null,images:this.service.images||[],need_prepayment:this.service.need_prepayment||!1,price:this.service.price||0,discount_price:this.service.discount_price||0}})},methods:{selectPhotos(s){this.serviceForm.images||(this.serviceForm.images=[]);let t=this.serviceForm.images.indexOf(s.file_id);t!==-1?this.serviceForm.images.splice(t,1):this.serviceForm.images.push(s.file_id)},resetForm(){},submitForm(){let s=new FormData;Object.keys(this.serviceForm).forEach(t=>{const o=this.serviceForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),s.append("bot_id",this.bot.id),this.$store.dispatch(this.serviceForm.id===null?"addAppointmentService":"updateAppointmentService",{appointmentServiceForm:s}).then(t=>{this.$emit("callback",t.data),this.$notify("Услуги успешно создано")}).catch(t=>{this.$notify("Услуги создания события")})}}},uk=Object.assign(ck,{__name:"AppointmentServiceForm",setup(s){return(t,o)=>{const n=U("Popper");return l(),i("form",{onSubmit:o[4]||(o[4]=j((...d)=>t.submitForm&&t.submitForm(...d),["prevent"]))},[e("div",Ty,[e("div",qy,[e("label",Dy,[f(n,{content:"Название оказываемой услуги"},{default:b(()=>[Iy]),_:1}),_(" Название услуги "),Ry]),c(e("input",{type:"text",class:"form-control",placeholder:"Название","aria-label":"Название","onUpdate:modelValue":o[0]||(o[0]=d=>t.serviceForm.title=d),maxlength:"255","aria-describedby":"service-title",required:""},null,512),[[p,t.serviceForm.title]])]),e("div",Ly,[t.categories?(l(),i("p",My,[_(" Ранее созданные категории: "),(l(!0),i(g,null,y(t.categories,d=>(l(),i("span",{onClick:a=>t.serviceForm.category=d,class:"badge bg-primary"},h(d),9,Ay))),256))])):r("",!0),e("label",Ey,[f(n,null,{content:b(()=>[zy]),default:b(()=>[xy]),_:1}),_(" Категория услуги "),Ky]),c(e("input",{type:"text",class:"form-control",placeholder:"Категория услуги","aria-label":"Категория услуги","onUpdate:modelValue":o[1]||(o[1]=d=>t.serviceForm.category=d),maxlength:"255","aria-describedby":"service-category",required:""},null,512),[[p,t.serviceForm.category]])]),e("div",Ny,[e("label",Yy,[f(n,null,{content:b(()=>[Wy]),default:b(()=>[Jy]),_:1}),_(" Описание услуги "),Hy,t.serviceForm.description?(l(),i("small",Gy," Длина текста "+h(t.serviceForm.description.length),1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Описание услуги","aria-label":"Описание услуги","onUpdate:modelValue":o[2]||(o[2]=d=>t.serviceForm.description=d),"aria-describedby":"service-description",required:""},`
                    `,512),[[p,t.serviceForm.description]])]),e("div",Qy,[e("label",Xy,[f(n,null,{content:b(()=>[ek]),default:b(()=>[Zy]),_:1}),_(" Изображение к услуге "),tk]),f(B,{"need-photo":!0,selected:t.serviceForm.images,onSelect:t.selectPhotos},null,8,["selected","onSelect"])]),e("div",sk,[e("div",ok,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[3]||(o[3]=d=>t.serviceForm.need_prepayment=d),type:"checkbox",id:"need_prepayment"},null,512),[[k,t.serviceForm.need_prepayment]]),lk])])]),e("div",ik,[e("div",nk,[e("button",ak,[t.serviceForm.id===null?(l(),i("span",dk,"Создать услугу")):(l(),i("span",rk,"Обновить услугу"))])])])],32)}}}),_k={class:"row"},hk={class:"col-12 mb-3"},mk={class:"form-label",id:"event-title"},pk=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),bk=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),gk={class:"col-12 mb-3"},fk={class:"form-label",id:"event-subtitle"},vk=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),$k=e("div",null,"Подзаголовок события или доп. инфа под названием события ",-1),yk=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),kk={class:"col-12 mb-3"},Fk={class:"form-label",id:"event-description"},wk=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Ck=e("div",null," Краткая информация о происходящем мероприятии ",-1),jk=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Sk={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},Vk={class:"col-12 mb-3"},Pk={class:"form-label",id:"event-on_start_appointment"},Uk=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Bk=e("div",null," Текст, который будет отображен клиенту, когда тот записался ",-1),Ok=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Tk={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},qk={class:"col-12 mb-3"},Dk={class:"form-label",id:"event-on_cancel_appointment"},Ik=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Rk=e("div",null," Текст, который будет отображен клиенту, когда тот отменил запись ",-1),Lk=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Mk={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},Ak={class:"col-12 mb-3"},Ek={class:"form-label",id:"event-on_after_appointment"},xk=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),zk=e("div",null," Текст, который будет отображен клиенту, когда тот прошел событие успешно ",-1),Kk=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Nk={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},Yk={class:"col-12 mb-3"},Jk={class:"form-label",id:"event-on_repeat_appointment"},Wk=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Hk=e("div",null," Текст, который будет отображен клиенту, когда тот записывается 2й и более раз ",-1),Gk=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Qk={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},Xk={class:"col-12 mb-3"},Zk={class:"form-label",id:"event-images"},e2=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),t2=e("div",null," Изображение, которое видит пользователь при выборе события ",-1),s2=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),o2={class:"col-12 mb-3"},l2={class:"form-check"},i2=e("label",{class:"form-check-label",for:"is-group"}," Является групповым мероприятием ",-1),n2={key:0,class:"col-md-6 col-12 mb-3"},a2={class:"form-label",id:"event-min_people"},d2=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),r2=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),c2={key:1,class:"col-md-6 col-12 mb-3"},u2={class:"form-label",id:"event-max_people"},_2=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),h2=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),m2={class:"row"},p2={class:"col-12 mb-3"},b2={class:"form-check"},g2=e("label",{class:"form-check-label",for:"need-services"}," Нужно добавить сервисы ",-1),f2={key:0,class:"col-12 mb-3"},v2={class:"row"},$2={class:"col-12"},y2={type:"submit",class:"btn btn-outline-success w-100 p-3"},k2={key:0},F2={key:1},w2={props:["event","bot"],data(){return{step:0,load:!1,need_reset:!1,need_services:!1,eventForm:{id:null,title:null,subtitle:null,description:null,images:[],services:[],times:[],is_group:!1,max_people:0,min_people:0,on_start_appointment:null,on_cancel_appointment:null,on_after_appointment:null,on_repeat_appointment:null}}},watch:{eventForm:{handler(s){this.need_reset=!0},deep:!0}},mounted(){this.event&&this.$nextTick(()=>{this.eventForm={id:this.event.id||null,title:this.event.title||null,subtitle:this.event.subtitle||null,description:this.event.description||null,images:this.event.images||[],is_group:this.event.is_group||!1,max_people:this.event.max_people||0,min_people:this.event.min_people||0,on_start_appointment:this.event.on_start_appointment||null,on_cancel_appointment:this.event.on_cancel_appointment||null,on_after_appointment:this.event.on_after_appointment||null,on_repeat_appointment:this.event.on_repeat_appointment||null}})},methods:{selectPhotos(s){this.eventForm.images||(this.eventForm.images=[]);let t=this.eventForm.images.indexOf(s.file_id);t!==-1?this.eventForm.images.splice(t,1):this.eventForm.images.push(s.file_id)},resetForm(){},submitForm(){let s=new FormData;Object.keys(this.eventForm).forEach(t=>{const o=this.eventForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),s.append("bot_id",this.bot.id),this.$store.dispatch(this.eventForm.id===null?"addAppointmentEvent":"updateAppointmentEvent",{appointmentEventForm:s}).then(t=>{this.$emit("callback",t.data),this.$notify("Событие успешно создано")}).catch(t=>{this.$notify("Ошибка создания события")})}}},C2=Object.assign(w2,{__name:"AppointmentEventForm",setup(s){return(t,o)=>{const n=U("Popper");return l(),i("form",{onSubmit:o[11]||(o[11]=j((...d)=>t.submitForm&&t.submitForm(...d),["prevent"]))},[e("div",_k,[e("div",hk,[e("label",mk,[f(n,{content:"Название вашего события (или специалиста), на которое планируется осуществить запись"},{default:b(()=>[pk]),_:1}),_(" Название события "),bk]),c(e("input",{type:"text",class:"form-control",placeholder:"Название","aria-label":"Название","onUpdate:modelValue":o[0]||(o[0]=d=>t.eventForm.title=d),maxlength:"255","aria-describedby":"event-title",required:""},null,512),[[p,t.eventForm.title]])]),e("div",gk,[e("label",fk,[f(n,null,{content:b(()=>[$k]),default:b(()=>[vk]),_:1}),_(" Подзаголовок события "),yk]),c(e("input",{type:"text",class:"form-control",placeholder:"Подзаголовок","aria-label":"Подзаголовок","onUpdate:modelValue":o[1]||(o[1]=d=>t.eventForm.subtitle=d),maxlength:"255","aria-describedby":"event-subtitle",required:""},null,512),[[p,t.eventForm.subtitle]])]),e("div",kk,[e("label",Fk,[f(n,null,{content:b(()=>[Ck]),default:b(()=>[wk]),_:1}),_(" Описание события "),jk,t.eventForm.description?(l(),i("small",Sk," Длина текста "+h(t.eventForm.description.length),1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Описание мероприятия","aria-label":"Описание мероприятия","onUpdate:modelValue":o[2]||(o[2]=d=>t.eventForm.description=d),"aria-describedby":"event-description",required:""},`
                    `,512),[[p,t.eventForm.description]])]),e("div",Vk,[e("label",Pk,[f(n,null,{content:b(()=>[Bk]),default:b(()=>[Uk]),_:1}),_(" Текст при записи на событие "),Ok,t.eventForm.on_start_appointment?(l(),i("small",Tk," Длина текста "+h(t.eventForm.on_start_appointment.length),1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст при записи на событие","aria-label":"Текст при записи на событие","onUpdate:modelValue":o[3]||(o[3]=d=>t.eventForm.on_start_appointment=d),"aria-describedby":"event-on_start_appointment",required:""},`
                    `,512),[[p,t.eventForm.on_start_appointment]])]),e("div",qk,[e("label",Dk,[f(n,null,{content:b(()=>[Rk]),default:b(()=>[Ik]),_:1}),_(" Текст при отмене записи на событие "),Lk,t.eventForm.on_cancel_appointment?(l(),i("small",Mk," Длина текста "+h(t.eventForm.on_cancel_appointment.length),1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст при отмене записи на событие","aria-label":"Текст при отмене записи на событие","onUpdate:modelValue":o[4]||(o[4]=d=>t.eventForm.on_cancel_appointment=d),"aria-describedby":"event-on_cancel_appointment",required:""},`
                    `,512),[[p,t.eventForm.on_cancel_appointment]])]),e("div",Ak,[e("label",Ek,[f(n,null,{content:b(()=>[zk]),default:b(()=>[xk]),_:1}),_(" Текст после прохождения события "),Kk,t.eventForm.on_after_appointment?(l(),i("small",Nk," Длина текста "+h(t.eventForm.on_after_appointment.length),1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст после прохождения события","aria-label":"Текст после прохождения события","onUpdate:modelValue":o[5]||(o[5]=d=>t.eventForm.on_after_appointment=d),"aria-describedby":"event-on_after_appointment",required:""},`
                    `,512),[[p,t.eventForm.on_after_appointment]])]),e("div",Yk,[e("label",Jk,[f(n,null,{content:b(()=>[Hk]),default:b(()=>[Wk]),_:1}),_(" Текст при повторной записи на событие "),Gk,t.eventForm.on_repeat_appointment?(l(),i("small",Qk," Длина текста "+h(t.eventForm.on_repeat_appointment.length),1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:" Текст при повторной записи на событие","aria-label":" Текст при повторной записи на событие","onUpdate:modelValue":o[6]||(o[6]=d=>t.eventForm.on_repeat_appointment=d),"aria-describedby":"event-on_repeat_appointment",required:""},`
                    `,512),[[p,t.eventForm.on_repeat_appointment]])]),e("div",Xk,[e("label",Zk,[f(n,null,{content:b(()=>[t2]),default:b(()=>[e2]),_:1}),_(" Изображение к событию "),s2]),f(B,{"need-photo":!0,selected:t.eventForm.images,onSelect:t.selectPhotos},null,8,["selected","onSelect"])]),e("div",o2,[e("div",l2,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[7]||(o[7]=d=>t.eventForm.is_group=d),type:"checkbox",id:"is-group"},null,512),[[k,t.eventForm.is_group]]),i2])]),t.eventForm.is_group?(l(),i("div",n2,[e("label",a2,[f(n,{content:"Минимально необходимое число людей, для начала 1 мероприятия"},{default:b(()=>[d2]),_:1}),_(" Минимальное число посетителей в группе "),r2]),c(e("input",{type:"number",class:"form-control",placeholder:"Минимальное число посетителей","aria-label":"Название","onUpdate:modelValue":o[8]||(o[8]=d=>t.eventForm.min_people=d),"aria-describedby":"event-min_people",required:""},null,512),[[p,t.eventForm.min_people]])])):r("",!0),t.eventForm.is_group?(l(),i("div",c2,[e("label",u2,[f(n,{content:"Количество людей, которые могут посетить мероприятие за 1 сеанс"},{default:b(()=>[_2]),_:1}),_(" Максимальное число посетителей в группе "),h2]),c(e("input",{type:"number",class:"form-control",placeholder:"Максимальное число посетителей","aria-label":"Название","onUpdate:modelValue":o[9]||(o[9]=d=>t.eventForm.max_people=d),"aria-describedby":"event-max_people",required:""},null,512),[[p,t.eventForm.max_people]])])):r("",!0)]),e("div",m2,[e("div",p2,[e("div",b2,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[10]||(o[10]=d=>t.need_services=d),type:"checkbox",id:"need-services"},null,512),[[k,t.need_services]]),g2])]),t.need_services?(l(),i("div",f2,[f(uk,{bot:s.bot},null,8,["bot"])])):r("",!0)]),e("div",v2,[e("div",$2,[e("button",y2,[t.eventForm.id==null?(l(),i("span",k2,"Создать событие")):(l(),i("span",F2,"Обновить событие"))])])])],32)}}}),j2={props:["bot"],data(){return{direction:"desc",order:"updated_at",show:!0,is_group:!1,loading:!0,events:[],search:null,paginate_object:null}},computed:{...C(["getAppointmentEvents","getAppointmentEventsPaginateObject"])},mounted(){this.loadAppointmentEvents()},methods:{duplicate(s){if(!this.getCurrentCompany){this.$notify("У Вас не выбран клиент!");return}this.$store.dispatch("duplicateBot",{dataObject:{bot_id:s,company_id:this.getCurrentCompany.id}}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно продублирован")})},addToArchive(s){this.$store.dispatch("removeBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен в архив")})},forceDelete(s){this.$store.dispatch("forceDeleteBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен из архива")})},extractFromArchive(s){this.$store.dispatch("restoreBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен из архива")})},nextAppointmentEvents(s){this.loadAppointmentEvents(s)},loadAndOrder(s){this.order=s,this.direction=this.direction==="desc"?"asc":"desc",this.loadBots(0)},loadAppointmentEvents(s=0){this.loading=!0,this.$store.dispatch("loadAppointmentEvents",{dataObject:{bot_id:this.bot.id||null,search:this.search,is_group:this.is_group,order:this.order,direction:this.direction},page:s,size:100}).then(t=>{this.loading=!1,this.events=this.getAppointmentEvents,this.paginate_object=this.getAppointmentEventsPaginateObject}).catch(()=>{this.loading=!1})}}},Q0=Object.assign(j2,{__name:"AppointmentEventTable",setup(s){return(t,o)=>(l(),F(C2,{bot:s.bot},null,8,["bot"]))}});const S2={key:0},V2={class:"row"},P2={class:"col-md-12 d-flex flex-column"},U2={class:"d-flex"},B2={class:"dropdown mr-2"},O2=e("button",{class:"btn btn-outline-primary dropdown-toggle",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"}," Фильтры ",-1),T2={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},q2=["onClick"],D2={class:"input-group mb-3"},I2={key:0,class:"mt-2"},R2={class:"badge bg-info mr-1"},L2=["onClick"],M2=e("i",{class:"fa-solid fa-xmark"},null,-1),A2=[M2],E2={key:0,class:"row"},x2={class:"col-12"},z2={class:"mb-0"},K2={class:"mb-0"},N2={key:1,class:"row"},Y2={class:"col-12 mb-3"},J2={key:0,class:"col-12 mb-3"},W2={class:"table"},H2=e("th",{scope:"col"},"Действие",-1),G2={scope:"row"},Q2=["onClick"],X2=["onClick"],Z2={key:0,class:"badge bg-primary"},e0={key:1},t0=["onClick"],s0=e("i",{class:"fa-regular fa-copy"},null,-1),o0=[s0],l0=["onClick"],i0=e("i",{class:"fa-solid fa-boxes-packing"},null,-1),n0=[i0],a0=["onClick"],d0=e("i",{class:"fa-solid fa-box-open"},null,-1),r0=[d0],c0=["onClick"],u0=e("i",{class:"fa-solid fa-trash-can text-white"},null,-1),_0=[u0],h0={class:"col-lg-4 col-12 mb-3"},m0={class:"card-body"},p0=["onClick"],b0={key:0,class:"badge bg-info"},g0={class:"card-footer d-flex"},f0=["onClick"],v0=e("i",{class:"fa-regular fa-copy"},null,-1),$0=[v0],y0=["onClick"],k0=e("i",{class:"fa-solid fa-boxes-packing"},null,-1),F0=[k0],w0=["onClick"],C0=e("i",{class:"fa-solid fa-box-open"},null,-1),j0=[C0],S0=["onClick"],V0=e("i",{class:"fa-solid fa-trash-can text-white"},null,-1),P0=[V0],U0={class:"col-12"},B0={key:2,class:"row"},O0=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранной компании нет созданных ботов! ")],-1),T0=[O0],q0={props:["companyId","editor"],data(){return{displayType:1,direction:"desc",order:"updated_at",filters:[{name:"Активные",icon:"fa-brands fa-telegram",slug:"active"},{name:"Архивные",icon:"fa-solid fa-box-archive",slug:"archive"}],selectedFilters:[],show:!0,loading:!0,bots:[],search:null,bots_paginate_object:null}},watch:{displayType:function(s,t){localStorage.setItem("cashman_set_botlist_display_type",this.displayType)}},computed:{...C(["getBots","getBotsPaginateObject","getCurrentCompany"]),filteredBots(){if(!this.bots)return[];if(this.selectedFilters.length===0&&this.search==null)return this.bots;if(this.selectedFilters.length===0&&this.search!=null)return this.bots.filter(t=>(t.bot_domain||"").trim().toLowerCase().indexOf(this.search.trim().toLowerCase())!==-1);let s=[];return this.selectedFilters.forEach(t=>{switch(t.slug){case"active":this.bots.filter(o=>o.deleted_at==null).forEach(o=>{s.push(o)});break;case"archive":this.bots.filter(o=>o.deleted_at!=null).forEach(o=>{s.push(o)});break}}),this.search==null?s:s.filter(t=>(t.bot_domain||"").trim().toLowerCase().indexOf(this.search.trim().toLowerCase())!==-1)}},mounted(){this.loadBots(),this.selectFilter("active"),this.displayType=parseInt(localStorage.getItem("cashman_set_botlist_display_type")||0)},methods:{duplicate(s){if(!this.getCurrentCompany){this.$notify("У Вас не выбран клиент!");return}this.$store.dispatch("duplicateBot",{dataObject:{bot_id:s,company_id:this.getCurrentCompany.id}}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно продублирован")})},addToArchive(s){this.$store.dispatch("removeBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен в архив")})},forceDelete(s){this.$store.dispatch("forceDeleteBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен из архива")})},extractFromArchive(s){this.$store.dispatch("restoreBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен из архива")})},selectFilter(s){let t=this.filters.find(o=>o.slug===s);t&&this.selectedFilters.filter(o=>o.slug===s).length===0&&this.selectedFilters.push(t)},removeSelectedFilter(s){let t=this.selectedFilters.findIndex(o=>o.slug===s);this.selectedFilters.splice(t,1)},selectBot(s){this.$emit("callback",s),this.show=!1,this.$notify("Вы выбрали бота из списка! Все остальные действия будут производится для этого бота.")},nextBots(s){this.loadBots(s)},loadAndOrder(s){this.order=s,this.direction=this.direction==="desc"?"asc":"desc",this.loadBots(0)},loadBots(s=0){this.loading=!0,this.$store.dispatch("loadBots",{dataObject:{companyId:this.companyId||null,search:this.search,order:this.order,direction:this.direction},page:s,size:100}).then(t=>{this.loading=!1,this.bots=this.getBots,this.bots_paginate_object=this.getBotsPaginateObject}).catch(()=>{this.loading=!1})}}},X0=Object.assign(q0,{__name:"BotList",setup(s){return(t,o)=>t.show?(l(),i("div",S2,[e("div",V2,[e("div",P2,[e("div",U2,[e("div",B2,[O2,e("ul",T2,[(l(!0),i(g,null,y(t.filters,n=>(l(),i("li",null,[e("a",{class:"dropdown-item",onClick:d=>t.selectFilter(n.slug),href:"#filter"},[e("i",{class:v([n.icon,"mr-2"])},null,2),_(" "+h(n.name||"Не указано"),1)],8,q2)]))),256))])]),e("div",D2,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск бота","aria-label":"Поиск бота","onUpdate:modelValue":o[0]||(o[0]=n=>t.search=n),"aria-describedby":"button-addon2"},null,512),[[p,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=(...n)=>t.loadBots&&t.loadBots(...n)),type:"button",id:"button-addon2"},"Найти ")])]),t.selectedFilters.length>0?(l(),i("p",I2,[(l(!0),i(g,null,y(t.selectedFilters,n=>(l(),i("span",R2,[_(h(n.name||"не указан")+" ",1),e("a",{onClick:d=>t.removeSelectedFilter(n.slug),class:"ml-1 text-white",href:"#filter"},A2,8,L2)]))),256))])):r("",!0)])]),t.bots_paginate_object?(l(),i("div",E2,[e("div",x2,[e("p",z2,"Количество найденных ботов "+h(t.bots_paginate_object.meta.total||0),1),e("p",K2,"Количество результатов на странице "+h(t.filteredBots.length||0),1),e("p",null,[_(" Тип отображения списка: "),e("span",{onClick:o[2]||(o[2]=n=>t.displayType=0),class:v([{"bg-success":t.displayType===0,"bg-secondary":t.displayType!==0},"badge cursor-pointer mr-2"])},"Карточки",2),e("span",{class:v([{"bg-success":t.displayType===1,"bg-secondary":t.displayType!==1},"badge cursor-pointer mr-2"]),onClick:o[3]||(o[3]=n=>t.displayType=1)},"Таблица",2)])])])):r("",!0),t.bots.length>0?(l(),i("div",N2,[e("div",Y2,[s.editor?r("",!0):(l(),i("button",{key:0,type:"button",class:"btn btn-outline-info",onClick:o[4]||(o[4]=n=>t.selectBot(null))},"Создать нового бота "))]),t.displayType===1?(l(),i("div",J2,[e("table",W2,[e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"cursor-pointer",onClick:o[5]||(o[5]=n=>t.loadAndOrder("id"))},"#"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[6]||(o[6]=n=>t.loadAndOrder("bot_domain"))},"Домен"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[7]||(o[7]=n=>t.loadAndOrder("title"))},"Название"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[8]||(o[8]=n=>t.loadAndOrder("template_description"))},"Шаблон"),e("th",{scope:"col",class:"cursor-pointer",onClick:o[9]||(o[9]=n=>t.loadAndOrder("updated_at"))},"Дата изменения"),H2])]),e("tbody",null,[(l(!0),i(g,null,y(t.filteredBots,(n,d)=>(l(),i("tr",{class:v({"border-info":n.deleted_at==null,"border-danger":n.deleted_at!=null})},[e("th",G2,h(n.id),1),e("td",{onClick:a=>t.selectBot(n)},[e("i",{class:v([{"text-danger":n.deleted_at!=null},"fa-solid fa-robot mr-2"])},null,2),_(" "+h(n.bot_domain||"Не указано"),1)],8,Q2),e("td",{onClick:a=>t.selectBot(n)},h(n.title||"Не указано"),9,X2),e("td",null,[n.is_template?(l(),i("span",Z2,h(n.template_description||"Не указано"),1)):(l(),i("span",e0,"Не является шаблоном"))]),e("td",null,h(t.$filters.current(n.updated_at)),1),e("td",null,[e("button",{class:"btn btn-outline-info mr-2",type:"button",onClick:a=>t.duplicate(n.id),title:"Дублировать"},o0,8,t0),n.deleted_at==null?(l(),i("button",{key:0,class:"btn btn-outline-info",type:"button",onClick:a=>t.addToArchive(n.id),title:"В архив"},n0,8,l0)):r("",!0),n.deleted_at!=null?(l(),i("button",{key:1,class:"btn btn-outline-info mr-2",onClick:a=>t.extractFromArchive(n.id),title:"Из архива"},r0,8,a0)):r("",!0),n.deleted_at!=null?(l(),i("button",{key:2,class:"btn btn-danger mr-2",onClick:a=>t.forceDelete(n.id),title:"Удалить на совсем"},_0,8,c0)):r("",!0)])],2))),256))])])])):r("",!0),t.displayType===0?(l(!0),i(g,{key:1},y(t.filteredBots,(n,d)=>(l(),i("div",h0,[e("div",{class:v(["card w-100",{"border-info":n.deleted_at==null,"border-secondary":n.deleted_at!=null}])},[e("div",m0,[e("p",{class:"d-flex justify-content-between",onClick:a=>t.selectBot(n),style:{"word-wrap":"break-word"}},[e("span",null,[e("i",{class:v([{"text-danger":n.deleted_at!=null},"fa-solid fa-robot mr-2"])},null,2),_(" "+h(n.bot_domain||"Не указано"),1)]),n.is_template?(l(),i("span",b0,h(n.template_description||"Шаблон без названия"),1)):r("",!0)],8,p0)]),e("div",g0,[e("button",{class:"btn btn-outline-info mr-2",type:"button",onClick:a=>t.duplicate(n.id),title:"Дублировать"},$0,8,f0),n.deleted_at==null?(l(),i("button",{key:0,class:"btn btn-outline-info",type:"button",onClick:a=>t.addToArchive(n.id),title:"В архив"},F0,8,y0)):r("",!0),n.deleted_at!=null?(l(),i("button",{key:1,class:"btn btn-outline-info mr-2",onClick:a=>t.extractFromArchive(n.id),title:"Из архива"},j0,8,w0)):r("",!0),n.deleted_at!=null?(l(),i("button",{key:2,class:"btn btn-danger mr-2",onClick:a=>t.forceDelete(n.id),title:"Удалить на совсем"},P0,8,S0)):r("",!0)])],2)]))),256)):r("",!0),e("div",U0,[t.bots_paginate_object?(l(),F(S,{key:0,onPagination_page:t.nextBots,pagination:t.bots_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",B0,T0))])):r("",!0)}});export{J0 as A,H0 as B,W0 as Y,K0 as _,X0 as a,I as b,N0 as c,c_ as d,Q0 as e,G0 as f,Y0 as g,x0 as h,z0 as i};
