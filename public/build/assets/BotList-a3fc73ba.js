import{o as l,q as i,t as e,F as b,B as f,x as h,C as m,z as r,N as P,D as c,T as V,v as w,H as $,G as _,O as k,A as v,J as U,S as O,M as g,K as q}from"./index.es-0d0be4b9.js";import{B as T,_ as L,a as z}from"./Mail-8604854c.js";import{_ as E,a as K}from"./SlugForm-c6877287.js";import{P as S}from"./Pagination-6b5f82da.js";import{m as C}from"./index-d069a1eb.js";import{_ as j}from"./_plugin-vue_export-helper-c27b6911.js";import{T as B}from"./TelegramChannelHelper-1f5aa349.js";/* empty css                                                               */const N={props:["param"],data(){return{expressions:[{expression:"{{userName}}",description:"Имя пользователя"},{expression:"{{telegramChatId}}",description:"Идентификатор чата"},{expression:"{{referralLink}}",description:"Реферальная ссылка"},{expression:"{{referralQr}}",description:"Реферальный QR-код"}]}},methods:{expressionsSelect(s){this.$emit("callback",{param:this.param,text:s.expression})}}},x={class:"dropdown"},A=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-brands fa-hire-a-helper"})],-1),J={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},W=["onClick"];function Y(s,t,o,a,d,n){return l(),i("div",x,[A,e("div",J,[e("li",null,[(l(!0),i(b,null,f(d.expressions,p=>(l(),i("a",{class:"dropdown-item",onClick:u=>n.expressionsSelect(p)},h(p.description||"-"),9,W))),256))])])])}const H=j(N,[["render",Y]]);const Q={class:"card-header d-flex justify-content-between"},X={class:"dropdown"},Z=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),ee={class:"dropdown-menu"},te=e("i",{class:"fa-solid fa-arrow-left mr-1"},null,-1),se=e("hr",null,null,-1),oe=["data-bs-target"],le=e("i",{class:"fa-regular fa-pen-to-square mr-1"},null,-1),ie=e("i",{class:"fa-solid fa-clone mr-1"},null,-1),ne=e("i",{class:"fa-regular fa-trash-can text-danger mr-1"},null,-1),ae={key:0,class:"fa-solid fa-arrow-up-short-wide"},de={key:1,class:"fa-solid fa-arrow-down-short-wide"},re={class:"card-body"},ce={class:"row"},ue={class:"col-12"},me={key:0},he={key:1,class:"list-group list-group-numbered"},_e={class:"list-group-item d-flex justify-content-between align-items-start"},pe={class:"ms-2 me-auto"},be=e("div",{class:"fw-bold"},"Идентификатор",-1),ge={class:"list-group-item d-flex justify-content-between align-items-start"},fe={class:"ms-2 me-auto"},ve=e("div",{class:"fw-bold"},"Команда",-1),ye={class:"list-group-item d-flex justify-content-between align-items-start"},$e={class:"ms-2 me-auto"},ke=e("div",{class:"fw-bold"},"Мнемоническое имя",-1),Fe={class:"list-group-item d-flex justify-content-between align-items-start"},we={class:"ms-2 me-auto"},Ce=e("div",{class:"fw-bold"},"Пояснение",-1),Pe={key:0,class:"list-group-item d-flex justify-content-between align-items-start"},Se={class:"ms-2 me-auto"},je=e("div",{class:"fw-bold"},"Набор параметров скрипта",-1),Ve={key:1,class:"list-group-item d-flex justify-content-between align-items-start"},Ue=e("div",{class:"ms-2 me-auto"},[e("div",{class:"fw-bold"},"Привязана страница")],-1),Be=[Ue],Oe={key:2,class:"list-group-item d-flex justify-content-between align-items-start"},Ie=e("div",{class:"ms-2 me-auto"},[e("div",{class:"fw-bold"},"Глобальный скрипт")],-1),Te=[Ie],Le={class:"list-group-item d-flex justify-content-between align-items-start"},De={class:"ms-2 me-auto w-100"},qe=e("div",{class:"fw-bold"},"Перенести данные из:",-1),Re=e("option",{value:null},"Не выбрано",-1),Me=["value"],Ge=e("p",{class:"my-2"},[e("em",null,"Перенос данных затирает текущие данные в данном скрипте")],-1),ze=["disabled"],Ee=["id"],Ke={class:"modal-dialog modal-lg"},Ne={class:"modal-content"},xe={class:"modal-header"},Ae={class:"modal-title",id:"exampleModalLabel"},Je=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),We={class:"modal-body"},Ye=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),He={props:["item","bot","selectMode"],data(){return{selected_slug_id:null,slugs:[],load:!1,simple:!0}},watch:{simple:function(){this.simple||this.loadAllSlugs()}},mounted(){},methods:{selectCard(){this.$emit("select",this.item)},slugFormCallback(){this.load=!0,this.$emit("callback"),this.$nextTick(()=>{this.load=!1})},editSlug(){this.load=!0,this.$nextTick(()=>{this.load=!1})},selectSlug(){this.load=!0,this.$emit("select",this.item),this.$nextTick(()=>{this.load=!1})},duplicateSlug(){this.load=!0,this.$store.dispatch("duplicateSlug",{dataObject:{slugId:this.item.id}}).then(s=>{this.$notify({title:"Конструктор команд",text:"Команда успешно продублирована",type:"success"}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}).catch(s=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})},submitRelocateData(){this.$store.dispatch("relocateSlugActionData",{slug_sender_id:this.selected_slug_id,slug_recipient_id:this.item.id,bot_id:this.bot.id}).then(s=>{this.$notify({title:"Конструктор команд",text:"Данные команды успешно перенесены",type:"success"})}).catch(s=>{this.$notify({title:"Конструктор команд",text:"Ошибка переноса данных",type:"error"})})},loadAllSlugs(){this.$store.dispatch("loadAllSlugs",{botId:this.bot.id}).then(s=>{this.slugs=s.data})},removeSlug(){this.load=!0,this.$store.dispatch("removeSlug",{dataObject:{slugId:this.item.id}}).then(s=>{this.$notify({title:"Конструктор команд",text:"Команда успешно удалена",type:"success"}),this.$emit("callback"),this.$nextTick(()=>{this.load=!1})}).catch(s=>{this.$emit("callback"),this.$nextTick(()=>{this.load=!1})})}}},R=Object.assign(He,{__name:"Slug",setup(s){return(t,o)=>(l(),i(b,null,[e("div",{class:w(["card",{"deprecated-slug":s.item.deprecated_at!=null,"global-slug":s.item.is_global}])},[e("div",Q,[e("div",X,[Z,e("ul",ee,[e("li",null,[e("a",{onClick:o[0]||(o[0]=(...a)=>t.selectSlug&&t.selectSlug(...a)),title:"Выбрать команду",class:"dropdown-item cursor-pointer"},[te,m(" Выбрать команду ")])]),se,e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:o[1]||(o[1]=(...a)=>t.editSlug&&t.editSlug(...a)),"data-bs-toggle":"modal","data-bs-target":"#edit-slug-"+s.item.id},[le,m(" Редактировать")],8,oe)]),e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:o[2]||(o[2]=(...a)=>t.duplicateSlug&&t.duplicateSlug(...a))},[ie,m(" Дублировать")])]),e("li",null,[e("a",{class:"dropdown-item cursor-pointer",onClick:o[3]||(o[3]=(...a)=>t.removeSlug&&t.removeSlug(...a))},[ne,m(" Удалить")])])])]),e("button",{type:"button",onClick:o[4]||(o[4]=a=>t.simple=!t.simple),class:"btn btn-outline-primary ml-2"},[t.simple?(l(),i("i",ae)):(l(),i("i",de))])]),e("div",re,[e("div",ce,[e("div",ue,[t.simple?(l(),i("p",me,h(s.item.command||"Нет команды"),1)):(l(),i("ol",he,[e("li",_e,[e("div",pe,[be,m(" №"+h(s.item.id||"Нет идентификатора"),1)])]),e("li",ge,[e("div",fe,[ve,m(" "+h(s.item.command||"Нет команды"),1)])]),e("li",ye,[e("div",$e,[ke,m(" "+h(s.item.slug||"Slug"),1)])]),e("li",Fe,[e("div",we,[Ce,m(" "+h(s.item.comment||"Пояснение не указано"),1)])]),s.item.config?(l(),i("li",Pe,[e("div",Se,[je,s.item.config?(l(!0),i(b,{key:0},f(s.item.config,a=>(l(),i("p",null,[e("strong",null,h(a.key||"Ключ не найден")+":",1),m(h(a.value||"Не указано"),1)]))),256)):r("",!0)])])):r("",!0),s.item.page?(l(),i("li",Ve,Be)):r("",!0),s.item.is_global?(l(),i("li",Oe,Te)):r("",!0),e("li",Le,[e("div",De,[e("form",{onSubmit:o[6]||(o[6]=P((...a)=>t.submitRelocateData&&t.submitRelocateData(...a),["prevent"]))},[qe,c(e("select",{class:"form-control w-100","onUpdate:modelValue":o[5]||(o[5]=a=>t.selected_slug_id=a),required:""},[Re,(l(!0),i(b,null,f(t.slugs,a=>(l(),i("option",{value:a.id},"#"+h(a.id)+" "+h(a.slug||"Не указан"),9,Me))),256))],512),[[V,t.selected_slug_id]]),Ge,e("button",{disabled:t.selected_slug_id==null,class:"btn btn-outline-warning w-100"}," Выполнить перенос ",8,ze)],32)])])]))])])])],2),e("div",{class:"modal fade",id:"edit-slug-"+s.item.id,tabindex:"-1"},[e("div",Ke,[e("div",Ne,[e("div",xe,[e("h5",Ae,[m("Редактирование команды #"),e("span",null,h(s.item.id),1)]),Je]),e("div",We,[t.load?r("",!0):(l(),$(E,{key:0,item:s.item,onCallback:t.slugFormCallback},null,8,["item","onCallback"]))]),Ye])])],8,Ee)],64))}}),Qe={key:0,class:"row"},Xe={class:"col-12 mb-2"},Ze={key:0},et=e("i",{class:"fa-solid fa-scroll"},null,-1),tt={key:1},st=e("i",{class:"fa-regular fa-square-minus"},null,-1),ot={key:0,class:"col-12"},lt={class:"col-12"},it={class:"form-floating mb-3"},nt=e("label",{for:"floatingInput"},"Быстрый поиск команды",-1),at={class:"col-12 mb-2"},dt={class:"form-check"},rt={class:"form-check-label",for:"need_global"},ct={key:0},ut={key:1},mt={class:"mb-3 col-12 col-lg-4 col-md-6 col-sm-12"},ht={key:3,class:"mb-3 col-md-12"},_t=e("div",{class:"alert alert-danger",role:"alert"}," У Вас еще нет добавленных скриптов! ",-1),pt=[_t],bt={props:["command"],data(){return{bot:null,need_global:!0,show:!1,slugs:[],paginate:[],ownSearch:null,slugForm:{command:null,comment:null,slug:null}}},watch:{need_global:function(s,t){this.loadSlugs()}},computed:{...C(["getCurrentBot","getSlugs","getSlugsPaginateObject"]),filteredSlugs(){return this.slugs.length===0?[]:this.ownSearch==null?this.slugs:this.slugs.filter(s=>{let t=s.slug||"",o=s.command||"",a=s.comment||"";return o.toLowerCase().indexOf(this.ownSearch.toLowerCase())!==-1||a.toLowerCase().indexOf(this.ownSearch.toLowerCase())!==-1||t.toLowerCase().indexOf(this.ownSearch.toLowerCase())!==-1})}},mounted(){this.loadCurrentBot().then(()=>{this.loadSlugs(),this.command&&this.$nextTick(()=>{this.slugForm.command=this.command})})},methods:{nextSlugs(s){this.loadSlugs(s)},loadSlugs(s=0){this.$store.dispatch("loadSlugs",{dataObject:{botId:this.bot.id,needGlobal:this.need_global},page:s}).then(t=>{this.slugs=this.getSlugs,this.paginate=this.getSlugsPaginateObject})},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},callbackSlugs(){this.loadSlugs()},selectSlug(s){this.$emit("select",s)}}},gt=Object.assign(bt,{__name:"BotSlugList",setup(s){return(t,o)=>t.bot?(l(),i("div",Qe,[e("div",Xe,[e("button",{type:"button",onClick:o[0]||(o[0]=a=>t.show=!t.show),class:"btn btn-outline-success p-3 w-100"},[t.show?(l(),i("span",tt,[st,m(" Свернуть форму добавления")])):(l(),i("span",Ze,[et,m(" Добавить глобальный скрипт")]))])]),t.show?(l(),i("div",ot,[t.bot?(l(),$(K,{key:0,"can-add":!0,bot:t.bot,onCallback:t.loadSlugs},null,8,["bot","onCallback"])):r("",!0)])):r("",!0),e("div",lt,[e("div",it,[c(e("input",{type:"search","onUpdate:modelValue":o[1]||(o[1]=a=>t.ownSearch=a),class:"form-control",id:"floatingInput",placeholder:"name@example.com"},null,512),[[_,t.ownSearch]]),nt])]),e("div",at,[e("div",dt,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[2]||(o[2]=a=>t.need_global=a),type:"checkbox",id:"need_global"},null,512),[[k,t.need_global]]),e("label",rt,[t.need_global?(l(),i("span",ct,"Глобальные")):(l(),i("span",ut,"Локальные"))])])]),t.slugs&&t.bot?(l(!0),i(b,{key:1},f(t.filteredSlugs,(a,d)=>(l(),i("div",mt,[v(R,{item:a,bot:t.bot,onCallback:t.callbackSlugs,onSelect:t.selectSlug},null,8,["item","bot","onCallback","onSelect"])]))),256)):r("",!0),t.paginate?(l(),$(S,{key:2,onPagination_page:t.nextSlugs,pagination:t.paginate},null,8,["onPagination_page","pagination"])):r("",!0),t.filteredSlugs.length===0?(l(),i("div",ht,pt)):r("",!0)])):r("",!0)}}),ft={class:"row"},vt={class:"input-group mb-3"},yt={key:0,class:"row"},$t={class:"col-12 col-md-6 mb-3"},kt={class:"card"},Ft={class:"card-body"},wt={key:0,class:"badge rounded-pill text-bg-success"},Ct={class:"card-footer"},Pt=["onClick"],St=["onClick"],jt={class:"col-12"},Vt={key:1,class:"row"},Ut=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет пользователей ")],-1),Bt=[Ut],Ot={data(){return{bot:null,loading:!0,bot_users:[],search:null,bot_users_paginate_object:null}},computed:{...C(["getBotUsers","getBotUsersPaginateObject","getCurrentBot"])},mounted(){this.loadCurrentBot().then(()=>{this.loadUsers()})},methods:{loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},changeUserStatus(s,t){this.$store.dispatch("changeUserStatus",{dataObject:{botUserId:s,status:t}}).then(()=>{this.$notify({title:"Конструктор ботов",text:"Статус пользователя успешно изменен! Пользователь оповещен об изменении статуса!",type:"success"}),this.loadUsers()}).catch(()=>{this.$notify({title:"Конструктор ботов",text:"Ошибка изменения статуса",type:"error"})})},nextUsers(s){this.loadUsers(s)},loadUsers(s=0){this.loading=!0,this.$store.dispatch("loadBotUsers",{dataObject:{botId:this.bot.id||null,search:this.search},page:s}).then(t=>{this.loading=!1,this.bot_users=this.getBotUsers,this.bot_users_paginate_object=this.getBotUsersPaginateObject}).catch(()=>{this.loading=!1})}}},It=Object.assign(Ot,{__name:"BotUserList",setup(s){return(t,o)=>(l(),i(b,null,[e("div",ft,[e("div",vt,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск пользователя","aria-label":"Поиск пользователя","onUpdate:modelValue":o[0]||(o[0]=a=>t.search=a)},null,512),[[_,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=a=>t.loadUsers(0)),type:"button",id:"button-addon2"},"Найти ")])]),t.bot_users.length>0?(l(),i("div",yt,[(l(!0),i(b,null,f(t.bot_users,(a,d)=>(l(),i("div",$t,[e("div",kt,[e("div",Ft,[e("p",null,[m("Ф.И.О. из телеграма: "+h(a.fio_from_telegram||"Не указано")+" ",1),a.is_admin?(l(),i("span",wt,"Администратор")):r("",!0)]),e("p",null,"Имя пользователя: "+h(a.name||"Не указано"),1),e("p",null,"Телефон: "+h(a.phone||"Не указано"),1),e("p",null,"Почта: "+h(a.email||"Не указано"),1),e("p",null,"id чата: "+h(a.telegram_chat_id||"Не указано"),1)]),e("div",Ct,[a.is_admin?(l(),i("button",{key:1,type:"button",onClick:n=>t.changeUserStatus(a.id,0),class:"btn btn-outline-success"}," Разжаловать из администраторов ",8,St)):(l(),i("button",{key:0,type:"button",onClick:n=>t.changeUserStatus(a.id,1),class:"btn btn-outline-success"}," Назначить администратором ",8,Pt))])])]))),256)),e("div",jt,[t.bot_users_paginate_object?(l(),$(S,{key:0,onPagination_page:t.nextUsers,pagination:t.bot_users_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",Vt,Bt))],64))}});const Tt={props:["param"],data(){return{search:null,descriptions:[]}},computed:{filteredDescription(){return this.search?this.descriptions.filter(s=>s.text.indexOf(this.search)!==-1):this.descriptions}},mounted(){this.loadDescription()},methods:{select(s){this.$emit("callback",{param:this.param,text:s})},loadDescription(){this.$store.dispatch("loadDescription").then(s=>{this.descriptions=s.data})}}},Lt={class:"dropdown"},Dt=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-spell-check"})],-1),qt={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},Rt=e("div",{class:"dropdown-divider"},null,-1),Mt=["onClick"];function Gt(s,t,o,a,d,n){return l(),i("div",Lt,[Dt,e("div",qt,[c(e("input",{type:"search",class:"form-control",id:"search-description-text","onUpdate:modelValue":t[0]||(t[0]=p=>d.search=p),placeholder:"Введите текст для поиска"},null,512),[[_,d.search]]),Rt,(l(!0),i(b,null,f(n.filteredDescription,(p,u)=>(l(),i("p",{class:"p-1 text-left w-100",onClick:y=>n.select(p.text)},h(p.text),9,Mt))),256))])])}const I=j(Tt,[["render",Gt]]);const zt={class:"row"},Et={class:"input-group mb-3"},Kt={key:0,class:"row"},Nt={class:"col-12 mb-3"},xt={class:"list-group w-100"},At={class:"list-group-item cursor-pointer page-menu-item btn btn-outline-info mb-1"},Jt={class:"d-flex justify-content-between"},Wt=["onClick"],Yt={key:0},Ht={key:1},Qt={key:2},Xt=e("i",{class:"fa-solid fa-lock"},null,-1),Zt=[Xt],es={key:0},ts={class:"dropdown"},ss=e("button",{class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-ellipsis"})],-1),os={class:"dropdown-menu"},ls=["onClick"],is=e("i",{class:"fa-solid fa-copy mr-1"},null,-1),ns=["onClick"],as=e("i",{class:"fa-solid fa-trash mr-1"},null,-1),ds={class:"col-12"},rs={key:1,class:"row"},cs=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," Созданных страниц не найдено! ")],-1),us=[cs],ms={props:["editor","current"],data(){return{bot:null,loading:!0,pages:[],search:null,pages_paginate_object:null,need_new_page:!1}},watch:{search:function(s,t){this.loadPages()}},computed:{...C(["getPages","getCurrentBot","getPagesPaginateObject"])},mounted(){this.loadCurrentBot().then(()=>{this.loadPages()})},methods:{loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},selectPage(s){this.$emit("callback",s),this.$notify("Вы выбрали страницу из списка! Все остальные действия будут производится для этой страницы")},nextPages(s){this.loadPages(s)},duplicatePage(s){this.loading=!0,this.$store.dispatch("duplicatePage",{dataObject:{pageId:s}}).then(t=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},removePage(s){this.loading=!0,this.$store.dispatch("removePage",{dataObject:{pageId:s}}).then(t=>{this.loading=!1,this.loadPages()}).catch(()=>{this.loading=!1})},loadPages(s=0){this.loading=!0,this.$store.dispatch("loadPages",{dataObject:{botId:this.bot.id||null,search:this.search},page:s}).then(t=>{this.loading=!1,this.pages=this.getPages,this.pages_paginate_object=this.getPagesPaginateObject}).catch(()=>{this.loading=!1})}}},D=Object.assign(ms,{__name:"PagesList",setup(s){return(t,o)=>(l(),i(b,null,[e("div",zt,[e("div",Et,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск страницы","aria-label":"Поиск бота","onUpdate:modelValue":o[0]||(o[0]=a=>t.search=a),"aria-describedby":"button-addon2"},null,512),[[_,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=(...a)=>t.loadPages&&t.loadPages(...a)),type:"button",id:"button-addon2"},"Найти")])]),t.pages.length>0?(l(),i("div",Kt,[e("div",Nt,[e("ul",xt,[(l(!0),i(b,null,f(t.pages,(a,d)=>(l(),i("li",At,[e("div",Jt,[e("strong",{onClick:n=>t.selectPage(a)},[m("#"+h(a.id||"Не указано")+" ",1),a.slug?(l(),i("span",Yt,h(a.slug.command||"Не указано"),1)):(l(),i("span",Ht,"Не привязано к команде")),s.current&&s.current===a.id?(l(),i("span",Qt,Zt)):r("",!0)],8,Wt),s.editor?(l(),i("div",es,[e("div",ts,[ss,e("ul",os,[e("li",null,[e("a",{class:"dropdown-item",onClick:n=>t.duplicatePage(a.id)},[is,m("Дублировать")],8,ls)]),e("li",null,[e("a",{class:"dropdown-item",onClick:n=>t.removePage(a.id)},[as,m("Удалить")],8,ns)])])])])):r("",!0)])]))),256))])]),e("div",ds,[t.pages_paginate_object?(l(),$(S,{key:0,onPagination_page:t.nextPages,pagination:t.pages_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",rs,us))],64))}}),hs={class:"row"},_s={class:"col-12"},ps={class:"card-body"},bs=e("h6",null,"Добавление нового скрипта в бота",-1),gs={key:0,class:"row"},fs={class:"col-md-6 mb-2"},vs={key:1,class:"row"},ys=e("div",{class:"col-12"},[e("div",{class:"alert alert-danger",role:"alert"},' У Вас еще нет добавленных скриптов! Воспользуйтесь разделом "Скрипты" для добавления. ')],-1),$s=[ys],ks={props:["bot","global"],data(){return{load:!1,search:null,slugs:[],paginate:[]}},computed:{...C(["getSlugs","getSlugsPaginateObject"]),filteredSlugs(){return this.slugs?this.slugs.length===0?[]:this.search==null?this.slugs:this.slugs.filter(s=>{let t=s.slug||"",o=s.command||"",a=s.comment||"";return o.toLowerCase().indexOf(this.search.toLowerCase())!==-1||a.toLowerCase().indexOf(this.search.toLowerCase())!==-1||t.toLowerCase().indexOf(this.search.toLowerCase())!==-1}):[]}},mounted(){this.loadSlugs()},methods:{nextSlugs(s){this.loadSlugs(s)},selectSlug(s){this.$emit("callback",{id:s.id||null,slug:s.slug,comment:s.comment,command:s.command}),this.$notify("Вы выбрали скрипт из списка!")},loadSlugs(s=0){this.$store.dispatch("loadSlugs",{dataObject:{botId:this.bot.id,needGlobal:this.global},page:s}).then(t=>{this.slugs=this.getSlugs,this.paginate=this.getSlugsPaginateObject})},callbackSlugs(){}}},Fs=Object.assign(ks,{__name:"BotSlugListSimple",setup(s){return(t,o)=>(l(),i("div",hs,[e("div",_s,[e("div",ps,[bs,e("div",null,[c(e("input",{type:"text",class:"form-control mt-1 mb-1","onUpdate:modelValue":o[0]||(o[0]=a=>t.search=a),placeholder:"Поиск нужного скрипта по описанию"},null,512),[[_,t.search]])]),t.filteredSlugs.length>0?(l(),i("div",gs,[(l(!0),i(b,null,f(t.filteredSlugs,(a,d)=>(l(),i("div",fs,[v(R,{item:a,bot:s.bot,onCallback:t.callbackSlugs,onSelect:t.selectSlug},null,8,["item","bot","onCallback","onSelect"])]))),256)),t.paginate?(l(),$(S,{key:0,onPagination_page:t.nextSlugs,pagination:t.paginate},null,8,["onPagination_page","pagination"])):r("",!0)])):(l(),i("div",vs,$s))])])]))}});const ws={props:["param"],data(){return{expressions:[{expression:null,description:"Нет проверки"},{expression:"/([a-z0-9]+)/i",description:"Проверка набора из латинских букв и цифр"},{expression:"/([а-яё0-9]+)/iu",description:"Проверка на кириллицу и цифры"},{expression:"/(?P<digit>\\d+)/",description:"Проверка на число"},{expression:"/^([a-z0-9_-]+.)*[a-z0-9_-]+@[a-z0-9_-]+(.[a-z0-9_-]+)*.[a-z]{2,6}$/",description:"Проверка Email"},{expression:"/^((8|+7)[- ]?)?((?d{3})?[- ]?)?[d- ]{7,10}$/",description:"Проверка номера телефона: +7(982)000-00-00"},{expression:"/^(0[1-9]|[12][0-9]|3[01])[.](0[1-9]|1[012])[.](19|20)dd$/",description:"Проверка даты по формату DD.MM.YYYY"},{expression:"/^[0-9]{4}-(0[1-9]|1[012])-(0[1-9]|1[0-9]|2[0-9]|3[01])$/",description:"Проверка даты по формату YYYY-MM-DD"},{expression:"/^(https?://)?([da-z.-]+).([a-z.]{2,6})([/w .-]*)*/?$/",description:"Проверка доменного имени"}]}},methods:{expressionsSelect(s){this.$emit("callback",{param:this.param,text:s.expression})}}},Cs={class:"dropdown"},Ps=e("button",{class:"btn btn-link dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-regular fa-registered"})],-1),Ss={class:"dropdown-menu item-with-text cursor-pointer text-muted p-2"},js=["onClick"];function Vs(s,t,o,a,d,n){return l(),i("div",Cs,[Ps,e("div",Ss,[e("li",null,[(l(!0),i(b,null,f(d.expressions,p=>(l(),i("a",{class:"dropdown-item",onClick:u=>n.expressionsSelect(p)},h(p.description||"-"),9,js))),256))])])])}const Us=j(ws,[["render",Vs]]),Bs={class:"form-floating mb-2"},Os=["id"],Is=["for"],Ts={class:"form-floating mb-2"},Ls=["id"],Ds=["for"],qs={class:"form-floating mb-2"},Rs=["id"],Ms=["for"],Gs={class:"mb-2"},zs={class:"d-flex justify-content-between"},Es=["for"],Ks=["id"],Ns={class:"mb-2"},xs={class:"d-flex justify-content-between"},As=["for"],Js=["id"],Ws={class:"mb-2"},Ys={class:"form-check"},Hs=e("label",{class:"form-check-label",for:"need-dialog-image"}," В диалоге нужно изображение ",-1),Qs={class:"form-check"},Xs=e("label",{class:"form-check-label",for:"need-dialog-menu"}," В диалоге нужно меню ",-1),Zs={key:0,class:"card mb-2"},eo={class:"card-body"},to=e("h6",null,"Фотографии к диалогу",-1),so={class:"photo-preview d-flex justify-content-start flex-wrap w-100"},oo={for:"location-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},lo=e("span",null,"+",-1),io={class:"mb-2 img-preview",style:{"margin-right":"10px"}},no={class:"remove"},ao=["onClick"],ro={class:"mb-2 img-preview",style:{"margin-right":"10px"}},co={class:"remove"},uo=["onClick"],mo={key:1,class:"card mb-2"},ho=e("div",{class:"card-header"},[e("h6",null,"Кнопки к вопросу")],-1),_o={class:"card-body"},po={class:"mb-2"},bo={type:"submit",class:"btn btn-outline-primary p-3 w-100"},go={key:0},fo={key:1},vo={props:["item","bot"],data(){return{need_images:!1,need_keyboard:!1,commandForm:{id:null,slug:null,pre_text:null,post_text:null,error_text:null,bot_id:null,input_pattern:null,inline_keyboard_id:null,images:null,next_bot_dialog_command_id:null,bot_dialog_group_id:null,result_channel:null,inline_keyboard:null},photos:[]}},mounted(){console.log("item dialog=>",this.item),this.item&&this.$nextTick(()=>{this.commandForm={id:this.item.id||null,slug:this.item.slug||null,pre_text:this.item.pre_text||null,post_text:this.item.post_text||null,error_text:this.item.error_text||null,input_pattern:this.item.input_pattern||null,inline_keyboard_id:this.item.inline_keyboard_id||null,images:this.item.images||[],next_bot_dialog_command_id:this.item.next_bot_dialog_command_id||null,bot_dialog_group_id:this.item.bot_dialog_group_id||null,result_channel:this.item.result_channel||null,inline_keyboard:this.item.inline_keyboard||null},this.bot&&(this.commandForm.bot_id=this.bot.id||null),this.commandForm.inline_keyboard_id!=null&&(this.need_keyboard=!0),this.commandForm.images.length>0&&(this.need_images=!0)}),this.bot&&this.$nextTick(()=>{this.commandForm.bot_id=this.bot.id})},methods:{submit(){this.loading=!0;let s=new FormData;if(Object.keys(this.commandForm).forEach(t=>{const o=this.commandForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.photos){for(let t=0;t<this.photos.length;t++)s.append("files[]",this.photos[t]);s.delete("photos")}this.$store.dispatch(this.commandForm.id?"updateDialogCommand":"createDialogCommand",{dialogCommandForm:s}).then(t=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Успешная обработка диалоговой команды",type:"success"}),this.commandForm.id==null&&(this.commandForm={id:null,slug:null,pre_text:null,post_text:null,error_text:null,input_pattern:null,inline_keyboard_id:null,images:null,next_bot_dialog_command_id:null,bot_dialog_group_id:null,result_channel:null,inline_keyboard:null},this.photos=[]),this.$emit("callback")}).catch(t=>{this.loading=!1})},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removePhoto(s,t){this[s].splice(t,1)},onChangePhotos(s){const t=s.target.files;for(let o=0;o<t.length;o++)this.photos.push(t[o])},saveInlineKeyboard(s){this.commandForm.inline_keyboard=s},addTextTo(s={param:null,text:null}){this.commandForm[s.param]=s.text}}},M=Object.assign(vo,{__name:"BotDialogCommandForm",setup(s){return(t,o)=>{const a=U("lazy");return l(),i("form",{onSubmit:o[8]||(o[8]=P((...d)=>t.submit&&t.submit(...d),["prevent"]))},[e("div",Bs,[c(e("input",{type:"text",class:"form-control",id:"commandForm-pre-text-"+t.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":o[0]||(o[0]=d=>t.commandForm.pre_text=d),required:""},null,8,Os),[[_,t.commandForm.pre_text]]),e("label",{for:"commandForm-pre-text-"+t.commandForm.id},"Текст диалога",8,Is)]),e("div",Ts,[c(e("input",{type:"text",class:"form-control",id:"commandForm-post-text-"+t.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":o[1]||(o[1]=d=>t.commandForm.post_text=d),required:""},null,8,Ls),[[_,t.commandForm.post_text]]),e("label",{for:"commandForm-post-text-"+t.commandForm.id},"Текст после успешного завершения диалога",8,Ds)]),e("div",qs,[c(e("input",{type:"text",class:"form-control",id:"commandForm-error-text-"+t.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":o[2]||(o[2]=d=>t.commandForm.error_text=d),required:""},null,8,Rs),[[_,t.commandForm.error_text]]),e("label",{for:"commandForm-error-text-"+t.commandForm.id},"Текст на случай ошибки корректности данных",8,Ms)]),e("div",Gs,[e("div",zs,[e("label",{class:"form-label",for:"commandForm-result-channel-"+t.commandForm.id},"Регулярное выражение для валидации данных ",8,Es),v(Us,{param:"input_pattern",onCallback:t.addTextTo},null,8,["onCallback"])]),c(e("input",{type:"text",class:"form-control",placeholder:"Регулярное выражение","aria-label":"Регулярное выражение","onUpdate:modelValue":o[3]||(o[3]=d=>t.commandForm.input_pattern=d),maxlength:"255",id:"commandForm-input-pattern-"+t.commandForm.id,"aria-describedby":"commandForm-input-pattern"},null,8,Ks),[[_,t.commandForm.input_pattern]])]),e("div",Ns,[e("div",xs,[e("label",{class:"form-label",for:"commandForm-result-channel-"+t.commandForm.id},"Канал для отправки данных ",8,As),s.bot?(l(),$(B,{key:0,token:s.bot.bot_token,param:"result_channel",onCallback:t.addTextTo},null,8,["token","onCallback"])):r("",!0)]),c(e("input",{type:"number",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":o[4]||(o[4]=d=>t.commandForm.result_channel=d),id:"commandForm-result-channel-"+t.commandForm.id,"aria-describedby":"bot-order-channel"},null,8,Js),[[_,t.commandForm.result_channel]])]),e("div",Ws,[e("div",Ys,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[5]||(o[5]=d=>t.need_images=d),id:"need-dialog-image",checked:""},null,512),[[k,t.need_images]]),Hs]),e("div",Qs,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[6]||(o[6]=d=>t.need_keyboard=d),id:"need-dialog-menu",checked:""},null,512),[[k,t.need_keyboard]]),Xs])]),t.need_images?(l(),i("div",Zs,[e("div",eo,[to,e("div",so,[e("label",oo,[lo,e("input",{type:"file",id:"location-photos",multiple:"",accept:"image/*",onChange:o[7]||(o[7]=(...d)=>t.onChangePhotos&&t.onChangePhotos(...d)),style:{display:"none"}},null,32)]),t.photos.length>0?(l(!0),i(b,{key:0},f(t.photos,(d,n)=>(l(),i("div",io,[c(e("img",null,null,512),[[a,t.getPhoto(d).imageUrl]]),e("div",no,[e("a",{onClick:p=>t.removePhoto("photos",n)},"Удалить",8,ao)])]))),256)):r("",!0),t.commandForm.images&&s.bot?(l(!0),i(b,{key:1},f(t.commandForm.images,(d,n)=>(l(),i("div",ro,[c(e("img",null,null,512),[[a,"/images-by-bot-id/"+s.bot.id+"/"+d]]),e("div",co,[e("a",{onClick:p=>t.removePhoto("images",n)},"Удалить",8,uo)])]))),256)):r("",!0)])])])):r("",!0),t.need_keyboard?(l(),i("div",mo,[ho,e("div",_o,[v(T,{onSave:t.saveInlineKeyboard,"edited-keyboard":t.commandForm.inline_keyboard},null,8,["onSave","edited-keyboard"])])])):r("",!0),e("div",po,[e("button",bo,[t.commandForm.id?(l(),i("span",go,"Обновить диалог")):(l(),i("span",fo,"Добавить диалог"))])])],32)}}});const yo={class:"p-2 dialog-command-card"},$o={class:"badge bg-success"},ko=e("span",{class:"ml-1 mr-1"},[e("i",{class:"fa-solid fa-arrow-right"})],-1),Fo={key:0,class:"badge bg-primary"},wo={key:1},Co=e("h6",null,"Текст диалога:",-1),Po={key:0,class:"w-100 d-flex justify-between"},So={class:"dropdown"},jo=["disabled"],Vo=e("i",{class:"fa-solid fa-ellipsis"},null,-1),Uo=[Vo],Bo={class:"dropdown-menu"},Oo=e("i",{class:"fa-solid fa-arrow-left mr-1"},null,-1),Io=e("hr",null,null,-1),To=["data-bs-target"],Lo=e("i",{class:"fa-solid fa-sliders mr-1"},null,-1),Do=e("i",{class:"fa-solid fa-arrows-turn-to-dots mr-1"},null,-1),qo=e("i",{class:"fa-solid fa-arrows-up-down mr-1"},null,-1),Ro=e("i",{class:"fa-solid fa-clone mr-1"},null,-1),Mo=e("i",{class:"fa-solid fa-link-slash mr-1"},null,-1),Go=e("i",{class:"fa-solid fa-trash-can mr-1"},null,-1),zo=["id"],Eo={class:"modal-dialog"},Ko={class:"modal-content"},No={class:"modal-header"},xo={class:"modal-title fs-5",id:"staticBackdropLabel"},Ao={class:"badge bg-success"},Jo=e("span",{class:"ml-1 mr-1"},[e("i",{class:"fa-solid fa-arrow-right"})],-1),Wo={key:0,class:"badge bg-primary"},Yo={key:1},Ho=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Qo={class:"modal-body"},Xo=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),Zo={props:["item","simple","bot"],data(){return{loading:!1}},methods:{unlinkCommand(){this.loading=!0,this.$store.dispatch("unlinkDialogCommand",{dataObject:{dialogCommandId:this.item.id}}).then(s=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Диалоговая команда успешно продублирована!",type:"success"}),this.$emit("callback")}).catch(s=>{this.loading=!1})},removeCommand(){this.loading=!0,this.$store.dispatch("removeDialogCommand",{dataObject:{dialogCommandId:this.item.id}}).then(s=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Диалоговая команда успешно удалена!",type:"success"}),this.$emit("callback")}).catch(s=>{this.loading=!1})},selectDialog(){this.$emit("select",this.item)},duplicate(){this.loading=!0,this.$store.dispatch("duplicateDialogCommand",{dataObject:{dialogCommandId:this.item.id}}).then(s=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Диалоговая команда успешно продублирована!",type:"success"}),this.$emit("callback")}).catch(s=>{this.loading=!1})},changeGroup(){this.$emit("swap",{command_id:this.item.id,group_id:this.item.bot_dialog_group_id})},linkEvent(){this.$emit("link",{id:this.item.id,group_id:this.item.bot_dialog_group_id,current_next_id:this.item.next_bot_dialog_command_id})}}},G=Object.assign(Zo,{__name:"DialogCommandCard",setup(s){return(t,o)=>(l(),i(b,null,[e("div",yo,[e("p",null,[e("span",$o,"#"+h(s.item.id),1),ko,s.item.next_bot_dialog_command_id?(l(),i("span",Fo,"#"+h(s.item.next_bot_dialog_command_id||"-"),1)):(l(),i("span",wo,"не связан"))]),Co,e("p",null,h(s.item.pre_text||"-"),1),s.simple?r("",!0):(l(),i("div",Po,[e("div",So,[e("button",{disabled:t.loading,class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Uo,8,jo),e("ul",Bo,[e("li",null,[e("a",{onClick:o[0]||(o[0]=(...a)=>t.selectDialog&&t.selectDialog(...a)),title:"Выбрать диалог",class:"dropdown-item cursor-pointer"},[Oo,m(" Выбрать диалог ")])]),Io,e("li",null,[e("a",{"data-bs-toggle":"modal","data-bs-target":"#dialog-command-modal-"+s.item.id,title:"Редактирование параметров карточки",class:"dropdown-item cursor-pointer"},[Lo,m(" Настройка диалога ")],8,To)]),e("li",null,[e("a",{onClick:o[1]||(o[1]=(...a)=>t.linkEvent&&t.linkEvent(...a)),title:"Диалог связывания с другой командой",class:"dropdown-item cursor-pointer"},[Do,m(" Редактирование связей ")])]),e("li",null,[e("a",{onClick:o[2]||(o[2]=(...a)=>t.changeGroup&&t.changeGroup(...a)),title:"Диалог смены группы команды",class:"dropdown-item cursor-pointer"},[qo,m(" Смена диалоговой группы ")])]),e("li",null,[e("a",{title:"Дублирование команды",onClick:o[3]||(o[3]=(...a)=>t.duplicate&&t.duplicate(...a)),class:"dropdown-item cursor-pointer"},[Ro,m(" Дублирование диалога ")])]),e("li",null,[e("a",{onClick:o[4]||(o[4]=(...a)=>t.unlinkCommand&&t.unlinkCommand(...a)),title:"Убирает связь команды с другой командой по цепочке",class:"dropdown-item cursor-pointer"},[Mo,m(" Удаление связей диалога ")])]),e("li",null,[e("a",{onClick:o[5]||(o[5]=(...a)=>t.removeCommand&&t.removeCommand(...a)),title:"Удаление команды",class:"dropdown-item cursor-pointer"},[Go,m(" Удаление диалога ")])])])])]))]),e("div",{class:"modal fade",id:"dialog-command-modal-"+s.item.id,"data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true"},[e("div",Eo,[e("div",Ko,[e("div",No,[e("h1",xo,[e("span",Ao,"#"+h(s.item.id),1),Jo,s.item.next_bot_dialog_command_id?(l(),i("span",Wo,"#"+h(s.item.next_bot_dialog_command_id||"-"),1)):(l(),i("span",Yo,"не связан"))]),Ho]),e("div",Qo,[v(M,{bot:s.bot,item:s.item},null,8,["bot","item"])]),Xo])])],8,zo)],64))}});const el={key:0,class:"row"},tl={class:"col-12 mb-3"},sl={class:"card mb-2"},ol={class:"card-header"},ll={class:"card-body"},il={key:0,class:"row"},nl={class:"col-md-6 col-lg-4 col-12 col-sm-6 mb-2"},al={key:1,class:"row"},dl=e("div",{class:"col-12"},[e("p",null,"Диалоговых скриптов не найдено")],-1),rl=[dl],cl={class:"col-12"},ul={key:1,class:"row"},ml=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет созданных диалоговых групп ")],-1),hl=[ml],_l={props:["bot"],data(){return{groupForm:{slug:null,title:null},loading:!0,dialog_groups:[],search:null,dialog_groups_paginate_object:null,link:null,selected_dialog_id:null,group:null}},computed:{...C(["getDialogGroups","getDialogGroupsPaginateObject"])},mounted(){this.loadGroups()},methods:{selectDialog(s){this.$emit("select-dialog",s),this.selected_dialog_id=s.id,this.$notify("Вы выбрали диалог из списка!")},nextGroups(s){this.loadGroups(s)},loadGroups(s=0){this.loading=!0,this.$store.dispatch("loadDialogGroups",{dataObject:{botId:this.bot.id||null,search:this.search},page:s}).then(t=>{this.loading=!1,this.dialog_groups=this.getDialogGroups,this.dialog_groups_paginate_object=this.getDialogGroupsPaginateObject}).catch(()=>{this.loading=!1})}}},pl=Object.assign(_l,{__name:"BotDialogGroupListSimple",setup(s){return(t,o)=>t.dialog_groups.length>0?(l(),i("div",el,[e("div",tl,[(l(!0),i(b,null,f(t.dialog_groups,(a,d)=>(l(),i("div",sl,[e("div",ol,[e("h6",null," #"+h(a.id)+" - "+h(a.title||"Не указано ")+" ("+h(a.slug||"Не указано")+")",1)]),e("div",ll,[a.bot_dialog_commands.length>0?(l(),i("div",il,[(l(!0),i(b,null,f(a.bot_dialog_commands,(n,p)=>(l(),i("div",nl,[v(G,{onSelect:t.selectDialog,item:n},null,8,["onSelect","item"])]))),256))])):(l(),i("div",al,rl))])]))),256))]),e("div",cl,[t.dialog_groups_paginate_object?(l(),$(S,{key:0,onPagination_page:t.nextGroups,pagination:t.dialog_groups_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",ul,hl))}}),bl={class:"row"},gl={class:"input-group mb-3"},fl={key:0,class:"row"},vl={class:"col-12 col-md-12 mb-3"},yl={class:"list-group"},$l=["onClick"],kl={class:"ms-2 me-auto"},Fl={class:"fw-bold"},wl={class:"badge bg-info rounded-pill"},Cl={class:"w-100"},Pl={class:"d-flex justify-content-between"},Sl=["onClick"],jl=["onClick"],Vl={class:"badge bg-primary rounded-pill"},Ul={class:"col-12"},Bl={key:1,class:"row"},Ol=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет медиа-файлов ")],-1),Il=[Ol],Tl={props:["selected","needVideo","needVideoNote","needPhoto"],data(){return{bot:null,loading:!0,media:[],search:null,media_paginate_object:null}},computed:{...C(["getMedia","getMediaPaginateObject","getCurrentBot"])},mounted(){this.loadCurrentBot().then(()=>{this.loadMedia()})},methods:{selectMedia(s){this.$emit("select",s)},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},nextMedia(s){this.loadMedia(s)},remove(s){this.$store.dispatch("removeMedia",{dataObject:{mediaId:s}}).then(t=>{this.loadMedia(),this.$notify({title:"Удаление медиа-контента",text:"Медиа контент удален"})}).catch(()=>{})},showPreview(s){this.$store.dispatch("showMediaPreview",{dataObject:{mediaId:s}}).then(t=>{this.$notify({title:"Превью медиа-контента",text:"Отправлено в бота"})}).catch(()=>{})},loadMedia(s=0){this.loading=!0,this.$store.dispatch("loadMedia",{dataObject:{botId:this.bot.id||null,search:this.search,needVideo:this.needVideo||!1,needVideoNote:this.needVideoNote||!1,needPhoto:this.needPhoto||!1},page:s}).then(t=>{this.loading=!1,this.media=this.getMedia,this.media_paginate_object=this.getMediaPaginateObject}).catch(()=>{this.loading=!1})}}},Ll=Object.assign(Tl,{__name:"BotMediaList",setup(s){return(t,o)=>(l(),i(b,null,[e("div",bl,[e("div",gl,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск файла","aria-label":"Поиск файла","onUpdate:modelValue":o[0]||(o[0]=a=>t.search=a)},null,512),[[_,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=a=>t.loadMedia(0)),type:"button",id:"button-addon2"},"Найти ")])]),t.media.length>0?(l(),i("div",fl,[e("div",vl,[e("ul",yl,[(l(!0),i(b,null,f(t.media,(a,d)=>(l(),i("li",{onClick:n=>t.selectMedia(a),class:w([{"border-info":s.selected===a.file_id},"list-group-item d-flex justify-content-between align-items-start"])},[e("div",kl,[e("div",Fl,[m(h(a.caption??"Без подписи")+" ",1),e("span",wl,h(a.type),1)]),e("small",Cl,h(a.file_id),1),e("div",Pl,[e("a",{href:"javascript:void(0)",class:"btn btn-link p-0 my-2",onClick:n=>t.showPreview(a.id)},"Показать превью",8,Sl),e("a",{href:"javascript:void(0)",class:"btn btn-link p-0 my-2 text-danger",onClick:n=>t.remove(a.id)},"Удалить",8,jl)])]),e("span",Vl,"#"+h(a.id),1)],10,$l))),256))])]),e("div",Ul,[t.media_paginate_object?(l(),$(S,{key:0,onPagination_page:t.nextMedia,pagination:t.media_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",Bl,Il))],64))}}),Dl=e("div",{class:"alert alert-success",role:"alert"},' Проверка правил идет по методу "И" - все правила должны выполняться для перехода на данную страницу, иначе будет вызвана страница из блока "иначе". Действия для "иначе" добавлять не обязательно. ',-1),ql=e("h6",null,"Блок условий",-1),Rl={key:0,class:"py-2"},Ml={class:"form-label",id:"bot-domain"},Gl=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),zl=e("div",null,"Напишите текст, который будет отображен пользователю вместе с основным контентом в случае если условие будет выполнено ",-1),El={class:"dropdown mb-2"},Kl=e("button",{class:"btn btn-outline-info dropdown-toggle w-100",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"}," Добавить условие ",-1),Nl={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},xl=["onClick"],Al={key:1},Jl={key:2,class:"list-group"},Wl={key:0,class:"list-group-item d-flex justify-content-between align-items-center"},Yl={class:"form-check"},Hl={class:"form-check-label",for:"bot-user-is-vip"},Ql={key:0},Xl={key:1},Zl=e("i",{class:"fa-solid fa-trash-can"},null,-1),ei=[Zl],ti={key:1,class:"list-group-item d-flex justify-content-between align-items-center"},si={class:"form-check"},oi={class:"form-check-label",for:"bot-user-is-admin"},li={key:0},ii={key:1},ni=e("i",{class:"fa-solid fa-trash-can"},null,-1),ai=[ni],di={key:2,class:"list-group-item d-flex justify-content-between align-items-center"},ri={class:"form-check"},ci={class:"form-check-label",for:"bot-user-is-deliveryman"},ui={key:0},mi={key:1},hi=e("i",{class:"fa-solid fa-trash-can"},null,-1),_i=[hi],pi={key:3,class:"list-group-item d-flex justify-content-between align-items-center"},bi={class:"form-check"},gi={class:"form-check-label",for:"bot-user-is-work"},fi={key:0},vi={key:1},yi=e("i",{class:"fa-solid fa-trash-can"},null,-1),$i=[yi],ki={key:4,class:"list-group-item d-flex justify-content-between align-items-center"},Fi={class:"form-check"},wi={class:"form-check-label",for:"bot-user-in-location"},Ci={key:0},Pi={key:1},Si=e("i",{class:"fa-solid fa-trash-can"},null,-1),ji=[Si],Vi={key:5,class:"list-group-item d-flex justify-content-between align-items-center"},Ui=e("label",{class:"form-label",id:"bot-domain"}," Возраст от ",-1),Bi=e("i",{class:"fa-solid fa-trash-can"},null,-1),Oi=[Bi],Ii={key:6,class:"list-group-item d-flex justify-content-between align-items-center"},Ti=e("label",{class:"form-label",id:"bot-domain"}," Только для города ",-1),Li=e("i",{class:"fa-solid fa-trash-can"},null,-1),Di=[Li],qi={key:7,class:"list-group-item d-flex justify-content-between align-items-center"},Ri={class:"form-check"},Mi={class:"form-check-label",for:"bot-user-sex"},Gi={key:0},zi={key:1},Ei=e("i",{class:"fa-solid fa-trash-can"},null,-1),Ki=[Ei],Ni={key:8,class:"list-group-item"},xi={class:"mb-3"},Ai={class:"d-flex justify-content-between align-items-center"},Ji={class:"form-label d-flex w-100 align-items-center",id:"bot-order-channel"},Wi=["onClick"],Yi=e("i",{class:"fa-solid fa-trash-can"},null,-1),Hi=[Yi],Qi=["onUpdate:modelValue"],Xi={key:3,class:"mt-5"},Zi={key:4,class:"d-flex justify-content-between"},en={key:6,class:"py-2"},tn={class:"form-label",id:"bot-domain"},sn=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),on=e("div",null,'Напишите текст, который будет отображен пользователю вместе с основным контентом в случае если условие не будет выполнено и будет вызван блок "иначе" ',-1),ln={props:["bot","rulesForm"],data(){return{rules:[{id:1,title:"Является администратором",rules_block:"bot_user",rule:{is_admin:!0}},{id:2,title:"Является VIP-пользователем",rules_block:"bot_user",rule:{is_vip:!0}},{id:3,title:"Находится в заведении",rules_block:"bot_user",rule:{user_in_location:!0}},{id:4,title:"За работой",rules_block:"bot_user",rule:{is_work:!0}},{id:5,title:"Возраст от ...",rules_block:"bot_user",rule:{age:18}},{id:6,title:"Находится в городе ...",rules_block:"bot_user",rule:{city:"Краснодар"}},{id:7,title:"Пол",rules_block:"bot_user",rule:{sex:!0}},{id:8,title:"Состоит в канале",rules_block:"channels",rule:{channel:1}},{id:9,title:"Является Менеджером",rules_block:"bot_user",rule:{is_manager:!0}}]}},methods:{hasRuleKey(s){return this.rulesForm.rules_if==null?!1:Object.keys(this.rulesForm.rules_if.bot_user).find(t=>t===s)!=null},modifyChannel(s){this.rulesForm.rules_if.channels[s.param]=s.text},removeChannelFromRule(s){this.rulesForm.rules_if.channels.splice(s,1)},removeRule(s){delete this.rulesForm.rules_if.bot_user[s]},addRules(s){this.rulesForm.rules_if||(this.rulesForm.rules_if={bot_user:{},channels:[]}),s.rules_block==="bot_user"&&(this.rulesForm.rules_if.bot_user={...this.rulesForm.rules_if.bot_user,...s.rule}),s.rules_block==="channels"&&this.rulesForm.rules_if.channels.push(s.rule.channel)},attachPageToRule(s){s.id!=this.rulesForm.id?this.rulesForm.rules_else_page_id=s.id:this.$notify({title:"Конструктор страниц",text:"Вы не можете связать данную страницу с собой",type:"error"})}}},nn=Object.assign(ln,{__name:"PageRules",setup(s){return(t,o)=>{const a=O("Popper");return l(),i(b,null,[Dl,ql,s.rulesForm.rules_if?(l(),i("div",Rl,[e("label",Ml,[v(a,null,{content:g(()=>[zl]),default:g(()=>[Gl]),_:1}),m(" Сообщение при успешном прохождении условий (не обязательно) ")]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст сообщения","aria-label":"Текст сообщения","onUpdate:modelValue":o[0]||(o[0]=d=>s.rulesForm.rules_if_message=d),maxlength:"255","aria-describedby":"rules-else-message"},`
            `,512),[[_,s.rulesForm.rules_if_message]])])):r("",!0),e("div",El,[Kl,e("ul",Nl,[(l(!0),i(b,null,f(t.rules,d=>(l(),i("li",null,[e("a",{onClick:n=>t.addRules(d),class:"dropdown-item",href:"javascript:void(0)"},h(d.title||"Не указан"),9,xl)]))),256))])]),s.rulesForm.rules_if?(l(),i("h6",Al,"Выбранные условия")):r("",!0),s.rulesForm.rules_if?(l(),i("ul",Jl,[t.hasRuleKey("is_vip")?(l(),i("li",Wl,[e("div",Yl,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[1]||(o[1]=d=>s.rulesForm.rules_if.bot_user.is_vip=d),type:"checkbox",id:"bot-user-is-vip"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_vip]]),e("label",Hl,[s.rulesForm.rules_if.bot_user.is_vip?(l(),i("span",Ql,"Является VIP-пользователем")):(l(),i("span",Xl,"Не является VIP-пользователем"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[2]||(o[2]=d=>t.removeRule("is_vip"))},ei)])):r("",!0),t.hasRuleKey("is_admin")?(l(),i("li",ti,[e("div",si,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[3]||(o[3]=d=>s.rulesForm.rules_if.bot_user.is_admin=d),type:"checkbox",id:"bot-user-is-admin"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_admin]]),e("label",oi,[s.rulesForm.rules_if.bot_user.is_admin?(l(),i("span",li,"Является администратором")):(l(),i("span",ii,"Не является администратором"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[4]||(o[4]=d=>t.removeRule("is_admin"))},ai)])):r("",!0),t.hasRuleKey("is_deliveryman")?(l(),i("li",di,[e("div",ri,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[5]||(o[5]=d=>s.rulesForm.rules_if.bot_user.is_deliveryman=d),type:"checkbox",id:"bot-user-is-deliveryman"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_deliveryman]]),e("label",ci,[s.rulesForm.rules_if.bot_user.is_deliveryman?(l(),i("span",ui,"Является доставщиком")):(l(),i("span",mi,"Не является доставщиком"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[6]||(o[6]=d=>t.removeRule("is_deliveryman"))},_i)])):r("",!0),t.hasRuleKey("is_work")?(l(),i("li",pi,[e("div",bi,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[7]||(o[7]=d=>s.rulesForm.rules_if.bot_user.is_work=d),type:"checkbox",id:"bot-user-is-work"},null,512),[[k,s.rulesForm.rules_if.bot_user.is_work]]),e("label",gi,[s.rulesForm.rules_if.bot_user.is_work?(l(),i("span",fi,"За работой")):(l(),i("span",vi,"Не работает"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[8]||(o[8]=d=>t.removeRule("is_work"))},$i)])):r("",!0),t.hasRuleKey("user_in_location")?(l(),i("li",ki,[e("div",Fi,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[9]||(o[9]=d=>s.rulesForm.rules_if.bot_user.user_in_location=d),type:"checkbox",id:"bot-user-in-location"},null,512),[[k,s.rulesForm.rules_if.bot_user.user_in_location]]),e("label",wi,[s.rulesForm.rules_if.bot_user.user_in_location?(l(),i("span",Ci,"Находится в заведении")):(l(),i("span",Pi,"Не находится в заведении"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[10]||(o[10]=d=>t.removeRule("user_in_location"))},ji)])):r("",!0),t.hasRuleKey("age")?(l(),i("li",Vi,[e("div",null,[Ui,c(e("input",{type:"text",class:"form-control",placeholder:"Возраст от","aria-label":"Возраст от","onUpdate:modelValue":o[11]||(o[11]=d=>s.rulesForm.rules_if.bot_user.age=d),maxlength:"255","aria-describedby":"bot-user-age"},null,512),[[_,s.rulesForm.rules_if.bot_user.age]])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[12]||(o[12]=d=>t.removeRule("age"))},Oi)])):r("",!0),t.hasRuleKey("city")?(l(),i("li",Ii,[e("div",null,[Ti,c(e("input",{type:"text",class:"form-control",placeholder:"Город","aria-label":"Город","onUpdate:modelValue":o[13]||(o[13]=d=>s.rulesForm.rules_if.bot_user.city=d),maxlength:"255","aria-describedby":"bot-user-city"},null,512),[[_,s.rulesForm.rules_if.bot_user.city]])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[14]||(o[14]=d=>t.removeRule("city"))},Di)])):r("",!0),t.hasRuleKey("sex")?(l(),i("li",qi,[e("div",Ri,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[15]||(o[15]=d=>s.rulesForm.rules_if.bot_user.sex=d),type:"checkbox",id:"bot-user-sex"},null,512),[[k,s.rulesForm.rules_if.bot_user.sex]]),e("label",Mi,[s.rulesForm.rules_if.bot_user.sex?(l(),i("span",Gi,"Только для мужчин")):(l(),i("span",zi,"Только для женщин"))])]),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[16]||(o[16]=d=>t.removeRule("sex"))},Ki)])):r("",!0),s.rulesForm.rules_if.channels.length>0?(l(),i("li",Ni,[m("Проверка нахождения в канале \\ группе: "),(l(!0),i(b,null,f(s.rulesForm.rules_if.channels,(d,n)=>(l(),i("div",xi,[e("div",Ai,[e("label",Ji,[v(B,{token:s.bot.bot_token,param:`${n}`,onCallback:t.modifyChannel},null,8,["token","param","onCallback"]),m(" Канал для проверки ")]),e("button",{type:"button",class:"btn btn-link text-danger",onClick:p=>t.removeChannelFromRule(n)},Hi,8,Wi)]),c(e("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":p=>s.rulesForm.rules_if.channels[n]=p,maxlength:"255","aria-describedby":"bot-order-channel"},null,8,Qi),[[_,s.rulesForm.rules_if.channels[n]]])]))),256))])):r("",!0)])):r("",!0),s.rulesForm.rules_if?(l(),i("h6",Xi,"Иначе")):r("",!0),s.rulesForm.rules_else_page_id?(l(),i("p",Zi,[m("Вы выбрали страницу #"+h(s.rulesForm.rules_else_page_id)+' в качестве условия "иначе" ',1),e("a",{href:"javascript:void(0)",onClick:o[17]||(o[17]=d=>s.rulesForm.rules_else_page_id=null)},"Очистить")])):r("",!0),s.rulesForm.rules_if?(l(),$(D,{key:5,current:s.rulesForm.id,onCallback:t.attachPageToRule,editor:!1},null,8,["current","onCallback"])):r("",!0),s.rulesForm.rules_if?(l(),i("div",en,[e("label",tn,[v(a,null,{content:g(()=>[on]),default:g(()=>[sn]),_:1}),m(" Сообщение в случае невыполнения условий (не обязательно) ")]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текст сообщения","aria-label":"Текст сообщения","onUpdate:modelValue":o[18]||(o[18]=d=>s.rulesForm.rules_else_message=d),maxlength:"255","aria-describedby":"rules-else-message"},`
            `,512),[[_,s.rulesForm.rules_else_message]])])):r("",!0)],64)}}}),an={class:"row"},dn={class:"col-12 mb-2"},rn={class:"d-flex justify-between"},cn={key:0,class:"col-12 mb-2"},un={class:"form-check"},mn=e("label",{class:"form-check-label",for:"need-show-qr-and-link"}," Показать ссылку на страницу и QR-код ",-1),hn={key:1,class:"col-12 mb-2"},_n={class:"d-flex justify-content-center"},pn={style:{width:"200px",height:"200px"}},bn={class:"col-12 mb-2"},gn={class:"form-label",id:"bot-domain"},fn=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),vn=e("div",null,[m(" Команда должна начинаться с символва . и *"),e("br"),m(" Например: .*Меню"),e("br")],-1),yn=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),$n={class:"col-12 mb-2"},kn={class:"form-check"},Fn=e("label",{class:"form-check-label",for:"is-external"}," Внешнее управление страницей ",-1),wn={class:"col-12 mb-2"},Cn={class:"form-label",id:"bot-domain"},Pn=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Sn=e("div",null,"Напишите для себя пояснение для чего нужна данная страница. Это поможет другим менеджерам лучше понять Вас. ",-1),jn=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Vn={key:0,class:"row"},Un={class:"col-12 mb-2"},Bn={class:"form-label d-flex justify-content-between align-items-center mb-0",id:"bot-domain"},On=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),In=e("div",null,[m(" Текстовый редактор. Данный текст будет в таком"),e("br"),m(" же виде отображен в посте в телеграм. ")],-1),Tn=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Ln={class:"form-floating"},Dn={for:"floatingTextarea2"},qn={key:0},Rn={class:"col-12 mb-2"},Mn={class:"form-check"},Gn=e("label",{class:"form-check-label",for:"need-page-images"}," Изображения на странице (максимум 10) ",-1),zn={key:0,class:"col-12 mb-2"},En={class:"card mb-3"},Kn=e("div",{class:"card-header"},[e("h6",null,"Изображения на странице")],-1),Nn={class:"card-body d-flex justify-content-start"},xn={for:"photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},An={class:"row"},Jn={key:0,class:"col-12 d-flex flex-wrap"},Wn={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Yn={class:"remove"},Hn=["onClick"],Qn={key:1},Xn={key:2,class:"col-12 d-flex flex-wrap"},Zn={class:"mb-2 img-preview",style:{"margin-right":"10px"}},ea={class:"remove"},ta=["onClick"],sa={class:"col-12 mb-2"},oa={class:"form-check"},la=e("label",{class:"form-check-label",for:"need-page-video"}," Видео к странице ",-1),ia={key:1,class:"col-12 mb-2"},na={class:"col-12 mb-2"},aa={class:"form-check"},da=e("label",{class:"form-check-label",for:"need-reply-menu"}," Нижнее меню страницы ",-1),ra={key:2,class:"col-12 mb-2"},ca={class:"card"},ua={class:"card-header d-flex justify-between align-items-center"},ma=e("h6",null,"Конструктор нижнего меню",-1),ha={key:0},_a={key:1},pa={class:"card-body"},ba={class:"col-12 mb-2"},ga={class:"form-label",id:"bot-domain"},fa=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),va=e("div",null," Заголовок для нижнего меню ",-1),ya={class:"col-12 mb-2"},$a={class:"form-check"},ka=e("label",{class:"form-check-label",for:"need-inline-menu"}," Меню под текстом страницы ",-1),Fa={key:3,class:"col-12 mb-2"},wa={class:"card"},Ca={class:"card-header d-flex justify-between align-items-center"},Pa=e("h6",null,"Конструктор меню в сообщении",-1),Sa={key:0},ja={key:1},Va={class:"card-body"},Ua={class:"col-12 mb-2"},Ba={class:"form-check"},Oa=e("label",{class:"form-check-label",for:"need-page-attach"}," Связать с другой страницей ",-1),Ia={key:4,class:"col-12 mb-2"},Ta={key:0},La={class:"col-12 mb-2"},Da={class:"form-check"},qa=e("label",{class:"form-check-label",for:"need-slug-attach"}," Привязать скрипт ",-1),Ra={key:5,class:"col-12 mb-2"},Ma={key:0},Ga={class:"col-12 mb-2"},za={class:"form-check"},Ea=e("label",{class:"form-check-label",for:"need-dialog-attach"}," Привязать начало диалога ",-1),Ka={key:6,class:"col-12 mb-2"},Na={key:0},xa={class:"row"},Aa={class:"col-12 mb-2"},Ja={class:"form-check"},Wa=e("label",{class:"form-check-label",for:"need-rules"}," Нужны правила загрузки страницы ",-1),Ya={key:0,class:"col-12 mb-2"},Ha=e("div",{class:"row"},[e("div",{class:"col-12 mb-2"},[e("button",{class:"btn btn-outline-primary w-100 p-3"},"Сохранить страницу")])],-1),Qa={props:["page"],data(){return{need_show_qr_and_link:!1,need_clean:!1,load:!1,photos:[],showReplyTemplateSelector:!1,showInlineTemplateSelector:!1,need_page_video:!1,need_page_images:!1,need_inline_menu:!1,need_reply_menu:!1,need_attach_page:!1,need_attach_dialog:!1,need_attach_slug:!1,need_rules:!1,bot:null,pageForm:{id:null,content:"",command:null,slug:null,comment:null,video:null,images:[],reply_keyboard_title:null,reply_keyboard:null,inline_keyboard:null,is_external:!1,next_page_id:null,next_bot_dialog_command_id:null,next_bot_menu_slug_id:null,rules_if:null,rules_else_page_id:null,rules_if_message:null,rules_else_message:null}}},watch:{need_page_images:function(s,t){this.need_page_images||(this.photos=[],this.pageForm.images=[])},need_page_video:function(s,t){this.need_page_video||(this.pageForm.video=null)},need_inline_menu:function(s,t){this.need_inline_menu||(this.pageForm.inline_keyboard=null,this.pageForm.inline_keyboard_id=null)},need_rules:function(s,t){this.need_rules||(this.pageForm.rules_if=null,this.pageForm.rules_else_page_id=null,this.pageForm.rules_if_message=null,this.pageForm.rules_else_message=null)},need_reply_menu:function(s,t){this.need_reply_menu||(this.pageForm.reply_keyboard=null,this.pageForm.reply_keyboard_id=null)},need_attach_page:function(s,t){this.need_attach_page||(this.pageForm.next_page_id=null)},need_attach_dialog:function(s,t){this.need_attach_dialog||(this.pageForm.next_bot_dialog_command_id=null)},need_attach_slug:function(s,t){this.need_attach_slug||(this.pageForm.next_bot_menu_slug_id=null)},pageForm:{handler:function(s){this.pageForm.reply_keyboard!=null&&(this.need_reply_menu=!0),this.pageForm.inline_keyboard!=null&&(this.need_inline_menu=!0),this.pageForm.images.length>0&&(this.need_page_images=!0),this.pageForm.next_bot_dialog_command_id!=null&&(this.need_attach_dialog=!0),this.pageForm.next_bot_menu_slug_id!=null&&(this.need_attach_slug=!0),this.pageForm.next_page_id!=null&&(this.need_attach_page=!0),this.pageForm.rules_if!=null&&(this.need_rules=!0),this.pageForm.video!=null&&(this.need_page_video=!0),this.need_clean=!0},deep:!0}},computed:{...C(["getCurrentBot"]),qr(){return"https://api.qrserver.com/v1/create-qr-code/?size=450x450&qzone=2&data="+this.link},pageLink(){if(!this.pageForm.id)return"Ссылка недоступна";let s="";for(let t=0;t<10-(""+this.pageForm.id).length;t++)s+="0";return s+=this.pageForm.id,"https://t.me/"+this.getCurrentBot.bot_domain+"?start="+btoa("004"+s)}},mounted(){if(this.page){let s=this.page;this.photos=[],this.pageForm={id:s.id,slug_id:s.slug?s.slug.id:null,content:s.content,command:s.slug?s.slug.command:null,slug:s.slug?s.slug.slug:null,comment:s.slug?s.slug.comment:null,images:s.images||[],reply_keyboard_title:s.reply_keyboard_title||null,reply_keyboard_id:s.reply_keyboard_id||null,inline_keyboard_id:s.inline_keyboard_id||null,reply_keyboard:s.replyKeyboard||null,inline_keyboard:s.inlineKeyboard||null,next_page_id:s.next_page_id||null,next_bot_dialog_command_id:s.next_bot_dialog_command_id||null,next_bot_menu_slug_id:s.next_bot_menu_slug_id||null,is_external:s.is_external||!1,rules_if:s.rules_if||null,rules_else_page_id:s.rules_else_page_id||null,video:s.video||null,rules_if_message:s.rules_if_message||null,rules_else_message:s.rules_else_message||null}}else this.clearForm();this.loadCurrentBot().then(()=>{})},methods:{copyToClipBoard(s){navigator.clipboard.writeText(s).then(()=>{this.$notify({title:"Копирование",text:"Ссылка скопирована в буфер"})}).catch(t=>{this.$notify({title:"Копирование",text:"Ошибка копирования",type:"error"})})},associateDialog(s){this.pageForm.next_bot_dialog_command_id=s.id},associateSlug(s){this.pageForm.next_bot_menu_slug_id=s.id},loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},attachPage(s){s.id!=this.pageForm.id?this.pageForm.next_page_id=s.id:this.$notify({title:"Конструктор страниц",text:"Вы не можете связать данную страницу с собой",type:"error"})},injectContent(s){this.pageForm.content?this.pageForm.content+=s.text:this.pageForm.content=s.text},clearForm(){this.photos=[],this.pageForm={id:null,content:null,command:null,slug:null,comment:null,images:[],reply_keyboard:null,inline_keyboard:null,is_external:!1,video:null,reply_keyboard_title:null,reply_keyboard_id:null,inline_keyboard_id:null,next_page_id:null,next_bot_dialog_command_id:null,next_bot_menu_slug_id:null,rules_if_message:null,rules_else_message:null},this.photos=[],this.showReplyTemplateSelector=!1,this.showInlineTemplateSelector=!1,this.need_page_images=!1,this.need_page_video=!1,this.need_inline_menu=!1,this.need_reply_menu=!1,this.need_attach_page=!1,this.need_attach_dialog=!1,this.need_attach_slug=!1,this.need_rules=!1,this.$nextTick(()=>{this.need_clean=!1})},submitPage(){let s=new FormData;if(Object.keys(this.pageForm).forEach(t=>{const o=this.pageForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.bot&&s.append("bot_id",this.bot.id),this.photos.length>0)for(let t=0;t<this.photos.length;t++)s.append("photos[]",this.photos[t]);this.$store.dispatch(this.pageForm.id==null?"createPage":"updatePage",{pageForm:s}).then(t=>{this.load=!0,this.$nextTick(()=>{this.load=!1,this.clearForm()}),this.$emit("callback",t.data),this.$notify({title:"Конструктор ботов",text:this.pageForm.id==null?"Страница успешно создана!":"Страница успешно обновлена!",type:"success"})}).catch(t=>{})},saveInlineKeyboard(s){this.pageForm.inline_keyboard=s},selectReplyKeyboard(s){this.pageForm.reply_keyboard=s,this.showReplyTemplateSelector=!1},selectInlineKeyboard(s){this.pageForm.inline_keyboard=s,this.showInlineTemplateSelector=!1},saveReplyKeyboard(s){this.pageForm.reply_keyboard=s},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removePhoto(s){this.photos.splice(s,1)},removeImage(s){this.pageForm.images.splice(s,1)},onChangePhotos(s){const t=s.target.files;for(let o=0;o<t.length;o++)this.photos.push(t[o])},onChange(s){this.pageForm.content=s},selectVideo(s){this.pageForm.video=s.file_id}}},Xa=Object.assign(Qa,{__name:"Page",setup(s){return(t,o)=>{const a=O("Popper"),d=U("lazy");return t.bot?(l(),i("form",{key:0,onSubmit:o[22]||(o[22]=P((...n)=>t.submitPage&&t.submitPage(...n),["prevent"]))},[e("div",an,[e("div",dn,[e("h6",rn,[e("span",null,"Вы создаете страницу для "+h(t.bot.bot_domain),1),t.pageForm.id||t.need_clean?(l(),i("a",{key:0,href:"#clear-form",onClick:o[0]||(o[0]=(...n)=>t.clearForm&&t.clearForm(...n))},"очистить форму")):r("",!0)])]),t.pageForm.id?(l(),i("div",cn,[e("div",un,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[1]||(o[1]=n=>t.need_show_qr_and_link=n),type:"checkbox",id:"need-show-qr-and-link"},null,512),[[k,t.need_show_qr_and_link]]),mn])])):r("",!0),t.pageForm.id&&t.need_show_qr_and_link?(l(),i("div",hn,[e("p",null,[m("Ссылка на текущую страницу: "),e("span",{class:"bg-secondary font-bold cursor-pointer",onClick:o[2]||(o[2]=n=>t.copyToClipBoard(t.pageLink))},h(t.pageLink),1)]),e("div",_n,[c(e("img",pn,null,512),[[d,t.qr]])])])):r("",!0),e("div",bn,[e("label",gn,[v(a,null,{content:g(()=>[vn]),default:g(()=>[fn]),_:1}),m(" Команда "),yn]),c(e("input",{type:"text",class:"form-control",placeholder:"Команда","aria-label":"Команда","onUpdate:modelValue":o[3]||(o[3]=n=>t.pageForm.command=n),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[_,t.pageForm.command]])]),e("div",$n,[e("div",kn,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[4]||(o[4]=n=>t.pageForm.is_external=n),type:"checkbox",id:"is-external"},null,512),[[k,t.pageForm.is_external]]),Fn])]),e("div",wn,[e("label",Cn,[v(a,null,{content:g(()=>[Sn]),default:g(()=>[Pn]),_:1}),m(" Описание страницы "),jn]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Описание страницы","aria-label":"Описание страницы","onUpdate:modelValue":o[5]||(o[5]=n=>t.pageForm.comment=n),maxlength:"255","aria-describedby":"bot-domain",required:""},`
            `,512),[[_,t.pageForm.comment]])])]),t.pageForm.is_external?r("",!0):(l(),i("div",Vn,[e("div",Un,[e("label",Bn,[e("div",null,[v(a,null,{content:g(()=>[In]),default:g(()=>[On]),_:1}),m(" Текстовое содержимое страницы "),Tn]),v(H,{param:"content",onCallback:t.injectContent},null,8,["onCallback"])]),e("div",Ln,[c(e("textarea",{class:"form-control","onUpdate:modelValue":o[6]||(o[6]=n=>t.pageForm.content=n),maxlength:"4096",placeholder:"Введите текст",id:"floatingTextarea2",style:{"min-height":"100px"}},null,512),[[_,t.pageForm.content]]),e("label",Dn,[m("Содержимое страницы "),t.pageForm.content?(l(),i("span",qn,h(t.pageForm.content.length)+"/4096 ",1)):r("",!0)])])]),e("div",Rn,[e("div",Mn,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[7]||(o[7]=n=>t.need_page_images=n),type:"checkbox",id:"need-page-images"},null,512),[[k,t.need_page_images]]),Gn])]),t.need_page_images?(l(),i("div",zn,[e("div",En,[Kn,e("div",Nn,[e("label",xn,[m(" + "),e("input",{type:"file",id:"photos",multiple:"",accept:"image/*",onChange:o[8]||(o[8]=(...n)=>t.onChangePhotos&&t.onChangePhotos(...n)),style:{display:"none"}},null,32)]),e("div",An,[t.photos.length>0?(l(),i("div",Jn,[(l(!0),i(b,null,f(t.photos,(n,p)=>(l(),i("div",Wn,[c(e("img",null,null,512),[[d,t.getPhoto(n).imageUrl]]),e("div",Yn,[e("a",{onClick:u=>t.removePhoto(p)},"Удалить",8,Hn)])]))),256))])):r("",!0),t.pageForm.images.length>0?(l(),i("h6",Qn,"Ранее загруженные фотографии")):r("",!0),t.pageForm.images.length>0?(l(),i("div",Xn,[(l(!0),i(b,null,f(t.pageForm.images,(n,p)=>(l(),i("div",Zn,[c(e("img",null,null,512),[[d,"/images-by-bot-id/"+t.bot.id+"/"+n]]),e("div",ea,[e("a",{onClick:u=>t.removeImage(p)},"Удалить",8,ta)])]))),256))])):r("",!0)])])])])):r("",!0),e("div",sa,[e("div",oa,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[9]||(o[9]=n=>t.need_page_video=n),type:"checkbox",id:"need-page-video"},null,512),[[k,t.need_page_video]]),la])]),t.need_page_video?(l(),i("div",ia,[v(Ll,{"need-video":!0,"need-video-note":!0,selected:t.pageForm.video,onSelect:t.selectVideo},null,8,["selected","onSelect"])])):r("",!0),e("div",na,[e("div",aa,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[10]||(o[10]=n=>t.need_reply_menu=n),type:"checkbox",id:"need-reply-menu"},null,512),[[k,t.need_reply_menu]]),da])]),t.need_reply_menu?(l(),i("div",ra,[e("div",ca,[e("div",ua,[ma,e("button",{class:w(["btn",{"btn-outline-primary":!t.showReplyTemplateSelector,"btn-primary":t.showReplyTemplateSelector}]),type:"button",onClick:o[11]||(o[11]=n=>t.showReplyTemplateSelector=!t.showReplyTemplateSelector)},[t.showReplyTemplateSelector?(l(),i("span",_a," Скрыть шаблоны меню")):(l(),i("span",ha," Открыть шаблоны меню"))],2)]),e("div",pa,[e("div",ba,[e("label",ga,[v(a,null,{content:g(()=>[va]),default:g(()=>[fa]),_:1}),m(" Заголовок ")]),c(e("input",{type:"text",class:"form-control",placeholder:"Заголовок меню","aria-label":"Заголовок меню","onUpdate:modelValue":o[12]||(o[12]=n=>t.pageForm.reply_keyboard_title=n),maxlength:"255","aria-describedby":"bot-domain"},null,512),[[_,t.pageForm.reply_keyboard_title]])]),t.showReplyTemplateSelector?(l(),$(L,{key:0,class:"mb-2",type:"reply",onSelect:t.selectReplyKeyboard,"select-mode":!0},null,8,["onSelect"])):(l(),$(T,{key:1,type:"reply",onSave:t.saveReplyKeyboard,"edited-keyboard":t.pageForm.reply_keyboard},null,8,["onSave","edited-keyboard"]))])])])):r("",!0),e("div",ya,[e("div",$a,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[13]||(o[13]=n=>t.need_inline_menu=n),type:"checkbox",id:"need-inline-menu"},null,512),[[k,t.need_inline_menu]]),ka])]),t.need_inline_menu?(l(),i("div",Fa,[e("div",wa,[e("div",Ca,[Pa,e("button",{class:w(["btn",{"btn-outline-primary":!t.showInlineTemplateSelector,"btn-primary":t.showInlineTemplateSelector}]),type:"button",onClick:o[14]||(o[14]=n=>t.showInlineTemplateSelector=!t.showInlineTemplateSelector)},[t.showInlineTemplateSelector?(l(),i("span",ja," Скрыть шаблоны меню")):(l(),i("span",Sa," Открыть шаблоны меню"))],2)]),e("div",Va,[t.showInlineTemplateSelector?(l(),$(L,{key:0,class:"mb-2",type:"inline",onSelect:t.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(l(),$(T,{key:1,type:"inline",onSave:t.saveInlineKeyboard,"edited-keyboard":t.pageForm.inline_keyboard},null,8,["onSave","edited-keyboard"]))])])])):r("",!0),e("div",Ua,[e("div",Ba,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[15]||(o[15]=n=>t.need_attach_page=n),type:"checkbox",id:"need-page-attach"},null,512),[[k,t.need_attach_page]]),Oa])]),t.need_attach_page?(l(),i("div",Ia,[t.pageForm.next_page_id?(l(),i("p",Ta,[m("Связано со страницей #"+h(t.pageForm.next_page_id)+" ",1),e("a",{class:"btn btn-link",onClick:o[16]||(o[16]=n=>t.pageForm.next_page_id=null)},"Очистить")])):r("",!0),v(D,{current:t.pageForm.id,onCallback:t.attachPage,editor:!1},null,8,["current","onCallback"])])):r("",!0),e("div",La,[e("div",Da,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[17]||(o[17]=n=>t.need_attach_slug=n),type:"checkbox",id:"need-slug-attach"},null,512),[[k,t.need_attach_slug]]),qa])]),t.need_attach_slug?(l(),i("div",Ra,[t.pageForm.next_bot_menu_slug_id?(l(),i("p",Ma,[m("Связано со скриптом #"+h(t.pageForm.next_bot_menu_slug_id)+" ",1),e("a",{class:"btn btn-link",onClick:o[18]||(o[18]=n=>t.pageForm.next_bot_menu_slug_id=null)},"Очистить")])):r("",!0),t.bot?(l(),$(Fs,{key:1,global:!0,onCallback:t.associateSlug,bot:t.bot},null,8,["onCallback","bot"])):r("",!0)])):r("",!0),e("div",Ga,[e("div",za,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[19]||(o[19]=n=>t.need_attach_dialog=n),type:"checkbox",id:"need-dialog-attach"},null,512),[[k,t.need_attach_dialog]]),Ea])]),t.need_attach_dialog?(l(),i("div",Ka,[t.pageForm.next_bot_dialog_command_id?(l(),i("p",Na,[m("Связано с диалогом #"+h(t.pageForm.next_bot_dialog_command_id)+" ",1),e("a",{class:"btn btn-link",onClick:o[20]||(o[20]=n=>t.pageForm.next_bot_dialog_command_id=null)},"Очистить")])):r("",!0),t.bot?(l(),$(pl,{key:1,onSelectDialog:t.associateDialog,bot:t.bot},null,8,["onSelectDialog","bot"])):r("",!0)])):r("",!0)])),e("div",xa,[e("div",Aa,[e("div",Ja,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[21]||(o[21]=n=>t.need_rules=n),type:"checkbox",id:"need-rules"},null,512),[[k,t.need_rules]]),Wa])]),t.need_rules?(l(),i("div",Ya,[v(nn,{bot:t.bot,"rules-form":t.pageForm},null,8,["bot","rules-form"])])):r("",!0)]),Ha],32)):r("",!0)}}}),Za={data(){return{bot:null,menus:[],deletedMenus:[],menuForm:{title:null,description:null,image:null,info_link:null,bot_id:null}}},computed:{...C(["getCurrentBot"])},mounted(){this.loadCurrentBot().then(()=>{this.loadMenuByBotId()})},methods:{loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},loadMenuByBotId(){this.$store.dispatch("loadMenuByBotId",{botId:this.bot.id}).then(s=>{this.menus=s}).catch(()=>{})},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removePhoto(){this.menuForm.image=null},removeItem(s){this.menus[s].id&&this.deletedMenus.push(this.menus[s].id),this.menus.splice(s,1)},submitMenus(){this.menus.forEach(s=>{let t=new FormData;Object.keys(s).forEach(o=>{const a=s[o]||"";typeof a=="object"?t.append(o,JSON.stringify(a)):t.append(o,a)}),this.deletedMenus.length>0&&t.append("deleted_menus",JSON.stringify(this.deletedMenus)),typeof s.image!="string"&&(t.append("preview",s.image),t.delete("image")),this.$store.dispatch("createImageMenu",{menuForm:t}).then(o=>{this.$emit("callback",o.data),this.$notify("Меню успешно создано и сохранено")}).catch(o=>{})})},addImageMenu(){this.menuForm.bot_id=this.bot.id,this.menus.push(this.menuForm),this.$notify("Меню успешно добавлено в список"),this.menuForm={title:null,description:null,image:null,info_link:null,bot_id:null}},onChangePhotos(s){const t=s.target.files[0];this.menuForm.image=t}}},ed={key:0,class:"card"},td={class:"card-body"},sd={class:"row"},od={class:"col-md-8"},ld={class:"row"},id={class:"col-12"},nd={class:"mb-3"},ad=e("label",{class:"form-label",id:"menu-address"},[m(" Заголовок меню "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),dd={class:"row"},rd={class:"col-12"},cd={class:"mb-3"},ud={class:"form-label",id:"menu-description"},md=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),hd={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},_d={class:"row"},pd={class:"col-12"},bd={class:"mb-3"},gd=e("label",{class:"form-label",id:"menu-address"},[m("Ссылка на страницу в "),e("a",{target:"_blank",href:"https://telegra.ph"},"telegra.ph")],-1),fd={class:"row"},vd={class:"col-12 mb-3"},yd=e("h5",null,"Картинка меню с позициями",-1),$d={class:"photo-preview d-flex justify-content-start flex-wrap w-100"},kd={for:"menu-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},Fd=e("span",null,"+",-1),wd={key:0,class:"mb-2 img-preview",style:{"margin-right":"10px"}},Cd={class:"remove"},Pd=e("div",{class:"row"},[e("div",{class:"col-12"},[e("button",{class:"btn btn-outline-success w-100",type:"submit"},"Добавить меню ")])],-1),Sd={class:"col-md-4"},jd={class:"row"},Vd={class:"col-12 mt-3"},Ud={class:"card"},Bd={class:"card-header d-flex justify-content-between"},Od=["onClick"],Id={class:"card-body"},Td={class:"w-100 d-flex"},Ld={key:0,class:"mb-2 img-preview",style:{"margin-right":"10px"}},Dd={key:0},qd={key:1},Rd={key:1,class:"col-12 mt-3"},Md=e("p",null,"На текущий момент у заведения нет ни 1 созданного меню",-1),Gd=[Md],zd={class:"row mt-3"},Ed={class:"col-12"},Kd=["disabled"];function Nd(s,t,o,a,d,n){const p=U("lazy");return d.bot?(l(),i("div",ed,[e("div",td,[e("div",sd,[e("div",od,[e("form",{onSubmit:t[5]||(t[5]=P((...u)=>n.addImageMenu&&n.addImageMenu(...u),["prevent"]))},[e("h6",null,"Графическое Меню к боту #"+h(d.bot.id||"Не установлен"),1),e("div",ld,[e("div",id,[e("div",nd,[ad,c(e("input",{type:"text",class:"form-control",placeholder:"Название меню","aria-label":"Название меню",maxlength:"255","onUpdate:modelValue":t[0]||(t[0]=u=>d.menuForm.title=u),"aria-describedby":"menu-address",required:""},null,512),[[_,d.menuForm.title]])])])]),e("div",dd,[e("div",rd,[e("div",cd,[e("label",ud,[m(" Описание меню "),md,d.menuForm.description?(l(),i("small",hd," Длина текста "+h(d.menuForm.description.length),1)):r("",!0)]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Описание меню","aria-label":"Описание меню",maxlength:"255","onUpdate:modelValue":t[1]||(t[1]=u=>d.menuForm.description=u),"aria-describedby":"menu-description"},`
                    `,512),[[_,d.menuForm.description]])])])]),e("div",_d,[e("div",pd,[e("div",bd,[gd,m(" с вашим меню "),c(e("input",{type:"text",class:"form-control",placeholder:"Информационная ссылка","aria-label":"Информационная ссылка",maxlength:"255","onUpdate:modelValue":t[2]||(t[2]=u=>d.menuForm.info_link=u),"aria-describedby":"menu-info-link"},null,512),[[_,d.menuForm.info_link]])])])]),e("div",fd,[e("div",vd,[yd,e("div",$d,[e("label",kd,[Fd,e("input",{type:"file",id:"menu-photos",accept:"image/*",onChange:t[3]||(t[3]=(...u)=>n.onChangePhotos&&n.onChangePhotos(...u)),style:{display:"none"}},null,32)]),d.menuForm.image?(l(),i("div",wd,[c(e("img",null,null,512),[[p,n.getPhoto(d.menuForm.image).imageUrl]]),e("div",Cd,[e("a",{onClick:t[4]||(t[4]=u=>n.removePhoto())},"Удалить")])])):r("",!0)])])]),Pd],32)]),e("div",Sd,[e("div",jd,[d.menus.length>0?(l(!0),i(b,{key:0},f(d.menus,(u,y)=>(l(),i("div",Vd,[e("div",Ud,[e("div",Bd,[e("h6",null,[m("Название "),e("strong",null,h(u.title||"Не указано"),1)]),e("a",{class:"cursor-pointer",onClick:F=>n.removeItem(y)},"Удалить",8,Od)]),e("div",Id,[e("p",null,h(u.description||"Не указано"),1),e("p",null," ссылка на меню из telegra.ph "+h(u.info_link||"Не указано"),1),e("div",Td,[u.image?(l(),i("div",Ld,[typeof u.image=="string"?c((l(),i("img",Dd,null,512)),[[p,"/images-by-bot-id/"+d.bot.id+"/"+u.image]]):c((l(),i("img",qd,null,512)),[[p,n.getPhoto(u.image).imageUrl]])])):r("",!0)])])])]))),256)):(l(),i("div",Rd,Gd))])])]),e("div",zd,[e("div",Ed,[e("button",{onClick:t[6]||(t[6]=(...u)=>n.submitMenus&&n.submitMenus(...u)),disabled:d.menus.length===0,class:"btn btn-outline-primary p-3 w-100"},"Сохранить меню для заведения ",8,Kd)])])])])):r("",!0)}const xd=j(Za,[["render",Nd]]),Ad={class:"row"},Jd={class:"input-group mb-3"},Wd=q('<div class="row"><div class="col-md-12 col-12"><button type="button" title="Создать новую группу" data-bs-toggle="modal" data-bs-target="#group-create-modal" class="btn btn-outline-success p-3 mb-2 mr-2"><i class="fa-solid fa-layer-group"></i></button><button type="button" data-bs-toggle="modal" data-bs-target="#dialog-create-modal" class="btn btn-outline-success p-3 mb-2"><i class="fa-regular fa-comment-dots" style="margin-right:10px;"></i>Создать новый диалоговый скрипт </button></div></div>',1),Yd={key:0,class:"row"},Hd={class:"col-12 mb-3"},Qd={class:"card mb-2"},Xd={class:"card-header"},Zd=["onClick"],er=e("i",{class:"fa-solid fa-trash-can"},null,-1),tr=[er],sr={class:"card-body"},or={key:0,class:"row"},lr={class:"col-md-12 col-lg-4 col-12 col-sm-12 mb-2"},ir={key:1,class:"row"},nr=e("div",{class:"col-12"},[e("p",null,"Диалоговых скриптов не найдено")],-1),ar=[nr],dr={class:"col-12"},rr={key:1,class:"row"},cr=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет созданных диалоговых групп ")],-1),ur=[cr],mr={class:"modal fade",id:"link-modal",tabindex:"-1"},hr={class:"modal-dialog modal-lg"},_r={class:"modal-content"},pr=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"}," Диалог связывания "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),br={key:0,class:"modal-body"},gr=e("h6",null,"Связать её с:",-1),fr={class:"row"},vr={class:"col-md-2 mb-1"},yr=["onClick"],$r=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),kr={class:"modal fade",id:"group-modal",tabindex:"-1"},Fr={class:"modal-dialog modal-lg"},wr={class:"modal-content"},Cr=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"}," Диалог перемещения между группами "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Pr={key:0,class:"modal-body"},Sr=e("h6",null,"Переместить её в группу",-1),jr={key:0,class:"row"},Vr={class:"col-md-6 mb-1"},Ur=["onClick"],Br={key:1,class:"row"},Or=e("div",{class:"col-12"},[e("h6",null,"Перемещаем-с...")],-1),Ir=[Or],Tr=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),Lr={class:"modal fade",id:"group-create-modal",tabindex:"-1"},Dr={class:"modal-dialog modal-lg"},qr={class:"modal-content"},Rr=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"}," Диалог создания группы "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Mr={class:"modal-body"},Gr=e("div",{class:"alert alert-warning",role:"alert"}," Группировка имеет исключительно логическое значение! Группа помогает Вам ориентироваться в цепочках диалогов ",-1),zr={class:"form-floating mb-3"},Er=e("label",{for:"floatingInput"},"Мнемоническое имя (англ)",-1),Kr={class:"form-floating mb-3"},Nr=e("label",{for:"floatingInput"},"Название группы",-1),xr=e("button",{type:"submit",class:"btn btn-outline-primary w-100 p-3"},"Создать",-1),Ar=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),Jr={class:"modal fade",id:"dialog-create-modal",tabindex:"-1"},Wr={class:"modal-dialog modal-lg"},Yr={class:"modal-content"},Hr=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"}," Создание диалогового сообщения "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Qr={class:"modal-body"},Xr=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),Zr={data(){return{bot:null,groupForm:{slug:null,title:null,bot_id:null},loading:!0,dialog_groups:[],search:null,dialog_groups_paginate_object:null,link:null,group:null}},computed:{...C(["getDialogGroups","getCurrentBot","getDialogGroupsPaginateObject"]),filteredCommands(){return this.link?this.dialog_groups.find(t=>t.id===this.link.group_id).bot_dialog_commands.filter(t=>t.id!=this.link.id):[]}},mounted(){this.loadCurrentBot().then(()=>{this.loadGroups()})},methods:{loadCurrentBot(s=null){return this.$store.dispatch("updateCurrentBot",{bot:s}).then(()=>{this.bot=this.getCurrentBot})},removeGroup(s){this.loading=!0,this.$store.dispatch("removeDialogGroup",{dataObject:{dialogGroupId:s}}).then(t=>{this.loading=!1,this.$notify("Диалоговая группа успешно удалена"),this.loadGroups()}).catch(t=>{this.loading=!1})},addGroup(){this.loading=!0,this.groupForm.bot_id=this.bot.id;let s=new FormData;Object.keys(this.groupForm).forEach(t=>{const o=this.groupForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.$store.dispatch("createDialogGroup",{dialogGroupForm:s}).then(t=>{this.loading=!1,this.$notify("Диалоговая группа успешно создана"),this.groupForm={slug:null,title:null},this.loadGroups()}).catch(t=>{this.loading=!1})},doSwapGroup(s){this.loading=!0,this.$store.dispatch("swapDialogGroup",{swapForm:{dialogCommandId:this.group.command_id,dialogGroupId:s}}).then(t=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Диалоговая команда успешно перемещена в другую группу!",type:"success"}),this.loadGroups(),this.group.group_id=s}).catch(t=>{this.loading=!1})},doCommandLink(s){this.loading=!0,this.$store.dispatch("swapDialogCommand",{swapForm:{dialogCommandFromId:s,dialogCommandToId:this.link.id}}).then(t=>{this.loading=!1,this.$notify({title:"Конструктор ботов",text:"Диалоговая команда успешно слинкована!",type:"success"}),this.loadGroups(),this.link.current_next_id=s}).catch(t=>{this.loading=!1})},swapGroupInit(s){this.group=s,new bootstrap.Modal("#group-modal",{}).show()},tryLink(s){this.link=s,new bootstrap.Modal("#link-modal",{}).show()},selectDialog(s){this.$emit("select-dialog",s),this.$notify("Вы выбрали диалог из списка!")},selectGroup(s){this.$emit("select-group",s),this.$notify("Вы выбрали группу из списка!")},nextGroups(s){this.loadGroups(s)},loadGroups(s=0){this.loading=!0,this.$store.dispatch("loadDialogGroups",{dataObject:{botId:this.bot.id||null,search:this.search},page:s}).then(t=>{this.loading=!1,this.dialog_groups=this.getDialogGroups,this.dialog_groups_paginate_object=this.getDialogGroupsPaginateObject}).catch(()=>{this.loading=!1})}}},ec=Object.assign(Zr,{__name:"BotDialogGroupList",setup(s){return(t,o)=>(l(),i(b,null,[e("div",Ad,[e("div",Jd,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск группы","aria-label":"Поиск группы","onUpdate:modelValue":o[0]||(o[0]=a=>t.search=a),"aria-describedby":"button-addon2"},null,512),[[_,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=(...a)=>t.loadGroups&&t.loadGroups(...a)),type:"button",id:"button-addon2"},"Найти ")])]),Wd,t.dialog_groups.length>0?(l(),i("div",Yd,[e("div",Hd,[(l(!0),i(b,null,f(t.dialog_groups,(a,d)=>(l(),i("div",Qd,[e("div",Xd,[e("h6",null,[m(" #"+h(a.id)+" - "+h(a.title||"Не указано ")+" ",1),e("button",{onClick:n=>t.removeGroup(a.id),type:"button",class:"btn btn-outline-danger"},tr,8,Zd)])]),e("div",sr,[a.bot_dialog_commands.length>0?(l(),i("div",or,[(l(!0),i(b,null,f(a.bot_dialog_commands,(n,p)=>(l(),i("div",lr,[t.bot?(l(),$(G,{key:0,bot:t.bot,onCallback:t.loadGroups,onSelect:t.selectDialog,onSwap:t.swapGroupInit,onLink:t.tryLink,item:n},null,8,["bot","onCallback","onSelect","onSwap","onLink","item"])):r("",!0)]))),256))])):(l(),i("div",ir,ar))])]))),256))]),e("div",dr,[t.dialog_groups_paginate_object?(l(),$(S,{key:0,onPagination_page:t.nextGroups,pagination:t.dialog_groups_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",rr,ur)),e("div",mr,[e("div",hr,[e("div",_r,[pr,t.link?(l(),i("div",br,[e("p",null,"Вы выбрали диалоговую команду #"+h(t.link.id),1),gr,e("div",fr,[(l(!0),i(b,null,f(t.filteredCommands,(a,d)=>(l(),i("div",vr,[e("button",{type:"button",onClick:n=>t.doCommandLink(a.id),class:w([{"btn-primary text-white":t.link.current_next_id==a.id},"btn btn-outline-primary w-100"])},"#"+h(a.id)+" "+h(a.pre_text||"Без текста"),11,yr)]))),256))])])):r("",!0),$r])])]),e("div",kr,[e("div",Fr,[e("div",wr,[Cr,t.group?(l(),i("div",Pr,[e("p",null,"Вы выбрали диалоговую команду #"+h(t.group.command_id),1),Sr,t.loading?(l(),i("div",Br,Ir)):(l(),i("div",jr,[(l(!0),i(b,null,f(t.dialog_groups,(a,d)=>(l(),i("div",Vr,[e("button",{type:"button",onClick:n=>t.doSwapGroup(a.id),class:w([{"btn-primary text-white":a.id==t.group.group_id},"btn btn-outline-primary w-100"])},"#"+h(a.id)+" "+h(a.title||"Без названия"),11,Ur)]))),256))]))])):r("",!0),Tr])])]),e("div",Lr,[e("div",Dr,[e("div",qr,[Rr,e("div",Mr,[Gr,e("form",{onSubmit:o[4]||(o[4]=P((...a)=>t.addGroup&&t.addGroup(...a),["prevent"]))},[e("div",zr,[c(e("input",{type:"text",class:"form-control",id:"floatingInput",maxlength:"255",pattern:"[a-zA-Z0-9_]+","onUpdate:modelValue":o[2]||(o[2]=a=>t.groupForm.slug=a),required:""},null,512),[[_,t.groupForm.slug]]),Er]),e("div",Kr,[c(e("input",{type:"text",class:"form-control",id:"floatingInput",maxlength:"255","onUpdate:modelValue":o[3]||(o[3]=a=>t.groupForm.title=a),required:""},null,512),[[_,t.groupForm.title]]),Nr]),xr],32)]),Ar])])]),e("div",Jr,[e("div",Wr,[e("div",Yr,[Hr,e("div",Qr,[t.bot?(l(),$(M,{key:0,onCallback:t.loadGroups,bot:t.bot},null,8,["onCallback","bot"])):r("",!0)]),Xr])])])],64))}}),tc={props:["bot","item"],data(){return{sectionForm:{section:null},categoryForm:{label:null},tab:0,types:[{title:"Готовый продукт",value:1},{title:"Товар на вес",value:2},{title:"Конструктор товара",value:3}],productCategories:[],sections:["Общие характеристики","Дополнительная информация"],photos:[],categories:[],removed_options:[],productForm:{article:null,vk_product_id:null,title:null,description:null,images:[],type:1,old_price:null,current_price:null,variants:[],in_stop_list_at:null,bot_id:null,options:[],reviews:[],categories:[]}}},computed:{...C(["getProductCategories"]),filteredCategories(){return this.productCategories.length===0?this.categories:this.categories.filter(s=>this.productCategories.indexOf(s.value)===-1)}},mounted(){this.loadProductCategories(),this.item&&this.$nextTick(()=>{this.productForm={id:this.item.id||null,article:this.item.article||null,vk_product_id:this.item.vk_product_id||null,title:this.item.title||null,description:this.item.description||null,images:this.item.images||null,type:this.item.type||1,old_price:this.item.old_price||null,current_price:this.item.current_price||null,variants:this.item.variants||null,in_stop_list_at:this.item.in_stop_list_at||null,bot_id:this.item.bot_id||null,options:this.item.options||null,reviews:this.item.reviews||null},this.options=[],this.item.categories.forEach(s=>{this.productCategories.push(s.id)})})},methods:{prepareCategoryName(s){let t=this.categories.find(o=>o.value===s);return console.log(t),t?t.label:s},addCategory(){const s=this.categoryForm.label;this.productCategories.push(s),this.categoryForm.label=null},selectCategory(s){this.productCategories.push(s.value)},submit(){let s=new FormData;if(Object.keys(this.productForm).forEach(t=>{const o=this.productForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.bot&&s.append("bot_id",this.bot.id),this.photos.length>0)for(let t=0;t<this.photos.length;t++)s.append("photos[]",this.photos[t]);this.removed_options.length>0&&s.append("removed_options",JSON.stringify(this.removed_options)),this.productCategories.length>0&&s.append("categories",JSON.stringify(this.productCategories)),this.$store.dispatch("saveProduct",{productForm:s}).then(t=>{this.load=!0,this.$notify({title:"Конструктор ботов",text:"Продукт успешно сохранен!",type:"success"}),this.clearForm(),this.$emit("refresh")}).catch(t=>{})},onChangePhotos(s){const t=s.target.files;for(let o=0;o<t.length;o++)this.photos.push(t[o])},loadProductCategories(){this.$store.dispatch("loadProductCategories",{dataObject:{bot_id:this.bot.id}}).then(()=>{this.getProductCategories.forEach(t=>{this.categories.push({value:t.id,label:t.title})})})},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removeSection(s){this.sections.splice(s,1)},addSection(){this.sections.push(this.sectionForm.section),this.sectionForm.section=null},addOption(){this.productForm.options||(this.productForm.options=[]),this.productForm.options.push({id:null,key:null,value:null,title:null,section:null})},addVariant(){this.productForm.variants||(this.productForm.variants=[]),this.productForm.variants.push({key:null,value:null})},removeProductCategory(s){this.productCategories.splice(s,1)},removeVariant(s){this.productForm.variants.splice(s,1)},removeOption(s){this.productForm.options[s].id&&this.removed_options.push(this.productForm.options[s].id),this.productForm.options.splice(s,1)},removeImage(s){this.productForm.images.splice(s,1)},removePhoto(s){this.photos.splice(s,1)},clearForm(){const s={article:null,vk_product_id:null,title:null,description:null,images:[],type:1,old_price:null,current_price:null,variants:[],in_stop_list_at:null,bot_id:null,options:[],reviews:[],categories:[]};this.photos=[],this.removed_options=[],this.productCategories=[],this.productForm=s}}},sc={class:"nav nav-tabs"},oc={class:"nav-item"},lc={class:"nav-item"},ic={class:"nav-item"},nc={key:0},ac={class:"col-md-8 d-flex align-items-center"},dc={class:"form-check"},rc=e("label",{class:"form-check-label",for:"in-stop-list"}," Товар находится в стоп-листе ",-1),cc={class:"col-md-4 d-flex justify-content-end"},uc={class:"col-md-12 mb-3"},mc=["onClick"],hc={class:"dropdown"},_c=e("button",{type:"button",class:"btn btn-outline-info w-100","data-bs-toggle":"dropdown","data-bs-display":"static","aria-expanded":"false"},[e("p",{class:"mb-0"},"Выберите категорию")],-1),pc={class:"dropdown-menu w-100",style:{"overflow-y":"scroll",height:"300px"}},bc={class:"p-3"},gc=e("label",{for:"exampleDropdownFormEmail1",class:"form-label"},"Новая категория",-1),fc={class:"p-3"},vc=e("li",null,[e("hr",{class:"dropdown-divider"})],-1),yc=["onClick"],$c={class:"col-md-6"},kc={class:"form-floating mb-3"},Fc=e("label",{for:"article"},"Артикул товара",-1),wc={class:"col-md-6"},Cc={class:"form-floating mb-3"},Pc=e("label",{for:"vk-product-id"},"Идентификатор товара VK",-1),Sc={class:"col-md-6"},jc={class:"form-floating mb-3"},Vc=e("label",{for:"title"},"Названи товара",-1),Uc={class:"col-md-6"},Bc={class:"form-floating mb-3"},Oc=["value"],Ic=e("label",{for:"type"},"Тип товара",-1),Tc={class:"col-md-12"},Lc={class:"form-floating mb-3"},Dc=e("label",{for:"description"},"Описание товара",-1),qc={class:"col-md-6"},Rc={class:"form-floating mb-3"},Mc=e("label",{for:"current-price"},"Актуальная цена",-1),Gc={class:"col-md-6"},zc={class:"form-floating mb-3"},Ec=e("label",{for:"old-price"},"Старая цена",-1),Kc={class:"col-md-12 mb-3"},Nc={class:"card"},xc={class:"card-header"},Ac={key:0},Jc={class:"card-body"},Wc={class:"row"},Yc={class:"col-12 mb-3"},Hc={class:"col-md-6 mb-3"},Qc={class:"card w-100"},Xc={class:"card-body"},Zc={class:"form-floating mb-3"},eu=["onUpdate:modelValue","id"],tu=["for"],su={class:"form-floating mb-3"},ou=["onUpdate:modelValue","id"],lu=["for"],iu={class:"card-footer"},nu=["onClick"],au=e("i",{class:"fa-solid fa-trash-can"},null,-1),du=[au],ru={class:"col-md-12 mb-3"},cu={class:"card"},uu=e("div",{class:"card-header"},[e("h6",null,"Характеристики товара")],-1),mu={class:"card-body"},hu={class:"row mb-3"},_u={class:"col-12"},pu=e("button",{class:"btn btn-outline-info",type:"submit",id:"button-addon2"},"Добавить секцию ",-1),bu={class:"badge bg-info mr-1"},gu=["onClick"],fu=e("i",{class:"fa-solid fa-xmark"},null,-1),vu=[fu],yu={class:"row"},$u={class:"col-md-4 mb-3"},ku={class:"card w-100"},Fu={class:"card-body"},wu={class:"form-floating mb-3"},Cu=["onUpdate:modelValue","id"],Pu=["for"],Su={class:"form-floating mb-3"},ju=["onUpdate:modelValue","id"],Vu=["for"],Uu={class:"form-floating mb-3"},Bu=["onUpdate:modelValue","id"],Ou=e("option",{value:null},"Без секции",-1),Iu=["value"],Tu=["for"],Lu={class:"card-footer"},Du=["onClick"],qu=e("i",{class:"fa-solid fa-trash-can"},null,-1),Ru=[qu],Mu={class:"row"},Gu={class:"col-12"},zu={class:"col-md-12 mb-3"},Eu=e("h6",null,"Фотографии товара",-1),Ku={class:"photo-preview d-flex justify-content-start flex-wrap w-100"},Nu={for:"location-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},xu=e("span",null,"+",-1),Au={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Ju={class:"remove"},Wu=["onClick"],Yu={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Hu={class:"remove"},Qu=["onClick"],Xu=e("div",{class:"col-12"},[e("button",{type:"submit",class:"btn btn-outline-primary w-100 p-3"},"Сохранить ")],-1),Zu={key:1};function em(s,t,o,a,d,n){const p=U("lazy");return l(),i(b,null,[e("ul",sc,[e("li",oc,[e("a",{class:w(["nav-link",{active:d.tab===0}]),onClick:t[0]||(t[0]=u=>d.tab=0),"aria-current":"page",href:"#product-form-info"},"Информация о товаре",2)]),e("li",lc,[e("a",{class:w(["nav-link",{active:d.tab===1}]),onClick:t[1]||(t[1]=u=>d.tab=1),href:"#product-reviews"},"Комментарии",2)]),e("li",ic,[e("a",{class:w(["nav-link",{active:d.tab===2}]),onClick:t[2]||(t[2]=u=>d.tab=2),href:"#product-reviews"},"Заказы",2)])]),d.tab===0?(l(),i("div",nc,[e("form",{onSubmit:t[19]||(t[19]=P((...u)=>n.submit&&n.submit(...u),["prevent"])),class:"row"},[e("div",ac,[e("div",dc,[c(e("input",{class:"form-check-input","onUpdate:modelValue":t[3]||(t[3]=u=>d.productForm.in_stop_list_at=u),type:"checkbox",value:"false",id:"in-stop-list"},null,512),[[k,d.productForm.in_stop_list_at]]),rc])]),e("div",cc,[e("a",{href:"#",class:"btn btn-link",onClick:t[4]||(t[4]=(...u)=>n.clearForm&&n.clearForm(...u))},"Новый товар")]),e("div",uc,[(l(!0),i(b,null,f(d.productCategories,(u,y)=>(l(),i("span",{class:"badge bg-info mr-1 mb-1 cursor-pointer",onClick:F=>n.removeProductCategory(y)},h(n.prepareCategoryName(u)),9,mc))),256)),e("div",hc,[_c,e("ul",pc,[e("div",bc,[gc,c(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[5]||(t[5]=u=>d.categoryForm.label=u),id:"exampleDropdownFormEmail1",placeholder:"Название категории"},null,512),[[_,d.categoryForm.label]])]),e("div",fc,[e("button",{class:"btn btn-primary w-100",type:"button",onClick:t[6]||(t[6]=(...u)=>n.addCategory&&n.addCategory(...u))},"Добавить категорию ")]),vc,(l(!0),i(b,null,f(n.filteredCategories,u=>(l(),i("li",null,[e("button",{class:"dropdown-item",type:"button",onClick:y=>n.selectCategory(u)},h(u.label),9,yc)]))),256))])])]),e("div",$c,[e("div",kc,[c(e("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=u=>d.productForm.article=u),class:"form-control",id:"article",placeholder:"name@example.com"},null,512),[[_,d.productForm.article]]),Fc])]),e("div",wc,[e("div",Cc,[c(e("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=u=>d.productForm.vk_product_id=u),disabled:!0,class:"form-control",id:"vk-product-id",placeholder:"name@example.com"},null,512),[[_,d.productForm.vk_product_id]]),Pc])]),e("div",Sc,[e("div",jc,[c(e("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=u=>d.productForm.title=u),class:"form-control",id:"title",placeholder:"name@example.com"},null,512),[[_,d.productForm.title]]),Vc])]),e("div",Uc,[e("div",Bc,[c(e("select",{class:"form-select","onUpdate:modelValue":t[10]||(t[10]=u=>d.productForm.type=u),id:"type","aria-label":"Floating label select example"},[(l(!0),i(b,null,f(d.types,(u,y)=>(l(),i("option",{value:u.value},h(u.title),9,Oc))),256))],512),[[V,d.productForm.type]]),Ic])]),e("div",Tc,[e("div",Lc,[c(e("textarea",{class:"form-control","onUpdate:modelValue":t[11]||(t[11]=u=>d.productForm.description=u),placeholder:"Leave a comment here",id:"description"},null,512),[[_,d.productForm.description]]),Dc])]),e("div",qc,[e("div",Rc,[c(e("input",{type:"number","onUpdate:modelValue":t[12]||(t[12]=u=>d.productForm.current_price=u),class:"form-control",id:"current-price",placeholder:"name@example.com"},null,512),[[_,d.productForm.current_price]]),Mc])]),e("div",Gc,[e("div",zc,[c(e("input",{type:"number","onUpdate:modelValue":t[13]||(t[13]=u=>d.productForm.old_price=u),class:"form-control",id:"old-price",placeholder:"name@example.com"},null,512),[[_,d.productForm.old_price]]),Ec])]),e("div",Kc,[e("div",Nc,[e("div",xc,[e("h6",null,[m("Варианты товара "),d.productForm.variants?(l(),i("span",Ac,"("+h(d.productForm.variants.length)+")",1)):r("",!0)])]),e("div",Jc,[e("div",Wc,[e("div",Yc,[e("button",{type:"button",class:"btn btn-outline-info w-100",onClick:t[14]||(t[14]=(...u)=>n.addVariant&&n.addVariant(...u))},"Добавить вариант ")]),(l(!0),i(b,null,f(d.productForm.variants,(u,y)=>(l(),i("div",Hc,[e("div",Qc,[e("div",Xc,[e("div",Zc,[c(e("input",{type:"text","onUpdate:modelValue":F=>d.productForm.variants[y].key=F,class:"form-control",id:"variant-key-"+y,placeholder:"name@example.com",required:""},null,8,eu),[[_,d.productForm.variants[y].key]]),e("label",{for:"variant-key-"+y},"Ключ",8,tu)]),e("div",su,[c(e("input",{type:"text","onUpdate:modelValue":F=>d.productForm.variants[y].value=F,class:"form-control",id:"variant-value-"+y,placeholder:"name@example.com",required:""},null,8,ou),[[_,d.productForm.variants[y].value]]),e("label",{for:"variant-value-"+y},"Значение",8,lu)])]),e("div",iu,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:F=>n.removeVariant(y)},du,8,nu)])])]))),256))])])])]),e("div",ru,[e("div",cu,[uu,e("div",mu,[e("div",hu,[e("div",_u,[e("form",{onSubmit:t[16]||(t[16]=P((...u)=>n.addSection&&n.addSection(...u),["prevent"])),class:"input-group mb-3"},[c(e("input",{type:"text","onUpdate:modelValue":t[15]||(t[15]=u=>d.sectionForm.section=u),class:"form-control border-info",placeholder:"Название секции","aria-label":"Recipient's username","aria-describedby":"button-addon2",required:""},null,512),[[_,d.sectionForm.section]]),pu],32),(l(!0),i(b,null,f(d.sections,(u,y)=>(l(),i("span",bu,[m(h(u)+" ",1),e("strong",{onClick:F=>n.removeSection(y)},vu,8,gu)]))),256))])]),e("div",yu,[(l(!0),i(b,null,f(d.productForm.options,(u,y)=>(l(),i("div",$u,[e("div",ku,[e("div",Fu,[e("div",wu,[c(e("input",{type:"text","onUpdate:modelValue":F=>d.productForm.options[y].title=F,class:"form-control",id:"option-title-"+y,placeholder:"name@example.com"},null,8,Cu),[[_,d.productForm.options[y].title]]),e("label",{for:"option-title-"+y},"Название характеристики",8,Pu)]),e("div",Su,[c(e("input",{type:"text","onUpdate:modelValue":F=>d.productForm.options[y].value=F,class:"form-control",id:"option-value-"+y,placeholder:"name@example.com"},null,8,ju),[[_,d.productForm.options[y].value]]),e("label",{for:"option-value-"+y},"Значение характеристики",8,Vu)]),e("div",Uu,[c(e("select",{class:"form-select","onUpdate:modelValue":F=>d.productForm.options[y].section=F,id:"option-section-"+y,"aria-label":"Floating label select example"},[Ou,(l(!0),i(b,null,f(d.sections,F=>(l(),i("option",{value:F},h(F),9,Iu))),256))],8,Bu),[[V,d.productForm.options[y].section]]),e("label",{for:"option-section-"+y},"Секция товара",8,Tu)])]),e("div",Lu,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:F=>n.removeOption(y)},Ru,8,Du)])])]))),256))]),e("div",Mu,[e("div",Gu,[e("button",{type:"button",class:"btn btn-outline-info w-100",onClick:t[17]||(t[17]=(...u)=>n.addOption&&n.addOption(...u))},"Добавить характеристику ")])])])])]),e("div",zu,[Eu,e("div",Ku,[e("label",Nu,[xu,e("input",{type:"file",id:"location-photos",multiple:"",accept:"image/*",onChange:t[18]||(t[18]=(...u)=>n.onChangePhotos&&n.onChangePhotos(...u)),style:{display:"none"}},null,32)]),d.productForm.images?(l(!0),i(b,{key:0},f(d.productForm.images,(u,y)=>(l(),i("div",Au,[c(e("img",null,null,512),[[p,u]]),e("div",Ju,[e("a",{onClick:F=>n.removeImage(y)},"Удалить",8,Wu)])]))),256)):r("",!0),d.photos.length>0?(l(!0),i(b,{key:1},f(d.photos,(u,y)=>(l(),i("div",Yu,[c(e("img",null,null,512),[[p,n.getPhoto(u).imageUrl]]),e("div",Hu,[e("a",{onClick:F=>n.removePhoto(y)},"Удалить",8,Qu)])]))),256)):r("",!0)])]),Xu],32)])):r("",!0),d.tab===1?(l(),i("div",Zu," Отзывы ")):r("",!0)],64)}const tm=j(tc,[["render",em]]),sm={props:["item"],data(){return{bot:null}},methods:{preparedImgUrl(s){return s.toLocaleLowerCase().startsWith("https://")||s.toLocaleLowerCase().startsWith("http://")?s:"/images-by-bot-id/"+this.bot.id+"/"+s},removeProduct(){this.$store.dispatch("removeProduct",this.item.id).then(s=>{this.$notify({title:"Конструктор ботов",text:"Продукт успешно удален!",type:"success"})}).catch(s=>{})},duplicateProduct(){this.$store.dispatch("duplicateProduct",this.item.id).then(s=>{this.$notify({title:"Конструктор ботов",text:"Продукт успешно продублирован!",type:"success"})}).catch(s=>{})}},mounted(){this.bot=this.getCurrentBot},computed:{...C(["getCurrentBot"])}},om={key:0,class:"card"},lm={class:"card-header"},im={class:"card-body"},nm=["id"],am={class:"carousel-inner"},dm=["src"],rm=["data-bs-target"],cm=e("span",{class:"carousel-control-prev-icon","aria-hidden":"true"},null,-1),um=e("span",{class:"visually-hidden"},"Previous",-1),mm=[cm,um],hm=["data-bs-target"],_m=e("span",{class:"carousel-control-next-icon","aria-hidden":"true"},null,-1),pm=e("span",{class:"visually-hidden"},"Next",-1),bm=[_m,pm],gm={class:"card-footer d-flex justify-content-between"},fm=e("i",{class:"fa-regular fa-copy"},null,-1),vm=[fm],ym=e("i",{class:"fa-solid fa-trash-can"},null,-1),$m=[ym];function km(s,t,o,a,d,n){return d.bot?(l(),i("div",om,[e("div",lm,[e("p",null,"#"+h(o.item.id),1)]),e("div",im,[e("p",null,h(o.item.title),1),e("div",{id:"image-slider-"+o.item.id,class:"carousel slide","data-bs-ride":"carousel"},[e("div",am,[(l(!0),i(b,null,f(o.item.images,(p,u)=>(l(),i("div",{class:w(["carousel-item",{active:u===0}]),style:{height:"300px"}},[e("img",{src:n.preparedImgUrl(p),class:"d-block w-100 object-fit-cover",alt:"..."},null,8,dm)],2))),256))]),e("button",{class:"carousel-control-prev",type:"button","data-bs-target":"#image-slider-"+o.item.id,"data-bs-slide":"prev"},mm,8,rm),e("button",{class:"carousel-control-next",type:"button","data-bs-target":"#image-slider-"+o.item.id,"data-bs-slide":"next"},bm,8,hm)],8,nm)]),e("div",gm,[e("button",{title:"Дублировать товар",onClick:t[0]||(t[0]=(...p)=>n.duplicateProduct&&n.duplicateProduct(...p)),class:"btn btn-outline-info mr-1"},vm),e("button",{title:"Удалить товар",onClick:t[1]||(t[1]=(...p)=>n.removeProduct&&n.removeProduct(...p)),class:"btn btn-outline-danger"},$m)])])):r("",!0)}const Fm=j(sm,[["render",km]]),wm=e("button",{class:"btn btn-outline-info",type:"submit",id:"button-addon2"}," Найти ",-1),Cm={key:0},Pm={class:"row"},Sm={class:"col-4 mb-2"},jm={props:["bot"],data(){return{search:null,products:[],paginate:null}},computed:{...C(["getProducts","getProductsPaginateObject"]),filteredProducts(){return this.search?this.products.filter(s=>s.title.toLowerCase().trim().indexOf(this.search.toLowerCase().trim())>=0):this.products}},mounted(){this.loadProducts()},methods:{selectProduct(s){this.$emit("select",s)},nextProducts(s){this.loadProducts(s)},loadProducts(s=0){return this.$store.dispatch("loadProducts",{dataObject:{bot_id:this.bot.id,search:this.search},page:s}).then(()=>{this.products=this.getProducts,this.paginate=this.getProductsPaginateObject})}}},Vm=Object.assign(jm,{__name:"ProductList",setup(s){return(t,o)=>(l(),i(b,null,[e("form",{class:"input-group mb-3",onSubmit:o[1]||(o[1]=P(a=>t.loadProducts(0),["prevent"]))},[c(e("input",{type:"text",class:"form-control border-info",placeholder:"Поиск товара","aria-label":"Поиск товара","onUpdate:modelValue":o[0]||(o[0]=a=>t.search=a),"aria-describedby":"button-addon2",required:""},null,512),[[_,t.search]]),wm],32),e("p",null,[m("Всего товаров: "),t.paginate?(l(),i("span",Cm,h(t.paginate.meta.total||0),1)):r("",!0)]),e("div",Pm,[(l(!0),i(b,null,f(t.filteredProducts,(a,d)=>(l(),i("div",Sm,[v(Fm,{onClick:n=>t.selectProduct(a),item:a},null,8,["onClick","item"])]))),256))]),t.paginate?(l(),$(S,{key:0,onPagination_page:t.nextProducts,pagination:t.paginate},null,8,["onPagination_page","pagination"])):r("",!0)],64))}}),Um={class:"card mb-2"},Bm=e("div",{class:"card-header"},[e("h6",null,"Управление магазином")],-1),Om={class:"card-body"},Im={key:0,class:"row"},Tm={class:"col-12"},Lm={class:"input-group mb-3"},Dm=["disabled"],qm={key:0,class:"alert alert-primary",role:"alert"},Rm={key:1,class:"alert alert-primary",role:"alert"},Mm=["href"],Gm={class:"row mb-3"},zm={class:"col-md-3"},Em=q('<div class="col-md-3"><button class="btn btn-outline-info w-100">Экспорт в XLS</button></div><div class="col-md-3"><button class="btn btn-outline-info w-100">Импорт из XLS</button></div><div class="col-md-3"><button class="btn btn-outline-danger w-100">Удалить товары</button></div>',3),Km=e("div",{class:"row"},[e("div",{class:"col-md-3"},[e("button",{class:"btn btn-outline-info w-100"},"Экспортировать заказы")])],-1),Nm={class:"card"},xm=e("div",{class:"card-header"},[e("h6",null,"Работа с товаром")],-1),Am={class:"card-body"},Jm={class:"card mt-2"},Wm={class:"card-body"},Ym={data(){return{load:!1,tab:0,url:null,link:null,bot:null,selectedProduct:null}},computed:{...C(["getCurrentBot"])},mounted(){this.bot=this.getCurrentBot},methods:{refresh(){this.load=!0,this.selectedProduct=null,this.$nextTick(()=>{this.load=!1})},selectProduct(s){this.load=!0,this.$nextTick(()=>{this.selectedProduct=s,this.load=!1}),console.log(s)},updateProducts(){this.load=!0,this.$store.dispatch("updateProductsFromVk",{dataObject:{botDomain:this.getCurrentBot.bot_domain}}).then(s=>{console.log(s),this.link=s.data.url,this.load=!1,this.url=null}).catch(()=>{this.load=!1})}}},Hm=Object.assign(Ym,{__name:"Shop",setup(s){return(t,o)=>(l(),i(b,null,[e("div",Um,[Bm,e("div",Om,[t.tab===1?(l(),i("div",Im,[e("div",Tm,[e("form",{onSubmit:o[0]||(o[0]=P((...a)=>t.updateProducts&&t.updateProducts(...a),["prevent"]))},[e("div",Lm,[e("button",{disabled:t.load,class:"btn btn-outline-secondary",type:"sub,it",id:"button-addon2"},"Обновить товары ",8,Dm)])],32),t.load?(l(),i("div",qm," Внимание! Идет подготовка ссылки для вашей авторизации в ВК ")):r("",!0),t.link?(l(),i("div",Rm,[m(" Для обновления товаров из ВК нажмие на эту кнопку "),e("a",{class:"btn btn-link",href:t.link,target:"_blank"},"ТЫЦ",8,Mm)])):r("",!0)])])):r("",!0),e("div",Gm,[e("div",zm,[e("button",{type:"button",onClick:o[1]||(o[1]=a=>t.tab=1),class:w([{"btn-info text-white":t.tab===1},"btn btn-outline-info w-100"])},"Обновить товар из ВК ",2)]),Em]),Km])]),e("div",Nm,[xm,e("div",Am,[t.bot&&!t.load?(l(),$(tm,{key:0,bot:t.bot,item:t.selectedProduct,onRefresh:t.refresh},null,8,["bot","item","onRefresh"])):r("",!0)])]),e("div",Jm,[e("div",Wm,[t.bot&&!t.load?(l(),$(Vm,{key:0,bot:t.bot,onSelect:t.selectProduct},null,8,["bot","onSelect"])):r("",!0)])])],64))}}),Qm={props:["data"],data(){return{hasConnect:!1,bot:null,amoForm:{client_id:null,client_secret:null,auth_code:null,redirect_uri:null,subdomain:null,bot_id:null}}},computed:{...C(["getCurrentBot"])},mounted(){this.bot=this.getCurrentBot,this.data?this.$nextTick(()=>{this.amoForm.client_id=this.data.client_id||null,this.amoForm.client_secret=this.data.client_secret||null,this.amoForm.auth_code=this.data.auth_code||null,this.amoForm.redirect_uri=this.data.redirect_uri||null,this.amoForm.subdomain=this.data.subdomain||null,this.amoForm.bot_id=this.data.bot_id||this.bot.id||null}):this.amoForm.bot_id=this.bot.id||null},methods:{submitAmo(){let s=new FormData;Object.keys(this.amoForm).forEach(t=>{const o=this.amoForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.$store.dispatch("saveAmoCRM",{amoForm:s}).then(t=>{this.$notify("Данные CRM успешно сохранены")}).catch(t=>{})}}},Xm=e("div",{class:"col-12"},[e("p",null,[e("a",{target:"_blank",href:"https://www.amocrm.ru/developers/content/oauth/step-by-step"},"Документация для разработчика "),m(" по шагам")])],-1),Zm={class:"col-md-6 col-12 mb-2"},eh={class:"form-label",id:"client_id"},th=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),sh=e("div",null,"ID интеграции",-1),oh=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),lh={class:"col-md-6 col-12 mb-2"},ih={class:"form-label",id:"client_secret"},nh=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),ah=e("div",null,"Секрет интеграции",-1),dh=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),rh={class:"col-md-6 mb-2"},ch={class:"form-label",id:"auth_code"},uh=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),mh=e("div",null,"Полученный код авторизации",-1),hh=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),_h={class:"col-md-6 col-12 mb-2"},ph={class:"form-label",id:"subdomain2"},bh=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),gh=e("div",null,"Ваш поддомен в системе AMO CRM",-1),fh=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),vh=e("div",{class:"col-md-12 col-12"},[e("button",{type:"submit",class:"btn btn-outline-primary p-3 w-100"},[e("i",{class:"fa-solid fa-cloud-arrow-down mr-1"}),m(" Сохранить настройку AMO ")])],-1);function yh(s,t,o,a,d,n){const p=O("Popper");return l(),i("form",{onSubmit:t[4]||(t[4]=P((...u)=>n.submitAmo&&n.submitAmo(...u),["prevent"])),class:"row"},[Xm,e("div",Zm,[e("label",eh,[v(p,null,{content:g(()=>[sh]),default:g(()=>[th]),_:1}),m(" client_id "),oh]),c(e("input",{type:"text",class:"form-control",placeholder:"client_id","aria-label":"client_id","onUpdate:modelValue":t[0]||(t[0]=u=>d.amoForm.client_id=u),"aria-describedby":"client_id"},null,512),[[_,d.amoForm.client_id]])]),e("div",lh,[e("label",ih,[v(p,null,{content:g(()=>[ah]),default:g(()=>[nh]),_:1}),m(" client_secret "),dh]),c(e("input",{type:"text",class:"form-control",placeholder:"client_secret","aria-label":"client_secret","onUpdate:modelValue":t[1]||(t[1]=u=>d.amoForm.client_secret=u),"aria-describedby":"client_secret"},null,512),[[_,d.amoForm.client_secret]])]),e("div",rh,[e("label",ch,[v(p,null,{content:g(()=>[mh]),default:g(()=>[uh]),_:1}),m(" auth_code "),hh]),c(e("textarea",{class:"form-control",placeholder:"auth_code","aria-label":"auth_code","onUpdate:modelValue":t[2]||(t[2]=u=>d.amoForm.auth_code=u),"aria-describedby":"auth_code"},`
                                    `,512),[[_,d.amoForm.auth_code]])]),e("div",_h,[e("label",ph,[v(p,null,{content:g(()=>[gh]),default:g(()=>[bh]),_:1}),m(" subdomain "),fh]),c(e("input",{type:"text",class:"form-control",placeholder:"subdomain","aria-label":"subdomain","onUpdate:modelValue":t[3]||(t[3]=u=>d.amoForm.subdomain=u),"aria-describedby":"subdomain"},null,512),[[_,d.amoForm.subdomain]])]),vh],32)}const $h=j(Qm,[["render",yh]]);const kh={key:0,class:"row"},Fh={class:"col-12"},wh={key:1,class:"row mb-3 bot-sub-menu"},Ch={class:"col-12"},Ph={class:"btn-group",role:"group","aria-label":"Basic outlined example"},Sh=e("i",{class:"fa-solid fa-info mr-1"},null,-1),jh=e("i",{class:"fa-regular fa-newspaper mr-2"},null,-1),Vh=["disabled"],Uh=e("i",{class:"fa-solid fa-file mr-2"},null,-1),Bh=e("i",{class:"fa-solid fa-list-check mr-2"},null,-1),Oh=e("i",{class:"fa-brands fa-shopify mr-2"},null,-1),Ih={class:"dropdown"},Th=["disabled"],Lh=e("i",{class:"fa-solid fa-bars"},null,-1),Dh=[Lh],qh={class:"dropdown-menu","aria-labelledby":"dropdownMenuLink"},Rh={key:0},Mh={key:0,class:"row"},Gh={class:"col-12"},zh={class:"card border-success mb-3 mt-3"},Eh={class:"card-body"},Kh={class:"form-label",id:"bot-level-2"},Nh=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),xh=e("div",null,[m("Ваш бот будет 1 в 1 как в шаблоне!"),e("br"),m("Потом можно исправить названия кнопок в меню. ")],-1),Ah=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Jh=["value"],Wh={class:"row"},Yh={class:"col-md-12 col-12"},Hh={class:"form-check mb-3"},Qh=["value"],Xh=e("label",{class:"form-check-label",for:"bot-is-template"}," Сделать шаблоном ",-1),Zh={key:0,class:"col-md-12 col-12"},e_={class:"mb-3"},t_={class:"form-label",id:"bot-template-description"},s_=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),o_=e("div",null,"Если Вы создаете шаблон, а не реального бота ",-1),l_=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),i_={class:"row"},n_=e("div",{class:"col-12"},[e("p",null,[m("Для создания бота в Телеграм воспользуйтесь "),e("a",{href:"https://telegra.ph/Sozdanie-telegram-bota-06-12",target:"_blank"},"инструкцией")])],-1),a_={class:"col-12"},d_={class:"mb-3"},r_={class:"form-label",id:"bot-domain"},c_=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),u_=e("div",null,'Строго взять из BotFather! ТО что при создании с окончанием на "bot"',-1),m_=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),h_={key:0},__=["href"],p_={class:"col-md-6 col-12"},b_={class:"mb-3"},g_={class:"form-label d-flex justify-content-between",id:"bot-token"},f_=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),v_=e("div",null,"Взять из BotFater при создании бота! Длинная нечитаемая подсвеченная строка! ",-1),y_=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),$_=e("a",{href:"https://t.me/botfather",target:"_blank"},"Создать нового бота в ТГ",-1),k_={class:"col-md-6 col-12"},F_={class:"mb-3"},w_=e("label",{class:"form-label",id:"bot-token-dev"},"Токен бота (для тестирования)",-1),C_={class:"col-md-6 col-12"},P_={class:"mb-3"},S_={class:"d-flex justify-content-between align-items-center"},j_={class:"form-label d-flex justify-content-between",id:"bot-order-channel"},V_=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),U_=e("div",null,"Ввести адрес ссылки на канал в форму после добавления тоукена ",-1),B_=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),O_={class:"col-md-6 col-12"},I_={class:"mb-3"},T_={class:"d-flex justify-content-between"},L_=e("label",{class:"form-label",id:"bot-main-channel"},"Канал для постов (id,рекламный)",-1),D_={class:"col-12 mb-2"},q_={class:"form-check"},R_=e("label",{class:"form-check-label",for:"need-payments"}," Необходимо добавить рассылку по топикам для канала заказов (он же системный канал) ",-1),M_={key:0,class:"col-12 mb-2"},G_=e("p",null,'Для того, чтоб узнать идентификатор топика в группе впишите в чат "Мой id"',-1),z_={class:"list-group"},E_={class:"list-group-item"},K_={class:"mb-0"},N_=["onUpdate:modelValue"],x_={key:1,class:"row"},A_={class:"col-12"},J_={class:"mb-3"},W_={class:"d-flex justify-content-between"},Y_={class:"form-label",id:"bot-description"},H_=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Q_=e("div",null,"Отобразится пользователю при первом запуске",-1),X_=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Z_={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},ep={class:"col-12"},tp={class:"mb-3"},sp={class:"d-flex justify-content-between"},op={class:"form-label",id:"bot-description"},lp=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),ip=e("div",null,'Для меню "О Боте"',-1),np=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),ap={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},dp={class:"col-12"},rp={class:"mb-3"},cp={class:"d-flex justify-content-between"},up={class:"form-label",id:"bot-maintenance-message"},mp=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),hp={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},_p={class:"col-md-6 col-12"},pp={class:"mb-3"},bp={class:"form-label",id:"bot-balance"},gp=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),fp=e("div",null,"Начальная сумма денег на счету у конкретного бота",-1),vp=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),yp={class:"col-md-6 col-12"},$p={class:"mb-3"},kp={class:"form-label",id:"bot-tax-per-day"},Fp=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),wp=e("div",null,"Сумма списания денег за сутки работы бота (тариф)",-1),Cp=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Pp={class:"col-md-6 col-12"},Sp={class:"mb-3"},jp=e("label",{class:"form-label",id:"bot-level-1"},[m(" Уровень 1 CashBack, % "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),Vp={class:"col-md-6 col-12"},Up={class:"mb-3"},Bp=e("label",{class:"form-label",id:"bot-level-2"},"Уровень 2 CashBack, %",-1),Op={class:"col-md-6 col-12"},Ip={class:"mb-3"},Tp=e("label",{class:"form-label",id:"bot-level-3"},"Уровень 3 CashBack, %",-1),Lp={class:"col-md-12 col-12 mb-2"},Dp={class:"card border-warning"},qp={class:"card-body"},Rp={class:"form-group"},Mp=e("label",{class:"form-check-label",for:"warning-rules"},[e("i",{class:"fa-solid fa-triangle-exclamation text-danger"}),m(" Правила критических оповещений ")],-1),Gp=e("option",{value:null},"Не выбрано",-1),zp=["value"],Ep={class:"card my-2 p-2"},Kp={class:"row"},Np={class:"col-md-4 d-flex align-items-center"},xp={class:"m-0"},Ap={class:"col-md-2"},Jp={class:"form-check"},Wp=["onUpdate:modelValue","id"],Yp=["for"],Hp={key:0},Qp={key:1},Xp={class:"col-md-5"},Zp=["onUpdate:modelValue"],eb={class:"col-md-1 d-flex justify-content-center"},tb=["onClick"],sb=e("i",{class:"fa-solid fa-trash-can"},null,-1),ob=[sb],lb={class:"col-12 mb-2"},ib={class:"form-check"},nb=e("label",{class:"form-check-label",for:"need-payments"}," Необходимо подключить платежную систему ",-1),ab={key:0,class:"col-md-12 col-12"},db={class:"form-check mb-3"},rb=["value"],cb=e("label",{class:"form-check-label",for:"bot-auto-cashback-on-payments"}," Начислять CashBack автоматически после успешной оплаты ",-1),ub={class:"mb-3"},mb=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),hb=e("div",null,"Если в боте планируется оплата, то необходимо через BotFather привязать нужную платежную систему и указать в данном поле полученный токен ",-1),_b=e("label",{class:"form-label",id:"bot-level-3"},[m("Токен платежной системы "),e("a",{href:"https://t.me/botfather",target:"_blank"},"Подключить")],-1),pb={class:"col-12 mb-2"},bb={class:"form-check"},gb=e("label",{class:"form-check-label",for:"need-shop"}," Необходимо интегрировать магазин в бота ",-1),fb={key:1,class:"col-md-12 col-12"},vb={class:"mb-3"},yb=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),$b=e("div",null,"Ссылка на страницу ВК с товарами для вашего магазина в боте ",-1),kb=e("label",{class:"form-label",id:"bot-level-3"},[m("Ссылка на группу ВК с товарами "),e("a",{href:"https://vk.com/groups?w=groups_create",target:"_blank"},"Создать")],-1),Fb={class:"col-md-12 col-12"},wb={class:"mb-3"},Cb=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Pb=e("div",null,"Ссылка на внешний сервис обработки данных ",-1),Sb=e("label",{class:"form-label",id:"callback_link"},"Ссылка на внешний сервис обработки данных ",-1),jb={class:"col-12"},Vb={class:"card mb-3"},Ub=e("div",{class:"card-header"},[e("h6",null,[m("Информационная ссылка: создайте контент в "),e("a",{target:"_blank",href:"https://telegra.ph"},"https://telegra.ph")])],-1),Bb={class:"card-body"},Ob=e("div",{class:"row"},[e("div",{class:"col-12"},[e("h6",null,"Ссылка")])],-1),Ib={class:"row"},Tb={class:"col-12"},Lb={class:"mb-3"},Db={class:"col-12"},qb={class:"card mb-3"},Rb=e("div",{class:"card-header"},[e("h6",null,"Ссылки на соц. сети")],-1),Mb={class:"card-body"},Gb=e("div",{class:"row"},[e("div",{class:"col-12"},[e("h6",null,"Ссылка")])],-1),zb={class:"col-5"},Eb={class:"mb-3"},Kb=["onUpdate:modelValue","aria-describedby"],Nb={class:"col-5"},xb={class:"mb-3"},Ab=["onUpdate:modelValue","aria-describedby"],Jb={class:"col-2"},Wb=["onClick"],Yb=e("i",{class:"fa-regular fa-trash-can"},null,-1),Hb=[Yb],Qb={class:"row"},Xb={class:"col-12"},Zb={class:"col-12 mb-3"},eg=e("h6",null,[m("Аватар для бота "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),tg={class:"photo-preview d-flex justify-content-start flex-wrap w-100"},sg={for:"bot-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},og=e("span",null,"+",-1),lg={class:"mb-2 img-preview",style:{"margin-right":"10px"}},ig={class:"remove"},ng=["onClick"],ag=e("i",{class:"fa-regular fa-trash-can"},null,-1),dg=[ag],rg={key:1,class:"mb-2 img-preview",style:{"margin-right":"10px"}},cg={class:"remove"},ug=e("i",{class:"fa-regular fa-trash-can"},null,-1),mg=[ug],hg={class:"row"},_g={class:"col-12"},pg=["disabled"],bg={key:0},gg={key:1},fg={key:1},vg={key:2},yg={key:3},$g={key:4},kg={key:5},Fg={key:6},wg={key:7},Cg={key:8,class:"row"},Pg={key:0,class:"col-12 col-md-8"},Sg={key:1,class:"col-12 col-md-4"},jg={key:9},Vg={props:["company","bot","editor"],data(){return{selected_warning:null,page:null,step:0,templates:[],load:!1,loadPage:!1,loadPageList:!1,need_threads:!1,need_payments:!1,need_shop:!1,command:null,warnings:[{title:"Сумма чека больше чем",key:"bill_sum_more_then"},{title:"Сумма начисления кэшбэка больше чем",key:"cashback_up_sum_more_then"},{title:"Сумма списания кэшбэка больше чем",key:"cashback_down_sum_more_then"}],botForm:{is_template:!1,auto_cashback_on_payments:!1,template_description:null,bot_domain:null,bot_token:null,bot_token_dev:null,order_channel:null,message_threads:null,main_channel:null,vk_shop_link:null,callback_link:null,balance:null,tax_per_day:null,welcome_message:null,image:null,description:null,info_link:null,social_links:[],maintenance_message:null,payment_provider_token:null,level_1:10,level_2:0,level_3:0,photos:[],selected_bot_template_id:null,pages:[],amo:null,warnings:[]}}},watch:{need_threads:function(s,t){let o=[{title:"Отзывы",key:"reviews",value:null},{title:"Начисление cashback",key:"cashback",value:null},{title:"Вопросы",key:"questions",value:null},{title:"Конкурсы",key:"actions",value:null},{title:"Заказы",key:"orders",value:null},{title:"Вывод средств",key:"ask-money",value:null}];this.need_threads&&!this.botForm.message_threads&&(this.botForm.message_threads=o),this.need_threads&&this.botForm.message_threads&&o.forEach(a=>{this.botForm.message_threads.findIndex(n=>n.key===a.key)===-1&&this.botForm.message_threads.push(a)})},need_payments:function(s,t){this.need_payments||(this.botForm.auto_cashback_on_payments=!1)},"botForm.selected_bot_template_id":function(s,t){this.botForm.selected_bot_template_id!=null&&(this.loadSlugsByBotTemplate(this.botForm.selected_bot_template_id),this.loadPagesByBotTemplate(this.botForm.selected_bot_template_id))}},computed:{...C(["getSlugs"]),filteredWarnings(){return this.botForm.warnings.length===0?this.warnings:this.warnings.filter(s=>!(this.botForm.warnings.findIndex(t=>t.rule_key===s.key)>=0))}},mounted(){this.loadBotTemplates(),this.bot&&this.$nextTick(()=>{this.botForm={id:this.bot.id||null,is_template:this.bot.is_template||!1,auto_cashback_on_payments:this.bot.auto_cashback_on_payments||!1,template_description:this.bot.template_description||null,bot_domain:this.bot.bot_domain||null,bot_token:this.bot.bot_token||null,bot_token_dev:this.bot.bot_token_dev||null,order_channel:this.bot.order_channel||null,message_threads:this.bot.message_threads||null,main_channel:this.bot.main_channel||null,balance:this.bot.balance||null,tax_per_day:this.bot.tax_per_day||null,vk_shop_link:this.bot.vk_shop_link||null,callback_link:this.bot.callback_link||null,image:this.bot.image||null,description:this.bot.description||null,info_link:this.bot.info_link||null,social_links:this.bot.social_links||[],maintenance_message:this.bot.maintenance_message||null,welcome_message:this.bot.welcome_message||null,payment_provider_token:this.bot.payment_provider_token||null,level_1:this.bot.level_1||10,level_2:this.bot.level_2||0,level_3:this.bot.level_3||0,photos:this.bot.photos||[],warnings:this.bot.warnings||[],amo:this.bot.amo||null},this.botForm.message_threads&&(this.need_threads=!0),this.botForm.payment_provider_token&&(this.need_payments=!0)})},methods:{addTextTo(s={param:null,text:null}){this.botForm[s.param]=s.text},loadSlugsByBotTemplate(s){this.load=!0,this.$store.dispatch("loadSlugs",{dataObject:{botId:s},size:1e3}).then(t=>{this.botForm.slugs=this.getSlugs,this.$nextTick(()=>{this.load=!1})})},loadPagesByBotTemplate(s){this.$store.dispatch("loadBotPages",{botId:s}).then(t=>{this.botForm.pages=t})},loadBotTemplates(){this.$store.dispatch("loadTemplates").then(s=>{this.templates=s.data})},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},onChangePhotos(s){const t=s.target.files;this.botForm.image=null;for(let o=0;o<t.length;o++)this.botForm.photos.push(t[o])},addItem(s){this.botForm[s].push("")},addSocialLinks(){this.botForm.social_links.push({title:null,url:null})},removeItem(s,t){this.botForm[s].splice(t,1)},removePhoto(s){s?this.botForm.photos.splice(s,1):this.botForm.image=null},addBot(){let s=new FormData;Object.keys(this.botForm).forEach(t=>{const o=this.botForm[t]||"";typeof o=="object"?s.append(t,JSON.stringify(o)):s.append(t,o)}),this.company&&s.append("company_id",this.company.id);for(let t=0;t<this.botForm.photos.length;t++)s.append("images[]",this.botForm.photos[t]);s.delete("photos"),this.$store.dispatch(this.bot==null?"createBot":"updateBot",{botForm:s}).then(t=>{this.$emit("callback",t.data),this.$notify({title:"Конструктор ботов",text:this.bot==null?"Бот успешно создан!":"Бот успешно обновлен!",type:"success"}),this.bot==null&&(this.botForm={is_template:!1,auto_cashback_on_payments:!1,template_description:null,bot_domain:null,bot_token:null,bot_token_dev:null,order_channel:null,message_threads:null,main_channel:null,balance:null,tax_per_day:null,callback_link:null,image:null,description:null,info_link:null,social_links:[],maintenance_message:null,payment_provider_token:null,level_1:10,level_2:0,level_3:0,photos:[],warnings:[],selected_bot_template_id:null,pages:[]})}).catch(t=>{})},pageListCallback(s){this.loadPage=!0,this.page=s,this.$nextTick(()=>{this.loadPage=!1})},getWarning(s){let t=this.warnings.find(o=>o.key===s);return t||{title:"Не найдено"}},removeWarning(s){this.botForm.warnings.splice(s,1)},addWarning(){const s=this.selected_warning;this.botForm.warnings.push({rule_key:s.key,rule_value:0,is_active:!0}),this.selected_warning=null},pageCallback(s){this.loadPageList=!0,this.$nextTick(()=>{this.loadPageList=!1})}}},y1=Object.assign(Vg,{__name:"BotForm",setup(s){return(t,o)=>{const a=O("Popper"),d=U("lazy");return l(),i(b,null,[s.company?(l(),i("div",kh,[e("div",Fh,[e("h6",null,"Создаем бот к компании "+h(s.company.title||"Не установлен"),1)])])):r("",!0),s.editor?(l(),i("div",wh,[e("div",Ch,[e("div",Ph,[e("button",{type:"button",class:w([{"btn-info text-white":t.step===0},"btn btn-outline-info"]),onClick:o[0]||(o[0]=n=>t.step=0)},[Sh,m(" Информация о боте ")],2),e("button",{type:"button",class:w([{"btn-info text-white":t.step===9},"btn btn-outline-info"]),onClick:o[1]||(o[1]=n=>t.step=9)},[jh,m(" Новостной канал ")],2),e("button",{type:"button",disabled:t.botForm.selected_bot_template_id===null,class:w([{"btn-info text-white":t.step===4},"btn btn-outline-info"]),onClick:o[2]||(o[2]=n=>t.step=4)},[Uh,m(" Страницы ")],10,Vh),e("button",{type:"button",class:w([{"btn-info text-white":t.step===7},"btn btn-outline-info"]),onClick:o[3]||(o[3]=n=>t.step=7)},[Bh,m(" AMO CRM ")],2),e("button",{type:"button",class:w([{"btn-info text-white":t.step===8},"btn btn-outline-info"]),onClick:o[4]||(o[4]=n=>t.step=8)},[Oh,m(" Магазин ")],2),e("div",Ih,[e("button",{type:"button",disabled:t.botForm.selected_bot_template_id===null,class:"btn btn-outline-info dropdown-toggle custom-group-dropdown-btn",href:"#",role:"button",id:"dropdownMenuLink","data-bs-toggle":"dropdown","aria-expanded":"false"},Dh,8,Th),e("ul",qh,[e("li",null,[e("a",{class:"dropdown-item",href:"#bot-image-menu",onClick:o[5]||(o[5]=n=>t.step=5)},"Меню заведения")]),e("li",null,[e("a",{class:"dropdown-item",href:"#bot-menu-template",onClick:o[6]||(o[6]=n=>t.step=1)},"Шаблон клавитатур бота")]),e("li",null,[e("a",{class:"dropdown-item",href:"#bot-slugs",onClick:o[7]||(o[7]=n=>t.step=2)},"Скрипты")]),e("li",null,[e("a",{class:"dropdown-item",href:"#bot-dialogs",onClick:o[8]||(o[8]=n=>t.step=6)},"Диалоги")]),e("li",null,[e("a",{class:"dropdown-item",href:"#bot-users",onClick:o[9]||(o[9]=n=>t.step=3)},"Пользователи")])])])])])])):r("",!0),e("form",{class:"pb-5 mb-5",onSubmit:o[39]||(o[39]=P((...n)=>t.addBot&&t.addBot(...n),["prevent"]))},[t.step===0?(l(),i("div",Rh,[t.templates.length>0&&s.bot==null?(l(),i("div",Mh,[e("div",Gh,[e("div",zh,[e("div",Eh,[e("label",Kh,[v(a,null,{content:g(()=>[xh]),default:g(()=>[Nh]),_:1}),m(" Выберите шаблон! "),Ah]),c(e("select",{class:"form-control","aria-label":"Шаблон бота","onUpdate:modelValue":o[10]||(o[10]=n=>t.botForm.selected_bot_template_id=n),"aria-describedby":"bot-level-2",required:""},[(l(!0),i(b,null,f(t.templates,(n,p)=>(l(),i("option",{value:n.id},h(n.template_description||n.bot_domain||"Не указано"),9,Jh))),256))],512),[[V,t.botForm.selected_bot_template_id]])])])])])):r("",!0),e("div",Wh,[e("div",Yh,[e("div",Hh,[c(e("input",{class:"form-check-input",type:"checkbox",value:t.botForm.is_template,"onUpdate:modelValue":o[11]||(o[11]=n=>t.botForm.is_template=n),id:"bot-is-template"},null,8,Qh),[[k,t.botForm.is_template]]),Xh])]),t.botForm.is_template?(l(),i("div",Zh,[e("div",e_,[e("label",t_,[v(a,null,{content:g(()=>[o_]),default:g(()=>[s_]),_:1}),m(" Название шаблона бота "),l_]),c(e("input",{type:"text",class:"form-control",placeholder:"Название \\ описание шаблона","aria-label":"Описание шаблона","onUpdate:modelValue":o[12]||(o[12]=n=>t.botForm.template_description=n),maxlength:"255","aria-describedby":"bot-template-description",required:""},null,512),[[_,t.botForm.template_description]])])])):r("",!0)]),e("div",i_,[n_,e("div",a_,[e("div",d_,[e("label",r_,[v(a,null,{content:g(()=>[u_]),default:g(()=>[c_]),_:1}),m(" Доменное имя бота из BotFather "),m_]),c(e("input",{type:"text",class:"form-control",placeholder:"Имя бота","aria-label":"Имя бота","onUpdate:modelValue":o[13]||(o[13]=n=>t.botForm.bot_domain=n),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[_,t.botForm.bot_domain]]),t.botForm.bot_domain?(l(),i("p",h_,[m("Проверить работу бота "),e("a",{href:"https://t.me/"+t.botForm.bot_domain,target:"_blank"},"@"+h(t.botForm.bot_domain),9,__)])):r("",!0)])]),e("div",p_,[e("div",b_,[e("label",g_,[e("div",null,[v(a,null,{content:g(()=>[v_]),default:g(()=>[f_]),_:1}),m(" Токен бота "),y_]),$_]),c(e("input",{type:"text",class:"form-control",placeholder:"Токен","aria-label":"Токен","onUpdate:modelValue":o[14]||(o[14]=n=>t.botForm.bot_token=n),maxlength:"255","aria-describedby":"bot-token",required:""},null,512),[[_,t.botForm.bot_token]])])]),e("div",k_,[e("div",F_,[w_,c(e("input",{type:"text",class:"form-control",placeholder:"Токен","aria-label":"Токен","onUpdate:modelValue":o[15]||(o[15]=n=>t.botForm.bot_token_dev=n),maxlength:"255","aria-describedby":"bot-token-dev"},null,512),[[_,t.botForm.bot_token_dev]])])]),e("div",C_,[e("div",P_,[e("div",S_,[e("label",j_,[e("div",null,[v(a,null,{content:g(()=>[U_]),default:g(()=>[V_]),_:1}),m(" Канал для заказов (id) "),B_])]),v(B,{token:t.botForm.bot_token,param:"order_channel",onCallback:t.addTextTo},null,8,["token","onCallback"])]),c(e("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":o[16]||(o[16]=n=>t.botForm.order_channel=n),maxlength:"255","aria-describedby":"bot-order-channel"},null,512),[[_,t.botForm.order_channel]])])]),e("div",O_,[e("div",I_,[e("div",T_,[L_,v(B,{token:t.botForm.bot_token,param:"main_channel",onCallback:t.addTextTo},null,8,["token","onCallback"])]),c(e("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":o[17]||(o[17]=n=>t.botForm.main_channel=n),maxlength:"255","aria-describedby":"bot-main-channel"},null,512),[[_,t.botForm.main_channel]])])]),e("div",D_,[e("div",q_,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[18]||(o[18]=n=>t.need_threads=n),type:"checkbox",id:"need-payments"},null,512),[[k,t.need_threads]]),R_])]),t.need_threads?(l(),i("div",M_,[G_,e("ul",z_,[(l(!0),i(b,null,f(t.botForm.message_threads,(n,p)=>(l(),i("li",E_,[e("p",K_,h(n.title)+" ("+h(n.key)+")",1),c(e("input",{type:"text",class:"form-control",placeholder:"Идентификатор топика","onUpdate:modelValue":u=>t.botForm.message_threads[p].value=u},null,8,N_),[[_,t.botForm.message_threads[p].value]])]))),256))])])):r("",!0)]),t.botForm.bot_token?(l(),i("div",x_,[e("div",A_,[e("div",J_,[e("div",W_,[e("label",Y_,[v(a,null,{content:g(()=>[Q_]),default:g(()=>[H_]),_:1}),m(" Приветственное сообщение "),X_,t.botForm.welcome_message?(l(),i("small",Z_," Длина текста "+h(t.botForm.welcome_message.length),1)):r("",!0)]),v(I,{param:"welcome_message",onCallback:t.addTextTo},null,8,["onCallback"])]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текстовое приветствие при запуске бота","aria-label":"Текстовое приветствие при запуске бота","onUpdate:modelValue":o[19]||(o[19]=n=>t.botForm.welcome_message=n),"aria-describedby":"bot-description",required:""},`
                    `,512),[[_,t.botForm.welcome_message]])])]),e("div",ep,[e("div",tp,[e("div",sp,[e("label",op,[v(a,null,{content:g(()=>[ip]),default:g(()=>[lp]),_:1}),m(" Описание бота "),np,t.botForm.description?(l(),i("small",ap," Длина текста "+h(t.botForm.description.length),1)):r("",!0)]),v(I,{param:"description",onCallback:t.addTextTo},null,8,["onCallback"])]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текстовое описание бота","aria-label":"Текстовое описание бота","onUpdate:modelValue":o[20]||(o[20]=n=>t.botForm.description=n),"aria-describedby":"bot-description",required:""},`
                    `,512),[[_,t.botForm.description]])])]),e("div",dp,[e("div",rp,[e("div",cp,[e("label",up,[m("Сообщение для режима тех. работ "),mp,t.botForm.maintenance_message?(l(),i("small",hp," Длина текста "+h(t.botForm.maintenance_message.length),1)):r("",!0)]),v(I,{param:"maintenance_message",onCallback:t.addTextTo},null,8,["onCallback"])]),c(e("textarea",{type:"text",class:"form-control",placeholder:"Текстовое сообщение","aria-label":"Текстовое сообщение","onUpdate:modelValue":o[21]||(o[21]=n=>t.botForm.maintenance_message=n),maxlength:"255","aria-describedby":"bot-maintenance-message",required:""},`
                    `,512),[[_,t.botForm.maintenance_message]])])]),e("div",_p,[e("div",pp,[e("label",bp,[v(a,null,{content:g(()=>[fp]),default:g(()=>[gp]),_:1}),m(" Баланс бота, руб "),vp]),c(e("input",{type:"number",class:"form-control",placeholder:"Баланс","aria-label":"Баланс","onUpdate:modelValue":o[22]||(o[22]=n=>t.botForm.balance=n),min:"0","aria-describedby":"bot-balance",required:""},null,512),[[_,t.botForm.balance]])])]),e("div",yp,[e("div",$p,[e("label",kp,[v(a,null,{content:g(()=>[wp]),default:g(()=>[Fp]),_:1}),m(" Списание за сутки, руб "),Cp]),c(e("input",{type:"number",class:"form-control",placeholder:"Списание","aria-label":"Списание","onUpdate:modelValue":o[23]||(o[23]=n=>t.botForm.tax_per_day=n),min:"0","aria-describedby":"bot-tax-per-day",required:""},null,512),[[_,t.botForm.tax_per_day]])])]),e("div",Pp,[e("div",Sp,[jp,c(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень CashBack","onUpdate:modelValue":o[24]||(o[24]=n=>t.botForm.level_1=n),max:"50",min:"0","aria-describedby":"bot-level-1",required:""},null,512),[[_,t.botForm.level_1]])])]),e("div",Vp,[e("div",Up,[Bp,c(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень CashBack","onUpdate:modelValue":o[25]||(o[25]=n=>t.botForm.level_2=n),max:"50",min:"0","aria-describedby":"bot-level-2"},null,512),[[_,t.botForm.level_2]])])]),e("div",Op,[e("div",Ip,[Tp,c(e("input",{type:"number",class:"form-control",placeholder:"%","aria-label":"уровень CashBack","onUpdate:modelValue":o[26]||(o[26]=n=>t.botForm.level_3=n),max:"50",min:"0","aria-describedby":"bot-level-3"},null,512),[[_,t.botForm.level_3]])])]),e("div",Lp,[e("div",Dp,[e("div",qp,[e("div",Rp,[Mp,c(e("select",{class:"form-control","onUpdate:modelValue":o[27]||(o[27]=n=>t.selected_warning=n),onChange:o[28]||(o[28]=(...n)=>t.addWarning&&t.addWarning(...n)),id:"warning-rules"},[Gp,(l(!0),i(b,null,f(t.filteredWarnings,n=>(l(),i("option",{value:n},h(n.title),9,zp))),256))],544),[[V,t.selected_warning]])]),(l(!0),i(b,null,f(t.botForm.warnings,(n,p)=>(l(),i("div",Ep,[e("div",Kp,[e("div",Np,[e("p",xp,h(t.getWarning(n.rule_key).title||"Не найдено"),1)]),e("div",Ap,[e("div",Jp,[c(e("input",{class:"form-check-input","onUpdate:modelValue":u=>t.botForm.warnings[p].is_active=u,type:"checkbox",id:"warning-is-active-"+p},null,8,Wp),[[k,t.botForm.warnings[p].is_active]]),e("label",{class:"form-check-label",for:"warning-is-active-"+p},[t.botForm.warnings[p].is_active?(l(),i("span",Hp,"Вкл")):(l(),i("span",Qp,"Выкл"))],8,Yp)])]),e("div",Xp,[c(e("input",{type:"number",class:"form-control",placeholder:"Значение","onUpdate:modelValue":u=>t.botForm.warnings[p].rule_value=u,min:"0","aria-describedby":"bot-level-3"},null,8,Zp),[[_,t.botForm.warnings[p].rule_value]])]),e("div",eb,[e("button",{onClick:u=>t.removeWarning(p),type:"button",class:"btn btn-outline-danger"},ob,8,tb)])])]))),256))])])]),e("div",lb,[e("div",ib,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[29]||(o[29]=n=>t.need_payments=n),type:"checkbox",id:"need-payments"},null,512),[[k,t.need_payments]]),nb])]),t.need_payments?(l(),i("div",ab,[e("div",db,[c(e("input",{class:"form-check-input",type:"checkbox",value:t.botForm.auto_cashback_on_payments,"onUpdate:modelValue":o[30]||(o[30]=n=>t.botForm.auto_cashback_on_payments=n),id:"bot-auto-cashback-on-payments"},null,8,rb),[[k,t.botForm.auto_cashback_on_payments]]),cb]),e("div",ub,[v(a,null,{content:g(()=>[hb]),default:g(()=>[mb]),_:1}),_b,c(e("input",{type:"text",class:"form-control",placeholder:"Токен","aria-label":"Токен","onUpdate:modelValue":o[31]||(o[31]=n=>t.botForm.payment_provider_token=n),"aria-describedby":"bot-level-3"},null,512),[[_,t.botForm.payment_provider_token]])])])):r("",!0),e("div",pb,[e("div",bb,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[32]||(o[32]=n=>t.need_shop=n),type:"checkbox",id:"need-shop"},null,512),[[k,t.need_shop]]),gb])]),t.need_shop?(l(),i("div",fb,[e("div",vb,[v(a,null,{content:g(()=>[$b]),default:g(()=>[yb]),_:1}),kb,c(e("input",{type:"url",class:"form-control",placeholder:"Ссылка на группу ВК","aria-label":"ссылка на группу ВК","onUpdate:modelValue":o[33]||(o[33]=n=>t.botForm.vk_shop_link=n),"aria-describedby":"vk_shop_link"},null,512),[[_,t.botForm.vk_shop_link]])])])):r("",!0),e("div",Fb,[e("div",wb,[v(a,null,{content:g(()=>[Pb]),default:g(()=>[Cb]),_:1}),Sb,c(e("input",{type:"url",class:"form-control",placeholder:"Ссылка на внешний сервис","aria-label":"ссылка на внешний сервис","onUpdate:modelValue":o[34]||(o[34]=n=>t.botForm.callback_link=n),"aria-describedby":"callback_link"},null,512),[[_,t.botForm.callback_link]])])]),e("div",jb,[e("div",Vb,[Ub,e("div",Bb,[Ob,e("div",Ib,[e("div",Tb,[e("div",Lb,[c(e("input",{type:"text",class:"form-control",placeholder:"Ссылка ресурс telegraph","aria-label":"Ссылка ресурс telegraph",maxlength:"255","onUpdate:modelValue":o[35]||(o[35]=n=>t.botForm.info_link=n),"aria-describedby":"bot-info-link"},null,512),[[_,t.botForm.info_link]])])])])])])]),e("div",Db,[e("div",qb,[Rb,e("div",Mb,[Gb,(l(!0),i(b,null,f(t.botForm.social_links,(n,p)=>(l(),i("div",{class:"row",key:"social-link"+p},[e("div",zb,[e("div",Eb,[c(e("input",{type:"text",class:"form-control",placeholder:"Название ссылки","aria-label":"Название ссылки",maxlength:"255","onUpdate:modelValue":u=>t.botForm.social_links[p].title=u,"aria-describedby":"bot-social-link-"+p,required:""},null,8,Kb),[[_,t.botForm.social_links[p].title]])])]),e("div",Nb,[e("div",xb,[c(e("input",{type:"text",class:"form-control",placeholder:"Ссылка на соц.сеть","aria-label":"Ссылка на соц.сеть",maxlength:"255","onUpdate:modelValue":u=>t.botForm.social_links[p].url=u,"aria-describedby":"bot-social-link-"+p,required:""},null,8,Ab),[[_,t.botForm.social_links[p].url]])])]),e("div",Jb,[e("button",{type:"button",onClick:u=>t.removeItem("social_links",p),class:"btn btn-outline-danger w-100"},Hb,8,Wb)])]))),128)),e("div",Qb,[e("div",Xb,[e("button",{type:"button",onClick:o[36]||(o[36]=n=>t.addSocialLinks()),class:"btn btn-outline-success w-100"},"Добавить еще ссылку ")])])])])]),e("div",Zb,[eg,e("div",tg,[e("label",sg,[og,e("input",{type:"file",id:"bot-photos",multiple:"",accept:"image/*",onChange:o[37]||(o[37]=(...n)=>t.onChangePhotos&&t.onChangePhotos(...n)),style:{display:"none"}},null,32)]),t.botForm.photos?(l(!0),i(b,{key:0},f(t.botForm.photos,(n,p)=>(l(),i("div",lg,[c(e("img",null,null,512),[[d,t.getPhoto(n).imageUrl]]),e("div",ig,[e("a",{onClick:u=>t.removePhoto(p)},dg,8,ng)])]))),256)):(l(),i("div",rg,[c(e("img",null,null,512),[[d,"/images-by-bot-id/"+s.bot.id+"/"+t.botForm.image]]),e("div",cg,[e("a",{onClick:o[38]||(o[38]=n=>t.removePhoto())},mg)])]))])])])):r("",!0),e("div",hg,[e("div",_g,[e("button",{disabled:!t.botForm.bot_token,type:"submit",class:"btn btn-success w-100 p-3"},[s.bot?(l(),i("span",gg,"Обновить бота")):(l(),i("span",bg,"Добавить бота"))],8,pg)])])])):r("",!0),t.step===7?(l(),i("div",fg,[t.load?r("",!0):(l(),$($h,{key:0,data:t.botForm.amo},null,8,["data"]))])):r("",!0),t.step===8?(l(),i("div",vg,[t.load?r("",!0):(l(),$(Hm,{key:0}))])):r("",!0),t.step===5?(l(),i("div",yg,[t.load?r("",!0):(l(),$(xd,{key:0}))])):r("",!0),t.step===1?(l(),i("div",$g,[t.load?r("",!0):(l(),$(L,{key:0,"select-mode":!1}))])):r("",!0),t.step===6?(l(),i("div",kg,[t.load?r("",!0):(l(),$(ec,{key:0}))])):r("",!0),t.step===2?(l(),i("div",Fg,[t.load?r("",!0):(l(),$(gt,{key:0}))])):r("",!0),t.step===3?(l(),i("div",wg,[t.load?r("",!0):(l(),$(It,{key:0}))])):r("",!0),t.step===4?(l(),i("div",Cg,[t.load?r("",!0):(l(),i("div",Pg,[t.loadPage?r("",!0):(l(),$(Xa,{key:0,page:t.page,onCallback:t.pageCallback},null,8,["page","onCallback"]))])),t.load?r("",!0):(l(),i("div",Sg,[t.loadPageList?r("",!0):(l(),$(D,{key:0,editor:!0,onCallback:t.pageListCallback},null,8,["onCallback"]))]))])):r("",!0),t.step===9?(l(),i("div",jg,[v(z)])):r("",!0)],32)],64)}}}),Ug={key:0},Bg={class:"row"},Og={class:"col-md-12 d-flex flex-column"},Ig={class:"d-flex"},Tg={class:"dropdown mr-2"},Lg=e("button",{class:"btn btn-outline-primary dropdown-toggle",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"}," Фильтры ",-1),Dg={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},qg=["onClick"],Rg={class:"input-group mb-3"},Mg={key:0,class:"mt-2"},Gg={class:"badge bg-info mr-1"},zg=["onClick"],Eg=e("i",{class:"fa-solid fa-xmark"},null,-1),Kg=[Eg],Ng={key:0,class:"row"},xg={class:"col-12 mb-3"},Ag={class:"list-group w-100"},Jg=["onClick"],Wg={key:0,class:"badge bg-info"},Yg=["onClick"],Hg=e("i",{class:"fa-regular fa-copy"},null,-1),Qg=[Hg],Xg=["onClick"],Zg=e("i",{class:"fa-solid fa-boxes-packing"},null,-1),e1=[Zg],t1=["onClick"],s1=e("i",{class:"fa-solid fa-box-open"},null,-1),o1=[s1],l1=["onClick"],i1=e("i",{class:"fa-solid fa-trash-can text-white"},null,-1),n1=[i1],a1={class:"col-12"},d1={key:1,class:"row"},r1=e("div",{class:"col-12"},[e("div",{class:"alert alert-warning",role:"alert"}," У выбранной компании нет созданных ботов! ")],-1),c1=[r1],u1={props:["companyId","editor"],data(){return{filters:[{name:"Активные",icon:"fa-brands fa-telegram",slug:"active"},{name:"Архивные",icon:"fa-solid fa-box-archive",slug:"archive"}],selectedFilters:[],show:!0,loading:!0,bots:[],search:null,bots_paginate_object:null}},computed:{...C(["getBots","getBotsPaginateObject","getCurrentCompany"]),filteredBots(){if(!this.bots)return[];if(this.selectedFilters.length===0&&this.search==null)return this.bots;if(this.selectedFilters.length===0&&this.search!=null)return this.bots.filter(t=>(t.bot_domain||"").trim().toLowerCase().indexOf(this.search.trim().toLowerCase())!==-1);let s=[];return this.selectedFilters.forEach(t=>{switch(t.slug){case"active":this.bots.filter(o=>o.deleted_at==null).forEach(o=>{s.push(o)});break;case"archive":this.bots.filter(o=>o.deleted_at!=null).forEach(o=>{s.push(o)});break}}),this.search==null?s:s.filter(t=>(t.bot_domain||"").trim().toLowerCase().indexOf(this.search.trim().toLowerCase())!==-1)}},mounted(){this.loadBots(),this.selectFilter("active")},methods:{duplicate(s){if(!this.getCurrentCompany){this.$notify("У Вас не выбран клиент!");return}this.$store.dispatch("duplicateBot",{dataObject:{bot_id:s,company_id:this.getCurrentCompany.id}}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно продублирован")})},addToArchive(s){this.$store.dispatch("removeBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен в архив")})},forceDelete(s){this.$store.dispatch("forceDeleteBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен из архива")})},extractFromArchive(s){this.$store.dispatch("restoreBot",{botId:s}).then(t=>{let o=this.bots_paginate_object.meta.current_page||0;this.loadBots(o),this.$notify("Указанный бот успешно перемещен из архива")})},selectFilter(s){let t=this.filters.find(o=>o.slug===s);t&&this.selectedFilters.filter(o=>o.slug===s).length===0&&this.selectedFilters.push(t)},removeSelectedFilter(s){let t=this.selectedFilters.findIndex(o=>o.slug===s);this.selectedFilters.splice(t,1)},selectBot(s){this.$emit("callback",s),this.show=!1,this.$notify("Вы выбрали бота из списка! Все остальные действия будут производится для этого бота.")},nextBots(s){this.loadBots(s)},loadBots(s=0){this.loading=!0,this.$store.dispatch("loadBots",{dataObject:{companyId:this.companyId||null,search:this.search},page:s}).then(t=>{this.loading=!1,this.bots=this.getBots,this.bots_paginate_object=this.getBotsPaginateObject}).catch(()=>{this.loading=!1})}}},$1=Object.assign(u1,{__name:"BotList",setup(s){return(t,o)=>t.show?(l(),i("div",Ug,[e("div",Bg,[e("div",Og,[e("div",Ig,[e("div",Tg,[Lg,e("ul",Dg,[(l(!0),i(b,null,f(t.filters,a=>(l(),i("li",null,[e("a",{class:"dropdown-item",onClick:d=>t.selectFilter(a.slug),href:"#filter"},[e("i",{class:w([a.icon,"mr-2"])},null,2),m(" "+h(a.name||"Не указано"),1)],8,qg)]))),256))])]),e("div",Rg,[c(e("input",{type:"search",class:"form-control",placeholder:"Поиск бота","aria-label":"Поиск бота","onUpdate:modelValue":o[0]||(o[0]=a=>t.search=a),"aria-describedby":"button-addon2"},null,512),[[_,t.search]]),e("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=(...a)=>t.loadBots&&t.loadBots(...a)),type:"button",id:"button-addon2"},"Найти ")])]),t.selectedFilters.length>0?(l(),i("p",Mg,[(l(!0),i(b,null,f(t.selectedFilters,a=>(l(),i("span",Gg,[m(h(a.name||"не указан")+" ",1),e("a",{onClick:d=>t.removeSelectedFilter(a.slug),class:"ml-1 text-white",href:"#filter"},Kg,8,zg)]))),256))])):r("",!0)])]),t.bots.length>0?(l(),i("div",Ng,[e("div",xg,[e("ul",Ag,[s.editor?r("",!0):(l(),i("li",{key:0,class:"list-group-item active cursor-pointer btn btn-outline-info",onClick:o[2]||(o[2]=a=>t.selectBot(null))},"Создать нового бота ")),(l(!0),i(b,null,f(t.filteredBots,(a,d)=>(l(),i("li",{class:w(["list-group-item cursor-pointer btn mb-1 d-flex align-items-center justify-between",{"btn-outline-info":a.deleted_at==null,"btn-outline-secondary border-secondary":a.deleted_at!=null}])},[e("strong",{onClick:n=>t.selectBot(a),style:{"word-wrap":"break-word"}},[e("i",{class:w([{"text-danger":a.deleted_at!=null},"fa-solid fa-robot mr-2"])},null,2),m(h(a.bot_domain||"Не указано"),1)],8,Jg),a.is_template?(l(),i("span",Wg,h(a.template_description||"Шаблон без названия"),1)):r("",!0),e("div",null,[e("button",{class:"btn btn-outline-info mr-2",type:"button",onClick:n=>t.duplicate(a.id),title:"Дублировать"},Qg,8,Yg),a.deleted_at==null?(l(),i("button",{key:0,class:"btn btn-outline-info",type:"button",onClick:n=>t.addToArchive(a.id),title:"В архив"},e1,8,Xg)):r("",!0),a.deleted_at!=null?(l(),i("button",{key:1,class:"btn btn-outline-info mr-2",onClick:n=>t.extractFromArchive(a.id),title:"Из архива"},o1,8,t1)):r("",!0),a.deleted_at!=null?(l(),i("button",{key:2,class:"btn btn-danger mr-2",onClick:n=>t.forceDelete(a.id),title:"Удалить на совсем"},n1,8,l1)):r("",!0)])],2))),256))])]),e("div",a1,[t.bots_paginate_object?(l(),$(S,{key:0,onPagination_page:t.nextBots,pagination:t.bots_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):(l(),i("div",d1,c1))])):r("",!0)}});export{xd as I,y1 as _,$1 as a,D as b,Xa as c,ec as d};
