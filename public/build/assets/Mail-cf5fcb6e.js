import{Y as S,q as n,t as r,v as e,A as h,H as u,Q as w,F as y,C as k,J as _,K as v,x as p,y as f,X as K,G as T,P as V,D as $,L as B,B as U}from"./index.es-77235f88.js";import{V as M,T as j}from"./TelegramChannelHelper-c9c5b03c.js";import{_ as q}from"./_plugin-vue_export-helper-c27b6911.js";import{v as F}from"./v4-a960c1f4.js";const O={props:["editedKeyboard","type"],components:{Vue3JsonEditor:M},computed:{uuid(){return F()}},watch:{keyboard:{handler:function(o){this.save()},deep:!0}},data(){return{editor:!1,showCode:!1,showAssign:!1,selectedRow:null,load:!1,rowCount:1,keyboard:[],select:{row:0,col:0,type:this.type||"reply"}}},mounted(){this.editedKeyboard&&this.$nextTick(()=>{this.keyboard=this.editedKeyboard.menu})},methods:{needRemoveField(o,t,s){Object.keys(this.keyboard[t][s]).forEach(i=>{i!=="text"&&i!==o&&delete this.keyboard[t][s][i]})},save(){this.$emit("save",this.keyboard)},onJsonChange(o){this.keyboard=o,this.save()},removeColFromRow(o){this.keyboard[o].length>1?this.keyboard[o].splice(this.keyboard[o].length-1,1):this.keyboard.splice(o,1),this.keyboard.length===0&&(this.selectedRow=null),this.save()},addRowAbove(){this.addRow(!0)},moveCol(o,t=0){o!==this.select.row&&(this.select.row=o,this.select.col=0,this.select.text=this.keyboard[this.select.row][this.select.col].text);let s=this.select.row,i=this.select.col,l=this.keyboard[s].length,c=t===0?i-1>=0?i-1:l-1:i<l-1?i+1:0,g=this.keyboard[s][i];this.keyboard[s][i]=this.keyboard[s][c],this.keyboard[s][c]=g,this.select.row=s,this.select.col=c,this.select.text=this.keyboard[s][c].text},moveRow(o=0){if(this.selectedRow==null)return;let t=this.keyboard.length,s=o===0?this.selectedRow-1>=0?this.selectedRow-1:t-1:this.selectedRow<t-1?this.selectedRow+1:0,i=this.keyboard[this.selectedRow];this.keyboard[this.selectedRow]=this.keyboard[s],this.keyboard[s]=i,this.selectedRow=s,console.log("tmpRow",i)},addRowBelow(){this.addRow(!1)},addRow(o=!1){if(this.selectedRow==null)this.keyboard?this.keyboard.push([{text:"No Text"}]):this.keyboard=[[{text:"No Text"}]],this.selectedRow=null;else{let t=o?this.selectedRow:this.selectedRow+1;this.keyboard.splice(t,0,[{text:"No Text"}])}this.save()},addColToRow(o){this.keyboard[o].push({text:"No Text"}),this.save()},selectIndex(o,t){this.selectedRow=o,this.select.row=o,this.select.col=t,this.select.text=this.keyboard[o][t].text||"",this.load=!0,this.$nextTick(()=>{this.load=!1})},removeCol(o,t){this.keyboard[o].length>1?this.keyboard[o].splice(t,1):this.keyboard.splice(1,1),this.save()}}},J={key:0,class:"container"},N={class:"row"},D={class:"col-12 d-flex justify-content-between"},E=e("i",{class:"fa-solid fa-arrows-up-to-line"},null,-1),A=[E],L=e("i",{class:"fa-solid fa-arrows-down-to-line"},null,-1),P=[L],z=e("i",{class:"fa-solid fa-xmark"},null,-1),G=[z],H={class:"d-flex flex-column"},Y={class:"form-check"},Q=["id"],X=["for"],W={class:"col-12"},Z={class:"row"},I={class:"col-2 d-flex justify-content-around p-2"},x=["onClick"],ee=e("i",{class:"fa-solid fa-plus"},null,-1),te=[ee],oe=["onClick"],se=e("i",{class:"fa-solid fa-minus"},null,-1),le=[se],ie=["onClick"],ne=e("i",{class:"fa-solid fa-caret-left"},null,-1),ae=[ne],de=["onClick"],re=e("i",{class:"fa-solid fa-caret-right"},null,-1),ce=[re],he={class:"col-10 d-flex justify-content-center p-1"},be={class:"btn-group dropdown-center w-100 m-1"},ue=["onClick","onUpdate:modelValue"],me=["data-bs-target"],_e=e("i",{class:"fa-solid fa-bars"},null,-1),ye=[_e],pe=["id"],fe={class:"modal-dialog"},ke={class:"modal-content"},ve={class:"modal-body"},ge={class:"px-4 py-3"},$e=e("div",{class:"alert alert-danger",role:"alert"}," Возможно выбрать только 1 тип действия ",-1),Ce={class:"mb-3"},we=["for"],Fe=["id","onUpdate:modelValue"],Re=e("hr",null,null,-1),Ke={class:"mb-3"},Te=["for"],Ve=["onChange","onUpdate:modelValue","id"],Se={class:"mb-3"},Be=["for"],Ue=["onChange","onUpdate:modelValue","id"],Me={class:"mb-3"},je=["for"],qe=["onChange","onUpdate:modelValue","id"],Oe={class:"mb-3"},Je=["for"],Ne=["onChange","onUpdate:modelValue","id"],De={class:"form-check"},Ee=["onChange","id"],Ae=["for"],Le={class:"form-check"},Pe=["onChange","onClick","id"],ze=["for"],Ge={class:"form-check"},He=["onChange","onClick","id"],Ye=["for"],Qe={key:0,class:"row"},Xe={class:"col-12"},We=e("label",{class:"form-label",id:"bot-domain"},"JSON-код клавиатуры",-1);function Ze(o,t,s,i,l,c){const g=S("Vue3JsonEditor");return l.editor?h("",!0):(n(),r("div",J,[e("div",N,[e("div",D,[e("div",null,[l.selectedRow==null?(n(),r("button",{key:0,type:"button",class:"btn btn-primary mb-2",onClick:t[0]||(t[0]=(...m)=>c.addRow&&c.addRow(...m))},"Добавить строку ")):h("",!0),l.selectedRow!=null?(n(),r("button",{key:1,type:"button",class:"btn btn-primary mb-2",onClick:t[1]||(t[1]=(...m)=>c.addRowAbove&&c.addRowAbove(...m))},"Добавить строку выше ")):h("",!0),l.selectedRow!=null?(n(),r("button",{key:2,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:t[2]||(t[2]=(...m)=>c.addRowBelow&&c.addRowBelow(...m))},"Добавить строку ниже ")):h("",!0),l.selectedRow!=null?(n(),r("button",{key:3,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:t[3]||(t[3]=m=>c.moveRow(0))},A)):h("",!0),l.selectedRow!=null?(n(),r("button",{key:4,type:"button",class:"btn btn-primary mb-2 ml-2",onClick:t[4]||(t[4]=m=>c.moveRow(1))},P)):h("",!0),l.selectedRow!=null?(n(),r("button",{key:5,type:"button",class:"btn btn-outline-danger mb-2 ml-2",onClick:t[5]||(t[5]=m=>l.selectedRow=null)},G)):h("",!0)]),e("div",H,[e("div",Y,[u(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=m=>l.showCode=m),id:"showCode"+c.uuid},null,8,Q),[[w,l.showCode]]),e("label",{class:"form-check-label",for:"showCode"+c.uuid}," Отобразить код ",8,X)])])]),e("div",W,[(n(!0),r(y,null,k(l.keyboard,(m,a)=>(n(),r("div",Z,[e("div",I,[e("button",{type:"button",class:"btn btn-link w-100",onClick:C=>c.addColToRow(a)},te,8,x),e("button",{type:"button",class:"btn btn-link w-100",onClick:C=>c.removeColFromRow(a)},le,8,oe),e("button",{type:"button",class:"btn btn-link w-100",onClick:C=>c.moveCol(a,0)},ae,8,ie),e("button",{type:"button",class:"btn btn-link w-100",onClick:C=>c.moveCol(a,1)},ce,8,de)]),e("div",he,[(n(!0),r(y,null,k(m,(C,d)=>(n(),r("div",be,[u(e("input",{type:"text",onClick:b=>c.selectIndex(a,d),class:"btn btn-outline-primary w-100","onUpdate:modelValue":b=>l.keyboard[a][d].text=b},null,8,ue),[[_,l.keyboard[a][d].text]]),e("button",{type:"button","data-bs-toggle":"modal","data-bs-target":"#button-menu-btn-row-"+a+"col-"+d,class:"btn btn-outline-primary","aria-expanded":"false","data-bs-reference":"parent"},ye,8,me),e("div",{class:"modal fade",id:"button-menu-btn-row-"+a+"col-"+d,tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[e("div",fe,[e("div",ke,[e("div",ve,[e("form",ge,[$e,e("div",Ce,[e("label",{for:"command-title-"+a+"-col-"+d,class:"form-label"},"Название кнопки",8,we),u(e("input",{type:"text",id:"command-title-"+a+"-col-"+d,class:"form-control w-100","onUpdate:modelValue":b=>l.keyboard[a][d].text=b},null,8,Fe),[[_,l.keyboard[a][d].text]])]),Re,e("div",Ke,[e("label",{for:"command-row-"+a+"-col-"+d,class:"form-label"},"Команда (для меню в сообщении)",8,Te),u(e("input",{type:"text",onChange:b=>c.needRemoveField("callback_data",a,d),"onUpdate:modelValue":b=>l.keyboard[a][d].callback_data=b,class:"form-control",id:"command-row-"+a+"-col-"+d,placeholder:"/start"},null,40,Ve),[[_,l.keyboard[a][d].callback_data]])]),e("div",Se,[e("label",{for:"switch-inline-query-row-"+a+"-col-"+d,class:"form-label"},"Ссылка на аккаунт в ТЕЛЕГРАММ",8,Be),u(e("input",{type:"text",class:"form-control",onChange:b=>c.needRemoveField("switch_inline_query",a,d),"onUpdate:modelValue":b=>l.keyboard[a][d].switch_inline_query=b,id:"switch-inline-query-row-"+a+"-col-"+d,placeholder:"@YourAccountLink"},null,40,Ue),[[_,l.keyboard[a][d].switch_inline_query]])]),e("div",Me,[e("label",{for:"url-row-"+a+"-col-"+d,class:"form-label"},"Внешняя URL-ссылка",8,je),u(e("input",{type:"text",class:"form-control",onChange:b=>c.needRemoveField("url",a,d),"onUpdate:modelValue":b=>l.keyboard[a][d].url=b,id:"url-row-"+a+"-col-"+d,placeholder:"https://t.me/example"},null,40,qe),[[_,l.keyboard[a][d].url]])]),e("div",Oe,[e("label",{for:"switch-inline-query-current-chat-row-"+a+"-col-"+d,class:"form-label"},"Команда всплывающего меню бота",8,Je),u(e("input",{type:"text",class:"form-control",onChange:b=>c.needRemoveField("switch_inline_query_current_chat",a,d),"onUpdate:modelValue":b=>l.keyboard[a][d].switch_inline_query_current_chat=b,id:"witch-inline-query-current-chat-row-"+a+"-col-"+d,placeholder:"команда"},null,40,Ne),[[_,l.keyboard[a][d].switch_inline_query_current_chat]])]),e("div",De,[e("input",{type:"radio",onChange:b=>c.needRemoveField(null,a,d),name:"request-radio",class:"form-check-input",id:"no-action-row-"+a+"-col-"+d},null,40,Ee),e("label",{class:"form-check-label",for:"no-action-row-"+a+"-col-"+d}," Без действий ",8,Ae)]),e("div",Le,[e("input",{type:"radio",onChange:b=>c.needRemoveField("request_contact",a,d),onClick:b=>l.keyboard[a][d].request_contact=!0,name:"request-radio",class:"form-check-input",id:"phone-row-"+a+"-col-"+d},null,40,Pe),e("label",{class:"form-check-label",for:"phone-row-"+a+"-col-"+d}," Запросить телефон (для нижнего меню) ",8,ze)]),e("div",Ge,[e("input",{type:"radio",name:"request-radio",onChange:b=>c.needRemoveField("request_location",a,d),onClick:b=>l.keyboard[a][d].request_location=!0,class:"form-check-input",id:"location-row-"+a+"-col-"+d},null,40,He),e("label",{class:"form-check-label",for:"location-row-"+a+"-col-"+d}," Запросить локацию (для нижнего меню) ",8,Ye)])])])])])],8,pe)]))),256))])]))),256))])]),l.showCode?(n(),r("div",Qe,[e("div",Xe,[We,l.load?h("",!0):(n(),v(g,{key:0,mode:"code",modelValue:l.keyboard,"onUpdate:modelValue":t[7]||(t[7]=m=>l.keyboard=m),"show-btns":!1,expandedOnStart:!0,onJsonChange:c.onJsonChange},null,8,["modelValue","onJsonChange"]))])])):h("",!0)]))}const R=q(O,[["render",Ze]]);const Ie={key:0,class:"card"},xe={key:0,class:"card-header d-flex justify-content-between align-items-center"},et=["disabled"],tt=e("i",{class:"fa-solid fa-arrow-left"},null,-1),ot=[tt],st=["disabled"],lt=e("i",{class:"fa-regular fa-pen-to-square"},null,-1),it=[lt],nt=["disabled"],at=e("i",{class:"fa-regular fa-floppy-disk"},null,-1),dt=[at],rt={key:1,class:"card-header d-flex justify-content-between align-items-center"},ct={class:"mr-2"},ht=["disabled"],bt=e("i",{class:"fa-regular fa-pen-to-square"},null,-1),ut=[bt],mt=["disabled"],_t=e("i",{class:"fa-regular fa-clone"},null,-1),yt=[_t],pt=["disabled"],ft=e("i",{class:"fa-regular fa-floppy-disk"},null,-1),kt=[ft],vt=["disabled"],gt=e("i",{class:"fa-solid fa-trash-can"},null,-1),$t=[gt],Ct={class:"card-body"},wt={key:0,class:"row"},Ft={class:"col-md-6 col-12"},Rt={class:"mb-3"},Kt=e("label",{class:"form-label",id:"bot-domain"},"Тип",-1),Tt=e("option",{value:"reply"},"Нижняя клавиатура",-1),Vt=e("option",{value:"inline"},"Встроенная клавиатура",-1),St=[Tt,Vt],Bt={class:"col-md-6 col-12"},Ut={class:"mb-3"},Mt=e("label",{class:"form-label",id:"bot-domain"},"Мнемоническое имя",-1),jt={class:"row"},qt={class:"col-12"},Ot={class:"row"},Jt={class:"col-12"},Nt={class:"row"},Dt={class:"col"},Et={type:"button",class:"btn btn-outline-primary w-100 mb-2"},At={key:1,class:"card"},Lt={class:"card-header d-flex justify-content-between align-items-center"},Pt=["disabled"],zt=e("i",{class:"fa-regular fa-floppy-disk"},null,-1),Gt=[zt],Ht={class:"card-body"},Yt={props:["keyboard","selectMode"],data:()=>({is_edited:!1,load:!1,keyboardForm:null}),computed:{uuid(){return F()}},watch:{keyboardForm:{handler(o){this.is_edited=!0},deep:!0}},mounted(){const o=this.keyboard;this.keyboardForm=o,this.$nextTick(()=>{this.is_edited=!1})},methods:{removeKeyboard(){this.$store.dispatch("removeKeyboardTemplate",{templateId:this.keyboardForm.id}).then(o=>{this.load=!0,this.$nextTick(()=>{this.load=!1}),this.$emit("callback",this.keyboardForm.id)}).catch(()=>{this.$emit("callback",this.keyboardForm.id)})},saveKeyboard(o){this.keyboardForm.menu=o},selectCard(){this.$emit("select",this.keyboardForm)},duplicateKeyboard(){let o=new FormData;Object.keys(this.keyboardForm).forEach(t=>{const s=this.keyboardForm[t]||"";typeof s=="object"?o.append(t,JSON.stringify(s)):o.append(t,s)}),this.$store.dispatch("createKeyboardTemplate",{keyboardForm:o}).then(t=>{this.$notify({title:"Конструктор ботов",text:"Меню успешно продублировано!",type:"success"}),this.load=!0,this.$nextTick(()=>{this.load=!1}),this.$emit("reload")})},updateKeyboard(){let o=new FormData;Object.keys(this.keyboardForm).forEach(t=>{const s=this.keyboardForm[t]||"";typeof s=="object"?o.append(t,JSON.stringify(s)):o.append(t,s)}),this.$store.dispatch("editKeyboardTemplate",{keyboardForm:o}).then(t=>{this.load=!0,this.$nextTick(()=>{this.load=!1,this.is_edited=!1}),this.$emit("callback")}).catch(()=>{this.is_edited=!0})}}},Qt=Object.assign(Yt,{__name:"KeyboardCard",setup(o){return(t,s)=>(n(),r(y,null,[t.is_edited?h("",!0):(n(),r("div",Ie,[o.selectMode?(n(),r("div",xe,[e("div",null,[e("button",{onClick:s[0]||(s[0]=(...i)=>t.selectCard&&t.selectCard(...i)),disabled:t.load,type:"button",class:"btn btn-outline-success mr-2"},ot,8,et),e("button",{onClick:s[1]||(s[1]=i=>t.is_edited=!0),disabled:t.load,type:"button",title:"Редактировать клавиатуру",class:"btn btn-outline-success mr-2"},it,8,st),e("button",{onClick:s[2]||(s[2]=(...i)=>t.updateKeyboard&&t.updateKeyboard(...i)),type:"button",title:"Обновить клавиатуру",disabled:t.load||!t.is_edited,class:p(["btn btn-outline-primary mr-2",{"have-change":t.is_edited}])},dt,10,nt)])])):h("",!0),o.selectMode?h("",!0):(n(),r("div",rt,[e("div",null,[e("strong",ct,"#"+f(o.keyboard.id),1),e("button",{onClick:s[3]||(s[3]=i=>t.is_edited=!0),disabled:t.load,type:"button",title:"Редактировать клавиатуру",class:"btn btn-outline-success mr-2"},ut,8,ht),e("button",{onClick:s[4]||(s[4]=(...i)=>t.duplicateKeyboard&&t.duplicateKeyboard(...i)),type:"button",title:"Дублировать клавиатуру",disabled:t.load,class:"btn btn-outline-primary mr-2"},yt,8,mt),e("button",{onClick:s[5]||(s[5]=(...i)=>t.updateKeyboard&&t.updateKeyboard(...i)),type:"button",title:"Обновить клавиатуру",disabled:t.load||!t.is_edited,class:p(["btn btn-outline-primary mr-2",{"have-change":t.is_edited}])},kt,10,pt)]),e("button",{onClick:s[6]||(s[6]=(...i)=>t.removeKeyboard&&t.removeKeyboard(...i)),type:"button",disabled:t.load,title:"Удалить клавиатуру",class:"btn btn-outline-danger mr-2"},$t,8,vt)])),e("div",Ct,[o.selectMode?h("",!0):(n(),r("div",wt,[e("div",Ft,[e("div",Rt,[Kt,u(e("select",{disabled:!0,"onUpdate:modelValue":s[7]||(s[7]=i=>o.keyboard.type=i),class:"form-control"},St,512),[[K,o.keyboard.type]])])]),e("div",Bt,[e("div",Ut,[Mt,u(e("input",{type:"text",class:"form-control",placeholder:"Мнемоническое имя",disabled:!0,"aria-label":"Мнемоническое имя","onUpdate:modelValue":s[8]||(s[8]=i=>o.keyboard.slug=i),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[_,o.keyboard.slug]])])])])),e("div",jt,[e("div",qt,[e("div",Ot,[e("div",Jt,[(n(!0),r(y,null,k(o.keyboard.menu,(i,l)=>(n(),r("div",Nt,[(n(!0),r(y,null,k(i,(c,g)=>(n(),r("div",Dt,[e("button",Et,f(c.text),1)]))),256))]))),256))])])])])])])),t.is_edited?(n(),r("div",At,[e("div",Lt,[e("button",{onClick:s[9]||(s[9]=(...i)=>t.updateKeyboard&&t.updateKeyboard(...i)),type:"button",title:"Обновить клавиатуру",disabled:t.load||!t.is_edited,class:p(["btn btn-outline-primary mr-2",{"have-change":t.is_edited}])},Gt,10,Pt)]),e("div",Ht,[t.keyboardForm?(n(),v(R,{key:0,onSave:t.saveKeyboard,"edited-keyboard":t.keyboardForm},null,8,["onSave","edited-keyboard"])):h("",!0)])])):h("",!0)],64))}}),Xt={key:0,class:"row mb-2"},Wt={class:"col-12"},Zt={class:"card"},It=e("div",{class:"card-header"},[e("h6",null,"Форма создания шаблона клавиатуры")],-1),xt={class:"card-body"},eo={class:"col-md-6 col-12"},to={class:"mb-3"},oo=e("label",{class:"form-label",id:"bot-domain"},"Тип",-1),so=e("option",{value:"reply"},"Нижняя клавиатура",-1),lo=e("option",{value:"inline"},"Встроенная клавиатура",-1),io=[so,lo],no={class:"col-md-6 col-12"},ao={class:"mb-3"},ro={class:"form-label d-flex justify-content-between",id:"bot-domain"},co=e("span",null,"Мнемоническое имя",-1),ho=e("i",{class:"fa-solid fa-arrows-rotate"},null,-1),bo=[ho],uo={class:"col-12"},mo=e("div",{class:"col-12"},[e("button",{class:"btn btn-outline-success w-100 p-3"}," Добавить новый шаблон клавиатуры ")],-1),_o={class:"row"},yo={key:0,class:"col-12"},po={class:"badge bg-warning"},fo={class:"col-12 mb-3"},ko={key:1,class:"card"},vo={class:"card-body"},go={key:2,class:"col-12 mb-3"},$o=e("div",{class:"alert alert-warning",role:"alert"},[e("p",null,"Список шаблонов клавиатур пуст!")],-1),Co=[$o],wo={props:["selectMode","type"],data(){return{keyboards:[],load:!1,bot:null,editedKeyboard:null,selectMenuIndex:null,keyboardForm:{type:"reply",bot_id:null,slug:null,menu:[]}}},computed:{...T(["getCurrentBot"]),filteredKeyboard(){return this.type?this.keyboards.filter(o=>o.type==this.type):this.keyboards}},mounted(){this.loadCurrentBot().then(()=>{this.loadMenusByBotTemplate(),this.generateSlug()})},methods:{selectCard(o){this.$emit("select",o)},keyboardCallbackAction(o){let t=this.keyboards.find(s=>s.id===o);t.deleted_at=new Date,this.loadMenusByBotTemplate()},loadMenusByBotTemplate(){this.$store.dispatch("loadBotKeyboards",{botId:this.bot.id}).then(o=>{this.keyboards=o.data})},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},submitKeyboard(){this.keyboardForm.bot_id=this.bot.id;let o=new FormData;Object.keys(this.keyboardForm).forEach(t=>{const s=this.keyboardForm[t]||"";typeof s=="object"?o.append(t,JSON.stringify(s)):o.append(t,s)}),this.$store.dispatch("createKeyboardTemplate",{keyboardForm:o}).then(t=>{this.keyboardForm={type:"reply",bot_id:null,slug:null,menu:[]},this.load=!0,this.$nextTick(()=>{this.load=!1}),this.loadMenusByBotTemplate()})},generateSlug(){this.keyboardForm.slug=F()},changeKeyboardFormMenu(o){this.keyboardForm.menu=o}}},Fo=Object.assign(wo,{__name:"KeyboardList",setup(o){return(t,s)=>(n(),r(y,null,[o.selectMode?h("",!0):(n(),r("div",Xt,[e("div",Wt,[e("div",Zt,[It,e("div",xt,[e("form",{onSubmit:s[3]||(s[3]=V((...i)=>t.submitKeyboard&&t.submitKeyboard(...i),["prevent"])),class:"row"},[e("div",eo,[e("div",to,[oo,u(e("select",{"onUpdate:modelValue":s[0]||(s[0]=i=>t.keyboardForm.type=i),class:"form-control"},io,512),[[K,t.keyboardForm.type]])])]),e("div",no,[e("div",ao,[e("label",ro,[co,e("a",{onClick:s[1]||(s[1]=(...i)=>t.generateSlug&&t.generateSlug(...i)),href:"#generate"},bo)]),u(e("input",{type:"text",class:"form-control",placeholder:"Мнемоническое имя","aria-label":"Мнемоническое имя","onUpdate:modelValue":s[2]||(s[2]=i=>t.keyboardForm.slug=i),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[_,t.keyboardForm.slug]])])]),e("div",uo,[t.load?h("",!0):(n(),v(R,{key:0,onSave:t.changeKeyboardFormMenu,"edited-keyboard":t.keyboardForm},null,8,["onSave","edited-keyboard"]))]),mo],32)])])])])),e("div",_o,[t.keyboards&&t.bot?(n(),r("div",yo,[e("p",null,[$("В списке клавиатур "),e("span",po,f(t.filteredKeyboard.length)+" ед.",1)])])):h("",!0),t.keyboards&&t.bot?(n(!0),r(y,{key:1},k(t.filteredKeyboard,(i,l)=>(n(),r("div",fo,[$(f(i)+" ",1),i.deleted_at?(n(),r("div",ko,[e("div",vo,[e("p",null,"Удаленная клавиатура #"+f(i.id),1)])])):(n(),v(Qt,{key:0,"select-mode":o.selectMode,onSelect:t.selectCard,onReload:t.loadMenusByBotTemplate,onCallback:t.keyboardCallbackAction,keyboard:i},null,8,["select-mode","onSelect","onReload","onCallback","keyboard"]))]))),256)):h("",!0),t.filteredKeyboard.length===0?(n(),r("div",go,Co)):h("",!0)])],64))}}),Ro={class:"col-md-12 col-12"},Ko={class:"mb-3"},To=e("i",{class:"fa-solid fa-xmark"},null,-1),Vo=[To],So={class:"mb-3"},Bo={class:"d-flex justify-content-between flex-wrap al"},Uo=e("label",{class:"form-label",id:"bot-main-channel"},"Канал для постов (id,рекламный)",-1),Mo={class:"d-flex flex-wrap align-items-center"},jo=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),qo={class:"col-12 mb-2"},Oo=e("label",{class:"form-label d-flex justify-content-between align-items-center mb-2",id:"bot-domain"},[$(" Текстовое содержимое страницы "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),Jo={class:"form-floating"},No={for:"floatingTextarea2"},Do={key:0},Eo={class:"col-12 mb-2"},Ao={class:"form-check"},Lo=e("label",{class:"form-check-label",for:"need-page-images"}," Изображения на странице (максимум 10) ",-1),Po={key:0,class:"col-12 mb-2"},zo={class:"card mb-3"},Go=e("div",{class:"card-header"},[e("h6",null,"Изображения на странице")],-1),Ho={class:"card-body d-flex justify-content-start"},Yo={for:"photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},Qo={class:"row"},Xo={key:0,class:"col-12 d-flex flex-wrap"},Wo={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Zo={class:"remove"},Io=["onClick"],xo={class:"col-12 mb-2"},es={class:"form-check"},ts=e("label",{class:"form-check-label",for:"need-inline-menu"}," Меню под текстом страницы ",-1),os={key:1,class:"col-12 mb-2"},ss={class:"card"},ls={class:"card-header d-flex justify-between align-items-center"},is=e("h6",null,"Конструктор меню в сообщении",-1),ns={key:0},as={key:1},ds={class:"card-body"},rs=e("div",{class:"col-12"},[e("button",{type:"submit",class:"btn btn-success w-100 p-3"}," Отправить сообщение в канал ")],-1),cs={data(){return{load:!1,photos:[],showInlineTemplateSelector:!1,need_page_images:!1,need_inline_menu:!1,bot:null,mailForm:{text:"",inline_keyboard:null,channel:null}}},computed:{...T(["getCurrentBot"])},mounted(){this.loadCurrentBot()},methods:{addTextTo(o={param:null,text:null}){this.mailForm.channel=o.text},loadCurrentBot(o=null){return this.$store.dispatch("updateCurrentBot",{bot:o}).then(()=>{this.bot=this.getCurrentBot})},submitMail(){let o=new FormData;if(Object.keys(this.mailForm).forEach(t=>{const s=this.mailForm[t]||"";typeof s=="object"?o.append(t,JSON.stringify(s)):o.append(t,s)}),this.bot&&o.append("bot_id",this.bot.id),this.photos.length>0)for(let t=0;t<this.photos.length;t++)o.append("photos[]",this.photos[t]);this.$store.dispatch("sendToChannel",{mailForm:o}).then(t=>{this.load=!0,this.photos=[],this.need_inline_menu=!1,this.need_page_images=!1,this.mailForm={text:"",channel:null,inline_keyboard:null},this.$notify({title:"Конструктор ботов",text:"Сообщение успещно отправлено!",type:"success"})}).catch(t=>{})},saveInlineKeyboard(o){this.mailForm.inline_keyboard=o},selectInlineKeyboard(o){this.mailForm.inline_keyboard=o,this.showInlineTemplateSelector=!1},getPhoto(o){return{imageUrl:URL.createObjectURL(o)}},removePhoto(o){this.photos.splice(o,1)},removeImage(o){this.mailForm.images.splice(o,1)},onChangePhotos(o){const t=o.target.files;for(let s=0;s<t.length;s++)this.photos.push(t[s])}}},_s=Object.assign(cs,{__name:"Mail",setup(o){return(t,s)=>{const i=B("lazy");return t.bot?(n(),r("form",{key:0,onSubmit:s[9]||(s[9]=V((...l)=>t.submitMail&&t.submitMail(...l),["prevent"]))},[e("div",Ro,[e("div",Ko,[t.mailForm.channel!=null?(n(),r("button",{key:0,type:"button",class:"btn btn-outline-info mr-2",onClick:s[0]||(s[0]=l=>t.mailForm.channel=null)},Vo)):h("",!0),e("button",{type:"button",class:p(["btn mr-2",{"btn-info":t.mailForm.channel===t.bot.main_channel,"btn-outline-info":t.mailForm.channel!==t.bot.main_channel}]),onClick:s[1]||(s[1]=l=>t.mailForm.channel=t.bot.main_channel)},"Главный канал ",2),e("button",{type:"button",class:p(["btn",{"btn-info":t.mailForm.channel===t.bot.order_channel,"btn-outline-info":t.mailForm.channel!==t.bot.order_channel}]),onClick:s[2]||(s[2]=l=>t.mailForm.channel=t.bot.order_channel)},"Канал заказов ",2)]),e("div",So,[e("div",Bo,[Uo,e("div",Mo,[U(j,{token:t.bot.bot_token,param:"channel",onCallback:t.addTextTo},null,8,["token","onCallback"]),jo])]),u(e("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":s[3]||(s[3]=l=>t.mailForm.channel=l),maxlength:"255","aria-describedby":"bot-main-channel",required:""},null,512),[[_,t.mailForm.channel]])])]),e("div",qo,[Oo,e("div",Jo,[u(e("textarea",{class:"form-control","onUpdate:modelValue":s[4]||(s[4]=l=>t.mailForm.text=l),maxlength:"4096",placeholder:"Введите текст",id:"floatingTextarea2",style:{"min-height":"100px"},required:""},null,512),[[_,t.mailForm.text]]),e("label",No,[$("Содержимое страницы "),t.mailForm.text?(n(),r("span",Do,f(t.mailForm.text.length)+"/4096 ",1)):h("",!0)])])]),e("div",Eo,[e("div",Ao,[u(e("input",{class:"form-check-input","onUpdate:modelValue":s[5]||(s[5]=l=>t.need_page_images=l),type:"checkbox",id:"need-page-images"},null,512),[[w,t.need_page_images]]),Lo])]),t.need_page_images?(n(),r("div",Po,[e("div",zo,[Go,e("div",Ho,[e("label",Yo,[$(" + "),e("input",{type:"file",id:"photos",multiple:"",accept:"image/*",onChange:s[6]||(s[6]=(...l)=>t.onChangePhotos&&t.onChangePhotos(...l)),style:{display:"none"}},null,32)]),e("div",Qo,[t.photos.length>0?(n(),r("div",Xo,[(n(!0),r(y,null,k(t.photos,(l,c)=>(n(),r("div",Wo,[u(e("img",null,null,512),[[i,t.getPhoto(l).imageUrl]]),e("div",Zo,[e("a",{onClick:g=>t.removePhoto(c)},"Удалить",8,Io)])]))),256))])):h("",!0)])])])])):h("",!0),e("div",xo,[e("div",es,[u(e("input",{class:"form-check-input","onUpdate:modelValue":s[7]||(s[7]=l=>t.need_inline_menu=l),type:"checkbox",id:"need-inline-menu"},null,512),[[w,t.need_inline_menu]]),ts])]),t.need_inline_menu?(n(),r("div",os,[e("div",ss,[e("div",ls,[is,e("button",{class:p(["btn",{"btn-outline-primary":!t.showInlineTemplateSelector,"btn-primary":t.showInlineTemplateSelector}]),type:"button",onClick:s[8]||(s[8]=l=>t.showInlineTemplateSelector=!t.showInlineTemplateSelector)},[t.showInlineTemplateSelector?(n(),r("span",as," Скрыть шаблоны меню")):(n(),r("span",ns," Открыть шаблоны меню"))],2)]),e("div",ds,[t.showInlineTemplateSelector?(n(),v(Fo,{key:0,class:"mb-2",type:"inline",onSelect:t.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(n(),v(R,{key:1,type:"inline",onSave:t.saveInlineKeyboard,"edited-keyboard":t.mailForm.inline_keyboard},null,8,["onSave","edited-keyboard"]))])])])):h("",!0),rs],32)):h("",!0)}}});export{R as B,Fo as _,_s as a};
